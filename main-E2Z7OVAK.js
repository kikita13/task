var N7=Object.create;var uM=Object.defineProperty,z7=Object.defineProperties,B7=Object.getOwnPropertyDescriptor,j7=Object.getOwnPropertyDescriptors,V7=Object.getOwnPropertyNames,o0=Object.getOwnPropertySymbols,U7=Object.getPrototypeOf,dM=Object.prototype.hasOwnProperty,oN=Object.prototype.propertyIsEnumerable;var rN=(i,r,a)=>r in i?uM(i,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[r]=a,Lt=(i,r)=>{for(var a in r||={})dM.call(r,a)&&rN(i,a,r[a]);if(o0)for(var a of o0(r))oN.call(r,a)&&rN(i,a,r[a]);return i},Er=(i,r)=>z7(i,j7(r));var hp=(i,r)=>{var a={};for(var c in i)dM.call(i,c)&&r.indexOf(c)<0&&(a[c]=i[c]);if(i!=null&&o0)for(var c of o0(i))r.indexOf(c)<0&&oN.call(i,c)&&(a[c]=i[c]);return a};var hM=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports);var $7=(i,r,a,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let h of V7(r))!dM.call(i,h)&&h!==a&&uM(i,h,{get:()=>r[h],enumerable:!(c=B7(r,h))||c.enumerable});return i};var fM=(i,r,a)=>(a=i!=null?N7(U7(i)):{},$7(r||!i||!i.__esModule?uM(a,"default",{value:i,enumerable:!0}):a,i));var s0=(i,r,a)=>new Promise((c,h)=>{var m=C=>{try{w(a.next(C))}catch(D){h(D)}},y=C=>{try{w(a.throw(C))}catch(D){h(D)}},w=C=>C.done?c(C.value):Promise.resolve(C.value).then(m,y);w((a=a.apply(i,r)).next())});var E$=hM((DA,AA)=>{"use strict";(function(i,r){typeof DA=="object"&&typeof AA<"u"?AA.exports=r():typeof define=="function"&&define.amd?define(r):(i=typeof globalThis<"u"?globalThis:i||self,i.mapboxgl=r())})(DA,function(){"use strict";var i,r,a;function c(m,y){if(!i)i=y;else if(!r)r=y;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",C={};i(C),a=y(C),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}c(["exports"],function(m){"use strict";var y=typeof self<"u"?self:{},w="3.1.2";let C,D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(C==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{C=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{C=t}}return C},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!D.API_URL)return null;try{let t=new URL(D.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},z={supported:!1,testSupport:function(t){!oe&&ie&&(he?ke(t):j=t)}},j,ie,oe=!1,he=!1;function ke(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ie),t.isContextLost())return;z.supported=!0}catch{}t.deleteTexture(e),oe=!0}y.document&&(ie=y.document.createElement("img"),ie.onload=function(){j&&ke(j),j=null,he=!0},ie.onerror=function(){oe=!0,j=null},ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let rt="01";function Ve(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ot=hn;function hn(t,e,n,o){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=o}hn.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,o=0;o<8;o++){var s=this.sampleCurveX(n)-t;if(Math.abs(s)<e)return n;var l=this.sampleCurveDerivativeX(n);if(Math.abs(l)<1e-6)break;n-=s/l}var u=0,d=1;for(n=t,o=0;o<20&&(s=this.sampleCurveX(n),!(Math.abs(s-t)<e));o++)t>s?u=n:d=n,n=.5*(d-u)+u;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Qt=Ve(Ot),Wn=Kn;function Kn(t,e){this.x=t,this.y=e}Kn.prototype={clone:function(){return new Kn(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),s=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Kn.convert=function(t){return t instanceof Kn?t:Array.isArray(t)?new Kn(t[0],t[1]):t};var X=Ve(Wn);function Rt(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Rt(t[n],e[n]))return!1;return!0}if(typeof t=="object"&&t!==null&&e!==null){if(typeof e!="object"||Object.keys(t).length!==Object.keys(e).length)return!1;for(let n in t)if(!Rt(t[n],e[n]))return!1;return!0}return t===e}let bo=Math.PI/180,ar=180/Math.PI;function Vt(t){return t*bo}function xi(t){return t*ar}let Pa=[[0,0],[1,0],[1,1],[0,1]];function Ko(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Oa(t){let e=1/0,n=1/0,o=-1/0,s=-1/0;for(let l of t)e=Math.min(e,l.x),n=Math.min(n,l.y),o=Math.max(o,l.x),s=Math.max(s,l.y);return{min:new X(e,n),max:new X(o,s)}}function Pt(t,e,n=0,o=!0){let s=new X(n,n),l=t.sub(s),u=e.add(s),d=[l,new X(u.x,l.y),u,new X(l.x,u.y)];return o&&d.push(l.clone()),d}function Ut(t,e,n,o){let s=new Qt(t,e,n,o);return function(l){return s.solve(l)}}let jt=Ut(.25,.1,.25,1);function ze(t,e,n){return Math.min(n,Math.max(e,t))}function Si(t,e,n){return(n=ze((n-t)/(e-t),0,1))*n*(3-2*n)}function bi(t,e,n){let o=n-e,s=((t-e)%o+o)%o+e;return s===e?n:s}function Ji(t,e,n){if(!t.length)return n(null,[]);let o=t.length,s=new Array(t.length),l=null;t.forEach((u,d)=>{e(u,(f,p)=>{f&&(l=f),s[d]=p,--o==0&&n(l,s)})})}function wr(t){let e=[];for(let n in t)e.push(t[n]);return e}function Ne(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}function wo(t,e){let n={};for(let o=0;o<e.length;o++){let s=e[o];s in t&&(n[s]=t[s])}return n}let la=1;function pi(){return la++}function Tn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function io(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Fs(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function gr(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function ks(t,e){return t.indexOf(e,t.length-e.length)!==-1}function nl(t,e,n){let o={};for(let s in t)o[s]=e.call(n||this,t[s],s,t);return o}function Ae(t,e,n){let o={};for(let s in t)e.call(n||this,t[s],s,t)&&(o[s]=t[s]);return o}function $(t){return Array.isArray(t)?t.map($):typeof t=="object"&&t?nl(t,$):t}let W={};function J(t){W[t]||(typeof console<"u"&&console.warn(t),W[t]=!0)}function we(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function De(t){let e=0;for(let n,o,s=0,l=t.length,u=l-1;s<l;u=s++)n=t[s],o=t[u],e+=(o.x-n.x)*(n.y+o.y);return e}function it([t,e,n]){let o=Vt(e+90),s=Vt(n);return{x:t*Math.cos(o)*Math.sin(s),y:t*Math.sin(o)*Math.sin(s),z:t*Math.cos(s),azimuthal:e,polar:n}}function ht(t,e,n){let o=Math.sqrt(t*t+e*e+n*n),s=o>0?Math.acos(n/o)*ar:0,l=t!==0||e!==0?Math.atan2(-e,-t)*ar+90:0;return l<0&&(l+=360),[o,l,s]}function Re(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Et(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,s,l)=>{let u=s||l;return e[o]=!u||u.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Dt=null;function zt(){return!!y.document.fullscreenElement||!!y.document.webkitFullscreenElement}function li(t){try{let e=y[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ni(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Qi(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]}function Di(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]}function Hi(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]}let wi="mapbox-tiles",To=500,Eo=50,Ai,Uo;function Ns(){try{return y.caches}catch{}}function ro(){Ns()&&!Ai&&(Ai=y.caches.open(wi))}function zs(t){let e=t.indexOf("?");if(e<0)return t;let n=function(s){let l=s.indexOf("?");return l>0?s.slice(l+1).split("&"):[]}(t),o=n.filter(s=>{let l=s.split("=");return l[0]==="language"||l[0]==="worldview"});return o.length?`${t.slice(0,e)}?${o.join("&")}`:t.slice(0,e)}let Ts=1/0;function ko(t){Ts++,Ts>Eo&&(t.getActor().send("enforceCacheSizeLimit",To),Ts=0)}let ve={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ve);class Ce extends Error{constructor(e,n,o){n===401&&ci(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Le=Re()?()=>self.worker&&self.worker.referrer:()=>(y.location.protocol==="blob:"?y.parent:y).location.href,Ue=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Le())&&!/^\w+:/.test(n))){if(y.fetch&&y.Request&&y.AbortController&&y.Request.prototype.hasOwnProperty("signal"))return function(o,s){let l=new y.AbortController,u=new y.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Le(),referrerPolicy:o.referrerPolicy,signal:l.signal}),d=!1,f=!1,p=(g=u.url).indexOf("sku=")>0&&ci(g);var g;o.type==="json"&&u.headers.set("Accept","application/json");let _=(x,b,T)=>{if(f)return;if(x&&x.message!=="SecurityError"&&J(x.toString()),b&&T)return v(b);let E=Date.now();y.fetch(u).then(M=>{if(M.ok){let S=p?M.clone():null;return v(M,S,E)}return s(new Ce(M.statusText,M.status,o.url))}).catch(M=>{M.name!=="AbortError"&&s(new Error(`${M.message} ${o.url}`))})},v=(x,b,T)=>{(o.type==="arrayBuffer"?x.arrayBuffer():o.type==="json"?x.json():x.text()).then(E=>{f||(b&&T&&function(M,S,P){if(ro(),!Ai)return;let O={status:S.status,statusText:S.statusText,headers:new y.Headers};S.headers.forEach((F,k)=>O.headers.set(k,F));let A=Et(S.headers.get("Cache-Control")||"");if(A["no-store"])return;A["max-age"]&&O.headers.set("Expires",new Date(P+1e3*A["max-age"]).toUTCString());let R=O.headers.get("Expires");R&&(new Date(R).getTime()-P<42e4||function(F,k){if(Uo===void 0)try{new Response(new ReadableStream),Uo=!0}catch{Uo=!1}Uo?k(F.body):F.blob().then(k)}(S,F=>{let k=new y.Response(F,O);ro(),Ai&&Ai.then(N=>N.put(zs(M.url),k)).catch(N=>J(N.message))}))}(u,b,T),d=!0,s(null,E,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(E=>{f||s(new Error(E.message))})};return p?function(x,b){if(ro(),!Ai)return b(null);let T=zs(x.url);Ai.then(E=>{E.match(T).then(M=>{let S=function(P){if(!P)return!1;let O=new Date(P.headers.get("Expires")||0),A=Et(P.headers.get("Cache-Control")||"");return O>Date.now()&&!A["no-cache"]}(M);E.delete(T),S&&E.put(T,M.clone()),b(null,M,S)}).catch(b)}).catch(b)}(u,_):_(null,null),{cancel:()=>{f=!0,d||l.abort()}}}(t,e);if(Re()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(o,s){let l=new y.XMLHttpRequest;l.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(let u in o.headers)l.setRequestHeader(u,o.headers[u]);return o.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=o.credentials==="include",l.onerror=()=>{s(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let u=l.response;if(o.type==="json")try{u=JSON.parse(l.response)}catch(d){return s(d)}s(null,u,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else s(new Ce(l.statusText,l.status,o.url))},l.send(o.body),{cancel:()=>l.abort()}}(t,e)},Ge=function(t,e){return Ue(Ne(t,{type:"json"}),e)},Qe=function(t,e){return Ue(Ne(t,{type:"arrayBuffer"}),e)};function nt(t){let e=y.document.createElement("a");return e.href=t,e.protocol===y.document.location.protocol&&e.host===y.document.location.host}let Ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",ut,Be;ut=[],Be=0;let Ft=function(t,e){if(z.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Be>=D.MAX_PARALLEL_IMAGE_REQUESTS){let l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ut.push(l),l}Be++;let n=!1,o=()=>{if(!n)for(n=!0,Be--;ut.length&&Be<D.MAX_PARALLEL_IMAGE_REQUESTS;){let l=ut.shift(),{requestParameters:u,callback:d,cancelled:f}=l;f||(l.cancel=Ft(u,d).cancel)}},s=Qe(t,(l,u,d,f)=>{o(),l?e(l):u&&(y.createImageBitmap?function(p,g){let _=new y.Blob([new Uint8Array(p)],{type:"image/png"});y.createImageBitmap(_).then(v=>{g(null,v)}).catch(v=>{g(new Error(`Could not load image because of ${v.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(u,(p,g)=>e(p,g,d,f)):function(p,g){let _=new y.Image,v=y.URL;_.onload=()=>{g(null,_),v.revokeObjectURL(_.src),_.onload=null,y.requestAnimationFrame(()=>{_.src=Ye})},_.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let x=new y.Blob([new Uint8Array(p)],{type:"image/png"});_.src=p.byteLength?v.createObjectURL(x):Ye}(u,(p,g)=>e(p,g,d,f)))});return{cancel:()=>{s.cancel(),o()}}},on="NO_ACCESS_TOKEN";class Mt{constructor(e,n,o){this._transformRequestFn=e,this._customAccessToken=n,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){let e=function(){let n="";for(let o=0;o<10;o++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",rt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}normalizeStyleURL(e,n){if(!qt(e))return e;let o=Br(e);return o.params.push(`sdk=js-${w}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(e,n){if(!qt(e))return e;let o=Br(e);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeModelURL(e,n){if(!qt(e))return e;let o=Br(e);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeSourceURL(e,n,o,s){if(!qt(e))return e;let l=Br(e);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),o&&l.params.push(`language=${o}`),s&&l.params.push(`worldview=${s}`),this._makeAPIURL(l,this._customAccessToken||n)}normalizeSpriteURL(e,n,o,s){let l=Br(e);return qt(e)?(l.path=`/styles/v1${l.path}/sprite${n}${o}`,this._makeAPIURL(l,this._customAccessToken||s)):(l.path+=`${n}${o}`,Pi(l))}normalizeTileURL(e,n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!qt(e))return e;let s=Br(e);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||o&&s.authority!=="raster"&&o===512?"@2x":""}${z.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${D.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${D.TILE_URL_VERSION}${s.path}`);let l=this._customAccessToken||function(u){for(let d of u){let f=d.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(s.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,l)}canonicalizeTileURL(e,n){let o=Br(e);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return e;let s="mapbox://";o.path.match(/^\/raster\/v1\//)?s+=`raster/${o.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${o.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let l=o.params;return n&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(s+=`?${l.join("&")}`),s}canonicalizeTileset(e,n){let o=!!n&&qt(n),s=[];for(let l of e.tiles||[])ci(l)?s.push(this.canonicalizeTileURL(l,o)):s.push(l);return s}_makeAPIURL(e,n){let o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Br(D.API_URL);if(e.protocol=s.protocol,e.authority=s.authority,e.protocol==="http"){let l=e.params.indexOf("secure");l>=0&&e.params.splice(l,1)}if(s.path!=="/"&&(e.path=`${s.path}${e.path}`),!D.REQUIRE_ACCESS_TOKEN)return Pi(e);if(n=n||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return e.params=e.params.filter(l=>l.indexOf("access_token")===-1),e.params.push(`access_token=${n||""}`),Pi(e)}}function qt(t){return t.indexOf("mapbox:")===0}function ci(t){return D.API_URL_REGEX.test(t)}function Gi(t){return D.API_CDN_URL_REGEX.test(t)}function er(t){return D.API_STYLE_REGEX.test(t)&&!zr(t)}function zr(t){return D.API_SPRITE_REGEX.test(t)}let ns=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Br(t){let e=t.match(ns);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Pi(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Ir="mapbox.eventData";function Ra(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(y.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Bs{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=Ra(D.ACCESS_TOKEN),o="";return o=n&&n.u?y.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(s,l)=>String.fromCharCode(+("0x"+l)))):D.ACCESS_TOKEN||"",e?`${Ir}.${e}:${o}`:`${Ir}:${o}`}fetchEventData(){let e=li("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{let s=y.localStorage.getItem(n);s&&(this.eventData=JSON.parse(s));let l=y.localStorage.getItem(o);l&&(this.anonId=l)}catch{J("Unable to read from LocalStorage")}}saveEventData(){let e=li("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{y.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&y.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{J("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,s){if(!D.EVENTS_URL)return;let l=Br(D.EVENTS_URL);l.params.push(`access_token=${s||D.ACCESS_TOKEN||""}`);let u={event:this.type,created:new Date(e).toISOString()},d=n?Ne(u,n):u,f={url:Pi(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([d])};this.pendingRequest=function(p,g){return Ue(Ne(p,{method:"POST"}),g)}(f,p=>{this.pendingRequest=null,o(p),this.saveEventData(),this.processRequests(s)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let us=new class extends Bs{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>qt(n)||ci(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Ra(D.ACCESS_TOKEN),n=e?e.u:D.ACCESS_TOKEN,o=n!==this.eventData.tokenU;Fs(this.anonId)||(this.anonId=Tn(),o=!0);let s=this.queue.shift();if(this.eventData.lastSuccess){let l=new Date(this.eventData.lastSuccess),u=new Date(s),d=(s-this.eventData.lastSuccess)/864e5;o=o||d>=1||d<-1||l.getDate()!==u.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:rt,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)},t):this.processRequests()}},zl=us.postTurnstileEvent.bind(us),il=new class extends Bs{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,o){this.skuToken=e,this.errorCb=o,D.EVENTS_URL&&(n||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(on)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Fs(this.anonId)||(this.anonId=Tn()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:rt,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}},yf=il.postMapLoadEvent.bind(il),Bl=new class extends Bs{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){D.EVENTS_URL&&(t||D.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),o=function(s){let l=y.performance.getEntriesByType("resource"),u=y.performance.getEntriesByType("mark"),d=function(v){let x={};if(v){for(let b in v)if(b!=="other")for(let T of v[b]){let E=`${b}ResolveRangeMin`,M=`${b}ResolveRangeMax`,S=`${b}RequestCount`,P=`${b}RequestCachedCount`;x[E]=Math.min(x[E]||1/0,T.startTime),x[M]=Math.max(x[M]||-1/0,T.responseEnd);let O=A=>{x[A]===void 0&&(x[A]=0),++x[A]};T.transferSize!==void 0&&T.transferSize===0&&O(P),O(S)}}return x}(function(v,x){let b={};if(v)for(let T of v){let E=x(T);b[E]===void 0&&(b[E]=[]),b[E].push(T)}return b}(l,bc)),f=y.devicePixelRatio,p=y.navigator.connection||y.navigator.mozConnection||y.navigator.webkitConnection,g={counters:[],metadata:[],attributes:[]},_=(v,x,b)=>{b!=null&&v.push({name:x,value:b.toString()})};for(let v in d)_(g.counters,v,d[v]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(_(g.counters,"interactionRangeMin",s.interactionRange[0]),_(g.counters,"interactionRangeMax",s.interactionRange[1])),u)for(let v of Object.keys(ds)){let x=ds[v],b=u.find(T=>T.name===x);b&&_(g.counters,x,b.startTime)}return _(g.counters,"visibilityHidden",s.visibilityHidden),_(g.attributes,"style",function(v){if(v)for(let x of v){let b=x.name.split("?")[0];if(er(b)){let T=b.split("/").slice(-2);if(T.length===2)return`mapbox://styles/${T[0]}/${T[1]}`}}}(l)),_(g.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),_(g.attributes,"fogEnabled",s.fogEnabled?"true":"false"),_(g.attributes,"projection",s.projection),_(g.attributes,"zoom",s.zoom),_(g.metadata,"devicePixelRatio",f),_(g.metadata,"connectionEffectiveType",p?p.effectiveType:void 0),_(g.metadata,"navigatorUserAgent",y.navigator.userAgent),_(g.metadata,"screenWidth",y.screen.width),_(g.metadata,"screenHeight",y.screen.height),_(g.metadata,"windowWidth",y.innerWidth),_(g.metadata,"windowHeight",y.innerHeight),_(g.metadata,"mapWidth",s.width/f),_(g.metadata,"mapHeight",s.height/f),_(g.metadata,"webglRenderer",s.renderer),_(g.metadata,"webglVendor",s.vendor),_(g.metadata,"sdkVersion",w),_(g.metadata,"sdkIdentifier","mapbox-gl-js"),g}(n);for(let s of o.metadata);for(let s of o.counters);for(let s of o.attributes);this.postEvent(e,o,()=>{},t)}},Rd=Bl.postPerformanceEvent.bind(Bl),jl=new class extends Bs{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,o){if(!D.API_URL||!D.SESSION_PATH)return;let s=Br(D.API_URL+D.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${o||D.ACCESS_TOKEN||""}`);let l={url:Pi(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(u,d){return Ue(Ne(u,{method:"GET"}),d)}(l,u=>{this.pendingRequest=null,n(u),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,n,o){this.skuToken=e,this.errorCb=o,D.SESSION_PATH&&D.API_URL&&(n||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(on)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}},Cr=jl.getSessionAPI.bind(jl),js=new Set;function La(t,e){e?js.add(t):js.delete(t)}let ds={create:"create",load:"load",fullLoad:"fullLoad"},hs={mark(t){y.performance.mark(t)},measure(t,e,n){y.performance.measure(t,e,n)}};function bc(t){let e=t.name.split("?")[0];return Gi(e)&&e.includes("mapbox-gl.js")?"javascript":Gi(e)&&e.includes("mapbox-gl.css")?"css":function(n){return D.API_FONTS_REGEX.test(n)}(e)?"fontRange":zr(e)?"sprite":er(e)?"style":function(n){return D.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}let ca=y.performance;function ua(t){let e=t?t.url.toString():void 0;return ca.getEntriesByName(e)}var Vl=Ul;function Ul(t){return!function(e){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var o,s,l=new Blob([""],{type:"text/javascript"}),u=URL.createObjectURL(l);try{s=new Worker(u),o=!0}catch{o=!1}return s&&s.terminate(),URL.revokeObjectURL(u),o}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var o=document.createElement("canvas");o.width=o.height=1;var s=o.getContext("2d");if(!s)return!1;var l=s.getImageData(0,0,1,1);return l&&l.width===o.width}()?(Es[n=e&&e.failIfMajorPerformanceCaveat]===void 0&&(Es[n]=function(o){var s,l=function(u){var d=document.createElement("canvas"),f=Object.create(Ul.webGLContextAttributes);return f.failIfMajorPerformanceCaveat=u,d.getContext("webgl",f)||d.getContext("experimental-webgl",f)}(o);if(!l)return!1;try{s=l.createShader(l.VERTEX_SHADER)}catch{return!1}return!(!s||l.isContextLost())&&(l.shaderSource(s,"void main() {}"),l.compileShader(s),l.getShaderParameter(s,l.COMPILE_STATUS)===!0)}(n)),Es[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}(t)}var Es={};let Fa,rl,ol,wc,Jo;function vf(){return Fa==null&&(Fa=y.OffscreenCanvas&&new y.OffscreenCanvas(1,1).getContext("2d")&&typeof y.createImageBitmap=="function"),Fa}Ul.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Zt={now:()=>wc!==void 0?wc:y.performance.now(),setNow(t){wc=t},restoreNow(){wc=void 0},frame(t){let e=y.requestAnimationFrame(t);return{cancel:()=>y.cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:o}=t;Jo||(Jo=y.document.createElement("canvas"));let s=Jo.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(n>Jo.width||o>Jo.height)&&(Jo.width=n,Jo.height=o),s.clearRect(-e,-e,n+2*e,o+2*e),s.drawImage(t,0,0,n,o),s.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:t=>(rl||(rl=y.document.createElement("a")),rl.href=t,rl.href),get devicePixelRatio(){return y.devicePixelRatio},get prefersReducedMotion(){return!!y.matchMedia&&(ol==null&&(ol=y.matchMedia("(prefers-reduced-motion: reduce)")),ol.matches)},hasCanvasFingerprintNoise(){if(!vf())return!1;let t=new y.OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let s=0;s<t.width;++s)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(s,0,1,1);let o=e.getImageData(0,0,t.width,t.height);n=0;for(let s=0;s<o.data.length;++s)if(s%4!=3&&n++!==o.data[s])return!0;return!1}};function gn(t,e,n){let o=y.document.createElement(t);return e!==void 0&&(o.className=e),n&&n.appendChild(o),o}function Mo(t,e,n){let o=y.document.createElementNS("http://www.w3.org/2000/svg",t);for(let s of Object.keys(e))o.setAttributeNS(null,s,e[s]);return n&&n.appendChild(o),o}let I=y.document&&y.document.documentElement.style,L=I&&I.userSelect!==void 0?"userSelect":"WebkitUserSelect",V;function re(){I&&L&&(V=I[L],I[L]="none")}function le(){I&&L&&(I[L]=V)}function ue(t){t.preventDefault(),t.stopPropagation(),y.removeEventListener("click",ue,!0)}function _e(){y.addEventListener("click",ue,!0),y.setTimeout(()=>{y.removeEventListener("click",ue,!0)},0)}function Ke(t,e){let n=t.getBoundingClientRect();return vt(t,n,e)}function at(t,e){let n=t.getBoundingClientRect(),o=[];for(let s=0;s<e.length;s++)o.push(vt(t,n,e[s]));return o}function _t(t){return y.InstallTrigger!==void 0&&t.button===2&&t.ctrlKey&&y.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function vt(t,e,n){let o=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new X((n.clientX-e.left)*o,(n.clientY-e.top)*o)}function ft(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function yn(t,e,n){if(n&&n[t]){let o=n[t].indexOf(e);o!==-1&&n[t].splice(o,1)}}class Se{constructor(e,n={}){Ne(this,n),this.type=e}}class Je extends Se{constructor(e,n={}){super("error",Ne({error:e},n))}}class vn{on(e,n){return this._listeners=this._listeners||{},ft(e,n,this._listeners),this}off(e,n){return yn(e,n,this._listeners),yn(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ft(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new Se(e,n||{}));let o=e.type;if(this.listens(o)){e.target=this;let s=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let d of s)d.call(this,e);let l=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let d of l)yn(o,d,this._oneTimeListeners),d.call(this,e);let u=this._eventedParent;u&&(Ne(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),u.fire(e))}else e instanceof Je&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var q=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ie{constructor(e,n,o,s){this.message=(e?`${e}: `:"")+o,s&&(this.identifier=s),n!=null&&n.__line__&&(this.line=n.__line__)}}class mi extends Ie{}function tr(t,...e){for(let n of e)for(let o in n)t[o]=n[o];return t}function $n(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Bt(t){if(Array.isArray(t))return t.map(Bt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Bt(t[n]);return e}return $n(t)}class xe extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var $e=xe;class Wt{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[o,s]of n)this.bindings[o]=s}concat(e){return new Wt(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var lr=Wt;let Wi={kind:"null"},Ze={kind:"number"},Jt={kind:"string"},Sn={kind:"boolean"},fo={kind:"color"},Yr={kind:"object"},Ln={kind:"value"},Tc={kind:"collator"},Ld={kind:"formatted"},Fd={kind:"resolvedImage"};function is(t,e){return{kind:"array",itemType:t,N:e}}function Sr(t){if(t.kind==="array"){let e=Sr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let ny=[Wi,Ze,Jt,Sn,fo,Ld,Yr,is(Ln),Fd];function kd(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!kd(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of ny)if(!kd(n,e))return null}}return`Expected ${Sr(t)} but found ${Sr(e)} instead.`}function bm(t,e){return e.some(n=>n.kind===t.kind)}function $l(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var Nd,wm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ms(t){return(t=Math.round(t))<0?0:t>255?255:t}function xf(t){return Ms(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function zd(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Tm(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Nd={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in wm)return wm[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=n.indexOf("("),s=n.indexOf(")");if(o!==-1&&s+1===n.length){var l=n.substr(0,o),u=n.substr(o+1,s-(o+1)).split(","),d=1;switch(l){case"rgba":if(u.length!==4)return null;d=zd(u.pop());case"rgb":return u.length!==3?null:[xf(u[0]),xf(u[1]),xf(u[2]),d];case"hsla":if(u.length!==4)return null;d=zd(u.pop());case"hsl":if(u.length!==3)return null;var f=(parseFloat(u[0])%360+360)%360/360,p=zd(u[1]),g=zd(u[2]),_=g<=.5?g*(p+1):g+p-g*p,v=2*g-_;return[Ms(255*Tm(v,_,f+1/3)),Ms(255*Tm(v,_,f)),Ms(255*Tm(v,_,f-1/3)),d];default:return null}}return null}}catch{}class rs{constructor(e,n,o,s=1){this.r=e,this.g=n,this.b=o,this.a=s}static parse(e){if(!e)return;if(e instanceof rs)return e;if(typeof e!="string")return;let n=Nd(e);return n?new rs(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,o,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${s})`}toArray(){let{r:e,g:n,b:o,a:s}=this;return s===0?[0,0,0,0]:[255*e/s,255*n/s,255*o/s,s]}toArray01(){let{r:e,g:n,b:o,a:s}=this;return s===0?[0,0,0,0]:[e/s,n/s,o/s,s]}toArray01Scaled(e){let{r:n,g:o,b:s,a:l}=this;return l===0?[0,0,0]:[n/l*e,o/l*e,s/l*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:o,a:s}=this;return[e,n,o,s]}toArray01Linear(){let{r:e,g:n,b:o,a:s}=this;return s===0?[0,0,0,0]:[Math.pow(e/s,2.2),Math.pow(n/s,2.2),Math.pow(o/s,2.2),s]}}rs.black=new rs(0,0,0,1),rs.white=new rs(1,1,1,1),rs.transparent=new rs(0,0,0,0),rs.red=new rs(1,0,0,1),rs.blue=new rs(0,0,1,1);var tn=rs;class bf{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wf{constructor(e,n,o,s,l){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=s,this.textColor=l}}class fs{constructor(e){this.sections=e}static fromString(e){return new fs([new wf(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof fs?e:fs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(o)}return e}}class No{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new No({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Em(t,e,n,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,n,o]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Iu(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof tn||t instanceof bf||t instanceof fs||t instanceof No)return!0;if(Array.isArray(t)){for(let e of t)if(!Iu(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Iu(t[e]))return!1;return!0}return!1}function oo(t){if(t===null)return Wi;if(typeof t=="string")return Jt;if(typeof t=="boolean")return Sn;if(typeof t=="number")return Ze;if(t instanceof tn)return fo;if(t instanceof bf)return Tc;if(t instanceof fs)return Ld;if(t instanceof No)return Fd;if(Array.isArray(t)){let e=t.length,n;for(let o of t){let s=oo(o);if(n){if(n===s)continue;n=Ln;break}n=s}return is(n||Ln,e)}return Yr}function Ec(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof tn||t instanceof fs||t instanceof No?t.toString():JSON.stringify(t)}class Mc{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Iu(e[1]))return n.error("invalid value");let o=e[1],s=oo(o),l=n.expectedType;return s.kind!=="array"||s.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(s=l),new Mc(s,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof tn?["rgba"].concat(this.value.toArray()):this.value instanceof fs?this.value.serialize():this.value}}var Ic=Mc,Xr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};let Bd={string:Jt,number:Ze,boolean:Sn,object:Yr};class Cc{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,s=1,l=e[0];if(l==="array"){let d,f;if(e.length>2){let p=e[1];if(typeof p!="string"||!(p in Bd)||p==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);d=Bd[p],s++}else d=Ln;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);f=e[2],s++}o=is(d,f)}else o=Bd[l];let u=[];for(;s<e.length;s++){let d=n.parse(e[s],s,Ln);if(!d)return null;u.push(d)}return new Cc(o,u)}evaluate(e){for(let n=0;n<this.args.length;n++){let o=this.args[n].evaluate(e);if(!kd(this.type,oo(o)))return o;if(n===this.args.length-1)throw new Xr(`Expected value to be of type ${Sr(this.type)}, but found ${Sr(oo(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);let s=e.N;(typeof s=="number"||this.args.length>1)&&n.push(s)}}return n.concat(this.args.map(o=>o.serialize()))}}var sl=Cc;class jd{constructor(e){this.type=Ld,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");let s=[],l=!1;for(let u=1;u<=e.length-1;++u){let d=e[u];if(l&&typeof d=="object"&&!Array.isArray(d)){l=!1;let f=null;if(d["font-scale"]&&(f=n.parse(d["font-scale"],1,Ze),!f))return null;let p=null;if(d["text-font"]&&(p=n.parse(d["text-font"],1,is(Jt)),!p))return null;let g=null;if(d["text-color"]&&(g=n.parse(d["text-color"],1,fo),!g))return null;let _=s[s.length-1];_.scale=f,_.font=p,_.textColor=g}else{let f=n.parse(e[u],1,Ln);if(!f)return null;let p=f.type.kind;if(p!=="string"&&p!=="value"&&p!=="null"&&p!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,s.push({content:f,scale:null,font:null,textColor:null})}}return new jd(s)}evaluate(e){return new fs(this.sections.map(n=>{let o=n.content.evaluate(e);return oo(o)===Fd?new wf("",o,null,null,null):new wf(Ec(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class Vd{constructor(e,n){this.type=Fd,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let o=n.parse(e[1],1,Jt);if(!o)return n.error("No image name provided.");if(e.length===2)return new Vd(o);let s=n.parse(e[2],1,Jt);return s?new Vd(o,s):n.error("Secondary image variant is not a string.")}evaluate(e){let n=No.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ui(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let ew={"to-boolean":Sn,"to-color":fo,"to-number":Ze,"to-string":Jt};class Tf{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=e[0],s=[],l=Wi;if(o==="to-array"){if(!Array.isArray(e[1]))return null;let u=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);l=is(n.expectedType.itemType,u)}else{if(!(u>0&&Iu(e[1][0])))return null;l=is(oo(e[1][0]),u)}for(let d=0;d<u;d++){let f=e[1][d],p;if(ui(f)==="array")p=n.parse(f,void 0,l.itemType);else{let g=ui(f);if(g!==l.itemType.kind)return n.error(`Expected ${l.itemType.kind} but found ${g}.`);p=n.registry.literal.parse(["literal",f===void 0?null:f],n)}if(!p)return null;s.push(p)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");l=ew[o];for(let u=1;u<e.length;u++){let d=n.parse(e[u],u,Ln);if(!d)return null;s.push(d)}}return new Tf(l,s)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,o;for(let s of this.args){if(n=s.evaluate(e),o=null,n instanceof tn)return n;if(typeof n=="string"){let l=e.parseColor(n);if(l)return l}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Em(n[0],n[1],n[2],n[3]),!o))return new tn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Xr(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let o of this.args){if(n=o.evaluate(e),n===null)return 0;let s=Number(n);if(!isNaN(s))return s}throw new Xr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?fs.fromString(Ec(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?No.fromString(Ec(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Ec(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new jd([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vd(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var al=Tf;let Sc=["Unknown","Point","LineString","Polygon"];var ka=class{constructor(t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=t}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Sc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(o*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=tn.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Is{constructor(e,n,o,s,l){this.name=e,this.type=n,this._evaluate=o,this.args=s,this._overloadIndex=l}evaluate(e){if(!this._evaluate){let n=Is.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let o=e[0],s=Is.definitions[o];if(!s)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let l=Array.isArray(s)?s[0]:s.type,u=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,d=[],f=null,p=-1;for(let[g,_]of u){if(Array.isArray(g)&&g.length!==e.length-1)continue;d.push(g),p++,f=new Pm(n.registry,n.path,null,n.scope,void 0,n.options);let v=[],x=!1;for(let b=1;b<e.length;b++){let T=e[b],E=Array.isArray(g)?g[b-1]:g.type,M=f.parse(T,1+v.length,E);if(!M){x=!0;break}v.push(M)}if(!x)if(Array.isArray(g)&&g.length!==v.length)f.error(`Expected ${g.length} arguments, but found ${v.length} instead.`);else{for(let b=0;b<v.length;b++){let T=Array.isArray(g)?g[b]:g.type,E=v[b];f.concat(b+1).checkSubtype(T,E.type)}if(f.errors.length===0)return new Is(o,l,_,v,p)}}if(d.length===1)n.errors.push(...f.errors);else{let g=(d.length?d:u.map(([v])=>v)).map(Ef).join(" | "),_=[];for(let v=1;v<e.length;v++){let x=n.parse(e[v],1+_.length);if(!x)return null;_.push(Sr(x.type))}n.error(`Expected arguments of type ${g}, but found (${_.join(", ")}) instead.`)}return null}static register(e,n){Is.definitions=n;for(let o in n)e[o]=Is}}function Ef(t){return Array.isArray(t)?`(${t.map(Sr).join(", ")})`:`(${Sr(t.type)}...)`}var $o=Is;class Mf{constructor(e,n,o){this.type=Tc,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");let s=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Sn);if(!s)return null;let l=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Sn);if(!l)return null;let u=null;return o.locale&&(u=n.parse(o.locale,1,Jt),!u)?null:new Mf(s,l,u)}evaluate(e){return new bf(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Ud={exports:{}};Ud.exports=function(){function t(o,s,l,u,d){for(;u>l;){if(u-l>600){var f=u-l+1,p=s-l+1,g=Math.log(f),_=.5*Math.exp(2*g/3),v=.5*Math.sqrt(g*_*(f-_)/f)*(p-f/2<0?-1:1);t(o,s,Math.max(l,Math.floor(s-p*_/f+v)),Math.min(u,Math.floor(s+(f-p)*_/f+v)),d)}var x=o[s],b=l,T=u;for(e(o,l,s),d(o[u],x)>0&&e(o,l,u);b<T;){for(e(o,b,T),b++,T--;d(o[b],x)<0;)b++;for(;d(o[T],x)>0;)T--}d(o[l],x)===0?e(o,l,T):e(o,++T,u),T<=s&&(l=T+1),s<=T&&(u=T-1)}}function e(o,s,l){var u=o[s];o[s]=o[l],o[l]=u}function n(o,s){return o<s?-1:o>s?1:0}return function(o,s,l,u,d){t(o,s,l||0,u||o.length-1,d||n)}}();var $d=Ve(Ud.exports);function iy(t){let e=0;for(let n,o,s=0,l=t.length,u=l-1;s<l;u=s++)n=t[s],o=t[u],e+=(o.x-n.x)*(n.y+o.y);return e}function Cu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Hd(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function tw(t,e,n){let o=t[0]-e[0],s=t[1]-e[1],l=t[0]-n[0],u=t[1]-n[1];return o*u-l*s==0&&o*l<=0&&s*u<=0}function Dc(t,e,n=!1){let o=!1;for(let d=0,f=e.length;d<f;d++){let p=e[d];for(let g=0,_=p.length,v=_-1;g<_;v=g++){let x=p[v],b=p[g];if(tw(t,x,b))return n;(l=x)[1]>(s=t)[1]!=(u=b)[1]>s[1]&&s[0]<(u[0]-l[0])*(s[1]-l[1])/(u[1]-l[1])+l[0]&&(o=!o)}}var s,l,u;return o}function Mm(t,e,n,o){let s=o[0]-n[0],l=o[1]-n[1],u=(t[0]-n[0])*l-s*(t[1]-n[1]),d=(e[0]-n[0])*l-s*(e[1]-n[1]);return u>0&&d<0||u<0&&d>0}function Ac(t,e,n,o){return(s=[o[0]-n[0],o[1]-n[1]])[0]*(l=[e[0]-t[0],e[1]-t[1]])[1]-s[1]*l[0]!=0&&!(!Mm(t,e,n,o)||!Mm(n,o,t,e));var s,l}let Cs=8192;function nw(t,e){let n=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(n*s*Cs),Math.round(o*s*Cs)]}function Hl(t,e){for(let n=0;n<e.length;n++)if(Dc(t,e[n]))return!0;return!1}function iw(t,e,n){for(let o of n)for(let s=0,l=o.length,u=l-1;s<l;u=s++)if(Ac(t,e,o[u],o[s]))return!0;return!1}function Gl(t,e){for(let n=0;n<t.length;++n)if(!Dc(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(iw(t[n],t[n+1],e))return!1;return!0}function ry(t,e){for(let n=0;n<e.length;n++)if(Gl(t,e[n]))return!0;return!1}function Im(t,e,n){let o=[];for(let s=0;s<t.length;s++){let l=[];for(let u=0;u<t[s].length;u++){let d=nw(t[s][u],n);Cu(e,d),l.push(d)}o.push(l)}return o}function Gd(t,e,n){let o=[];for(let s=0;s<t.length;s++){let l=Im(t[s],e,n);o.push(l)}return o}function If(t,e,n,o){if(t[0]<n[0]||t[0]>n[2]){let s=.5*o,l=t[0]-n[0]>s?-o:n[0]-t[0]>s?o:0;l===0&&(l=t[0]-n[2]>s?-o:n[2]-t[0]>s?o:0),t[0]+=l}Cu(e,t)}function Cm(t,e,n,o){let s=Math.pow(2,o.z)*Cs,l=[o.x*Cs,o.y*Cs],u=[];if(!t)return u;for(let d of t)for(let f of d){let p=[f.x+l[0],f.y+l[1]];If(p,e,n,s),u.push(p)}return u}function Sm(t,e,n,o){let s=Math.pow(2,o.z)*Cs,l=[o.x*Cs,o.y*Cs],u=[];if(!t)return u;for(let f of t){let p=[];for(let g of f){let _=[g.x+l[0],g.y+l[1]];Cu(e,_),p.push(_)}u.push(p)}if(e[2]-e[0]<=s/2){(d=e)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(let f of u)for(let p of f)If(p,e,n,s)}var d;return u}class Su{constructor(e,n){this.type=Sn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Iu(e[1])){let o=e[1];if(o.type==="FeatureCollection")for(let s=0;s<o.features.length;++s){let l=o.features[s].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Su(o,o.features[s].geometry)}else if(o.type==="Feature"){let s=o.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new Su(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Su(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){let s=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],u=n.canonicalID();if(!u)return!1;if(o.type==="Polygon"){let d=Im(o.coordinates,l,u),f=Cm(n.geometry(),s,l,u);if(!Hd(s,l))return!1;for(let p of f)if(!Dc(p,d))return!1}if(o.type==="MultiPolygon"){let d=Gd(o.coordinates,l,u),f=Cm(n.geometry(),s,l,u);if(!Hd(s,l))return!1;for(let p of f)if(!Hl(p,d))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){let s=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],u=n.canonicalID();if(!u)return!1;if(o.type==="Polygon"){let d=Im(o.coordinates,l,u),f=Sm(n.geometry(),s,l,u);if(!Hd(s,l))return!1;for(let p of f)if(!Gl(p,d))return!1}if(o.type==="MultiPolygon"){let d=Gd(o.coordinates,l,u),f=Sm(n.geometry(),s,l,u);if(!Hd(s,l))return!1;for(let p of f)if(!ry(p,d))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Pc=Su,Dm={exports:{}};Dm.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),o=Math.PI/180,s=function(p,g){if(p===void 0)throw new Error("No latitude given.");if(g&&!t[g])throw new Error("Unknown unit "+g+". Use one of: "+Object.keys(t).join(", "));var _=6378.137*o*(g?t[g]:1),v=Math.cos(p*o),x=1/(1-n*(1-v*v)),b=Math.sqrt(x);this.kx=_*b*v,this.ky=_*b*x*(1-n)},l={units:{configurable:!0}};function u(p,g){return p[0]===g[0]&&p[1]===g[1]}function d(p,g,_){var v=f(g[0]-p[0]);return[p[0]+v*_,p[1]+(g[1]-p[1])*_]}function f(p){for(;p<-180;)p+=360;for(;p>180;)p-=360;return p}return s.fromTile=function(p,g,_){var v=Math.PI*(1-2*(p+.5)/Math.pow(2,g)),x=Math.atan(.5*(Math.exp(v)-Math.exp(-v)))/o;return new s(x,_)},l.units.get=function(){return t},s.prototype.distance=function(p,g){var _=f(p[0]-g[0])*this.kx,v=(p[1]-g[1])*this.ky;return Math.sqrt(_*_+v*v)},s.prototype.bearing=function(p,g){var _=f(g[0]-p[0])*this.kx;return Math.atan2(_,(g[1]-p[1])*this.ky)/o},s.prototype.destination=function(p,g,_){var v=_*o;return this.offset(p,Math.sin(v)*g,Math.cos(v)*g)},s.prototype.offset=function(p,g,_){return[p[0]+g/this.kx,p[1]+_/this.ky]},s.prototype.lineDistance=function(p){for(var g=0,_=0;_<p.length-1;_++)g+=this.distance(p[_],p[_+1]);return g},s.prototype.area=function(p){for(var g=0,_=0;_<p.length;_++)for(var v=p[_],x=0,b=v.length,T=b-1;x<b;T=x++)g+=f(v[x][0]-v[T][0])*(v[x][1]+v[T][1])*(_?-1:1);return Math.abs(g)/2*this.kx*this.ky},s.prototype.along=function(p,g){var _=0;if(g<=0)return p[0];for(var v=0;v<p.length-1;v++){var x=p[v],b=p[v+1],T=this.distance(x,b);if((_+=T)>g)return d(x,b,(g-(_-T))/T)}return p[p.length-1]},s.prototype.pointToSegmentDistance=function(p,g,_){var v=g[0],x=g[1],b=f(_[0]-v)*this.kx,T=(_[1]-x)*this.ky,E=0;return b===0&&T===0||((E=(f(p[0]-v)*this.kx*b+(p[1]-x)*this.ky*T)/(b*b+T*T))>1?(v=_[0],x=_[1]):E>0&&(v+=b/this.kx*E,x+=T/this.ky*E)),b=f(p[0]-v)*this.kx,T=(p[1]-x)*this.ky,Math.sqrt(b*b+T*T)},s.prototype.pointOnLine=function(p,g){for(var _,v,x,b,T=1/0,E=0;E<p.length-1;E++){var M=p[E][0],S=p[E][1],P=f(p[E+1][0]-M)*this.kx,O=(p[E+1][1]-S)*this.ky,A=0;P===0&&O===0||((A=(f(g[0]-M)*this.kx*P+(g[1]-S)*this.ky*O)/(P*P+O*O))>1?(M=p[E+1][0],S=p[E+1][1]):A>0&&(M+=P/this.kx*A,S+=O/this.ky*A));var R=(P=f(g[0]-M)*this.kx)*P+(O=(g[1]-S)*this.ky)*O;R<T&&(T=R,_=M,v=S,x=E,b=A)}return{point:[_,v],index:x,t:Math.max(0,Math.min(1,b))}},s.prototype.lineSlice=function(p,g,_){var v=this.pointOnLine(_,p),x=this.pointOnLine(_,g);if(v.index>x.index||v.index===x.index&&v.t>x.t){var b=v;v=x,x=b}var T=[v.point],E=v.index+1,M=x.index;!u(_[E],T[0])&&E<=M&&T.push(_[E]);for(var S=E+1;S<=M;S++)T.push(_[S]);return u(_[M],x.point)||T.push(x.point),T},s.prototype.lineSliceAlong=function(p,g,_){for(var v=0,x=[],b=0;b<_.length-1;b++){var T=_[b],E=_[b+1],M=this.distance(T,E);if((v+=M)>p&&x.length===0&&x.push(d(T,E,(p-(v-M))/M)),v>=g)return x.push(d(T,E,(g-(v-M))/M)),x;v>p&&x.push(E)}return x},s.prototype.bufferPoint=function(p,g){var _=g/this.ky,v=g/this.kx;return[p[0]-v,p[1]-_,p[0]+v,p[1]+_]},s.prototype.bufferBBox=function(p,g){var _=g/this.ky,v=g/this.kx;return[p[0]-v,p[1]-_,p[2]+v,p[3]+_]},s.prototype.insideBBox=function(p,g){return f(p[0]-g[0])>=0&&f(p[0]-g[2])<=0&&p[1]>=g[1]&&p[1]<=g[3]},Object.defineProperties(s,l),s}();var Am=Ve(Dm.exports),ye={exports:{}};ye.exports=function(){var t=function(n,o){if(n===void 0&&(n=[]),o===void 0&&(o=e),this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function e(n,o){return n<o?-1:n>o?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var n=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var o=this.data,s=this.compare,l=o[n];n>0;){var u=n-1>>1,d=o[u];if(s(l,d)>=0)break;o[n]=d,n=u}o[n]=l},t.prototype._down=function(n){for(var o=this.data,s=this.compare,l=this.length>>1,u=o[n];n<l;){var d=1+(n<<1),f=o[d],p=d+1;if(p<this.length&&s(o[p],f)<0&&(d=p,f=o[p]),s(f,u)>=0)break;o[n]=f,n=d}o[n]=u},t}();var Oe=Ve(ye.exports),ne=8192;function sn(t,e){return e.dist-t.dist}let _r=100,gi=50;function Gr(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Wr(t){return t[1]-t[0]+1}function Io(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function so(t,e){if(t[0]>t[1])return[null,null];let n=Wr(t);if(e){if(n===2)return[t,null];let o=Math.floor(n/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(n===1)return[t,null];let o=Math.floor(n/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function Dr(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Io(e,t.length))return n;for(let o=e[0];o<=e[1];++o)Cu(n,t[o]);return n}function Ss(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let o=0;o<t[n].length;++o)Cu(e,t[n][o]);return e}function ps(t,e,n){if(Gr(t)||Gr(e))return NaN;let o=0,s=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(s=t[1]-e[3]),t[3]<e[1]&&(s=e[1]-t[3]),n.distance([0,0],[o,s])}function Ho(t,e){let n=Math.pow(2,e.z);return[(s=(t.x/ne+e.x)/n,360*s-180),(o=(t.y/ne+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,s}function ll(t,e){let n=[];for(let o=0;o<t.length;++o)n.push(Ho(t[o],e));return n}function Oc(t,e,n){let o=n.pointOnLine(e,t).point;return n.distance(t,o)}function Wd(t,e,n,o,s){let l=n.slice(o[0],o[1]+1),u=1/0;for(let d=e[0];d<=e[1];++d)if((u=Math.min(u,Oc(t[d],l,s)))===0)return 0;return u}function Wl(t,e,n,o,s){let l=Math.min(s.pointToSegmentDistance(t,n,o),s.pointToSegmentDistance(e,n,o)),u=Math.min(s.pointToSegmentDistance(n,t,e),s.pointToSegmentDistance(o,t,e));return Math.min(l,u)}function qd(t,e,n,o,s){if(!Io(e,t.length)||!Io(o,n.length))return NaN;let l=1/0;for(let u=e[0];u<e[1];++u)for(let d=o[0];d<o[1];++d){if(Ac(t[u],t[u+1],n[d],n[d+1]))return 0;l=Math.min(l,Wl(t[u],t[u+1],n[d],n[d+1],s))}return l}function oy(t,e,n,o,s){if(!Io(e,t.length)||!Io(o,n.length))return NaN;let l=1/0;for(let u=e[0];u<=e[1];++u)for(let d=o[0];d<=o[1];++d)if((l=Math.min(l,s.distance(t[u],n[d])))===0)return l;return l}function rw(t,e,n){if(Dc(t,e,!0))return 0;let o=1/0;for(let s of e){let l=s.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(s[0]!==s[l-1]&&(o=Math.min(o,n.pointToSegmentDistance(t,s[l-1],s[0])))===0||(o=Math.min(o,Oc(t,s,n)))===0)return o}return o}function ow(t,e,n,o){if(!Io(e,t.length))return NaN;for(let l=e[0];l<=e[1];++l)if(Dc(t[l],n,!0))return 0;let s=1/0;for(let l=e[0];l<e[1];++l)for(let u of n)for(let d=0,f=u.length,p=f-1;d<f;p=d++){if(Ac(t[l],t[l+1],u[p],u[d]))return 0;s=Math.min(s,Wl(t[l],t[l+1],u[p],u[d],o))}return s}function cr(t,e){for(let n of t)for(let o=0;o<=n.length-1;++o)if(Dc(n[o],e,!0))return!0;return!1}function nr(t,e,n,o=1/0){let s=Ss(t),l=Ss(e);if(o!==1/0&&ps(s,l,n)>=o)return o;if(Hd(s,l)){if(cr(t,e))return 0}else if(cr(e,t))return 0;let u=o;for(let d of t)for(let f=0,p=d.length,g=p-1;f<p;g=f++)for(let _ of e)for(let v=0,x=_.length,b=x-1;v<x;b=v++){if(Ac(d[g],d[f],_[b],_[v]))return 0;u=Math.min(u,Wl(d[g],d[f],_[b],_[v],n))}return u}function Rc(t,e,n,o,s,l,u){if(l===null||u===null)return;let d=ps(Dr(o,l),Dr(s,u),n);d<e&&t.push({dist:d,range1:l,range2:u})}function ql(t,e,n,o,s=1/0){let l=Math.min(o.distance(t[0],n[0][0]),s);if(l===0)return l;let u=new Oe([{dist:0,range1:[0,t.length-1],range2:[0,0]}],sn),d=e?gi:_r,f=Ss(n);for(;u.length;){let p=u.pop();if(p.dist>=l)continue;let g=p.range1;if(Wr(g)<=d){if(!Io(g,t.length))return NaN;if(e){let _=ow(t,g,n,o);if((l=Math.min(l,_))===0)return l}else for(let _=g[0];_<=g[1];++_){let v=rw(t[_],n,o);if((l=Math.min(l,v))===0)return l}}else{let _=so(g,e);if(_[0]!==null){let v=ps(Dr(t,_[0]),f,o);v<l&&u.push({dist:v,range1:_[0],range2:[0,0]})}if(_[1]!==null){let v=ps(Dr(t,_[1]),f,o);v<l&&u.push({dist:v,range1:_[1],range2:[0,0]})}}}return l}function Cf(t,e,n,o,s,l=1/0){let u=Math.min(l,s.distance(t[0],n[0]));if(u===0)return u;let d=new Oe([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],sn),f=e?gi:_r,p=o?gi:_r;for(;d.length;){let g=d.pop();if(g.dist>=u)continue;let _=g.range1,v=g.range2;if(Wr(_)<=f&&Wr(v)<=p){if(!Io(_,t.length)||!Io(v,n.length))return NaN;if(e&&o?u=Math.min(u,qd(t,_,n,v,s)):e||o?e&&!o?u=Math.min(u,Wd(n,v,t,_,s)):!e&&o&&(u=Math.min(u,Wd(t,_,n,v,s))):u=Math.min(u,oy(t,_,n,v,s)),u===0)return u}else{let x=so(_,e),b=so(v,o);Rc(d,u,s,t,n,x[0],b[0]),Rc(d,u,s,t,n,x[0],b[1]),Rc(d,u,s,t,n,x[1],b[0]),Rc(d,u,s,t,n,x[1],b[1])}}return u}function ms(t,e,n,o,s=1/0){let l=s,u=Dr(t,[0,t.length-1]);for(let d of n)if(!(l!==1/0&&ps(u,Dr(d,[0,d.length-1]),o)>=l)&&(l=Math.min(l,Cf(t,e,d,!0,o,l)),l===0))return l;return l}function Vs(t,e,n,o,s=1/0){let l=s,u=Dr(t,[0,t.length-1]);for(let d of n){if(l!==1/0&&ps(u,Ss(d),o)>=l)continue;let f=ql(t,e,d,o,l);if(isNaN(f))return f;if((l=Math.min(l,f))===0)return l}return l}function Na(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class cl{constructor(e,n){this.type=Ze,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Iu(e[1])){let o=e[1];if(o.type==="FeatureCollection"){for(let s=0;s<o.features.length;++s)if(Na(o.features[s].geometry.type))return new cl(o,o.features[s].geometry)}else if(o.type==="Feature"){if(Na(o.geometry.type))return new cl(o,o.geometry)}else if(Na(o.type))return new cl(o,o)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),o=e.canonicalID();if(n!=null&&o!=null){if(e.geometryType()==="Point")return function(s,l,u){let d=[];for(let p of s)for(let g of p)d.push(Ho(g,l));let f=new Am(d[0][1],"meters");return u.type==="Point"||u.type==="MultiPoint"||u.type==="LineString"?Cf(d,!1,u.type==="Point"?[u.coordinates]:u.coordinates,u.type==="LineString",f):u.type==="MultiLineString"?ms(d,!1,u.coordinates,f):u.type==="Polygon"||u.type==="MultiPolygon"?Vs(d,!1,u.type==="Polygon"?[u.coordinates]:u.coordinates,f):null}(n,o,this.geometries);if(e.geometryType()==="LineString")return function(s,l,u){let d=[];for(let p of s){let g=[];for(let _ of p)g.push(Ho(_,l));d.push(g)}let f=new Am(d[0][0][1],"meters");if(u.type==="Point"||u.type==="MultiPoint"||u.type==="LineString")return ms(u.type==="Point"?[u.coordinates]:u.coordinates,u.type==="LineString",d,f);if(u.type==="MultiLineString"){let p=1/0;for(let g=0;g<u.coordinates.length;g++){let _=ms(u.coordinates[g],!0,d,f,p);if(isNaN(_))return _;if((p=Math.min(p,_))===0)return p}return p}if(u.type==="Polygon"||u.type==="MultiPolygon"){let p=1/0;for(let g=0;g<d.length;g++){let _=Vs(d[g],!0,u.type==="Polygon"?[u.coordinates]:u.coordinates,f,p);if(isNaN(_))return _;if((p=Math.min(p,_))===0)return p}return p}return null}(n,o,this.geometries);if(e.geometryType()==="Polygon")return function(s,l,u){let d=[];for(let p of function(g,_){let v=g.length;if(v<=1)return[g];let x=[],b,T;for(let E=0;E<v;E++){let M=iy(g[E]);M!==0&&(g[E].area=Math.abs(M),T===void 0&&(T=M<0),T===M<0?(b&&x.push(b),b=[g[E]]):b.push(g[E]))}return b&&x.push(b),x}(s)){let g=[];for(let _=0;_<p.length;++_)g.push(ll(p[_],l));d.push(g)}let f=new Am(d[0][0][0][1],"meters");if(u.type==="Point"||u.type==="MultiPoint"||u.type==="LineString")return Vs(u.type==="Point"?[u.coordinates]:u.coordinates,u.type==="LineString",d,f);if(u.type==="MultiLineString"){let p=1/0;for(let g=0;g<u.coordinates.length;g++){let _=Vs(u.coordinates[g],!0,d,f,p);if(isNaN(_))return _;if((p=Math.min(p,_))===0)return p}return p}return u.type==="Polygon"||u.type==="MultiPolygon"?function(p,g,_){let v=1/0;for(let x of p)for(let b of g){let T=nr(x,b,_,v);if(isNaN(T))return T;if((v=Math.min(v,T))===0)return v}return v}(u.type==="Polygon"?[u.coordinates]:u.coordinates,d,f):null}(n,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Du=cl;function da(t){if(t instanceof $o&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Pc||t instanceof Du)return!1;let e=!0;return t.eachChild(n=>{e&&!da(n)&&(e=!1)}),e}function ha(t){if(t instanceof $o&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!ha(n)&&(e=!1)}),e}function Sf(t){if(t instanceof $o&&t.name==="config")return!1;let e=!0;return t.eachChild(n=>{e&&!Sf(n)&&(e=!1)}),e}function ul(t,e){if(t instanceof $o&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(o=>{n&&!ul(o,e)&&(n=!1)}),n}class Zd{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let o=e[1];return n.scope.has(o)?new Zd(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Yd=Zd;class Au{constructor(e,n=[],o,s=new lr,l=[],u){this.registry=e,this.path=n,this.key=n.map(d=>`[${d}]`).join(""),this.scope=s,this.errors=l,this.expectedType=o,this.options=u}parse(e,n,o,s,l={}){return n||o?this.concat(n,o,s)._parse(e,l):this._parse(e,l)}_parse(e,n){function o(s,l,u){return u==="assert"?new sl(l,[s]):u==="coerce"?new al(l,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let s=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(s){let l=s.parse(e,this);if(!l)return null;if(this.expectedType){let u=this.expectedType,d=l.type;if(u.kind!=="string"&&u.kind!=="number"&&u.kind!=="boolean"&&u.kind!=="object"&&u.kind!=="array"||d.kind!=="value")if(u.kind!=="color"&&u.kind!=="formatted"&&u.kind!=="resolvedImage"||d.kind!=="value"&&d.kind!=="string"){if(this.checkSubtype(u,d))return null}else l=o(l,u,n.typeAnnotation||"coerce");else l=o(l,u,n.typeAnnotation||"assert")}if(!(l instanceof Ic)&&l.type.kind!=="resolvedImage"&&Pu(l)){let u=new ka(this.options);try{l=new Ic(l.type,l.evaluate(u))}catch(d){return this.error(d.message),null}}return l}return al.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){let s=typeof e=="number"?this.path.concat(e):this.path,l=o?this.scope.concat(o):this.scope;return new Au(this.registry,s,n||null,l,this.errors,this.options)}error(e,...n){let o=`${this.key}${n.map(s=>`[${s}]`).join("")}`;this.errors.push(new $e(o,e))}checkSubtype(e,n){let o=kd(e,n);return o&&this.error(o),o}}var Pm=Au;function Pu(t){if(t instanceof Yd)return Pu(t.boundExpression);if(t instanceof $o&&t.name==="error"||t instanceof $o&&t.name==="config"||t instanceof Mf||t instanceof Pc||t instanceof Du)return!1;let e=t instanceof al||t instanceof sl,n=!0;return t.eachChild(o=>{n=e?n&&Pu(o):n&&o instanceof Ic}),!!n&&da(t)&&ul(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Lc(t,e){let n=t.length-1,o,s,l=0,u=n,d=0;for(;l<=u;)if(d=Math.floor((l+u)/2),o=t[d],s=t[d+1],o<=e){if(d===n||e<s)return d;l=d+1}else{if(!(o>e))throw new Xr("Input is not a number.");u=d-1}return 0}class sw{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[s,l]of o)this.labels.push(s),this.outputs.push(l)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let o=n.parse(e[1],1,Ze);if(!o)return null;let s=[],l=null;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);for(let u=1;u<e.length;u+=2){let d=u===1?-1/0:e[u],f=e[u+1],p=u,g=u+1;if(typeof d!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(s.length&&s[s.length-1][0]>=d)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',p);let _=n.parse(f,g,l);if(!_)return null;l=l||_.type,s.push([d,_])}return new sw(l,o,s)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let s=this.input.evaluate(e);if(s<=n[0])return o[0].evaluate(e);let l=n.length;return s>=n[l-1]?o[l-1].evaluate(e):o[Lc(n,s)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var aw=sw;function Yt(t,e,n){return t*(1-n)+e*n}function NA(t,e,n){return t.map((o,s)=>Yt(o,e[s],n))}var sy=Object.freeze({__proto__:null,array:NA,color:function(t,e,n){return new tn(Yt(t.r,e.r,n),Yt(t.g,e.g,n),Yt(t.b,e.b,n),Yt(t.a,e.a,n))},number:Yt});let zA=.95047,BA=1.08883,jA=4/29,Df=6/29,VA=3*Df*Df,H$=Df*Df*Df,G$=Math.PI/180,W$=180/Math.PI;function lw(t){return t>H$?Math.pow(t,1/3):t/VA+jA}function cw(t){return t>Df?t*t*t:VA*(t-jA)}function uw(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function dw(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function UA(t){let e=dw(t.r),n=dw(t.g),o=dw(t.b),s=lw((.4124564*e+.3575761*n+.1804375*o)/zA),l=lw((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*l-16,a:500*(s-l),b:200*(l-lw((.0193339*e+.119192*n+.9503041*o)/BA)),alpha:t.a}}function $A(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*cw(e),n=zA*cw(n),o=BA*cw(o),new tn(uw(3.2404542*n-1.5371385*e-.4985314*o),uw(-.969266*n+1.8760108*e+.041556*o),uw(.0556434*n-.2040259*e+1.0572252*o),t.alpha)}function q$(t,e,n){let o=e-t;return t+n*(o>180||o<-180?o-360*Math.round(o/360):o)}let Om={forward:UA,reverse:$A,interpolate:function(t,e,n){return{l:Yt(t.l,e.l,n),a:Yt(t.a,e.a,n),b:Yt(t.b,e.b,n),alpha:Yt(t.alpha,e.alpha,n)}}},Rm={forward:function(t){let{l:e,a:n,b:o}=UA(t),s=Math.atan2(o,n)*W$;return{h:s<0?s+360:s,c:Math.sqrt(n*n+o*o),l:e,alpha:t.a}},reverse:function(t){let e=t.h*G$,n=t.c;return $A({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:q$(t.h,e.h,n),c:Yt(t.c,e.c,n),l:Yt(t.l,e.l,n),alpha:Yt(t.alpha,e.alpha,n)}}};var HA=Object.freeze({__proto__:null,hcl:Rm,lab:Om});class ay{constructor(e,n,o,s,l){this.type=e,this.operator=n,this.interpolation=o,this.input=s,this.labels=[],this.outputs=[];for(let[u,d]of l)this.labels.push(u),this.outputs.push(d)}static interpolationFactor(e,n,o,s){let l=0;if(e.name==="exponential")l=hw(n,e.base,o,s);else if(e.name==="linear")l=hw(n,1,o,s);else if(e.name==="cubic-bezier"){let u=e.controlPoints;l=new Qt(u[0],u[1],u[2],u[3]).solve(hw(n,1,o,s))}return l}static parse(e,n){let[o,s,l,...u]=e;if(!Array.isArray(s)||s.length===0)return n.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){let p=s[1];if(typeof p!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:p}}else{if(s[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(s[0])}`,1,0);{let p=s.slice(1);if(p.length!==4||p.some(g=>typeof g!="number"||g<0||g>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:p}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(l=n.parse(l,2,Ze),!l)return null;let d=[],f=null;o==="interpolate-hcl"||o==="interpolate-lab"?f=fo:n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let p=0;p<u.length;p+=2){let g=u[p],_=u[p+1],v=p+3,x=p+4;if(typeof g!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(d.length&&d[d.length-1][0]>=g)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',v);let b=n.parse(_,x,f);if(!b)return null;f=f||b.type,d.push([g,b])}return f.kind==="number"||f.kind==="color"||f.kind==="array"&&f.itemType.kind==="number"&&typeof f.N=="number"?new ay(f,o,s,l,d):n.error(`Type ${Sr(f)} is not interpolatable.`)}evaluate(e){let n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);let s=this.input.evaluate(e);if(s<=n[0])return o[0].evaluate(e);let l=n.length;if(s>=n[l-1])return o[l-1].evaluate(e);let u=Lc(n,s),d=ay.interpolationFactor(this.interpolation,s,n[u],n[u+1]),f=o[u].evaluate(e),p=o[u+1].evaluate(e);return this.operator==="interpolate"?sy[this.type.kind.toLowerCase()](f,p,d):this.operator==="interpolate-hcl"?Rm.reverse(Rm.interpolate(Rm.forward(f),Rm.forward(p),d)):Om.reverse(Om.interpolate(Om.forward(f),Om.forward(p),d))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function hw(t,e,n,o){let s=o-n,l=t-n;return s===0?0:e===1?l/s:(Math.pow(e,l)-1)/(Math.pow(e,s)-1)}var Zl=ay;class fw{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null,s=n.expectedType;s&&s.kind!=="value"&&(o=s);let l=[];for(let d of e.slice(1)){let f=n.parse(d,1+l.length,o,void 0,{typeAnnotation:"omit"});if(!f)return null;o=o||f.type,l.push(f)}let u=s&&l.some(d=>kd(s,d.type));return new fw(u?Ln:o,l)}evaluate(e){let n,o=null,s=0;for(let l of this.args){if(s++,o=l.evaluate(e),o&&o instanceof No&&!o.available&&(n||(n=o),o=null,s===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var GA=fw;class pw{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let l=1;l<e.length-1;l+=2){let u=e[l];if(typeof u!="string")return n.error(`Expected string, but found ${typeof u} instead.`,l);if(/[^a-zA-Z0-9_]/.test(u))return n.error("Variable names must contain only alphanumeric characters or '_'.",l);let d=n.parse(e[l+1],l+1);if(!d)return null;o.push([u,d])}let s=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return s?new pw(o,s):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}var WA=pw;class mw{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,Ze),s=n.parse(e[2],2,is(n.expectedType||Ln));return o&&s?new mw(s.type.itemType,o,s):null}evaluate(e){let n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Xr(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Xr(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Xr(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Z$=mw;class gw{constructor(e,n){this.type=Sn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,Ln),s=n.parse(e[2],2,Ln);return o&&s?bm(o.type,[Sn,Jt,Ze,Wi,Ln])?new gw(o,s):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(o.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!$l(n,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(oo(n))} instead.`);if(!$l(o,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${Sr(oo(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Y$=gw;class ly{constructor(e,n,o){this.type=Ze,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,Ln),s=n.parse(e[2],2,Ln);if(!o||!s)return null;if(!bm(o.type,[Sn,Jt,Ze,Wi,Ln]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(o.type)} instead`);if(e.length===4){let l=n.parse(e[3],3,Ze);return l?new ly(o,s,l):null}return new ly(o,s)}evaluate(e){let n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!$l(n,["boolean","string","number","null"]))throw new Xr(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(oo(n))} instead.`);if(!$l(o,["string","array"]))throw new Xr(`Expected second argument to be of type array or string, but found ${Sr(oo(o))} instead.`);if(this.fromIndex){let s=this.fromIndex.evaluate(e);return o.indexOf(n,s)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var X$=ly;class _w{constructor(e,n,o,s,l,u){this.inputType=e,this.type=n,this.input=o,this.cases=s,this.outputs=l,this.otherwise=u}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);let l={},u=[];for(let p=2;p<e.length-1;p+=2){let g=e[p],_=e[p+1];Array.isArray(g)||(g=[g]);let v=n.concat(p);if(g.length===0)return v.error("Expected at least one branch label.");for(let b of g){if(typeof b!="number"&&typeof b!="string")return v.error("Branch labels must be numbers or strings.");if(typeof b=="number"&&Math.abs(b)>Number.MAX_SAFE_INTEGER)return v.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof b=="number"&&Math.floor(b)!==b)return v.error("Numeric branch labels must be integer values.");if(o){if(v.checkSubtype(o,oo(b)))return null}else o=oo(b);if(l[String(b)]!==void 0)return v.error("Branch labels must be unique.");l[String(b)]=u.length}let x=n.parse(_,p,s);if(!x)return null;s=s||x.type,u.push(x)}let d=n.parse(e[1],1,Ln);if(!d)return null;let f=n.parse(e[e.length-1],e.length-1,s);return f?d.type.kind!=="value"&&n.concat(1).checkSubtype(o,d.type)?null:new _w(o,s,d,l,u,f):null}evaluate(e){let n=this.input.evaluate(e);return(oo(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],s={};for(let u of n){let d=s[this.cases[u]];d===void 0?(s[this.cases[u]]=o.length,o.push([this.cases[u],[u]])):o[d][1].push(u)}let l=u=>this.inputType.kind==="number"?Number(u):u;for(let[u,d]of o)e.push(d.length===1?l(d[0]):d.map(l)),e.push(this.outputs[u].serialize());return e.push(this.otherwise.serialize()),e}}var K$=_w;class yw{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);let s=[];for(let u=1;u<e.length-1;u+=2){let d=n.parse(e[u],u,Sn);if(!d)return null;let f=n.parse(e[u+1],u+1,o);if(!f)return null;s.push([d,f]),o=o||f.type}let l=n.parse(e[e.length-1],e.length-1,o);return l?new yw(o,s,l):null}evaluate(e){for(let[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var J$=yw;class cy{constructor(e,n,o,s){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=n.parse(e[1],1,Ln),s=n.parse(e[2],2,Ze);if(!o||!s)return null;if(!bm(o.type,[is(Ln),Jt,Ln]))return n.error(`Expected first argument to be of type array or string, but found ${Sr(o.type)} instead`);if(e.length===4){let l=n.parse(e[3],3,Ze);return l?new cy(o.type,o,s,l):null}return new cy(o.type,o,s)}evaluate(e){let n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!$l(n,["string","array"]))throw new Xr(`Expected first argument to be of type array or string, but found ${Sr(oo(n))} instead.`);if(this.endIndex){let s=this.endIndex.evaluate(e);return n.slice(o,s)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Q$=cy;function qA(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ZA(t,e,n,o){return o.compare(e,n)===0}function Af(t,e,n){let o=t!=="=="&&t!=="!=";return class T${constructor(l,u,d){this.type=Sn,this.lhs=l,this.rhs=u,this.collator=d,this.hasUntypedArgument=l.type.kind==="value"||u.type.kind==="value"}static parse(l,u){if(l.length!==3&&l.length!==4)return u.error("Expected two or three arguments.");let d=l[0],f=u.parse(l[1],1,Ln);if(!f)return null;if(!qA(d,f.type))return u.concat(1).error(`"${d}" comparisons are not supported for type '${Sr(f.type)}'.`);let p=u.parse(l[2],2,Ln);if(!p)return null;if(!qA(d,p.type))return u.concat(2).error(`"${d}" comparisons are not supported for type '${Sr(p.type)}'.`);if(f.type.kind!==p.type.kind&&f.type.kind!=="value"&&p.type.kind!=="value")return u.error(`Cannot compare types '${Sr(f.type)}' and '${Sr(p.type)}'.`);o&&(f.type.kind==="value"&&p.type.kind!=="value"?f=new sl(p.type,[f]):f.type.kind!=="value"&&p.type.kind==="value"&&(p=new sl(f.type,[p])));let g=null;if(l.length===4){if(f.type.kind!=="string"&&p.type.kind!=="string"&&f.type.kind!=="value"&&p.type.kind!=="value")return u.error("Cannot use collator to compare non-string types.");if(g=u.parse(l[3],3,Tc),!g)return null}return new T$(f,p,g)}evaluate(l){let u=this.lhs.evaluate(l),d=this.rhs.evaluate(l);if(o&&this.hasUntypedArgument){let f=oo(u),p=oo(d);if(f.kind!==p.kind||f.kind!=="string"&&f.kind!=="number")throw new Xr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${f.kind}, ${p.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let f=oo(u),p=oo(d);if(f.kind!=="string"||p.kind!=="string")return e(l,u,d)}return this.collator?n(l,u,d,this.collator.evaluate(l)):e(l,u,d)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){let l=[t];return this.eachChild(u=>{l.push(u.serialize())}),l}}}let e6=Af("==",function(t,e,n){return e===n},ZA),t6=Af("!=",function(t,e,n){return e!==n},function(t,e,n,o){return!ZA(0,e,n,o)}),n6=Af("<",function(t,e,n){return e<n},function(t,e,n,o){return o.compare(e,n)<0}),i6=Af(">",function(t,e,n){return e>n},function(t,e,n,o){return o.compare(e,n)>0}),r6=Af("<=",function(t,e,n){return e<=n},function(t,e,n,o){return o.compare(e,n)<=0}),o6=Af(">=",function(t,e,n){return e>=n},function(t,e,n,o){return o.compare(e,n)>=0});class vw{constructor(e,n,o,s,l,u){this.type=Jt,this.number=e,this.locale=n,this.currency=o,this.unit=s,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let o=n.parse(e[1],1,Ze);if(!o)return null;let s=e[2];if(typeof s!="object"||Array.isArray(s))return n.error("NumberFormat options argument must be an object.");let l=null;if(s.locale&&(l=n.parse(s.locale,1,Jt),!l))return null;let u=null;if(s.currency&&(u=n.parse(s.currency,1,Jt),!u))return null;let d=null;if(s.unit&&(d=n.parse(s.unit,1,Jt),!d))return null;let f=null;if(s["min-fraction-digits"]&&(f=n.parse(s["min-fraction-digits"],1,Ze),!f))return null;let p=null;return s["max-fraction-digits"]&&(p=n.parse(s["max-fraction-digits"],1,Ze),!p)?null:new vw(o,l,u,d,f,p)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class xw{constructor(e){this.type=Ze,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Sr(o.type)} instead.`):new xw(o):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Xr(`Expected value to be of type string or array, but found ${Sr(oo(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function bw(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let YA={"==":e6,"!=":t6,">":i6,"<":n6,">=":o6,"<=":r6,array:sl,at:Z$,boolean:sl,case:J$,coalesce:GA,collator:Mf,format:jd,image:Vd,in:Y$,"index-of":X$,interpolate:Zl,"interpolate-hcl":Zl,"interpolate-lab":Zl,length:xw,let:WA,literal:Ic,match:K$,number:sl,"number-format":vw,object:sl,slice:Q$,step:aw,string:sl,"to-boolean":al,"to-color":al,"to-number":al,"to-string":al,var:Yd,within:Pc,distance:Du};function XA(t,[e,n,o,s]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let l=s?s.evaluate(t):1,u=Em(e,n,o,l);if(u)throw new Xr(u);return new tn(e/255*l,n/255*l,o/255*l,l)}function KA(t,[e,n,o,s]){e=e.evaluate(t),n=n.evaluate(t),o=o.evaluate(t);let l=s?s.evaluate(t):1,u=function(p,g,_,v){return typeof p=="number"&&p>=0&&p<=360?typeof g=="number"&&g>=0&&g<=100&&typeof _=="number"&&_>=0&&_<=100?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:`Invalid hsla value [${[p,g,_,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof v=="number"?[p,g,_,v]:[p,g,_]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof v=="number"?[p,g,_,v]:[p,g,_]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,o,l);if(u)throw new Xr(u);let d=`hsla(${e}, ${n}%, ${o}%, ${l})`,f=tn.parse(d);if(!f)throw new Xr(`Failed to parse HSLA color: ${d}`);return f}function JA(t,e){return t in e}function ww(t,e){let n=e[t];return n===void 0?null:n}function QA(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return tn.parse(e)}return e}function eP(t,e,n,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}function tP(t,e,n){n.length&&(e+=`${n}`);let o=t.getConfig(e);if(!o)return null;let{type:s,value:l,values:u,minValue:d,maxValue:f,stepValue:p}=o,g=o.default.evaluate(t),_=l?l.evaluate(t):g;return s&&(_=QA(s,_)),l!==void 0&&_!==void 0&&u&&!u.includes(_)&&(_=g,s&&(_=QA(s,_))),_===void 0||d===void 0&&f===void 0&&p===void 0||(typeof _=="number"?_=eP(_,d,f,p):Array.isArray(_)&&(_=_.map(v=>typeof v=="number"?eP(v,d,f,p):v))),_}function Xd(t){return{type:t}}$o.register(YA,{error:[{kind:"error"},[Jt],(t,[e])=>{throw new Xr(e.evaluate(t))}],typeof:[Jt,[Ln],(t,[e])=>Sr(oo(e.evaluate(t)))],"to-rgba":[is(Ze,4),[fo],(t,[e])=>e.evaluate(t).toArray()],rgb:[fo,[Ze,Ze,Ze],XA],rgba:[fo,[Ze,Ze,Ze,Ze],XA],hsl:[fo,[Ze,Ze,Ze],KA],hsla:[fo,[Ze,Ze,Ze,Ze],KA],has:{type:Sn,overloads:[[[Jt],(t,[e])=>JA(e.evaluate(t),t.properties())],[[Jt,Yr],(t,[e,n])=>JA(e.evaluate(t),n.evaluate(t))]]},get:{type:Ln,overloads:[[[Jt],(t,[e])=>ww(e.evaluate(t),t.properties())],[[Jt,Yr],(t,[e,n])=>ww(e.evaluate(t),n.evaluate(t))]]},config:{type:Ln,overloads:[[[Jt],(t,[e])=>tP(t,e.evaluate(t),"")],[[Jt,Jt],(t,[e,n])=>tP(t,e.evaluate(t),n.evaluate(t))]]},"feature-state":[Ln,[Jt],(t,[e])=>ww(e.evaluate(t),t.featureState||{})],properties:[Yr,[],t=>t.properties()],"geometry-type":[Jt,[],t=>t.geometryType()],id:[Ln,[],t=>t.id()],zoom:[Ze,[],t=>t.globals.zoom],pitch:[Ze,[],t=>t.globals.pitch||0],"distance-from-center":[Ze,[],t=>t.distanceFromCenter()],"measure-light":[Ze,[Jt],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Ze,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ze,[],t=>t.globals.lineProgress||0],"raster-value":[Ze,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[Ze,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ln,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Ze,Xd(Ze),(t,e)=>{let n=0;for(let o of e)n+=o.evaluate(t);return n}],"*":[Ze,Xd(Ze),(t,e)=>{let n=1;for(let o of e)n*=o.evaluate(t);return n}],"-":{type:Ze,overloads:[[[Ze,Ze],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Ze],(t,[e])=>-e.evaluate(t)]]},"/":[Ze,[Ze,Ze],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Ze,[Ze,Ze],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Ze,[],()=>Math.LN2],pi:[Ze,[],()=>Math.PI],e:[Ze,[],()=>Math.E],"^":[Ze,[Ze,Ze],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Ze,[Ze],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ze,[Ze],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ze,[Ze],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ze,[Ze],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ze,[Ze],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ze,[Ze],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ze,[Ze],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ze,[Ze],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ze,[Ze],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ze,[Ze],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ze,Xd(Ze),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Ze,Xd(Ze),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Ze,[Ze],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ze,[Ze],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ze,[Ze],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ze,[Ze],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Sn,[Jt,Ln],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Sn,[Ln],(t,[e])=>t.id()===e.value],"filter-type-==":[Sn,[Jt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Sn,[Jt,Ln],(t,[e,n])=>{let o=t.properties()[e.value],s=n.value;return typeof o==typeof s&&o<s}],"filter-id-<":[Sn,[Ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[Sn,[Jt,Ln],(t,[e,n])=>{let o=t.properties()[e.value],s=n.value;return typeof o==typeof s&&o>s}],"filter-id->":[Sn,[Ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[Sn,[Jt,Ln],(t,[e,n])=>{let o=t.properties()[e.value],s=n.value;return typeof o==typeof s&&o<=s}],"filter-id-<=":[Sn,[Ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[Sn,[Jt,Ln],(t,[e,n])=>{let o=t.properties()[e.value],s=n.value;return typeof o==typeof s&&o>=s}],"filter-id->=":[Sn,[Ln],(t,[e])=>{let n=t.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[Sn,[Ln],(t,[e])=>e.value in t.properties()],"filter-has-id":[Sn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Sn,[is(Jt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Sn,[is(Ln)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Sn,[Jt,is(Ln)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Sn,[Jt,is(Ln)],(t,[e,n])=>function(o,s,l,u){for(;l<=u;){let d=l+u>>1;if(s[d]===o)return!0;s[d]>o?u=d-1:l=d+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Sn,overloads:[[[Sn,Sn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Xd(Sn),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Sn,overloads:[[[Sn,Sn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Xd(Sn),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Sn,[Sn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Sn,[Jt],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Jt,[Jt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Jt,[Jt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Jt,Xd(Ln),(t,e)=>e.map(n=>Ec(n.evaluate(t))).join("")],"resolved-locale":[Jt,[Tc],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Ze,[Ze,Ze,Ln],(t,e)=>{let[n,o,s]=e.map(u=>u.evaluate(t));if(n>o||n===o)return n;let l;if(typeof s=="string")l=function(u){let d=0;if(u.length===0)return d;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d&=d;return d}(s);else{if(typeof s!="number")throw new Xr(`Invalid seed input: ${s}`);l=s}return n+bw(l)()*(o-n)}]});var Lm=YA;function nP(t){return{result:"success",value:t}}function Kd(t){return{result:"error",value:t}}function iP(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Jd(t){return t["property-type"]==="data-driven"}function rP(t){return iP(t.expression,"measure-light")}function Tw(t){return iP(t.expression,"zoom")}function Ew(t){return!!t.expression&&t.expression.interpolated}function uy(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function s6(t){return t}function oP(t,e){let n=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",s=o||!(o||t.property!==void 0),l=t.type||(Ew(e)?"exponential":"interval");if(n&&((t=tr({},t)).stops&&(t.stops=t.stops.map(p=>[p[0],tn.parse(p[1])])),t.default=tn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!HA[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let u,d,f;if(l==="exponential")u=sP;else if(l==="interval")u=l6;else if(l==="categorical"){u=a6,d=Object.create(null);for(let p of t.stops)d[p[0]]=p[1];f=typeof t.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);u=c6}if(o){let p={},g=[];for(let x=0;x<t.stops.length;x++){let b=t.stops[x],T=b[0].zoom;p[T]===void 0&&(p[T]={zoom:T,type:t.type,property:t.property,default:t.default,stops:[]},g.push(T)),p[T].stops.push([b[0].value,b[1]])}let _=[];for(let x of g)_.push([p[x].zoom,oP(p[x],e)]);let v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:Zl.interpolationFactor.bind(void 0,v),zoomStops:_.map(x=>x[0]),evaluate:({zoom:x},b)=>sP({stops:_,base:t.base},e,x).evaluate(x,b)}}if(s){let p=l==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:p,interpolationFactor:Zl.interpolationFactor.bind(void 0,p),zoomStops:t.stops.map(g=>g[0]),evaluate:({zoom:g})=>u(t,e,g,d,f)}}return{kind:"source",evaluate(p,g){let _=g&&g.properties?g.properties[t.property]:void 0;return _===void 0?Fm(t.default,e.default):u(t,e,_,d,f)}}}function Fm(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function a6(t,e,n,o,s){return Fm(typeof n===s?o[n]:void 0,t.default,e.default)}function l6(t,e,n){if(ui(n)!=="number")return Fm(t.default,e.default);let o=t.stops.length;if(o===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[o-1][0])return t.stops[o-1][1];let s=Lc(t.stops.map(l=>l[0]),n);return t.stops[s][1]}function sP(t,e,n){let o=t.base!==void 0?t.base:1;if(ui(n)!=="number")return Fm(t.default,e.default);let s=t.stops.length;if(s===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];let l=Lc(t.stops.map(g=>g[0]),n),u=function(g,_,v,x){let b=x-v,T=g-v;return b===0?0:_===1?T/b:(Math.pow(_,T)-1)/(Math.pow(_,b)-1)}(n,o,t.stops[l][0],t.stops[l+1][0]),d=t.stops[l][1],f=t.stops[l+1][1],p=sy[e.type]||s6;if(t.colorSpace&&t.colorSpace!=="rgb"){let g=HA[t.colorSpace];p=(_,v)=>g.reverse(g.interpolate(g.forward(_),g.forward(v),u))}return typeof d.evaluate=="function"?{evaluate(...g){let _=d.evaluate.apply(void 0,g),v=f.evaluate.apply(void 0,g);if(_!==void 0&&v!==void 0)return p(_,v,u)}}:p(d,f,u)}function c6(t,e,n){return e.type==="color"?n=tn.parse(n):e.type==="formatted"?n=fs.fromString(n.toString()):e.type==="resolvedImage"?n=No.fromString(n.toString()):ui(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Fm(n,t.default,e.default)}class Mw{constructor(e,n,o){this.expression=e,this._warningHistory={},this._evaluator=new ka(o),this._defaultValue=n?function(s){return s.type==="color"&&(uy(s.default)||Array.isArray(s.default))?new tn(0,0,0,0):s.type==="color"?tn.parse(s.default)||null:s.default===void 0?null:s.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,s,l,u,d,f){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=s||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=u,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=f||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,s,l,u,d,f){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=u||null,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=f||null;try{let p=this.expression.evaluate(this._evaluator);if(p==null||typeof p=="number"&&p!=p)return this._defaultValue;if(this._enumValues&&!(p in this._enumValues))throw new Xr(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(p)} instead.`);return p}catch(p){return this._warningHistory[p.message]||(this._warningHistory[p.message]=!0,typeof console<"u"&&console.warn(p.message)),this._defaultValue}}}function dy(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Lm}function Ou(t,e,n){let o=new Pm(Lm,[],e?function(l){let u={color:fo,string:Jt,number:Ze,enum:Jt,boolean:Sn,formatted:Ld,resolvedImage:Fd};return l.type==="array"?is(u[l.value]||Ln,l.length):u[l.type]}(e):void 0,void 0,void 0,n),s=o.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?nP(new Mw(s,e,n)):Kd(o.errors)}class Iw{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!ha(n.expression),this.isConfigDependent=!Sf(n.expression)}evaluateWithoutErrorHandling(e,n,o,s,l,u){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,s,l,u)}evaluate(e,n,o,s,l,u){return this._styleExpression.evaluate(e,n,o,s,l,u)}}class Ru{constructor(e,n,o,s,l){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!ha(n.expression),this.isLightConstant=l,this.isConfigDependent=!Sf(n.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,n,o,s,l,u){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,s,l,u)}evaluate(e,n,o,s,l,u){return this._styleExpression.evaluate(e,n,o,s,l,u)}interpolationFactor(e,n,o){return this.interpolationType?Zl.interpolationFactor(this.interpolationType,e,n,o):0}}function Cw(t,e,n){if((t=Ou(t,e,n)).result==="error")return t;let o=t.value.expression,s=da(o);if(!s&&!Jd(e))return Kd([new $e("","data expressions not supported")]);let l=ul(o,["zoom","pitch","distance-from-center"]);if(!l&&!Tw(e))return Kd([new $e("","zoom expressions not supported")]);let u=ul(o,["measure-light"]);if(!u&&!rP(e))return Kd([new $e("","measure-light expression not supported")]);let d=e.expression&&e.expression.relaxZoomRestriction,f=fy(o);return f||l||d?f instanceof $e?Kd([f]):f instanceof Zl&&!Ew(e)?Kd([new $e("",'"interpolate" expressions cannot be used with this property')]):nP(f?new Ru(s?"camera":"composite",t.value,f.labels,f instanceof Zl?f.interpolation:void 0,u):new Iw(s?"constant":"source",t.value,u)):Kd([new $e("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class hy{constructor(e,n){this._parameters=e,this._specification=n,tr(this,oP(this._parameters,this._specification))}static deserialize(e){return new hy(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fy(t){let e=null;if(t instanceof WA)e=fy(t.result);else if(t instanceof GA){for(let n of t.args)if(e=fy(n),e)break}else(t instanceof aw||t instanceof Zl)&&t.input instanceof $o&&t.input.name==="zoom"&&(e=t);return e instanceof $e||t.eachChild(n=>{let o=fy(n);o instanceof $e?e=o:e&&o&&e!==o&&(e=new $e("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function za(t){let e=t.key,n=t.value,o=t.valueSpec||{},s=t.objectElementValidators||{},l=t.style,u=t.styleSpec,d=[],f=ui(n);if(f!=="object")return[new Ie(e,n,`object expected, ${f} found`)];for(let p in n){let g=p.split(".")[0],_;s[g]?_=s[g]:o[g]?_=Go:s["*"]?_=s["*"]:o["*"]&&(_=Go),_?d=d.concat(_({key:(e&&`${e}.`)+p,value:n[p],valueSpec:o[g]||o["*"],style:l,styleSpec:u,object:n,objectKey:p},n)):d.push(new mi(e,n[p],`unknown property "${p}"`))}for(let p in o)s[p]||o[p].required&&o[p].default===void 0&&n[p]===void 0&&d.push(new Ie(e,n,`missing required property "${p}"`));return d}function aP(t){let e=t.value,n=t.valueSpec,o=t.style,s=t.styleSpec,l=t.key,u=t.arrayElementValidator||Go;if(ui(e)!=="array")return[new Ie(l,e,`array expected, ${ui(e)} found`)];if(n.length&&e.length!==n.length)return[new Ie(l,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ie(l,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let d={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};s.$version<7&&(d.function=n.function),ui(n.value)==="object"&&(d=n.value);let f=[];for(let p=0;p<e.length;p++)f=f.concat(u({array:e,arrayIndex:p,value:e[p],valueSpec:d,style:o,styleSpec:s,key:`${l}[${p}]`},!0));return f}function lP(t){let e=t.key,n=t.value,o=t.valueSpec,s=ui(n);if(s==="number"&&n!=n&&(s="NaN"),s!=="number")return[new Ie(e,n,`number expected, ${s} found`)];if("minimum"in o){let l=o.minimum;if(ui(o.minimum)==="array"&&(l=o.minimum[t.arrayIndex]),n<l)return[new Ie(e,n,`${n} is less than the minimum value ${l}`)]}if("maximum"in o){let l=o.maximum;if(ui(o.maximum)==="array"&&(l=o.maximum[t.arrayIndex]),n>l)return[new Ie(e,n,`${n} is greater than the maximum value ${l}`)]}return[]}function cP(t){let e=t.valueSpec,n=$n(t.value.type),o,s,l,u={},d=n!=="categorical"&&t.value.property===void 0,f=!d,p=ui(t.value.stops)==="array"&&ui(t.value.stops[0])==="array"&&ui(t.value.stops[0][0])==="object",g=za({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(x){if(n==="identity")return[new Ie(x.key,x.value,'identity function may not have a "stops" property')];let b=[],T=x.value;return b=b.concat(aP({key:x.key,value:T,valueSpec:x.valueSpec,style:x.style,styleSpec:x.styleSpec,arrayElementValidator:_})),ui(T)==="array"&&T.length===0&&b.push(new Ie(x.key,T,"array must have at least one stop")),b},default:function(x){return Go({key:x.key,value:x.value,valueSpec:e,style:x.style,styleSpec:x.styleSpec})}}});return n==="identity"&&d&&g.push(new Ie(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||g.push(new Ie(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!Ew(t.valueSpec)&&g.push(new Ie(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(f&&!Jd(t.valueSpec)?g.push(new Ie(t.key,t.value,"property functions not supported")):d&&!Tw(t.valueSpec)&&g.push(new Ie(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!p||t.value.property!==void 0||g.push(new Ie(t.key,t.value,'"property" property is required')),g;function _(x){let b=[],T=x.value,E=x.key;if(ui(T)!=="array")return[new Ie(E,T,`array expected, ${ui(T)} found`)];if(T.length!==2)return[new Ie(E,T,`array length 2 expected, length ${T.length} found`)];if(p){if(ui(T[0])!=="object")return[new Ie(E,T,`object expected, ${ui(T[0])} found`)];if(T[0].zoom===void 0)return[new Ie(E,T,"object stop key must have zoom")];if(T[0].value===void 0)return[new Ie(E,T,"object stop key must have value")];let M=$n(T[0].zoom);if(typeof M!="number")return[new Ie(E,T[0].zoom,"stop zoom values must be numbers")];if(l&&l>M)return[new Ie(E,T[0].zoom,"stop zoom values must appear in ascending order")];M!==l&&(l=M,s=void 0,u={}),b=b.concat(za({key:`${E}[0]`,value:T[0],valueSpec:{zoom:{}},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{zoom:lP,value:v}}))}else b=b.concat(v({key:`${E}[0]`,value:T[0],valueSpec:{},style:x.style,styleSpec:x.styleSpec},T));return dy(Bt(T[1]))?b.concat([new Ie(`${E}[1]`,T[1],"expressions are not allowed in function stops.")]):b.concat(Go({key:`${E}[1]`,value:T[1],valueSpec:e,style:x.style,styleSpec:x.styleSpec}))}function v(x,b){let T=ui(x.value),E=$n(x.value),M=x.value!==null?x.value:b;if(o){if(T!==o)return[new Ie(x.key,M,`${T} stop domain type must match previous stop domain type ${o}`)]}else o=T;if(T!=="number"&&T!=="string"&&T!=="boolean"&&typeof E!="number"&&typeof E!="string"&&typeof E!="boolean")return[new Ie(x.key,M,"stop domain value must be a number, string, or boolean")];if(T!=="number"&&n!=="categorical"){let S=`number expected, ${T} found`;return Jd(e)&&n===void 0&&(S+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(x.key,M,S)]}return n!=="categorical"||T!=="number"||typeof E=="number"&&isFinite(E)&&Math.floor(E)===E?n!=="categorical"&&T==="number"&&typeof E=="number"&&typeof s=="number"&&s!==void 0&&E<s?[new Ie(x.key,M,"stop domain values must appear in ascending order")]:(s=E,n==="categorical"&&E in u?[new Ie(x.key,M,"stop domain values must be unique")]:(u[E]=!0,[])):[new Ie(x.key,M,`integer expected, found ${String(E)}`)]}}function Qd(t){let e=(t.expressionContext==="property"?Cw:Ou)(Bt(t.value),t.valueSpec);if(e.result==="error")return e.value.map(o=>new Ie(`${t.key}${o.key}`,t.value,o.message));let n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new Ie(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!ha(n))return[new Ie(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return uP(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ul(n,["zoom","feature-state"]))return[new Ie(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!da(n))return[new Ie(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uP(t,e){let n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(let s of e.valueSpec.expression.parameters)n.delete(s);if(n.size===0)return[];let o=[];return t instanceof $o&&n.has(t.name)?[new Ie(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(s=>{o.push(...uP(s,e))}),o)}function py(t){let e=t.key,n=t.value,o=t.valueSpec,s=[];return Array.isArray(o.values)?o.values.indexOf($n(n))===-1&&s.push(new Ie(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf($n(n))===-1&&s.push(new Ie(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),s}function Sw(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Sw(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function my(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Sw(t)||(t=gy(t));let n=t,o=!0;try{o=function(p){if(!Pf(p))return p;let g=Bt(p);return hP(g),g=dP(g),g}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let s=q[`filter_${e}`],l=Ou(o,s),u=null;if(l.result==="error")throw new Error(l.value.map(p=>`${p.key}: ${p.message}`).join(", "));u=(p,g,_)=>l.value.evaluate(p,g,{},_);let d=null,f=null;if(o!==n){let p=Ou(n,s);if(p.result==="error")throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));d=(g,_,v,x,b)=>p.value.evaluate(g,_,{},v,void 0,void 0,x,b),f=!da(p.value.expression)}return{filter:u,dynamicFilter:d||void 0,needGeometry:fP(o),needFeature:!!f}}function dP(t){if(!Array.isArray(t))return t;let e=function(n){if(u6.has(n[0])){for(let o=1;o<n.length;o++)if(Pf(n[o]))return!0}return n}(t);return e===!0?e:e.map(n=>dP(n))}function hP(t){let e=!1,n=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||Pf(t[o]),n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Pf(t[1]);for(let o=2;o<t.length-1;o+=2)n.push(t[o+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Pf(t[1]);for(let o=1;o<t.length-1;o+=2)n.push(t[o+1])}e&&(t.length=0,t.push("any",...n));for(let o=1;o<t.length;o++)hP(t[o])}function Pf(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Pf(t[n]))return!0;return!1}let u6=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function d6(t,e){return t<e?-1:t>e?1:0}function fP(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(fP(t[e]))return!0;return!1}function gy(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Dw(t[1],t[2],"=="):e==="!="?_y(Dw(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Dw(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(gy))):e==="all"?["all"].concat(t.slice(1).map(gy)):e==="none"?["all"].concat(t.slice(1).map(gy).map(_y)):e==="in"?pP(t[1],t.slice(2)):e==="!in"?_y(pP(t[1],t.slice(2))):e==="has"?mP(t[1]):e!=="!has"||_y(mP(t[1]));var n}function Dw(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function pP(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(d6)]]:["filter-in-small",t,["literal",e]]}}function mP(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function _y(t){return["!",t]}function Aw(t){return Sw(Bt(t.value))?Qd(tr({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):gP(t)}function gP(t){let e=t.value,n=t.key;if(ui(e)!=="array")return[new Ie(n,e,`array expected, ${ui(e)} found`)];let o=t.styleSpec,s,l=[];if(e.length<1)return[new Ie(n,e,"filter array must have at least 1 element")];switch(l=l.concat(py({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:t.style,styleSpec:t.styleSpec})),$n(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&$n(e[1])==="$type"&&l.push(new Ie(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&l.push(new Ie(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(s=ui(e[1]),s!=="string"&&l.push(new Ie(`${n}[1]`,e[1],`string expected, ${s} found`)));for(let u=2;u<e.length;u++)s=ui(e[u]),$n(e[1])==="$type"?l=l.concat(py({key:`${n}[${u}]`,value:e[u],valueSpec:o.geometry_type,style:t.style,styleSpec:t.styleSpec})):s!=="string"&&s!=="number"&&s!=="boolean"&&l.push(new Ie(`${n}[${u}]`,e[u],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let u=1;u<e.length;u++)l=l.concat(gP({key:`${n}[${u}]`,value:e[u],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":s=ui(e[1]),e.length!==2?l.push(new Ie(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):s!=="string"&&l.push(new Ie(`${n}[1]`,e[1],`string expected, ${s} found`))}return l}function _P(t,e){let n=t.key,o=t.style,s=t.layer,l=t.styleSpec,u=t.value,d=t.objectKey,f=l[`${e}_${t.layerType}`];if(!f)return[];let p=d.match(/^(.*)-transition$/);if(e==="paint"&&p&&f[p[1]]&&f[p[1]].transition)return Go({key:n,value:u,valueSpec:l.transition,style:o,styleSpec:l});let g=t.valueSpec||f[d];if(!g)return[new mi(n,u,`unknown property "${d}"`)];let _;if(ui(u)==="string"&&Jd(g)&&!g.tokens&&(_=/^{([^}]+)}$/.exec(u))){let x=`\`{ "type": "identity", "property": ${_?JSON.stringify(_[1]):'"_"'} }\``;return[new Ie(n,u,`"${d}" does not support interpolation syntax
Use an identity property function instead: ${x}.`)]}let v=[];if(t.layerType==="symbol")d!=="text-field"||!o||o.glyphs||o.imports||v.push(new Ie(n,u,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&uy(Bt(u))&&$n(u.type)==="identity"&&v.push(new Ie(n,u,'"text-font" does not support identity functions'));else if(t.layerType==="model"&&e==="paint"&&s&&s.layout&&s.layout.hasOwnProperty("model-id")&&Jd(g)&&(rP(g)||Tw(g))){let x=Cw(Bt(u),g),b=x.value.expression||x.value._styleExpression.expression;b&&!ul(b,["measure-light"])&&(d==="model-emissive-strength"&&da(b)&&ha(b)||v.push(new Ie(n,u,`${d} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return v.concat(Go({key:t.key,value:u,valueSpec:g,style:o,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:d}))}function yP(t){return _P(t,"paint")}function vP(t){return _P(t,"layout")}function xP(t){let e=[],n=t.value,o=t.key,s=t.style,l=t.styleSpec;n.type||n.ref||e.push(new Ie(o,n,'either "type" or "ref" is required'));let u=$n(n.type),d=$n(n.ref);if(n.id){let f=$n(n.id);for(let p=0;p<t.arrayIndex;p++){let g=s.layers[p];$n(g.id)===f&&e.push(new Ie(o,n.id,`duplicate layer id "${n.id}", previously used at line ${g.id.__line__}`))}}if("ref"in n){let f;["type","source","source-layer","filter","layout"].forEach(p=>{p in n&&e.push(new Ie(o,n[p],`"${p}" is prohibited for ref layers`))}),s.layers.forEach(p=>{$n(p.id)===d&&(f=p)}),f?f.ref?e.push(new Ie(o,n.ref,"ref cannot reference another ref layer")):u=$n(f.type):typeof d=="string"&&e.push(new Ie(o,n.ref,`ref layer "${d}" not found`))}else if(u!=="background"&&u!=="sky"&&u!=="slot")if(n.source){let f=s.sources&&s.sources[n.source],p=f&&$n(f.type);f?p==="vector"&&u==="raster"?e.push(new Ie(o,n.source,`layer "${n.id}" requires a raster source`)):p==="raster"&&u!=="raster"?e.push(new Ie(o,n.source,`layer "${n.id}" requires a vector source`)):p!=="vector"||n["source-layer"]?p==="raster-dem"&&u!=="hillshade"?e.push(new Ie(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):u!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||p==="geojson"&&f.lineMetrics||e.push(new Ie(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ie(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Ie(o,n.source,`source "${n.source}" not found`))}else e.push(new Ie(o,n,'missing required property "source"'));return e=e.concat(za({key:o,value:n,valueSpec:l.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Go({key:`${o}.type`,value:n.type,valueSpec:l.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:f=>Aw(tr({layerType:u},f)),layout:f=>za({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>vP(tr({layerType:u},p))}}),paint:f=>za({layer:n,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":p=>yP(tr({layerType:u,layer:n},p))}})}})),e}function Of(t){let e=t.value,n=t.key,o=ui(e);return o!=="string"?[new Ie(n,e,`string expected, ${o} found`)]:[]}let bP={promoteId:function({key:t,value:e}){if(ui(e)==="string")return Of({key:t,value:e});{let n=[];for(let o in e)n.push(...Of({key:`${t}.${o}`,value:e[o]}));return n}}};function wP(t){let e=t.value,n=t.key,o=t.styleSpec,s=t.style;if(!e.type)return[new Ie(n,e,'"type" is required')];let l=$n(e.type),u=[];switch(["vector","raster","raster-dem"].includes(l)&&(e.url||e.tiles||u.push(new Ie(n,e,'Either "url" or "tiles" is required.'))),l){case"vector":case"raster":case"raster-dem":return u=u.concat(za({key:n,value:e,valueSpec:o[`source_${l.replace("-","_")}`],style:t.style,styleSpec:o,objectElementValidators:bP})),u;case"geojson":if(u=za({key:n,value:e,valueSpec:o.source_geojson,style:s,styleSpec:o,objectElementValidators:bP}),e.cluster)for(let d in e.clusterProperties){let[f,p]=e.clusterProperties[d],g=typeof f=="string"?[f,["accumulated"],["get",d]]:f;u.push(...Qd({key:`${n}.${d}.map`,value:p,expressionContext:"cluster-map"})),u.push(...Qd({key:`${n}.${d}.reduce`,value:g,expressionContext:"cluster-reduce"}))}return u;case"video":return za({key:n,value:e,valueSpec:o.source_video,style:s,styleSpec:o});case"image":return za({key:n,value:e,valueSpec:o.source_image,style:s,styleSpec:o});case"canvas":return[new Ie(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return py({key:`${n}.type`,value:e.type,valueSpec:{values:h6(o)},style:s,styleSpec:o})}}function h6(t){return t.source.reduce((e,n)=>{let o=t[n];return o.type.type==="enum"&&(e=e.concat(Object.keys(o.type.values))),e},[])}function TP(t){let e=t.value,n=[];if(!e)return n;let o=ui(e);return o!=="string"?(n=n.concat([new Ie(t.key,e,`string expected, "${o}" found`)]),n):(function(s){let l=s.indexOf("://")===-1;try{return new URL(s,l?"http://example.com":void 0),!0}catch{return!1}}(e)||(n=n.concat([new Ie(t.key,e,`invalid url "${e}"`)])),n)}function EP(t){let e=t.value,n=t.styleSpec,o=n.light,s=t.style,l=[],u=ui(e);if(e===void 0)return l;if(u!=="object")return l=l.concat([new Ie("light",e,`object expected, ${u} found`)]),l;for(let d in e){let f=d.match(/^(.*)-transition$/);l=l.concat(f&&o[f[1]]&&o[f[1]].transition?Go({key:d,value:e[d],valueSpec:n.transition,style:s,styleSpec:n}):o[d]?Go({key:d,value:e[d],valueSpec:o[d],style:s,styleSpec:n}):[new Ie(d,e[d],`unknown property "${d}"`)])}return l}function MP(t){let e=t.value,n=[];if(!e)return n;let o=ui(e);if(o!=="object")return n=n.concat([new Ie("light-3d",e,`object expected, ${o} found`)]),n;let s=t.styleSpec,l=s["light-3d"],u=t.key,d=t.style,f=t.style.lights;for(let _ of["type","id"])if(!(_ in e))return n=n.concat([new Ie("light-3d",e,`missing property ${_} on light`)]),n;if(e.type&&f)for(let _=0;_<t.arrayIndex;_++){let v=$n(e.type),x=f[_];$n(x.type)===v&&n.push(new Ie(u,e.id,`duplicate light type "${e.type}", previously defined at line ${x.id.__line__}`))}let p=`properties_light_${e.type}`;if(!(p in s))return n=n.concat([new Ie("light-3d",e,`Invalid light type ${e.type}`)]),n;let g=s[p];for(let _ in e)if(_==="properties"){let v=e[_],x=ui(v);if(x!=="object")return n=n.concat([new Ie("properties",v,`object expected, ${x} found`)]),n;for(let b in v)n=n.concat(g[b]?Go({key:b,value:v[b],valueSpec:g[b],style:d,styleSpec:s}):[new mi(t.key,v[b],`unknown property "${b}"`)])}else{let v=_.match(/^(.*)-transition$/);n=n.concat(v&&l[v[1]]&&l[v[1]].transition?Go({key:_,value:e[_],valueSpec:s.transition,style:d,styleSpec:s}):l[_]?Go({key:_,value:e[_],valueSpec:l[_],style:d,styleSpec:s}):[new mi(_,e[_],`unknown property "${_}"`)])}return n}function IP(t){let e=t.value,n=t.key,o=t.style,s=t.styleSpec,l=s.terrain,u=[],d=ui(e);if(e===void 0||d==="null")return u;if(d!=="object")return u=u.concat([new Ie("terrain",e,`object expected, ${d} found`)]),u;for(let f in e){let p=f.match(/^(.*)-transition$/);u=u.concat(p&&l[p[1]]&&l[p[1]].transition?Go({key:f,value:e[f],valueSpec:s.transition,style:o,styleSpec:s}):l[f]?Go({key:f,value:e[f],valueSpec:l[f],style:o,styleSpec:s}):[new mi(f,e[f],`unknown property "${f}"`)])}if(e.source){let f=o.sources&&o.sources[e.source],p=f&&$n(f.type);f?p!=="raster-dem"&&u.push(new Ie(n,e.source,`terrain cannot be used with a source of type ${String(p)}, it only be used with a "raster-dem" source type`)):u.push(new Ie(n,e.source,`source "${e.source}" not found`))}else u.push(new Ie(n,e,'terrain is missing required property "source"'));return u}function CP(t){let e=t.value,n=t.style,o=t.styleSpec,s=o.fog,l=[],u=ui(e);if(e===void 0)return l;if(u!=="object")return l=l.concat([new Ie("fog",e,`object expected, ${u} found`)]),l;for(let d in e){let f=d.match(/^(.*)-transition$/);l=l.concat(f&&s[f[1]]&&s[f[1]].transition?Go({key:d,value:e[d],valueSpec:o.transition,style:n,styleSpec:o}):s[d]?Go({key:d,value:e[d],valueSpec:s[d],style:n,styleSpec:o}):[new mi(d,e[d],`unknown property "${d}"`)])}return l}let SP={"*":()=>[],array:aP,boolean:function(t){let e=t.value,n=t.key,o=ui(e);return o!=="boolean"?[new Ie(n,e,`boolean expected, ${o} found`)]:[]},number:lP,color:function(t){let e=t.key,n=t.value,o=ui(n);return o!=="string"?[new Ie(e,n,`color expected, ${o} found`)]:Nd(n)===null?[new Ie(e,n,`color expected, "${n}" found`)]:[]},enum:py,filter:Aw,function:cP,layer:xP,object:za,source:wP,model:TP,light:EP,"light-3d":MP,terrain:IP,fog:CP,string:Of,formatted:function(t){return Of(t).length===0?[]:Qd(t)},resolvedImage:function(t){return Of(t).length===0?[]:Qd(t)},projection:function(t){let e=t.value,n=t.styleSpec,o=n.projection,s=t.style,l=[],u=ui(e);if(u==="object")for(let d in e)l=l.concat(Go({key:d,value:e[d],valueSpec:o[d],style:s,styleSpec:n}));else u!=="string"&&(l=l.concat([new Ie("projection",e,`object or string expected, ${u} found`)]));return l},import:function(t){let{value:e,styleSpec:n}=t,u=e,{data:o}=u,s=hp(u,["data"]);Object.defineProperty(s,"__line__",{value:e.__line__,enumerable:!1});let l=za(tr({},t,{value:s,valueSpec:n.import}));return $n(s.id)===""&&l.push(new Ie(`${t.key}.id`,s,"import id can't be an empty string")),o&&(l=l.concat(DP(o,n,{key:`${t.key}.data`}))),l}};function Go(t,e=!1){let n=t.value,o=t.valueSpec,s=t.styleSpec;if(o.expression&&uy($n(n)))return cP(t);if(o.expression&&dy(Bt(n)))return Qd(t);if(o.type&&SP[o.type]){let l=SP[o.type](t);return e===!0&&l.length>0&&ui(t.value)==="array"?Qd(t):l}return za(tr({},t,{valueSpec:o.type?s[o.type]:o}))}function f6(t){let e=t.value,n=t.key,o=Of(t);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ie(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ie(n,e,'"glyphs" url must include a "{range}" token'))),o}function DP(t,e=q,n={}){return Go({key:n.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:f6,"*":()=>[]}})}function Rf(t,e=q){return dl(DP(t,e))}let p6=t=>dl(wP(t)),m6=t=>dl(EP(t)),g6=t=>dl(MP(t)),_6=t=>dl(IP(t)),y6=t=>dl(CP(t)),v6=t=>dl(xP(t)),Pw=t=>dl(Aw(t)),x6=t=>dl(yP(t)),b6=t=>dl(vP(t)),w6=t=>dl(TP(t));function dl(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function yy(t,e){let n=!1;if(e&&e.length)for(let o of e)o instanceof mi?J(o.message):(t.fire(new Je(new Error(o.message))),n=!0);return n}var T6=Yl,Lu=3;function Yl(t,e,n){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(n=s[2]);for(var l=0;l<this.d*this.d;l++){var u=s[Lu+l],d=s[Lu+l+1];o.push(u===d?null:s.subarray(u,d))}var f=s[Lu+o.length+1];this.keys=s.subarray(s[Lu+o.length],f),this.bboxes=s.subarray(f),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var p=0;p<this.d*this.d;p++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var g=n/e*t;this.min=-g,this.max=t+g}Yl.prototype.insert=function(t,e,n,o,s){this._forEachCell(e,n,o,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s)},Yl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Yl.prototype._insertCell=function(t,e,n,o,s,l){this.cells[s].push(l)},Yl.prototype.query=function(t,e,n,o,s){var l=this.min,u=this.max;if(t<=l&&e<=l&&u<=n&&u<=o&&!s)return Array.prototype.slice.call(this.keys);var d=[];return this._forEachCell(t,e,n,o,this._queryCell,d,{},s),d},Yl.prototype._queryCell=function(t,e,n,o,s,l,u,d){var f=this.cells[s];if(f!==null)for(var p=this.keys,g=this.bboxes,_=0;_<f.length;_++){var v=f[_];if(u[v]===void 0){var x=4*v;(d?d(g[x+0],g[x+1],g[x+2],g[x+3]):t<=g[x+2]&&e<=g[x+3]&&n>=g[x+0]&&o>=g[x+1])?(u[v]=!0,l.push(p[v])):u[v]=!1}}},Yl.prototype._forEachCell=function(t,e,n,o,s,l,u,d){for(var f=this._convertToCellCoord(t),p=this._convertToCellCoord(e),g=this._convertToCellCoord(n),_=this._convertToCellCoord(o),v=f;v<=g;v++)for(var x=p;x<=_;x++){var b=this.d*x+v;if((!d||d(this._convertFromCellCoord(v),this._convertFromCellCoord(x),this._convertFromCellCoord(v+1),this._convertFromCellCoord(x+1)))&&s.call(this,t,e,n,o,b,l,u,d))return}},Yl.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Yl.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Yl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Lu+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var s=new Int32Array(e+n+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var l=e,u=0;u<t.length;u++){var d=t[u];s[Lu+u]=l,s.set(d,l),l+=d.length}return s[Lu+t.length]=l,s.set(this.keys,l),s[Lu+t.length+1]=l+=this.keys.length,s.set(this.bboxes,l),l+=this.bboxes.length,s.buffer};var Lf=Ve(T6);let vy={};function pt(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),vy[e]={klass:t,omit:n.omit||[]}}pt(Object,"Object"),Lf.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},Lf.deserialize=function(t){return new Lf(t.buffer)},Object.defineProperty(Lf,"name",{value:"Grid"}),pt(Lf,"Grid"),pt(tn,"Color"),pt(Error,"Error"),pt(Ce,"AJAXError"),pt(No,"ResolvedImage"),pt(hy,"StylePropertyFunction"),pt(Mw,"StyleExpression",{omit:["_evaluator"]}),pt(Ru,"ZoomDependentExpression"),pt(Iw,"ZoomConstantExpression"),pt($o,"CompoundExpression",{omit:["_evaluate"]});for(let t in Lm)vy[Lm[t]._classRegistryKey]||pt(Lm[t],`Expression${t}`);function AP(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function PP(t){return y.ImageBitmap&&t instanceof y.ImageBitmap}function Ff(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(AP(t)||PP(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof y.ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let o of t)n.push(Ff(o,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[o,s]of t.entries())n[o]=Ff(s);return n}if(typeof t=="object"){let n=t.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let s=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let l in t)t.hasOwnProperty(l)&&(vy[o].omit.indexOf(l)>=0||(s[l]=Ff(t[l],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(s.$name=o),s}throw new Error("can't serialize object of type "+typeof t)}function kf(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||AP(t)||PP(t)||ArrayBuffer.isView(t)||t instanceof y.ImageData)return t;if(Array.isArray(t))return t.map(kf);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let s=new Map;for(let l of Object.keys(t))l!=="$name"&&s.set(l,kf(t[l]));return s}let{klass:n}=vy[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let o=Object.create(n.prototype);for(let s of Object.keys(t))s!=="$name"&&(o[s]=kf(t[s]));return o}throw new Error("can't deserialize object of type "+typeof t)}let xt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ow(t){for(let e of t)if(Rw(e.charCodeAt(0)))return!0;return!1}function E6(t){for(let e of t)if(!M6(e.charCodeAt(0)))return!1;return!0}function M6(t){return!(xt.Arabic(t)||xt["Arabic Supplement"](t)||xt["Arabic Extended-A"](t)||xt["Arabic Presentation Forms-A"](t)||xt["Arabic Presentation Forms-B"](t))}function Rw(t){return!(t!==746&&t!==747&&(t<4352||!(xt["Bopomofo Extended"](t)||xt.Bopomofo(t)||xt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||xt["CJK Compatibility Ideographs"](t)||xt["CJK Compatibility"](t)||xt["CJK Radicals Supplement"](t)||xt["CJK Strokes"](t)||!(!xt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||xt["CJK Unified Ideographs Extension A"](t)||xt["CJK Unified Ideographs"](t)||xt["Enclosed CJK Letters and Months"](t)||xt["Hangul Compatibility Jamo"](t)||xt["Hangul Jamo Extended-A"](t)||xt["Hangul Jamo Extended-B"](t)||xt["Hangul Jamo"](t)||xt["Hangul Syllables"](t)||xt.Hiragana(t)||xt["Ideographic Description Characters"](t)||xt.Kanbun(t)||xt["Kangxi Radicals"](t)||xt["Katakana Phonetic Extensions"](t)||xt.Katakana(t)&&t!==12540||!(!xt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!xt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||xt["Unified Canadian Aboriginal Syllabics"](t)||xt["Unified Canadian Aboriginal Syllabics Extended"](t)||xt["Vertical Forms"](t)||xt["Yijing Hexagram Symbols"](t)||xt["Yi Syllables"](t)||xt["Yi Radicals"](t))))}function OP(t){return!(Rw(t)||function(e){return!!(xt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||xt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||xt["Letterlike Symbols"](e)||xt["Number Forms"](e)||xt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||xt["Control Pictures"](e)&&e!==9251||xt["Optical Character Recognition"](e)||xt["Enclosed Alphanumerics"](e)||xt["Geometric Shapes"](e)||xt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||xt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||xt["CJK Symbols and Punctuation"](e)||xt.Katakana(e)||xt["Private Use Area"](e)||xt["CJK Compatibility Forms"](e)||xt["Small Form Variants"](e)||xt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function RP(t){return t>=1424&&t<=2303||xt["Arabic Presentation Forms-A"](t)||xt["Arabic Presentation Forms-B"](t)}function I6(t,e){return!(!e&&RP(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||xt.Khmer(t))}function C6(t){for(let e of t)if(RP(e.charCodeAt(0)))return!0;return!1}let Lw="deferred",Fw="loading",kw="loaded",Nw=null,Us="unavailable",Fu=null,LP=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Us="error"),Nw&&Nw(t)};function zw(){Bw.fire(new Se("pluginStateChange",{pluginStatus:Us,pluginURL:Fu}))}let Bw=new vn,jw=function(){return Us},FP=function(){if(Us!==Lw||!Fu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Us=Fw,zw(),Fu&&Qe({url:Fu},t=>{t?LP(t):(Us=kw,zw())})},Ba={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Us===kw||Ba.applyArabicShaping!=null,isLoading:()=>Us===Fw,setState(t){Us=t.pluginStatus,Fu=t.pluginURL},isParsed:()=>Ba.applyArabicShaping!=null&&Ba.processBidirectionalText!=null&&Ba.processStyledBidirectionalText!=null,getPluginURL:()=>Fu};class ur{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,o){for(let s of n)if(!I6(s.charCodeAt(0),o))return!1;return!0}(e,Ba.isLoaded())}}class xy{constructor(e,n,o){this.property=e,this.value=n,this.expression=function(s,l,u){if(uy(s))return new hy(s,l);if(dy(s)||Array.isArray(s)&&s.length>0){let d=Cw(s,l,u);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=s;return typeof s=="string"&&l.type==="color"&&(d=tn.parse(s)),{kind:"constant",isConfigDependent:!1,evaluate:()=>d}}}(n===void 0?e.specification.default:n,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class Vw{constructor(e,n){this.property=e,this.value=new xy(e,void 0,n)}transitioned(e,n){return new kP(this.property,this.value,n,Ne({},e.transition,this.transition),e.now)}untransitioned(){return new kP(this.property,this.value,null,{},0)}}class km{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return $(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Vw(this._values[e].property,this._options)),this._values[e].value=new xy(this._values[e].property,n===null?void 0:$(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let o=this._properties.properties;if(e)for(let s in e){let l=e[s];if(ks(s,"-transition")){let u=s.slice(0,-11);o[u]&&this.setTransition(u,l)}else o[s]&&this.setValue(s,l)}}getTransition(e){return $(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Vw(this._values[e].property)),this._values[e].transition=$(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o);let s=this.getTransition(n);s!==void 0&&(e[`${n}-transition`]=s)}return e}transitioned(e,n){let o=new NP(this._properties);for(let s of Object.keys(this._values))o._values[s]=this._values[s].transitioned(e,n._values[s]);return o}untransitioned(){let e=new NP(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class kP{constructor(e,n,o,s,l){let u=s.delay||0,d=s.duration||0;l=l||0,this.property=e,this.value=n,this.begin=l+u,this.end=this.begin+d,e.specification.transition&&(s.delay||s.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){let s=e.now||0,l=this.value.possiblyEvaluate(e,n,o),u=this.prior;if(u){if(s>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(s<this.begin)return u.possiblyEvaluate(e,n,o);{let d=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(u.possiblyEvaluate(e,n,o),l,Ko(d))}}return l}}class NP{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){let s=new Nm(this._properties);for(let l of Object.keys(this._values))s._values[l]=this._values[l].possiblyEvaluate(e,n,o);return s}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class S6{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return $(this._values[e].value)}setValue(e,n){this._values[e]=new xy(this._values[e].property,n===null?void 0:$(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){let s=new Nm(this._properties);for(let l of Object.keys(this._values))s._values[l]=this._values[l].possiblyEvaluate(e,n,o);return s}}class Nf{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,s){return this.property.evaluate(this.value,this.parameters,e,n,o,s)}}class Nm{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class je{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){let s=sy[this.specification.type];return s?s(e,n,o):e}}class At{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,s){return new Nf(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,s)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Nf(this,{kind:"constant",value:void 0},e.parameters);let s=sy[this.specification.type];return s?new Nf(this,{kind:"constant",value:s(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,s,l,u){return e.kind==="constant"?e.value:e.evaluate(n,o,s,l,u)}}class zm{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,s){return!!e.expression.evaluate(n,null,{},o,s)}interpolate(){return!1}}class Tr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new ur(0,{});for(let o in e){let s=e[o];s.specification.overridable&&this.overridableProperties.push(o);let l=this.defaultPropertyValues[o]=new xy(s,void 0),u=this.defaultTransitionablePropertyValues[o]=new Vw(s);this.defaultTransitioningPropertyValues[o]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=l.possiblyEvaluate(n)}}}pt(At,"DataDrivenProperty"),pt(je,"DataConstantProperty"),pt(zm,"ColorRampProperty");let by="";function zP(t){return t.indexOf(by)>=0}function os(t,e){return e?`${t}${by}${e}`:t}function wy(t){let e=t.indexOf(by);return e>=0?t.slice(0,e):t}let BP="-transition";class fa extends vn{constructor(e,n,o){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=o,e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new S6(n.layout,o),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new km(n.paint,o);for(let s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(let s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nm(n.paint)}}setScope(e){this.scope=e,this.fqid=os(this.id,e)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){if(n!=null&&this._validate(b6,`layers.${this.id}.layout.${e}`,e,n,o))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return ks(e,BP)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(x6,`layers.${this.id}.paint.${e}`,e,n,o))return!1;let s=this._transitionablePaint,l=s._properties.properties;if(ks(e,BP)){let v=e.slice(0,-11);return l[v]&&s.setTransition(v,n||void 0),!1}if(!l[e])return!1;let u=s._values[e],d=u.value.isDataDriven(),f=u.value;s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let p=s._values[e].value,g=p.isDataDriven(),_=ks(e,"pattern")||e==="line-dasharray";return g||d||_||this._handleOverridablePaintPropertyUpdate(e,f,p)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Ae({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}_validate(e,n,o,s,l={}){return(!l||l.validate!==!1)&&yy(this,e.call(Rf,{key:n,layerType:this.type,objectKey:o,value:s,styleSpec:q,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof Nf&&Jd(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=my(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class D6{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,n){this._updatedSourceCaches[e]=n,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){let n=e.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(e.id),this.setDirty()}removeLayer(e){let n=e.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][e.id]=e,this._updatedLayers[n].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){let e={};for(let n in this._updatedLayers)e[n]=e[n]||{},e[n].updatedIds=Array.from(this._updatedLayers[n].values());for(let n in this._removedLayers)e[n]=e[n]||{},e[n].removedIds=Object.keys(this._removedLayers[n]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let A6={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ty{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ri(t,e=1){let n=0,o=0;return{members:t.map(s=>{let l=A6[s.type].BYTES_PER_ELEMENT,u=n=jP(n,Math.max(e,l)),d=s.components||1;return o=Math.max(o,l),n+=l*d,{name:s.name,type:s.type,components:d,offset:u}}),size:jP(n,Math.max(o,e)),alignment:e}}function jP(t,e){return Math.ceil(t/e)*e}class $s extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let s=2*e;return this.int16[s+0]=n,this.int16[s+1]=o,e}}$s.prototype.bytesPerElement=4,pt($s,"StructArrayLayout2i4");class Ey extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,o)}emplace(e,n,o,s){let l=3*e;return this.int16[l+0]=n,this.int16[l+1]=o,this.int16[l+2]=s,e}}Ey.prototype.bytesPerElement=6,pt(Ey,"StructArrayLayout3i6");class eh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,o,s)}emplace(e,n,o,s,l){let u=4*e;return this.int16[u+0]=n,this.int16[u+1]=o,this.int16[u+2]=s,this.int16[u+3]=l,e}}eh.prototype.bytesPerElement=8,pt(eh,"StructArrayLayout4i8");class Uw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s,l)}emplace(e,n,o,s,l,u){let d=5*e;return this.int16[d+0]=n,this.int16[d+1]=o,this.int16[d+2]=s,this.int16[d+3]=l,this.int16[d+4]=u,e}}Uw.prototype.bytesPerElement=10,pt(Uw,"StructArrayLayout5i10");class $w extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,s,l,u,d)}emplace(e,n,o,s,l,u,d,f){let p=6*e,g=12*e,_=3*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.uint8[g+4]=s,this.uint8[g+5]=l,this.uint8[g+6]=u,this.uint8[g+7]=d,this.float32[_+2]=f,e}}$w.prototype.bytesPerElement=12,pt($w,"StructArrayLayout2i4ub1f12");class Fc extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,o,s)}emplace(e,n,o,s,l){let u=4*e;return this.float32[u+0]=n,this.float32[u+1]=o,this.float32[u+2]=s,this.float32[u+3]=l,e}}Fc.prototype.bytesPerElement=16,pt(Fc,"StructArrayLayout4f16");class ku extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s,l)}emplace(e,n,o,s,l,u){let d=6*e,f=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=o,this.uint16[d+2]=s,this.uint16[d+3]=l,this.float32[f+2]=u,e}}ku.prototype.bytesPerElement=12,pt(ku,"StructArrayLayout4ui1f12");class My extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,o,s)}emplace(e,n,o,s,l){let u=4*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,this.uint16[u+2]=s,this.uint16[u+3]=l,e}}My.prototype.bytesPerElement=8,pt(My,"StructArrayLayout4ui8");class Iy extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,s,l,u)}emplace(e,n,o,s,l,u,d){let f=6*e;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=s,this.int16[f+3]=l,this.int16[f+4]=u,this.int16[f+5]=d,e}}Iy.prototype.bytesPerElement=12,pt(Iy,"StructArrayLayout6i12");class Hw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d,f,p,g,_,v){let x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,s,l,u,d,f,p,g,_,v)}emplace(e,n,o,s,l,u,d,f,p,g,_,v,x){let b=12*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=s,this.int16[b+3]=l,this.uint16[b+4]=u,this.uint16[b+5]=d,this.uint16[b+6]=f,this.uint16[b+7]=p,this.int16[b+8]=g,this.int16[b+9]=_,this.int16[b+10]=v,this.int16[b+11]=x,e}}Hw.prototype.bytesPerElement=24,pt(Hw,"StructArrayLayout4i4ui4i24");class Gw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u){let d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,s,l,u)}emplace(e,n,o,s,l,u,d){let f=10*e,p=5*e;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=s,this.float32[p+2]=l,this.float32[p+3]=u,this.float32[p+4]=d,e}}Gw.prototype.bytesPerElement=20,pt(Gw,"StructArrayLayout3i3f20");class Ww extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Ww.prototype.bytesPerElement=4,pt(Ww,"StructArrayLayout1ul4");class Nu extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let s=2*e;return this.uint16[s+0]=n,this.uint16[s+1]=o,e}}Nu.prototype.bytesPerElement=4,pt(Nu,"StructArrayLayout2ui4");class qw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d,f,p,g,_,v,x){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,s,l,u,d,f,p,g,_,v,x)}emplace(e,n,o,s,l,u,d,f,p,g,_,v,x,b){let T=20*e,E=10*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=s,this.int16[T+3]=l,this.int16[T+4]=u,this.float32[E+3]=d,this.float32[E+4]=f,this.float32[E+5]=p,this.float32[E+6]=g,this.int16[T+14]=_,this.uint32[E+8]=v,this.uint16[T+18]=x,this.uint16[T+19]=b,e}}qw.prototype.bytesPerElement=40,pt(qw,"StructArrayLayout5i4f1i1ul2ui40");class Cy extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,s,l,u,d)}emplace(e,n,o,s,l,u,d,f){let p=8*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=s,this.int16[p+4]=l,this.int16[p+5]=u,this.int16[p+6]=d,this.int16[p+7]=f,e}}Cy.prototype.bytesPerElement=16,pt(Cy,"StructArrayLayout3i2i2i16");class Zw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s,l)}emplace(e,n,o,s,l,u){let d=4*e,f=8*e;return this.float32[d+0]=n,this.float32[d+1]=o,this.float32[d+2]=s,this.int16[f+6]=l,this.int16[f+7]=u,e}}Zw.prototype.bytesPerElement=16,pt(Zw,"StructArrayLayout2f1f2i16");class Yw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,o,s)}emplace(e,n,o,s,l){let u=12*e,d=3*e;return this.uint8[u+0]=n,this.uint8[u+1]=o,this.float32[d+1]=s,this.float32[d+2]=l,e}}Yw.prototype.bytesPerElement=12,pt(Yw,"StructArrayLayout2ub2f12");class Kr extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,o)}emplace(e,n,o,s){let l=3*e;return this.uint16[l+0]=n,this.uint16[l+1]=o,this.uint16[l+2]=s,e}}Kr.prototype.bytesPerElement=6,pt(Kr,"StructArrayLayout3ui6");class Xw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S,P,O,A){let R=this.length;return this.resize(R+1),this.emplace(R,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S,P,O,A)}emplace(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S,P,O,A,R){let F=30*e,k=15*e,N=60*e;return this.int16[F+0]=n,this.int16[F+1]=o,this.int16[F+2]=s,this.float32[k+2]=l,this.float32[k+3]=u,this.uint16[F+8]=d,this.uint16[F+9]=f,this.uint32[k+5]=p,this.uint32[k+6]=g,this.uint32[k+7]=_,this.uint16[F+16]=v,this.uint16[F+17]=x,this.uint16[F+18]=b,this.float32[k+10]=T,this.float32[k+11]=E,this.uint8[N+48]=M,this.uint8[N+49]=S,this.uint8[N+50]=P,this.uint32[k+13]=O,this.int16[F+28]=A,this.uint8[N+58]=R,e}}Xw.prototype.bytesPerElement=60,pt(Xw,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Kw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S,P,O,A,R,F,k,N,B,H,G,Y,U,Q,te){let se=this.length;return this.resize(se+1),this.emplace(se,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S,P,O,A,R,F,k,N,B,H,G,Y,U,Q,te)}emplace(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S,P,O,A,R,F,k,N,B,H,G,Y,U,Q,te,se){let K=20*e,ee=40*e,de=80*e;return this.float32[K+0]=n,this.float32[K+1]=o,this.int16[ee+4]=s,this.int16[ee+5]=l,this.int16[ee+6]=u,this.int16[ee+7]=d,this.int16[ee+8]=f,this.int16[ee+9]=p,this.int16[ee+10]=g,this.int16[ee+11]=_,this.int16[ee+12]=v,this.uint16[ee+13]=x,this.uint16[ee+14]=b,this.uint16[ee+15]=T,this.uint16[ee+16]=E,this.uint16[ee+17]=M,this.uint16[ee+18]=S,this.uint16[ee+19]=P,this.uint16[ee+20]=O,this.uint16[ee+21]=A,this.uint16[ee+22]=R,this.uint16[ee+23]=F,this.uint16[ee+24]=k,this.uint16[ee+25]=N,this.uint16[ee+26]=B,this.uint16[ee+27]=H,this.uint32[K+14]=G,this.float32[K+15]=Y,this.float32[K+16]=U,this.float32[K+17]=Q,this.float32[K+18]=te,this.uint8[de+76]=se,e}}Kw.prototype.bytesPerElement=80,pt(Kw,"StructArrayLayout2f9i15ui1ul4f1ub80");class Bm extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Bm.prototype.bytesPerElement=4,pt(Bm,"StructArrayLayout1f4");class th extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,o,s,l)}emplace(e,n,o,s,l,u){let d=5*e;return this.float32[d+0]=n,this.float32[d+1]=o,this.float32[d+2]=s,this.float32[d+3]=l,this.float32[d+4]=u,e}}th.prototype.bytesPerElement=20,pt(th,"StructArrayLayout5f20");class Jw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,s,l,u,d)}emplace(e,n,o,s,l,u,d,f){let p=7*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=s,this.float32[p+3]=l,this.float32[p+4]=u,this.float32[p+5]=d,this.float32[p+6]=f,e}}Jw.prototype.bytesPerElement=28,pt(Jw,"StructArrayLayout7f28");class Qw extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,o,s)}emplace(e,n,o,s,l){let u=6*e;return this.uint32[3*e+0]=n,this.uint16[u+2]=o,this.uint16[u+3]=s,this.uint16[u+4]=l,e}}Qw.prototype.bytesPerElement=12,pt(Qw,"StructArrayLayout1ul3ui12");class jm extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}jm.prototype.bytesPerElement=2,pt(jm,"StructArrayLayout1ui2");class nh extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,n,o)}emplace(e,n,o,s){let l=3*e;return this.float32[l+0]=n,this.float32[l+1]=o,this.float32[l+2]=s,e}}nh.prototype.bytesPerElement=12,pt(nh,"StructArrayLayout3f12");class Vm extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){let s=2*e;return this.float32[s+0]=n,this.float32[s+1]=o,e}}Vm.prototype.bytesPerElement=8,pt(Vm,"StructArrayLayout2f8");class eT extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E){let M=this.length;return this.resize(M+1),this.emplace(M,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E)}emplace(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M){let S=16*e;return this.float32[S+0]=n,this.float32[S+1]=o,this.float32[S+2]=s,this.float32[S+3]=l,this.float32[S+4]=u,this.float32[S+5]=d,this.float32[S+6]=f,this.float32[S+7]=p,this.float32[S+8]=g,this.float32[S+9]=_,this.float32[S+10]=v,this.float32[S+11]=x,this.float32[S+12]=b,this.float32[S+13]=T,this.float32[S+14]=E,this.float32[S+15]=M,e}}eT.prototype.bytesPerElement=64,pt(eT,"StructArrayLayout16f64");class Sy extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,s,l,u,d){let f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,s,l,u,d)}emplace(e,n,o,s,l,u,d,f){let p=10*e,g=5*e;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=s,this.uint16[p+3]=l,this.float32[g+2]=u,this.float32[g+3]=d,this.float32[g+4]=f,e}}Sy.prototype.bytesPerElement=20,pt(Sy,"StructArrayLayout4ui3f20");class tT extends dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}tT.prototype.bytesPerElement=1,pt(tT,"StructArrayLayout1ub1");class VP extends Ty{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}VP.prototype.size=40;class nT extends qw{get(e){return new VP(this,e)}}pt(nT,"CollisionBoxArray");class UP extends Ty{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}UP.prototype.size=60;class $P extends Xw{get(e){return new UP(this,e)}}pt($P,"PlacedSymbolArray");class HP extends Ty{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}HP.prototype.size=80;class GP extends Kw{get(e){return new HP(this,e)}}pt(GP,"SymbolInstanceArray");class WP extends Bm{getoffsetX(e){return this.float32[1*e+0]}}pt(WP,"GlyphOffsetArray");class qP extends $s{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}pt(qP,"SymbolLineVertexArray");class ZP extends Ty{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ZP.prototype.size=12;class YP extends Qw{get(e){return new ZP(this,e)}}pt(YP,"FeatureIndexArray");class XP extends Nu{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}pt(XP,"FillExtrusionCentroidArray");let P6=ri([{name:"a_pos",components:2,type:"Int16"}],4),O6=ri([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ti{constructor(e=[]){this.segments=e}_prepareSegment(e,n,o,s){let l=this.segments[this.segments.length-1];return e>Ti.MAX_VERTEX_ARRAY_LENGTH&&J(`Max vertices per segment is ${Ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Ti.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==s)&&(l={vertexOffset:n,primitiveOffset:o,vertexLength:0,primitiveLength:0},s!==void 0&&(l.sortKey=s),this.segments.push(l)),l}prepareSegment(e,n,o,s){return this._prepareSegment(e,n.length,o.length,s)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,s){return new Ti([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:s,vaos:{},sortKey:0}])}}function KP(t,e){return 256*(t=ze(Math.floor(t),0,255))+ze(Math.floor(e),0,255)}Ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt(Ti,"SegmentVector");let R6=ri([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),L6=ri([{name:"a_dash",components:4,type:"Uint16"}]);var Dy={exports:{}},JP={exports:{}};(function(t){t.exports=function(e,n){var o,s,l,u,d,f,p,g;for(s=e.length-(o=3&e.length),l=n,d=3432918353,f=461845907,g=0;g<s;)p=255&e.charCodeAt(g)|(255&e.charCodeAt(++g))<<8|(255&e.charCodeAt(++g))<<16|(255&e.charCodeAt(++g))<<24,++g,l=27492+(65535&(u=5*(65535&(l=(l^=p=(65535&(p=(p=(65535&p)*d+(((p>>>16)*d&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(p=0,o){case 3:p^=(255&e.charCodeAt(g+2))<<16;case 2:p^=(255&e.charCodeAt(g+1))<<8;case 1:l^=p=(65535&(p=(p=(65535&(p^=255&e.charCodeAt(g)))*d+(((p>>>16)*d&65535)<<16)&4294967295)<<15|p>>>17))*f+(((p>>>16)*f&65535)<<16)&4294967295}return l^=e.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}})(JP);var F6=JP.exports,QP={exports:{}};(function(t){t.exports=function(e,n){for(var o,s=e.length,l=n^s,u=0;s>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24))+((1540483477*(o>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),s-=4,++u;switch(s){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&e.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0}})(QP);var eO=F6,k6=QP.exports;Dy.exports=eO,Dy.exports.murmur3=eO,Dy.exports.murmur2=k6;var iT=Ve(Dy.exports);class Um{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,o,s){this.ids.push(tO(e)),this.positions.push(n,o,s)}eachPosition(e,n){let o=tO(e),s=0,l=this.ids.length-1;for(;s<l;){let u=s+l>>1;this.ids[u]>=o?l=u:s=u+1}for(;this.ids[s]===o;)n(this.positions[3*s],this.positions[3*s+1],this.positions[3*s+2]),s++}static serialize(e,n){let o=new Float64Array(e.ids),s=new Uint32Array(e.positions);return rT(o,s,0,o.length-1),n&&(n.add(o.buffer),n.add(s.buffer)),{ids:o,positions:s}}static deserialize(e){let n=new Um,o;n.ids=e.ids,n.positions=e.positions;for(let s of n.ids)s!==o&&n.uniqueIds.push(s),o=s;return n.indexed=!0,n}}function tO(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:iT(String(t))}function rT(t,e,n,o){for(;n<o;){let s=t[n+o>>1],l=n-1,u=o+1;for(;;){do l++;while(t[l]<s);do u--;while(t[u]>s);if(l>=u)break;Ay(t,l,u),Ay(e,3*l,3*u),Ay(e,3*l+1,3*u+1),Ay(e,3*l+2,3*u+2)}u-n<o-u?(rT(t,e,n,u),n=u+1):(rT(t,e,u+1,o),o=u)}}function Ay(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}pt(Um,"FeaturePositionMap");class kc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class En extends kc{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Fe extends kc{constructor(e){super(e),this.current=0}set(e,n,o){this.fetchUniformLocation(e,n)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Mn extends kc{constructor(e){super(e),this.current=[0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class an extends kc{constructor(e){super(e),this.current=[0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Hs extends kc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,o){this.fetchUniformLocation(e,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class zf extends kc{constructor(e){super(e),this.current=tn.transparent}set(e,n,o){this.fetchUniformLocation(e,n)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let N6=new Float32Array(16);class nn extends kc{constructor(e){super(e),this.current=N6}set(e,n,o){if(this.fetchUniformLocation(e,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let s=1;s<16;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let z6=new Float32Array(9);class oT extends kc{constructor(e){super(e),this.current=z6}set(e,n,o){if(this.fetchUniformLocation(e,n)){for(let s=0;s<9;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}}let B6=new Float32Array(4);class sT extends kc{constructor(e){super(e),this.current=B6}set(e,n,o){if(this.fetchUniformLocation(e,n)){for(let s=0;s<4;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function aT(t){return[KP(255*t.r,255*t.g),KP(255*t.b,255*t.a)]}class $m{constructor(e,n,o){this.value=e,this.uniformNames=n.map(s=>`u_${s}`),this.type=o}setUniform(e,n,o,s,l){n.set(e,l,s.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new zf(e):new Fe(e)}}class Bf{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,o,s,l){let u=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;u&&n.set(e,l,u)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Hs(e):new Fe(e)}}class Nc{constructor(e,n,o,s){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(l=>({name:`a_${l}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,n,o,s,l,u,d){let f=this.paintVertexArray.length,p=this.expression.evaluate(new ur(0,{brightness:u}),n,{},l,s,d);this.paintVertexArray.resize(e),this._setPaintValue(f,e,p)}updatePaintArray(e,n,o,s,l,u,d){let f=this.expression.evaluate({zoom:0,brightness:d},o,s,void 0,l);this._setPaintValue(e,n,f)}_setPaintValue(e,n,o){if(this.type==="color"){let s=aT(o);for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,s[0],s[1])}else{for(let s=e;s<n;s++)this.paintVertexArray.emplace(s,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hl{constructor(e,n,o,s,l,u){this.expression=e,this.uniformNames=n.map(d=>`u_${d}_t`),this.type=o,this.useIntegerZoom=s,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,o,s,l,u,d){let f=this.expression.evaluate(new ur(this.zoom,{brightness:u}),n,{},l,s,d),p=this.expression.evaluate(new ur(this.zoom+1,{brightness:u}),n,{},l,s,d),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,f,p)}updatePaintArray(e,n,o,s,l,u,d){let f=this.expression.evaluate({zoom:this.zoom,brightness:d},o,s,void 0,l),p=this.expression.evaluate({zoom:this.zoom+1,brightness:d},o,s,void 0,l);this._setPaintValue(e,n,f,p)}_setPaintValue(e,n,o,s){if(this.type==="color"){let l=aT(o),u=aT(s);for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,l[0],l[1],u[0],u[1])}else{for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,o,s);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,o,s,l){let u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,d=ze(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);n.set(e,l,d)}getBinding(e,n){return new Fe(e)}}class zu{constructor(e,n,o,s,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(o==="array"?L6:R6).members;for(let u=0;u<n.length;++u);this.paintVertexArray=new s}populatePaintArray(e,n,o){let s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(s,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,s,l,u,d){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],u)}_setPaintValues(e,n,o,s){if(!s||!o)return;let l=s[o];if(!l)return;let{tl:u,br:d,pixelRatio:f}=l;for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1],d[0],d[1],f)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ih{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[];let s=[];for(let l in e.paint._values){let u=e.paint.get(l);if(!o(l)||!(u instanceof Nf&&Jd(u.property.specification)))continue;let d=V6(l,e.type),f=u.value,p=u.property.specification.type,g=!!u.property.useIntegerZoom,_=l==="line-dasharray"||l.endsWith("pattern"),v=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(f.kind!=="constant"||v)if(f.kind==="source"||v||_){let x=nO(l,p,"source");this.binders[l]=_?new zu(f,d,p,x,e.id):new Nc(f,d,p,x),s.push(`/a_${l}`)}else{let x=nO(l,p,"composite");this.binders[l]=new hl(f,d,p,g,n,x),s.push(`/z_${l}`)}else this.binders[l]=_?new Bf(f.value,d):new $m(f.value,d,p),s.push(`/u_${l}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Nc||n instanceof hl?n.maxValue:0}populatePaintArrays(e,n,o,s,l,u,d){for(let f in this.binders){let p=this.binders[f];(p instanceof Nc||p instanceof hl||p instanceof zu)&&p.populatePaintArray(e,n,o,s,l,u,d)}}setConstantPatternPositions(e){for(let n in this.binders){let o=this.binders[n];o instanceof Bf&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,n,o,s,l,u,d,f){let p=!1,g=Object.keys(e),_=g.length!==0,v=_?g:n.uniqueIds;for(let x in this.binders){let b=this.binders[x];if((b instanceof Nc||b instanceof hl||b instanceof zu)&&(b.expression.isStateDependent===!0||b.expression.isLightConstant===!1)){let T=l.paint.get(x);b.expression=T.value;for(let E of v){let M=e[E.toString()];n.eachPosition(E,(S,P,O)=>{let A=s.feature(S);b.updatePaintArray(P,O,A,M,u,d,f)})}if(!_)for(let E of o.uniqueIds){let M=e[E.toString()];o.eachPosition(E,(S,P,O)=>{let A=s.feature(S);b.updatePaintArray(P,O,A,M,u,d,f)})}p=!0}}return p}defines(){let e=[];for(let n in this.binders){let o=this.binders[n];(o instanceof $m||o instanceof Bf)&&e.push(...o.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof Nc||o instanceof hl||o instanceof zu)for(let s=0;s<o.paintVertexAttributes.length;s++)e.push(o.paintVertexAttributes[s].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let o=this.binders[n];if(o instanceof $m||o instanceof Bf||o instanceof hl)for(let s of o.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let o in this.binders){let s=this.binders[o];if(s instanceof $m||s instanceof Bf||s instanceof hl)for(let l of s.uniformNames)n.push({name:l,property:o,binding:s.getBinding(e,l)})}return n}setUniforms(e,n,o,s,l){for(let{name:u,property:d,binding:f}of o)this.binders[d].setUniform(e,f,l,s.get(d),u)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Nc||n instanceof hl||n instanceof zu)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let o=this.binders[n];(o instanceof Nc||o instanceof hl||o instanceof zu)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Nc||n instanceof hl||n instanceof zu)&&n.destroy()}}}class Bu{constructor(e,n,o=()=>!0){this.programConfigurations={};for(let s of e)this.programConfigurations[s.id]=new ih(s,n,o);this.needsUpload=!1,this._featureMap=new Um,this._featureMapWithoutIds=new Um,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,o,s,l,u,d,f){for(let p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,s,l,u,d,f);n.id!==void 0?this._featureMap.add(n.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,s,l,u){for(let d of o)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,d,s,l,u||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let j6={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function V6(t,e){return j6[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let U6={"line-pattern":{source:ku,composite:ku},"fill-pattern":{source:ku,composite:ku},"fill-extrusion-pattern":{source:ku,composite:ku},"line-dasharray":{source:My,composite:My}},$6={color:{source:Vm,composite:Fc},number:{source:Bm,composite:Vm}};function nO(t,e,n){let o=U6[t];return o&&o[n]||$6[e][n]}pt($m,"ConstantBinder"),pt(Bf,"PatternConstantBinder"),pt(Nc,"SourceExpressionBinder"),pt(zu,"PatternCompositeBinder"),pt(hl,"CompositeExpressionBinder"),pt(ih,"ProgramConfiguration",{omit:["_buffers"]}),pt(Bu,"ProgramConfigurationSet");class Gs{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Xt?new Xt(e.lng,e.lat):Xt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Xt?new Xt(e.lng,e.lat):Xt.convert(e),this}extend(e){let n=this._sw,o=this._ne,s,l;if(e instanceof Xt)s=e,l=e;else{if(!(e instanceof Gs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Gs.convert(e)):this.extend(Xt.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Xt.convert(e)):this;if(s=e._sw,l=e._ne,!s||!l)return this}return n||o?(n.lng=Math.min(s.lng,n.lng),n.lat=Math.min(s.lat,n.lat),o.lng=Math.max(l.lng,o.lng),o.lat=Math.max(l.lat,o.lat)):(this._sw=new Xt(s.lng,s.lat),this._ne=new Xt(l.lng,l.lat)),this}getCenter(){return new Xt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xt(this.getWest(),this.getNorth())}getSouthEast(){return new Xt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:o}=Xt.convert(e),s=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&s}static convert(e){return!e||e instanceof Gs?e:new Gs(e)}}var Co={},So={};Object.defineProperty(So,"__esModule",{value:!0}),So.setMatrixArrayType=function(t){So.ARRAY_TYPE=rO=t},So.toRadian=function(t){return t*G6},So.equals=function(t,e){return Math.abs(t-e)<=iO*Math.max(1,Math.abs(t),Math.abs(e))},So.RANDOM=So.ARRAY_TYPE=So.EPSILON=void 0;var iO=1e-6;So.EPSILON=iO;var rO=typeof Float32Array<"u"?Float32Array:Array;So.ARRAY_TYPE=rO;var H6=Math.random;So.RANDOM=H6;var G6=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var hr={};function lT(t){return lT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lT(t)}Object.defineProperty(hr,"__esModule",{value:!0}),hr.create=function(){var t=new ju.ARRAY_TYPE(4);return ju.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},hr.clone=function(t){var e=new ju.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},hr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},hr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},hr.fromValues=function(t,e,n,o){var s=new ju.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=o,s},hr.set=function(t,e,n,o,s){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t},hr.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},hr.invert=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=n*l-s*o;return u?(t[0]=l*(u=1/u),t[1]=-o*u,t[2]=-s*u,t[3]=n*u,t):null},hr.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},hr.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},hr.multiply=sO,hr.rotate=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=Math.sin(n),f=Math.cos(n);return t[0]=o*f+l*d,t[1]=s*f+u*d,t[2]=o*-d+l*f,t[3]=s*-d+u*f,t},hr.scale=function(t,e,n){var o=e[1],s=e[2],l=e[3],u=n[0],d=n[1];return t[0]=e[0]*u,t[1]=o*u,t[2]=s*d,t[3]=l*d,t},hr.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t},hr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},hr.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},hr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},hr.LDU=function(t,e,n,o){return t[2]=o[2]/o[0],n[0]=o[0],n[1]=o[1],n[3]=o[3]-t[2]*n[1],[t,e,n]},hr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},hr.subtract=aO,hr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},hr.equals=function(t,e){var n=t[0],o=t[1],s=t[2],l=t[3],u=e[0],d=e[1],f=e[2],p=e[3];return Math.abs(n-u)<=ju.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-d)<=ju.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-f)<=ju.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-p)<=ju.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},hr.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},hr.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},hr.sub=hr.mul=void 0;var ju=function(t,e){if(t&&t.__esModule)return t;if(t===null||lT(t)!=="object"&&typeof t!="function")return{default:t};var n=oO(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}(So);function oO(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(oO=function(o){return o?n:e})(t)}function sO(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=n[0],f=n[1],p=n[2],g=n[3];return t[0]=o*d+l*f,t[1]=s*d+u*f,t[2]=o*p+l*g,t[3]=s*p+u*g,t}function aO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}hr.mul=sO,hr.sub=aO;var yr={};function cT(t){return cT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cT(t)}Object.defineProperty(yr,"__esModule",{value:!0}),yr.create=function(){var t=new Xl.ARRAY_TYPE(6);return Xl.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},yr.clone=function(t){var e=new Xl.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},yr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},yr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},yr.fromValues=function(t,e,n,o,s,l){var u=new Xl.ARRAY_TYPE(6);return u[0]=t,u[1]=e,u[2]=n,u[3]=o,u[4]=s,u[5]=l,u},yr.set=function(t,e,n,o,s,l,u){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t[4]=l,t[5]=u,t},yr.invert=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=e[4],d=e[5],f=n*l-o*s;return f?(t[0]=l*(f=1/f),t[1]=-o*f,t[2]=-s*f,t[3]=n*f,t[4]=(s*d-l*u)*f,t[5]=(o*u-n*d)*f,t):null},yr.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},yr.multiply=cO,yr.rotate=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=Math.sin(n),g=Math.cos(n);return t[0]=o*g+l*p,t[1]=s*g+u*p,t[2]=o*-p+l*g,t[3]=s*-p+u*g,t[4]=d,t[5]=f,t},yr.scale=function(t,e,n){var o=e[1],s=e[2],l=e[3],u=e[4],d=e[5],f=n[0],p=n[1];return t[0]=e[0]*f,t[1]=o*f,t[2]=s*p,t[3]=l*p,t[4]=u,t[5]=d,t},yr.translate=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=n[0],g=n[1];return t[0]=o,t[1]=s,t[2]=l,t[3]=u,t[4]=o*p+l*g+d,t[5]=s*p+u*g+f,t},yr.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t[4]=0,t[5]=0,t},yr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},yr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},yr.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},yr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},yr.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},yr.subtract=uO,yr.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},yr.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t},yr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},yr.equals=function(t,e){var n=t[0],o=t[1],s=t[2],l=t[3],u=t[4],d=t[5],f=e[0],p=e[1],g=e[2],_=e[3],v=e[4],x=e[5];return Math.abs(n-f)<=Xl.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-p)<=Xl.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-g)<=Xl.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-_)<=Xl.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-v)<=Xl.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(d-x)<=Xl.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))},yr.sub=yr.mul=void 0;var Xl=function(t,e){if(t&&t.__esModule)return t;if(t===null||cT(t)!=="object"&&typeof t!="function")return{default:t};var n=lO(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}(So);function lO(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(lO=function(o){return o?n:e})(t)}function cO(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=n[0],g=n[1],_=n[2],v=n[3],x=n[4],b=n[5];return t[0]=o*p+l*g,t[1]=s*p+u*g,t[2]=o*_+l*v,t[3]=s*_+u*v,t[4]=o*x+l*b+d,t[5]=s*x+u*b+f,t}function uO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}yr.mul=cO,yr.sub=uO;var Li={};function uT(t){return uT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uT(t)}Object.defineProperty(Li,"__esModule",{value:!0}),Li.create=function(){var t=new pa.ARRAY_TYPE(9);return pa.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Li.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Li.clone=function(t){var e=new pa.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Li.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Li.fromValues=function(t,e,n,o,s,l,u,d,f){var p=new pa.ARRAY_TYPE(9);return p[0]=t,p[1]=e,p[2]=n,p[3]=o,p[4]=s,p[5]=l,p[6]=u,p[7]=d,p[8]=f,p},Li.set=function(t,e,n,o,s,l,u,d,f,p){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t[4]=l,t[5]=u,t[6]=d,t[7]=f,t[8]=p,t},Li.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Li.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Li.invert=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=g*u-d*p,v=-g*l+d*f,x=p*l-u*f,b=n*_+o*v+s*x;return b?(t[0]=_*(b=1/b),t[1]=(-g*o+s*p)*b,t[2]=(d*o-s*u)*b,t[3]=v*b,t[4]=(g*n-s*f)*b,t[5]=(-d*n+s*l)*b,t[6]=x*b,t[7]=(-p*n+o*f)*b,t[8]=(u*n-o*l)*b,t):null},Li.adjoint=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8];return t[0]=u*g-d*p,t[1]=s*p-o*g,t[2]=o*d-s*u,t[3]=d*f-l*g,t[4]=n*g-s*f,t[5]=s*l-n*d,t[6]=l*p-u*f,t[7]=o*f-n*p,t[8]=n*u-o*l,t},Li.determinant=function(t){var e=t[3],n=t[4],o=t[5],s=t[6],l=t[7],u=t[8];return t[0]*(u*n-o*l)+t[1]*(-u*e+o*s)+t[2]*(l*e-n*s)},Li.multiply=hO,Li.translate=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],v=n[0],x=n[1];return t[0]=o,t[1]=s,t[2]=l,t[3]=u,t[4]=d,t[5]=f,t[6]=v*o+x*u+p,t[7]=v*s+x*d+g,t[8]=v*l+x*f+_,t},Li.rotate=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],v=Math.sin(n),x=Math.cos(n);return t[0]=x*o+v*u,t[1]=x*s+v*d,t[2]=x*l+v*f,t[3]=x*u-v*o,t[4]=x*d-v*s,t[5]=x*f-v*l,t[6]=p,t[7]=g,t[8]=_,t},Li.scale=function(t,e,n){var o=n[0],s=n[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Li.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Li.fromRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Li.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Li.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Li.fromQuat=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=n+n,d=o+o,f=s+s,p=n*u,g=o*u,_=o*d,v=s*u,x=s*d,b=s*f,T=l*u,E=l*d,M=l*f;return t[0]=1-_-b,t[3]=g-M,t[6]=v+E,t[1]=g+M,t[4]=1-p-b,t[7]=x-T,t[2]=v-E,t[5]=x+T,t[8]=1-p-_,t},Li.normalFromMat4=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=e[9],v=e[10],x=e[11],b=e[12],T=e[13],E=e[14],M=e[15],S=n*d-o*u,P=n*f-s*u,O=n*p-l*u,A=o*f-s*d,R=o*p-l*d,F=s*p-l*f,k=g*T-_*b,N=g*E-v*b,B=g*M-x*b,H=_*E-v*T,G=_*M-x*T,Y=v*M-x*E,U=S*Y-P*G+O*H+A*B-R*N+F*k;return U?(t[0]=(d*Y-f*G+p*H)*(U=1/U),t[1]=(f*B-u*Y-p*N)*U,t[2]=(u*G-d*B+p*k)*U,t[3]=(s*G-o*Y-l*H)*U,t[4]=(n*Y-s*B+l*N)*U,t[5]=(o*B-n*G-l*k)*U,t[6]=(T*F-E*R+M*A)*U,t[7]=(E*O-b*F-M*P)*U,t[8]=(b*R-T*O+M*S)*U,t):null},Li.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Li.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Li.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Li.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},Li.subtract=fO,Li.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},Li.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t},Li.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Li.equals=function(t,e){var n=t[0],o=t[1],s=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=e[0],v=e[1],x=e[2],b=e[3],T=e[4],E=e[5],M=e[6],S=e[7],P=e[8];return Math.abs(n-_)<=pa.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(o-v)<=pa.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-x)<=pa.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(l-b)<=pa.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-T)<=pa.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(d-E)<=pa.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(f-M)<=pa.EPSILON*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(p-S)<=pa.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(g-P)<=pa.EPSILON*Math.max(1,Math.abs(g),Math.abs(P))},Li.sub=Li.mul=void 0;var pa=function(t,e){if(t&&t.__esModule)return t;if(t===null||uT(t)!=="object"&&typeof t!="function")return{default:t};var n=dO(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}(So);function dO(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(dO=function(o){return o?n:e})(t)}function hO(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],v=n[0],x=n[1],b=n[2],T=n[3],E=n[4],M=n[5],S=n[6],P=n[7],O=n[8];return t[0]=v*o+x*u+b*p,t[1]=v*s+x*d+b*g,t[2]=v*l+x*f+b*_,t[3]=T*o+E*u+M*p,t[4]=T*s+E*d+M*g,t[5]=T*l+E*f+M*_,t[6]=S*o+P*u+O*p,t[7]=S*s+P*d+O*g,t[8]=S*l+P*f+O*_,t}function fO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Li.mul=hO,Li.sub=fO;var cn={};function dT(t){return dT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dT(t)}Object.defineProperty(cn,"__esModule",{value:!0}),cn.create=function(){var t=new Ar.ARRAY_TYPE(16);return Ar.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},cn.clone=function(t){var e=new Ar.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},cn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},cn.fromValues=function(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T){var E=new Ar.ARRAY_TYPE(16);return E[0]=t,E[1]=e,E[2]=n,E[3]=o,E[4]=s,E[5]=l,E[6]=u,E[7]=d,E[8]=f,E[9]=p,E[10]=g,E[11]=_,E[12]=v,E[13]=x,E[14]=b,E[15]=T,E},cn.set=function(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t[4]=l,t[5]=u,t[6]=d,t[7]=f,t[8]=p,t[9]=g,t[10]=_,t[11]=v,t[12]=x,t[13]=b,t[14]=T,t[15]=E,t},cn.identity=mO,cn.transpose=function(t,e){if(t===e){var n=e[1],o=e[2],s=e[3],l=e[6],u=e[7],d=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=l,t[11]=e[14],t[12]=s,t[13]=u,t[14]=d}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},cn.invert=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=e[9],v=e[10],x=e[11],b=e[12],T=e[13],E=e[14],M=e[15],S=n*d-o*u,P=n*f-s*u,O=n*p-l*u,A=o*f-s*d,R=o*p-l*d,F=s*p-l*f,k=g*T-_*b,N=g*E-v*b,B=g*M-x*b,H=_*E-v*T,G=_*M-x*T,Y=v*M-x*E,U=S*Y-P*G+O*H+A*B-R*N+F*k;return U?(t[0]=(d*Y-f*G+p*H)*(U=1/U),t[1]=(s*G-o*Y-l*H)*U,t[2]=(T*F-E*R+M*A)*U,t[3]=(v*R-_*F-x*A)*U,t[4]=(f*B-u*Y-p*N)*U,t[5]=(n*Y-s*B+l*N)*U,t[6]=(E*O-b*F-M*P)*U,t[7]=(g*F-v*O+x*P)*U,t[8]=(u*G-d*B+p*k)*U,t[9]=(o*B-n*G-l*k)*U,t[10]=(b*R-T*O+M*S)*U,t[11]=(_*O-g*R-x*S)*U,t[12]=(d*N-u*H-f*k)*U,t[13]=(n*H-o*N+s*k)*U,t[14]=(T*P-b*A-E*S)*U,t[15]=(g*A-_*P+v*S)*U,t):null},cn.adjoint=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=e[4],d=e[5],f=e[6],p=e[7],g=e[8],_=e[9],v=e[10],x=e[11],b=e[12],T=e[13],E=e[14],M=e[15];return t[0]=d*(v*M-x*E)-_*(f*M-p*E)+T*(f*x-p*v),t[1]=-(o*(v*M-x*E)-_*(s*M-l*E)+T*(s*x-l*v)),t[2]=o*(f*M-p*E)-d*(s*M-l*E)+T*(s*p-l*f),t[3]=-(o*(f*x-p*v)-d*(s*x-l*v)+_*(s*p-l*f)),t[4]=-(u*(v*M-x*E)-g*(f*M-p*E)+b*(f*x-p*v)),t[5]=n*(v*M-x*E)-g*(s*M-l*E)+b*(s*x-l*v),t[6]=-(n*(f*M-p*E)-u*(s*M-l*E)+b*(s*p-l*f)),t[7]=n*(f*x-p*v)-u*(s*x-l*v)+g*(s*p-l*f),t[8]=u*(_*M-x*T)-g*(d*M-p*T)+b*(d*x-p*_),t[9]=-(n*(_*M-x*T)-g*(o*M-l*T)+b*(o*x-l*_)),t[10]=n*(d*M-p*T)-u*(o*M-l*T)+b*(o*p-l*d),t[11]=-(n*(d*x-p*_)-u*(o*x-l*_)+g*(o*p-l*d)),t[12]=-(u*(_*E-v*T)-g*(d*E-f*T)+b*(d*v-f*_)),t[13]=n*(_*E-v*T)-g*(o*E-s*T)+b*(o*v-s*_),t[14]=-(n*(d*E-f*T)-u*(o*E-s*T)+b*(o*f-s*d)),t[15]=n*(d*v-f*_)-u*(o*v-s*_)+g*(o*f-s*d),t},cn.determinant=function(t){var e=t[0],n=t[1],o=t[2],s=t[3],l=t[4],u=t[5],d=t[6],f=t[7],p=t[8],g=t[9],_=t[10],v=t[11],x=t[12],b=t[13],T=t[14],E=t[15];return(e*u-n*l)*(_*E-v*T)-(e*d-o*l)*(g*E-v*b)+(e*f-s*l)*(g*T-_*b)+(n*d-o*u)*(p*E-v*x)-(n*f-s*u)*(p*T-_*x)+(o*f-s*d)*(p*b-g*x)},cn.multiply=gO,cn.translate=function(t,e,n){var o,s,l,u,d,f,p,g,_,v,x,b,T=n[0],E=n[1],M=n[2];return e===t?(t[12]=e[0]*T+e[4]*E+e[8]*M+e[12],t[13]=e[1]*T+e[5]*E+e[9]*M+e[13],t[14]=e[2]*T+e[6]*E+e[10]*M+e[14],t[15]=e[3]*T+e[7]*E+e[11]*M+e[15]):(s=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],v=e[9],x=e[10],b=e[11],t[0]=o=e[0],t[1]=s,t[2]=l,t[3]=u,t[4]=d,t[5]=f,t[6]=p,t[7]=g,t[8]=_,t[9]=v,t[10]=x,t[11]=b,t[12]=o*T+d*E+_*M+e[12],t[13]=s*T+f*E+v*M+e[13],t[14]=l*T+p*E+x*M+e[14],t[15]=u*T+g*E+b*M+e[15]),t},cn.scale=function(t,e,n){var o=n[0],s=n[1],l=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},cn.rotate=function(t,e,n,o){var s,l,u,d,f,p,g,_,v,x,b,T,E,M,S,P,O,A,R,F,k,N,B,H,G=o[0],Y=o[1],U=o[2],Q=Math.hypot(G,Y,U);return Q<Ar.EPSILON?null:(G*=Q=1/Q,Y*=Q,U*=Q,s=Math.sin(n),l=Math.cos(n),f=e[1],p=e[2],g=e[3],v=e[5],x=e[6],b=e[7],E=e[9],M=e[10],S=e[11],R=G*Y*(u=1-l)-U*s,F=Y*Y*u+l,k=U*Y*u+G*s,N=G*U*u+Y*s,B=Y*U*u-G*s,H=U*U*u+l,t[0]=(d=e[0])*(P=G*G*u+l)+(_=e[4])*(O=Y*G*u+U*s)+(T=e[8])*(A=U*G*u-Y*s),t[1]=f*P+v*O+E*A,t[2]=p*P+x*O+M*A,t[3]=g*P+b*O+S*A,t[4]=d*R+_*F+T*k,t[5]=f*R+v*F+E*k,t[6]=p*R+x*F+M*k,t[7]=g*R+b*F+S*k,t[8]=d*N+_*B+T*H,t[9]=f*N+v*B+E*H,t[10]=p*N+x*B+M*H,t[11]=g*N+b*B+S*H,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},cn.rotateX=function(t,e,n){var o=Math.sin(n),s=Math.cos(n),l=e[4],u=e[5],d=e[6],f=e[7],p=e[8],g=e[9],_=e[10],v=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*s+p*o,t[5]=u*s+g*o,t[6]=d*s+_*o,t[7]=f*s+v*o,t[8]=p*s-l*o,t[9]=g*s-u*o,t[10]=_*s-d*o,t[11]=v*s-f*o,t},cn.rotateY=function(t,e,n){var o=Math.sin(n),s=Math.cos(n),l=e[0],u=e[1],d=e[2],f=e[3],p=e[8],g=e[9],_=e[10],v=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*s-p*o,t[1]=u*s-g*o,t[2]=d*s-_*o,t[3]=f*s-v*o,t[8]=l*o+p*s,t[9]=u*o+g*s,t[10]=d*o+_*s,t[11]=f*o+v*s,t},cn.rotateZ=function(t,e,n){var o=Math.sin(n),s=Math.cos(n),l=e[0],u=e[1],d=e[2],f=e[3],p=e[4],g=e[5],_=e[6],v=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*s+p*o,t[1]=u*s+g*o,t[2]=d*s+_*o,t[3]=f*s+v*o,t[4]=p*s-l*o,t[5]=g*s-u*o,t[6]=_*s-d*o,t[7]=v*s-f*o,t},cn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},cn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},cn.fromRotation=function(t,e,n){var o,s,l,u=n[0],d=n[1],f=n[2],p=Math.hypot(u,d,f);return p<Ar.EPSILON?null:(u*=p=1/p,d*=p,f*=p,o=Math.sin(e),s=Math.cos(e),t[0]=u*u*(l=1-s)+s,t[1]=d*u*l+f*o,t[2]=f*u*l-d*o,t[3]=0,t[4]=u*d*l-f*o,t[5]=d*d*l+s,t[6]=f*d*l+u*o,t[7]=0,t[8]=u*f*l+d*o,t[9]=d*f*l-u*o,t[10]=f*f*l+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},cn.fromXRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},cn.fromYRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},cn.fromZRotation=function(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},cn.fromRotationTranslation=_O,cn.fromQuat2=function(t,e){var n=new Ar.ARRAY_TYPE(3),o=-e[0],s=-e[1],l=-e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=o*o+s*s+l*l+u*u;return _>0?(n[0]=2*(d*u+g*o+f*l-p*s)/_,n[1]=2*(f*u+g*s+p*o-d*l)/_,n[2]=2*(p*u+g*l+d*s-f*o)/_):(n[0]=2*(d*u+g*o+f*l-p*s),n[1]=2*(f*u+g*s+p*o-d*l),n[2]=2*(p*u+g*l+d*s-f*o)),_O(t,e,n),t},cn.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},cn.getScaling=yO,cn.getRotation=function(t,e){var n=new Ar.ARRAY_TYPE(3);yO(n,e);var o=1/n[0],s=1/n[1],l=1/n[2],u=e[0]*o,d=e[1]*s,f=e[2]*l,p=e[4]*o,g=e[5]*s,_=e[6]*l,v=e[8]*o,x=e[9]*s,b=e[10]*l,T=u+g+b,E=0;return T>0?(E=2*Math.sqrt(T+1),t[3]=.25*E,t[0]=(_-x)/E,t[1]=(v-f)/E,t[2]=(d-p)/E):u>g&&u>b?(E=2*Math.sqrt(1+u-g-b),t[3]=(_-x)/E,t[0]=.25*E,t[1]=(d+p)/E,t[2]=(v+f)/E):g>b?(E=2*Math.sqrt(1+g-u-b),t[3]=(v-f)/E,t[0]=(d+p)/E,t[1]=.25*E,t[2]=(_+x)/E):(E=2*Math.sqrt(1+b-u-g),t[3]=(d-p)/E,t[0]=(v+f)/E,t[1]=(_+x)/E,t[2]=.25*E),t},cn.fromRotationTranslationScale=function(t,e,n,o){var s=e[0],l=e[1],u=e[2],d=e[3],f=s+s,p=l+l,g=u+u,_=s*f,v=s*p,x=s*g,b=l*p,T=l*g,E=u*g,M=d*f,S=d*p,P=d*g,O=o[0],A=o[1],R=o[2];return t[0]=(1-(b+E))*O,t[1]=(v+P)*O,t[2]=(x-S)*O,t[3]=0,t[4]=(v-P)*A,t[5]=(1-(_+E))*A,t[6]=(T+M)*A,t[7]=0,t[8]=(x+S)*R,t[9]=(T-M)*R,t[10]=(1-(_+b))*R,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},cn.fromRotationTranslationScaleOrigin=function(t,e,n,o,s){var l=e[0],u=e[1],d=e[2],f=e[3],p=l+l,g=u+u,_=d+d,v=l*p,x=l*g,b=l*_,T=u*g,E=u*_,M=d*_,S=f*p,P=f*g,O=f*_,A=o[0],R=o[1],F=o[2],k=s[0],N=s[1],B=s[2],H=(1-(T+M))*A,G=(x+O)*A,Y=(b-P)*A,U=(x-O)*R,Q=(1-(v+M))*R,te=(E+S)*R,se=(b+P)*F,K=(E-S)*F,ee=(1-(v+T))*F;return t[0]=H,t[1]=G,t[2]=Y,t[3]=0,t[4]=U,t[5]=Q,t[6]=te,t[7]=0,t[8]=se,t[9]=K,t[10]=ee,t[11]=0,t[12]=n[0]+k-(H*k+U*N+se*B),t[13]=n[1]+N-(G*k+Q*N+K*B),t[14]=n[2]+B-(Y*k+te*N+ee*B),t[15]=1,t},cn.fromQuat=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=n+n,d=o+o,f=s+s,p=n*u,g=o*u,_=o*d,v=s*u,x=s*d,b=s*f,T=l*u,E=l*d,M=l*f;return t[0]=1-_-b,t[1]=g+M,t[2]=v-E,t[3]=0,t[4]=g-M,t[5]=1-p-b,t[6]=x+T,t[7]=0,t[8]=v+E,t[9]=x-T,t[10]=1-p-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},cn.frustum=function(t,e,n,o,s,l,u){var d=1/(n-e),f=1/(s-o),p=1/(l-u);return t[0]=2*l*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*l*f,t[6]=0,t[7]=0,t[8]=(n+e)*d,t[9]=(s+o)*f,t[10]=(u+l)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=u*l*2*p,t[15]=0,t},cn.perspectiveNO=vO,cn.perspectiveZO=function(t,e,n,o,s){var l,u=1/Math.tan(e/2);return t[0]=u/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=s*(l=1/(o-s)),t[14]=s*o*l):(t[10]=-1,t[14]=-o),t},cn.perspectiveFromFieldOfView=function(t,e,n,o){var s=Math.tan(e.upDegrees*Math.PI/180),l=Math.tan(e.downDegrees*Math.PI/180),u=Math.tan(e.leftDegrees*Math.PI/180),d=Math.tan(e.rightDegrees*Math.PI/180),f=2/(u+d),p=2/(s+l);return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=-(u-d)*f*.5,t[9]=(s-l)*p*.5,t[10]=o/(n-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n/(n-o),t[15]=0,t},cn.orthoNO=xO,cn.orthoZO=function(t,e,n,o,s,l,u){var d=1/(e-n),f=1/(o-s),p=1/(l-u);return t[0]=-2*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=p,t[11]=0,t[12]=(e+n)*d,t[13]=(s+o)*f,t[14]=l*p,t[15]=1,t},cn.lookAt=function(t,e,n,o){var s,l,u,d,f,p,g,_,v,x,b=e[0],T=e[1],E=e[2],M=o[0],S=o[1],P=o[2],O=n[0],A=n[1],R=n[2];return Math.abs(b-O)<Ar.EPSILON&&Math.abs(T-A)<Ar.EPSILON&&Math.abs(E-R)<Ar.EPSILON?mO(t):(g=b-O,_=T-A,v=E-R,s=S*(v*=x=1/Math.hypot(g,_,v))-P*(_*=x),l=P*(g*=x)-M*v,u=M*_-S*g,(x=Math.hypot(s,l,u))?(s*=x=1/x,l*=x,u*=x):(s=0,l=0,u=0),d=_*u-v*l,f=v*s-g*u,p=g*l-_*s,(x=Math.hypot(d,f,p))?(d*=x=1/x,f*=x,p*=x):(d=0,f=0,p=0),t[0]=s,t[1]=d,t[2]=g,t[3]=0,t[4]=l,t[5]=f,t[6]=_,t[7]=0,t[8]=u,t[9]=p,t[10]=v,t[11]=0,t[12]=-(s*b+l*T+u*E),t[13]=-(d*b+f*T+p*E),t[14]=-(g*b+_*T+v*E),t[15]=1,t)},cn.targetTo=function(t,e,n,o){var s=e[0],l=e[1],u=e[2],d=o[0],f=o[1],p=o[2],g=s-n[0],_=l-n[1],v=u-n[2],x=g*g+_*_+v*v;x>0&&(g*=x=1/Math.sqrt(x),_*=x,v*=x);var b=f*v-p*_,T=p*g-d*v,E=d*_-f*g;return(x=b*b+T*T+E*E)>0&&(b*=x=1/Math.sqrt(x),T*=x,E*=x),t[0]=b,t[1]=T,t[2]=E,t[3]=0,t[4]=_*E-v*T,t[5]=v*b-g*E,t[6]=g*T-_*b,t[7]=0,t[8]=g,t[9]=_,t[10]=v,t[11]=0,t[12]=s,t[13]=l,t[14]=u,t[15]=1,t},cn.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},cn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},cn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},cn.subtract=bO,cn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},cn.multiplyScalarAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t[9]=e[9]+n[9]*o,t[10]=e[10]+n[10]*o,t[11]=e[11]+n[11]*o,t[12]=e[12]+n[12]*o,t[13]=e[13]+n[13]*o,t[14]=e[14]+n[14]*o,t[15]=e[15]+n[15]*o,t},cn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},cn.equals=function(t,e){var n=t[0],o=t[1],s=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=t[8],_=t[9],v=t[10],x=t[11],b=t[12],T=t[13],E=t[14],M=t[15],S=e[0],P=e[1],O=e[2],A=e[3],R=e[4],F=e[5],k=e[6],N=e[7],B=e[8],H=e[9],G=e[10],Y=e[11],U=e[12],Q=e[13],te=e[14],se=e[15];return Math.abs(n-S)<=Ar.EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(o-P)<=Ar.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(s-O)<=Ar.EPSILON*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(l-A)<=Ar.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(u-R)<=Ar.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-F)<=Ar.EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(f-k)<=Ar.EPSILON*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(p-N)<=Ar.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(g-B)<=Ar.EPSILON*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(_-H)<=Ar.EPSILON*Math.max(1,Math.abs(_),Math.abs(H))&&Math.abs(v-G)<=Ar.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(x-Y)<=Ar.EPSILON*Math.max(1,Math.abs(x),Math.abs(Y))&&Math.abs(b-U)<=Ar.EPSILON*Math.max(1,Math.abs(b),Math.abs(U))&&Math.abs(T-Q)<=Ar.EPSILON*Math.max(1,Math.abs(T),Math.abs(Q))&&Math.abs(E-te)<=Ar.EPSILON*Math.max(1,Math.abs(E),Math.abs(te))&&Math.abs(M-se)<=Ar.EPSILON*Math.max(1,Math.abs(M),Math.abs(se))},cn.sub=cn.mul=cn.ortho=cn.perspective=void 0;var Ar=function(t,e){if(t&&t.__esModule)return t;if(t===null||dT(t)!=="object"&&typeof t!="function")return{default:t};var n=pO(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}(So);function pO(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(pO=function(o){return o?n:e})(t)}function mO(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gO(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=e[8],v=e[9],x=e[10],b=e[11],T=e[12],E=e[13],M=e[14],S=e[15],P=n[0],O=n[1],A=n[2],R=n[3];return t[0]=P*o+O*d+A*_+R*T,t[1]=P*s+O*f+A*v+R*E,t[2]=P*l+O*p+A*x+R*M,t[3]=P*u+O*g+A*b+R*S,t[4]=(P=n[4])*o+(O=n[5])*d+(A=n[6])*_+(R=n[7])*T,t[5]=P*s+O*f+A*v+R*E,t[6]=P*l+O*p+A*x+R*M,t[7]=P*u+O*g+A*b+R*S,t[8]=(P=n[8])*o+(O=n[9])*d+(A=n[10])*_+(R=n[11])*T,t[9]=P*s+O*f+A*v+R*E,t[10]=P*l+O*p+A*x+R*M,t[11]=P*u+O*g+A*b+R*S,t[12]=(P=n[12])*o+(O=n[13])*d+(A=n[14])*_+(R=n[15])*T,t[13]=P*s+O*f+A*v+R*E,t[14]=P*l+O*p+A*x+R*M,t[15]=P*u+O*g+A*b+R*S,t}function _O(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=o+o,f=s+s,p=l+l,g=o*d,_=o*f,v=o*p,x=s*f,b=s*p,T=l*p,E=u*d,M=u*f,S=u*p;return t[0]=1-(x+T),t[1]=_+S,t[2]=v-M,t[3]=0,t[4]=_-S,t[5]=1-(g+T),t[6]=b+E,t[7]=0,t[8]=v+M,t[9]=b-E,t[10]=1-(g+x),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function yO(t,e){var n=e[4],o=e[5],s=e[6],l=e[8],u=e[9],d=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,o,s),t[2]=Math.hypot(l,u,d),t}function vO(t,e,n,o,s){var l,u=1/Math.tan(e/2);return t[0]=u/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=(s+o)*(l=1/(o-s)),t[14]=2*s*o*l):(t[10]=-1,t[14]=-2*o),t}function xO(t,e,n,o,s,l,u){var d=1/(e-n),f=1/(o-s),p=1/(l-u);return t[0]=-2*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+n)*d,t[13]=(s+o)*f,t[14]=(u+l)*p,t[15]=1,t}function bO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}cn.perspective=vO,cn.ortho=xO,cn.mul=gO,cn.sub=bO;var rn={},ln={};function hT(t){return hT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hT(t)}Object.defineProperty(ln,"__esModule",{value:!0}),ln.create=TO,ln.clone=function(t){var e=new zc.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},ln.length=EO,ln.fromValues=function(t,e,n){var o=new zc.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=n,o},ln.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},ln.set=function(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t},ln.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},ln.subtract=MO,ln.multiply=IO,ln.divide=CO,ln.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},ln.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},ln.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},ln.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},ln.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},ln.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},ln.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t},ln.distance=SO,ln.squaredDistance=DO,ln.squaredLength=AO,ln.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},ln.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},ln.normalize=function(t,e){var n=e[0],o=e[1],s=e[2],l=n*n+o*o+s*s;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t},ln.dot=PO,ln.cross=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=n[0],d=n[1],f=n[2];return t[0]=s*f-l*d,t[1]=l*u-o*f,t[2]=o*d-s*u,t},ln.lerp=function(t,e,n,o){var s=e[0],l=e[1],u=e[2];return t[0]=s+o*(n[0]-s),t[1]=l+o*(n[1]-l),t[2]=u+o*(n[2]-u),t},ln.hermite=function(t,e,n,o,s,l){var u=l*l,d=u*(2*l-3)+1,f=u*(l-2)+l,p=u*(l-1),g=u*(3-2*l);return t[0]=e[0]*d+n[0]*f+o[0]*p+s[0]*g,t[1]=e[1]*d+n[1]*f+o[1]*p+s[1]*g,t[2]=e[2]*d+n[2]*f+o[2]*p+s[2]*g,t},ln.bezier=function(t,e,n,o,s,l){var u=1-l,d=u*u,f=l*l,p=d*u,g=3*l*d,_=3*f*u,v=f*l;return t[0]=e[0]*p+n[0]*g+o[0]*_+s[0]*v,t[1]=e[1]*p+n[1]*g+o[1]*_+s[1]*v,t[2]=e[2]*p+n[2]*g+o[2]*_+s[2]*v,t},ln.random=function(t,e){e=e||1;var n=2*zc.RANDOM()*Math.PI,o=2*zc.RANDOM()-1,s=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*s,t[1]=Math.sin(n)*s,t[2]=o*e,t},ln.transformMat4=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=n[3]*o+n[7]*s+n[11]*l+n[15];return t[0]=(n[0]*o+n[4]*s+n[8]*l+n[12])/(u=u||1),t[1]=(n[1]*o+n[5]*s+n[9]*l+n[13])/u,t[2]=(n[2]*o+n[6]*s+n[10]*l+n[14])/u,t},ln.transformMat3=function(t,e,n){var o=e[0],s=e[1],l=e[2];return t[0]=o*n[0]+s*n[3]+l*n[6],t[1]=o*n[1]+s*n[4]+l*n[7],t[2]=o*n[2]+s*n[5]+l*n[8],t},ln.transformQuat=function(t,e,n){var o=n[0],s=n[1],l=n[2],u=e[0],d=e[1],f=e[2],p=s*f-l*d,g=l*u-o*f,_=o*d-s*u,v=s*_-l*g,x=l*p-o*_,b=o*g-s*p,T=2*n[3];return g*=T,_*=T,x*=2,b*=2,t[0]=u+(p*=T)+(v*=2),t[1]=d+g+x,t[2]=f+_+b,t},ln.rotateX=function(t,e,n,o){var s=[],l=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],l[0]=s[0],l[1]=s[1]*Math.cos(o)-s[2]*Math.sin(o),l[2]=s[1]*Math.sin(o)+s[2]*Math.cos(o),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},ln.rotateY=function(t,e,n,o){var s=[],l=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],l[0]=s[2]*Math.sin(o)+s[0]*Math.cos(o),l[1]=s[1],l[2]=s[2]*Math.cos(o)-s[0]*Math.sin(o),t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},ln.rotateZ=function(t,e,n,o){var s=[],l=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],l[0]=s[0]*Math.cos(o)-s[1]*Math.sin(o),l[1]=s[0]*Math.sin(o)+s[1]*Math.cos(o),l[2]=s[2],t[0]=l[0]+n[0],t[1]=l[1]+n[1],t[2]=l[2]+n[2],t},ln.angle=function(t,e){var n=t[0],o=t[1],s=t[2],l=e[0],u=e[1],d=e[2],f=Math.sqrt(n*n+o*o+s*s)*Math.sqrt(l*l+u*u+d*d),p=f&&PO(t,e)/f;return Math.acos(Math.min(Math.max(p,-1),1))},ln.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},ln.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},ln.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},ln.equals=function(t,e){var n=t[0],o=t[1],s=t[2],l=e[0],u=e[1],d=e[2];return Math.abs(n-l)<=zc.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-u)<=zc.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(s-d)<=zc.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))},ln.forEach=ln.sqrLen=ln.len=ln.sqrDist=ln.dist=ln.div=ln.mul=ln.sub=void 0;var zc=function(t,e){if(t&&t.__esModule)return t;if(t===null||hT(t)!=="object"&&typeof t!="function")return{default:t};var n=wO(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}(So);function wO(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(wO=function(o){return o?n:e})(t)}function TO(){var t=new zc.ARRAY_TYPE(3);return zc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function EO(t){return Math.hypot(t[0],t[1],t[2])}function MO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function IO(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function CO(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function SO(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function DO(t,e){var n=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2];return n*n+o*o+s*s}function AO(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function PO(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}ln.sub=MO,ln.mul=IO,ln.div=CO,ln.dist=SO,ln.sqrDist=DO,ln.len=EO,ln.sqrLen=AO;var Bc,W6=(Bc=TO(),function(t,e,n,o,s,l){var u,d;for(e||(e=3),n||(n=0),d=o?Math.min(o*e+n,t.length):t.length,u=n;u<d;u+=e)Bc[0]=t[u],Bc[1]=t[u+1],Bc[2]=t[u+2],s(Bc,Bc,l),t[u]=Bc[0],t[u+1]=Bc[1],t[u+2]=Bc[2];return t});ln.forEach=W6;var An={};function fT(t){return fT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fT(t)}Object.defineProperty(An,"__esModule",{value:!0}),An.create=RO,An.clone=function(t){var e=new ja.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},An.fromValues=function(t,e,n,o){var s=new ja.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=o,s},An.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},An.set=function(t,e,n,o,s){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t},An.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},An.subtract=LO,An.multiply=FO,An.divide=kO,An.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},An.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},An.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},An.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},An.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},An.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},An.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t},An.distance=NO,An.squaredDistance=zO,An.length=BO,An.squaredLength=jO,An.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},An.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},An.normalize=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=n*n+o*o+s*s+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=n*u,t[1]=o*u,t[2]=s*u,t[3]=l*u,t},An.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},An.cross=function(t,e,n,o){var s=n[0]*o[1]-n[1]*o[0],l=n[0]*o[2]-n[2]*o[0],u=n[0]*o[3]-n[3]*o[0],d=n[1]*o[2]-n[2]*o[1],f=n[1]*o[3]-n[3]*o[1],p=n[2]*o[3]-n[3]*o[2],g=e[0],_=e[1],v=e[2],x=e[3];return t[0]=_*p-v*f+x*d,t[1]=-g*p+v*u-x*l,t[2]=g*f-_*u+x*s,t[3]=-g*d+_*l-v*s,t},An.lerp=function(t,e,n,o){var s=e[0],l=e[1],u=e[2],d=e[3];return t[0]=s+o*(n[0]-s),t[1]=l+o*(n[1]-l),t[2]=u+o*(n[2]-u),t[3]=d+o*(n[3]-d),t},An.random=function(t,e){var n,o,s,l,u,d;e=e||1;do u=(n=2*ja.RANDOM()-1)*n+(o=2*ja.RANDOM()-1)*o;while(u>=1);do d=(s=2*ja.RANDOM()-1)*s+(l=2*ja.RANDOM()-1)*l;while(d>=1);var f=Math.sqrt((1-u)/d);return t[0]=e*n,t[1]=e*o,t[2]=e*s*f,t[3]=e*l*f,t},An.transformMat4=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3];return t[0]=n[0]*o+n[4]*s+n[8]*l+n[12]*u,t[1]=n[1]*o+n[5]*s+n[9]*l+n[13]*u,t[2]=n[2]*o+n[6]*s+n[10]*l+n[14]*u,t[3]=n[3]*o+n[7]*s+n[11]*l+n[15]*u,t},An.transformQuat=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=n[0],d=n[1],f=n[2],p=n[3],g=p*o+d*l-f*s,_=p*s+f*o-u*l,v=p*l+u*s-d*o,x=-u*o-d*s-f*l;return t[0]=g*p+x*-u+_*-f-v*-d,t[1]=_*p+x*-d+v*-u-g*-f,t[2]=v*p+x*-f+g*-d-_*-u,t[3]=e[3],t},An.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},An.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},An.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},An.equals=function(t,e){var n=t[0],o=t[1],s=t[2],l=t[3],u=e[0],d=e[1],f=e[2],p=e[3];return Math.abs(n-u)<=ja.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-d)<=ja.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-f)<=ja.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(l-p)<=ja.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},An.forEach=An.sqrLen=An.len=An.sqrDist=An.dist=An.div=An.mul=An.sub=void 0;var ja=function(t,e){if(t&&t.__esModule)return t;if(t===null||fT(t)!=="object"&&typeof t!="function")return{default:t};var n=OO(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}(So);function OO(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(OO=function(o){return o?n:e})(t)}function RO(){var t=new ja.ARRAY_TYPE(4);return ja.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function LO(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function FO(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function kO(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function NO(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function zO(t,e){var n=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2],l=e[3]-t[3];return n*n+o*o+s*s+l*l}function BO(t){return Math.hypot(t[0],t[1],t[2],t[3])}function jO(t){var e=t[0],n=t[1],o=t[2],s=t[3];return e*e+n*n+o*o+s*s}An.sub=LO,An.mul=FO,An.div=kO,An.dist=NO,An.sqrDist=zO,An.len=BO,An.sqrLen=jO;var q6=function(){var t=RO();return function(e,n,o,s,l,u){var d,f;for(n||(n=4),o||(o=0),f=s?Math.min(s*n+o,e.length):e.length,d=o;d<f;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],t[3]=e[d+3],l(t,t,u),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2],e[d+3]=t[3];return e}}();function pT(t){return pT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pT(t)}An.forEach=q6,Object.defineProperty(rn,"__esModule",{value:!0}),rn.create=mT,rn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},rn.setAxisAngle=UO,rn.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),o=Math.sin(n/2);return o>rh.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),n},rn.getAngle=function(t,e){var n=ZO(t,e);return Math.acos(2*n*n-1)},rn.multiply=$O,rn.rotateX=function(t,e,n){n*=.5;var o=e[0],s=e[1],l=e[2],u=e[3],d=Math.sin(n),f=Math.cos(n);return t[0]=o*f+u*d,t[1]=s*f+l*d,t[2]=l*f-s*d,t[3]=u*f-o*d,t},rn.rotateY=function(t,e,n){n*=.5;var o=e[0],s=e[1],l=e[2],u=e[3],d=Math.sin(n),f=Math.cos(n);return t[0]=o*f-l*d,t[1]=s*f+u*d,t[2]=l*f+o*d,t[3]=u*f-s*d,t},rn.rotateZ=function(t,e,n){n*=.5;var o=e[0],s=e[1],l=e[2],u=e[3],d=Math.sin(n),f=Math.cos(n);return t[0]=o*f+s*d,t[1]=s*f-o*d,t[2]=l*f+u*d,t[3]=u*f-l*d,t},rn.calculateW=function(t,e){var n=e[0],o=e[1],s=e[2];return t[0]=n,t[1]=o,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-o*o-s*s)),t},rn.exp=HO,rn.ln=GO,rn.pow=function(t,e,n){return GO(t,e),qO(t,t,n),HO(t,t),t},rn.slerp=Oy,rn.random=function(t){var e=rh.RANDOM(),n=rh.RANDOM(),o=rh.RANDOM(),s=Math.sqrt(1-e),l=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*n),t[1]=s*Math.cos(2*Math.PI*n),t[2]=l*Math.sin(2*Math.PI*o),t[3]=l*Math.cos(2*Math.PI*o),t},rn.invert=function(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=n*n+o*o+s*s+l*l,d=u?1/u:0;return t[0]=-n*d,t[1]=-o*d,t[2]=-s*d,t[3]=l*d,t},rn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},rn.fromMat3=WO,rn.fromEuler=function(t,e,n,o){var s=.5*Math.PI/180;e*=s,n*=s,o*=s;var l=Math.sin(e),u=Math.cos(e),d=Math.sin(n),f=Math.cos(n),p=Math.sin(o),g=Math.cos(o);return t[0]=l*f*g-u*d*p,t[1]=u*d*g+l*f*p,t[2]=u*f*p-l*d*g,t[3]=u*f*g+l*d*p,t},rn.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},rn.setAxes=rn.sqlerp=rn.rotationTo=rn.equals=rn.exactEquals=rn.normalize=rn.sqrLen=rn.squaredLength=rn.len=rn.length=rn.lerp=rn.dot=rn.scale=rn.mul=rn.add=rn.set=rn.copy=rn.fromValues=rn.clone=void 0;var rh=Py(So),Z6=Py(Li),jc=Py(ln),ma=Py(An);function VO(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(VO=function(o){return o?n:e})(t)}function Py(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||pT(t)!=="object"&&typeof t!="function")return{default:t};var n=VO(e);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}function mT(){var t=new rh.ARRAY_TYPE(4);return rh.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function UO(t,e,n){n*=.5;var o=Math.sin(n);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(n),t}function $O(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=n[0],f=n[1],p=n[2],g=n[3];return t[0]=o*g+u*d+s*p-l*f,t[1]=s*g+u*f+l*d-o*p,t[2]=l*g+u*p+o*f-s*d,t[3]=u*g-o*d-s*f-l*p,t}function HO(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=Math.sqrt(n*n+o*o+s*s),d=Math.exp(l),f=u>0?d*Math.sin(u)/u:0;return t[0]=n*f,t[1]=o*f,t[2]=s*f,t[3]=d*Math.cos(u),t}function GO(t,e){var n=e[0],o=e[1],s=e[2],l=e[3],u=Math.sqrt(n*n+o*o+s*s),d=u>0?Math.atan2(u,l)/u:0;return t[0]=n*d,t[1]=o*d,t[2]=s*d,t[3]=.5*Math.log(n*n+o*o+s*s+l*l),t}function Oy(t,e,n,o){var s,l,u,d,f,p=e[0],g=e[1],_=e[2],v=e[3],x=n[0],b=n[1],T=n[2],E=n[3];return(l=p*x+g*b+_*T+v*E)<0&&(l=-l,x=-x,b=-b,T=-T,E=-E),1-l>rh.EPSILON?(s=Math.acos(l),u=Math.sin(s),d=Math.sin((1-o)*s)/u,f=Math.sin(o*s)/u):(d=1-o,f=o),t[0]=d*p+f*x,t[1]=d*g+f*b,t[2]=d*_+f*T,t[3]=d*v+f*E,t}function WO(t,e){var n,o=e[0]+e[4]+e[8];if(o>0)n=Math.sqrt(o+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var l=(s+1)%3,u=(s+2)%3;n=Math.sqrt(e[3*s+s]-e[3*l+l]-e[3*u+u]+1),t[s]=.5*n,t[3]=(e[3*l+u]-e[3*u+l])*(n=.5/n),t[l]=(e[3*l+s]+e[3*s+l])*n,t[u]=(e[3*u+s]+e[3*s+u])*n}return t}rn.clone=ma.clone,rn.fromValues=ma.fromValues,rn.copy=ma.copy,rn.set=ma.set,rn.add=ma.add,rn.mul=$O;var qO=ma.scale;rn.scale=qO;var ZO=ma.dot;rn.dot=ZO,rn.lerp=ma.lerp;var YO=ma.length;rn.length=YO,rn.len=YO;var XO=ma.squaredLength;rn.squaredLength=XO,rn.sqrLen=XO;var gT=ma.normalize;rn.normalize=gT,rn.exactEquals=ma.exactEquals,rn.equals=ma.equals;var fl,KO,JO,Y6=(fl=jc.create(),KO=jc.fromValues(1,0,0),JO=jc.fromValues(0,1,0),function(t,e,n){var o=jc.dot(e,n);return o<-.999999?(jc.cross(fl,KO,e),jc.len(fl)<1e-6&&jc.cross(fl,JO,e),jc.normalize(fl,fl),UO(t,fl,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(jc.cross(fl,e,n),t[0]=fl[0],t[1]=fl[1],t[2]=fl[2],t[3]=1+o,gT(t,t))});rn.rotationTo=Y6;var _T,yT,X6=(_T=mT(),yT=mT(),function(t,e,n,o,s,l){return Oy(_T,e,s,l),Oy(yT,n,o,l),Oy(t,_T,yT,2*l*(1-l)),t});rn.sqlerp=X6;var pl,K6=(pl=Z6.create(),function(t,e,n,o){return pl[0]=n[0],pl[3]=n[1],pl[6]=n[2],pl[1]=o[0],pl[4]=o[1],pl[7]=o[2],pl[2]=-e[0],pl[5]=-e[1],pl[8]=-e[2],gT(t,WO(t,pl))});rn.setAxes=K6;var kn={};function vT(t){return vT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vT(t)}Object.defineProperty(kn,"__esModule",{value:!0}),kn.create=function(){var t=new Ds.ARRAY_TYPE(8);return Ds.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},kn.clone=function(t){var e=new Ds.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},kn.fromValues=function(t,e,n,o,s,l,u,d){var f=new Ds.ARRAY_TYPE(8);return f[0]=t,f[1]=e,f[2]=n,f[3]=o,f[4]=s,f[5]=l,f[6]=u,f[7]=d,f},kn.fromRotationTranslationValues=function(t,e,n,o,s,l,u){var d=new Ds.ARRAY_TYPE(8);d[0]=t,d[1]=e,d[2]=n,d[3]=o;var f=.5*s,p=.5*l,g=.5*u;return d[4]=f*o+p*n-g*e,d[5]=p*o+g*t-f*n,d[6]=g*o+f*e-p*t,d[7]=-f*t-p*e-g*n,d},kn.fromRotationTranslation=t2,kn.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},kn.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},kn.fromMat4=function(t,e){var n=Vc.create();QO.getRotation(n,e);var o=new Ds.ARRAY_TYPE(3);return QO.getTranslation(o,e),t2(t,n,o),t},kn.copy=n2,kn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},kn.set=function(t,e,n,o,s,l,u,d,f){return t[0]=e,t[1]=n,t[2]=o,t[3]=s,t[4]=l,t[5]=u,t[6]=d,t[7]=f,t},kn.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},kn.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},kn.getTranslation=function(t,e){var n=e[4],o=e[5],s=e[6],l=e[7],u=-e[0],d=-e[1],f=-e[2],p=e[3];return t[0]=2*(n*p+l*u+o*f-s*d),t[1]=2*(o*p+l*d+s*u-n*f),t[2]=2*(s*p+l*f+n*d-o*u),t},kn.translate=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=.5*n[0],f=.5*n[1],p=.5*n[2],g=e[4],_=e[5],v=e[6],x=e[7];return t[0]=o,t[1]=s,t[2]=l,t[3]=u,t[4]=u*d+s*p-l*f+g,t[5]=u*f+l*d-o*p+_,t[6]=u*p+o*f-s*d+v,t[7]=-o*d-s*f-l*p+x,t},kn.rotateX=function(t,e,n){var o=-e[0],s=-e[1],l=-e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=d*u+g*o+f*l-p*s,v=f*u+g*s+p*o-d*l,x=p*u+g*l+d*s-f*o,b=g*u-d*o-f*s-p*l;return Vc.rotateX(t,e,n),t[4]=_*(u=t[3])+b*(o=t[0])+v*(l=t[2])-x*(s=t[1]),t[5]=v*u+b*s+x*o-_*l,t[6]=x*u+b*l+_*s-v*o,t[7]=b*u-_*o-v*s-x*l,t},kn.rotateY=function(t,e,n){var o=-e[0],s=-e[1],l=-e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=d*u+g*o+f*l-p*s,v=f*u+g*s+p*o-d*l,x=p*u+g*l+d*s-f*o,b=g*u-d*o-f*s-p*l;return Vc.rotateY(t,e,n),t[4]=_*(u=t[3])+b*(o=t[0])+v*(l=t[2])-x*(s=t[1]),t[5]=v*u+b*s+x*o-_*l,t[6]=x*u+b*l+_*s-v*o,t[7]=b*u-_*o-v*s-x*l,t},kn.rotateZ=function(t,e,n){var o=-e[0],s=-e[1],l=-e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],_=d*u+g*o+f*l-p*s,v=f*u+g*s+p*o-d*l,x=p*u+g*l+d*s-f*o,b=g*u-d*o-f*s-p*l;return Vc.rotateZ(t,e,n),t[4]=_*(u=t[3])+b*(o=t[0])+v*(l=t[2])-x*(s=t[1]),t[5]=v*u+b*s+x*o-_*l,t[6]=x*u+b*l+_*s-v*o,t[7]=b*u-_*o-v*s-x*l,t},kn.rotateByQuatAppend=function(t,e,n){var o=n[0],s=n[1],l=n[2],u=n[3],d=e[0],f=e[1],p=e[2],g=e[3];return t[0]=d*u+g*o+f*l-p*s,t[1]=f*u+g*s+p*o-d*l,t[2]=p*u+g*l+d*s-f*o,t[3]=g*u-d*o-f*s-p*l,t[4]=(d=e[4])*u+(g=e[7])*o+(f=e[5])*l-(p=e[6])*s,t[5]=f*u+g*s+p*o-d*l,t[6]=p*u+g*l+d*s-f*o,t[7]=g*u-d*o-f*s-p*l,t},kn.rotateByQuatPrepend=function(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=n[0],f=n[1],p=n[2],g=n[3];return t[0]=o*g+u*d+s*p-l*f,t[1]=s*g+u*f+l*d-o*p,t[2]=l*g+u*p+o*f-s*d,t[3]=u*g-o*d-s*f-l*p,t[4]=o*(g=n[7])+u*(d=n[4])+s*(p=n[6])-l*(f=n[5]),t[5]=s*g+u*f+l*d-o*p,t[6]=l*g+u*p+o*f-s*d,t[7]=u*g-o*d-s*f-l*p,t},kn.rotateAroundAxis=function(t,e,n,o){if(Math.abs(o)<Ds.EPSILON)return n2(t,e);var s=Math.hypot(n[0],n[1],n[2]);o*=.5;var l=Math.sin(o),u=l*n[0]/s,d=l*n[1]/s,f=l*n[2]/s,p=Math.cos(o),g=e[0],_=e[1],v=e[2],x=e[3];t[0]=g*p+x*u+_*f-v*d,t[1]=_*p+x*d+v*u-g*f,t[2]=v*p+x*f+g*d-_*u,t[3]=x*p-g*u-_*d-v*f;var b=e[4],T=e[5],E=e[6],M=e[7];return t[4]=b*p+M*u+T*f-E*d,t[5]=T*p+M*d+E*u-b*f,t[6]=E*p+M*f+b*d-T*u,t[7]=M*p-b*u-T*d-E*f,t},kn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},kn.multiply=i2,kn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},kn.lerp=function(t,e,n,o){var s=1-o;return r2(e,n)<0&&(o=-o),t[0]=e[0]*s+n[0]*o,t[1]=e[1]*s+n[1]*o,t[2]=e[2]*s+n[2]*o,t[3]=e[3]*s+n[3]*o,t[4]=e[4]*s+n[4]*o,t[5]=e[5]*s+n[5]*o,t[6]=e[6]*s+n[6]*o,t[7]=e[7]*s+n[7]*o,t},kn.invert=function(t,e){var n=Ry(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},kn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},kn.normalize=function(t,e){var n=Ry(e);if(n>0){n=Math.sqrt(n);var o=e[0]/n,s=e[1]/n,l=e[2]/n,u=e[3]/n,d=e[4],f=e[5],p=e[6],g=e[7],_=o*d+s*f+l*p+u*g;t[0]=o,t[1]=s,t[2]=l,t[3]=u,t[4]=(d-o*_)/n,t[5]=(f-s*_)/n,t[6]=(p-l*_)/n,t[7]=(g-u*_)/n}return t},kn.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},kn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},kn.equals=function(t,e){var n=t[0],o=t[1],s=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],g=e[0],_=e[1],v=e[2],x=e[3],b=e[4],T=e[5],E=e[6],M=e[7];return Math.abs(n-g)<=Ds.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-_)<=Ds.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-v)<=Ds.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(l-x)<=Ds.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(u-b)<=Ds.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-T)<=Ds.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(f-E)<=Ds.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(p-M)<=Ds.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))},kn.sqrLen=kn.squaredLength=kn.len=kn.length=kn.dot=kn.mul=kn.setReal=kn.getReal=void 0;var Ds=xT(So),Vc=xT(rn),QO=xT(cn);function e2(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(e2=function(o){return o?n:e})(t)}function xT(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||vT(t)!=="object"&&typeof t!="function")return{default:t};var n=e2(e);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}function t2(t,e,n){var o=.5*n[0],s=.5*n[1],l=.5*n[2],u=e[0],d=e[1],f=e[2],p=e[3];return t[0]=u,t[1]=d,t[2]=f,t[3]=p,t[4]=o*p+s*f-l*d,t[5]=s*p+l*u-o*f,t[6]=l*p+o*d-s*u,t[7]=-o*u-s*d-l*f,t}function n2(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function i2(t,e,n){var o=e[0],s=e[1],l=e[2],u=e[3],d=n[4],f=n[5],p=n[6],g=n[7],_=e[4],v=e[5],x=e[6],b=e[7],T=n[0],E=n[1],M=n[2],S=n[3];return t[0]=o*S+u*T+s*M-l*E,t[1]=s*S+u*E+l*T-o*M,t[2]=l*S+u*M+o*E-s*T,t[3]=u*S-o*T-s*E-l*M,t[4]=o*g+u*d+s*p-l*f+_*S+b*T+v*M-x*E,t[5]=s*g+u*f+l*d-o*p+v*S+b*E+x*T-_*M,t[6]=l*g+u*p+o*f-s*d+x*S+b*M+_*E-v*T,t[7]=u*g-o*d-s*f-l*p+b*S-_*T-v*E-x*M,t}kn.getReal=Vc.copy,kn.setReal=Vc.copy,kn.mul=i2;var r2=Vc.dot;kn.dot=r2;var o2=Vc.length;kn.length=o2,kn.len=o2;var Ry=Vc.squaredLength;kn.squaredLength=Ry,kn.sqrLen=Ry;var xn={};function bT(t){return bT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bT(t)}Object.defineProperty(xn,"__esModule",{value:!0}),xn.create=a2,xn.clone=function(t){var e=new oh.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},xn.fromValues=function(t,e){var n=new oh.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},xn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},xn.set=function(t,e,n){return t[0]=e,t[1]=n,t},xn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},xn.subtract=l2,xn.multiply=c2,xn.divide=u2,xn.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},xn.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},xn.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},xn.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},xn.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},xn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},xn.scaleAndAdd=function(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t},xn.distance=d2,xn.squaredDistance=h2,xn.length=f2,xn.squaredLength=p2,xn.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},xn.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},xn.normalize=function(t,e){var n=e[0],o=e[1],s=n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t},xn.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},xn.cross=function(t,e,n){var o=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=o,t},xn.lerp=function(t,e,n,o){var s=e[0],l=e[1];return t[0]=s+o*(n[0]-s),t[1]=l+o*(n[1]-l),t},xn.random=function(t,e){e=e||1;var n=2*oh.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},xn.transformMat2=function(t,e,n){var o=e[0],s=e[1];return t[0]=n[0]*o+n[2]*s,t[1]=n[1]*o+n[3]*s,t},xn.transformMat2d=function(t,e,n){var o=e[0],s=e[1];return t[0]=n[0]*o+n[2]*s+n[4],t[1]=n[1]*o+n[3]*s+n[5],t},xn.transformMat3=function(t,e,n){var o=e[0],s=e[1];return t[0]=n[0]*o+n[3]*s+n[6],t[1]=n[1]*o+n[4]*s+n[7],t},xn.transformMat4=function(t,e,n){var o=e[0],s=e[1];return t[0]=n[0]*o+n[4]*s+n[12],t[1]=n[1]*o+n[5]*s+n[13],t},xn.rotate=function(t,e,n,o){var s=e[0]-n[0],l=e[1]-n[1],u=Math.sin(o),d=Math.cos(o);return t[0]=s*d-l*u+n[0],t[1]=s*u+l*d+n[1],t},xn.angle=function(t,e){var n=t[0],o=t[1],s=e[0],l=e[1],u=Math.sqrt(n*n+o*o)*Math.sqrt(s*s+l*l);return Math.acos(Math.min(Math.max(u&&(n*s+o*l)/u,-1),1))},xn.zero=function(t){return t[0]=0,t[1]=0,t},xn.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},xn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},xn.equals=function(t,e){var n=t[0],o=t[1],s=e[0],l=e[1];return Math.abs(n-s)<=oh.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-l)<=oh.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))},xn.forEach=xn.sqrLen=xn.sqrDist=xn.dist=xn.div=xn.mul=xn.sub=xn.len=void 0;var oh=function(t,e){if(t&&t.__esModule)return t;if(t===null||bT(t)!=="object"&&typeof t!="function")return{default:t};var n=s2(void 0);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}(So);function s2(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(s2=function(o){return o?n:e})(t)}function a2(){var t=new oh.ARRAY_TYPE(2);return oh.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function l2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function c2(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function u2(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function d2(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function h2(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o}function f2(t){return Math.hypot(t[0],t[1])}function p2(t){var e=t[0],n=t[1];return e*e+n*n}xn.len=f2,xn.sub=l2,xn.mul=c2,xn.div=u2,xn.dist=d2,xn.sqrDist=h2,xn.sqrLen=p2;var J6=function(){var t=a2();return function(e,n,o,s,l,u){var d,f;for(n||(n=2),o||(o=0),f=s?Math.min(s*n+o,e.length):e.length,d=o;d<f;d+=n)t[0]=e[d],t[1]=e[d+1],l(t,t,u),e[d]=t[0],e[d+1]=t[1];return e}}();function wT(t){return wT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wT(t)}xn.forEach=J6,Object.defineProperty(Co,"__esModule",{value:!0});var Ei=Co.vec4=Z=Co.vec3=Co.vec2=Co.quat2=Wo=Co.quat=ae=Co.mat4=As=Co.mat3=Co.mat2d=jf=Co.mat2=Co.glMatrix=void 0,Q6=Kl(So);Co.glMatrix=Q6;var eH=Kl(hr),jf=Co.mat2=eH,tH=Kl(yr);Co.mat2d=tH;var nH=Kl(Li),As=Co.mat3=nH,iH=Kl(cn),ae=Co.mat4=iH,rH=Kl(rn),Wo=Co.quat=rH,oH=Kl(kn);Co.quat2=oH;var sH=Kl(xn);Co.vec2=sH;var aH=Kl(ln),Z=Co.vec3=aH,lH=Kl(An);function m2(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(m2=function(o){return o?n:e})(t)}function Kl(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||wT(t)!=="object"&&typeof t!="function")return{default:t};var n=m2(e);if(n&&n.has(t))return n.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in t)if(l!=="default"&&Object.prototype.hasOwnProperty.call(t,l)){var u=s?Object.getOwnPropertyDescriptor(t,l):null;u&&(u.get||u.set)?Object.defineProperty(o,l,u):o[l]=t[l]}return o.default=t,n&&n.set(t,o),o}Ei=Co.vec4=lH;let cH=ri([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ly}=cH,g2=ri([{name:"a_pos_3",components:3,type:"Int16"}]);var Vu=ri([{name:"a_pos",type:"Int16",components:2}]),_2={};(function(t,e){(function(n){function o(l,u,d){var f=s(256*l,256*(u=Math.pow(2,d)-u-1),d),p=s(256*(l+1),256*(u+1),d);return f[0]+","+f[1]+","+p[0]+","+p[1]}function s(l,u,d){var f=2*Math.PI*6378137/256/Math.pow(2,d);return[l*f-2*Math.PI*6378137/2,u*f-2*Math.PI*6378137/2]}n.getURL=function(l,u,d,f,p,g){return g=g||{},l+"?"+["bbox="+o(d,f,p),"format="+(g.format||"image/png"),"service="+(g.service||"WMS"),"version="+(g.version||"1.1.1"),"request="+(g.request||"GetMap"),"srs="+(g.srs||"EPSG:3857"),"width="+(g.width||256),"height="+(g.height||256),"layers="+u].join("&")},n.getTileBBox=o,n.getMercCoords=s,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,_2);var uH=_2;class Va{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=Hm(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let o=uH.getTileBBox(this.x,this.y,this.z),s=function(l,u,d){let f,p="";for(let g=l;g>0;g--)f=1<<g-1,p+=(u&f?1:0)+(d&f?2:0);return p}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class TT{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Hm(e,n.z,n.z,n.x,n.y)}}class qn{constructor(e,n,o,s,l){this.overscaledZ=e,this.wrap=n,this.canonical=new Va(o,+s,+l),this.key=n===0&&e===o?this.canonical.key:Hm(n,e,o,s,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new qn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Hm(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-e;return Hm(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new qn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,o=2*this.canonical.x,s=2*this.canonical.y;return[new qn(n,this.wrap,n,o,s),new qn(n,this.wrap,n,o+1,s),new qn(n,this.wrap,n,o,s+1),new qn(n,this.wrap,n,o+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new qn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new qn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new TT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Hm(t,e,n,o,s){let l=1<<Math.min(n,22),u=l*(s%l)+o%l;return t&&n<22&&(u+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*u+n)+(e-n)}let y2=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new qn(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new qn(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new qn(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new qn(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];pt(Va,"CanonicalTileID"),pt(qn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class Fy{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){let s=Z.dot(n,this.dir);if(Math.abs(s)<1e-6)return!1;let l=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/s;return o[0]=this.pos[0]+this.dir[0]*l,o[1]=this.pos[1]+this.dir[1]*l,o[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,n,o){if(Z.equals(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;let[s,l,u]=this.dir,d=this.pos[0]-e[0],f=this.pos[1]-e[1],p=this.pos[2]-e[2],g=s*s+l*l+u*u,_=2*(d*s+f*l+p*u),v=_*_-4*g*(d*d+f*f+p*p-n*n);if(v<0){let x=Math.max(-_/2,0),b=d+s*x,T=f+l*x,E=p+u*x,M=Math.hypot(b,T,E);return o[0]=b*n/M,o[1]=T*n/M,o[2]=E*n/M,!1}{let x=(-_-Math.sqrt(v))/(2*g);if(x<0){let b=Math.hypot(d,f,p);return o[0]=d*n/b,o[1]=f*n/b,o[2]=p*n/b,!1}return o[0]=d+s*x,o[1]=f+l*x,o[2]=p+u*x,!0}}}class ET{constructor(e,n,o,s,l){this.TL=e,this.TR=n,this.BR=o,this.BL=s,this.horizon=l}static fromInvProjectionMatrix(e,n,o){let s=[-1,1,1],l=[1,1,1],u=[1,-1,1],d=[-1,-1,1],f=Z.transformMat4(s,s,e),p=Z.transformMat4(l,l,e),g=Z.transformMat4(u,u,e),_=Z.transformMat4(d,d,e);return new ET(f,p,g,_,n/o)}}function Gm(t,e,n){let o=1/0,s=-1/0,l=[];for(let u of t){Z.sub(l,u,e);let d=Z.dot(l,n);o=Math.min(o,d),s=Math.max(s,d)}return[o,s]}function v2(t,e){let n=!0;for(let o=0;o<t.planes.length;o++){let s=t.planes[o],l=0;for(let u=0;u<e.length;u++)l+=Z.dot(s,e[u])+s[3]>=0;if(l===0)return 0;l!==e.length&&(n=!1)}return n?2:1}function x2(t,e){for(let n of t.projections){let o=Gm(e,t.points[0],n.axis);if(n.projection[1]<o[0]||n.projection[0]>o[1])return 0}return 1}function b2(t,e){let n=0,o=[0,0,0,0];for(let s=0;s<t.length;s++)o[0]=t[s][0],o[1]=t[s][1],o[2]=t[s][2],o[3]=1,Ei.dot(o,e)>=0&&n++;return n}class Uc{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=qi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Z.sub([],this.points[2],this.points[3]),Z.sub([],this.points[0],this.points[3]),Z.sub([],this.points[4],this.points[0]),Z.sub([],this.points[5],this.points[1]),Z.sub([],this.points[6],this.points[2]),Z.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let s=[0,-o[2],o[1]],l=[o[2],0,-o[0]];this.projections.push({axis:s,projection:Gm(this.points,this.points[0],s)}),this.projections.push({axis:l,projection:Gm(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,n,o,s){let l=Math.pow(2,o),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(p=>{let g=Ei.transformMat4([],p,e),_=1/g[3]/n*l;return Ei.mul(g,g,[_,_,s?1/g[3]:_,_])}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(p=>{let g=Z.sub([],u[p[0]],u[p[1]]),_=Z.sub([],u[p[2]],u[p[1]]),v=Z.normalize([],Z.cross([],g,_)),x=-Z.dot(v,u[p[1]]);return v.concat(x)}),f=[];for(let p=0;p<u.length;p++)f.push([u[p][0],u[p][1],u[p][2]]);return new Uc(f,d)}intersectsPrecise(e,n,o){for(let s=0;s<n.length;s++)if(!b2(e,n[s]))return 0;for(let s=0;s<this.planes.length;s++)if(!b2(e,this.planes[s]))return 0;for(let s of o)for(let l of this.frustumEdges){let u=Z.cross([],s,l),d=Z.length(u);if(d===0)continue;Z.scale(u,u,1/d);let f=Gm(this.points,this.points[0],u),p=Gm(e,this.points[0],u);if(f[0]>p[1]||p[0]>f[1])return 0}return 1}}class qi{static fromPoints(e){let n=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let s of e)Z.min(n,n,s),Z.max(o,o,s);return new qi(n,o)}static fromTileIdAndHeight(e,n,o){let s=1<<e.canonical.z,l=e.canonical.x,u=e.canonical.y;return new qi([l/s,u/s,n],[(l+1)/s,(u+1)/s,o])}static applyTransform(e,n){let o=e.getCorners();for(let s=0;s<o.length;++s)Z.transformMat4(o[s],o[s],n);return qi.fromPoints(o)}static projectAabbCorners(e,n){let o=e.getCorners();for(let s=0;s<o.length;++s)Z.transformMat4(o[s],o[s],n);return o}constructor(e,n){this.min=e,this.max=n,this.center=Z.scale([],Z.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],o=Z.clone(this.min),s=Z.clone(this.max);for(let l=0;l<n.length;l++)o[l]=n[l]?this.min[l]:this.center[l],s[l]=n[l]?this.center[l]:this.max[l];return s[2]=this.max[2],new qi(o,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?v2(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?v2(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?x2(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?x2(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}pt(qi,"Aabb");let Wm=5,Uu=6,gs=ne/Math.PI/2,dH=16383,Vf=64,MT=[Vf,32,16],Ua=-gs,$a=gs,hH=[new qi([Ua,Ua,Ua],[$a,$a,$a]),new qi([Ua,Ua,Ua],[0,0,$a]),new qi([0,Ua,Ua],[$a,0,$a]),new qi([Ua,0,Ua],[0,$a,$a]),new qi([0,0,Ua],[$a,$a,$a])];function ky(t){return t*gs/$f}function w2(t,e,n,o=!0){let s=Z.scale([],t._camera.position,t.worldSize),l=[e,n,1,1];Ei.transformMat4(l,l,t.pixelMatrixInverse),Ei.scale(l,l,1/l[3]);let u=Z.sub([],l,s),d=Z.normalize([],u),f=t.globeMatrix,p=[f[12],f[13],f[14]],g=Z.sub([],p,s),_=Z.length(g),v=Z.normalize([],g),x=t.worldSize/(2*Math.PI),b=Z.dot(v,d),T=Math.asin(x/_);if(T<Math.acos(b)){if(!o)return null;let H=[],G=[];Z.scale(H,d,_/b),Z.normalize(G,Z.sub(G,H,g)),Z.normalize(d,Z.add(d,g,Z.scale(d,G,Math.tan(T)*_)))}let E=[];new Fy(s,d).closestPointOnSphere(p,x,E);let M=Z.normalize([],Ni(f,0)),S=Z.normalize([],Ni(f,1)),P=Z.normalize([],Ni(f,2)),O=Z.dot(M,E),A=Z.dot(S,E),R=Z.dot(P,E),F=xi(Math.asin(-A/x)),k=xi(Math.atan2(O,R));k=t.center.lng+function(H,G){let Y=(G-H+180)%360-180;return Y<-180?Y+360:Y}(t.center.lng,k);let N=ao(k),B=ze(po(F),0,1);return new Fn(N,B)}class fH{constructor(e,n,o){this.a=Z.sub([],e,o),this.b=Z.sub([],n,o),this.center=o;let s=Z.normalize([],this.a),l=Z.normalize([],this.b);this.angle=Math.acos(Z.dot(s,l))}}function IT(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(o,s,l,u){let d=Math.sin(l);return o*(Math.sin((1-u)*l)/d)+s*(Math.sin(u*l)/d)}(t.a[e],t.b[e],t.angle,ze(n,0,1))+t.center[e]}function ga(t){if(t.z<=1)return hH[t.z+2*t.y+t.x];let e=ST(Ny(t));return qi.fromPoints(e)}function $c(t,e,n){return Z.scale(t,t,1-n),Z.scaleAndAdd(t,t,e,n)}function T2(t,e){let n=Do(e.zoom);if(n===0)return ga(t);let o=Ny(t),s=ST(o),l=ao(o.getWest())*e.worldSize,u=ao(o.getEast())*e.worldSize,d=po(o.getNorth())*e.worldSize,f=po(o.getSouth())*e.worldSize,p=[l,d,0],g=[u,d,0],_=[l,f,0],v=[u,f,0],x=ae.invert([],e.globeMatrix);return Z.transformMat4(p,p,x),Z.transformMat4(g,g,x),Z.transformMat4(_,_,x),Z.transformMat4(v,v,x),s[0]=$c(s[0],_,n),s[1]=$c(s[1],v,n),s[2]=$c(s[2],g,n),s[3]=$c(s[3],p,n),qi.fromPoints(s)}function E2(t,e,n){for(let o of t)Z.transformMat4(o,o,e),Z.scale(o,o,n)}function CT(t,e,n,o){let s=e/t.worldSize,l=t.globeMatrix;if(n.z<=1){let N=ga(n).getCorners();return E2(N,l,s),qi.fromPoints(N)}let u=Ny(n,o),d=ST(u);E2(d,l,s);let f=Number.MAX_VALUE,p=[-f,-f,-f],g=[f,f,f];if(u.contains(t.center)){for(let H of d)Z.min(g,g,H),Z.max(p,p,H);p[2]=0;let N=t.point,B=[N.x*s,N.y*s,0];return Z.min(g,g,B),Z.max(p,p,B),new qi(g,p)}let _=[l[12]*s,l[13]*s,l[14]*s],v=u.getCenter(),x=ze(t.center.lat,-Pr,Pr),b=ze(v.lat,-Pr,Pr),T=ao(t.center.lng),E=po(x),M=T-ao(v.lng),S=E-po(b);M>.5?M-=1:M<-.5&&(M+=1);let P=0;if(Math.abs(M)>Math.abs(S))P=M>=0?1:3;else{P=S>=0?0:2;let N=[l[4]*s,l[5]*s,l[6]*s],B=-Math.sin(Vt(S>=0?u.getSouth():u.getNorth()))*gs;Z.scaleAndAdd(_,_,N,B)}let O=d[P],A=d[(P+1)%4],R=new fH(O,A,_),F=[IT(R,0)||O[0],IT(R,1)||O[1],IT(R,2)||O[2]],k=Do(t.zoom);if(k>0){let N=function({x:H,y:G,z:Y},U,Q,te,se){let K=1/(1<<Y),ee=H*K,de=ee+K,pe=G*K,fe=pe+K,be=0,Te=(ee+de)/2-te;return Te>.5?be=-1:Te<-.5&&(be=1),ee=((ee+be)*U-(te*=U))*Q+te,de=((de+be)*U-te)*Q+te,pe=(pe*U-(se*=U))*Q+se,fe=(fe*U-se)*Q+se,[[ee,fe,0],[de,fe,0],[de,pe,0],[ee,pe,0]]}(n,e,t._pixelsPerMercatorPixel,T,E);for(let H=0;H<d.length;H++)$c(d[H],N[H],k);let B=Z.add([],N[P],N[(P+1)%4]);Z.scale(B,B,.5),$c(F,B,k)}for(let N of d)Z.min(g,g,N),Z.max(p,p,N);return g[2]=Math.min(O[2],A[2]),Z.min(g,g,F),Z.max(p,p,F),new qi(g,p)}function Ny({x:t,y:e,z:n},o=!1){let s=1/(1<<n),l=new Xt(Ws(t*s),e===(1<<n)-1&&o?-90:Jr((e+1)*s)),u=new Xt(Ws((t+1)*s),e===0&&o?90:Jr(e*s));return new Gs(l,u)}function ST(t){let e=Vt(t.getNorth()),n=Vt(t.getSouth()),o=Math.cos(e),s=Math.cos(n),l=Math.sin(e),u=Math.sin(n),d=t.getWest(),f=t.getEast();return[Uf(s,u,d),Uf(s,u,f),Uf(o,l,f),Uf(o,l,d)]}function Uf(t,e,n,o=gs){return n=Vt(n),[t*Math.sin(n)*o,-e*o,t*Math.cos(n)*o]}function Ps(t,e,n){return Uf(Math.cos(Vt(t)),Math.sin(Vt(t)),e,n)}function qm(t,e,n,o){let s=1<<n.z,l=(t/ne+n.x)/s;return Ps(Jr((e/ne+n.y)/s),Ws(l),o)}function zy({min:t,max:e}){return dH/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let M2=new Float64Array(16);function $u(t){let e=zy(t),n=ae.fromScaling(M2,[e,e,e]);return ae.translate(n,n,Z.negate([],t.min))}function DT(t){let e=ae.fromTranslation(M2,t.min),n=1/zy(t);return ae.scale(e,e,[n,n,n])}function AT(t){let e=ne/(2*Math.PI);return t/(2*Math.PI)/e}function I2(t,e){return ne/(512*Math.pow(2,t))*zy(ga(e))}function C2(t,e,n,o,s){let l=AT(n),u=[t,e,-n/(2*Math.PI)],d=ae.identity(new Float64Array(16));return ae.translate(d,d,u),ae.scale(d,d,[l,l,l]),ae.rotateX(d,d,Vt(-s)),ae.rotateY(d,d,Vt(-o)),d}function S2(t){let e=t.pixelsPerMeter,n=e/Oi(1,t.center.lat),o=ae.identity(new Float64Array(16));return ae.translate(o,o,[t.point.x,t.point.y,0]),ae.scale(o,o,[n,n,e]),Float32Array.from(o)}function Do(t){return Si(Wm,Uu,t)}function D2(t,e,n){let o=ae.identity(new Float64Array(16)),s=(e/(1<<t)-.5)*Math.PI*2;return ae.rotateY(o,n.globeMatrix,s),Float32Array.from(o)}function A2(t,e,n){let o=Do(n.zoom),s=t.style.map._antialias,l=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!s&&!l}function P2(t,e,n,o){let s=e.getNorth(),l=e.getSouth(),u=e.getWest(),d=e.getEast(),f=1<<t.z,p=d-u,g=s-l,_=p/Vf,v=-g/MT[n],x=[0,_,0,v,0,0,s,u,0];if(t.z>0){let b=180/o;As.multiply(x,x,[b/p+1,0,0,0,b/g+1,0,-.5*b/_,.5*b/v,1])}return x[2]=f,x[5]=t.x,x[8]=t.y,x}function pH(t){let e=Pr-5;t=ze(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(Vt(t))),3);return Math.round(n*(MT.length-1))}function O2(t){let e=[0,0,0],n=ae.identity(new Float64Array(16));return ae.multiply(n,t.pixelMatrix,t.globeMatrix),Z.transformMat4(e,e,n),new X(e[0],e[1])}function R2(t,e){let n=Ps(e.lat,e.lng),o=function(l){let u=Ps(l._center.lat,l._center.lng),d=Z.fromValues(0,1,0),f=Z.cross([],d,u),p=ae.fromRotation([],-l.angle,u);f=Z.transformMat4(f,f,p),ae.fromRotation(p,-l._pitch,f);let g=Z.normalize([],u);return Z.scale(g,g,ky(l.cameraToCenterDistance/l.pixelsPerMeter)),Z.transformMat4(g,g,p),Z.add([],u,g)}(t),s=Z.subtract([],o,n);return Z.angle(s,n)}function By(t,e){return R2(t,e)>Math.PI/2*1.01}let L2=Vt(85),mH=Math.cos(L2),gH=Math.sin(L2);class _H{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let e of this._poleSegments)e.destroy();for(let e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,n){let o=new $s,s=new Kr,l=[],u=e+1+2,d=n[0]+1,f=n[0]+1+(1+n.length),p=(g,_,v)=>{let x=g===u-1?g-2:g===0?g:g-1;return x+=v?24575:0,[x,_]};for(let g=0;g<u;++g)o.emplaceBack(...p(g,0,!0));for(let g=0;g<d;++g)for(let _=0;_<u;++_)o.emplaceBack(...p(_,g,(_===0||_===u-1)&&!0));for(let g=0;g<n.length;++g){let _=n[g];for(let v=0;v<u;++v)o.emplaceBack(...p(v,_,!0))}for(let g=0;g<n.length;++g){let _=s.length,v=n[g]+1+2,x=new Kr;for(let E=0;E<v-1;E++){let M=E===v-2,S=M?u*(f-n.length+g-E):u;for(let P=0;P<u-1;P++){let O=E*u+P;E===0||M||P===0||P===u-2?(x.emplaceBack(O+1,O,O+S),x.emplaceBack(O+S,O+S+1,O+1)):(s.emplaceBack(O+1,O,O+S),s.emplaceBack(O+S,O+S+1,O+1))}}let b=Ti.simpleSegment(0,_,o.length,s.length-_);for(let E=0;E<x.uint16.length;E+=3)s.emplaceBack(x.uint16[E],x.uint16[E+1],x.uint16[E+2]);let T=Ti.simpleSegment(0,_,o.length,s.length-_);l.push({withoutSkirts:b,withSkirts:T})}return{vertices:o,indices:s,segments:l}}_createGrid(e){let n=this._fillGridMeshWithLods(Vf,MT);this._gridSegments=n.segments,this._gridBuffer=e.createVertexBuffer(n.vertices,Vu.members),this._gridIndexBuffer=e.createIndexBuffer(n.indices,!0)}_createPoles(e){let n=new Kr;for(let d=0;d<=Vf;d++)n.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=e.createIndexBuffer(n,!0);let o=new th,s=new th,l=new th,u=new th;this._poleSegments=[];for(let d=0,f=0;d<Wm;d++){let p=360/(1<<d);o.emplaceBack(0,-gs,0,.5,0),s.emplaceBack(0,-gs,0,.5,1),l.emplaceBack(0,-gs,0,.5,.5),u.emplaceBack(0,-gs,0,.5,.5);for(let g=0;g<=Vf;g++){let _=g/Vf,v=0,x=Yt(0,p,_),[b,T,E]=Uf(mH,gH,x,gs);o.emplaceBack(b,T,E,_,v),s.emplaceBack(b,T,E,_,1-v);let M=Vt(x);_=.5+.5*Math.sin(M),v=.5+.5*Math.cos(M),l.emplaceBack(b,T,E,_,v),u.emplaceBack(b,T,E,_,1-v)}this._poleSegments.push(Ti.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(o,Ly,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(s,Ly,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(l,Ly,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(u,Ly,!1)}getGridBuffers(e,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}let $f=63710088e-1,PT=2*Math.PI*$f;class Hu{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hu(bi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,o=this.lat*n,s=e.lat*n,l=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos((e.lng-this.lng)*n);return $f*Math.acos(Math.min(l,1))}toBounds(e=0){let n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new Gs(new Hu(this.lng-o,this.lat-n),new Hu(this.lng+o,this.lat+n))}toEcef(e){let n=ky(e);return Ps(this.lat,this.lng,gs+n)}static convert(e){if(e instanceof Hu)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Hu(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Hu(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Xt=Hu;let yH=0,vH=25.5;function jy(t){return PT*Math.cos(t*Math.PI/180)}function ao(t){return(180+t)/360}function po(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Oi(t,e){return t/jy(e)}function Ws(t){return 360*t-180}function Jr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function F2(t,e){return t*jy(Jr(e))}let Pr=85.051129;function k2(t){return Math.cos(Vt(ze(t,-Pr,Pr)))}function Gu(t,e){let n=ze(e,yH,vH),o=Math.pow(2,n);return k2(t)*PT/(512*o)}function OT(t){return 1/Math.cos(t*Math.PI/180)}function Zm(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/ne)/(1<<t.z)*2));return 80150034*n/(n*n+1)/ne/(1<<t.z)}class Fn{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){let o=Xt.convert(e);return new Fn(ao(o.lng),po(o.lat),Oi(n,o.lat))}toLngLat(){return new Xt(Ws(this.x),Jr(this.y))}toAltitude(){return F2(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/PT*OT(Jr(this.y))}}function RT(t,e,n,o,s,l,u,d,f){let p=(e+o)/2,g=(n+s)/2,_=new X(p,g);d(_),function(v,x,b,T,E,M){let S=b-E,P=T-M;return Math.abs((T-x)*S-(b-v)*P)/Math.hypot(S,P)}(_.x,_.y,l.x,l.y,u.x,u.y)>=f?(RT(t,e,n,p,g,l,_,d,f),RT(t,p,g,o,s,_,u,d,f)):t.push(u)}function N2(t,e,n){let o=t[0],s=o.x,l=o.y;e(o);let u=[o];for(let d=1;d<t.length;d++){let f=t[d],{x:p,y:g}=f;e(f),RT(u,s,l,p,g,o,f,e,n),s=p,l=g,o=f}return u}function LT(t,e,n,o){if(o(e,n)){let s=e.add(n)._mult(.5);LT(t,e,s,o),LT(t,s,n,o)}else t.push(n)}function xH(t,e){let n=t[0],o=[n];for(let s=1;s<t.length;s++){let l=t[s];LT(o,n,l,e),n=l}return o}let FT=Math.pow(2,14)-1,z2=-FT-1;function bH(t,e){let n=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=ze(n,z2,FT),t.y=ze(o,z2,FT),(n<t.x||n>t.x+1||o<t.y||o>t.y+1)&&J("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Jl(t,e,n){let o=t.loadGeometry(),s=t.extent,l=ne/s;if(e&&n&&n.projection.isReprojectedInTileSpace){let u=1<<e.z,{scale:d,x:f,y:p,projection:g}=n,_=v=>{let x=Ws((e.x+v.x/s)/u),b=Jr((e.y+v.y/s)/u),T=g.project(x,b);v.x=(T.x*d-f)*s,v.y=(T.y*d-p)*s};for(let v=0;v<o.length;v++)if(t.type!==1)o[v]=N2(o[v],_,1);else{let x=[];for(let b of o[v])b.x<0||b.x>=s||b.y<0||b.y>=s||(_(b),x.push(b));o[v]=x}}for(let u of o)for(let d of u)bH(d,l);return o}function Wu(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Jl(t):[]}}function Vy(t,e,n,o,s){t.emplaceBack(2*e+(o+1)/2,2*n+(s+1)/2)}function Uy(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class kT{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new $s,this.indexArray=new Kr,this.segments=new Ti,this.programConfigurations=new Bu(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,s){let l=this.layers[0],u=[],d=null;l.type==="circle"&&(d=l.layout.get("circle-sort-key"));for(let{feature:p,id:g,index:_,sourceLayerIndex:v}of e){let x=this.layers[0]._featureFilter.needGeometry,b=Wu(p,x);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),b,o))continue;let T=d?d.evaluate(b,{},o):void 0,E={id:g,properties:p.properties,type:p.type,sourceLayerIndex:v,index:_,geometry:x?b.geometry:Jl(p,o,s),patterns:{},sortKey:T};u.push(E)}d&&u.sort((p,g)=>p.sortKey-g.sortKey);let f=null;s.projection.name==="globe"&&(this.globeExtVertexArray=new Iy,f=s.projection);for(let p of u){let{geometry:g,index:_,sourceLayerIndex:v}=p,x=e[_].feature;this.addFeature(p,g,_,n.availableImages,o,f,n.brightness),n.featureIndex.insert(x,g,_,v,this.index)}}update(e,n,o,s,l){let u=Object.keys(e).length!==0;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,u?this.stateDependentLayers:this.layers,o,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,P6.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,O6.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,o,s,l,u,d){for(let f of n)for(let p of f){let g=p.x,_=p.y;if(g<0||g>=ne||_<0||_>=ne)continue;if(u){let b=u.projectTilePoint(g,_,l),T=u.upVector(l,g,_),E=this.globeExtVertexArray;Uy(E,b,T),Uy(E,b,T),Uy(E,b,T),Uy(E,b,T)}let v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),x=v.vertexLength;Vy(this.layoutVertexArray,g,_,-1,-1),Vy(this.layoutVertexArray,g,_,1,-1),Vy(this.layoutVertexArray,g,_,1,1),Vy(this.layoutVertexArray,g,_,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+2,x+3),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},s,l,d)}}function B2(t,e){for(let n=0;n<t.length;n++)if(qu(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(qu(t,e[n]))return!0;return!!NT(t,e)}function wH(t,e,n){return!!qu(t,e)||!!zT(e,t,n)}function j2(t,e){if(t.length===1)return U2(e,t[0]);for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<o.length;s++)if(qu(t,o[s]))return!0}for(let n=0;n<t.length;n++)if(U2(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(NT(t,e[n]))return!0;return!1}function TH(t,e,n){if(t.length>1){if(NT(t,e))return!0;for(let o=0;o<e.length;o++)if(zT(e[o],t,n))return!0}for(let o=0;o<t.length;o++)if(zT(t[o],e,n))return!0;return!1}function NT(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let o=t[n],s=t[n+1];for(let l=0;l<e.length-1;l++)if(EH(o,s,e[l],e[l+1]))return!0}return!1}function EH(t,e,n,o){return we(t,n,o)!==we(e,n,o)&&we(t,e,n)!==we(t,e,o)}function zT(t,e,n){let o=n*n;if(e.length===1)return t.distSqr(e[0])<o;for(let s=1;s<e.length;s++)if(V2(t,e[s-1],e[s])<o)return!0;return!1}function V2(t,e,n){let o=e.distSqr(n);if(o===0)return t.distSqr(e);let s=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/o;return t.distSqr(s<0?e:s>1?n:n.sub(e)._mult(s)._add(e))}function U2(t,e){let n,o,s,l=!1;for(let u=0;u<t.length;u++){n=t[u];for(let d=0,f=n.length-1;d<n.length;f=d++)o=n[d],s=n[f],o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(l=!l)}return l}function qu(t,e){let n=!1;for(let o=0,s=t.length-1;o<t.length;s=o++){let l=t[o],u=t[s];l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(n=!n)}return n}function $2(t,e,n,o,s){for(let u of t)if(e<=u.x&&n<=u.y&&o>=u.x&&s>=u.y)return!0;let l=[new X(e,n),new X(e,s),new X(o,s),new X(o,n)];if(t.length>2){for(let u of l)if(qu(t,u))return!0}for(let u=0;u<t.length-1;u++)if(MH(t[u],t[u+1],l))return!0;return!1}function MH(t,e,n){let o=n[0],s=n[2];if(t.x<o.x&&e.x<o.x||t.x>s.x&&e.x>s.x||t.y<o.y&&e.y<o.y||t.y>s.y&&e.y>s.y)return!1;let l=we(t,e,n[0]);return l!==we(t,e,n[1])||l!==we(t,e,n[2])||l!==we(t,e,n[3])}function Hf(t,e,n,o,s,l){let u=e.y-t.y,d=t.x-e.x;if(l=l||0){let f=u*u+d*d;if(f===0)return!0;let p=Math.sqrt(f);u/=p,d/=p}return!((n.x-t.x)*u+(n.y-t.y)*d-l<0||(o.x-t.x)*u+(o.y-t.y)*d-l<0||(s.x-t.x)*u+(s.y-t.y)*d-l<0)}function BT(t,e,n,o,s,l,u){return!(Hf(t,e,o,s,l,u)||Hf(e,n,o,s,l,u)||Hf(n,t,o,s,l,u)||Hf(o,s,t,e,n,u)||Hf(s,l,t,e,n,u)||Hf(l,o,t,e,n,u))}function Gf(t,e,n){let o=e.paint.get(t).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(t)}function $y(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function H2(t,e,n,o,s){if(!e[0]&&!e[1])return t;let l=X.convert(e)._mult(s);n==="viewport"&&l._rotate(-o);let u=[];for(let d=0;d<t.length;d++)u.push(t[d].sub(l));return u}function G2(t,e,n,o){let s=X.convert(t)._mult(o);return e==="viewport"&&s._rotate(-n),s}pt(kT,"CircleBucket",{omit:["layers"]});let IH=new Tr({"circle-sort-key":new At(q.layout_circle["circle-sort-key"]),visibility:new je(q.layout_circle.visibility)});var CH={paint:new Tr({"circle-radius":new At(q.paint_circle["circle-radius"]),"circle-color":new At(q.paint_circle["circle-color"]),"circle-blur":new At(q.paint_circle["circle-blur"]),"circle-opacity":new At(q.paint_circle["circle-opacity"]),"circle-translate":new je(q.paint_circle["circle-translate"]),"circle-translate-anchor":new je(q.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new je(q.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new je(q.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new At(q.paint_circle["circle-stroke-width"]),"circle-stroke-color":new At(q.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new At(q.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new je(q.paint_circle["circle-emissive-strength"])}),layout:IH};let SH=ae.create(),DH=(t,e,n,o,s,l)=>{let u=t.transform,d=u.projection.name==="globe",f;if(l.paint.get("circle-pitch-alignment")==="map")if(d){let g=I2(u.zoom,e.canonical)*u._pixelsPerMercatorPixel;f=Float32Array.from([g,0,0,g])}else f=u.calculatePixelsToTileUnitsMatrix(n);else f=new Float32Array([u.pixelsToGLUnits[0],0,0,u.pixelsToGLUnits[1]]);let p={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(u.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Zt.devicePixelRatio,u_extrude_scale:f,u_inv_rot_matrix:SH,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(d){p.u_inv_rot_matrix=o,p.u_merc_center=s,p.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],p.u_zoom_transition=Do(u.zoom);let g=s[0]*ne,_=s[1]*ne;p.u_up_dir=u.projection.upVector(new Va(0,0,0),g,_)}return p},W2=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function q2(t,e,n,o,s,l,u,d,f){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(f*=t.pixelToTileUnitsFactor);let p=t.tileID.canonical,g=n.projection.upVectorScale(p,n.center.lat,n.worldSize).metersToTile;for(let _ of e)for(let v of _){let x=v.add(d),b=s&&n.elevation?n.elevation.exaggeration()*s.getElevationAt(x.x,x.y,!0):0,T=n.projection.projectTilePoint(x.x,x.y,p);if(b>0){let P=n.projection.upVector(p,x.x,x.y);T.x+=P[0]*g*b,T.y+=P[1]*g*b,T.z+=P[2]*g*b}let E=l?x:AH(T.x,T.y,T.z,o),M=l?t.tilespaceRays.map(P=>OH(P,b)):t.queryGeometry.screenGeometry,S=Ei.transformMat4([],[T.x,T.y,T.z,1],o);if(!u&&l?f*=S[3]/n.cameraToCenterDistance:u&&!l&&(f*=n.cameraToCenterDistance/S[3]),l){let P=Jr((v.y/ne+p.y)/(1<<p.z));f/=n.projection.pixelsPerMeter(P,1)/Oi(1,P)}if(wH(M,E,f))return!0}return!1}function AH(t,e,n,o){let s=Ei.transformMat4([],[t,e,n,1],o);return new X(s[0]/s[3],s[1]/s[3])}let Z2=Z.fromValues(0,0,0),PH=Z.fromValues(0,0,1);function OH(t,e){let n=Z.create();return Z2[2]=e,t.intersectsPlane(Z2,PH,n),new X(n[0],n[1])}class Y2 extends kT{}function X2(t,{width:e,height:n},o,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*n*o)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*n*o);return t.width=e,t.height=n,t.data=s,t}function K2(t,e,n){let{width:o,height:s}=e;o===t.width&&s===t.height||(jT(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,s)},n),t.width=o,t.height=s,t.data=e.data)}function jT(t,e,n,o,s,l){if(s.width===0||s.height===0)return e;if(s.width>t.width||s.height>t.height||n.x>t.width-s.width||n.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||o.x>e.width-s.width||o.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");let u=t.data,d=e.data;for(let f=0;f<s.height;f++){let p=((n.y+f)*t.width+n.x)*l,g=((o.y+f)*e.width+o.x)*l;for(let _=0;_<s.width*l;_++)d[g+_]=u[p+_]}return e}pt(Y2,"HeatmapBucket",{omit:["layers"]});class Hc{constructor(e,n){X2(this,e,1,n)}resize(e){K2(this,new Hc(e),1)}clone(){return new Hc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,s,l){jT(e,n,o,s,l,1)}}class qr{constructor(e,n){X2(this,e,4,n)}resize(e){K2(this,new qr(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,s,l){jT(e,n,o,s,l,4)}}class J2{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}pt(Hc,"AlphaImage"),pt(qr,"RGBAImage");let RH=new Tr({visibility:new je(q.layout_heatmap.visibility)});var LH={paint:new Tr({"heatmap-radius":new At(q.paint_heatmap["heatmap-radius"]),"heatmap-weight":new At(q.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new je(q.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zm(q.paint_heatmap["heatmap-color"]),"heatmap-opacity":new je(q.paint_heatmap["heatmap-opacity"])}),layout:RH};function Hy(t){let e={},n=t.resolution||256,o=t.clips?t.clips.length:1,s=t.image||new qr({width:n,height:o}),l=(u,d,f)=>{e[t.evaluationKey]=f;let p=t.expression.evaluate(e);p&&(s.data[u+d+0]=Math.floor(255*p.r/p.a),s.data[u+d+1]=Math.floor(255*p.g/p.a),s.data[u+d+2]=Math.floor(255*p.b/p.a),s.data[u+d+3]=Math.floor(255*p.a))};if(t.clips)for(let u=0,d=0;u<o;++u,d+=4*n)for(let f=0,p=0;f<n;f++,p+=4){let g=f/(n-1),{start:_,end:v}=t.clips[u];l(d,p,_*(1-g)+v*g)}else for(let u=0,d=0;u<n;u++,d+=4)l(0,d,u/(n-1));return s}let FH=new Tr({visibility:new je(q.layout_hillshade.visibility)});var kH={paint:new Tr({"hillshade-illumination-direction":new je(q.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new je(q.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new je(q.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new je(q.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new je(q.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new je(q.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new je(q.paint_hillshade["hillshade-emissive-strength"])}),layout:FH};let NH=ri([{name:"a_pos",components:2,type:"Int16"}],4),{members:zH}=NH;var VT={exports:{}};function Gy(t,e,n){n=n||2;var o,s,l,u,d,f,p,g=e&&e.length,_=g?e[0]*n:t.length,v=Q2(t,0,_,n,!0),x=[];if(!v||v.next===v.prev)return x;if(g&&(v=function(T,E,M,S){var P,O,A,R=[];for(P=0,O=E.length;P<O;P++)(A=Q2(T,E[P]*S,P<O-1?E[P+1]*S:T.length,S,!1))===A.next&&(A.steiner=!0),R.push(WH(A));for(R.sort($H),P=0;P<R.length;P++)M=HH(R[P],M);return M}(t,e,v,n)),t.length>80*n){o=l=t[0],s=u=t[1];for(var b=n;b<_;b+=n)(d=t[b])<o&&(o=d),(f=t[b+1])<s&&(s=f),d>l&&(l=d),f>u&&(u=f);p=(p=Math.max(l-o,u-s))!==0?32767/p:0}return Ym(v,x,n,o,s,p,0),x}function Q2(t,e,n,o,s){var l,u;if(s===HT(t,e,n,o)>0)for(l=e;l<n;l+=o)u=nR(l,t[l],t[l+1],u);else for(l=n-o;l>=e;l-=o)u=nR(l,t[l],t[l+1],u);return u&&Wy(u,u.next)&&(Km(u),u=u.next),u}function sh(t,e){if(!t)return t;e||(e=t);var n,o=t;do if(n=!1,o.steiner||!Wy(o,o.next)&&lo(o.prev,o,o.next)!==0)o=o.next;else{if(Km(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Ym(t,e,n,o,s,l,u){if(t){!u&&l&&function(g,_,v,x){var b=g;do b.z===0&&(b.z=UT(b.x,b.y,_,v,x)),b.prevZ=b.prev,b.nextZ=b.next,b=b.next;while(b!==g);b.prevZ.nextZ=null,b.prevZ=null,function(T){var E,M,S,P,O,A,R,F,k=1;do{for(M=T,T=null,O=null,A=0;M;){for(A++,S=M,R=0,E=0;E<k&&(R++,S=S.nextZ);E++);for(F=k;R>0||F>0&&S;)R!==0&&(F===0||!S||M.z<=S.z)?(P=M,M=M.nextZ,R--):(P=S,S=S.nextZ,F--),O?O.nextZ=P:T=P,P.prevZ=O,O=P;M=S}O.nextZ=null,k*=2}while(A>1)}(b)}(t,o,s,l);for(var d,f,p=t;t.prev!==t.next;)if(d=t.prev,f=t.next,l?jH(t,o,s,l):BH(t))e.push(d.i/n|0),e.push(t.i/n|0),e.push(f.i/n|0),Km(t),t=f.next,p=f.next;else if((t=f)===p){u?u===1?Ym(t=VH(sh(t),e,n),e,n,o,s,l,2):u===2&&UH(t,e,n,o,s,l):Ym(sh(t),e,n,o,s,l,1);break}}}function BH(t){var e=t.prev,n=t,o=t.next;if(lo(e,n,o)>=0)return!1;for(var s=e.x,l=n.x,u=o.x,d=e.y,f=n.y,p=o.y,g=s<l?s<u?s:u:l<u?l:u,_=d<f?d<p?d:p:f<p?f:p,v=s>l?s>u?s:u:l>u?l:u,x=d>f?d>p?d:p:f>p?f:p,b=o.next;b!==e;){if(b.x>=g&&b.x<=v&&b.y>=_&&b.y<=x&&Wf(s,d,l,f,u,p,b.x,b.y)&&lo(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function jH(t,e,n,o){var s=t.prev,l=t,u=t.next;if(lo(s,l,u)>=0)return!1;for(var d=s.x,f=l.x,p=u.x,g=s.y,_=l.y,v=u.y,x=d<f?d<p?d:p:f<p?f:p,b=g<_?g<v?g:v:_<v?_:v,T=d>f?d>p?d:p:f>p?f:p,E=g>_?g>v?g:v:_>v?_:v,M=UT(x,b,e,n,o),S=UT(T,E,e,n,o),P=t.prevZ,O=t.nextZ;P&&P.z>=M&&O&&O.z<=S;){if(P.x>=x&&P.x<=T&&P.y>=b&&P.y<=E&&P!==s&&P!==u&&Wf(d,g,f,_,p,v,P.x,P.y)&&lo(P.prev,P,P.next)>=0||(P=P.prevZ,O.x>=x&&O.x<=T&&O.y>=b&&O.y<=E&&O!==s&&O!==u&&Wf(d,g,f,_,p,v,O.x,O.y)&&lo(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;P&&P.z>=M;){if(P.x>=x&&P.x<=T&&P.y>=b&&P.y<=E&&P!==s&&P!==u&&Wf(d,g,f,_,p,v,P.x,P.y)&&lo(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;O&&O.z<=S;){if(O.x>=x&&O.x<=T&&O.y>=b&&O.y<=E&&O!==s&&O!==u&&Wf(d,g,f,_,p,v,O.x,O.y)&&lo(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function VH(t,e,n){var o=t;do{var s=o.prev,l=o.next.next;!Wy(s,l)&&eR(s,o,o.next,l)&&Xm(s,l)&&Xm(l,s)&&(e.push(s.i/n|0),e.push(o.i/n|0),e.push(l.i/n|0),Km(o),Km(o.next),o=t=l),o=o.next}while(o!==t);return sh(o)}function UH(t,e,n,o,s,l){var u=t;do{for(var d=u.next.next;d!==u.prev;){if(u.i!==d.i&&qH(u,d)){var f=tR(u,d);return u=sh(u,u.next),f=sh(f,f.next),Ym(u,e,n,o,s,l,0),void Ym(f,e,n,o,s,l,0)}d=d.next}u=u.next}while(u!==t)}function $H(t,e){return t.x-e.x}function HH(t,e){var n=function(s,l){var u,d=l,f=s.x,p=s.y,g=-1/0;do{if(p<=d.y&&p>=d.next.y&&d.next.y!==d.y){var _=d.x+(p-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(_<=f&&_>g&&(g=_,u=d.x<d.next.x?d:d.next,_===f))return u}d=d.next}while(d!==l);if(!u)return null;var v,x=u,b=u.x,T=u.y,E=1/0;d=u;do f>=d.x&&d.x>=b&&f!==d.x&&Wf(p<T?f:g,p,b,T,p<T?g:f,p,d.x,d.y)&&(v=Math.abs(p-d.y)/(f-d.x),Xm(d,s)&&(v<E||v===E&&(d.x>u.x||d.x===u.x&&GH(u,d)))&&(u=d,E=v)),d=d.next;while(d!==x);return u}(t,e);if(!n)return e;var o=tR(n,t);return sh(o,o.next),sh(n,n.next)}function GH(t,e){return lo(t.prev,t,e.prev)<0&&lo(e.next,t,t.next)<0}function UT(t,e,n,o,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function WH(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Wf(t,e,n,o,s,l,u,d){return(s-u)*(e-d)>=(t-u)*(l-d)&&(t-u)*(o-d)>=(n-u)*(e-d)&&(n-u)*(l-d)>=(s-u)*(o-d)}function qH(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,o){var s=n;do{if(s.i!==n.i&&s.next.i!==n.i&&s.i!==o.i&&s.next.i!==o.i&&eR(s,s.next,n,o))return!0;s=s.next}while(s!==n);return!1}(t,e)&&(Xm(t,e)&&Xm(e,t)&&function(n,o){var s=n,l=!1,u=(n.x+o.x)/2,d=(n.y+o.y)/2;do s.y>d!=s.next.y>d&&s.next.y!==s.y&&u<(s.next.x-s.x)*(d-s.y)/(s.next.y-s.y)+s.x&&(l=!l),s=s.next;while(s!==n);return l}(t,e)&&(lo(t.prev,t,e.prev)||lo(t,e.prev,e))||Wy(t,e)&&lo(t.prev,t,t.next)>0&&lo(e.prev,e,e.next)>0)}function lo(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Wy(t,e){return t.x===e.x&&t.y===e.y}function eR(t,e,n,o){var s=Zy(lo(t,e,n)),l=Zy(lo(t,e,o)),u=Zy(lo(n,o,t)),d=Zy(lo(n,o,e));return s!==l&&u!==d||!(s!==0||!qy(t,n,e))||!(l!==0||!qy(t,o,e))||!(u!==0||!qy(n,t,o))||!(d!==0||!qy(n,e,o))}function qy(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Zy(t){return t>0?1:t<0?-1:0}function Xm(t,e){return lo(t.prev,t,t.next)<0?lo(t,e,t.next)>=0&&lo(t,t.prev,e)>=0:lo(t,e,t.prev)<0||lo(t,t.next,e)<0}function tR(t,e){var n=new $T(t.i,t.x,t.y),o=new $T(e.i,e.x,e.y),s=t.next,l=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,o.next=n,n.prev=o,l.next=o,o.prev=l,o}function nR(t,e,n,o){var s=new $T(t,e,n);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function Km(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $T(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function HT(t,e,n,o){for(var s=0,l=e,u=n-o;l<n;l+=o)s+=(t[u]-t[l])*(t[l+1]+t[u+1]),u=l;return s}VT.exports=Gy,VT.exports.default=Gy,Gy.deviation=function(t,e,n,o){var s=e&&e.length,l=Math.abs(HT(t,0,s?e[0]*n:t.length,n));if(s)for(var u=0,d=e.length;u<d;u++)l-=Math.abs(HT(t,e[u]*n,u<d-1?e[u+1]*n:t.length,n));var f=0;for(u=0;u<o.length;u+=3){var p=o[u]*n,g=o[u+1]*n,_=o[u+2]*n;f+=Math.abs((t[p]-t[_])*(t[g+1]-t[p+1])-(t[p]-t[g])*(t[_+1]-t[p+1]))}return l===0&&f===0?0:Math.abs((f-l)/l)},Gy.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,s=0;s<t.length;s++){for(var l=0;l<t[s].length;l++)for(var u=0;u<e;u++)n.vertices.push(t[s][l][u]);s>0&&n.holes.push(o+=t[s-1].length)}return n};var Yy=Ve(VT.exports);function GT(t,e){let n=t.length;if(n<=1)return[t];let o=[],s,l;for(let u=0;u<n;u++){let d=De(t[u]);d!==0&&(t[u].area=Math.abs(d),l===void 0&&(l=d<0),l===d<0?(s&&o.push(s),s=[t[u]]):s.push(t[u]))}if(s&&o.push(s),e>1)for(let u=0;u<o.length;u++)o[u].length<=e||($d(o[u],e,1,o[u].length-1,ZH),o[u]=o[u].slice(0,e));return o}function ZH(t,e){return e.area-t.area}function WT(t,e,n){let o=n.patternDependencies,s=!1;for(let l of e){let u=l.paint.get(`${t}-pattern`);u.isConstant()||(s=!0);let d=u.constantOr(null);d&&(s=!0,o[d]=!0)}return s}function qT(t,e,n,o,s){let l=s.patternDependencies;for(let u of e){let d=u.paint.get(`${t}-pattern`).value;if(d.kind!=="constant"){let f=d.evaluate({zoom:o},n,{},s.availableImages);f=f&&f.name?f.name:f,l[f]=!0,n.patterns[u.id]=f}}return n}class Xy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $s,this.indexArray=new Kr,this.indexArray2=new Nu,this.programConfigurations=new Bu(e.layers,e.zoom),this.segments=new Ti,this.segments2=new Ti,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,o,s){this.hasPattern=WT("fill",this.layers,n);let l=this.layers[0].layout.get("fill-sort-key"),u=[];for(let{feature:d,id:f,index:p,sourceLayerIndex:g}of e){let _=this.layers[0]._featureFilter.needGeometry,v=Wu(d,_);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),v,o))continue;let x=l?l.evaluate(v,{},o,n.availableImages):void 0,b={id:f,properties:d.properties,type:d.type,sourceLayerIndex:g,index:p,geometry:_?v.geometry:Jl(d,o,s),patterns:{},sortKey:x};u.push(b)}l&&u.sort((d,f)=>d.sortKey-f.sortKey);for(let d of u){let{geometry:f,index:p,sourceLayerIndex:g}=d;if(this.hasPattern){let _=qT("fill",this.layers,d,this.zoom,n);this.patternFeatures.push(_)}else this.addFeature(d,f,p,o,{},n.availableImages,n.brightness);n.featureIndex.insert(e[p].feature,f,p,g,this.index)}}update(e,n,o,s,l){let u=Object.keys(e).length!==0;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,u?this.stateDependentLayers:this.layers,o,s,l)}addFeatures(e,n,o,s,l,u){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,o,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zH),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,s,l,u=[],d){for(let f of GT(n,500)){let p=0;for(let T of f)p+=T.length;let g=this.segments.prepareSegment(p,this.layoutVertexArray,this.indexArray),_=g.vertexLength,v=[],x=[];for(let T of f){if(T.length===0)continue;T!==f[0]&&x.push(v.length/2);let E=this.segments2.prepareSegment(T.length,this.layoutVertexArray,this.indexArray2),M=E.vertexLength;this.layoutVertexArray.emplaceBack(T[0].x,T[0].y),this.indexArray2.emplaceBack(M+T.length-1,M),v.push(T[0].x),v.push(T[0].y);for(let S=1;S<T.length;S++)this.layoutVertexArray.emplaceBack(T[S].x,T[S].y),this.indexArray2.emplaceBack(M+S-1,M+S),v.push(T[S].x),v.push(T[S].y);E.vertexLength+=T.length,E.primitiveLength+=T.length}let b=Yy(v,x);for(let T=0;T<b.length;T+=3)this.indexArray.emplaceBack(_+b[T],_+b[T+1],_+b[T+2]);g.vertexLength+=p,g.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,u,s,d)}}pt(Xy,"FillBucket",{omit:["layers","patternFeatures"]});let YH=new Tr({"fill-sort-key":new At(q.layout_fill["fill-sort-key"]),visibility:new je(q.layout_fill.visibility)});var XH={paint:new Tr({"fill-antialias":new je(q.paint_fill["fill-antialias"]),"fill-opacity":new At(q.paint_fill["fill-opacity"]),"fill-color":new At(q.paint_fill["fill-color"]),"fill-outline-color":new At(q.paint_fill["fill-outline-color"]),"fill-translate":new je(q.paint_fill["fill-translate"]),"fill-translate-anchor":new je(q.paint_fill["fill-translate-anchor"]),"fill-pattern":new At(q.paint_fill["fill-pattern"]),"fill-emissive-strength":new je(q.paint_fill["fill-emissive-strength"])}),layout:YH};let KH=ri([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),JH=ri([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),QH=ri([{name:"a_centroid_pos",components:2,type:"Uint16"}]),eG=ri([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),tG=ri([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:nG}=KH;var Ky={},iG=Wn,iR=qf;function qf(t,e,n,o,s){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=s,t.readFields(rG,this,e)}function rG(t,e,n){t==1?e.id=n.readVarint():t==2?function(o,s){for(var l=o.readVarint()+o.pos;o.pos<l;){var u=s._keys[o.readVarint()],d=s._values[o.readVarint()];s.properties[u]=d}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function oG(t){for(var e,n,o=0,s=0,l=t.length,u=l-1;s<l;u=s++)o+=((n=t[u]).x-(e=t[s]).x)*(e.y+n.y);return o}qf.types=["Unknown","Point","LineString","Polygon"],qf.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,o=1,s=0,l=0,u=0,d=[];t.pos<n;){if(s<=0){var f=t.readVarint();o=7&f,s=f>>3}if(s--,o===1||o===2)l+=t.readSVarint(),u+=t.readSVarint(),o===1&&(e&&d.push(e),e=[]),e.push(new iG(l,u));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&d.push(e),d},qf.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,o=0,s=0,l=0,u=1/0,d=-1/0,f=1/0,p=-1/0;t.pos<e;){if(o<=0){var g=t.readVarint();n=7&g,o=g>>3}if(o--,n===1||n===2)(s+=t.readSVarint())<u&&(u=s),s>d&&(d=s),(l+=t.readSVarint())<f&&(f=l),l>p&&(p=l);else if(n!==7)throw new Error("unknown command "+n)}return[u,f,d,p]},qf.prototype.toGeoJSON=function(t,e,n){var o,s,l=this.extent*Math.pow(2,n),u=this.extent*t,d=this.extent*e,f=this.loadGeometry(),p=qf.types[this.type];function g(x){for(var b=0;b<x.length;b++){var T=x[b];x[b]=[360*(T.x+u)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(T.y+d)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var _=[];for(o=0;o<f.length;o++)_[o]=f[o][0];g(f=_);break;case 2:for(o=0;o<f.length;o++)g(f[o]);break;case 3:for(f=function(x){var b=x.length;if(b<=1)return[x];for(var T,E,M=[],S=0;S<b;S++){var P=oG(x[S]);P!==0&&(E===void 0&&(E=P<0),E===P<0?(T&&M.push(T),T=[x[S]]):T.push(x[S]))}return T&&M.push(T),M}(f),o=0;o<f.length;o++)for(s=0;s<f[o].length;s++)g(f[o][s])}f.length===1?f=f[0]:p="Multi"+p;var v={type:"Feature",geometry:{type:p,coordinates:f},properties:this.properties};return"id"in this&&(v.id=this.id),v};var sG=iR,rR=oR;function oR(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(aG,this,e),this.length=this._features.length}function aG(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(o){for(var s=null,l=o.readVarint()+o.pos;o.pos<l;){var u=o.readVarint()>>3;s=u===1?o.readString():u===2?o.readFloat():u===3?o.readDouble():u===4?o.readVarint64():u===5?o.readVarint():u===6?o.readSVarint():u===7?o.readBoolean():null}return s}(n))}oR.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new sG(this._pbf,e,this.extent,this._keys,this._values)};var lG=rR;function cG(t,e,n){if(t===3){var o=new lG(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}var ZT=Ky.VectorTile=function(t,e){this.layers=t.readFields(cG,{},e)},Jy=Ky.VectorTileFeature=iR;function Qy(t,e,n,o){let s=[],l=o===0?(u,d,f,p,g,_)=>{u.push(new X(_,f+(_-d)/(p-d)*(g-f)))}:(u,d,f,p,g,_)=>{u.push(new X(d+(_-f)/(g-f)*(p-d),_))};for(let u of t){let d=[];for(let f of u){if(f.length<=2)continue;let p=[];for(let v=0;v<f.length-1;v++){let x=f[v].x,b=f[v].y,T=f[v+1].x,E=f[v+1].y,M=o===0?x:b,S=o===0?T:E;M<e?S>e&&l(p,x,b,T,E,e):M>n?S<n&&l(p,x,b,T,E,n):p.push(f[v]),S<e&&M>=e&&l(p,x,b,T,E,e),S>n&&M<=n&&l(p,x,b,T,E,n)}let g=f[f.length-1],_=o===0?g.x:g.y;_>=e&&_<=n&&p.push(g),p.length&&(g=p[p.length-1],p[0].x===g.x&&p[0].y===g.y||p.push(p[0]),d.push(p))}d.length&&s.push(d)}return s}Ky.VectorTileLayer=rR;class sR{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var uG={read:function(t,e,n,o,s){var l,u,d=8*s-o-1,f=(1<<d)-1,p=f>>1,g=-7,_=n?s-1:0,v=n?-1:1,x=t[e+_];for(_+=v,l=x&(1<<-g)-1,x>>=-g,g+=d;g>0;l=256*l+t[e+_],_+=v,g-=8);for(u=l&(1<<-g)-1,l>>=-g,g+=o;g>0;u=256*u+t[e+_],_+=v,g-=8);if(l===0)l=1-p;else{if(l===f)return u?NaN:1/0*(x?-1:1);u+=Math.pow(2,o),l-=p}return(x?-1:1)*u*Math.pow(2,l-o)},write:function(t,e,n,o,s,l){var u,d,f,p=8*l-s-1,g=(1<<p)-1,_=g>>1,v=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=o?0:l-1,b=o?1:-1,T=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(d=isNaN(e)?1:0,u=g):(u=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-u))<1&&(u--,f*=2),(e+=u+_>=1?v/f:v*Math.pow(2,1-_))*f>=2&&(u++,f/=2),u+_>=g?(d=0,u=g):u+_>=1?(d=(e*f-1)*Math.pow(2,s),u+=_):(d=e*Math.pow(2,_-1)*Math.pow(2,s),u=0));s>=8;t[n+x]=255&d,x+=b,d/=256,s-=8);for(u=u<<s|d,p+=s;p>0;t[n+x]=255&u,x+=b,u/=256,p-=8);t[n+x-b]|=128*T}},aR=ir,ev=uG;function ir(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ir.Varint=0,ir.Fixed64=1,ir.Bytes=2,ir.Fixed32=5;var YT=4294967296,lR=1/YT,cR=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Gc(t){return t.type===ir.Bytes?t.readVarint()+t.pos:t.pos+1}function Zf(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function uR(t,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var s=n.pos-1;s>=t;s--)n.buf[s+o]=n.buf[s]}function dG(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function hG(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function fG(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function pG(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function mG(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function gG(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function _G(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function yG(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function vG(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function tv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Yf(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function dR(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ir.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),s=o>>3,l=this.pos;this.type=7&o,t(s,e,this),this.pos===l&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=tv(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=dR(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=tv(this.buf,this.pos)+tv(this.buf,this.pos+4)*YT;return this.pos+=8,t},readSFixed64:function(){var t=tv(this.buf,this.pos)+dR(this.buf,this.pos+4)*YT;return this.pos+=8,t},readFloat:function(){var t=ev.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ev.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(s,l,u){var d,f,p=u.buf;if(d=(112&(f=p[u.pos++]))>>4,f<128||(d|=(127&(f=p[u.pos++]))<<3,f<128)||(d|=(127&(f=p[u.pos++]))<<10,f<128)||(d|=(127&(f=p[u.pos++]))<<17,f<128)||(d|=(127&(f=p[u.pos++]))<<24,f<128)||(d|=(1&(f=p[u.pos++]))<<31,f<128))return Zf(s,d,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&cR?function(n,o,s){return cR.decode(n.subarray(o,s))}(this.buf,e,t):function(n,o,s){for(var l="",u=o;u<s;){var d,f,p,g=n[u],_=null,v=g>239?4:g>223?3:g>191?2:1;if(u+v>s)break;v===1?g<128&&(_=g):v===2?(192&(d=n[u+1]))==128&&(_=(31&g)<<6|63&d)<=127&&(_=null):v===3?(f=n[u+2],(192&(d=n[u+1]))==128&&(192&f)==128&&((_=(15&g)<<12|(63&d)<<6|63&f)<=2047||_>=55296&&_<=57343)&&(_=null)):v===4&&(f=n[u+2],p=n[u+3],(192&(d=n[u+1]))==128&&(192&f)==128&&(192&p)==128&&((_=(15&g)<<18|(63&d)<<12|(63&f)<<6|63&p)<=65535||_>=1114112)&&(_=null)),_===null?(_=65533,v=1):_>65535&&(_-=65536,l+=String.fromCharCode(_>>>10&1023|55296),_=56320|1023&_),l+=String.fromCharCode(_),u+=v}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ir.Bytes)return t.push(this.readVarint(e));var n=Gc(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ir.Bytes)return t.push(this.readSVarint());var e=Gc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ir.Bytes)return t.push(this.readBoolean());var e=Gc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ir.Bytes)return t.push(this.readFloat());var e=Gc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ir.Bytes)return t.push(this.readDouble());var e=Gc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ir.Bytes)return t.push(this.readFixed32());var e=Gc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ir.Bytes)return t.push(this.readSFixed32());var e=Gc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ir.Bytes)return t.push(this.readFixed64());var e=Gc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ir.Bytes)return t.push(this.readSFixed64());var e=Gc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ir.Varint)for(;this.buf[this.pos++]>127;);else if(e===ir.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ir.Fixed32)this.pos+=4;else{if(e!==ir.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Yf(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Yf(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Yf(this.buf,-1&t,this.pos),Yf(this.buf,Math.floor(t*lR),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Yf(this.buf,-1&t,this.pos),Yf(this.buf,Math.floor(t*lR),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var o,s;if(e>=0?(o=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,s=s+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(l,u,d){d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,d.buf[d.pos]=127&(l>>>=7)}(o,0,n),function(l,u){var d=(7&l)<<4;u.buf[u.pos++]|=d|((l>>>=3)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l|((l>>>=7)?128:0),l&&(u.buf[u.pos++]=127&l)))))}(s,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,s,l){for(var u,d,f=0;f<s.length;f++){if((u=s.charCodeAt(f))>55295&&u<57344){if(!d){u>56319||f+1===s.length?(o[l++]=239,o[l++]=191,o[l++]=189):d=u;continue}if(u<56320){o[l++]=239,o[l++]=191,o[l++]=189,d=u;continue}u=d-55296<<10|u-56320|65536,d=null}else d&&(o[l++]=239,o[l++]=191,o[l++]=189,d=null);u<128?o[l++]=u:(u<2048?o[l++]=u>>6|192:(u<65536?o[l++]=u>>12|224:(o[l++]=u>>18|240,o[l++]=u>>12&63|128),o[l++]=u>>6&63|128),o[l++]=63&u|128)}return l}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&uR(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),ev.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ev.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var o=this.pos-n;o>=128&&uR(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,n){this.writeTag(t,ir.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,dG,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,hG,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,mG,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,fG,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,pG,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,gG,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,_G,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,yG,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,vG,e)},writeBytesField:function(t,e){this.writeTag(t,ir.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ir.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ir.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ir.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ir.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ir.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ir.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ir.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ir.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ir.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var nv=Ve(aR);let xG=["tile","layer","source","sourceLayer","state"];class hR{constructor(e,n,o,s,l){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=s,this.properties=e.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of xG)this[n]!==void 0&&(e[n]=this[n]);return e}}class bG{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){let s=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},Ne(this.stateChanges[e][s],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(let l in this.state[e])l!==s&&(this.deletedStates[e][l]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(let l in this.state[e][s])o[l]||(this.deletedStates[e][s][l]=null)}else for(let l in o)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][l]===null&&delete this.deletedStates[e][s][l]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;let s=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(o in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][o]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,n){let o=String(n),s=Ne({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let l=this.deletedStates[e][n];if(l===null)return{};for(let u in l)delete s[u]}return s}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let o={};for(let s in this.stateChanges){this.state[s]=this.state[s]||{};let l={};for(let u in this.stateChanges[s])this.state[s][u]||(this.state[s][u]={}),Ne(this.state[s][u],this.stateChanges[s][u]),l[u]=this.state[s][u];o[s]=l}for(let s in this.deletedStates){this.state[s]=this.state[s]||{};let l={};if(this.deletedStates[s]===null)for(let u in this.state[s])l[u]={},this.state[s][u]={};else for(let u in this.deletedStates[s]){if(this.deletedStates[s][u]===null)this.state[s][u]={};else if(this.state[s][u])for(let d of Object.keys(this.deletedStates[s][u]))delete this.state[s][u][d];l[u]=this.state[s][u]}o[s]=o[s]||{},Ne(o[s],l)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(let s in e)e[s].setFeatureState(o,n)}}class fR{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function pR(t,e,n,o){let s=0,l=Number.MAX_VALUE;for(let u=0;u<3;u++)if(Math.abs(o[u])<1e-15){if(n[u]<t[u]||n[u]>e[u])return null}else{let d=1/o[u],f=(t[u]-n[u])*d,p=(e[u]-n[u])*d;if(f>p){let g=f;f=p,p=g}if(f>s&&(s=f),p<l&&(l=p),s>l)return null}return s}function mR(t,e,n,o,s,l,u,d,f,p,g){let _=o-t,v=s-e,x=l-n,b=u-t,T=d-e,E=f-n,M=g[1]*E-g[2]*T,S=g[2]*b-g[0]*E,P=g[0]*T-g[1]*b,O=_*M+v*S+x*P;if(Math.abs(O)<1e-15)return null;let A=1/O,R=p[0]-t,F=p[1]-e,k=p[2]-n,N=(R*M+F*S+k*P)*A;if(N<0||N>1)return null;let B=F*x-k*v,H=k*_-R*x,G=R*v-F*_,Y=(g[0]*B+g[1]*H+g[2]*G)*A;return Y<0||N+Y>1?null:(b*B+T*H+E*G)*A}function gR(t,e,n){return(t-e)/(n-e)}function _R(t,e,n,o,s,l,u,d,f){let p=1<<n,g=l-o,_=u-s,v=(t+1)/p*g+o,x=(e+0)/p*_+s,b=(e+1)/p*_+s;d[0]=(t+0)/p*g+o,d[1]=x,f[0]=v,f[1]=b}class yR{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(l){let u=Math.ceil(Math.log2(l.dim/8)),d=[],f=Math.ceil(Math.pow(2,u)),p=1/f,g=(x,b,T,E,M)=>{let S=E?1:0,P=(x+1)*T-S,O=b*T,A=(b+1)*T-S;M[0]=x*T,M[1]=O,M[2]=P,M[3]=A},_=new fR(f),v=[];for(let x=0;x<f*f;x++){g(x%f,Math.floor(x/f),p,!1,v);let b=Zu(v[0],v[1],l),T=Zu(v[2],v[1],l),E=Zu(v[2],v[3],l),M=Zu(v[0],v[3],l);_.minimums.push(Math.min(b,T,E,M)),_.maximums.push(Math.max(b,T,E,M)),_.leaves.push(1)}for(d.push(_),f/=2;f>=1;f/=2){let x=d[d.length-1];_=new fR(f);for(let b=0;b<f*f;b++){g(b%f,Math.floor(b/f),2,!0,v);let T=x.getElevation(v[0],v[1]),E=x.getElevation(v[2],v[1]),M=x.getElevation(v[2],v[3]),S=x.getElevation(v[0],v[3]),P=x.isLeaf(v[0],v[1]),O=x.isLeaf(v[2],v[1]),A=x.isLeaf(v[2],v[3]),R=x.isLeaf(v[0],v[3]),F=Math.min(T.min,E.min,M.min,S.min),k=Math.max(T.max,E.max,M.max,S.max),N=P&&O&&A&&R;_.maximums.push(k),_.minimums.push(F),_.leaves.push(k-F<=5&&N?1:0)}d.push(_)}return d}(this.dem),o=n.length-1,s=n[o];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,s,l,u,d=1){return pR([e,n,-100],[o,s,this.maximums[0]*d],l,u)}raycast(e,n,o,s,l,u,d=1){if(!this.nodeCount)return null;let f=this.raycastRoot(e,n,o,s,l,u,d);if(f==null)return null;let p=[],g=[],_=[],v=[],x=[{idx:0,t:f,nodex:0,nodey:0,depth:0}];for(;x.length>0;){let{idx:b,t:T,nodex:E,nodey:M,depth:S}=x.pop();if(this.leaves[b]){_R(E,M,S,e,n,o,s,_,v);let O=1<<S,A=(E+0)/O,R=(E+1)/O,F=(M+0)/O,k=(M+1)/O,N=Zu(A,F,this.dem)*d,B=Zu(R,F,this.dem)*d,H=Zu(R,k,this.dem)*d,G=Zu(A,k,this.dem)*d,Y=mR(_[0],_[1],N,v[0],_[1],B,v[0],v[1],H,l,u),U=mR(v[0],v[1],H,_[0],v[1],G,_[0],_[1],N,l,u),Q=Math.min(Y!==null?Y:Number.MAX_VALUE,U!==null?U:Number.MAX_VALUE);if(Q!==Number.MAX_VALUE)return Q;{let te=Z.scaleAndAdd([],l,u,T);if(vR(N,B,G,H,gR(te[0],_[0],v[0]),gR(te[1],_[1],v[1]))>=te[2])return T}continue}let P=0;for(let O=0;O<this._siblingOffset.length;O++){_R((E<<1)+this._siblingOffset[O][0],(M<<1)+this._siblingOffset[O][1],S+1,e,n,o,s,_,v),_[2]=-100,v[2]=this.maximums[this.childOffsets[b]+O]*d;let A=pR(_,v,l,u);if(A!=null){let R=A;p[O]=R;let F=!1;for(let k=0;k<P&&!F;k++)R>=p[g[k]]&&(g.splice(k,0,O),F=!0);F||(g[P]=O),P++}}for(let O=0;O<P;O++){let A=g[O];x.push({idx:this.childOffsets[b]+A,t:p[A],nodex:(E<<1)+this._siblingOffset[A][0],nodey:(M<<1)+this._siblingOffset[A][1],depth:S+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,s,l){if(e[s].isLeaf(n,o)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);let u=s-1,d=e[u],f=0,p=0;for(let g=0;g<this._siblingOffset.length;g++){let _=2*n+this._siblingOffset[g][0],v=2*o+this._siblingOffset[g][1],x=d.getElevation(_,v),b=d.isLeaf(_,v),T=this._addNode(x.min,x.max,b);b&&(f|=1<<g),p||(p=T)}for(let g=0;g<this._siblingOffset.length;g++)f&1<<g||this._construct(e,2*n+this._siblingOffset[g][0],2*o+this._siblingOffset[g][1],u,p+g)}}function vR(t,e,n,o,s,l){return Yt(Yt(t,n,l),Yt(e,o,l),s)}function Zu(t,e,n){let o=n.dim,s=ze(t*o-.5,0,o-1),l=ze(e*o-.5,0,o-1),u=Math.floor(s),d=Math.floor(l),f=Math.min(u+1,o-1),p=Math.min(d+1,o-1);return vR(n.get(u,d),n.get(f,d),n.get(u,p),n.get(f,p),s-u,l-d)}let wG={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function TG(t,e,n){return(256*t*256+256*e+n)/10-1e4}function EG(t,e,n){return 256*t+e+n/256-32768}class iv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,s=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return J(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let l=this.dim=n.height-2,u=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=s,this._modifiedForSources={},!s){for(let f=0;f<l;f++)u[this._idx(-1,f)]=u[this._idx(0,f)],u[this._idx(l,f)]=u[this._idx(l-1,f)],u[this._idx(f,-1)]=u[this._idx(f,0)],u[this._idx(f,l)]=u[this._idx(f,l-1)];u[this._idx(-1,-1)]=u[this._idx(0,0)],u[this._idx(l,-1)]=u[this._idx(l-1,0)],u[this._idx(-1,l)]=u[this._idx(0,l-1)],u[this._idx(l,l)]=u[this._idx(l-1,l-1)]}let d=o==="terrarium"?EG:TG;for(let f=0;f<u.length;++f){let p=4*f;this.floatView[f]=d(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}this._timestamp=Zt.now()}_buildQuadTree(){this._tree=new yR(this)}get(e,n,o=!1){o&&(e=ze(e,-1,this.dim),n=ze(n,-1,this.dim));let s=this._idx(e,n);return this.floatView[s]}set(e,n,o){let s=this._idx(e,n),l=this.floatView[s];return this.floatView[s]=o,o-l}static getUnpackVector(e){return wG[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let o=[0,0,0,0],s=iv.getUnpackVector(n),l=Math.floor((e+s[3])/s[2]);return o[2]=l%256,l=Math.floor(l/256),o[1]=l%256,l=Math.floor(l/256),o[0]=l,o}getPixels(){return new J2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=n*this.dim,l=n*this.dim+this.dim,u=o*this.dim,d=o*this.dim+this.dim;switch(n){case-1:s=l-1;break;case 1:l=s+1}switch(o){case-1:u=d-1;break;case 1:d=u+1}let f=-n*this.dim,p=-o*this.dim;for(let g=u;g<d;g++)for(let _=s;_<l;_++){let v=4*this._idx(_,g),x=4*this._idx(_+f,g+p);this.pixels[v+0]=e.pixels[x+0],this.pixels[v+1]=e.pixels[x+1],this.pixels[v+2]=e.pixels[x+2],this.pixels[v+3]=e.pixels[x+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}pt(iv,"DEMData"),pt(yR,"DemMinMaxQuadTree",{omit:["dem"]});class MG{isDataAvailableAtPoint(e){let n=this._source();if(this.isUsingMockSource()||!n||e.y<0||e.y>1)return!1;let o=n.getSource().maxzoom,s=1<<o,l=Math.floor(e.x),u=Math.floor((e.x-l)*s),d=Math.floor(e.y*s),f=this.findDEMTileFor(new qn(o,l,o,u,d));return!(!f||!f.dem)}getAtPointOrZero(e,n=0){return this.getAtPoint(e,n)||0}getAtPoint(e,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);let s=this._source();if(!s||e.y<0||e.y>1)return n;let l=s.getSource().maxzoom,u=1<<l,d=Math.floor(e.x),f=e.x-d,p=new qn(l,d,l,Math.floor(f*u),Math.floor(e.y*u)),g=this.findDEMTileFor(p);if(!g||!g.dem)return n;let _=g.dem,v=1<<g.tileID.canonical.z,x=(f*v-g.tileID.canonical.x)*_.dim,b=(e.y*v-g.tileID.canonical.y)*_.dim,T=Math.floor(x),E=Math.floor(b);return(o?this.exaggeration():1)*Yt(Yt(_.get(T,E),_.get(T,E+1),b-E),Yt(_.get(T+1,E),_.get(T+1,E+1),b-E),x-T)}getAtTileOffset(e,n,o){let s=1<<e.canonical.z;return this.getAtPointOrZero(new Fn(e.wrap+(e.canonical.x+n/ne)/s,(e.canonical.y+o/ne)/s))}getAtTileOffsetFunc(e,n,o,s){return l=>{let u=this.getAtTileOffset(e,l.x,l.y),d=s.upVector(e.canonical,l.x,l.y),f=s.upVectorScale(e.canonical,n,o).metersToTile;return Z.scale(d,d,u*f),d}}getForTilePoints(e,n,o,s){if(this.isUsingMockSource())return!1;let l=Xf.create(this,e,s);return!!l&&(n.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],o)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;let n=this.findDEMTileFor(e);if(!n||!n.dem)return null;let o=n.dem.tree,s=n.tileID,l=1<<e.canonical.z-s.canonical.z,u=e.canonical.x/l-s.canonical.x,d=e.canonical.y/l-s.canonical.y,f=0;for(let p=0;p<e.canonical.z-s.canonical.z&&!o.leaves[f];p++){u*=2,d*=2;let g=2*Math.floor(d)+Math.floor(u);f=o.childOffsets[f]+g,u%=1,d%=1}return{min:this.exaggeration()*o.minimums[f],max:this.exaggeration()*o.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let e=this.visibleDemTiles;if(e.length===0)return null;let n=!1,o=Number.MAX_VALUE,s=Number.MIN_VALUE;for(let l of e){let u=this.getMinMaxForTile(l.tileID);u&&(o=Math.min(o,u.min),s=Math.max(s,u.max),n=!0)}return n?{min:o,max:s}:null}}class Xf{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){let s=o||e.findDEMTileFor(n);if(!s||!s.dem)return;let l=s.dem,u=s.tileID,d=1<<n.canonical.z-u.canonical.z;return new Xf(s,l.dim/ne/d,[(n.canonical.x/d-u.canonical.x)*l.dim,(n.canonical.y/d-u.canonical.y)*l.dim])}tileCoordToPixel(e,n){let o=n*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(o);return new X(s,l)}getElevationAt(e,n,o,s){let l=e*this._scale+this._offset[0],u=n*this._scale+this._offset[1],d=Math.floor(l),f=Math.floor(u),p=this._dem;return s=!!s,o?Yt(Yt(p.get(d,f,s),p.get(d,f+1,s),u-f),Yt(p.get(d+1,f,s),p.get(d+1,f+1,s),u-f),l-d):p.get(d,f,s)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Oi(1,e)*this._dem.stride}}class XT{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Lf(ne,16,0),this.featureIndexArray=new YP,this.promoteId=n}insert(e,n,o,s,l,u=0){let d=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,s,l,u);let f=this.grid;for(let p=0;p<n.length;p++){let g=n[p],_=[1/0,1/0,-1/0,-1/0];for(let v=0;v<g.length;v++){let x=g[v];_[0]=Math.min(_[0],x.x),_[1]=Math.min(_[1],x.y),_[2]=Math.max(_[2],x.x),_[3]=Math.max(_[3],x.y)}_[0]<ne&&_[1]<ne&&_[2]>=0&&_[3]>=0&&f.insert(d,_[0],_[1],_[2],_[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ZT(new nv(this.rawTileData)).layers,this.sourceLayerCoder=new sR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,o,s){this.loadVTLayers();let l=e.params||{},u=my(l.filter),d=e.tileResult,f=e.transform,p=d.bufferedTilespaceBounds,g=this.grid.query(p.min.x,p.min.y,p.max.x,p.max.y,(b,T,E,M)=>$2(d.bufferedTilespaceGeometry,b,T,E,M));g.sort(IG);let _=null;f.elevation&&g.length>0&&(_=Xf.create(f.elevation,this.tileID));let v={},x;for(let b=0;b<g.length;b++){let T=g[b];if(T===x)continue;x=T;let E=this.featureIndexArray.get(T),M=null;this.loadMatchingFeature(v,E,u,l.layers,l.availableImages,n,o,s,(S,P,O,A=0)=>(M||(M=Jl(S,this.tileID.canonical,e.tileTransform)),P.queryIntersectsFeature(d,S,O,M,this.z,e.transform,e.pixelPosMatrix,_,A)))}return v}loadMatchingFeature(e,n,o,s,l,u,d,f,p){let{featureIndex:g,bucketIndex:_,sourceLayerIndex:v,layoutVertexArrayOffset:x}=n,b=this.bucketLayerIDs[_];if(s&&!function(S,P){for(let O=0;O<S.length;O++)if(P.indexOf(S[O])>=0)return!0;return!1}(s,b))return;let T=this.sourceLayerCoder.decode(v),E=this.vtLayers[T].feature(g);if(o.needGeometry){let S=Wu(E,!0);if(!o.filter(new ur(this.tileID.overscaledZ),S,this.tileID.canonical))return}else if(!o.filter(new ur(this.tileID.overscaledZ),E))return;let M=this.getId(E,T);for(let S=0;S<b.length;S++){let P=b[S];if(s&&s.indexOf(P)<0)continue;let O=u[P];if(!O)continue;let A={};M!==void 0&&f&&(A=f.getState(O.sourceLayer||"_geojsonTileLayer",M));let R=Ne({},d[P]);R.paint=xR(R.paint,O.paint,E,A,l),R.layout=xR(R.layout,O.layout,E,A,l);let F=!p||p(E,O,A,x);if(!F)continue;let k=new hR(E,this.z,this.x,this.y,M);k.layer=R;let N=e[P];N===void 0&&(N=e[P]=[]),N.push({featureIndex:g,feature:k,intersectionZ:F})}}lookupSymbolFeatures(e,n,o,s,l,u,d,f){let p={};this.loadVTLayers();let g=my(l);for(let _ of e)this.loadMatchingFeature(p,{bucketIndex:o,sourceLayerIndex:s,featureIndex:_,layoutVertexArrayOffset:0},g,u,d,f,n);return p}loadFeature(e){let{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();let s=this.sourceLayerCoder.decode(o),l=this.vtFeatures[s];if(l[n])return l[n];let u=this.vtLayers[s].feature(n);return l[n]=u,u}hasLayer(e){for(let n of this.bucketLayerIDs)for(let o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;if(this.promoteId){let s=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];s!=null&&(o=e.properties[s]),typeof o=="boolean"&&(o=Number(o))}return o}}function xR(t,e,n,o,s){return nl(t,(l,u)=>{let d=e instanceof Nm?e.get(u):null;return d&&d.evaluate?d.evaluate(n,o,s):d})}function IG(t,e){return e-t}pt(XT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let CG=ri([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),SG=ri([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),DG=ri([{name:"a_projected_pos",components:4,type:"Float32"}],4);ri([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let AG=ri([{name:"a_z_offset",components:1,type:"Float32"}],4),PG=ri([{name:"a_texb",components:2,type:"Uint16"}]),OG=ri([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),RG=ri([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);ri([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let bR=ri([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),LG=ri([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ri([{name:"triangle",components:3,type:"Uint16"}]),ri([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ri([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ri([{type:"Float32",name:"offsetX"}]),ri([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ao=24;let ml=128;function KT(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ur(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:s}=n,l=0;for(;l<o.length&&o[l]<=t;)l++;l=Math.max(0,l-1);let u=l;for(;u<o.length&&o[u]<t+1;)u++;u=Math.min(o.length-1,u);let d=o[l],f=o[u];return n.kind==="composite"?{kind:"composite",minZoom:d,maxZoom:f,interpolationType:s}:{kind:"camera",minZoom:d,maxZoom:f,minSize:n.evaluate(new ur(d)),maxSize:n.evaluate(new ur(f)),interpolationType:s}}}function Jm(t,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:s}){return t.kind==="source"?o/ml:t.kind==="composite"?Yt(o/ml,s/ml,n):e}function Ql(t,e){let n=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:s,minZoom:l,maxZoom:u}=t,d=s?ze(Zl.interpolationFactor(s,e,l,u),0,1):0;t.kind==="camera"?o=Yt(t.minSize,t.maxSize,d):n=d}return{uSizeT:n,uSize:o}}var FG=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ml,evaluateSizeForFeature:Jm,evaluateSizeForZoom:Ql,getSizeData:KT});function kG(t,e,n){return t.sections.forEach(o=>{o.text=function(s,l,u){let d=l.layout.get("text-transform").evaluate(u,{});return d==="uppercase"?s=s.toLocaleUpperCase():d==="lowercase"&&(s=s.toLocaleLowerCase()),Ba.applyArabicShaping&&(s=Ba.applyArabicShaping(s)),s}(o.text,e,n)}),t}let Qm={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function NG(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function zG(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let JT=3;function BG(t,e,n){e.glyphs=[],t===1&&n.readMessage(jG,e)}function jG(t,e,n){if(t===3){let{id:o,bitmap:s,width:l,height:u,left:d,top:f,advance:p}=n.readMessage(VG,{});e.glyphs.push({id:o,bitmap:new Hc({width:l+2*JT,height:u+2*JT},s),metrics:{width:l,height:u,left:d,top:f,advance:p}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function VG(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let wR=JT,rr={horizontal:1,vertical:2,horizontalOnly:3},TR=-17;class eg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let o=new eg;return o.scale=e||1,o.fontStack=n,o}static forImage(e){let n=new eg;return n.imageName=e,n}}class Kf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let o=new Kf;for(let s=0;s<e.sections.length;s++){let l=e.sections[s];l.image?o.addImageSection(l):o.addTextSection(l,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,o){let s="";for(let l=0;l<n.length;l++){let u=n.charCodeAt(l+1)||null,d=n.charCodeAt(l-1)||null;s+=!o&&(u&&OP(u)&&!Qm[n[l+1]]||d&&OP(d)&&!Qm[n[l-1]])||!Qm[n[l]]?n[l]:Qm[n[l]]}return s}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&rv[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&rv[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let o=new Kf;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(eg.forText(e.scale,e.fontStack||n));let o=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(o)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void J("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(eg.forImage(n)),this.sectionIndex.push(this.sections.length-1)):J("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function QT(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b){let T=Kf.fromFeature(t,s);_===rr.vertical&&T.verticalizePunctuation(v);let E=[],M=function(R,F,k,N,B,H){if(!R)return[];let G=[],Y=function(se,K,ee,de,pe,fe){let be=0;for(let Te=0;Te<se.length();Te++){let Me=se.getSection(Te);be+=ER(se.getCodePoint(Te),Me,de,pe,K,fe)}return be/Math.max(1,Math.ceil(be/ee))}(R,F,k,N,B,H),U=R.text.indexOf("\u200B")>=0,Q=0;for(let se=0;se<R.length();se++){let K=R.getSection(se),ee=R.getCodePoint(se);if(rv[ee]||(Q+=ER(ee,K,N,B,F,H)),se<R.length()-1){let de=!((te=ee)<11904||!(xt["Bopomofo Extended"](te)||xt.Bopomofo(te)||xt["CJK Compatibility Forms"](te)||xt["CJK Compatibility Ideographs"](te)||xt["CJK Compatibility"](te)||xt["CJK Radicals Supplement"](te)||xt["CJK Strokes"](te)||xt["CJK Symbols and Punctuation"](te)||xt["CJK Unified Ideographs Extension A"](te)||xt["CJK Unified Ideographs"](te)||xt["Enclosed CJK Letters and Months"](te)||xt["Halfwidth and Fullwidth Forms"](te)||xt.Hiragana(te)||xt["Ideographic Description Characters"](te)||xt["Kangxi Radicals"](te)||xt["Katakana Phonetic Extensions"](te)||xt.Katakana(te)||xt["Vertical Forms"](te)||xt["Yi Radicals"](te)||xt["Yi Syllables"](te)));(UG[ee]||de||K.imageName)&&G.push(IR(se+1,Q,Y,G,$G(ee,R.getCodePoint(se+1),de&&U),!1))}}var te;return CR(IR(R.length(),Q,Y,G,0,!0))}(T,p,l,e,o,x),{processBidirectionalText:S,processStyledBidirectionalText:P}=Ba;if(S&&T.sections.length===1){let R=S(T.toString(),M);for(let F of R){let k=new Kf;k.text=F,k.sections=T.sections;for(let N=0;N<F.length;N++)k.sectionIndex.push(0);E.push(k)}}else if(P){let R=P(T.text,T.sectionIndex,M);for(let F of R){let k=new Kf;k.text=F[0],k.sectionIndex=F[1],k.sections=T.sections,E.push(k)}}else E=function(R,F){let k=[],N=R.text,B=0;for(let H of F)k.push(R.substring(B,H)),B=H;return B<N.length&&k.push(R.substring(B,N.length)),k}(T,M);let O=[],A={positionedLines:O,text:T.toString(),top:g[1],bottom:g[1],left:g[0],right:g[0],writingMode:_,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(R,F,k,N,B,H,G,Y,U,Q,te,se){let K=0,ee=0,de=0,pe=Y==="right"?1:Y==="left"?0:.5,fe=!1;for(let et of B){let tt=et.getSections();for(let lt of tt){if(lt.imageName)continue;let ct=F[lt.fontStack];if(ct&&(fe=ct.ascender!==void 0&&ct.descender!==void 0,!fe))break}if(!fe)break}let be=0;for(let et of B){et.trim();let tt=et.getMaxScale(),lt=(tt-1)*Ao,ct={positionedGlyphs:[],lineOffset:0};R.positionedLines[be]=ct;let Ht=ct.positionedGlyphs,Tt=0;if(!et.length()){ee+=H,++be;continue}let zn=0,Dn=0;for(let kt=0;kt<et.length();kt++){let St=et.getSection(kt),Pn=et.getSectionIndex(kt),Nn=et.getCodePoint(kt),fn=St.scale,Ri=null,Or=null,Mi=null,Zi=Ao,jr=0,Rr=!(U===rr.horizontal||!te&&!Rw(Nn)||te&&(rv[Nn]||(Te=Nn,xt.Arabic(Te)||xt["Arabic Supplement"](Te)||xt["Arabic Extended-A"](Te)||xt["Arabic Presentation Forms-A"](Te)||xt["Arabic Presentation Forms-B"](Te))));if(St.imageName){let Xi=N[St.imageName];if(!Xi)continue;Mi=St.imageName,R.iconsInText=R.iconsInText||!0,Or=Xi.paddedRect;let _i=Xi.displaySize;fn=fn*Ao/se,Ri={width:_i[0],height:_i[1],left:0,top:-wR,advance:Rr?_i[1]:_i[0],localGlyph:!1},jr=fe?-Ri.height*fn:TR+tt*Ao-_i[1]*fn,Zi=Ri.advance;let zo=(Rr?_i[0]:_i[1])*fn-Ao*tt;zo>0&&zo>Tt&&(Tt=zo)}else{let Xi=k[St.fontStack];if(!Xi)continue;Xi[Nn]&&(Or=Xi[Nn]);let _i=F[St.fontStack];if(!_i)continue;let zo=_i.glyphs[Nn];if(!zo)continue;if(Ri=zo.metrics,Zi=Nn!==8203?Ao:0,fe){let oc=_i.ascender!==void 0?Math.abs(_i.ascender):0,qc=_i.descender!==void 0?Math.abs(_i.descender):0,Zc=(oc+qc)*fn;zn<Zc&&(zn=Zc,Dn=(oc-qc)/2*fn),jr=-oc*fn}else jr=TR+(tt-fn)*Ao}Rr?(R.verticalizable=!0,Ht.push({glyph:Nn,imageName:Mi,x:K,y:ee+jr,vertical:Rr,scale:fn,localGlyph:Ri.localGlyph,fontStack:St.fontStack,sectionIndex:Pn,metrics:Ri,rect:Or}),K+=Zi*fn+Q):(Ht.push({glyph:Nn,imageName:Mi,x:K,y:ee+jr,vertical:Rr,scale:fn,localGlyph:Ri.localGlyph,fontStack:St.fontStack,sectionIndex:Pn,metrics:Ri,rect:Or}),K+=Ri.advance*fn+Q)}Ht.length!==0&&(de=Math.max(K-Q,de),fe?SR(Ht,pe,Tt,Dn,H*tt/2):SR(Ht,pe,Tt,0,H/2)),K=0;let Gt=H*tt+Tt;ct.lineOffset=Math.max(Tt,lt),ee+=Gt,++be}var Te;let Me=ee,{horizontalAlign:ge,verticalAlign:Pe}=ov(G);(function(et,tt,lt,ct,Ht,Tt){let zn=(tt-lt)*Ht,Dn=-Tt*ct;for(let Gt of et)for(let kt of Gt.positionedGlyphs)kt.x+=zn,kt.y+=Dn})(R.positionedLines,pe,ge,Pe,de,Me),R.top+=-Pe*Me,R.bottom=R.top+Me,R.left+=-ge*de,R.right=R.left+de,R.hasBaseline=fe}(A,e,n,o,E,u,d,f,_,p,v,b),!function(R){for(let F of R)if(F.positionedGlyphs.length!==0)return!1;return!0}(O)&&A}let rv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},UG={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ER(t,e,n,o,s,l){if(e.imageName){let u=o[e.imageName];return u?u.displaySize[0]*e.scale*Ao/l+s:0}{let u=n[e.fontStack],d=u&&u.glyphs[t];return d?d.metrics.advance*e.scale+s:0}}function MR(t,e,n,o){let s=Math.pow(t-e,2);return o?t<e?s/2:2*s:s+Math.abs(n)*n}function $G(t,e,n){let o=0;return t===10&&(o-=1e4),n&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function IR(t,e,n,o,s,l){let u=null,d=MR(e,n,s,l);for(let f of o){let p=MR(e-f.x,n,s,l)+f.badness;p<=d&&(u=f,d=p)}return{index:t,x:e,priorBreak:u,badness:d}}function CR(t){return t?CR(t.priorBreak).concat(t.index):[]}function ov(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function SR(t,e,n,o,s){if(!(e||n||o||s))return;let l=t.length-1,u=t[l],d=(u.x+u.metrics.advance*u.scale)*e;for(let f=0;f<=l;f++)t[f].x-=d,t[f].y+=n+o+s}function HG(t,e,n,o){let{horizontalAlign:s,verticalAlign:l}=ov(o),u=n[0]-t.displaySize[0]*s,d=n[1]-t.displaySize[1]*l;return{imagePrimary:t,imageSecondary:e,top:d,bottom:d+t.displaySize[1],left:u,right:u+t.displaySize[0]}}function DR(t,e,n,o,s,l){let u=t.imagePrimary,d;if(u.content){let E=u.content,M=u.pixelRatio||1;d=[E[0]/M,E[1]/M,u.displaySize[0]-E[2]/M,u.displaySize[1]-E[3]/M]}let f=e.left*l,p=e.right*l,g,_,v,x;n==="width"||n==="both"?(x=s[0]+f-o[3],_=s[0]+p+o[1]):(x=s[0]+(f+p-u.displaySize[0])/2,_=x+u.displaySize[0]);let b=e.top*l,T=e.bottom*l;return n==="height"||n==="both"?(g=s[1]+b-o[0],v=s[1]+T+o[2]):(g=s[1]+(b+T-u.displaySize[1])/2,v=g+u.displaySize[1]),{imagePrimary:u,imageSecondary:void 0,top:g,right:_,bottom:v,left:x,collisionPadding:d}}class Wc extends X{constructor(e,n,o,s,l){super(e,n),this.angle=s,this.z=o,l!==void 0&&(this.segment=l)}clone(){return new Wc(this.x,this.y,this.z,this.angle,this.segment)}}function AR(t,e,n,o,s){if(e.segment===void 0)return!0;let l=e,u=e.segment+1,d=0;for(;d>-n/2;){if(u--,u<0)return!1;d-=t[u].dist(l),l=t[u]}d+=t[u].dist(t[u+1]),u++;let f=[],p=0;for(;d<n/2;){let g=t[u],_=t[u+1];if(!_)return!1;let v=t[u-1].angleTo(g)-g.angleTo(_);for(v=Math.abs((v+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:d,angleDelta:v}),p+=v;d-f[0].distance>o;)p-=f.shift().angleDelta;if(p>s)return!1;u++,d+=g.dist(_)}return!0}function PR(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function OR(t,e,n){return t?.6*e*n:0}function RR(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function GG(t,e,n,o,s,l){let u=OR(n,s,l),d=RR(n,o)*l,f=0,p=PR(t)/2;for(let g=0;g<t.length-1;g++){let _=t[g],v=t[g+1],x=_.dist(v);if(f+x>p){let b=(p-f)/x,T=Yt(_.x,v.x,b),E=Yt(_.y,v.y,b),M=new Wc(T,E,0,v.angleTo(_),g);return!u||AR(t,M,d,u,e)?M:void 0}f+=x}}function WG(t,e,n,o,s,l,u,d,f){let p=OR(o,l,u),g=RR(o,s),_=g*u,v=t[0].x===0||t[0].x===f||t[0].y===0||t[0].y===f;return e-_<e/4&&(e=_+e/4),LR(t,v?e/2*d%e:(g/2+2*l)*u*d%e,e,p,n,_,v,!1,f)}function LR(t,e,n,o,s,l,u,d,f){let p=l/2,g=PR(t),_=0,v=e-n,x=[];for(let b=0;b<t.length-1;b++){let T=t[b],E=t[b+1],M=T.dist(E),S=E.angleTo(T);for(;v+n<_+M;){v+=n;let P=(v-_)/M,O=Yt(T.x,E.x,P),A=Yt(T.y,E.y,P);if(O>=0&&O<f&&A>=0&&A<f&&v-p>=0&&v+p<=g){let R=new Wc(O,A,0,S,b);o&&!AR(t,R,l,o,s)||x.push(R)}}_+=M}return d||x.length||u||(x=LR(t,_/2,n,o,s,l,u,!0,f)),x}function FR(t,e,n,o,s){let l=[];for(let u=0;u<t.length;u++){let d=t[u],f;for(let p=0;p<d.length-1;p++){let g=d[p],_=d[p+1];g.x<e&&_.x<e||(g.x<e?g=new X(e,g.y+(e-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x<e&&(_=new X(e,g.y+(e-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y<n&&_.y<n||(g.y<n?g=new X(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round():_.y<n&&(_=new X(g.x+(n-g.y)/(_.y-g.y)*(_.x-g.x),n)._round()),g.x>=o&&_.x>=o||(g.x>=o?g=new X(o,g.y+(o-g.x)/(_.x-g.x)*(_.y-g.y))._round():_.x>=o&&(_=new X(o,g.y+(o-g.x)/(_.x-g.x)*(_.y-g.y))._round()),g.y>=s&&_.y>=s||(g.y>=s?g=new X(g.x+(s-g.y)/(_.y-g.y)*(_.x-g.x),s)._round():_.y>=s&&(_=new X(g.x+(s-g.y)/(_.y-g.y)*(_.x-g.x),s)._round()),f&&g.equals(f[f.length-1])||(f=[g],l.push(f)),f.push(_)))))}}return l}function eE(t){let e=0,n=0;for(let u of t)e+=u.w*u.h,n=Math.max(n,u.w);t.sort((u,d)=>d.h-u.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,l=0;for(let u of t)for(let d=o.length-1;d>=0;d--){let f=o[d];if(!(u.w>f.w||u.h>f.h)){if(u.x=f.x,u.y=f.y,l=Math.max(l,u.y+u.h),s=Math.max(s,u.x+u.w),u.w===f.w&&u.h===f.h){let p=o.pop();d<o.length&&(o[d]=p)}else u.h===f.h?(f.x+=u.w,f.w-=u.w):u.w===f.w?(f.y+=u.h,f.h-=u.h):(o.push({x:f.x+u.w,y:f.y,w:f.w-u.w,h:u.h}),f.y+=u.h,f.h-=u.h);break}}return{w:s,h:l,fill:e/(s*l)||0}}pt(Wc,"Anchor");let qs=1;class tE{constructor(e,{pixelRatio:n,version:o,stretchX:s,stretchY:l,content:u}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=s,this.stretchY=l,this.content=u,this.version=o}get tl(){return[this.paddedRect.x+qs,this.paddedRect.y+qs]}get br(){return[this.paddedRect.x+this.paddedRect.w-qs,this.paddedRect.y+this.paddedRect.h-qs]}get displaySize(){return[(this.paddedRect.w-2*qs)/this.pixelRatio,(this.paddedRect.h-2*qs)/this.pixelRatio]}}class kR{constructor(e,n){let o={},s={};this.haveRenderCallbacks=[];let l=[];this.addImages(e,o,l),this.addImages(n,s,l);let{w:u,h:d}=eE(l),f=new qr({width:u||1,height:d||1});for(let p in e){let g=e[p],_=o[p].paddedRect;qr.copy(g.data,f,{x:0,y:0},{x:_.x+qs,y:_.y+qs},g.data)}for(let p in n){let g=n[p],_=s[p].paddedRect,v=_.x+qs,x=_.y+qs,b=g.data.width,T=g.data.height;qr.copy(g.data,f,{x:0,y:0},{x:v,y:x},g.data),qr.copy(g.data,f,{x:0,y:T-1},{x:v,y:x-1},{width:b,height:1}),qr.copy(g.data,f,{x:0,y:0},{x:v,y:x+T},{width:b,height:1}),qr.copy(g.data,f,{x:b-1,y:0},{x:v-1,y:x},{width:1,height:T}),qr.copy(g.data,f,{x:0,y:0},{x:v+b,y:x},{width:1,height:T})}this.image=f,this.iconPositions=o,this.patternPositions=s}addImages(e,n,o){for(let s in e){let l=e[s],u={x:0,y:0,w:l.data.width+2*qs,h:l.data.height+2*qs};o.push(u),n[s]=new tE(u,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let s in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[s],e.getImage(s,o),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s,o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;let[s,l]=e.tl;o.update(n.data,void 0,{x:s,y:l})}}pt(tE,"ImagePosition"),pt(kR,"ImageAtlas");let tg=1e20;function NR(t,e,n,o,s,l,u,d,f){for(let p=e;p<e+o;p++)zR(t,n*l+p,l,s,u,d,f);for(let p=n;p<n+s;p++)zR(t,p*l+e,1,o,u,d,f)}function zR(t,e,n,o,s,l,u){l[0]=0,u[0]=-tg,u[1]=tg,s[0]=t[e];for(let d=1,f=0,p=0;d<o;d++){s[d]=t[e+d*n];let g=d*d;do{let _=l[f];p=(s[d]-s[_]+g-_*_)/(d-_)/2}while(p<=u[f]&&--f>-1);f++,l[f]=d,u[f]=p,u[f+1]=tg}for(let d=0,f=0;d<o;d++){for(;u[f+1]<d;)f++;let p=l[f],g=d-p;t[e+d*n]=s[p]+g*g}}let gl=2;class Jf{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,o){let s=[],l=this.urls[n]||D.GLYPHS_URL;for(let u in e)for(let d of e[u])s.push({stack:u,id:d});Ji(s,({stack:u,id:d},f)=>{let p=this.entries[u];p||(p=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=p.glyphs[d];if(g!==void 0)return void f(null,{stack:u,id:d,glyph:g});if(g=this._tinySDF(p,u,d),g)return p.glyphs[d]=g,void f(null,{stack:u,id:d,glyph:g});let _=Math.floor(d/256);if(256*_>65535)return void f(new Error("glyphs > 65535 not supported"));if(p.ranges[_])return void f(null,{stack:u,id:d,glyph:g});let v=p.requests[_];v||(v=p.requests[_]=[],Jf.loadGlyphRange(u,_,l,this.requestManager,(x,b)=>{if(b){p.ascender=b.ascender,p.descender=b.descender;for(let T in b.glyphs)this._doesCharSupportLocalGlyph(+T)||(p.glyphs[+T]=b.glyphs[+T]);p.ranges[_]=!0}for(let T of v)T(x,b);delete p.requests[_]})),v.push((x,b)=>{x?f(x):b&&f(null,{stack:u,id:d,glyph:b.glyphs[d]||null})})},(u,d)=>{if(u)o(u);else if(d){let f={};for(let{stack:p,id:g,glyph:_}of d)f[p]===void 0&&(f[p]={}),f[p].glyphs===void 0&&(f[p].glyphs={}),f[p].glyphs[g]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},f[p].ascender=this.entries[p].ascender,f[p].descender=this.entries[p].descender;o(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(xt["CJK Unified Ideographs"](e)||xt["Hangul Syllables"](e)||xt.Hiragana(e)||xt.Katakana(e)||xt["CJK Symbols and Punctuation"](e)||xt["CJK Unified Ideographs Extension A"](e)||xt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,o){let s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(o))return;let l=e.tinySDF;if(!l){let T="400";/bold/i.test(n)?T="900":/medium/i.test(n)?T="500":/light/i.test(n)&&(T="200"),l=e.tinySDF=new Jf.TinySDF({fontFamily:s,fontWeight:T,fontSize:24*gl,buffer:3*gl,radius:8*gl}),l.fontWeight=T}if(this.localGlyphs[l.fontWeight][o])return this.localGlyphs[l.fontWeight][o];let u=String.fromCodePoint(o),{data:d,width:f,height:p,glyphWidth:g,glyphHeight:_,glyphLeft:v,glyphTop:x,glyphAdvance:b}=l.draw(u);return this.localGlyphs[l.fontWeight][o]={id:o,bitmap:new Hc({width:f,height:p},d),metrics:{width:g/gl,height:_/gl,left:v/gl,top:x/gl-27,advance:b/gl,localGlyph:!0}}}}Jf.loadGlyphRange=function(t,e,n,o,s){let l=256*e,u=l+255,d=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${l}-${u}`),ve.Glyphs);Qe(d,(f,p)=>{if(f)s(f);else if(p){let g={},_=function(v){return new nv(v).readFields(BG,{})}(p);for(let v of _.glyphs)g[v.id]=v;s(null,{glyphs:g,ascender:_.ascender,descender:_.descender})}})},Jf.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:s="sans-serif",fontWeight:l="normal",fontStyle:u="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;let d=this.size=t+4*e,f=this._createCanvas(d),p=this.ctx=f.getContext("2d",{willReadFrequently:!0});p.font=`${u} ${l} ${t}px ${s}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:s,actualBoundingBoxRight:l}=this.ctx.measureText(t),u=Math.ceil(n),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-s))),f=Math.min(this.size-this.buffer,u+Math.ceil(o)),p=d+2*this.buffer,g=f+2*this.buffer,_=Math.max(p*g,0),v=new Uint8ClampedArray(_),x={data:v,width:p,height:g,glyphWidth:d,glyphHeight:f,glyphTop:u,glyphLeft:0,glyphAdvance:e};if(d===0||f===0)return x;let{ctx:b,buffer:T,gridInner:E,gridOuter:M}=this;b.clearRect(T,T,d,f),b.fillText(t,T,T+u);let S=b.getImageData(T,T,d,f);M.fill(tg,0,_),E.fill(0,0,_);for(let P=0;P<f;P++)for(let O=0;O<d;O++){let A=S.data[4*(P*d+O)+3]/255;if(A===0)continue;let R=(P+T)*p+O+T;if(A===1)M[R]=0,E[R]=tg;else{let F=.5-A;M[R]=F>0?F*F:0,E[R]=F<0?F*F:0}}NR(M,0,0,p,g,p,this.f,this.v,this.z),NR(E,T,T,d,f,p,this.f,this.v,this.z);for(let P=0;P<_;P++){let O=Math.sqrt(M[P])-Math.sqrt(E[P]);v[P]=Math.round(255-255*(O/this.radius+this.cutoff))}return x}};let Yu=qs;function BR(t,e,n,o){let s=[],l=t.imagePrimary,u=l.pixelRatio,d=l.paddedRect.w-2*Yu,f=l.paddedRect.h-2*Yu,p=t.right-t.left,g=t.bottom-t.top,_=l.stretchX||[[0,d]],v=l.stretchY||[[0,f]],x=(H,G)=>H+G[1]-G[0],b=_.reduce(x,0),T=v.reduce(x,0),E=d-b,M=f-T,S=0,P=b,O=0,A=T,R=0,F=E,k=0,N=M;if(l.content&&o){let H=l.content;S=sv(_,0,H[0]),O=sv(v,0,H[1]),P=sv(_,H[0],H[2]),A=sv(v,H[1],H[3]),R=H[0]-S,k=H[1]-O,F=H[2]-H[0]-P,N=H[3]-H[1]-A}let B=(H,G,Y,U)=>{let Q=av(H.stretch-S,P,p,t.left),te=lv(H.fixed-R,F,H.stretch,b),se=av(G.stretch-O,A,g,t.top),K=lv(G.fixed-k,N,G.stretch,T),ee=av(Y.stretch-S,P,p,t.left),de=lv(Y.fixed-R,F,Y.stretch,b),pe=av(U.stretch-O,A,g,t.top),fe=lv(U.fixed-k,N,U.stretch,T),be=new X(Q,se),Te=new X(ee,se),Me=new X(ee,pe),ge=new X(Q,pe),Pe=new X(te/u,K/u),et=new X(de/u,fe/u),tt=e*Math.PI/180;if(tt){let Dn=Math.sin(tt),Gt=Math.cos(tt),kt=[Gt,-Dn,Dn,Gt];be._matMult(kt),Te._matMult(kt),ge._matMult(kt),Me._matMult(kt)}let lt=H.stretch+H.fixed,ct=Y.stretch+Y.fixed,Ht=G.stretch+G.fixed,Tt=U.stretch+U.fixed,zn=t.imageSecondary;return{tl:be,tr:Te,bl:ge,br:Me,texPrimary:{x:l.paddedRect.x+Yu+lt,y:l.paddedRect.y+Yu+Ht,w:ct-lt,h:Tt-Ht},texSecondary:zn?{x:zn.paddedRect.x+Yu+lt,y:zn.paddedRect.y+Yu+Ht,w:ct-lt,h:Tt-Ht}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pe,pixelOffsetBR:et,minFontScaleX:F/u/p,minFontScaleY:N/u/g,isSDF:n}};if(o&&(l.stretchX||l.stretchY)){let H=jR(_,E,b),G=jR(v,M,T);for(let Y=0;Y<H.length-1;Y++){let U=H[Y],Q=H[Y+1];for(let te=0;te<G.length-1;te++)s.push(B(U,G[te],Q,G[te+1]))}}else s.push(B({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:d+1},{fixed:0,stretch:f+1}));return s}function sv(t,e,n){let o=0;for(let s of t)o+=Math.max(e,Math.min(n,s[1]))-Math.max(e,Math.min(n,s[0]));return o}function jR(t,e,n){let o=[{fixed:-Yu,stretch:0}];for(let[s,l]of t){let u=o[o.length-1];o.push({fixed:s-u.stretch,stretch:u.stretch}),o.push({fixed:s-u.stretch,stretch:u.stretch+(l-s)})}return o.push({fixed:e+Yu,stretch:n}),o}function av(t,e,n,o){return t/e*n+o}function lv(t,e,n,o){return t-e*n/o}function qG(t,e,n,o){let s=e+t.positionedLines[o].lineOffset;return o===0?n+s/2:n+(s+(e+t.positionedLines[o-1].lineOffset))/2}function ZG(t,e=1,n=!1){let o=1/0,s=1/0,l=-1/0,u=-1/0,d=t[0];for(let x=0;x<d.length;x++){let b=d[x];(!x||b.x<o)&&(o=b.x),(!x||b.y<s)&&(s=b.y),(!x||b.x>l)&&(l=b.x),(!x||b.y>u)&&(u=b.y)}let f=Math.min(l-o,u-s),p=f/2,g=new Oe([],YG);if(f===0)return new X(o,s);for(let x=o;x<l;x+=f)for(let b=s;b<u;b+=f)g.push(new Qf(x+p,b+p,p,t));let _=function(x){let b=0,T=0,E=0,M=x[0];for(let S=0,P=M.length,O=P-1;S<P;O=S++){let A=M[S],R=M[O],F=A.x*R.y-R.x*A.y;T+=(A.x+R.x)*F,E+=(A.y+R.y)*F,b+=3*F}return new Qf(T/b,E/b,0,x)}(t),v=g.length;for(;g.length;){let x=g.pop();(x.d>_.d||!_.d)&&(_=x,n&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,v)),x.max-_.d<=e||(p=x.h/2,g.push(new Qf(x.p.x-p,x.p.y-p,p,t)),g.push(new Qf(x.p.x+p,x.p.y-p,p,t)),g.push(new Qf(x.p.x-p,x.p.y+p,p,t)),g.push(new Qf(x.p.x+p,x.p.y+p,p,t)),v+=4)}return n&&(console.log(`num probes: ${v}`),console.log(`best distance: ${_.d}`)),_.p}function YG(t,e){return e.max-t.max}class Qf{constructor(e,n,o,s){this.p=new X(e,n),this.h=o,this.d=function(l,u){let d=!1,f=1/0;for(let p=0;p<u.length;p++){let g=u[p];for(let _=0,v=g.length,x=v-1;_<v;x=_++){let b=g[_],T=g[x];b.y>l.y!=T.y>l.y&&l.x<(T.x-b.x)*(l.y-b.y)/(T.y-b.y)+b.x&&(d=!d),f=Math.min(f,V2(l,b,T))}}return(d?1:-1)*Math.sqrt(f)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}}let ep=7,nE=Number.POSITIVE_INFINITY,XG=Math.sqrt(2);function iE(t,[e,n]){let o=0,s=0;if(n===nE){e<0&&(e=0);let l=e/XG;switch(t){case"top-right":case"top-left":s=l-ep;break;case"bottom-right":case"bottom-left":s=-l+ep;break;case"bottom":s=-e+ep;break;case"top":s=e-ep}switch(t){case"top-right":case"bottom-right":o=-l;break;case"top-left":case"bottom-left":o=l;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":s=n-ep;break;case"bottom-right":case"bottom-left":case"bottom":s=-n+ep}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,s]}function KG(t,e,n,o,s,l,u,d,f,p,g){t.createArrays(),t.tilePixelRatio=ne/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let _=t.layers[0].layout,v=t.layers[0]._unevaluatedLayout._values,x={};if(t.textSizeData.kind==="composite"){let{minZoom:M,maxZoom:S}=t.textSizeData;x.compositeTextSizes=[v["text-size"].possiblyEvaluate(new ur(M),d),v["text-size"].possiblyEvaluate(new ur(S),d)]}if(t.iconSizeData.kind==="composite"){let{minZoom:M,maxZoom:S}=t.iconSizeData;x.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new ur(M),d),v["icon-size"].possiblyEvaluate(new ur(S),d)]}x.layoutTextSize=v["text-size"].possiblyEvaluate(new ur(f+1),d),x.layoutIconSize=v["icon-size"].possiblyEvaluate(new ur(f+1),d),x.textMaxSize=v["text-size"].possiblyEvaluate(new ur(18),d);let b=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point",T=_.get("text-size"),E=!1;for(let M of t.features)if(M.icon&&M.icon.nameSecondary){E=!0;break}for(let M of t.features){let S=_.get("text-font").evaluate(M,{},d).join(","),P=T.evaluate(M,{},d),O=x.layoutTextSize.evaluate(M,{},d),A=(x.layoutIconSize.evaluate(M,{},d),{horizontal:{},vertical:void 0}),R=M.text,F,k=[0,0];if(R){let H=R.toString(),G=_.get("text-letter-spacing").evaluate(M,{},d)*Ao,Y=_.get("text-line-height").evaluate(M,{},d)*Ao,U=E6(H)?G:0,Q=_.get("text-anchor").evaluate(M,{},d),te=_.get("text-variable-anchor");if(!te){let pe=_.get("text-radial-offset").evaluate(M,{},d);k=pe?iE(Q,[pe*Ao,nE]):_.get("text-offset").evaluate(M,{},d).map(fe=>fe*Ao)}let se=b?"center":_.get("text-justify").evaluate(M,{},d),K=_.get("symbol-placement")==="point",ee=K?_.get("text-max-width").evaluate(M,{},d)*Ao:1/0,de=pe=>{t.allowVerticalPlacement&&Ow(H)&&(A.vertical=QT(R,e,n,s,S,ee,Y,Q,pe,U,k,rr.vertical,!0,O,P))};if(!b&&te){let pe=se==="auto"?te.map(be=>rE(be)):[se],fe=!1;for(let be=0;be<pe.length;be++){let Te=pe[be];if(!A.horizontal[Te])if(fe)A.horizontal[Te]=A.horizontal[0];else{let Me=QT(R,e,n,s,S,ee,Y,"center",Te,U,k,rr.horizontal,!1,O,P);Me&&(A.horizontal[Te]=Me,fe=Me.positionedLines.length===1)}}de("left")}else{if(se==="auto"&&(se=rE(Q)),K||_.get("text-writing-mode").indexOf("horizontal")>=0||!Ow(H)){let pe=QT(R,e,n,s,S,ee,Y,Q,se,U,k,rr.horizontal,!1,O,P);pe&&(A.horizontal[se]=pe)}de(K?"left":se)}}let N=!1;if(M.icon&&M.icon.namePrimary){let H=o[M.icon.namePrimary];H&&(F=HG(s[M.icon.namePrimary],M.icon.nameSecondary?s[M.icon.nameSecondary]:void 0,_.get("icon-offset").evaluate(M,{},d),_.get("icon-anchor").evaluate(M,{},d)),N=H.sdf,t.sdfIcons===void 0?t.sdfIcons=H.sdf:t.sdfIcons!==H.sdf&&J("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(H.pixelRatio!==t.pixelRatio||_.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let B=UR(A.horizontal)||A.vertical;t.iconsInText||(t.iconsInText=!!B&&B.iconsInText),(B||F)&&JG(t,M,A,F,o,x,O,0,k,N,u,d,p,g,E)}l&&t.generateCollisionDebugBuffers(f,t.collisionBoxArray)}function rE(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function JG(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b){let T=l.textMaxSize.evaluate(e,{},_);T===void 0&&(T=u);let E=t.layers[0].layout,M=E.get("icon-offset").evaluate(e,{},_),S=UR(n.horizontal)||n.vertical,P=v.name==="globe",O=Ao,A=u/O,R=t.tilePixelRatio*T/O,F=(Q=t.overscaling,t.zoom>18&&Q>2&&(Q>>=1),Math.max(ne/(512*Q),1)*E.get("symbol-spacing")),k=E.get("text-padding")*t.tilePixelRatio,N=E.get("icon-padding")*t.tilePixelRatio,B=Vt(E.get("text-max-angle")),H=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",G=E.get("icon-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",Y=E.get("symbol-placement"),U=F/2;var Q;let te=E.get("icon-text-fit").evaluate(e,{},_),se=E.get("icon-text-fit-padding").evaluate(e,{},_),K=te!=="none",ee;t.hasAnyIconTextFit===!1&&K&&(t.hasAnyIconTextFit=!0),o&&K&&(t.allowVerticalPlacement&&n.vertical&&(ee=DR(o,n.vertical,te,se,M,A)),S&&(o=DR(o,S,te,se,M,A)));let de=(pe,fe,be)=>{if(fe.x<0||fe.x>=ne||fe.y<0||fe.y>=ne)return;let Te=null;if(P){let{x:Me,y:ge,z:Pe}=v.projectTilePoint(fe.x,fe.y,be);Te={anchor:new Wc(Me,ge,Pe,0,void 0),up:v.upVector(be,fe.x,fe.y)}}(function(Me,ge,Pe,et,tt,lt,ct,Ht,Tt,zn,Dn,Gt,kt,St,Pn,Nn,fn,Ri,Or,Mi,Zi,jr,Rr,Xi,_i,zo,oc){let qc=Me.addToLineVertexArray(ge,et),Zc,Tg,Eg,r0,Yk,Xk,Kk,Jk=0,Qk=0,eN=0,tN=0,rM=-1,oM=-1,sc={},nN=iT(""),ph=Pe?Pe.anchor:ge,sM=Tt.layout.get("icon-text-fit").evaluate(Zi,{},_i)!=="none",aM=0,lM=0;if(Tt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[aM,lM]=Tt.layout.get("text-offset").evaluate(Zi,{},_i).map(Ys=>Ys*Ao):(aM=Tt.layout.get("text-radial-offset").evaluate(Zi,{},_i)*Ao,lM=nE),Me.allowVerticalPlacement&&tt.vertical){let Ys=tt.vertical;if(Pn)Xk=oE(Ys),Ht&&(Kk=oE(Ht));else{let Xs=Tt.layout.get("text-rotate").evaluate(Zi,{},_i)+90;Eg=cv(zn,ph,ge,Dn,Gt,kt,Ys,St,Xs,Nn),Ht&&(r0=cv(zn,ph,ge,Dn,Gt,kt,Ht,Ri,Xs))}}if(lt){let Ys=Tt.layout.get("icon-rotate").evaluate(Zi,{},_i),Xs=BR(lt,Ys,Rr,sM),dp=Ht?BR(Ht,Ys,Rr,sM):void 0;Tg=cv(zn,ph,ge,Dn,Gt,kt,lt,Ri,Ys),Jk=4*Xs.length;let iN=Me.iconSizeData,mh=null;iN.kind==="source"?(mh=[ml*Tt.layout.get("icon-size").evaluate(Zi,{},_i)],mh[0]>Xu&&J(`${Me.layerIds[0]}: Value for "icon-size" is >= ${ng}. Reduce your "icon-size".`)):iN.kind==="composite"&&(mh=[ml*jr.compositeIconSizes[0].evaluate(Zi,{},_i),ml*jr.compositeIconSizes[1].evaluate(Zi,{},_i)],(mh[0]>Xu||mh[1]>Xu)&&J(`${Me.layerIds[0]}: Value for "icon-size" is >= ${ng}. Reduce your "icon-size".`)),Me.addSymbols(Me.icon,Xs,mh,Mi,Or,Zi,!1,Pe,ge,qc.lineStartIndex,qc.lineLength,-1,Xi,_i,zo,oc),rM=Me.icon.placedSymbolArray.length-1,dp&&(Qk=4*dp.length,Me.addSymbols(Me.icon,dp,mh,Mi,Or,Zi,rr.vertical,Pe,ge,qc.lineStartIndex,qc.lineLength,-1,Xi,_i,zo,oc),oM=Me.icon.placedSymbolArray.length-1)}for(let Ys in tt.horizontal){let Xs=tt.horizontal[Ys];Zc||(nN=iT(Xs.text),Pn?Yk=oE(Xs):Zc=cv(zn,ph,ge,Dn,Gt,kt,Xs,St,Tt.layout.get("text-rotate").evaluate(Zi,{},_i),Nn));let dp=Xs.positionedLines.length===1;if(eN+=VR(Me,Pe,ge,Xs,ct,Tt,Pn,Zi,Nn,qc,tt.vertical?rr.horizontal:rr.horizontalOnly,dp?Object.keys(tt.horizontal):[Ys],sc,rM,jr,Xi,_i,zo),dp)break}tt.vertical&&(tN+=VR(Me,Pe,ge,tt.vertical,ct,Tt,Pn,Zi,Nn,qc,rr.vertical,["vertical"],sc,oM,jr,Xi,_i,zo));let id=-1,cM=(Ys,Xs)=>Ys?Math.max(Ys,Xs):Xs;id=cM(Yk,id),id=cM(Xk,id),id=cM(Kk,id);let k7=id>-1?1:0;Me.glyphOffsetArray.length>=ag.MAX_GLYPHS&&J("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zi.sortKey!==void 0&&Me.addToSortKeyRanges(Me.symbolInstances.length,Zi.sortKey),Me.symbolInstances.emplaceBack(ge.x,ge.y,ph.x,ph.y,ph.z,sc.right>=0?sc.right:-1,sc.center>=0?sc.center:-1,sc.left>=0?sc.left:-1,sc.vertical>=0?sc.vertical:-1,rM,oM,nN,Zc!==void 0?Zc:Me.collisionBoxArray.length,Zc!==void 0?Zc+1:Me.collisionBoxArray.length,Eg!==void 0?Eg:Me.collisionBoxArray.length,Eg!==void 0?Eg+1:Me.collisionBoxArray.length,Tg!==void 0?Tg:Me.collisionBoxArray.length,Tg!==void 0?Tg+1:Me.collisionBoxArray.length,r0||Me.collisionBoxArray.length,r0?r0+1:Me.collisionBoxArray.length,Dn,eN,tN,Jk,Qk,k7,0,aM,lM,id,0,sM?1:0)})(t,fe,Te,pe,n,o,s,ee,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,k,H,f,0,N,G,M,e,l,p,g,_,x,b)};if(Y==="line")for(let pe of FR(e.geometry,0,0,ne,ne)){let fe=WG(pe,F,B,n.vertical||S,o,O,R,t.overscaling,ne);for(let be of fe)S&&QG(t,S.text,U,be)||de(pe,be,_)}else if(Y==="line-center"){for(let pe of e.geometry)if(pe.length>1){let fe=GG(pe,B,n.vertical||S,o,O,R);fe&&de(pe,fe,_)}}else if(e.type==="Polygon")for(let pe of GT(e.geometry,0)){let fe=ZG(pe,16);de(pe[0],new Wc(fe.x,fe.y,0,0,void 0),_)}else if(e.type==="LineString")for(let pe of e.geometry)de(pe,new Wc(pe[0].x,pe[0].y,0,0,void 0),_);else if(e.type==="Point")for(let pe of e.geometry)for(let fe of pe)de([fe],new Wc(fe.x,fe.y,0,0,void 0),_)}let ng=255,Xu=ng*ml;function VR(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M){let S=function(A,R,F,k,N,B,H,G){let Y=[];if(R.positionedLines.length===0)return Y;let U=k.layout.get("text-rotate").evaluate(B,{})*Math.PI/180,Q=function(de){let pe=de[0],fe=de[1],be=pe*fe;return be>0?[pe,-fe]:be<0?[-pe,fe]:pe===0?[fe,pe]:[fe,-pe]}(F),te=Math.abs(R.top-R.bottom);for(let de of R.positionedLines)te-=de.lineOffset;let se=R.positionedLines.length,K=te/se,ee=R.top-F[1];for(let de=0;de<se;++de){let pe=R.positionedLines[de];ee=qG(R,K,ee,de);for(let fe of pe.positionedGlyphs){if(!fe.rect)continue;let be=fe.rect||{},Te=wR+1,Me=!0,ge=1,Pe=0;if(fe.imageName){let Mi=H[fe.imageName];if(!Mi)continue;if(Mi.sdf){J("SDF images are not supported in formatted text and will be ignored.");continue}Me=!1,ge=Mi.pixelRatio,Te=qs/ge}let et=(N||G)&&fe.vertical,tt=fe.metrics.advance*fe.scale/2,lt=fe.metrics,ct=fe.rect;if(ct===null)continue;G&&R.verticalizable&&(Pe=fe.imageName?tt-fe.metrics.width*fe.scale/2:0);let Ht=N?[fe.x+tt,fe.y]:[0,0],Tt=[0,0],zn=[0,0],Dn=!1;N||(et?(zn=[fe.x+tt+Q[0],fe.y+Q[1]-Pe],Dn=!0):Tt=[fe.x+tt+F[0],fe.y+F[1]-Pe]);let Gt=ct.w*fe.scale/(ge*(fe.localGlyph?gl:1)),kt=ct.h*fe.scale/(ge*(fe.localGlyph?gl:1)),St,Pn,Nn,fn;if(et){let Mi=fe.y-ee,Zi=new X(-tt,tt-Mi),jr=-Math.PI/2,Rr=new X(...zn);St=new X(-tt+Tt[0],Tt[1]),St._rotateAround(jr,Zi)._add(Rr),St.x+=-Mi+tt,St.y-=(lt.left-Te)*fe.scale;let Xi=fe.imageName?lt.advance*fe.scale:Ao*fe.scale,_i=String.fromCodePoint(fe.glyph);NG(_i)?St.x+=(1-Te)*fe.scale:zG(_i)?St.x+=Xi-lt.height*fe.scale+(-Te-1)*fe.scale:St.x+=fe.imageName||lt.width+2*Te===ct.w&&lt.height+2*Te===ct.h?(Xi-kt)/2:(Xi-(lt.height+2*Te)*fe.scale)/2,Pn=new X(St.x,St.y-Gt),Nn=new X(St.x+kt,St.y),fn=new X(St.x+kt,St.y-Gt)}else{let Mi=(lt.left-Te)*fe.scale-tt+Tt[0],Zi=(-lt.top-Te)*fe.scale+Tt[1],jr=Mi+Gt,Rr=Zi+kt;St=new X(Mi,Zi),Pn=new X(jr,Zi),Nn=new X(Mi,Rr),fn=new X(jr,Rr)}if(U){let Mi;Mi=N?new X(0,0):Dn?new X(Q[0],Q[1]):new X(F[0],F[1]),St._rotateAround(U,Mi),Pn._rotateAround(U,Mi),Nn._rotateAround(U,Mi),fn._rotateAround(U,Mi)}let Ri=new X(0,0),Or=new X(0,0);Y.push({tl:St,tr:Pn,bl:Nn,br:fn,texPrimary:be,texSecondary:void 0,writingMode:R.writingMode,glyphOffset:Ht,sectionIndex:fe.sectionIndex,isSDF:Me,pixelOffsetTL:Ri,pixelOffsetBR:Or,minFontScaleX:0,minFontScaleY:0})}}return Y}(0,o,f,l,u,d,s,t.allowVerticalPlacement),P=t.textSizeData,O=null;P.kind==="source"?(O=[ml*l.layout.get("text-size").evaluate(d,{},E)],O[0]>Xu&&J(`${t.layerIds[0]}: Value for "text-size" is >= ${ng}. Reduce your "text-size".`)):P.kind==="composite"&&(O=[ml*b.compositeTextSizes[0].evaluate(d,{},E),ml*b.compositeTextSizes[1].evaluate(d,{},E)],(O[0]>Xu||O[1]>Xu)&&J(`${t.layerIds[0]}: Value for "text-size" is >= ${ng}. Reduce your "text-size".`)),t.addSymbols(t.text,S,O,f,u,d,g,e,n,p.lineStartIndex,p.lineLength,x,T,E,M,!1);for(let A of _)v[A]=t.text.placedSymbolArray.length-1;return 4*S.length}function UR(t){for(let e in t)return t[e];return null}function cv(t,e,n,o,s,l,u,d,f,p){let g=u.top,_=u.bottom,v=u.left,x=u.right,b=u.collisionPadding;if(b&&(v-=b[0],g-=b[1],x+=b[2],_+=b[3]),f){let T=new X(v,g),E=new X(x,g),M=new X(v,_),S=new X(x,_),P=Vt(f),O=new X(0,0);p&&(O=new X(p[0],p[1])),T._rotateAround(P,O),E._rotateAround(P,O),M._rotateAround(P,O),S._rotateAround(P,O),v=Math.min(T.x,E.x,M.x,S.x),x=Math.max(T.x,E.x,M.x,S.x),g=Math.min(T.y,E.y,M.y,S.y),_=Math.max(T.y,E.y,M.y,S.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,v,g,x,_,d,o,s,l),t.length-1}function oE(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function QG(t,e,n,o){let s=t.compareText;if(e in s){let l=s[e];for(let u=l.length-1;u>=0;u--)if(o.dist(l[u])<n)return!0}else s[e]=[];return s[e].push(o),!1}function $R(t,e){let n=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),l=Math.sin(n)*s/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),u=Math.sin(t._pitch)*l+s;return Math.min(1.01*u,s*(1/t._horizonShift))}function ah(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),o=t.x*n,s=(t.x+1)*n,l=t.y*n,u=(t.y+1)*n,d=Ws(o),f=Ws(s),p=Jr(l),g=Jr(u),_=e.project(d,p),v=e.project(f,p),x=e.project(f,g),b=e.project(d,g),T=Math.min(_.x,v.x,x.x,b.x),E=Math.min(_.y,v.y,x.y,b.y),M=Math.max(_.x,v.x,x.x,b.x),S=Math.max(_.y,v.y,x.y,b.y),P=n/16;function O(R,F,k,N,B,H){let G=(k+B)/2,Y=(N+H)/2,U=e.project(Ws(G),Jr(Y)),Q=Math.max(0,T-U.x,E-U.y,U.x-M,U.y-S);T=Math.min(T,U.x),M=Math.max(M,U.x),E=Math.min(E,U.y),S=Math.max(S,U.y),Q>P&&(O(R,U,k,N,G,Y),O(U,F,G,Y,B,H))}O(_,v,o,l,s,l),O(v,x,s,l,s,u),O(x,b,s,u,o,u),O(b,_,o,u,o,l),T-=P,E-=P,M+=P,S+=P;let A=1/Math.max(M-T,S-E);return{scale:A,x:T*A,y:E*A,x2:M*A,y2:S*A,projection:e}}function HR(t,e,n,o,s,l,u,d,f){if(f.name==="globe")return CT(t,e,new Va(n,o,s),!1);let p=ah({z:n,x:o,y:s},f);return new qi([(l+p.x/p.scale)*e,e*(p.y/p.scale),u],[(l+p.x2/p.scale)*e,e*(p.y2/p.scale),d])}function GR(t,{x:e,y:n},o=0){return new X(((e-o)*t.scale-t.x)*ne,(n*t.scale-t.y)*ne)}function WR(t,e,n=0){return Z.fromValues(((e.x-n)*t.scale-t.x)*ne,(e.y*t.scale-t.y)*ne,F2(e.z,e.y))}let e8=ae.identity(new Float32Array(16));class Ku{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Xt(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o=!0){return e._coordinatePoint(e.locationCoordinate(n),o)}pixelsPerMeter(e,n){return Oi(1,e)*n}pixelSpaceConversion(e,n,o){return 1}farthestPixelDistance(e){return $R(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,s){let l=e.horizonLineFromTop(!1),u=new X(n,Math.max(l,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(u,s))}pointCoordinate3D(e,n,o){let s=new X(n,o);if(e.elevation)return e.elevation.pointCoordinate(s);{let l=this.pointCoordinate(e,s.x,s.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return e8}createTileMatrix(e,n,o){let s,l,u,d=o.canonical,f=ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let p=ah(d,this);s=1,l=p.x+o.wrap*p.scale,u=p.y,ae.scale(f,f,[s/p.scale,s/p.scale,e.pixelsPerMeter/n])}else s=n/e.zoomScale(d.z),l=(d.x+Math.pow(2,d.z)*o.wrap)*s,u=d.y*s;return ae.translate(f,f,[l,u,0]),ae.scale(f,f,[s/ne,s/ne,1]),f}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class t8 extends Ku{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,o]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(Vt(n));this.n=(s+Math.sin(Vt(o)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:o,c:s,r0:l}=this,u=Vt(e-this.center[0]),d=Vt(n),f=Math.sqrt(s-2*o*Math.sin(d))/o;return{x:f*Math.sin(u*o),y:f*Math.cos(u*o)-l,z:0}}unproject(e,n){let{n:o,c:s,r0:l}=this,u=l+n,d=Math.atan2(e,Math.abs(u))*Math.sign(u);u*o<0&&(d-=Math.PI*Math.sign(e)*Math.sign(u));let f=Vt(this.center[0])*o;d=bi(d,-Math.PI-f,Math.PI-f);let p=ze(xi(d/o)+this.center[0],-180,180),g=Math.asin(ze((s-(e*e+u*u)*o*o)/(2*o),-1,1)),_=ze(xi(g),-Pr,Pr);return new Xt(p,_)}}let ig=1.340264,rg=-.081106,og=893e-6,sg=.003796,uv=Math.sqrt(3)/2;class n8 extends Ku{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let o=Math.asin(uv*Math.sin(n)),s=o*o,l=s*s*s;return{x:.5*(e*Math.cos(o)/(uv*(ig+3*rg*s+l*(7*og+9*sg*s)))/Math.PI+.5),y:1-.5*(o*(ig+rg*s+l*(og+sg*s))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,s=o*o,l=s*s*s;for(let g,_,v,x=0;x<12&&(_=o*(ig+rg*s+l*(og+sg*s))-n,v=ig+3*rg*s+l*(7*og+9*sg*s),g=_/v,o=ze(o-g,-Math.PI/3,Math.PI/3),s=o*o,l=s*s*s,!(Math.abs(g)<1e-12));++x);let u=uv*e*(ig+3*rg*s+l*(7*og+9*sg*s))/Math.cos(o),d=Math.asin(Math.sin(o)/uv),f=ze(180*u/Math.PI,-180,180),p=ze(180*d/Math.PI,-Pr,Pr);return new Xt(f,p)}}class i8 extends Ku{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let o=360*(e-.5),s=ze(360*(.5-n),-Pr,Pr);return new Xt(o,s)}}let tp=Math.PI/2;function dv(t){return Math.tan((tp+t)/2)}class r8 extends Ku{constructor(e){super(e),this.center=e.center||[0,30];let[n,o]=this.parallels=e.parallels||[30,30],s=Vt(n),l=Vt(o);this.southernCenter=s+l<0,this.southernCenter&&(s=-s,l=-l);let u=Math.cos(s),d=dv(s);this.n=s===l?Math.sin(s):Math.log(u/Math.cos(l))/Math.log(dv(l)/d),this.f=u*Math.pow(dv(s),this.n)/this.n}project(e,n){n=Vt(n),this.southernCenter&&(n=-n),e=Vt(e-this.center[0]);let o=1e-6,{n:s,f:l}=this;l>0?n<-tp+o&&(n=-tp+o):n>tp-o&&(n=tp-o);let u=l/Math.pow(dv(n),s),d=u*Math.sin(s*e),f=l-u*Math.cos(s*e);return d=.5*(d/Math.PI+.5),f=.5*(f/Math.PI+.5),{x:d,y:this.southernCenter?f:1-f,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:o,f:s}=this,l=s-n,u=Math.sign(l),d=Math.sign(o)*Math.sqrt(e*e+l*l),f=Math.atan2(e,Math.abs(l))*u;l*o<0&&(f-=Math.PI*Math.sign(e)*u);let p=ze(xi(f/o)+this.center[0],-180,180),g=ze(xi(2*Math.atan(Math.pow(s/d,1/o))-tp),-Pr,Pr);return new Xt(p,this.southernCenter?-g:g)}}class qR extends Ku{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:ao(e),y:po(n),z:0}}unproject(e,n){let o=Ws(e),s=Jr(n);return new Xt(o,s)}}let ZR=Vt(Pr);class o8 extends Ku{project(e,n){let o=(n=Vt(n))*n,s=o*o;return{x:.5*((e=Vt(e))*(.8707-.131979*o+s*(s*(.003971*o-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+s*(.028874*o-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,s=25,l=0,u=o*o;do{u=o*o;let p=u*u;l=(o*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))-n)/(1.007226+u*(.045255+p*(.259866*u-.311325-.005916*11*p))),o=ze(o-l,-ZR,ZR)}while(Math.abs(l)>1e-6&&--s>0);u=o*o;let d=ze(xi(e/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),f=xi(o);return new Xt(d,f)}}let YR=Vt(Pr);class s8 extends Ku{project(e,n){n=Vt(n),e=Vt(e);let o=Math.cos(n),s=2/Math.PI,l=Math.acos(o*Math.cos(e/2)),u=Math.sin(l)/l,d=.5*(e*s+2*o*Math.sin(e/2)/u)||0,f=.5*(n+Math.sin(n)/u)||0;return{x:.5*(d/Math.PI+.5),y:1-.5*(f/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,s=n=(2*(1-n)-1)*Math.PI,l=25,u=1e-6,d=0,f=0;do{let p=Math.cos(s),g=Math.sin(s),_=2*g*p,v=g*g,x=p*p,b=Math.cos(o/2),T=Math.sin(o/2),E=2*b*T,M=T*T,S=1-x*b*b,P=S?1/S:0,O=S?Math.acos(p*b)*Math.sqrt(1/S):0,A=.5*(2*O*p*T+2*o/Math.PI)-e,R=.5*(O*g+s)-n,F=.5*P*(x*M+O*p*b*v)+1/Math.PI,k=P*(E*_/4-O*g*T),N=.125*P*(_*T-O*g*x*E),B=.5*P*(v*b+O*M*p)+.5,H=k*N-B*F;d=(R*k-A*B)/H,f=(A*N-R*F)/H,o=ze(o-d,-Math.PI,Math.PI),s=ze(s-f,-YR,YR)}while((Math.abs(d)>u||Math.abs(f)>u)&&--l>0);return new Xt(xi(o),xi(s))}}class XR extends Ku{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Vt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:o,cosPhi:s}=this;return{x:Vt(e)*s*o+.5,y:-Math.sin(Vt(n))/s*o+.5,z:0}}unproject(e,n){let{scale:o,cosPhi:s}=this,l=-(n-.5)/o,u=ze(xi((e-.5)/o)/s,-180,180),d=Math.asin(ze(l*s,-1,1)),f=ze(xi(d),-Pr,Pr);return new Xt(u,f)}}class a8 extends qR{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,o){let s=qm(e,n,o),l=$u(ga(o));return Z.transformMat4(s,s,l),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,n){let o=Ps(n.lat,n.lng),s=Z.normalize([],o),l=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,u=Oi(1,0)*ne*l;Z.scaleAndAdd(o,o,s,u);let d=ae.identity(new Float64Array(16));return ae.multiply(d,e.pixelMatrix,e.globeMatrix),Z.transformMat4(o,o,d),new X(o[0],o[1])}pixelsPerMeter(e,n){return Oi(1,0)*n}pixelSpaceConversion(e,n,o){let s=Oi(1,e)*n,l=Yt(Oi(1,45)*n,s,o);return this.pixelsPerMeter(e,n)/l}createTileMatrix(e,n,o){let s=DT(ga(o.canonical));return ae.multiply(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,n){let{center:o}=e,s=$u(ga(n));return ae.rotateY(s,s,Vt(o.lng)),ae.rotateX(s,s,Vt(o.lat)),ae.scale(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,n,o,s){return w2(e,n,o,!0)||new Fn(0,0)}pointCoordinate3D(e,n,o){let s=this.pointCoordinate(e,n,o,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,n){return!w2(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(s,l){let u=s.cameraToCenterDistance,d=s._centerAltitude*l,f=s._camera,p=s._camera.forward(),g=Z.add([],Z.scale([],p,-u),[0,0,d]),_=s.worldSize/(2*Math.PI),v=[0,0,-_],x=s.width/s.height,b=Math.tan(s.fovAboveCenter),T=Z.scale([],f.up(),b),E=Z.scale([],f.right(),b*x),M=Z.normalize([],Z.add([],Z.add([],p,T),E)),S=[],P;if(new Fy(g,M).closestPointOnSphere(v,_,S)){let O=Z.add([],S,v),A=Z.sub([],O,g);P=Math.cos(s.fovAboveCenter)*Z.length(A)}else{let O=Z.sub([],g,v),A=Z.sub([],v,g);Z.normalize(A,A);let R=Z.length(O)-_;P=Math.sqrt(R*(R+2*_));let F=Math.acos(P/(_+R))-Math.acos(Z.dot(p,A));P*=Math.cos(F)}return 1.01*P}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Do(e.zoom);if(o>0){let s=$R(e,Oi(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),u=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Yt(n,s+l*(1-Math.cos(u)),Math.pow(o,10))}return n}upVector(e,n,o){return qm(n,o,e,1)}upVectorScale(e){return{metersToTile:ky(zy(ga(e)))}}}function hv(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new qR(t);case"equirectangular":return new i8(t);case"naturalEarth":return new o8(t);case"equalEarth":return new n8(t);case"winkelTripel":return new s8(t);case"albers":return n?new XR(t):new t8(t);case"lambertConformalConic":return n?new XR(t):new r8(t);case"globe":return new a8(t)}throw new Error(`Invalid projection name: ${t.name}`)}let l8=new Tr({"symbol-placement":new je(q.layout_symbol["symbol-placement"]),"symbol-spacing":new je(q.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new je(q.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new At(q.layout_symbol["symbol-sort-key"]),"symbol-z-order":new je(q.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new je(q.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new je(q.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new je(q.layout_symbol["icon-ignore-placement"]),"icon-optional":new je(q.layout_symbol["icon-optional"]),"icon-rotation-alignment":new je(q.layout_symbol["icon-rotation-alignment"]),"icon-size":new At(q.layout_symbol["icon-size"]),"icon-text-fit":new At(q.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(q.layout_symbol["icon-text-fit-padding"]),"icon-image":new At(q.layout_symbol["icon-image"]),"icon-rotate":new At(q.layout_symbol["icon-rotate"]),"icon-padding":new je(q.layout_symbol["icon-padding"]),"icon-keep-upright":new je(q.layout_symbol["icon-keep-upright"]),"icon-offset":new At(q.layout_symbol["icon-offset"]),"icon-anchor":new At(q.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new je(q.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new je(q.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new je(q.layout_symbol["text-rotation-alignment"]),"text-field":new At(q.layout_symbol["text-field"]),"text-font":new At(q.layout_symbol["text-font"]),"text-size":new At(q.layout_symbol["text-size"]),"text-max-width":new At(q.layout_symbol["text-max-width"]),"text-line-height":new At(q.layout_symbol["text-line-height"]),"text-letter-spacing":new At(q.layout_symbol["text-letter-spacing"]),"text-justify":new At(q.layout_symbol["text-justify"]),"text-radial-offset":new At(q.layout_symbol["text-radial-offset"]),"text-variable-anchor":new je(q.layout_symbol["text-variable-anchor"]),"text-anchor":new At(q.layout_symbol["text-anchor"]),"text-max-angle":new je(q.layout_symbol["text-max-angle"]),"text-writing-mode":new je(q.layout_symbol["text-writing-mode"]),"text-rotate":new At(q.layout_symbol["text-rotate"]),"text-padding":new je(q.layout_symbol["text-padding"]),"text-keep-upright":new je(q.layout_symbol["text-keep-upright"]),"text-transform":new At(q.layout_symbol["text-transform"]),"text-offset":new At(q.layout_symbol["text-offset"]),"text-allow-overlap":new je(q.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new je(q.layout_symbol["text-ignore-placement"]),"text-optional":new je(q.layout_symbol["text-optional"]),visibility:new je(q.layout_symbol.visibility)});var sE={paint:new Tr({"icon-opacity":new At(q.paint_symbol["icon-opacity"]),"icon-emissive-strength":new At(q.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new At(q.paint_symbol["text-emissive-strength"]),"icon-color":new At(q.paint_symbol["icon-color"]),"icon-halo-color":new At(q.paint_symbol["icon-halo-color"]),"icon-halo-width":new At(q.paint_symbol["icon-halo-width"]),"icon-halo-blur":new At(q.paint_symbol["icon-halo-blur"]),"icon-translate":new je(q.paint_symbol["icon-translate"]),"icon-translate-anchor":new je(q.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new At(q.paint_symbol["icon-image-cross-fade"]),"text-opacity":new At(q.paint_symbol["text-opacity"]),"text-color":new At(q.paint_symbol["text-color"],{runtimeType:fo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new At(q.paint_symbol["text-halo-color"]),"text-halo-width":new At(q.paint_symbol["text-halo-width"]),"text-halo-blur":new At(q.paint_symbol["text-halo-blur"]),"text-translate":new je(q.paint_symbol["text-translate"]),"text-translate-anchor":new je(q.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new je(q.paint_symbol["icon-color-saturation"])}),layout:l8};class KR{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Wi,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt(KR,"FormatSectionOverride",{omit:["defaultValue"]});class fv extends fa{constructor(e,n){super(e,sE,n)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let s=[];for(let l of o)s.indexOf(l)<0&&s.push(l);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,s){let l=this.layout.get(e).evaluate(n,{},o,s),u=this._unevaluatedLayout._values[e];return u.isDataDriven()||dy(u.value)||!l?l:function(d,f){return f.replace(/{([^{}]+)}/g,(p,g)=>g in d?String(d[g]):"")}(n.properties,l)}createBucket(e){return new ag(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of sE.paint.overridableProperties){if(!fv.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),o=new KR(n),s=new Mw(o,n.property.specification),l=null;l=n.value.kind==="constant"||n.value.kind==="source"?new Iw("source",s):new Ru("composite",s,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Nf(n.property,l,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&fv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let o=e.get("text-field"),s=sE.paint.properties[n],l=!1,u=d=>{for(let f of d)if(s.overrides&&s.overrides.hasOverride(f))return void(l=!0)};if(o.value.kind==="constant"&&o.value.value instanceof fs)u(o.value.value.sections);else if(o.value.kind==="source"){let d=p=>{l||(p instanceof Ic&&oo(p.value)===Ld?u(p.value.sections):p instanceof jd?u(p.sections):p.eachChild(d))},f=o.value;f._styleExpression&&d(f._styleExpression.expression)}return l}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),n&&o.push("symbolSDF"),o}getDefaultProgramParams(e,n){return{config:new ih(this,n),overrideFog:!1}}}let c8=Jy.types,u8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pv(t,e,n,o,s,l,u,d,f,p,g,_,v){let x=d?Math.min(Xu,Math.round(d[0])):0,b=d?Math.min(Xu,Math.round(d[1])):0;t.emplaceBack(e,n,Math.round(32*o),Math.round(32*s),l,u,(x<<1)+(f?1:0),b,16*p,16*g,256*_,256*v)}function mv(t,e,n){t.emplaceBack(e,n)}function gv(t,e,n,o,s,l,u){t.emplaceBack(e,n,o,s,l,u)}function _v(t,e,n,o,s){let l=5*e+2;t.float32[l+0]=n,t.float32[l+1]=o,t.float32[l+2]=s}function np(t,e,n,o,s){t.emplaceBack(e,n,o,s),t.emplaceBack(e,n,o,s),t.emplaceBack(e,n,o,s),t.emplaceBack(e,n,o,s)}function d8(t){for(let e of t.sections)if(C6(e.text))return!0;return!1}class aE{constructor(e){this.layoutVertexArray=new Hw,this.indexArray=new Kr,this.programConfigurations=e,this.segments=new Ti,this.dynamicLayoutVertexArray=new Fc,this.opacityVertexArray=new Ww,this.placedSymbolArray=new $P,this.iconTransitioningVertexArray=new Nu,this.globeExtVertexArray=new Gw,this.zOffsetVertexArray=new Bm}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,o,s,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,CG.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,DG.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,u8,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,PG.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,SG.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,AG.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}pt(aE,"SymbolBuffers");class lE{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Ti,this.collisionVertexArray=new Yw,this.collisionVertexArrayExt=new Fc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,OG.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,RG.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}pt(lE,"CollisionBuffers");class yv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ae.identity([]),this.placementViewportMatrix=ae.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=KT(this.zoom,n["text-size"]),this.iconSizeData=KT(this.zoom,n["icon-size"]);let o=this.layers[0].layout,s=o.get("symbol-sort-key"),l=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&s.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(u=>rr[u]),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new aE(new Bu(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new aE(new Bu(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new WP,this.lineVertexArray=new qP,this.symbolInstances=new GP}calculateGlyphDependencies(e,n,o,s,l){for(let u=0;u<e.length;u++){let d=e.codePointAt(u);if(d===void 0)break;if(n[d]=!0,s&&l&&d<=65535){let f=Qm[e.charAt(u)];f&&(n[f.charCodeAt(0)]=!0)}}}populate(e,n,o,s){let l=this.layers[0],u=l.layout,d=this.projection.name==="globe",f=u.get("text-font"),p=u.get("text-field"),g=u.get("icon-image"),_=(p.value.kind!=="constant"||p.value.value instanceof fs&&!p.value.value.isEmpty()||p.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),v=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,x=u.get("symbol-sort-key");if(this.features=[],!_&&!v)return;let b=n.iconDependencies,T=n.glyphDependencies,E=n.availableImages,M=new ur(this.zoom);for(let{feature:S,id:P,index:O,sourceLayerIndex:A}of e){let R=l._featureFilter.needGeometry,F=Wu(S,R);if(!l._featureFilter.filter(M,F,o))continue;if(R||(F.geometry=Jl(S,o,s)),d&&S.type!==1&&o.z<=5){let H=F.geometry,G=.98078528056,Y=(U,Q)=>{let te=qm(U.x,U.y,o,1),se=qm(Q.x,Q.y,o,1);return Z.dot(te,se)<G};for(let U=0;U<H.length;U++)H[U]=xH(H[U],Y)}let k,N;if(_){let H=l.getValueAndResolveTokens("text-field",F,o,E),G=fs.factory(H);d8(G)&&(this.hasRTLText=!0),(!this.hasRTLText||jw()==="unavailable"||this.hasRTLText&&Ba.isParsed())&&(k=kG(G,l,F))}if(v){let H=l.getValueAndResolveTokens("icon-image",F,o,E);N=H instanceof No?H:No.fromString(H)}if(!k&&!N)continue;let B=this.sortFeaturesByKey?x.evaluate(F,{},o):void 0;if(this.features.push({id:P,text:k,icon:N,index:O,sourceLayerIndex:A,geometry:F.geometry,properties:S.properties,type:c8[S.type],sortKey:B}),N&&(b[N.namePrimary]=!0,N.nameSecondary&&(b[N.nameSecondary]=!0)),k){let H=f.evaluate(F,{},o).join(","),G=u.get("text-rotation-alignment")==="map"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rr.vertical)>=0;for(let Y of k.sections)if(Y.image)b[Y.image.namePrimary]=!0;else{let U=Ow(k.toString()),Q=Y.fontStack||H,te=T[Q]=T[Q]||{};this.calculateGlyphDependencies(Y.text,te,G,this.allowVerticalPlacement,U)}}}u.get("symbol-placement")==="line"&&(this.features=function(S){let P={},O={},A=[],R=0;function F(H){A.push(S[H]),R++}function k(H,G,Y){let U=O[H];return delete O[H],O[G]=U,A[U].geometry[0].pop(),A[U].geometry[0]=A[U].geometry[0].concat(Y[0]),U}function N(H,G,Y){let U=P[G];return delete P[G],P[H]=U,A[U].geometry[0].shift(),A[U].geometry[0]=Y[0].concat(A[U].geometry[0]),U}function B(H,G,Y){let U=Y?G[0][G[0].length-1]:G[0][0];return`${H}:${U.x}:${U.y}`}for(let H=0;H<S.length;H++){let G=S[H],Y=G.geometry,U=G.text?G.text.toString():null;if(!U){F(H);continue}let Q=B(U,Y),te=B(U,Y,!0);if(Q in O&&te in P&&O[Q]!==P[te]){let se=N(Q,te,Y),K=k(Q,te,A[se].geometry);delete P[Q],delete O[te],O[B(U,A[K].geometry,!0)]=K,A[se].geometry=null}else Q in O?k(Q,te,Y):te in P?N(Q,te,Y):(F(H),P[Q]=R-1,O[te]=R-1)}return A.filter(H=>H.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((S,P)=>S.sortKey-P.sortKey)}update(e,n,o,s,l){let u=Object.keys(e).length!==0;if(u&&!this.stateDependentLayers.length)return;let d=u?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,d,o,s,l),this.icon.programConfigurations.updatePaintArrays(e,n,d,o,s,l)}updateZOffset(){let e=(l,u,d)=>{o+=u,o>l.length&&l.resize(o);for(let f=-u;f<0;f++)l.emplace(f+o,d)},n=(l,u,d)=>{s+=u,s>l.length&&l.resize(s);for(let f=-u;f<0;f++)l.emplace(f+s,d)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,s=0;for(let l=0;l<this.symbolInstances.length;l++){let u=this.symbolInstances.get(l),{numHorizontalGlyphVertices:d,numVerticalGlyphVertices:f,numIconVertices:p}=u,g=u.zOffset,_=p>0;if((d>0||f>0)&&(e(this.text.zOffsetVertexArray,d,g),e(this.text.zOffsetVertexArray,f,g)),_){let{placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:x}=u;v>=0&&n(this.icon.zOffsetVertexArray,p,g),x>=0&&n(this.icon.zOffsetVertexArray,u.numVerticalIconVertices,g)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=hv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let o=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:s,y:l}of n)this.lineVertexArray.emplaceBack(s,l);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E){let M=e.indexArray,S=e.layoutVertexArray,P=e.globeExtVertexArray,O=e.segments.prepareSegment(4*n.length,S,M,this.canOverlap?u.sortKey:void 0),A=this.glyphOffsetArray.length,R=O.vertexLength,F=this.allowVerticalPlacement&&d===rr.vertical?Math.PI/2:0,k=u.text&&u.text.sections;for(let B=0;B<n.length;B++){let{tl:H,tr:G,bl:Y,br:U,texPrimary:Q,texSecondary:te,pixelOffsetTL:se,pixelOffsetBR:K,minFontScaleX:ee,minFontScaleY:de,glyphOffset:pe,isSDF:fe,sectionIndex:be}=n[B],Te=O.vertexLength,Me=pe[1];if(pv(S,p.x,p.y,H.x,Me+H.y,Q.x,Q.y,o,fe,se.x,se.y,ee,de),pv(S,p.x,p.y,G.x,Me+G.y,Q.x+Q.w,Q.y,o,fe,K.x,se.y,ee,de),pv(S,p.x,p.y,Y.x,Me+Y.y,Q.x,Q.y+Q.h,o,fe,se.x,K.y,ee,de),pv(S,p.x,p.y,U.x,Me+U.y,Q.x+Q.w,Q.y+Q.h,o,fe,K.x,K.y,ee,de),f){let{x:ge,y:Pe,z:et}=f.anchor,[tt,lt,ct]=f.up;gv(P,ge,Pe,et,tt,lt,ct),gv(P,ge,Pe,et,tt,lt,ct),gv(P,ge,Pe,et,tt,lt,ct),gv(P,ge,Pe,et,tt,lt,ct),np(e.dynamicLayoutVertexArray,ge,Pe,et,F)}else np(e.dynamicLayoutVertexArray,p.x,p.y,p.z,F);if(E){let ge=te||Q;mv(e.iconTransitioningVertexArray,ge.x,ge.y),mv(e.iconTransitioningVertexArray,ge.x+ge.w,ge.y),mv(e.iconTransitioningVertexArray,ge.x,ge.y+ge.h),mv(e.iconTransitioningVertexArray,ge.x+ge.w,ge.y+ge.h)}M.emplaceBack(Te,Te+1,Te+2),M.emplaceBack(Te+1,Te+2,Te+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pe[0]),B!==n.length-1&&be===n[B+1].sectionIndex||e.programConfigurations.populatePaintArrays(S.length,u,u.index,{},x,b,T,k&&k[be])}let N=f?f.anchor:p;e.placedSymbolArray.emplaceBack(N.x,N.y,N.z,p.x,p.y,A,this.glyphOffsetArray.length-A,R,g,_,p.segment,o?o[0]:0,o?o[1]:0,s[0],s[1],d,0,!1,0,v,0)}_commitLayoutVertex(e,n,o,s,l,u,d){e.emplaceBack(n,o,s,l,u,Math.round(d.x),Math.round(d.y))}_addCollisionDebugVertices(e,n,o,s,l,u,d){let f=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),p=f.vertexLength,g=d.tileAnchorX,_=d.tileAnchorY;for(let x=0;x<4;x++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,n,e.padding,d.zOffset),this._commitLayoutVertex(o.layoutVertexArray,s,l,u,g,_,new X(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,s,l,u,g,_,new X(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,s,l,u,g,_,new X(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,s,l,u,g,_,new X(e.x1,e.y2)),f.vertexLength+=4;let v=o.indexArray;v.emplaceBack(p,p+1),v.emplaceBack(p+1,p+2),v.emplaceBack(p+2,p+3),v.emplaceBack(p+3,p),f.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,s,l,u){for(let d=s;d<l;d++){let f=o.get(d),p=this.getSymbolInstanceTextSize(e,u,n,d);this._addCollisionDebugVertices(f,p,this.textCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}_addIconDebugCollisionBoxes(e,n,o,s,l,u){for(let d=s;d<l;d++){let f=o.get(d),p=this.getSymbolInstanceIconSize(e,n,u.placedIconSymbolIndex);this._addCollisionDebugVertices(f,p,this.iconCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lE(Cy,bR.members,Nu),this.iconCollisionBox=new lE(Cy,bR.members,Nu);let o=Ql(this.iconSizeData,e),s=Ql(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){let u=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(s,e,n,u.textBoxStartIndex,u.textBoxEndIndex,u),this._addTextDebugCollisionBoxes(s,e,n,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._addIconDebugCollisionBoxes(o,e,n,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._addIconDebugCollisionBoxes(o,e,n,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}}getSymbolInstanceTextSize(e,n,o,s){let l=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:s),u=Jm(this.textSizeData,e,l)/Ao;return this.tilePixelRatio*u}getSymbolInstanceIconSize(e,n,o){let s=this.icon.placedSymbolArray.get(o),l=Jm(this.iconSizeData,e,s);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,n,o,s){e.emplaceBack(n,-o,-o,s),e.emplaceBack(n,o,-o,s),e.emplaceBack(n,o,o,s),e.emplaceBack(n,-o,o,s)}_updateTextDebugCollisionBoxes(e,n,o,s,l,u){for(let d=s;d<l;d++){let f=o.get(d),p=this.getSymbolInstanceTextSize(e,u,n,d);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,p,f.padding,u.zOffset)}}_updateIconDebugCollisionBoxes(e,n,o,s,l,u){for(let d=s;d<l;d++){let f=o.get(d),p=this.getSymbolInstanceIconSize(e,n,u.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,p,f.padding,u.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=Ql(this.iconSizeData,e),s=Ql(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){let u=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(s,e,n,u.textBoxStartIndex,u.textBoxEndIndex,u),this._updateTextDebugCollisionBoxes(s,e,n,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._updateIconDebugCollisionBoxes(o,e,n,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._updateIconDebugCollisionBoxes(o,e,n,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,s,l,u,d,f,p){let g={};if(n<o){let{x1:_,y1:v,x2:x,y2:b,padding:T,projectedAnchorX:E,projectedAnchorY:M,projectedAnchorZ:S,tileAnchorX:P,tileAnchorY:O,featureIndex:A}=e.get(n);g.textBox={x1:_,y1:v,x2:x,y2:b,padding:T,projectedAnchorX:E,projectedAnchorY:M,projectedAnchorZ:S,tileAnchorX:P,tileAnchorY:O},g.textFeatureIndex=A}if(s<l){let{x1:_,y1:v,x2:x,y2:b,padding:T,projectedAnchorX:E,projectedAnchorY:M,projectedAnchorZ:S,tileAnchorX:P,tileAnchorY:O,featureIndex:A}=e.get(s);g.verticalTextBox={x1:_,y1:v,x2:x,y2:b,padding:T,projectedAnchorX:E,projectedAnchorY:M,projectedAnchorZ:S,tileAnchorX:P,tileAnchorY:O},g.verticalTextFeatureIndex=A}if(u<d){let{x1:_,y1:v,x2:x,y2:b,padding:T,projectedAnchorX:E,projectedAnchorY:M,projectedAnchorZ:S,tileAnchorX:P,tileAnchorY:O,featureIndex:A}=e.get(u);g.iconBox={x1:_,y1:v,x2:x,y2:b,padding:T,projectedAnchorX:E,projectedAnchorY:M,projectedAnchorZ:S,tileAnchorX:P,tileAnchorY:O},g.iconFeatureIndex=A}if(f<p){let{x1:_,y1:v,x2:x,y2:b,padding:T,projectedAnchorX:E,projectedAnchorY:M,projectedAnchorZ:S,tileAnchorX:P,tileAnchorY:O,featureIndex:A}=e.get(f);g.verticalIconBox={x1:_,y1:v,x2:x,y2:b,padding:T,projectedAnchorX:E,projectedAnchorY:M,projectedAnchorZ:S,tileAnchorX:P,tileAnchorY:O},g.verticalIconFeatureIndex=A}return g}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let o=e.placedSymbolArray.get(n),s=o.vertexStartIndex+4*o.numGlyphs;for(let l=o.vertexStartIndex;l<s;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),o=Math.cos(e),s=[],l=[],u=[];for(let d=0;d<this.symbolInstances.length;++d){u.push(d);let f=this.symbolInstances.get(d);s.push(0|Math.round(n*f.tileAnchorX+o*f.tileAnchorY)),l.push(f.featureIndex)}return u.sort((d,f)=>s[d]-s[f]||l[f]-l[d]),u}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:u,verticalPlacedTextSymbolIndex:d,placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:p}=o;s>=0&&this.addIndicesForPlacedSymbol(this.text,s),l>=0&&l!==s&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&u!==s&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&this.addIndicesForPlacedSymbol(this.icon,f),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}pt(yv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),yv.MAX_GLYPHS=65535,yv.addDynamicAttributes=np;var ag=yv;let h8=ri([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:f8}=h8,p8=ri([{name:"a_packed",components:4,type:"Float32"}]),{members:m8}=p8,g8=Jy.types,_8=Math.cos(Math.PI/180*37.5);class vv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new $w,this.layoutVertexArray2=new Fc,this.indexArray=new Kr,this.programConfigurations=new Bu(e.layers,e.zoom),this.segments=new Ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,s){this.hasPattern=WT("line",this.layers,n);let l=this.layers[0].layout.get("line-sort-key"),u=[];for(let{feature:g,id:_,index:v,sourceLayerIndex:x}of e){let b=this.layers[0]._featureFilter.needGeometry,T=Wu(g,b);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),T,o))continue;let E=l?l.evaluate(T,{},o):void 0,M={id:_,properties:g.properties,type:g.type,sourceLayerIndex:x,index:v,geometry:b?T.geometry:Jl(g,o,s),patterns:{},sortKey:E};u.push(M)}l&&u.sort((g,_)=>g.sortKey-_.sortKey);let{lineAtlas:d,featureIndex:f}=n,p=this.addConstantDashes(d);for(let g of u){let{geometry:_,index:v,sourceLayerIndex:x}=g;if(p&&this.addFeatureDashes(g,d),this.hasPattern){let b=qT("line",this.layers,g,this.zoom,n);this.patternFeatures.push(b)}else this.addFeature(g,_,v,o,d.positions,n.availableImages,n.brightness);f.insert(e[v].feature,_,v,x,this.index)}}addConstantDashes(e){let n=!1;for(let o of this.layers){let s=o.paint.get("line-dasharray").value,l=o.layout.get("line-cap").value;if(s.kind!=="constant"||l.kind!=="constant")n=!0;else{let u=l.value,d=s.value;if(!d)continue;e.addDash(d,u)}}return n}addFeatureDashes(e,n){let o=this.zoom;for(let s of this.layers){let l=s.paint.get("line-dasharray").value,u=s.layout.get("line-cap").value;if(l.kind==="constant"&&u.kind==="constant")continue;let d,f;if(l.kind==="constant"){if(d=l.value,!d)continue}else d=l.evaluate({zoom:o},e);f=u.kind==="constant"?u.value:u.evaluate({zoom:o},e),n.addDash(d,f),e.patterns[s.id]=n.getKey(d,f)}}update(e,n,o,s,l){let u=Object.keys(e).length!==0;u&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,u?this.stateDependentLayers:this.layers,o,s,l)}addFeatures(e,n,o,s,l,u){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,o,s,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,m8)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,f8),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,s,l,u,d){let f=this.layers[0].layout,p=f.get("line-join").evaluate(e,{}),g=f.get("line-cap").evaluate(e,{}),_=f.get("line-miter-limit"),v=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let x of n)this.addLine(x,e,p,g,_,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,u,s,d)}addLine(e,n,o,s,l,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let M=0;M<e.length-1;M++)this.totalDistance+=e[M].dist(e[M+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let d=g8[n.type]==="Polygon",f=e.length;for(;f>=2&&e[f-1].equals(e[f-2]);)f--;let p=0;for(;p<f-1&&e[p].equals(e[p+1]);)p++;if(f<(d?3:2))return;o==="bevel"&&(l=1.05);let g=this.overscaling<=16?15*ne/(512*this.overscaling):0,_=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray),v,x,b,T,E;this.e1=this.e2=-1,d&&(v=e[f-2],E=e[p].sub(v)._unit()._perp());for(let M=p;M<f;M++){if(b=M===f-1?d?e[p+1]:void 0:e[M+1],b&&e[M].equals(b))continue;E&&(T=E),v&&(x=v),v=e[M],E=b?b.sub(v)._unit()._perp():T,T=T||E;let S=T.add(E);S.x===0&&S.y===0||S._unit();let P=T.x*E.x+T.y*E.y,O=S.x*E.x+S.y*E.y,A=O!==0?1/O:1/0,R=2*Math.sqrt(2-2*O),F=O<_8&&x&&b,k=T.x*E.y-T.y*E.x>0;if(F&&M>p){let H=v.dist(x);if(H>2*g){let G=v.sub(v.sub(x)._mult(g/H)._round());this.updateDistance(x,G),this.addCurrentVertex(G,T,0,0,_),x=G}}let N=x&&b,B=N?o:d?"butt":s;if(N&&B==="round"&&(A<u?B="miter":A<=2&&(B="fakeround")),B==="miter"&&A>l&&(B="bevel"),B==="bevel"&&(A>2&&(B="flipbevel"),A<l&&(B="miter")),x&&this.updateDistance(x,v),B==="miter")S._mult(A),this.addCurrentVertex(v,S,0,0,_);else if(B==="flipbevel"){if(A>100)S=E.mult(-1);else{let H=A*T.add(E).mag()/T.sub(E).mag();S._perp()._mult(H*(k?-1:1))}this.addCurrentVertex(v,S,0,0,_),this.addCurrentVertex(v,S.mult(-1),0,0,_)}else if(B==="bevel"||B==="fakeround"){let H=-Math.sqrt(A*A-1),G=k?H:0,Y=k?0:H;if(x&&this.addCurrentVertex(v,T,G,Y,_),B==="fakeround"){let U=Math.round(180*R/Math.PI/20);for(let Q=1;Q<U;Q++){let te=Q/U;if(te!==.5){let K=te-.5;te+=te*K*(te-1)*((1.0904+P*(P*(3.55645-1.43519*P)-3.2452))*K*K+(.848013+P*(.215638*P-1.06021)))}let se=E.sub(T)._mult(te)._add(T)._unit()._mult(k?-1:1);this.addHalfVertex(v,se.x,se.y,!1,k,0,_)}}b&&this.addCurrentVertex(v,E,-G,-Y,_)}else if(B==="butt")this.addCurrentVertex(v,S,0,0,_);else if(B==="square"){let H=x?1:-1;x||this.addCurrentVertex(v,S,H,H,_),this.addCurrentVertex(v,S,0,0,_),x&&this.addCurrentVertex(v,S,H,H,_)}else B==="round"&&(x&&(this.addCurrentVertex(v,T,0,0,_),this.addCurrentVertex(v,T,1,1,_,!0)),b&&(this.addCurrentVertex(v,E,-1,-1,_,!0),this.addCurrentVertex(v,E,0,0,_)));if(F&&M<f-1){let H=v.dist(b);if(H>2*g){let G=v.add(b.sub(v)._mult(g/H)._round());this.updateDistance(v,G),this.addCurrentVertex(G,E,0,0,_),v=G}}}}addCurrentVertex(e,n,o,s,l,u=!1){let d=n.y*s-n.x,f=-n.y-n.x*s;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,u,!1,o,l),this.addHalfVertex(e,d,f,u,!0,-s,l)}addHalfVertex({x:e,y:n},o,s,l,u,d,f){this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(n<<1)+(u?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(d===0?0:d<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let p=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,p),f.primitiveLength++),u?this.e2=p:this.e1=p}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}pt(vv,"LineBucket",{omit:["layers","patternFeatures"]});class fr{constructor(e,n,o,s){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,s)}update(e,n,o){let{width:s,height:l}=e,{context:u}=this,{gl:d}=u,{HTMLImageElement:f,HTMLCanvasElement:p,HTMLVideoElement:g,ImageData:_,ImageBitmap:v}=y;if(d.bindTexture(d.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA&&(!n||n.premultiply!==!1)),o||this.size&&this.size[0]===s&&this.size[1]===l){let{x,y:b}=o||{x:0,y:0};if(e instanceof f||e instanceof p||e instanceof g||e instanceof _||v&&e instanceof v)d.texSubImage2D(d.TEXTURE_2D,0,x,b,d.RGBA,d.UNSIGNED_BYTE,e);else{let T=this.format,E=d.UNSIGNED_BYTE;this.format===d.R32F&&(T=d.RED,E=d.FLOAT),d.texSubImage2D(d.TEXTURE_2D,0,x,b,s,l,T,E,e.data)}}else if(this.size=[s,l],e instanceof f||e instanceof p||e instanceof g||e instanceof _||v&&e instanceof v){let x=this.format;this.format===d.R8&&(x=d.RED),d.texImage2D(d.TEXTURE_2D,0,this.format,x,d.UNSIGNED_BYTE,e)}else{let x=this.format,b=this.format,T=d.UNSIGNED_BYTE;this.format===d.DEPTH_COMPONENT&&(x=d.DEPTH_COMPONENT16,T=d.UNSIGNED_SHORT),this.format===d.R32F&&(T=d.FLOAT,b=d.RED),d.texImage2D(d.TEXTURE_2D,0,x,s,l,0,b,T,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,n){let{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?e===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),n!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,o,s){let{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),n!==this.magFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),o!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,o),this.wrapS=o),s!==this.wrapT&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,s),this.wrapT=s)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class xv{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,n),this.wrapS=n)}}let Ha=32,ec=33,Ju=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,o=0,s=0,l=0,u=0,d=0;for(1&e?s=l=u=Ha:n=o=d=Ha;(e>>=1)>1;){let p=n+s>>1,g=o+l>>1;1&e?(s=n,l=o,n=u,o=d):(n=s,o=l,s=u,l=d),u=p,d=g}let f=4*t;Ju[f+0]=n,Ju[f+1]=o,Ju[f+2]=s,Ju[f+3]=l}let tc=new Uint16Array(2178),Qu=new Uint8Array(1089),bv=new Uint16Array(1089);function JR(t){return t===0?-.03125:t===32?.03125:0}var cE=ri([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let QR={type:2,extent:ne,loadGeometry:()=>[[new X(0,0),new X(ne+1,0),new X(ne+1,ne+1),new X(0,ne+1),new X(0,0)]]};class lg{constructor(e,n,o,s,l){this.tileID=e,this.uid=pi(),this.uses=0,this.tileSize=n,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=l,s&&s.style&&(this._lastUpdatedBrightness=s.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",s&&s.transform&&(this.projection=s.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Zt.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ah(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,l){let u={};if(!l)return u;for(let d of s){let f=d.layerIds.map(p=>l.getLayer(p)).filter(Boolean);if(f.length!==0){d.layers=f,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(p=>f.filter(g=>g.id===p)[0]));for(let p of f)u[p.fqid]=d}}return u}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let s in this.buckets){let l=this.buckets[s];if(l instanceof ag){if(this.hasSymbolBuckets=!0,!o)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let s in this.buckets){let l=this.buckets[s];if(l instanceof ag&&l.hasRTLText){this.hasRTLText=!0,Ba.isLoading()||Ba.isLoaded()||jw()!=="deferred"||FP();break}}this.queryPadding=0;for(let s in this.buckets){let l=this.buckets[s],u=n.style.getOwnLayer(s);if(!u)continue;let d=u.queryRadius(l);this.queryPadding=Math.max(this.queryPadding,d)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new nT}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let o in this.buckets){let s=this.buckets[o];s.uploadPending()&&s.upload(e)}let n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new fr(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fr(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new fr(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,n,o){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,o),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let s=n.style.getBrightness();(this._lastUpdatedBrightness||s)&&(this._lastUpdatedBrightness&&s&&Math.abs(this._lastUpdatedBrightness-s)<.001||(this._lastUpdatedBrightness=s,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,o,s,l,u,d,f){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:s,pixelPosMatrix:d,transform:u,params:l,tileTransform:this.tileTransform},e,n,o):{}}querySourceFeatures(e,n){let o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;let s=o.loadVTLayers(),l=n?n.sourceLayer:"",u=s._geojsonTileLayer||s[l];if(!u)return;let d=my(n&&n.filter),{z:f,x:p,y:g}=this.tileID.canonical,_={z:f,x:p,y:g};for(let v=0;v<u.length;v++){let x=u.feature(v);if(d.needGeometry){let E=Wu(x,!0);if(!d.filter(new ur(this.tileID.overscaledZ),E,this.tileID.canonical))continue}else if(!d.filter(new ur(this.tileID.overscaledZ),x))continue;let b=o.getId(x,l),T=new hR(x,f,p,g,b);T.tile=_,e.push(T)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let o=Et(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let o=Date.now(),s=!1;if(this.expirationTime>o)s=!1;else if(n)if(this.expirationTime<n)s=!0;else{let l=this.expirationTime-n;l?this.expirationTime=o+Math.max(l,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let o=this.latestFeatureIndex.loadVTLayers(),s=n.style.listImages(),l=n.style.getBrightness();for(let u in this.buckets){if(!n.style.hasLayer(u))continue;let d=this.buckets[u],f=d.layers[0].sourceLayer||"_geojsonTileLayer",p=o[f],g={};if(e&&(g=e[f],!p||!g||Object.keys(g).length===0))continue;if(d.update(g,p,s,this.imageAtlas&&this.imageAtlas.patternPositions||{},l),d instanceof vv||d instanceof Xy){let v=n.style.getOwnSourceCache(d.layers[0].source);n._terrain&&n._terrain.enabled&&v&&d.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(v.id,this.tileID)}let _=n&&n.style&&n.style.getOwnLayer(u);_&&(this.queryPadding=Math.max(this.queryPadding,_.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Zt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Zt.now()+e}setTexture(e,n){let o=n.context,s=o.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof fr?this.texture.update(e,{useMipmap:!0}):(this.texture=new fr(o,e,s.RGBA,{useMipmap:!0}),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE))}setDependencies(e,n){let o={};for(let s of n)o[s]=!0;this.dependencies[e]=o}hasDependency(e,n){for(let o of e){let s=this.dependencies[o];if(s){for(let l of n)if(s[l])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let o=Jl(QR,this.tileID.canonical,this.tileTransform)[0],s=new $s,l=new jm;for(let u=0;u<o.length;u++){let{x:d,y:f}=o[u];s.emplaceBack(d,f),l.emplaceBack(u)}l.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(s,Vu.members),this._tileDebugSegments=Ti.simpleSegment(0,0,s.length,l.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let o=Jl(QR,this.tileID.canonical,this.tileTransform)[0],s,l;if(this.isRaster){let u=function(d,f){let p=ah(d,f),g=Math.pow(2,d.z);for(let E=0;E<ec;E++)for(let M=0;M<ec;M++){let S=Ws((d.x+(M+JR(M))/Ha)/g),P=Jr((d.y+(E+JR(E))/Ha)/g),O=f.project(S,P),A=E*ec+M;tc[2*A+0]=Math.round((O.x*p.scale-p.x)*ne),tc[2*A+1]=Math.round((O.y*p.scale-p.y)*ne)}Qu.fill(0),bv.fill(0);for(let E=2045;E>=0;E--){let M=4*E,S=Ju[M+0],P=Ju[M+1],O=Ju[M+2],A=Ju[M+3],R=S+O>>1,F=P+A>>1,k=R+F-P,N=F+S-R,B=P*ec+S,H=A*ec+O,G=F*ec+R,Y=Math.hypot((tc[2*B+0]+tc[2*H+0])/2-tc[2*G+0],(tc[2*B+1]+tc[2*H+1])/2-tc[2*G+1])>=16;Qu[G]=Qu[G]||(Y?1:0),E<1022&&(Qu[G]=Qu[G]||Qu[(P+N>>1)*ec+(S+k>>1)]||Qu[(A+N>>1)*ec+(O+k>>1)])}let _=new eh,v=new Kr,x=0;function b(E,M){let S=M*ec+E;return bv[S]===0&&(_.emplaceBack(tc[2*S+0],tc[2*S+1],E*ne/Ha,M*ne/Ha),bv[S]=++x),bv[S]-1}function T(E,M,S,P,O,A){let R=E+S>>1,F=M+P>>1;if(Math.abs(E-O)+Math.abs(M-A)>1&&Qu[F*ec+R])T(O,A,E,M,R,F),T(S,P,O,A,R,F);else{let k=b(E,M),N=b(S,P),B=b(O,A);v.emplaceBack(k,N,B)}}return T(0,0,Ha,Ha,Ha,0),T(Ha,Ha,0,0,0,Ha),{vertices:_,indices:v}}(this.tileID.canonical,n);s=u.vertices,l=u.indices}else{s=new eh,l=new Kr;for(let{x:d,y:f}of o)s.emplaceBack(d,f,0,0);let u=Yy(s.int16,void 0,4);for(let d=0;d<u.length;d+=3)l.emplaceBack(u[d],u[d+1],u[d+2])}this._tileBoundsBuffer=e.createVertexBuffer(s,cE.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(l),this._tileBoundsSegments=Ti.simpleSegment(0,0,s.length,l.length)}_makeGlobeTileDebugBuffers(e,n){let o=n.projection;if(!o||o.name!=="globe"||n.freezeTileCoverage)return;let s=this.tileID.canonical,l=$u(T2(s,n)),u=Do(n.zoom),d;u>0&&(d=ae.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,s,n,l,d,u),this._makeGlobeTileDebugTextBuffer(e,s,n,l,d,u)}_globePoint(e,n,o,s,l,u,d){let f=qm(e,n,o);if(u){let p=1<<o.z,g=ao(s.center.lng),_=po(s.center.lat),v=(o.x+.5)/p-g,x=0;v>.5?x=-1:v<-.5&&(x=1);let b=(e/ne+o.x)/p+x,T=(n/ne+o.y)/p;b=(b-g)*s._pixelsPerMercatorPixel+g,T=(T-_)*s._pixelsPerMercatorPixel+_;let E=[b*s.worldSize,T*s.worldSize,0];Z.transformMat4(E,E,u),f=$c(f,E,d)}return Z.transformMat4(f,f,l)}_makeGlobeTileDebugBorderBuffer(e,n,o,s,l,u){let d=new $s,f=new jm,p=new Ey,g=(v,x,b,T,E)=>{let M=(b-v)/(E-1),S=(T-x)/(E-1),P=d.length;for(let O=0;O<E;O++){let A=v+O*M,R=x+O*S;d.emplaceBack(A,R);let F=this._globePoint(A,R,n,o,s,l,u);p.emplaceBack(F[0],F[1],F[2]),f.emplaceBack(P+O)}},_=ne;g(0,0,_,0,16),g(_,0,_,_,16),g(_,_,0,_,16),g(0,_,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(d,Vu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(p,g2.members),this._tileDebugSegments=Ti.simpleSegment(0,0,d.length,f.length)}_makeGlobeTileDebugTextBuffer(e,n,o,s,l,u){let d=ne/4,f=new $s,p=new Kr,g=new Ey,_=25;p.reserve(32),f.reserve(_),g.reserve(_);let v=(x,b)=>_*x+b;for(let x=0;x<_;x++){let b=x*d;for(let T=0;T<_;T++){let E=T*d;f.emplaceBack(E,b);let M=this._globePoint(E,b,n,o,s,l,u);g.emplaceBack(M[0],M[1],M[2])}}for(let x=0;x<4;x++)for(let b=0;b<4;b++){let T=v(x,b),E=v(x,b+1),M=v(x+1,b),S=v(x+1,b+1);p.emplaceBack(T,E,M),p.emplaceBack(M,E,S)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(p),this._tileDebugTextBuffer=e.createVertexBuffer(f,Vu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(g,g2.members),this._tileDebugTextSegments=Ti.simpleSegment(0,0,_,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof fr&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class y8{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){let s=e.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);let l={value:n,timeout:void 0};if(o!==void 0&&(l.timeout=setTimeout(()=>{this.remove(e,l)},o)),this.data[s].push(l),this.order.push(s),this.order.length>this.max){let u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let o=e.wrapped().key,s=n===void 0?0:this.data[o].indexOf(n),l=this.data[o][s];return this.data[o].splice(s,1),l.timeout&&clearTimeout(l.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(l.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let o in this.data)for(let s of this.data[o])e(s.value)||n.push(s);for(let o of n)this.remove(o.value.tileID,o)}}let eL=(()=>{class t{constructor(n,o,s,l){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let u=n.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||l||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})(),v8={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class x8{constructor(e,n,o,s,l,u){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=s,this.instanceCount=u,this.context=e;let d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||l||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){let n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let o=0;o<this.attributes.length;o++){let s=n.attributes[this.attributes[o].name];s!==void 0&&e.enableVertexAttribArray(s)}}setVertexAttribPointers(e,n,o){for(let s=0;s<this.attributes.length;s++){let l=this.attributes[s],u=n.attributes[l.name];u!==void 0&&e.vertexAttribPointer(u,l.components,e[v8[l.type]],!1,this.itemSize,l.offset+this.itemSize*(o||0))}}setVertexAttribDivisor(e,n,o){for(let s=0;s<this.attributes.length;s++){let l=n.attributes[this.attributes[s].name];l!==void 0&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(l,o)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Yi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class b8 extends Yi{getDefault(){return tn.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class w8 extends Yi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class T8 extends Yi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class E8 extends Yi{getDefault(){return[!0,!0,!0,!0]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class M8 extends Yi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class I8 extends Yi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class C8 extends Yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class S8 extends Yi{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class D8 extends Yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class A8 extends Yi{getDefault(){return[0,1]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class P8 extends Yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class O8 extends Yi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class R8 extends Yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class L8 extends Yi{getDefault(){let e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class F8 extends Yi{getDefault(){return tn.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class k8 extends Yi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class N8 extends Yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class z8 extends Yi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class B8 extends Yi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let j8=class extends Yi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class V8 extends Yi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class U8 extends Yi{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class $8 extends Yi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class H8 extends Yi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class G8 extends Yi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class W8 extends Yi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class q8 extends Yi{getDefault(){return null}set(e){let n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Z8 extends Yi{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class Y8 extends Yi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class X8 extends Yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class K8 extends Yi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class uE extends Yi{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class J8 extends uE{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class tL extends uE{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Q8 extends uE{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class eW extends tL{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class tW{constructor(e,n,o,s,l){this.context=e,this.width=n,this.height=o;let u=this.framebuffer=e.gl.createFramebuffer();s&&(this.colorAttachment=new J8(e,u)),l&&(this.depthAttachmentType=l,this.depthAttachment=l==="renderbuffer"?new tL(e,u):new Q8(e,u))}destroy(){let e=this.context.gl;if(this.colorAttachment){let n=this.colorAttachment.get();n&&e.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}else{let n=this.depthAttachment.get();n&&e.deleteTexture(n)}e.deleteFramebuffer(this.framebuffer)}}class $t{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}$t.ReadOnly=!1,$t.ReadWrite=!0,$t.disabled=new $t(519,$t.ReadOnly,[0,1]);let dE=7680;class _n{constructor(e,n,o,s,l,u){this.test=e,this.ref=n,this.mask=o,this.fail=s,this.depthFail=l,this.pass=u}}_n.disabled=new _n({func:519,mask:0},0,0,dE,dE,dE);let wv=771;class Hn{constructor(e,n,o,s){this.blendFunction=e,this.blendColor=n,this.mask=o,this.blendEquation=s}}Hn.Replace=[1,0,1,0],Hn.disabled=new Hn(Hn.Replace,tn.transparent,[!1,!1,!1,!1]),Hn.unblended=new Hn(Hn.Replace,tn.transparent,[!0,!0,!0,!0]),Hn.alphaBlended=new Hn([1,wv,1,wv],tn.transparent,[!0,!0,!0,!0]),Hn.multiply=new Hn([774,0,774,0],tn.transparent,[!0,!0,!0,!0]);let hE=1029,fE=2305;class bn{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}bn.disabled=new bn(!1,hE,fE),bn.backCCW=new bn(!0,hE,fE),bn.backCW=new bn(!0,hE,2304),bn.frontCW=new bn(!0,1028,2304),bn.frontCCW=new bn(!0,1028,fE);class nW{constructor(e,n){this.gl=e,this.clearColor=new b8(this),this.clearDepth=new w8(this),this.clearStencil=new T8(this),this.colorMask=new E8(this),this.depthMask=new M8(this),this.stencilMask=new I8(this),this.stencilFunc=new C8(this),this.stencilOp=new S8(this),this.stencilTest=new D8(this),this.depthRange=new A8(this),this.depthTest=new P8(this),this.depthFunc=new O8(this),this.blend=new R8(this),this.blendFunc=new L8(this),this.blendColor=new F8(this),this.blendEquation=new k8(this),this.cullFace=new N8(this),this.cullFaceSide=new z8(this),this.frontFace=new B8(this),this.program=new j8(this),this.activeTexture=new V8(this),this.viewport=new U8(this),this.bindFramebuffer=new $8(this),this.bindRenderbuffer=new H8(this),this.bindTexture=new G8(this),this.bindVertexBuffer=new W8(this),this.bindElementBuffer=new q8(this),this.bindVertexArrayOES=new Z8(this),this.pixelStoreUnpack=new Y8(this),this.pixelStoreUnpackPremultiplyAlpha=new X8(this),this.pixelStoreUnpackFlipY=new K8(this),this.options=n?Lt({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n,o){return new eL(this,e,n,o)}createVertexBuffer(e,n,o,s,l){return new x8(this,e,n,o,s,l)}createRenderbuffer(e,n,o){let s=this.gl,l=s.createRenderbuffer();return this.bindRenderbuffer.set(l),s.renderbufferStorage(s.RENDERBUFFER,e,n,o),this.bindRenderbuffer.set(null),l}createFramebuffer(e,n,o,s){return new tW(this,e,n,o,s)}clear({color:e,depth:n,stencil:o,colorMask:s}){let l=this.gl,u=0;e&&(u|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(s||[!0,!0,!0,!0])),n!==void 0&&(u|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o!==void 0&&(u|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),l.clear(u)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){Rt(e.blendFunction,Hn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class _l extends vn{constructor(e,n,o){super(),this.id=e,this._onlySymbols=o,n.on("data",s=>{s.dataType==="source"&&s.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&s.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new y8(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new bG,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return wr(this._tiles).map(e=>e.tileID).sort(nL).map(e=>e.key)}getRenderableIds(e,n){let o=[];for(let s in this._tiles)this._isIdRenderable(+s,e,n)&&o.push(this._tiles[s]);return e?o.sort((s,l)=>{let u=s.tileID,d=l.tileID,f=new X(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),p=new X(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-d.overscaledZ||p.y-f.y||p.x-f.x}).map(s=>s.tileID.key):o.map(s=>s.tileID).sort(nL).map(s=>s.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(o||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,e,n)))}_tileLoaded(e,n,o,s){if(s)if(e.state="errored",s.status!==404)this._source.fire(new Je(s,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Se("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let l=this.map.painter.terrain;this.update(this.transform,l.getScaledDemTileSize(),!0),l.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Zt.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Se("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let s=0;s<n.length;s++){let l=n[s];if(e.neighboringTiles&&e.neighboringTiles[l]){let u=this.getTileByID(l);o(e,u),o(u,e)}}function o(s,l){if(!s.dem||s.dem.borderReady)return;s.needsHillshadePrepare=!0,s.needsDEMTextureUpload=!0;let u=l.tileID.canonical.x-s.tileID.canonical.x,d=l.tileID.canonical.y-s.tileID.canonical.y,f=Math.pow(2,s.tileID.canonical.z),p=l.tileID.key;u===0&&d===0||Math.abs(d)>1||(Math.abs(u)>1&&(Math.abs(u+f)===1?u+=f:Math.abs(u-f)===1&&(u-=f)),l.dem&&s.dem&&(s.dem.backfillBorder(l.dem,u,d),s.neighboringTiles&&s.neighboringTiles[p]&&(s.neighboringTiles[p].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,s){for(let l in this._tiles){let u=this._tiles[l];if(s[l]||!u.hasData()||u.tileID.overscaledZ<=n||u.tileID.overscaledZ>o)continue;let d=u.tileID;for(;u&&u.tileID.overscaledZ>n+1;){let p=u.tileID.scaledTo(u.tileID.overscaledZ-1);u=this._tiles[p.key],u&&u.hasData()&&(d=p)}let f=d;for(;f.overscaledZ>n;)if(f=f.scaledTo(f.overscaledZ-1),e[f.key]){s[d.key]=d;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){let s=e.scaledTo(o),l=this._getLoadedTile(s);if(l)return l}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let o=Math.ceil(e.width/n)+1,s=Math.ceil(e.height/n)+1,l=Math.floor(o*s*5),u=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,l):l,d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let o={};for(let s in this._tiles){let l=this._tiles[s];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+n),o[l.tileID.key]=l}this._tiles=o;for(let s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(let s in this._tiles)this._setTileReloadTimer(+s,this._tiles[s])}}update(e,n,o,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let l;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new qn(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(l=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(f=>this._source.hasTile(f)))):l=[],l.length>0&&this.castsShadows&&s&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!pE(this._source.type)){let f=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!o}),p=Math.min(f,this._source.maxzoom),g=e.extendTileCoverForShadows(l,s,p);for(let _ of g)this._shadowCasterTiles[_.key]=!0,l.push(_)}let u=this._updateRetainedTiles(l);if(pE(this._source.type)&&l.length!==0){let f={},p={},g=Object.keys(u);for(let v of g){let x=u[v],b=this._tiles[v];if(!b||b.fadeEndTime&&b.fadeEndTime<=Zt.now())continue;let T=this.findLoadedParent(x,Math.max(x.overscaledZ-_l.maxOverzooming,this._source.minzoom));T&&(this._addTile(T.tileID),f[T.tileID.key]=T.tileID),p[v]=x}let _=l[l.length-1].overscaledZ;for(let v in this._tiles){let x=this._tiles[v];if(u[v]||!x.hasData())continue;let b=x.tileID;for(;b.overscaledZ>_;){b=b.scaledTo(b.overscaledZ-1);let T=this._tiles[b.key];if(T&&T.hasData()&&p[b.key]){u[v]=x.tileID;break}}}for(let v in f)u[v]||(this._coveredTiles[v]=!0,u[v]=f[v])}for(let f in u)this._tiles[f].clearFadeHold();let d=function(f,p){let g=[];for(let _ in f)_ in p||g.push(_);return g}(this._tiles,u);for(let f of d){let p=this._tiles[f];p.hasSymbolBuckets&&!p.holdingForFade()?p.setHoldDuration(this.map._fadeDuration):p.hasSymbolBuckets&&!p.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let o={},s=e.reduce((p,g)=>Math.min(p,g.overscaledZ),1/0),l=e[0].overscaledZ,u=Math.max(l-_l.maxOverzooming,this._source.minzoom),d=Math.max(l+_l.maxUnderzooming,this._source.minzoom),f={};for(let p of e){let g=this._addTile(p);n[p.key]=p,g.hasData()||s<this._source.maxzoom&&(f[p.key]=p)}this._retainLoadedChildren(f,s,d,n);for(let p of e){let g=this._tiles[p.key];if(g.hasData())continue;if(p.canonical.z>=this._source.maxzoom){let v=p.children(this._source.maxzoom)[0],x=this.getTile(v);if(x&&x.hasData()){n[v.key]=v;continue}}else{let v=p.children(this._source.maxzoom);if(n[v[0].key]&&n[v[1].key]&&n[v[2].key]&&n[v[3].key])continue}let _=g.wasRequested();for(let v=p.overscaledZ-1;v>=u;--v){let x=p.scaledTo(v);if(o[x.key]||(o[x.key]=!0,g=this.getTile(x),!g&&_&&(g=this._addTile(x)),g&&(n[x.key]=x,_=g.wasRequested(),g.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],o,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){o=this._loadedParentTiles[s.key];break}n.push(s.key);let l=s.scaledTo(s.overscaledZ-1);if(o=this._getLoadedTile(l),o)break;s=l}for(let l of n)this._loadedParentTiles[l]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let o=!!n;if(!o){let s=this.map?this.map.painter:null;n=new lg(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,s,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,o||this._source.fire(new Se("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,o){let s=[],l=this.transform;if(!l)return s;let u=l.projection.name==="globe",d=ao(l.center.lng);for(let f in this._tiles){let p=this._tiles[f];if(o&&p.clearQueryDebugViz(),p.holdingForFade())continue;let g;if(u){let _=p.tileID.canonical;if(_.z===0){let v=[Math.abs(ze(d,...cg(_,-1))-d),Math.abs(ze(d,...cg(_,1))-d)];g=[0,2*v.indexOf(Math.min(...v))-1]}else{let v=[Math.abs(ze(d,...cg(_,-1))-d),Math.abs(ze(d,...cg(_,0))-d),Math.abs(ze(d,...cg(_,1))-d)];g=[v.indexOf(Math.min(...v))-1]}}else g=[0];for(let _ of g){let v=e.containsTile(p,l,n,_);v&&s.push(v)}}return s}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let o=this.getRenderableIds(e,n).map(l=>this._tiles[l].tileID),s=this.transform.projection.name==="globe";for(let l of o)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped()),l.expandedProjMatrix=s?this.transform.calculateProjMatrix(l.toUnwrapped(),!1,!0):l.projMatrix;return o}sortCoordinatesByDistance(e){let n=e.slice(),o=this.transform._camera.position,s=this.transform._camera.forward(),l={};for(let u of n){let d=1/(1<<u.canonical.z);l[u.key]=((u.canonical.x+.5)*d+u.wrap-o[0])*s[0]+((u.canonical.y+.5)*d-o[1])*s[1]-o[2]*s[2]}return n.sort((u,d)=>l[u.key]-l[d.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(pE(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Zt.now())return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){let s=this._tiles[e];s&&s.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(let o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let d=()=>{this._sourceLoaded&&(this._source.off("data",d),this._preloadTiles(e,n))};return void this._source.on("data",d)}let o=new Map,s=Array.isArray(e)?e:[e],l=this.map.painter.terrain,u=this.usedForTerrain&&l?l.getScaledDemTileSize():this._source.tileSize;for(let d of s){let f=d.coveringTiles({tileSize:u,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let p of f)o.set(p.key,p);this.usedForTerrain&&d.updateElevation(!1)}Ji(Array.from(o.values()),(d,f)=>{let p=new lg(d,this._source.tileSize*d.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(p,g=>{this._source.type==="raster-dem"&&p.dem&&this._backfillDEM(p),f(g,p)})},n)}}function nL(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function pE(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function cg(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}_l.maxOverzooming=10,_l.maxUnderzooming=3;let iW=ri([{name:"a_pos_3f",components:3,type:"Float32"}]),rW=ri([{name:"a_color_3f",components:3,type:"Float32"}]),oW=ri([{name:"a_color_4f",components:4,type:"Float32"}]),sW=ri([{name:"a_uv_2f",components:2,type:"Float32"}]),aW=ri([{name:"a_normal_3f",components:3,type:"Float32"}]),lW=ri([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),cW=ri([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class mE{constructor(e=0,n=0,o=0,s=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=o,this.right=s}interpolate(e,n,o){return n.top!=null&&e.top!=null&&(this.top=Yt(e.top,n.top,o)),n.bottom!=null&&e.bottom!=null&&(this.bottom=Yt(e.bottom,n.bottom,o)),n.left!=null&&e.left!=null&&(this.left=Yt(e.left,n.left,o)),n.right!=null&&e.right!=null&&(this.right=Yt(e.right,n.right,o)),this}getCenter(e,n){let o=ze((this.left+e-this.right)/2,0,e),s=ze((this.top+n-this.bottom)/2,0,n);return new X(o,s)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new mE(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function iL(t,e){let n=Ni(t,3);ae.fromQuat(t,e),Qi(t,3,n)}function gE(t,e){let n=Wo.identity([]);return Wo.rotateZ(n,n,-e),Wo.rotateX(n,n,-t),n}function rL(t,e){let n=[t[0],t[1],0],o=[e[0],e[1],0];if(Z.length(n)>=1e-15){let u=Z.normalize([],n);Z.scale(o,u,Z.dot(o,u)),e[0]=o[0],e[1]=o[1]}let s=Z.cross([],e,t);if(Z.len(s)<1e-15)return null;let l=Math.atan2(-s[1],s[0]);return gE(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),l)}class oL{constructor(e,n){this.position=e,this.orientation=n}get position(){return this._position}set position(e){if(e){let n=e instanceof Fn?e:new Fn(e[0],e[1],e[2]);this._renderWorldCopies&&(n.x=bi(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(e,n){if(this.orientation=null,!this.position)return;let o=this.position,s=this._elevation?this._elevation.getAtPointOrZero(Fn.fromLngLat(e)):0,l=Fn.fromLngLat(e,s),u=[l.x-o.x,l.y-o.y,l.z-o.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=rL(u,n)}setPitchBearing(e,n){this.orientation=gE(Vt(e),Vt(-n))}}class Tv{constructor(e,n){this._transform=ae.identity([]),this.orientation=n,this.position=e}get mercatorPosition(){let e=this.position;return new Fn(e[0],e[1],e[2])}get position(){let e=Ni(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var n;e&&Qi(this._transform,3,[(n=e)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||Wo.identity([]),e&&iL(this._transform,this._orientation)}getPitchBearing(){let e=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,n){this._orientation=gE(e,n),iL(this._transform,this._orientation)}forward(){let e=Ni(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){let e=Ni(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){let e=Ni(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,n){let o=new Float64Array(16);return ae.invert(o,this.getWorldToCamera(e,n)),o}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,n,o){let s=this.position;Z.scale(s,s,-e);let l=new Float64Array(16);return ae.fromScaling(l,[o,o,o]),ae.translate(l,l,s),l[10]*=n,l}getWorldToCamera(e,n){let o=new Float64Array(16),s=new Float64Array(4),l=this.position;return Wo.conjugate(s,this._orientation),Z.scale(l,l,-e),ae.fromQuat(o,s),ae.translate(o,o,l),o[1]*=-1,o[5]*=-1,o[9]*=-1,o[13]*=-1,o[8]*=n,o[9]*=n,o[10]*=n,o[11]*=n,o}getCameraToClipPerspective(e,n,o,s){let l=new Float64Array(16);return ae.perspective(l,e,n,o,s),l}getCameraToClipOrthographic(e,n,o,s,l,u){let d=new Float64Array(16);return ae.ortho(d,e,n,o,s,l,u),d}getDistanceToElevation(e,n=!1){let o=e===0?0:Oi(e,n?Jr(this.position[1]):this.position[1]),s=this.forward();return(o-this.position[2])/s[2]}clone(){return new Tv([...this.position],[...this.orientation])}}function sL(t,e){let n=ug(t.projection,t.zoom,t.width,t.height),o=function(l,u,d,f,p){let g=new Xt(d.lng-180*ed,d.lat),_=new Xt(d.lng+180*ed,d.lat),v=l.project(g.lng,g.lat),x=l.project(_.lng,_.lat),b=-Math.atan2(x.y-v.y,x.x-v.x),T=Fn.fromLngLat(d);T.y=ze(T.y,-1+ed,1-ed);let E=T.toLngLat(),M=l.project(E.lng,E.lat),S=Fn.fromLngLat(E);S.x+=ed;let P=S.toLngLat(),O=l.project(P.lng,P.lat),A=cL(O.x-M.x,O.y-M.y,b),R=Fn.fromLngLat(E);R.y+=ed;let F=R.toLngLat(),k=l.project(F.lng,F.lat),N=cL(k.x-M.x,k.y-M.y,b),B=Math.abs(A.x)/Math.abs(N.y),H=ae.identity([]);ae.rotateZ(H,H,-b*(1-(p?0:f)));let G=ae.identity([]);return ae.scale(G,G,[1,1-(1-B)*f,1]),G[4]=-N.x/N.y*f,ae.rotateZ(G,G,b),ae.multiply(G,H,G),G}(t.projection,0,t.center,n,e),s=aL(t);return ae.scale(o,o,[s,s,1]),o}function aL(t){let e=t.projection,n=ug(t.projection,t.zoom,t.width,t.height),o=lL(e,t.center),s=lL(e,Xt.convert(e.center));return Math.pow(2,o*n+(1-n)*s)}function ug(t,e,n,o,s=1/0){let l=t.range;if(!l)return 0;let u=Math.min(s,Math.max(n,o)),d=Math.log(u/1024)/Math.LN2;return Si(l[0]+d,l[1]+d,e)}let ed=1/4e4;function lL(t,e){let n=ze(e.lat,-Pr,Pr),o=new Xt(e.lng-180*ed,n),s=new Xt(e.lng+180*ed,n),l=t.project(o.lng,n),u=t.project(s.lng,n),d=Fn.fromLngLat(o),f=Fn.fromLngLat(s),p=u.x-l.x,g=u.y-l.y,_=f.x-d.x,v=f.y-d.y,x=Math.sqrt((_*_+v*v)/(p*p+g*g));return Math.log(x)/Math.LN2}function cL(t,e,n){let o=Math.cos(n),s=Math.sin(n);return{x:t*o-e*s,y:t*s+e*o}}function lh(t,e,n){return e*(ne/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}let ip={unknown:0,flipRequired:1,flipNotRequired:2},uW=Math.tan(85*Math.PI/180);function Ev(t,e,n,o,s,l,u){let d=ae.create();if(n)if(l.name==="globe"){let f=function(p,g){let{x:_,y:v}=p.point,x=C2(_,v,p.worldSize/p._pixelsPerMercatorPixel,0,0);return ae.multiply(x,x,DT(ga(g)))}(s,e);ae.multiply(d,d,f)}else{let f=jf.invert([],u);d[0]=f[0],d[1]=f[1],d[4]=f[2],d[5]=f[3],o||ae.rotateZ(d,d,s.angle)}else ae.multiply(d,s.labelPlaneMatrix,t);return d}function uL(t,e,n,o,s,l,u){let d=Ev(t,e,n,o,s,l,u);return l.name==="globe"&&n||(d[2]=d[6]=d[10]=d[14]=0),d}function dL(t,e,n,o,s,l,u){if(n){if(l.name==="globe"){let d=Ev(t,e,n,o,s,l,u);return ae.invert(d,d),ae.multiply(d,t,d),d}{let d=ae.clone(t),f=ae.identity([]);return f[0]=u[0],f[1]=u[1],f[4]=u[2],f[5]=u[3],ae.multiply(d,d,f),o||ae.rotateZ(d,d,-s.angle),d}}return s.glCoordMatrix}function yl(t,e,n,o){let s=[t,e,n,1];n?Ei.transformMat4(s,s,o):yL(s,s,o);let l=s[3];return s[0]/=l,s[1]/=l,s[2]/=l,s}function hL(t,e){return Math.min(.5+t/e*.5,1.5)}function dW(t,e){let n=t[0]/t[3],o=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&o>=-e[1]&&o<=e[1]}function hW(t,e,n,o,s,l,u,d,f,p){let g=n.transform,_=o?t.textSizeData:t.iconSizeData,v=Ql(_,n.transform.zoom),x=g.projection.name==="globe",b=[256/n.width*2+1,256/n.height*2+1],T=o?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;T.clear();let E=null;x&&(E=o?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);let M=t.lineVertexArray,S=o?t.text.placedSymbolArray:t.icon.placedSymbolArray,P=n.transform.width/n.transform.height,O,A=!1;for(let R=0;R<S.length;R++){let F=S.get(R),{numGlyphs:k,writingMode:N}=F;if(N!==rr.vertical||A||O===rr.horizontal||(A=!0),O=N,(F.hidden||N===rr.vertical)&&!A){rp(k,T);continue}A=!1;let B=new X(F.tileAnchorX,F.tileAnchorY),{x:H,y:G,z:Y}=g.projection.projectTilePoint(B.x,B.y,p.canonical);if(f){let[be,Te,Me]=f(B);H+=be,G+=Te,Y+=Me}let U=[H,G,Y,1];if(Ei.transformMat4(U,U,e),!dW(U,b)){rp(k,T);continue}let Q=U[3],te=hL(n.transform.getCameraToCenterDistance(g.projection),Q),se=Jm(_,v,F),K=u?se/te:se*te,ee=yl(H,G,Y,s);if(ee[3]<=0){rp(k,T);continue}let de={},pe=u?null:f,fe=mL(F,K,!1,d,e,s,l,t.glyphOffsetArray,M,T,E,ee,B,de,P,pe,g.projection,p,u);A=fe.useVertical,pe&&fe.needsFlipping&&(de={}),(fe.notEnoughRoom||A||fe.needsFlipping&&mL(F,K,!0,d,e,s,l,t.glyphOffsetArray,M,T,E,ee,B,de,P,pe,g.projection,p,u).notEnoughRoom)&&rp(k,T)}o?(t.text.dynamicLayoutVertexBuffer.updateData(T),E&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(E)):(t.icon.dynamicLayoutVertexBuffer.updateData(T),E&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(E))}function fL(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T){let{lineStartIndex:E,glyphStartIndex:M,segment:S}=d,P=M+d.numGlyphs,O=E+d.lineLength,A=e.getoffsetX(M),R=e.getoffsetX(P-1),F=Mv(t*A,n,o,s,l,u,S,E,O,f,p,g,_,v,!0,x,b,T);if(!F)return null;let k=Mv(t*R,n,o,s,l,u,S,E,O,f,p,g,_,v,!0,x,b,T);return k?{first:F,last:k}:null}function pL(t,e,n,o){return t===rr.horizontal&&Math.abs(o)>Math.abs(n)?{useVertical:!0}:t===rr.vertical?o>0?{needsFlipping:!0}:null:e!==ip.unknown&&function(s,l){return s===0||Math.abs(l/s)>uW}(n,o)?e===ip.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function mL(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S){let P=e/24,O=t.lineOffsetX*P,A=t.lineOffsetY*P,{lineStartIndex:R,glyphStartIndex:F,numGlyphs:k,segment:N,writingMode:B,flipState:H}=t,G=R+t.lineLength,Y=U=>{if(g){let[K,ee,de]=U.up,pe=p.length;_v(g,pe+0,K,ee,de),_v(g,pe+1,K,ee,de),_v(g,pe+2,K,ee,de),_v(g,pe+3,K,ee,de)}let[Q,te,se]=U.point;np(p,Q,te,se,U.angle)};if(k>1){let U=fL(P,d,O,A,n,_,v,t,f,l,x,T,!1,E,M,S);if(!U)return{notEnoughRoom:!0};if(o&&!n){let[Q,te,se]=U.first.point,[K,ee,de]=U.last.point;[Q,te]=yl(Q,te,se,u),[K,ee]=yl(K,ee,de,u);let pe=pL(B,H,(K-Q)*b,ee-te);if(t.flipState=pe&&pe.needsFlipping?ip.flipRequired:ip.flipNotRequired,pe)return pe}Y(U.first);for(let Q=F+1;Q<F+k-1;Q++){let te=Mv(P*d.getoffsetX(Q),O,A,n,_,v,N,R,G,f,l,x,T,!1,!1,E,M,S);if(!te)return p.length-=4*(Q-F),{notEnoughRoom:!0};Y(te)}Y(U.last)}else{if(o&&!n){let Q=yl(v.x,v.y,0,s),te=R+N+1,se=new X(f.getx(te),f.gety(te)),K=yl(se.x,se.y,0,s),ee=K[3]>0?K:_L(v,se,Q,1,s,void 0,E,M.canonical),de=pL(B,H,(ee[0]-Q[0])*b,ee[1]-Q[1]);if(t.flipState=de&&de.needsFlipping?ip.flipRequired:ip.flipNotRequired,de)return de}let U=Mv(P*d.getoffsetX(F),O,A,n,_,v,N,R,G,f,l,x,T,!1,!1,E,M,S);if(!U)return{notEnoughRoom:!0};Y(U)}return{}}function gL(t,e,n,o,s){let{x:l,y:u,z:d}=o.projectTilePoint(t.x,t.y,e);if(!s)return yl(l,u,d,n);let[f,p,g]=s(t);return yl(l+f,u+p,d+g,n)}function _L(t,e,n,o,s,l,u,d){let f=gL(t.sub(e)._unit()._add(t),d,s,u,l);return Z.sub(f,n,f),Z.normalize(f,f),Z.scaleAndAdd(f,n,f,o)}function Mv(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M){let S=o?t-e:t+e,P=S>0?1:-1,O=0;o&&(P*=-1,O=Math.PI),P<0&&(O+=Math.PI);let A=d+u+(P>0?0:1)|0,R=s,F=s,k=0,N=0,B=Math.abs(S),H=[],G=[],Y=l,U=Y,Q=()=>_L(U,Y,F,B-k+1,g,v,T,E.canonical);for(;k+N<=B;){if(A+=P,A<d||A>=f)return null;if(F=R,U=Y,H.push(F),x&&G.push(U),Y=new X(p.getx(A),p.gety(A)),R=_[A],!R){let Te=gL(Y,E.canonical,g,T,v);R=Te[3]>0?_[A]=Te:Q()}k+=N,N=Z.distance(F,R)}b&&v&&(_[A]&&(R=Q(),N=Z.distance(F,R)),_[A]=R);let te=(B-k)/N,se=Y.sub(U)._mult(te)._add(U),K=Z.sub([],R,F),ee=Z.scaleAndAdd([],F,K,te),de=[0,0,1],pe=K[0],fe=K[1];if(M&&(de=T.upVector(E.canonical,se.x,se.y),de[0]!==0||de[1]!==0||de[2]!==1)){let Te=[de[2],0,-de[0]],Me=Z.cross([],de,Te);Z.normalize(Te,Te),Z.normalize(Me,Me),pe=Z.dot(K,Te),fe=Z.dot(K,Me)}if(n){let Te=Z.cross([],de,K);Z.normalize(Te,Te),Z.scaleAndAdd(ee,ee,Te,n*P)}let be=O+Math.atan2(fe,pe);return H.push(ee),x&&G.push(se),{point:ee,angle:be,path:H,tilePath:G,up:de}}function rp(t,e){let n=e.length,o=n+4*t;e.resize(o),e.float32.fill(-1/0,4*n,4*o)}function yL(t,e,n){let o=e[0],s=e[1];return t[0]=n[0]*o+n[4]*s+n[12],t[1]=n[1]*o+n[5]*s+n[13],t[3]=n[3]*o+n[7]*s+n[15],t}let vL=(t,e,n)=>(1-n)*t+n*e,xL=t=>t*t*t*t*t;class _E{constructor(e,n,o,s,l,u,d){this.tileSize=512,this._renderWorldCopies=l===void 0||l,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=o??0,this._maxPitch=s??60,this.setProjection(u),this.setMaxBounds(d),this.width=0,this.height=0,this._center=new Xt(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new mE,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Tv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let e=new _E(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(e,n=!1){let o=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||o)&&this._updateCameraOnTerrain(),(e||o)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return wo(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};let n=this.projection?this.getProjection():void 0;this.projection=hv(this.projectionOptions);let o=!Rt(n,this.getProjection());return o&&this._calcMatrices(),this.mercatorFromTransition=!1,o}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){let e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=hv({name:"mercator"});let n=e!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){let e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Oi(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new X(this.width,this.height)}get bearing(){return bi(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){let n=-e*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=jf.create(),jf.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let n=ze(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=Vt(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){let n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){let e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let o=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&o.exaggeration()&&this._centerAltitudeValidForExaggeration!==o.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*o.exaggeration(),this._centerAltitudeValidForExaggeration=o.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=o.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let e=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],o=this.horizonLineFromTop(),s=0,l=0;for(let u=0;u<n.length;u++){let d=new X(n[u][0]*this.width,o+n[u][1]*(this.height-o)),f=e.pointCoordinate(d);if(!f)continue;let p=1/Math.hypot(f[0]-this._camera.position[0],f[1]-this._camera.position[1]);s+=f[3]*p,l+=p}return l===0?NaN:s/l}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let e=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),o=this.pixelsPerMeter/this.worldSize*n,s=this._mercatorZfromZoom(e),l=this._mercatorZfromZoom(this._maxZoom),u=Math.max(s-o,l);this._setZoom(this._zoomFromMercatorZ(u))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){let n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude())),o;o=e.z<this._camera.position[2]?[n.x,n.y,n.z]:[e.x,e.y,e.z];let s=Z.length(Z.sub([],this._camera.position,o));return ze(this._zoomFromMercatorZ(s),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let n=!1;if(e.orientation&&!Wo.exactEquals(e.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(e.orientation)),e.position){let o=[e.position.x,e.position.y,e.position.z];Z.exactEquals(o,this._camera.position)||(this._setCameraPosition(o),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let e=this._camera.position,n=new oL;return n.position=new Fn(e[0],e[1],e[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(e){if(!Wo.length(e))return!1;Wo.normalize(e,e);let n=Z.transformQuat([],[0,0,-1],e),o=Z.transformQuat([],[0,-1,0],e);if(o[2]<0)return!1;let s=rL(n,o);return!!s&&(this._camera.orientation=s,!0)}_setCameraPosition(e){let n=this.zoomScale(this.minZoom)*this.tileSize,o=this.zoomScale(this.maxZoom)*this.tileSize,s=this.cameraToCenterDistance;e[2]=ze(e[2],s/o,s/n),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,o){this._unmodified=!1,this._edgeInsets.interpolate(e,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){let n=[new TT(0,e)];if(this.renderWorldCopies){let o=this.pointCoordinate(new X(0,0)),s=this.pointCoordinate(new X(this.width,0)),l=this.pointCoordinate(new X(this.width,this.height)),u=this.pointCoordinate(new X(0,this.height)),d=Math.floor(Math.min(o.x,s.x,l.x,u.x)),f=Math.floor(Math.max(o.x,s.x,l.x,u.x)),p=1;for(let g=d-p;g<=f+p;g++)g!==0&&n.push(new TT(g,e))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,n,o){let s=[];if(n[0]===0&&n[1]===0)return s;for(let u of e){let d=u.canonical,f=u.overscaledZ,p=u.wrap,g=1<<d.z,_=d.x+1<g,v=d.x>0,x=d.y+1<g,b=d.y>0,T=u.wrap-(v?0:1),E=u.wrap+(_?0:1),M=v?d.x-1:g-1,S=_?d.x+1:0;n[0]<0?(s.push(new qn(f,E,d.z,S,d.y)),n[1]<0&&x&&(s.push(new qn(f,p,d.z,d.x,d.y+1)),s.push(new qn(f,E,d.z,S,d.y+1))),n[1]>0&&b&&(s.push(new qn(f,p,d.z,d.x,d.y-1)),s.push(new qn(f,E,d.z,S,d.y-1)))):n[0]>0?(s.push(new qn(f,T,d.z,M,d.y)),n[1]<0&&x&&(s.push(new qn(f,p,d.z,d.x,d.y+1)),s.push(new qn(f,T,d.z,M,d.y+1))),n[1]>0&&b&&(s.push(new qn(f,p,d.z,d.x,d.y-1)),s.push(new qn(f,T,d.z,M,d.y-1)))):n[1]<0&&x?s.push(new qn(f,p,d.z,d.x,d.y+1)):b&&s.push(new qn(f,p,d.z,d.x,d.y-1))}if(s.length>1){s.sort((f,p)=>f.overscaledZ-p.overscaledZ||f.wrap-p.wrap||f.canonical.z-p.canonical.z||f.canonical.x-p.canonical.x||f.canonical.y-p.canonical.y);let u=0,d=0;for(;d<s.length;)s[d].equals(s[u])?++d:s[++u]=s[d++];s.length=u+1}let l=[];for(let u of s)s.some(d=>u.isChildOf(d))||l.push(u);return s=l.filter(u=>!e.some(d=>!!(u.overscaledZ<o&&d.isChildOf(u))||u.equals(d)||u.isChildOf(d))),s}coveringTiles(e){let n=this.coveringZoomLevel(e),o=n,s=this.elevation&&this.elevation.exaggeration(),l=s&&!e.isTerrainDEM,u=this.projection.name==="mercator";if(e.minzoom!==void 0&&n<e.minzoom)return[];e.maxzoom!==void 0&&n>e.maxzoom&&(n=e.maxzoom);let d=this.locationCoordinate(this.center),f=this.center.lat,p=1<<n,g=[p*d.x,p*d.y,0],_=this.projection.name==="globe",v=!_,x=Uc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,v),b=_?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),T=p*Oi(1,this.center.lat),E=this._camera.position[2]/Oi(1,this.center.lat),M=[p*b.x,p*b.y,E*(v?1:T)],S=_||s,P=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),O=this.isLODDisabled(!0)?n:0,A;if(this._elevation&&e.isTerrainDEM)A=1e4*this._elevation.exaggeration();else if(this._elevation){let K=this._elevation.getMinMaxForVisibleTiles();A=K?K.max:this._centerAltitude}else A=this._centerAltitude;let R=e.isTerrainDEM?-A:this._elevation?this._elevation.getMinElevationBelowMSL():0,F=this.projection.isReprojectedInTileSpace?aL(this):1,k=K=>{let de=new Fn(K.x+25e-6,K.y,K.z),pe=new Fn(K.x,K.y+25e-6,K.z),fe=K.toLngLat(),be=de.toLngLat(),Te=pe.toLngLat(),Me=this.locationCoordinate(fe),ge=this.locationCoordinate(be),Pe=this.locationCoordinate(Te),et=Math.hypot(ge.x-Me.x,ge.y-Me.y),tt=Math.hypot(Pe.x-Me.x,Pe.y-Me.y);return Math.sqrt(et*tt)*F/25e-6},N=K=>{let ee=A,de=R;return{aabb:HR(this,p,0,0,0,K,de,ee,this.projection),zoom:0,x:0,y:0,minZ:de,maxZ:ee,wrap:K,fullyVisible:!1}},B=[],H=[],G=n,Y=e.reparseOverscaled?o:n,U=K=>K*K,Q=U((E-this._centerAltitude)*T),te=K=>{if(!this._elevation||!K.tileID||!u)return;let ee=this._elevation.getMinMaxForTile(K.tileID),de=K.aabb;ee?(de.min[2]=ee.min,de.max[2]=ee.max,de.center[2]=(de.min[2]+de.max[2])/2):(K.shouldSplit=se(K),K.shouldSplit||(de.min[2]=de.max[2]=de.center[2]=this._centerAltitude))},se=K=>{if(K.zoom<O)return!0;if(K.zoom===G)return!1;if(K.shouldSplit!=null)return K.shouldSplit;let ee=K.aabb.distanceX(M),de=K.aabb.distanceY(M),pe=Q,fe=1;if(_){pe=U(K.aabb.distanceZ(M));let Me=Math.pow(2,K.zoom),ge=Jr((K.y+1)/Me),Pe=Jr(K.y/Me),et=Math.min(Math.max(f,ge),Pe),tt=jy(et)/jy(f);if(fe=et===f?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,tt/this._mercatorScaleRatio),this.zoom<=Wm&&K.zoom===G-1&&tt>=.9)return!0}else if(l&&(pe=U(K.aabb.distanceZ(M)*T)),this.projection.isReprojectedInTileSpace&&o<=5){let Me=Math.pow(2,K.zoom),ge=k(new Fn((K.x+.5)/Me,(K.y+.5)/Me));fe=ge>.85?1:ge}let be=ee*ee+de*de+pe,Te=U((1<<G-K.zoom)*P*fe*((Me,ge)=>{if(ge*U(.707)<Me)return 1;let Pe=Math.sqrt(ge/Me);return Pe/(1.4144271570014144+(Math.pow(1.1,Pe-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pe,Q),be));return be<Te};if(this.renderWorldCopies)for(let K=1;K<=3;K++)B.push(N(-K)),B.push(N(K));for(B.push(N(0));B.length>0;){let K=B.pop(),ee=K.x,de=K.y,pe=K.fullyVisible,fe=()=>this.projection.name==="globe"&&(K.y===0||K.y===(1<<K.zoom)-1);if(!pe){let be=S?K.aabb.intersects(x):K.aabb.intersectsFlat(x);if(be===0&&fe()){let Te=new Va(K.zoom,ee,de);be=CT(this,p,Te,!0).intersects(x)}if(be===0)continue;pe=be===2}if(K.zoom!==G&&se(K))for(let be=0;be<4;be++){let Te=(ee<<1)+be%2,Me=(de<<1)+(be>>1),ge={aabb:u?K.aabb.quadrant(be):HR(this,p,K.zoom+1,Te,Me,K.wrap,K.minZ,K.maxZ,this.projection),zoom:K.zoom+1,x:Te,y:Me,wrap:K.wrap,fullyVisible:pe,tileID:void 0,shouldSplit:void 0,minZ:K.minZ,maxZ:K.maxZ};l&&!_&&(ge.tileID=new qn(K.zoom+1===G?Y:K.zoom+1,K.wrap,K.zoom+1,Te,Me),te(ge)),B.push(ge)}else{let be=K.zoom===G?Y:K.zoom;if(e.minzoom&&e.minzoom>be)continue;if(!pe){let Pe=S?K.aabb.intersectsPrecise(x):K.aabb.intersectsPreciseFlat(x);if(Pe===0&&fe()){let et=new Va(K.zoom,ee,de);Pe=CT(this,p,et,!0).intersectsPrecise(x)}if(Pe===0)continue}let Te=g[0]-(.5+ee+(K.wrap<<K.zoom))*(1<<n-K.zoom),Me=g[1]-.5-de,ge=K.tileID?K.tileID:new qn(be,K.wrap,K.zoom,ee,de);H.push({tileID:ge,distanceSq:Te*Te+Me*Me})}}if(this.fogCullDistSq){let K=this.fogCullDistSq,ee=this.horizonLineFromTop();H=H.filter(de=>{let pe=[0,0,0,1],fe=[ne,ne,0,1],be=this.calculateFogTileMatrix(de.tileID.toUnwrapped());Ei.transformMat4(pe,pe,be),Ei.transformMat4(fe,fe,be);let Te=function(Pe,et,tt){let lt=0;for(let ct=0;ct<2;++ct)Pe[ct]>0&&(lt+=(Pe[ct]-0)*(Pe[ct]-0)),et[ct]<0&&(lt+=(0-et[ct])*(0-et[ct]));return lt}(Ei.min([],pe,fe),Ei.max([],pe,fe));if(Te===0)return!0;let Me=!1,ge=this._elevation;if(ge&&Te>K&&ee!==0){let Pe=this.calculateProjMatrix(de.tileID.toUnwrapped()),et;e.isTerrainDEM||(et=ge.getMinMaxForTile(de.tileID)),et||(et={min:R,max:A});let tt=function(ct){let Ht=Math.round((ct+45+360)%360/90)%4;return Pa[Ht]}(this.rotation),lt=[tt[0]*ne,tt[1]*ne,et.max];Z.transformMat4(lt,lt,Pe),Me=(1-lt[1])*this.height*.5<ee}return Te<K||Me})}return H.sort((K,ee)=>K.distanceSq-ee.distanceSq).map(K=>K.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let n=ze(e.lat,-Pr,Pr),o=this.projection.project(e.lng,n);return new X(o.x*this.worldSize,o.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Oi(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,n){let o,s,l=this.centerPoint;if(this.projection.name==="globe"){let d=this.worldSize;o=(n.x-l.x)/d,s=(n.y-l.y)/d}else{let d=this.pointCoordinate(n),f=this.pointCoordinate(l);o=d.x-f.x,s=d.y-f.y}let u=this.locationCoordinate(e);this.setLocation(new Fn(u.x-o,u.y-s))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,n){let o=n?Oi(n,e.lat):void 0,s=this.projection.project(e.lng,e.lat);return new Fn(s.x,s.y,o)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,n){let o=n??this._centerAltitude,s=[e.x,e.y,0,1],l=[e.x,e.y,1,1];Ei.transformMat4(s,s,this.pixelMatrixInverse),Ei.transformMat4(l,l,this.pixelMatrixInverse);let u=l[3];Ei.scale(s,s,1/s[3]),Ei.scale(l,l,1/u);let d=s[2],f=l[2];return{p0:s,p1:l,t:d===f?0:(o-d)/(f-d)}}screenPointToMercatorRay(e){let n=[e.x,e.y,0,1],o=[e.x,e.y,1,1];return Ei.transformMat4(n,n,this.pixelMatrixInverse),Ei.transformMat4(o,o,this.pixelMatrixInverse),Ei.scale(n,n,1/n[3]),Ei.scale(o,o,1/o[3]),n[2]=Oi(n[2],this._center.lat)*this.worldSize,o[2]=Oi(o[2],this._center.lat)*this.worldSize,Ei.scale(n,n,1/this.worldSize),Ei.scale(o,o,1/this.worldSize),new Fy([n[0],n[1],n[2]],Z.normalize([],Z.sub([],o,n)))}rayIntersectionCoordinate(e){let{p0:n,p1:o,t:s}=e,l=Oi(n[2],this._center.lat),u=Oi(o[2],this._center.lat);return new Fn(Yt(n[0],o[0],s)/this.worldSize,Yt(n[1],o[1],s)/this.worldSize,Yt(l,u,s))}pointCoordinate(e,n=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,n)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let n=this.projection.pointCoordinate3D(this,e.x,e.y);if(n)return new Fn(n[0],n[1],n[2]);let o=0,s=this.horizonLineFromTop();if(e.y>s)return this.pointCoordinate(e);let l=.02*s,u=e.clone();for(let d=0;d<10&&s-o>l;d++){u.y=Yt(o,s,.66);let f=this.projection.pointCoordinate3D(this,u.x,u.y);f?(s=u.y,n=f):o=u.y}return n?new Fn(n[0],n[1],n[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=Uu)return!this.isPointAboveHorizon(e);let n=this.pointCoordinate(e);return n.y>=0&&n.y<=1}_coordinatePoint(e,n){let o=n&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,s=[e.x*this.worldSize,e.y*this.worldSize,o+e.toAltitude(),1];return Ei.transformMat4(s,s,this.pixelMatrix),s[3]>0?new X(s[0]/s[3],s[1]/s[3]):new X(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:e,left:n}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,l=this.pointLocation3D(new X(n,e)),u=this.pointLocation3D(new X(s,e)),d=this.pointLocation3D(new X(s,o)),f=this.pointLocation3D(new X(n,o)),p=Math.min(l.lng,u.lng,d.lng,f.lng),g=Math.max(l.lng,u.lng,d.lng,f.lng),_=Math.min(l.lat,u.lat,d.lat,f.lat),v=Math.max(l.lat,u.lat,d.lat,f.lat),x=Math.pow(2,-this.zoom)/16*270,b=this.projection.name==="globe"?1:4,T=(E,M,S,P,O)=>{let A=(E+S)/2,R=(M+P)/2,F=new X(A,R),{lng:k,lat:N}=this.pointLocation3D(F),B=Math.max(0,p-k,_-N,k-g,N-v);p=Math.min(p,k),g=Math.max(g,k),_=Math.min(_,N),v=Math.max(v,N),(O<b||B>x)&&(T(E,M,A,R,O+1),T(A,R,S,P,O+1))};if(T(n,e,s,e,1),T(s,e,s,o,1),T(s,o,n,o,1),T(n,o,n,e,1),this.projection.name==="globe"){let[E,M]=function(S){let P=ae.identity(new Float64Array(16));ae.multiply(P,S.pixelMatrix,S.globeMatrix);let O=[0,Ua,0],A=[0,$a,0];return Z.transformMat4(O,O,P),Z.transformMat4(A,A,P),[O[0]>0&&O[0]<=S.width&&O[1]>0&&O[1]<=S.height&&!By(S,new Xt(S.center.lat,90)),A[0]>0&&A[0]<=S.width&&A[1]>0&&A[1]<=S.height&&!By(S,new Xt(S.center.lat,-90))]}(this);E?(v=90,g=180,p=-180):M&&(_=-90,g=180,p=-180)}return new Gs(new Xt(p,_),new Xt(g,v))}_getBoundsRectangular(e,n){let{top:o,left:s}=this._edgeInsets,l=this.height-this._edgeInsets.bottom,u=this.width-this._edgeInsets.right,d=new X(s,o),f=new X(u,o),p=new X(u,l),g=new X(s,l),_=this.pointCoordinate(d,e),v=this.pointCoordinate(f,e),x=this.pointCoordinate(p,n),b=this.pointCoordinate(g,n),T=(E,M)=>(M.y-E.y)/(M.x-E.x);return _.y>1&&v.y>=0?_=new Fn((1-b.y)/T(b,_)+b.x,1):_.y<0&&v.y<=1&&(_=new Fn(-b.y/T(b,_)+b.x,0)),v.y>1&&_.y>=0?v=new Fn((1-x.y)/T(x,v)+x.x,1):v.y<0&&_.y<=1&&(v=new Fn(-x.y/T(x,v)+x.x,0)),new Gs().extend(this.coordinateLocation(_)).extend(this.coordinateLocation(v)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(x))}_getBoundsRectangularTerrain(){let e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);let n=e.visibleDemTiles.reduce((o,s)=>{if(s.dem){let l=s.dem.tree;o.min=Math.min(o.min,l.minimums[0]),o.max=Math.max(o.max,l.maximums[0])}return o},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*e.exaggeration(),n.max*e.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){let n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,o=this.height/2-n*(1-this._horizonShift);return e?Math.max(0,o):o}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-Pr,this.maxLat=Pr,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=ao(this.minLng)*this.tileSize,this.worldMaxX=ao(this.maxLng)*this.tileSize,this.worldMinY=po(this.maxLat)*this.tileSize,this.worldMaxY=po(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,n){return this.projection.createTileMatrix(this,n,e)}calculateDistanceTileData(e){let n=e.key,o=this._distanceTileDataCache;if(o[n])return o[n];let s=e.canonical,l=1/this.height,u=this.cameraWorldSize,d=u/this.zoomScale(s.z),f=(s.x+Math.pow(2,s.z)*e.wrap)*d,p=s.y*d,g=this.point;g.x*=u/this.worldSize,g.y*=u/this.worldSize;let _=this.angle,v=Math.sin(-_),x=-Math.cos(-_);return o[n]={bearing:[v,x],center:[(g.x-f)*l,(g.y-p)*l],scale:d/ne*l},o[n]}calculateFogTileMatrix(e){let n=e.key,o=this._fogTileMatrixCache;if(o[n])return o[n];let s=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return ae.multiply(s,this.worldToFogMatrix,s),o[n]=new Float32Array(s),o[n]}calculateProjMatrix(e,n=!1,o=!1){let s=e.key,l;if(l=o?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,l[s])return l[s];let u=this.calculatePosMatrix(e,this.worldSize),d;return d=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,ae.multiply(u,d,u),l[s]=new Float32Array(u),l[s]}calculatePixelsToTileUnitsMatrix(e){let n=e.tileID.key,o=this._pixelsToTileUnitsCache;if(o[n])return o[n];let s=function(l,u){let{scale:d}=l.tileTransform,f=d*ne/(l.tileSize*Math.pow(2,u.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return jf.scale(new Float32Array(4),u.inverseAdjustmentMatrix,[f,f])}(e,this);return o[n]=s,o[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let e=1/this.worldSize,n=ae.fromScaling([],[e,e,e]);return ae.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let e=this._elevation;this._updateCameraState();let n=Oi(1,this._center.lat)*this.worldSize,o=this._computeCameraPosition(n),s=this._camera.forward(),l=Oi(1,this._center.lat);o[2]/=l,s[2]/=l,Z.normalize(s,s);let u=e.raycast(o,s,e.exaggeration());if(u){let d=Z.scaleAndAdd([],o,s,u),f=new Fn(d[0],d[1],Oi(d[2],Jr(d[1]))),p=(f.z+Z.length([f.x-o[0],f.y-o[1],f.z-o[2]*l]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(p),this._centerAltitude=f.toAltitude(),this._center=this.coordinateLocation(f),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;let n=this._elevation,o=Oi(1,this._center.lat)*this.worldSize,s=this._computeCameraPosition(o),l=n.getAtPointOrZero(new Fn(...s)),u=this.pixelsPerMeter/this.worldSize*l,d=this._minimumHeightOverTerrain(),f=s[2]-u;if(f<=d)if(f<0||e){let p=this.locationCoordinate(this._center,this._centerAltitude),g=[s[0],s[1],p.z-s[2]],_=Z.length(g);g[2]-=(d-f)/this._pixelsPerMercatorPixel;let v=Z.length(g);if(v===0)return;Z.scale(g,g,_/v*this._pixelsPerMercatorPixel),this._camera.position=[s[0],s[1],p.z*this._pixelsPerMercatorPixel-g[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){let v=this.center;return v.lat=ze(v.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(v.lng=ze(v.lng,this.minLng,this.maxLng)),this.center=v,void(this._constraining=!1)}let n=this._unmodified,{x:o,y:s}=this.point,l=0,u=o,d=s,f=this.width/2,p=this.height/2,g=this.worldMinY*this.scale,_=this.worldMaxY*this.scale;if(s-p<g&&(d=g+p),s+p>_&&(d=_-p),_-g<this.height&&(l=Math.max(l,this.height/(_-g)),d=(_+g)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let v=this.worldMinX*this.scale,x=this.worldMaxX*this.scale,b=this.worldSize/2-(v+x)/2;u=(o+b+this.worldSize)%this.worldSize-b,u-f<v&&(u=v+f),u+f>x&&(u=x-f),x-v<this.width&&(l=Math.max(l,this.width/(x-v)),u=(x+v)/2)}u===o&&d===s||(this.center=this.unproject(new X(u,d))),l&&(this.zoom+=this.scaleZoom(l)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let e=this.centerOffset,n=this.projection.name==="globe",o=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=Oi(1,this.center.lat)/Oi(1,45));let s=ug(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,s),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let l=this.projection.zAxisUnit==="meters"?o:1,u=this._camera.getWorldToCamera(this.worldSize,l),d,f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(f[8]=2*-e.x/this.width,f[9]=2*e.y/this.height,this.isOrthographic){let N=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),B=N*this.aspect,H=-B,G=-N;B-=e.x,H-=e.x,N+=e.y,G+=e.y,d=this._camera.getCameraToClipOrthographic(H,B,G,N,this._nearZ,this._farZ),((Y,U,Q,te)=>{for(let se=0;se<16;se++)Y[se]=vL(U[se],Q[se],te)})(d,d,f,xL(this.pitch>=15?1:this.pitch/15))}else d=f;let p=ae.mul([],f,u),g=ae.mul([],d,u);if(this.projection.isReprojectedInTileSpace){let N=this.locationCoordinate(this.center),B=ae.identity([]);ae.translate(B,B,[N.x*this.worldSize,N.y*this.worldSize,0]),ae.multiply(B,B,sL(this)),ae.translate(B,B,[-N.x*this.worldSize,-N.y*this.worldSize,0]),ae.multiply(g,g,B),ae.multiply(p,p,B),this.inverseAdjustmentMatrix=function(H){let G=sL(H,!0);return jf.invert([],[G[0],G[1],G[4],G[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=ae.scale([],g,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=g,this.invProjMatrix=ae.invert(new Float64Array(16),this.projMatrix),n){let N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);N[8]=2*-e.x/this.width,N[9]=2*e.y/this.height,this.expandedFarZProjMatrix=ae.mul([],N,u)}else this.expandedFarZProjMatrix=this.projMatrix;let _=ae.invert([],d);this.frustumCorners=ET.fromInvProjectionMatrix(_,this.horizonLineFromTop(),this.height),this.cameraFrustum=Uc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);let v=new Float32Array(16);ae.identity(v),ae.scale(v,v,[1,-1,1]),ae.rotateX(v,v,this._pitch),ae.rotateZ(v,v,this.angle);let x=ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=ae.clone(x);let b=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;x[8]=2*-e.x/this.width,x[9]=2*(e.y+b)/this.height,this.skyboxMatrix=ae.multiply(v,x,v);let T=this.point,E=T.x,M=T.y,S=this.width%2/2,P=this.height%2/2,O=Math.cos(this.angle),A=Math.sin(this.angle),R=E-Math.round(E)+O*S+A*P,F=M-Math.round(M)+O*P+A*S,k=new Float64Array(g);if(ae.translate(k,k,[R>.5?R-1:R,F>.5?F-1:F,0]),this.alignedProjMatrix=k,g=ae.create(),ae.scale(g,g,[this.width/2,-this.height/2,1]),ae.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=ae.create(),ae.scale(g,g,[1,-1,1]),ae.translate(g,g,[-1,-1,0]),ae.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=ae.multiply(new Float64Array(16),this.labelPlaneMatrix,p),this._calcFogMatrices(),this._distanceTileDataCache={},g=ae.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=g,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(B){let{x:H,y:G}=B.point,{lng:Y,lat:U}=B._center;return C2(H,G,B.worldSize,Y,U)}(this);let N=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=Z.transformMat4(N,N,u),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=g;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let e=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,o=this._camera.position,s=1/this.height/this._pixelsPerMercatorPixel,l=[e,e,n];Z.scale(l,l,s),Z.scale(o,o,-1),Z.multiply(o,o,l);let u=ae.create();ae.translate(u,u,o),ae.scale(u,u,l),this.mercatorFogMatrix=u,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,n,s)}_computeCameraPosition(e){let n=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,o=this._camera.forward(),s=this.point,l=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-e/this.worldSize*this._centerAltitude;return[s.x/this.worldSize-o[0]*l,s.y/this.worldSize-o[1]*l,e/this.worldSize*this._centerAltitude-o[2]*l]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){let n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),o=this._camera.position[2],s=e[2],l=1;this.projection.wrap&&(this.center=this.center.wrap()),s>0&&(l=Math.min((n-o)/s,1)),this._camera.position=Z.scaleAndAdd([],this._camera.position,e,l),this._updateStateFromCamera()}_updateStateFromCamera(){let e=this._camera.position,n=this._camera.forward(),{pitch:o,bearing:s}=this._camera.getPitchBearing(),l=Oi(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,u=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Vt(this._maxPitch)),d=Math.max((e[2]-l)/Math.cos(o),u),f=this._zoomFromMercatorZ(d);Z.scaleAndAdd(e,e,n,d),this._pitch=ze(o,Vt(this.minPitch),Vt(this.maxPitch)),this.angle=bi(s,-Math.PI,Math.PI),this._setZoom(ze(f,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Fn(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){let e=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let n=0,o=Uu,s=0,l=1/0;for(;o-n>1e-6&&o>n;){let u=n+.5*(o-n),d=this.tileSize*Math.pow(2,u),f=this.getCameraToCenterDistance(this.projection,u,d),p=this.scaleZoom(f/(e*this.tileSize)),g=Math.abs(u-p);g<l&&(l=g,s=u),u<p?n=u:o=u}return s}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(J("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,n){let o=Math.min(e.x,n.x),s=Math.max(e.x,n.x),l=Math.min(e.y,n.y),u=Math.max(e.y,n.y);if(l<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let d=[new X(o,l),new X(s,u),new X(o,u),new X(s,l)],f=this.renderWorldCopies?-3:0,p=this.renderWorldCopies?4:1;for(let g of d){let _=this.pointRayIntersection(g);if(_.t<0)return!0;let v=this.rayIntersectionCoordinate(_);if(v.x<f||v.y<0||v.x>p||v.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+xi(this.fovAboveCenter)>88||this.anyCornerOffEdge(new X(0,0),new X(this.width,this.height))}zoomDeltaToMovement(e,n){let o=Z.length(Z.sub([],this._camera.position,e)),s=this._zoomFromMercatorZ(o)+n;return o-this._mercatorZfromZoom(s)}getCameraPoint(){if(this.projection.name==="globe"){let e=function([n,o,s],l){let u=[n,o,s,1];Ei.transformMat4(u,u,l);let d=u[3]=Math.max(u[3],1e-6);return u[0]/=d,u[1]/=d,u[2]/=d,u}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new X(e[0],e[1])}{let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new X(0,e))}}getCameraToCenterDistance(e,n=this.zoom,o=this.worldSize){let s=ug(e,n,this.width,this.height,1024),l=e.pixelSpaceConversion(this.center.lat,o,s),u=.5/Math.tan(.5*this._fov)*this.height*l;return this.isOrthographic&&(u=vL(1,u,xL(this.pitch>=15?1:this.pitch/15))),u}getWorldToCameraMatrix(){let e=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&ae.multiply(e,e,this.globeMatrix),e}getFrustum(e){return Uc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,this.projection.zAxisUnit==="meters")}}function bL(t,e,n){ae.identity(t),ae.rotateZ(t,t,Vt(e[2])),ae.rotateX(t,t,Vt(e[0])),ae.rotateY(t,t,Vt(e[1])),ae.scale(t,t,n),ae.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Iv(t,e,n,o,s,l,u,d){let f=[n[0]-e[0],n[1]-e[1],0],p=[o[0]-e[0],o[1]-e[1],0];if(Z.length(f)<1e-12||Z.length(p)<1e-12)return Wo.identity(t);let g=Z.cross([],f,p);Z.normalize(g,g),Z.subtract(p,o,e),f[2]=(l-s)*d,p[2]=(u-s)*d;let _=f;return Z.cross(_,f,p),Z.normalize(_,_),Wo.rotationTo(t,g,_)}function wL(t,e,n=!1){let o=Do(e.zoom),s=function(l,u,d){let f=u.worldSize,p=[l[12],l[13],l[14]],g=Jr(p[1]/f),_=Ws(p[0]/f),v=ae.identity([]),x=Oi(1,g)*f,b=Oi(1,0)*f*Gu(g,u.zoom),T=1/AT(f),E=b*T;if(d){let O=ug(u.projection,u.zoom,u.width,u.height,1024);E=T*u.projection.pixelSpaceConversion(u.center.lat,f,O)}let M=Ps(g,_);Z.add(M,M,Z.scale([],Z.normalize([],M),x*E*p[2]));let S=function(O){let A=[O[0],O[1],O[2]],R=[0,1,0],F=Z.cross([],R,A);return Z.cross(R,A,F),Z.squaredLength(R)===0&&(R=[0,1,0],Z.cross(F,A,R)),Z.normalize(F,F),Z.normalize(R,R),Z.normalize(A,A),[F[0],F[1],F[2],0,R[0],R[1],R[2],0,A[0],A[1],A[2],0,O[0],O[1],O[2],1]}(M);ae.scale(v,v,[E,E,E*x]),ae.translate(v,v,[-p[0],-p[1],-p[2]]);let P=ae.multiply([],u.globeMatrix,S);return ae.multiply(P,P,v),ae.multiply(P,P,l),P}(t,e,n);if(o>0){let l=function(u,d){let f=d.worldSize,p=Oi(1,0)*f*Gu(d.center.lat,d.zoom)/AT(f),g=Oi(1,d.center.lat)*f,_=ae.identity([]);return ae.rotateY(_,_,Vt(d.center.lng)),ae.rotateX(_,_,Vt(d.center.lat)),ae.translate(_,_,[0,0,gs]),ae.scale(_,_,[p,p,p*g]),ae.translate(_,_,[d.point.x-.5*f,d.point.y-.5*f,0]),ae.multiply(_,_,u),ae.multiply(_,d.globeMatrix,_)}(t,e);return function(u,d,f){let p=(b,T,E)=>{let M=Z.length(b),S=Z.length(T),P=$c(b,T,E);return Z.scale(P,P,1/Z.length(P)*Yt(M,S,E))},g=p([u[0],u[1],u[2]],[d[0],d[1],d[2]],f),_=p([u[4],u[5],u[6]],[d[4],d[5],d[6]],f),v=p([u[8],u[9],u[10]],[d[8],d[9],d[10]],f),x=$c([u[12],u[13],u[14]],[d[12],d[13],d[14]],f);return[g[0],g[1],g[2],0,_[0],_[1],_[2],0,v[0],v[1],v[2],0,x[0],x[1],x[2],1]}(s,l,o)}return s}let ch=64,fW=[1,1,1];class TL{constructor(e,n,o,s){this.id=e,this.position=n!=null?new Xt(n[0],n[1]):new Xt(0,0),this.orientation=o??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new qi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){if(ae.multiply(e.matrix,n,e.matrix),e.meshes)for(let o of e.meshes){let s=qi.applyTransform(o.aabb,e.matrix);this.aabb.encapsulate(s)}if(e.children)for(let o of e.children)this._applyTransformations(o,e.matrix)}computeBoundsAndApplyParent(){let e=ae.identity([]);for(let n of this.nodes)this._applyTransformations(n,e)}_positionModelOnTerrain(e,n){let o=e.elevation;if(!o)return 0;let s=qi.projectAabbCorners(this.aabb,this.matrix),l=Oi(1,this.position.lat)*e.worldSize,u=function(M,S){let P=[0,0,1],O=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let A of O){let R=M[A.corners[0]],F=M[A.corners[1]],k=M[A.corners[2]],N=[F[0]-R[0],F[1]-R[1],S*(F[2]-R[2])],B=Z.cross(N,N,[k[0]-R[0],k[1]-R[1],S*(k[2]-R[2])]);Z.normalize(B,B),A.dotProductWithUp=Z.dot(B,P)}return O.sort((A,R)=>A.dotProductWithUp-R.dotProductWithUp),O[0].corners}(s,l),d=s[u[0]],f=s[u[1]],p=s[u[2]],g=s[u[3]],_=o.getAtPointOrZero(new Fn(d[0]/e.worldSize,d[1]/e.worldSize),0),v=o.getAtPointOrZero(new Fn(f[0]/e.worldSize,f[1]/e.worldSize),0),x=o.getAtPointOrZero(new Fn(p[0]/e.worldSize,p[1]/e.worldSize),0),b=o.getAtPointOrZero(new Fn(g[0]/e.worldSize,g[1]/e.worldSize),0),T=(_+b)/2,E=(v+x)/2;return T>E?v<x?Iv(n,f,g,d,v,b,_,l):Iv(n,p,d,g,x,_,b,l):_<b?Iv(n,d,f,p,_,v,x,l):Iv(n,g,p,f,b,x,v,l),Math.max(T,E)}computeModelMatrix(e,n,o,s,l,u,d=!1){let f=e.transform,p=f.zoom,g=f.project(this.position),_=Gu(this.position.lat,p),v=1/_;ae.identity(this.matrix),ae.translate(this.matrix,this.matrix,[g.x+s[0]*v,g.y+s[1]*v,s[2]]);let x=1,b=1,T=f.worldSize;if(d){if(f.projection.name==="mercator"){let P=0;f.elevation&&(P=f.elevation.getAtPointOrZero(new Fn(g.x/T,g.y/T),0));let O=Ei.transformMat4([],[g.x,g.y,P,1],f.projMatrix)[3]/f.cameraToCenterDistance;x=O,b=O*Gu(f.center.lat,p)}else if(f.projection.name==="globe"){let P=wL(this.matrix,f),O=ae.multiply([],f.projMatrix,P),A=[0,0,0,1];Ei.transformMat4(A,A,O);let R=A[3]/f.cameraToCenterDistance,F=Do(p),k=f.projection.pixelsPerMeter(this.position.lat,T)*Gu(this.position.lat,p),N=f.projection.pixelsPerMeter(f.center.lat,T)*Gu(f.center.lat,p);x=R/Yt(k,k2(f.center.lat),F),b=R*_/k,x*=N,b*=N}}else x=v;ae.scale(this.matrix,this.matrix,[x,x,b]);let E=[...this.matrix],M=this.orientation,S=[];if(bL(S,[M[0]+n[0],M[1]+n[1],M[2]+n[2]],o),ae.multiply(this.matrix,E,S),l&&f.elevation){let P=0,O=[];if(u&&f.elevation){P=this._positionModelOnTerrain(f,O);let A=ae.fromQuat([],O),R=ae.multiply([],A,S);ae.multiply(this.matrix,E,R)}else P=f.elevation.getAtPointOrZero(new Fn(g.x/T,g.y/T),0);P!==0&&(this.matrix[14]+=P)}}upload(e){if(!this.uploaded){for(let n of this.nodes)yE(n,e);for(let n of this.nodes)Cv(n);this.uploaded=!0}}destroy(){for(let e of this.nodes)Sv(e)}}function dg(t,e,n=!1){t.uploaded||(t.gfxTexture=new fr(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function pW(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,iW.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,aW.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,sW.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?rW:oW).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,cW.members,!0)),t.segments=Ti.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let o=t.material;o.pbrMetallicRoughness.baseColorTexture&&dg(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&dg(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&dg(o.normalTexture,e),o.occlusionTexture&&dg(o.occlusionTexture,e,n),o.emissionTexture&&dg(o.emissionTexture,e)}function yE(t,e,n){if(t.meshes)for(let o of t.meshes)pW(o,e,n);if(t.children)for(let o of t.children)yE(o,e,n)}function Cv(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)Cv(e)}function Sv(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)Sv(n)}class EL{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ML{constructor(){this.instancedDataArray=new eT,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class IL{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,o,s){this.tileToMeter=Zm(o);let l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:u,id:d,index:f,sourceLayerIndex:p}of e){let g=Wu(u,l);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),g,o))continue;let _={id:d,sourceLayerIndex:p,index:f,geometry:l?g.geometry:Jl(u,o,s),properties:u.properties,type:u.type,patterns:{}},v=this.addFeature(_,_.geometry,g);v&&n.featureIndex.insert(u,_.geometry,f,p,this.index,this.instancesPerModel[v].instancedDataArray.length)}this.lookup=null}update(e,n,o,s){for(let l in this.instancesPerModel){let u=this.instancesPerModel[l];for(let d in e)u.idToFeaturesIndex.hasOwnProperty(d)&&this.evaluate(u.features[u.idToFeaturesIndex[d]],e[d],u,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];for(let s of o.features){let l=this.layers[0],u=s.feature,d=this.canonical,f=l.paint.get("model-rotation").evaluate(u,{},d),p=l.paint.get("model-scale").evaluate(u,{},d),g=l.paint.get("model-translation").evaluate(u,{},d);Z.exactEquals(s.rotation,f)&&Z.exactEquals(s.scale,p)&&Z.exactEquals(s.translation,g)||(this.evaluate(s,s.featureStates,o,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let o=this.instancesPerModel[n];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,lW.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let e in this.instancesPerModel){let n=this.instancesPerModel[e];n.instancedDataArray.length!==0&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,o){let s=this.layers[0],l=s.layout.get("model-id").evaluate(o,{},this.canonical);if(!l)return J(`modelId is not evaluated for layer ${s.id} and it is not going to get rendered.`),l;this.instancesPerModel[l]||(this.instancesPerModel[l]=new ML);let u=this.instancesPerModel[l],d=u.instancedDataArray,f=new EL(o,d.length);for(let p of n)for(let g of p){if(g.x<0||g.x>=ne||g.y<0||g.y>=ne)continue;let _=(this.lookupDim-1)/ne,v=this.lookupDim*(g.y*_|0)+g.x*_|0;if(this.lookup){if(this.lookup[v]!==0)continue;this.lookup[v]=1}this.instanceCount++;let x=d.length;d.resize(x+1),u.instancesEvaluatedElevation.push(0),d.float32[16*x]=g.x,d.float32[16*x+1]=g.y}return f.instancedDataCount=u.instancedDataArray.length-f.instancedDataOffset,f.instancedDataCount>0&&(e.id&&(u.idToFeaturesIndex[e.id]=u.features.length),u.features.push(f),this.evaluate(f,{},u,!1)),l}evaluate(e,n,o,s){let l=this.layers[0],u=e.feature,d=this.canonical,f=e.rotation=l.paint.get("model-rotation").evaluate(u,n,d),p=e.scale=l.paint.get("model-scale").evaluate(u,n,d),g=e.translation=l.paint.get("model-translation").evaluate(u,n,d),_=l.paint.get("model-color").evaluate(u,n,d);_.a=l.paint.get("model-color-mix-intensity").evaluate(u,n,d);let v=[];this.maxVerticalOffset<g[2]&&(this.maxVerticalOffset=g[2]),this.maxScale=Math.max(Math.max(this.maxScale,p[0]),Math.max(p[1],p[2])),bL(v,f,p);let x=Math.round(100*_.a)+_.b/1.05;for(let b=0;b<e.instancedDataCount;++b){let T=e.instancedDataOffset+b,E=16*T,M=o.instancedDataArray.float32,S=0;s&&(S=M[E+6]-o.instancesEvaluatedElevation[T]);let P=0|M[E+1];M[E]=(0|M[E])+_.r/1.05,M[E+1]=P+_.g/1.05,M[E+2]=x,M[E+3]=1/(d.z>10?this.tileToMeter:Zm(d,P)),M[E+4]=g[0],M[E+5]=g[1],M[E+6]=g[2]+S,M[E+7]=v[0],M[E+8]=v[1],M[E+9]=v[2],M[E+10]=v[4],M[E+11]=v[5],M[E+12]=v[6],M[E+13]=v[8],M[E+14]=v[9],M[E+15]=v[10],o.instancesEvaluatedElevation[T]=g[2]}}}pt(IL,"ModelBucket",{omit:["layers"]}),pt(ML,"PerModelAttributes"),pt(EL,"ModelFeature");let mW=new Tr({visibility:new je(q.layout_model.visibility),"model-id":new At(q.layout_model["model-id"])});var gW={paint:new Tr({"model-opacity":new je(q.paint_model["model-opacity"]),"model-rotation":new At(q.paint_model["model-rotation"]),"model-scale":new At(q.paint_model["model-scale"]),"model-translation":new At(q.paint_model["model-translation"]),"model-color":new At(q.paint_model["model-color"]),"model-color-mix-intensity":new At(q.paint_model["model-color-mix-intensity"]),"model-type":new je(q.paint_model["model-type"]),"model-cast-shadows":new je(q.paint_model["model-cast-shadows"]),"model-receive-shadows":new je(q.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new je(q.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new At(q.paint_model["model-emissive-strength"]),"model-roughness":new At(q.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new At(q.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new je(q.paint_model["model-cutoff-fade-range"])}),layout:mW};let vE=new Float32Array(262144),uh=new Uint8Array(262144);function CL(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,CL(n));return e}let SL=["","wall","door","roof","window","lamp","logo"];class DL{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:CL(e)}}}}class AL{constructor(e,n,o,s){this.nodes=e,this.id=n,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=s,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let o of n){let s=o.node;this.uploaded?this.updatePbrBuffer(s):yE(s,e,!0)}for(let o of n)Cv(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),n=!0);return n}needsReEvaluation(e,n,o){let s=e.transform.projectionOptions,l=e.style.getBrightness(),u=this.brightness!==l;return!!(!this.uploaded||this.dirty||s.name!==this.projection.name||hg(o.paint.get("model-color").value,u)||hg(o.paint.get("model-color-mix-intensity").value,u)||hg(o.paint.get("model-roughness").value,u)||hg(o.paint.get("model-emissive-strength").value,u)||hg(o.paint.get("model-height-based-emissive-strength-multiplier").value,u))&&(this.projection=s,this.brightness=l,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let o=this.getNodesInfo(),s=this.id.canonical;for(let l of o){let u=l.feature;l.evaluatedScale=n.paint.get("model-scale").evaluate(u,{},s)}}evaluate(e){let n=this.getNodesInfo();for(let o of n){if(!o.node.meshes)continue;let s=o.feature,l=o.node.meshes&&o.node.meshes[0].featureData,u=o.evaluatedColor[2],d=o.evaluatedRMEA[2],f=this.id.canonical;if(o.hasTranslucentParts=!1,l){for(let p=0;p<SL.length;p++){let g=SL[p];g.length&&(s.properties.part=g);let _=e.paint.get("model-color").evaluate(s,{},f),v=e.paint.get("model-color-mix-intensity").evaluate(s,{},f);o.evaluatedColor[p]=[_.r,_.g,_.b,v],o.evaluatedRMEA[p][0]=e.paint.get("model-roughness").evaluate(s,{},f),o.evaluatedRMEA[p][2]=e.paint.get("model-emissive-strength").evaluate(s,{},f),o.evaluatedRMEA[p][3]=_.a,o.emissionHeightBasedParams[p]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(s,{},f),!o.hasTranslucentParts&&_.a<1&&(o.hasTranslucentParts=!0)}delete s.properties.part,yW(o,u!==o.evaluatedColor[2]||d!==o.evaluatedRMEA[2])}o.evaluatedScale=e.paint.get("model-scale").evaluate(s,{},f),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,o,s){let l=e.findDEMTileFor(o);if(l&&(l.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;let u=Xf.create(e,o,l);if(!u)return;4&this.modelTraits&&this.updateDEM(e,u,o,s);for(let d of this.getNodesInfo()){let f=d.node;if(!f.footprint||!f.footprint.vertices||!f.footprint.vertices.length)continue;let p=f.footprint.vertices,g=u.getElevationAt(p[0].x,p[0].y,!0,!0);for(let _=1;_<p.length;_++)g=Math.min(g,u.getElevationAt(p[_].x,p[_].y,!0,!0));f.elevation=g}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,o,s){let l=n._dem._modifiedForSources[s];if(l===void 0&&(n._dem._modifiedForSources[s]=[],l=n._dem._modifiedForSources[s]),l.includes(o.canonical))return;let u=n._dem.dim;l.push(o.canonical);let d=!1;for(let f of this.getNodesInfo()){let p=f.node;if(!p.footprint||!p.footprint.grid)continue;let g=p.footprint.grid,_=n.tileCoordToPixel(g.min.x,g.min.y),v=n.tileCoordToPixel(g.max.x,g.max.y),x=Math.min(Math.min(u-v.y,_.x),Math.min(_.y,u-v.x));if(x<0)continue;let b=ze(x,2,5),T=Math.max(0,_.x-b),E=Math.max(0,_.y-b),M=Math.min(v.x+b,u-1),S=Math.min(v.y+b,u-1);for(let R=E;R<=S;++R)for(let F=T;F<=M;++F)uh[R*u+F]=255;let P=0,O=0;for(let R=0;R<g.cellsY;++R)for(let F=0;F<g.cellsX;++F){if(!g.cells[R*g.cellsX+F])continue;let k=n.tileCoordToPixel(g.min.x+F/g.xScale,g.min.y+R/g.yScale),N=n.tileCoordToPixel(g.min.x+(F+1)/g.xScale,g.min.y+(R+1)/g.yScale);for(let B=k.y;B<=Math.min(N.y+1,u-1);++B)for(let H=k.x;H<=Math.min(N.x+1,u-1);++H)uh[B*u+H]===255&&(uh[B*u+H]=0,P+=n.getElevationAtPixel(H,B),O++)}let A=P/O;T=Math.max(1,_.x-b),E=Math.max(1,_.y-b),M=Math.min(v.x+b,u-2),S=Math.min(v.y+b,u-2),d=!0;for(let R=E;R<=S;++R)for(let F=T;F<=M;++F)uh[R*u+F]===0&&(vE[R*u+F]=n._dem.set(F,R,A));for(let R=1;R<b;++R){T=Math.max(1,_.x-R),E=Math.max(1,_.y-R),M=Math.min(v.x+R,u-2),S=Math.min(v.y+R,u-2);for(let F=E;F<=S;++F)for(let k=T;k<=M;++k){let N=F*u+k;if(uh[N]===255){let B=0,H=0,G=-1,Y=-1;for(let U=-1;U<=1;++U)for(let Q=-1;Q<=1;++Q){let te=(F+U)*u+k+Q;if(uh[te]>=R)continue;let se=vE[te],K=Math.abs(se);K>H&&(B=se,H=K,G=Q,Y=U)}if(H>.1){let U=1-(R+.5*Math.abs(G*Y))/b,Q=n._dem.get(k,F)+B*U,te=n._dem.get(k+G,F+Y),se=n._dem.get(k-G,F-Y,!0);(Q-te)*(Q-se)>0&&(Q=(te+se)/2),vE[N]=n._dem.set(k,F,Q),uh[N]=R}}}}}d&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Zt.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(let e of this.nodes)this.nodesInfo.push(new DL(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(let e of this.nodes)Sv(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();let e=this.getNodesInfo();for(let n of e)Cv(n.node),Sv(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped()),s=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){let u=s[l].node;s[l].hiddenByReplacement=!!u.footprint&&!o.find(d=>d.footprint===u.footprint)}}getHeightAtTileCoord(e,n){let o=this.getNodesInfo(),s=[];for(let l=0;l<this.nodesInfo.length;l++){let u=o[l],d=u.node.meshes[0];if(e<d.aabb.min[0]||n<d.aabb.min[1]||e>d.aabb.max[0]||n>d.aabb.max[1])continue;let f=(e-d.aabb.min[0])/(d.aabb.max[0]-d.aabb.min[0])*ch|0,p=Math.min(63,(n-d.aabb.min[1])/(d.aabb.max[1]-d.aabb.min[1])*ch|0)*ch+Math.min(63,f);if(!(d.heightmap[p]<0&&u.node.footprint))return u.hiddenByReplacement?void 0:{height:d.heightmap[p],maxHeight:u.feature.properties.height,hidden:!1,verticalScale:u.evaluatedScale[2]};if(u.node.footprint.grid.query(new X(e,n),new X(e,n),s),s.length>0)return{height:void 0,maxHeight:u.feature.properties.height,hidden:u.hiddenByReplacement,verticalScale:u.evaluatedScale[2]}}}}function hg(t,e){return!t.isLightConstant&&e}function _W(t,e,n,o,s,l,u,d){let f=(61440&e|(61440&e)>>4)>>8,p=(3840&e|(3840&e)>>4)>>4,g=240&e|(240&e)>>4;n[3]>0&&(f=Yt(f,255*n[0],n[3]),p=Yt(p,255*n[1],n[3]),g=Yt(g,255*n[2],n[3]));let _=f<<8|p,v=g<<8|Math.floor(255*o[3]),x=function(R){let F=ze(R,0,2);return Math.min(Math.round(.5*F*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],b=ze(s[0],0,1),T=ze(s[1],0,1),E=ze(s[2],0,1),M=ze(s[3],0,1),S,P,O,A;if(b!==T&&u!==l&&T!==b){let R=u-l;P=1/(R*(T-b)),O=-(l+R*b)/(R*(T-b));let F=ze(s[4],-1,1);A=Math.pow(10,F),S=255*E<<8|255*M}else S=65535,P=0,O=1,A=1;if(t.emplaceBack(_,v,x,S,P,O,A),d){let R=d.length;d.clear();for(let F=0;F<R;F++)d.emplaceBack(_,v,x,S,P,O,A)}}function yW(t,e){let n=t.node,o=0;for(let s of n.meshes){if(n.lights&&n.lightMeshIndex===o||!s.featureData)continue;s.featureArray=new Sy,s.featureArray.reserve(s.featureData.length);let l=e;for(let u of s.featureData){let d,f=65535&u,p=(15&f)<8?15&f:0,g=u>>16&65535,_=t.evaluatedRMEA[p],v=t.evaluatedColor[p],x=t.emissionHeightBasedParams[p];if(l&&p===2&&n.lights&&(d=new Sy,d.resize(10*n.lights.length)),_W(s.featureArray,g,v,_,x,s.aabb.min[2],s.aabb.max[2],d),d&&l){l=!1;let b=n.meshes[n.lightMeshIndex];b.featureArray=d,b.featureArray._trim()}}s.featureArray._trim(),o++}}pt(AL,"Tiled3dModelBucket",{omit:["layers"]}),pt(DL,"Tiled3dModelFeature");class vW{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let n=RL(new X(0,0),new X(ne,ne),e),o=[];for(let s of this._activeRegions){if(s.hiddenByOverlap||!OL(n,s))continue;let l=xW(s.min,s.max,e);o.push({min:l.min,max:l.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId})}return o}setSources(e){this._setSources(e.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{let o=[];for(let s of n.cache.getVisibleCoordinates()){let l=n.cache.getTile(s).buckets[n.layer];if(l)for(let u of l.getNodesInfo()){let d=u.node;d.footprint&&o.push({footprint:d.footprint,id:s.toUnwrapped()})}}return o}})))}_addSource(e){let n=e.getFootprints();if(n.length!==0){for(let o of n){if(!o.footprint)continue;let s=RL(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:s.min,max:s.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,o)=>n.priority-o.priority||Dv(n.min,o.min)||Dv(n.max,o.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let n=0,o=0;for(;!e&&n!==this._activeRegions.length;){let s=this._activeRegions[n],l=this._prevRegions[o];e=s.priority!==l.priority||!PL(s,l),++n,++o}}if(e){++this._updateTime;let n=o=>{let s=this._activeRegions;if(o>=s.length)return o;let l=s[o].priority;for(;o<s.length&&s[o].priority===l;)++o;return o};if(this._sourceIds.length>1){let o=0,s=n(o);for(;o!==s;){let l=o,u=o;for(;l!==s;){let d=this._activeRegions[l];d.hiddenByOverlap=!1;for(let f=0;f<u;f++){let p=this._activeRegions[f];if(!p.hiddenByOverlap&&OL(d,p)&&(d.hiddenByOverlap=FL(d.footprint,d.tileId,p.footprint,p.tileId),d.hiddenByOverlap))break}++l}o=s,s=n(o)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=e.length-1;n>=0;n--)this._addSource(e[n]);this._computeReplacement()}}function Dv(t,e){return t.x-e.x||t.y-e.y}function PL(t,e){return Dv(t.min,e.min)===0&&Dv(t.max,e.max)===0}function OL(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function RL(t,e,n){let o=1/ne,s=1/(1<<n.canonical.z),l=(e.x*o+n.canonical.x)*s+n.wrap,u=(e.y*o+n.canonical.y)*s;return{min:new X((t.x*o+n.canonical.x)*s+n.wrap,(t.y*o+n.canonical.y)*s),max:new X(l,u)}}function xW(t,e,n){let o=1<<n.canonical.z,s=((e.x-n.wrap)*o-n.canonical.x)*ne,l=(e.y*o-n.canonical.y)*ne;return{min:new X(((t.x-n.wrap)*o-n.canonical.x)*ne,(t.y*o-n.canonical.y)*ne),max:new X(s,l)}}function LL(t,e,n,o,s,l,u){let d=t.indices,f=t.vertices,p=[];for(let g=o;g<o+s;g+=3){let _=e[n[g+0]+l],v=e[n[g+1]+l],x=e[n[g+2]+l],b=Math.min(_.x,v.x,x.x),T=Math.max(_.x,v.x,x.x),E=Math.min(_.y,v.y,x.y),M=Math.max(_.y,v.y,x.y);p.length=0,t.grid.query(new X(b,E),new X(T,M),p);for(let S=0;S<p.length;S++){let P=p[S];if(BT(f[d[3*P+0]],f[d[3*P+1]],f[d[3*P+2]],_,v,x,u))return!0}}return!1}function FL(t,e,n,o){if(!t||!n)return!1;let s=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(n.vertices.length<t.vertices.length)return FL(n,o,t,e);let l=e.canonical,u=o.canonical,d=Math.pow(2,u.z-l.z);s=t.vertices.map(f=>new X(f.x*l.x*ne*d-u.x*ne,f.y*l.y*ne*d-u.y*ne))}return LL(n,s,t.indices,0,t.indices.length,0,0)}let bW=Jy.types,wW=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],TW=["fill-extrusion-flood-light-ground-radius"],EW=Math.pow(2,13),MW=Math.pow(2,15)-1,kL=new X(0,1),nc=2147483648;function fg(t,e,n,o,s,l,u,d){t.emplaceBack((e<<1)+u,(n<<1)+l,(Math.floor(o*EW)<<1)+s,Math.round(d))}function Av(t,e,n,o,s,l){t.emplaceBack(e.x,e.y,(n.x<<1)+o,(n.y<<1)+s,l)}function pg(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class NL{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class zL{constructor(){this.centroidXY=new X(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new X(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new X(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new X(this.max.x-this.min.x,this.max.y-this.min.y)}}class BL{constructor(){this.acc=new X(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,o){this.accCount++,this.acc._add(n);let s=!!this.borders;n.x<e.min.x?(e.min.x=n.x,s=!0):n.x>e.max.x&&(e.max.x=n.x,s=!0),n.y<e.min.y?(e.min.y=n.y,s=!0):n.y>e.max.y&&(e.max.y=n.y,s=!0),((n.x===0||n.x===ne)&&n.x===o.x)!=((n.y===0||n.y===ne)&&n.y===o.y)&&this.processBorderOverlap(n,o),s&&this.checkBorderIntersection(n,o)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Yt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>ne!=e.x>ne&&this.addBorderIntersection(1,Yt(n.y,e.y,(ne-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Yt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>ne!=e.y>ne&&this.addBorderIntersection(3,Yt(n.x,e.x,(ne-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{let o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new X(0,0):new X(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function jL(t,e){let n=t.add(e)._unit(),o=ze(t.x*n.x+t.y*n.y,-1,1);var s,l,u;return s=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(s)))/4*MW*((l=t).x*(u=e).y-l.y*u.x<0?-1:1)}let IW=[t=>t.x<0,t=>t.x>ne,t=>t.y<0,t=>t.y>ne];function CW(t,e,n,o){let s=[4];if(o===0)return s;n._mult(o);let l=t.sub(n),u=e.sub(n),d=[t,e,l,u];for(let f=0;f<4;f++)for(let p of d)if(IW[f](p)){s.push(f);break}return s}class VL{constructor(e){this.vertexArray=new Uw,this.indexArray=new Kr,this.programConfigurations=new Bu(e.layers,e.zoom,n=>TW.includes(n)),this._segments=new Ti,this.hiddenByLandmarkVertexArray=new tT,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ti}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,o,s=!1){let l=e.length;if(l>2){let u=Math.max(0,this._segments.get().length-1),d=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[u].length),f;u!==this._segments.get().length-1&&(u++,this._segmentToGroundQuads[u]=[],this._segmentToRegionTriCounts[u]=[0,0,0,0,0]);{let p=e[0],g=e[1];f=jL(p.sub(e[l-1])._perp()._unit(),g.sub(p)._perp()._unit())}for(let p=0;p<l;p++){let g=p===l-1?0:p+1,_=e[p],v=e[g],x=e[g===l-1?0:g+1],b=v.sub(_)._perp()._unit(),T=jL(b,x.sub(v)._perp()._unit()),E=f,M=T;if(xE(_,v,n)||s&&HL(_,n)&&HL(v,n)){f=T;continue}let S=d.vertexLength;Av(this.vertexArray,_,v,1,1,E),Av(this.vertexArray,_,v,1,0,E),Av(this.vertexArray,_,v,0,1,M),Av(this.vertexArray,_,v,0,0,M),d.vertexLength+=4;let P=CW(_,v,b,o);for(let O of P)this._segmentToGroundQuads[u].push({id:S,region:O}),this._segmentToRegionTriCounts[u][O]+=2,d.primitiveLength+=2;f=T}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let o=0;o<n;o++)this._segmentToGroundQuads[o].sort((s,l)=>s.region-l.region);for(let o=0;o<n;o++){let s=this._segmentToGroundQuads[o],l=e[o],u=this._segmentToRegionTriCounts[o];u.reduce((f,p)=>f+p,0);let d=0;for(let f=0;f<=4;f++){let p=u[f];if(p!==0){let g=this.regionSegments[f];g||(g=this.regionSegments[f]=new Ti);let _={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+d,vertexLength:l.vertexLength,primitiveLength:p};g.get().push(_)}d+=p}for(let f=0;f<s.length;f++){let p=s[f].id;this.indexArray.emplaceBack(p,p+1,p+3),this.indexArray.emplaceBack(p,p+3,p+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,o,s,l,u){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,o,s,l,u)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,JH.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,o,s,l,u){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,o,s,l,u)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let o=e.flags&nc?1:0;for(let s=e.groundVertexArrayOffset;s<n;++s)this.hiddenByLandmarkVertexArray.emplace(s,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,eG.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class mg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Kr,this.footprintVertices=new $s,this.footprintSegments=[],this.layoutVertexArray=new eh,this.centroidVertexArray=new XP,this.indexArray=new Kr,this.programConfigurations=new Bu(e.layers,e.zoom,n=>wW.includes(n)),this.segments=new Ti,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new VL(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,o,s){this.features=[],this.hasPattern=WT("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Zm(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:l,id:u,index:d,sourceLayerIndex:f}of e){let p=this.layers[0]._featureFilter.needGeometry,g=Wu(l,p);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),g,o))continue;let _={id:u,sourceLayerIndex:f,index:d,geometry:p?g.geometry:Jl(l,o,s),properties:l.properties,type:l.type,patterns:{}},v=this.layoutVertexArray.length;this.hasPattern?this.features.push(qT("fill-extrusion",this.layers,_,this.zoom,n)):this.addFeature(_,_.geometry,d,o,{},n.availableImages,s,n.brightness),n.featureIndex.insert(l,_.geometry,d,f,this.index,v)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,o,s,l,u){for(let d of this.features){let{geometry:f}=d;this.addFeature(d,f,d.index,n,o,s,l,u)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,o,s,l){let u=Object.keys(e).length!==0;if(u&&!this.stateDependentLayers.length)return;let d=u?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,d,o,s,l),this.groundEffect.update(e,n,d,o,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nG),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,tG.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,QH.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,s,l,u,d,f){let p=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,g=[new X(0,0),new X(ne,ne)],_=d.projection,v=_.name==="globe",x=bW[e.type]==="Polygon",b=new BL;b.centroidDataIndex=this.centroidData.length;let T=new zL,E=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},s)<=0,M=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},s);T.height=M,T.vertexArrayOffset=this.layoutVertexArray.length,T.groundVertexArrayOffset=this.groundEffect.vertexArray.length,v&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Iy);let S=GT(n,500);for(let k=S.length-1;k>=0;k--){let N=S[k];(N.length===0||(P=N[0]).every(B=>B.x<=0)||P.every(B=>B.x>=ne)||P.every(B=>B.y<=0)||P.every(B=>B.y>=ne))&&S.splice(k,1)}var P;let O;if(v)O=ZL(S,g,s);else{O=[];for(let k of S)O.push({polygon:k,bounds:g})}let A=x?this.edgeRadius:0,R=A>0&&this.zoom<17,F=(k,N)=>{if(k.length===0)return!1;let B=k[k.length-1];return N.x===B.x&&N.y===B.y};for(let{polygon:k,bounds:N}of O){let B=0,H=0;for(let Q of k)x&&!Q[0].equals(Q[Q.length-1])&&Q.push(Q[0]),H+=x?Q.length-1:Q.length;let G=this.segments.prepareSegment((x?5:4)*H,this.layoutVertexArray,this.indexArray);T.footprintSegIdx<0&&(T.footprintSegIdx=this.footprintSegments.length),T.polygonSegIdx<0&&(T.polygonSegIdx=this.polygonSegments.length);let Y={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},U=new NL;if(U.vertexOffset=this.footprintVertices.length,U.indexOffset=3*this.footprintIndices.length,U.ringIndices=[],x){let Q=[],te=[];B=G.vertexLength;for(let K=0;K<k.length;K++){let ee=k[K];ee.length&&K!==0&&te.push(Q.length/2);let de=[],pe,fe;pe=ee[1].sub(ee[0])._perp()._unit(),U.ringIndices.push(ee.length-1);for(let be=1;be<ee.length;be++){let Te=ee[be],Me=ee[be===ee.length-1?1:be+1],ge=Te.clone();if(A){fe=Me.sub(Te)._perp()._unit();let Pe=pe.add(fe)._unit(),et=A*Math.min(4,1/(pe.x*Pe.x+pe.y*Pe.y));ge.x+=et*Pe.x,ge.y+=et*Pe.y,ge.x=Math.round(ge.x),ge.y=Math.round(ge.y),pe=fe}!E||A!==0&&!R||F(de,ge)||de.push(ge),fg(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),G.vertexLength++,this.footprintVertices.emplaceBack(Te.x,Te.y),Q.push(Te.x,Te.y),v&&pg(this.layoutVertexExtArray,_.projectTilePoint(ge.x,ge.y,s),_.upVector(s,ge.x,ge.y))}E&&(A===0||R)&&(de.length!==0&&F(de,de[0])&&de.pop(),this.groundEffect.addData(de,N,p))}let se=Yy(Q,te);for(let K=0;K<se.length;K+=3)this.footprintIndices.emplaceBack(U.vertexOffset+se[K+0],U.vertexOffset+se[K+1],U.vertexOffset+se[K+2]),this.indexArray.emplaceBack(B+se[K],B+se[K+2],B+se[K+1]),G.primitiveLength++;U.indexCount+=se.length,U.vertexCount+=this.footprintVertices.length-U.vertexOffset}for(let Q=0;Q<k.length;Q++){let te=k[Q];b.startRing(T,te[0]);let se=te.length>4&&GL(te[te.length-2],te[0],te[1]),K=A?SW(te[te.length-2],te[0],te[1],A):0,ee=[],de,pe,fe;pe=te[1].sub(te[0])._perp()._unit();let be=!0;for(let Te=1,Me=0;Te<te.length;Te++){let ge=te[Te-1],Pe=te[Te],et=te[Te===te.length-1?1:Te+1];if(b.appendEdge(T,Pe,ge),xE(Pe,ge,N)){A&&(pe=et.sub(Pe)._perp()._unit(),be=!be);continue}let tt=Pe.sub(ge)._perp(),lt=tt.x/(Math.abs(tt.x)+Math.abs(tt.y)),ct=tt.y>0?1:0,Ht=ge.dist(Pe);if(Me+Ht>32768&&(Me=0),A){fe=et.sub(Pe)._perp()._unit();let Gt=$L(ge,Pe,et,UL(pe,fe),A);isNaN(Gt)&&(Gt=0);let kt=Pe.sub(ge)._unit();ge=ge.add(kt.mult(K))._round(),Pe=Pe.add(kt.mult(-Gt))._round(),K=Gt,pe=fe,E&&this.zoom>=17&&(F(ee,ge)||ee.push(ge),F(ee,Pe)||ee.push(Pe))}let Tt=G.vertexLength,zn=te.length>4&&GL(ge,Pe,et),Dn=WL(Me,se,be);if(fg(this.layoutVertexArray,ge.x,ge.y,lt,ct,0,0,Dn),fg(this.layoutVertexArray,ge.x,ge.y,lt,ct,0,1,Dn),Me+=Ht,Dn=WL(Me,zn,!be),se=zn,fg(this.layoutVertexArray,Pe.x,Pe.y,lt,ct,0,0,Dn),fg(this.layoutVertexArray,Pe.x,Pe.y,lt,ct,0,1,Dn),G.vertexLength+=4,this.indexArray.emplaceBack(Tt+0,Tt+1,Tt+2),this.indexArray.emplaceBack(Tt+1,Tt+3,Tt+2),G.primitiveLength+=2,A){let Gt=B+(Te===1?te.length-2:Te-2),kt=Te===1?B:Gt+1;if(this.indexArray.emplaceBack(Tt+1,Gt,Tt+3),this.indexArray.emplaceBack(Gt,kt,Tt+3),G.primitiveLength+=2,de===void 0&&(de=Tt),!xE(et,te[Te],N)){let St=Te===te.length-1?de:G.vertexLength;this.indexArray.emplaceBack(Tt+2,Tt+3,St),this.indexArray.emplaceBack(Tt+3,St+1,St),this.indexArray.emplaceBack(Tt+3,kt,St+1),G.primitiveLength+=3}be=!be}if(v){let Gt=this.layoutVertexExtArray,kt=_.projectTilePoint(ge.x,ge.y,s),St=_.projectTilePoint(Pe.x,Pe.y,s),Pn=_.upVector(s,ge.x,ge.y),Nn=_.upVector(s,Pe.x,Pe.y);pg(Gt,kt,Pn),pg(Gt,kt,Pn),pg(Gt,St,Nn),pg(Gt,St,Nn)}}x&&(B+=te.length-1),E&&A&&this.zoom>=17&&(ee.length!==0&&F(ee,ee[0])&&ee.pop(),this.groundEffect.addData(ee,N,p,A>0))}this.footprintSegments.push(U),Y.triangleCount=this.indexArray.length-Y.triangleArrayOffset,this.polygonSegments.push(Y),++T.footprintSegLen,++T.polygonSegLen}if(T.vertexCount=this.layoutVertexArray.length-T.vertexArrayOffset,T.groundVertexCount=this.groundEffect.vertexArray.length-T.groundVertexArrayOffset,T.vertexCount!==0){if(T.centroidXY=b.borders?kL:this.encodeCentroid(b,T),this.centroidData.push(T),b.borders){this.featuresOnBorder.push(b);let k=this.featuresOnBorder.length-1;for(let N=0;N<b.borders.length;N++)b.borders[N][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[N].push(k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,l,u,s,f),this.groundEffect.addPaintPropertiesData(e,o,l,u,s,f),this.maxHeight=Math.max(this.maxHeight,M)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){let e=[];for(let d=0;d<this.centroidData.length;d++){let f=this.centroidData[d],p=+(f.min.y+f.max.y>ne),g=2*p+(+(f.min.x+f.max.x>ne)^p);for(let _=0;_<f.polygonSegLen;_++){let v=f.polygonSegIdx+_;e.push({centroidIdx:d,subtile:g,polygonSegmentIdx:v,triangleSegmentIdx:this.polygonSegments[v].triangleSegIdx})}}let n=new Kr;e.sort((d,f)=>d.triangleSegmentIdx===f.triangleSegmentIdx?d.subtile-f.subtile:d.triangleSegmentIdx-f.triangleSegmentIdx);let o=0,s=0,l=0;for(let d of e){if(d.triangleSegmentIdx!==o)break;l++}let u=e.length;for(;s!==e.length;){o=e[s].triangleSegmentIdx;let d=0,f=s,p=s;for(let g=f;g<l&&e[g].subtile===d;g++)p++;for(;f!==l;){let g=e[f];d=g.subtile;let _=this.centroidData[g.centroidIdx].min.clone(),v=this.centroidData[g.centroidIdx].max.clone(),x={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let b=f;b<p;b++){let T=e[b],E=this.polygonSegments[T.polygonSegmentIdx],M=this.centroidData[T.centroidIdx].min,S=this.centroidData[T.centroidIdx].max,P=this.indexArray.uint16;for(let O=E.triangleArrayOffset;O<E.triangleArrayOffset+E.triangleCount;O++)n.emplaceBack(P[3*O],P[3*O+1],P[3*O+2]);x.primitiveLength+=E.triangleCount,_.x=Math.min(_.x,M.x),_.y=Math.min(_.y,M.y),v.x=Math.max(v.x,S.x),v.y=Math.max(v.y,S.y)}x.primitiveLength>0&&this.triangleSubSegments.push({segment:x,min:_,max:v}),f=p;for(let b=f;b<l&&e[b].subtile===e[f].subtile;b++)p++}s=l;for(let g=s;g<u&&e[g].triangleSegmentIdx===e[s].triangleSegmentIdx;g++)l++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,o){let s=0,l=0,u=1<<e.canonical.z;if(n){let T=n.getMinMaxForTile(e);T&&(s=T.min,l=T.max)}l+=this.maxHeight;let d=e.toUnwrapped(),f,p=[d.canonical.x/u+d.wrap,d.canonical.y/u],g=[(d.canonical.x+1)/u+d.wrap,(d.canonical.y+1)/u],_=new Ti,v=(T,E,M)=>[T[0]*(1-M[0])+E[0]*M[0],T[1]*(1-M[1])+E[1]*M[1]],x=[],b=[];for(let T of this.triangleSubSegments){x[0]=T.min.x/ne,x[1]=T.min.y/ne,b[0]=T.max.x/ne,b[1]=T.max.y/ne;let E=v(p,g,x),M=v(p,g,b);if(new qi([E[0],E[1],s],[M[0],M[1],l]).intersectsPrecise(o)===0){f&&(_.segments.push(f),f=void 0);continue}let S=T.segment;f&&f.vertexOffset!==S.vertexOffset&&(_.segments.push(f),f=void 0),f?(f.vertexLength+=S.vertexLength,f.primitiveLength+=S.primitiveLength):f={vertexOffset:S.vertexOffset,primitiveLength:S.primitiveLength,vertexLength:S.vertexLength,primitiveOffset:S.primitiveOffset,sortKey:void 0,vaos:{}}}return f&&_.segments.push(f),_}encodeCentroid(e,n){let o=e.centroid(),s=n.span(),l=Math.min(7,Math.round(s.x*this.tileToMeter/10)),u=Math.min(7,Math.round(s.y*this.tileToMeter/10));return new X(ze(o.x,1,ne-1)<<3|l,ze(o.y,1,ne-1)<<3|u)}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=nc,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,s=e.flags&nc?kL:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==s.y||l!==s.x){for(let u=n;u<o;++u)this.centroidVertexArray.emplace(u,s.x,s.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let o=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(l,u){if(l.length!==u.length)return!1;for(let d=0;d<l.length;d++)if(l[d].sourceId!==u[d].sourceId||!PL(l[d],u[d]))return!1;return!0}(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let l of this.centroidData)l.flags&=2147483647;let s=[];for(let l of this.activeReplacements){let u=Math.pow(2,l.footprintTileId.canonical.z-e.canonical.z);for(let d of this.centroidData)if(!(d.flags&nc||l.min.x>d.max.x||d.min.x>l.max.x||l.min.y>d.max.y||d.min.y>l.max.y))for(let f=0;f<d.footprintSegLen;f++){let p=this.footprintSegments[d.footprintSegIdx+f];if(s.length=0,DW(this.footprintVertices,p.vertexOffset,p.vertexCount,l.footprintTileId.canonical,e.canonical,s),LL(l.footprint,s,this.footprintIndices.uint16,p.indexOffset,p.indexCount,-p.vertexOffset,-u)){d.flags|=nc;break}}}for(let l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,o){let s=!1;for(let l=0;l<o.footprintSegLen;l++){let u=this.footprintSegments[o.footprintSegIdx+l],d=0;for(let f of u.ringIndices){for(let p=d,g=f+d-1;p<f+d;g=p++){let _=this.footprintVertices.int16[2*(p+u.vertexOffset)+0],v=this.footprintVertices.int16[2*(p+u.vertexOffset)+1],x=this.footprintVertices.int16[2*(g+u.vertexOffset)+1];v>n!=x>n&&e<(this.footprintVertices.int16[2*(g+u.vertexOffset)+0]-_)*(n-v)/(x-v)+_&&(s=!s)}d=f}}return s}getHeightAtTileCoord(e,n){let o=Number.NEGATIVE_INFINITY,s=!0,l=4*(e+ne)*ne+(n+ne);if(this.partLookup.hasOwnProperty(l)){let u=this.partLookup[l];return u?{height:u.height,hidden:!!(u.flags&nc)}:void 0}for(let u of this.centroidData)e>u.max.x||u.min.x>e||n>u.max.y||u.min.y>n||this.footprintContainsPoint(e,n,u)&&u&&u.height>o&&(o=u.height,this.partLookup[l]=u,s=!!(u.flags&nc));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:s};this.partLookup[l]=void 0}}function UL(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function SW(t,e,n,o){let s=e.sub(t)._perp()._unit(),l=n.sub(e)._perp()._unit();return $L(t,e,n,UL(s,l),o)}function $L(t,e,n,o,s){let l=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(n)/3,s*l/o)}function xE(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function HL(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function GL(t,e,n){if(t.x<0||t.x>=ne||e.x<0||e.x>=ne||n.x<0||n.x>=ne)return!1;let o=n.sub(e),s=o.perp(),l=t.sub(e);return(o.x*l.x+o.y*l.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(l.x*l.x+l.y*l.y))>-.866&&s.x*l.x+s.y*l.y<0}function WL(t,e,n){let o=e?2|t:-3&t;return n?1|o:-2&o}function qL(){let t=Math.PI/32,e=Math.tan(t),n=$f;return n*Math.sqrt(1+2*e*e)-n}function ZL(t,e,n){let o=1<<n.z,s=Ws(n.x/o),l=Ws((n.x+1)/o),u=Jr(n.y/o),d=Jr((n.y+1)/o);return function(f,p,g,_,v=0,x){let b=[];if(!f.length||!g||!_)return b;let T=(R,F)=>{for(let k of R)b.push({polygon:k,bounds:F})},E=Math.ceil(Math.log2(g)),M=Math.ceil(Math.log2(_)),S=E-M,P=[];for(let R=0;R<Math.abs(S);R++)P.push(S>0?0:1);for(let R=0;R<Math.min(E,M);R++)P.push(0),P.push(1);let O=f;if(O=Qy(O,p[0].y-v,p[1].y+v,1),O=Qy(O,p[0].x-v,p[1].x+v,0),!O.length)return b;let A=[];for(P.length?A.push({polygons:O,bounds:p,depth:0}):T(O,p);A.length;){let R=A.pop(),F=R.depth,k=P[F],N=R.bounds[0],B=R.bounds[1],H=k===0?N.x:N.y,G=k===0?B.x:B.y,Y=x?x(k,H,G):.5*(H+G),U=Qy(R.polygons,H-v,Y+v,k),Q=Qy(R.polygons,Y-v,G+v,k);if(U.length){let te=[N,new X(k===0?Y:B.x,k===1?Y:B.y)];P.length>F+1?A.push({polygons:U,bounds:te,depth:F+1}):T(U,te)}if(Q.length){let te=[new X(k===0?Y:N.x,k===1?Y:N.y),B];P.length>F+1?A.push({polygons:Q,bounds:te,depth:F+1}):T(Q,te)}}return b}(t,e,Math.ceil((l-s)/11.25),Math.ceil((u-d)/11.25),1,(f,p,g)=>{if(f===0)return .5*(p+g);{let _=Jr((n.y+p/ne)/o);return(po(.5*(Jr((n.y+g/ne)/o)+_))*o-n.y)*ne}})}function DW(t,e,n,o,s,l){let u=Math.pow(2,o.z-s.z);for(let d=0;d<n;d++){let f=t.int16[2*(d+e)+0],p=t.int16[2*(d+e)+1];f=(f+s.x*ne)*u-o.x*ne,p=(p+s.y*ne)*u-o.y*ne,l.push(new X(f,p))}}pt(mg,"FillExtrusionBucket",{omit:["layers","features"]}),pt(zL,"PartData"),pt(NL,"FootprintSegment"),pt(BL,"BorderCentroidData"),pt(VL,"GroundEffect");let AW=new Tr({visibility:new je(q["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new je(q["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var PW={paint:new Tr({"fill-extrusion-opacity":new je(q["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new At(q["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new je(q["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new je(q["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new At(q["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new At(q["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new At(q["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new je(q["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new je(q["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new je(q["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new je(q["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new je(q["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new je(q["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new je(q["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new je(q["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new At(q["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new At(q["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new je(q["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new je(q["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new je(q["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new je(q["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new je(q["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:AW};class op extends X{constructor(e,n,o){super(e,n),this.z=o}}function gg(t,e){return t.x*e.x+t.y*e.y}function YL(t,e){if(t.length===1){let n=0,o=e[n++],s;for(;!s||o.equals(s);)if(s=e[n++],!s)return 1/0;for(;n<e.length;n++){let l=e[n],u=t[0],d=s.sub(o),f=l.sub(o),p=u.sub(o),g=gg(d,d),_=gg(d,f),v=gg(f,f),x=gg(p,d),b=gg(p,f),T=g*v-_*_,E=(v*x-_*b)/T,M=(g*b-_*x)/T,S=o.z*(1-E-M)+s.z*E+l.z*M;if(isFinite(S))return S}return 1/0}{let n=1/0;for(let o of e)n=Math.min(n,o.z);return n}}function XL(t,e,n,o,s,l,u,d){let f=u*s.getElevationAt(t,e,!0,!0),p=l[0]!==0,g=p?l[1]===0?u*(l[0]/7-450):u*function(_,v,x){let b=Math.floor(v[0]/8),T=Math.floor(v[1]/8),E=10*(v[0]-8*b),M=10*(v[1]-8*T),S=_.getElevationAt(b,T,!0,!0),P=_.getMeterToDEM(x),O=Math.floor(.5*(E*P-1)),A=Math.floor(.5*(M*P-1)),R=_.tileCoordToPixel(b,T),F=2*O+1,k=2*A+1,N=function(Q,te,se,K,ee){return[Q.getElevationAtPixel(te,se,!0),Q.getElevationAtPixel(te+ee,se,!0),Q.getElevationAtPixel(te,se+ee,!0),Q.getElevationAtPixel(te+K,se+ee,!0)]}(_,R.x-O,R.y-A,F,k),B=Math.abs(N[0]-N[1]),H=Math.abs(N[2]-N[3]),G=Math.abs(N[0]-N[2])+Math.abs(N[1]-N[3]),Y=Math.min(.25,.5*P*(B+H)/F),U=Math.min(.25,.5*P*G/k);return S+Math.max(Y*E,U*M)}(s,l,d):f;return{base:f+(n===0)?-1:n,top:p?Math.max(g+o,f+n+2):f+o}}let OW=new Tr({"line-cap":new At(q.layout_line["line-cap"]),"line-join":new At(q.layout_line["line-join"]),"line-miter-limit":new je(q.layout_line["line-miter-limit"]),"line-round-limit":new je(q.layout_line["line-round-limit"]),"line-sort-key":new At(q.layout_line["line-sort-key"]),visibility:new je(q.layout_line.visibility)});var KL={paint:new Tr({"line-opacity":new At(q.paint_line["line-opacity"]),"line-color":new At(q.paint_line["line-color"]),"line-translate":new je(q.paint_line["line-translate"]),"line-translate-anchor":new je(q.paint_line["line-translate-anchor"]),"line-width":new At(q.paint_line["line-width"]),"line-gap-width":new At(q.paint_line["line-gap-width"]),"line-offset":new At(q.paint_line["line-offset"]),"line-blur":new At(q.paint_line["line-blur"]),"line-dasharray":new At(q.paint_line["line-dasharray"]),"line-pattern":new At(q.paint_line["line-pattern"]),"line-gradient":new zm(q.paint_line["line-gradient"]),"line-trim-offset":new je(q.paint_line["line-trim-offset"]),"line-emissive-strength":new je(q.paint_line["line-emissive-strength"]),"line-border-width":new At(q.paint_line["line-border-width"]),"line-border-color":new At(q.paint_line["line-border-color"])}),layout:OW};let RW=(t,e,n,o,s,l,u)=>{let d=t.transform,f=d.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:QL(t,e,n,o),u_pixels_to_tile_units:f,u_device_pixel_ratio:l,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:tF(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:JL(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:u,u_emissive_strength:n.paint.get("line-emissive-strength")}},LW=(t,e,n,o,s)=>{let l=t.transform;return{u_matrix:QL(t,e,n,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:l.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:s,u_image:0,u_tile_units_to_pixels:JL(e,l),u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function JL(t,e){return 1/lh(t,1,e.tileZoom)}function QL(t,e,n,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let eF=t=>{let e=[];tF(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");return n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function tF(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let nF=new class extends At{possiblyEvaluate(t,e){return e=new ur(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,o){return e=Ne({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,o)}}(KL.paint.properties["line-width"].specification);function iF(t,e){return e>0?e+2*t:t}nF.useIntegerZoom=!0;let FW=new Tr({visibility:new je(q.layout_background.visibility)});var kW={paint:new Tr({"background-color":new je(q.paint_background["background-color"]),"background-pattern":new je(q.paint_background["background-pattern"]),"background-opacity":new je(q.paint_background["background-opacity"]),"background-emissive-strength":new je(q.paint_background["background-emissive-strength"])}),layout:FW};let NW=new Tr({visibility:new je(q.layout_raster.visibility)});var zW={paint:new Tr({"raster-opacity":new je(q.paint_raster["raster-opacity"]),"raster-color":new zm(q.paint_raster["raster-color"]),"raster-color-mix":new je(q.paint_raster["raster-color-mix"]),"raster-color-range":new je(q.paint_raster["raster-color-range"]),"raster-hue-rotate":new je(q.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new je(q.paint_raster["raster-brightness-min"]),"raster-brightness-max":new je(q.paint_raster["raster-brightness-max"]),"raster-saturation":new je(q.paint_raster["raster-saturation"]),"raster-contrast":new je(q.paint_raster["raster-contrast"]),"raster-resampling":new je(q.paint_raster["raster-resampling"]),"raster-fade-duration":new je(q.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new je(q.paint_raster["raster-emissive-strength"]),"raster-array-band":new je(q.paint_raster["raster-array-band"]),"raster-elevation":new je(q.paint_raster["raster-elevation"])}),layout:NW};function rF(t,e,n,o,s,l,u,d){let f=[t,n,s,e,o,l,1,1,1],p=[u,d,1],g=As.adjoint([],f),[_,v,x]=Z.transformMat3(p,p,As.transpose(g,g));return As.multiply(f,[_,0,0,0,v,0,0,0,x],f)}class Ga extends vn{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(s),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Se("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ft(this.map._requestManager.transformRequest(this.url,ve.Image),(o,s)=>{if(this._imageRequest=null,this._loaded=!0,o)this.fire(new Je(o));else if(s){let{HTMLImageElement:l}=y;this.image=s instanceof l?Zt.getImageData(s):s,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new xv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof xv||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],o=e[0][1];for(let l of e)l[1]>o&&(o=l[1]),l[1]<n&&(n=l[1]);let s=(o+n)/2;if(s>Pr?this.onNorthPole=!0:s<-Pr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let l=e.map(Fn.fromLngLat);this.tileID=function(u){let d=1/0,f=1/0,p=-1/0,g=-1/0;for(let b of u)d=Math.min(d,b.x),f=Math.min(f,b.y),p=Math.max(p,b.x),g=Math.max(g,b.y);let _=Math.max(p-d,g-f),v=Math.max(0,Math.floor(-Math.log(_)/Math.LN2)),x=Math.pow(2,v);return new Va(v,Math.floor((d+p)/2*x),Math.floor((f+g)/2*x))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Se("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(let f in this.tiles){let p=this.tiles[f];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}if(this._boundsArray)return;let n=ah(this.tileID,this.map.transform.projection),[o,s,l,u]=this.coordinates.map(f=>{let p=n.projection.project(f[0],f[1]);return GR(n,p)._round()});this.perspectiveTransform=function(f,p,g,_,v,x,b,T,E,M){let S=rF(0,0,f,0,0,p,f,p),P=rF(g,_,v,x,b,T,E,M);return As.multiply(P,As.adjoint(S,S),P),[P[6]/P[8]*f/ne,P[7]/P[8]*p/ne]}(this.width,this.height,o.x,o.y,s.x,s.y,u.x,u.y,l.x,l.y);let d=this._boundsArray=new eh;d.emplaceBack(o.x,o.y,0,0),d.emplaceBack(s.x,s.y,ne,0),d.emplaceBack(u.x,u.y,0,ne),d.emplaceBack(l.x,l.y,ne,ne),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(d,cE.members),this.boundsSegments=Ti.simpleSegment(0,0,4,2)}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,o=n.gl;!this._dirty||this.texture instanceof xv||(this.texture?this.texture.update(this.image):(this.texture=new fr(n,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class BW extends fa{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let jW=new Tr({visibility:new je(q.layout_sky.visibility)});var VW={paint:new Tr({"sky-type":new je(q.paint_sky["sky-type"]),"sky-atmosphere-sun":new je(q.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new je(q.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new je(q.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new je(q.paint_sky["sky-gradient-radius"]),"sky-gradient":new zm(q.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new je(q.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new je(q.paint_sky["sky-atmosphere-color"]),"sky-opacity":new je(q.paint_sky["sky-opacity"])}),layout:jW};function bE(t,e,n){let o=[0,0,1],s=Wo.identity([]);return Wo.rotateY(s,s,n?-Vt(t)+Math.PI:Vt(t)),Wo.rotateX(s,s,-Vt(e)),Z.transformQuat(o,o,s),Z.normalize(o,o)}var UW={paint:new Tr({})};let $W={circle:class extends fa{constructor(t,e){super(t,CH,e)}createBucket(t){return new kT(t)}queryRadius(t){let e=t;return Gf("circle-radius",this,e)+Gf("circle-stroke-width",this,e)+$y(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,o,s,l,u,d){let f=G2(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),p=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return q2(t,o,l,u,d,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",f,p)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let n=W2(this);return{config:new ih(this,e),defines:n,overrideFog:!1}}},heatmap:class extends fa{createBucket(t){return new Y2(t)}constructor(t,e){super(t,LH,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Gf("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,o,s,l,u,d){let f=this.paint.get("heatmap-radius").evaluate(e,n);return q2(t,o,l,u,d,!0,!0,new X(0,0),f)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new ih(this,e),overrideFog:!1}:{}}},hillshade:class extends fa{constructor(t,e){super(t,kH,e)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends fa{constructor(t,e){super(t,XH,e)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new ih(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Xy(t)}queryRadius(){return $y(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,o,s,l){return!t.queryGeometry.isAboveHorizon&&j2(H2(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends fa{constructor(t,e){super(t,PW,e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new mg(t)}queryRadius(){return $y(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,o,s,l,u,d,f){let p=G2(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),g=this.paint.get("fill-extrusion-height").evaluate(e,n),_=this.paint.get("fill-extrusion-base").evaluate(e,n),v=[0,0],x=d&&l.elevation,b=l.elevation?l.elevation.exaggeration():1,T=t.tile.getBucket(this);if(x&&T instanceof mg){let O=T.centroidVertexArray,A=f+1;A<O.length&&(v[0]=O.geta_centroid_pos0(A),v[1]=O.geta_centroid_pos1(A))}if(v[0]===0&&v[1]===1)return!1;l.projection.name==="globe"&&(o=ZL([o],[new X(0,0),new X(ne,ne)],t.tileID.canonical).map(O=>O.polygon).flat());let E=x?d:null,[M,S]=function(O,A,R,F,k,N,B,H,G,Y,U){return O.projection.name==="globe"?function(Q,te,se,K,ee,de,pe,fe,be,Te,Me){let ge=[],Pe=[],et=Q.projection.upVectorScale(Me,Q.center.lat,Q.worldSize).metersToTile,tt=[0,0,0,1],lt=[0,0,0,1],ct=(Tt,zn,Dn,Gt)=>{Tt[0]=zn,Tt[1]=Dn,Tt[2]=Gt,Tt[3]=1},Ht=qL();se>0&&(se+=Ht),K+=Ht;for(let Tt of te){let zn=[],Dn=[];for(let Gt of Tt){let kt=Gt.x+ee.x,St=Gt.y+ee.y,Pn=Q.projection.projectTilePoint(kt,St,Me),Nn=Q.projection.upVector(Me,Gt.x,Gt.y),fn=se,Ri=K;if(pe){let Or=XL(kt,St,se,K,pe,fe,be,Te);fn+=Or.base,Ri+=Or.top}se!==0?ct(tt,Pn.x+Nn[0]*et*fn,Pn.y+Nn[1]*et*fn,Pn.z+Nn[2]*et*fn):ct(tt,Pn.x,Pn.y,Pn.z),ct(lt,Pn.x+Nn[0]*et*Ri,Pn.y+Nn[1]*et*Ri,Pn.z+Nn[2]*et*Ri),Z.transformMat4(tt,tt,de),Z.transformMat4(lt,lt,de),zn.push(new op(tt[0],tt[1],tt[2])),Dn.push(new op(lt[0],lt[1],lt[2]))}ge.push(zn),Pe.push(Dn)}return[ge,Pe]}(O,A,R,F,k,N,B,H,G,Y,U):B?function(Q,te,se,K,ee,de,pe,fe,be){let Te=[],Me=[],ge=[0,0,0,1];for(let Pe of Q){let et=[],tt=[];for(let lt of Pe){let ct=lt.x+K.x,Ht=lt.y+K.y,Tt=XL(ct,Ht,te,se,de,pe,fe,be);ge[0]=ct,ge[1]=Ht,ge[2]=Tt.base,ge[3]=1,Ei.transformMat4(ge,ge,ee),ge[3]=Math.max(ge[3],1e-5);let zn=new op(ge[0]/ge[3],ge[1]/ge[3],ge[2]/ge[3]);ge[0]=ct,ge[1]=Ht,ge[2]=Tt.top,ge[3]=1,Ei.transformMat4(ge,ge,ee),ge[3]=Math.max(ge[3],1e-5);let Dn=new op(ge[0]/ge[3],ge[1]/ge[3],ge[2]/ge[3]);et.push(zn),tt.push(Dn)}Te.push(et),Me.push(tt)}return[Te,Me]}(A,R,F,k,N,B,H,G,Y):function(Q,te,se,K,ee){let de=[],pe=[],fe=ee[8]*te,be=ee[9]*te,Te=ee[10]*te,Me=ee[11]*te,ge=ee[8]*se,Pe=ee[9]*se,et=ee[10]*se,tt=ee[11]*se;for(let lt of Q){let ct=[],Ht=[];for(let Tt of lt){let zn=Tt.x+K.x,Dn=Tt.y+K.y,Gt=ee[0]*zn+ee[4]*Dn+ee[12],kt=ee[1]*zn+ee[5]*Dn+ee[13],St=ee[2]*zn+ee[6]*Dn+ee[14],Pn=ee[3]*zn+ee[7]*Dn+ee[15],Nn=Gt+fe,fn=kt+be,Ri=St+Te,Or=Math.max(Pn+Me,1e-5),Mi=Gt+ge,Zi=kt+Pe,jr=St+et,Rr=Math.max(Pn+tt,1e-5);ct.push(new op(Nn/Or,fn/Or,Ri/Or)),Ht.push(new op(Mi/Rr,Zi/Rr,jr/Rr))}de.push(ct),pe.push(Ht)}return[de,pe]}(A,R,F,k,N)}(l,o,_,g,p,u,E,v,b,l.center.lat,t.tileID.canonical),P=t.queryGeometry;return function(O,A,R){let F=1/0;j2(R,A)&&(F=YL(R,A[0]));for(let k=0;k<A.length;k++){let N=A[k],B=O[k];for(let H=0;H<N.length-1;H++){let G=N[H],Y=[G,N[H+1],B[H+1],B[H],G];B2(R,Y)&&(F=Math.min(F,YL(R,Y)))}}return F!==1/0&&F}(M,S,P.isPointQuery()?P.screenBounds:P.screenGeometry)}},line:class extends fa{constructor(t,e){super(t,KL,e),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof aw,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=nF.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new vv(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let n=eF(this);return{config:new ih(this,e),defines:n,overrideFog:!1}}queryRadius(t){let e=t,n=iF(Gf("line-width",this,e),Gf("line-gap-width",this,e)),o=Gf("line-offset",this,e);return n/2+Math.abs(o)+$y(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,o,s,l){if(t.queryGeometry.isAboveHorizon)return!1;let u=H2(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),d=t.pixelToTileUnitsFactor/2*iF(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),f=this.paint.get("line-offset").evaluate(e,n);return f&&(o=function(p,g){let _=[],v=new X(0,0);for(let x=0;x<p.length;x++){let b=p[x],T=[];for(let E=0;E<b.length;E++){let M=b[E],S=b[E+1],P=E===0?v:M.sub(b[E-1])._unit()._perp(),O=E===b.length-1?v:S.sub(M)._unit()._perp(),A=P._add(O)._unit();A._mult(1/(A.x*O.x+A.y*O.y)),T.push(A._mult(g)._add(M))}_.push(T)}return _}(o,f*t.pixelToTileUnitsFactor)),function(p,g,_){for(let v=0;v<g.length;v++){let x=g[v];if(p.length>=3){for(let b=0;b<x.length;b++)if(qu(p,x[b]))return!0}if(TH(p,x,_))return!0}return!1}(u,o,d)}isTileClipped(){return!0}},symbol:fv,background:class extends fa{constructor(t,e){super(t,kW,e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends fa{constructor(t,e){super(t,zW,e),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof Ga)||!t._source.onNorthPole&&!t._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;let t=this._transitionablePaint._values["raster-color"].value.expression,[e,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Hy({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends fa{constructor(t,e){super(t,VW,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Hy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),s=!o,l=t.style.light,u=l.properties.get("position");return s&&l.properties.get("anchor")==="viewport"&&J("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?bE(u.azimuthal,90-u.polar,e):bE(o[0],90-o[1],e)}let n=this.paint.get("sky-gradient-center");return bE(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends fa{constructor(t,e){super(t,UW)}},model:class extends fa{constructor(t,e){super(t,gW,e)}createBucket(t){return new IL(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ru}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function Pv(t,e){return t.type==="custom"?new BW(t):new $W[t.type](t,e)}function HW(t){let{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class GW extends vn{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new qr({width:1,height:1})}isLoaded(){for(let e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,n){if(this.loaded[n]!==e&&(this.loaded[n]=e,e)){for(let{ids:o,callback:s}of this.requestors)this._notify(o,n,s);this.requestors=[]}}hasImage(e,n){return!!this.getImage(e,n)}getImage(e,n){return this.images[n][e]}addImage(e,n,o){this._validate(e,o)&&(this.images[n][e]=o)}_validate(e,n){let o=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new Je(new Error(`Image "${e}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new Je(new Error(`Image "${e}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new Je(new Error(`Image "${e}" has invalid "content" value`))),o=!1),o}_validateStretch(e,n){if(!e)return!0;let o=0;for(let s of e){if(s[0]<o||s[1]<s[0]||n<s[1])return!1;o=s[1]}return!0}_validateContent(e,n){return!(e&&(e.length!==4||e[0]<0||n.data.width<e[0]||e[1]<0||n.data.height<e[1]||e[2]<0||n.data.width<e[2]||e[3]<0||n.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,n,o){o.version=this.images[n][e].version+1,this.images[n][e]=o,this.updatedImages[n][e]=!0}removeImage(e,n){let o=this.images[n][e];delete this.images[n][e],delete this.patterns[n][e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,n,o){let s=!0,l=!!this.loaded[n];if(!l)for(let u of e)this.images[n][u]||(s=!1);l||s?this._notify(e,n,o):this.requestors.push({ids:e,scope:n,callback:o})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,n,o){let s={};for(let l of e){this.images[n][l]||this.fire(new Se("styleimagemissing",{id:l}));let u=this.images[n][l];u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:J(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,s)}getPixelSize(e){let{width:n,height:o}=this.atlasImage[e];return{width:n,height:o}}getPattern(e,n){let o=this.patterns[n][e],s=this.getImage(e,n);if(!s)return null;if(o&&o.position.version===s.version)return o.position;if(o)o.position.version=s.version;else{let l={w:s.data.width+2,h:s.data.height+2,x:0,y:0},u=new tE(l,s);this.patterns[n][e]={bin:l,position:u}}return this._updatePatternAtlas(n),this.patterns[n][e].position}bind(e,n){let o=e.gl,s=this.atlasTexture[n];s?this.dirty&&(s.update(this.atlasImage[n]),this.dirty=!1):(s=new fr(e,this.atlasImage[n],o.RGBA),this.atlasTexture[n]=s),s.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(e){let n=[];for(let u in this.patterns[e])n.push(this.patterns[e][u].bin);let{w:o,h:s}=eE(n),l=this.atlasImage[e];l.resize({width:o||1,height:s||1});for(let u in this.patterns[e]){let{bin:d}=this.patterns[e][u],f=d.x+1,p=d.y+1,g=this.images[e][u].data,_=g.width,v=g.height;qr.copy(g,l,{x:0,y:0},{x:f,y:p},{width:_,height:v}),qr.copy(g,l,{x:0,y:v-1},{x:f,y:p-1},{width:_,height:1}),qr.copy(g,l,{x:0,y:0},{x:f,y:p+v},{width:_,height:1}),qr.copy(g,l,{x:_-1,y:0},{x:f-1,y:p},{width:1,height:v}),qr.copy(g,l,{x:0,y:0},{x:f+_,y:p},{width:1,height:v})}this.dirty=!0}beginFrame(){for(let e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,n){for(let o of e){if(this.callbackDispatchedThisFrame[n][o])continue;this.callbackDispatchedThisFrame[n][o]=!0;let s=this.images[n][o];HW(s)&&this.updateImage(o,n,s)}}}let WW=new Tr({anchor:new je(q.light.anchor),position:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return it(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Yt(t.x,e.x,n),y:Yt(t.y,e.y,n),z:Yt(t.z,e.z,n),azimuthal:Yt(t.azimuthal,e.azimuthal,n),polar:Yt(t.polar,e.polar,n)}}}(q.light.position),color:new je(q.light.color),intensity:new je(q.light.intensity)});class oF extends vn{constructor(e,n="flat"){super(),this._transitionable=new km(WW),this.setLight(e,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n,o={}){this._validate(m6,e,o)||(this._transitionable.setTransitionOrValue(e),this.id=n)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,o){return(!o||o.validate!==!1)&&yy(this,e.call(Rf,Ne({value:n,style:{glyphs:!0,sprite:!0},styleSpec:q})))}}let qW=new Tr({source:new je(q.terrain.source),exaggeration:new je(q.terrain.exaggeration)}),ZW=class extends vn{constructor(t,e,n,o){super(),this.scope=n,this._transitionable=new km(qW,o),this._transitionable.setTransitionOrValue(t,o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=e}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new ur(t)).get("exaggeration")}isZoomDependent(){let t=this._transitionable._values.exaggeration;return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Ru}},sF=45,aF=65,dh=.05;function Ov(t,e,n,o){let s=Si(sF,aF,n),[l,u]=lF(t,o),d=1-Math.min(1,Math.exp((e-l)/(u-l)*-6));return d*=d*d,d=Math.min(1,1.00747*d),d*s*t.alpha}function lF(t,e){let n=.5/Math.tan(.5*e);return[t.range[0]+n,t.range[1]+n]}function cF(t,e,n,o,s){let l=Z.transformMat4([],[e,n,o],s.mercatorFogMatrix);return Ov(t,Z.length(l),s.pitch,s._fov)}function uF(t,e,n,o,s,l,u){let d=[[n,o,0],[s,o,0],[s,l,0],[n,l,0]],f=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let g of d){let _=Z.transformMat4([],g,e),v=Z.length(_);f=Math.min(f,v),p=Math.max(p,v)}return[Ov(t,f,u.pitch,u._fov),Ov(t,p,u.pitch,u._fov)]}let YW=new Tr({range:new je(q.fog.range),color:new je(q.fog.color),"high-color":new je(q.fog["high-color"]),"space-color":new je(q.fog["space-color"]),"horizon-blend":new je(q.fog["horizon-blend"]),"star-intensity":new je(q.fog["star-intensity"]),"vertical-range":new je(q.fog["vertical-range"])});class XW extends vn{constructor(e,n){super(),this._transitionable=new km(YW),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){let e=this._transform,n=e.projection.name==="globe",o=Do(e.zoom),s=this.properties.get("range"),l=[.5,3];return{range:n?[Yt(l[0],s[0],o),Yt(l[1],s[1],o)]:s,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,n={}){if(this._validate(y6,e,n))return;let o=Ne({},e);for(let s of Object.keys(q.fog))o[s]===void 0&&(o[s]=q.fog[s].default);this._transitionable.setTransitionOrValue(o)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;let n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:Si(sF,aF,e))*n.a}getOpacityAtLatLng(e,n){return this._transform.projection.supportsFog?function(o,s,l){let u=Fn.fromLngLat(s),d=l.elevation?l.elevation.getAtPointOrZero(u):0;return cF(o,u.x,u.y,d,l)}(this.state,e,n):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];let n=this._transform.calculateFogTileMatrix(e.toUnwrapped());return uF(this.state,n,0,0,ne,ne,this._transform)}getOpacityForBounds(e,n,o,s,l){return this._transform.projection.supportsFog?uF(this.state,e,n,o,s,l,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?lF(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;let n=[4,5,6,7];for(let o of n){let s=e.points[o],l;if(s[2]>=0)l=s;else{let u=e.points[o-4];l=NA(u,s,u[2]/(u[2]-s[2]))}if(cF(this.state,l[0],l[1],0,this._transform)>=dh)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,o){return(!o||o.validate!==!1)&&yy(this,e.call(Rf,Ne({value:n,style:{glyphs:!0,sprite:!0},styleSpec:q})))}}class KW{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class JW{constructor(){this.tasks={},this.taskQueue=[],gr(["process"],this),this.invoker=new KW(this.process),this.nextId=0}add(e,n){let o=this.nextId++,s=function({type:l,isSymbolTile:u,zoom:d}){return d=d||0,l==="message"?0:l!=="maybePrepare"||u?l!=="parseTile"||u?l==="parseTile"&&u?300-d:l==="maybePrepare"&&u?400-d:500:200-d:100-d}(n);if(s===0){Re();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:n,priority:s,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Re();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let s=0;s<this.taskQueue.length;s++){let l=this.tasks[this.taskQueue[s]];l.priority<n&&(n=l.priority,e=s)}if(e===null)return null;let o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class dF{constructor(e,n,o){this.target=e,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},gr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new JW}send(e,n,o,s,l=!1,u){let d=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=u,this.callbacks[d]=o);let f=new Set;return this.target.postMessage({id:d,type:e,hasCallback:!!o,targetMapId:s,mustQueue:l,sourceMapId:this.mapId,data:Ff(n,f)},f),{cancel:()=>{o&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){let n=e.data,o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let s=this.cancelCallbacks[o];delete this.cancelCallbacks[o],s&&s.cancel()}else if(n.mustQueue||Re()){let s=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,n),s&&s.metadata||{type:"message"})}else this.processTask(o,n)}processTask(e,n){if(n.type==="<response>"){let o=this.callbacks[e];delete this.callbacks[e],o&&(n.error?o(kf(n.error)):o(null,kf(n.data)))}else{let o=new Set,s=n.hasCallback?(u,d)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:u?Ff(u):null,data:Ff(d,o)},o)}:u=>{},l=kf(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,l,s);else if(this.parent.getWorkerSource){let u=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,u[0],l.source,l.scope)[u[1]](l,s)}else s(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Rv=(()=>{class t{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=pi();let s=this.workerPool.acquire(this.id);for(let l=0;l<s.length;l++){let u=new t.Actor(s[l],o,this.id);u.name=`Worker ${l}`,this.actors.push(u)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,s){Ji(this.actors,(l,u)=>{l.send(n,o,u)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=dF,t})();class hF extends vn{constructor(e,n,o,s){super(),this.scope=o,this._options=e,this.properties=new Nm(n),this._transitionable=new km(n,new Map(s)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,n){this._options=e,this._transitionable.setTransitionOrValue(e.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let QW=new Tr({color:new je(q.properties_light_ambient.color),intensity:new je(q.properties_light_ambient.intensity)}),eq=new Tr({direction:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,o]){let s=it([1,n,o]);return{x:s.x,y:s.y,z:s.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Yt(t.x,e.x,n),y:Yt(t.y,e.y,n),z:Yt(t.z,e.z,n)}}}(q.properties_light_directional.direction),color:new je(q.properties_light_directional.color),intensity:new je(q.properties_light_directional.intensity),"cast-shadows":new je(q.properties_light_directional["cast-shadows"]),"shadow-intensity":new je(q.properties_light_directional["shadow-intensity"])});class wE{constructor(e,n,o,s){this.screenBounds=e,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,s)}static createFromScreenPoints(e,n){let o,s;if(e instanceof X||typeof e[0]=="number"){let l=X.convert(e);o=[l],s=n.isPointAboveHorizon(l)}else{let l=X.convert(e[0]),u=X.convert(e[1]);o=[l,u],s=Pt(l,u).every(d=>n.isPointAboveHorizon(d))}return new wE(o,n.getCameraPoint(),s,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(e){return Pt(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){let n=this.screenBounds[0],o=this.screenBounds.length===1?this.screenBounds[0].add(new X(1,1)):this.screenBounds[1],s=Pt(n,o,0,!1);return this.cameraPoint.y>o.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<o.x?s.splice(3,0,this.cameraPoint):this.cameraPoint.x>=o.x?s[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(s[3]=this.cameraPoint)),function(l,u){let d=[];for(let f=0;f<l.length;f++){let p=bi(f-1,-1,l.length-1),g=bi(f+1,-1,l.length-1),_=l[f],v=l[g],x=l[p].sub(_).unit(),b=v.sub(_).unit(),T=b.angleWithSep(x.x,x.y),E=x.add(b).unit().mult(-1*u/Math.sin(T/2));d.push(_.add(E))}return d}(s,e)}bufferedCameraGeometryGlobe(e){let n=this.screenBounds[0],o=this.screenBounds.length===1?this.screenBounds[0].add(new X(1,1)):this.screenBounds[1],s=Pt(n,o,e),l=this.cameraPoint.clone();switch(3*((l.y>n.y)+(l.y>o.y))+((l.x>n.x)+(l.x>o.x))){case 0:s[0]=l,s[4]=l.clone();break;case 1:s.splice(1,0,l);break;case 2:s[1]=l;break;case 3:s.splice(4,0,l);break;case 5:s.splice(2,0,l);break;case 6:s[3]=l;break;case 7:s.splice(3,0,l);break;case 8:s[2]=l}return s}containsTile(e,n,o,s=0){let l=e.queryPadding/n._pixelsPerMercatorPixel+1,u=o?this._bufferedCameraMercator(l,n):this._bufferedScreenMercator(l,n),d=e.tileID.wrap+(u.unwrapped?s:0),f=u.polygon.map(E=>GR(e.tileTransform,E,d));if(!$2(f,0,0,ne,ne))return;d=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?s:0);let p=this.screenGeometryMercator.polygon.map(E=>WR(e.tileTransform,E,d)),g=p.map(E=>new X(E[0],E[1])),_=n.getFreeCameraOptions().position||new Fn(0,0,0),v=WR(e.tileTransform,_,d),x=p.map(E=>{let M=Z.sub(E,E,v);return Z.normalize(M,M),new Fy(v,M)}),b=lh(e,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:g,tilespaceRays:x,bufferedTilespaceGeometry:f,bufferedTilespaceBounds:(T=Oa(f),T.min.x=ze(T.min.x,0,ne),T.min.y=ze(T.min.y,0,ne),T.max.x=ze(T.max.x,0,ne),T.max.y=ze(T.max.y,0,ne),T),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:b};var T}_bufferedScreenMercator(e,n){let o=fF(e);if(this._screenRaycastCache[o])return this._screenRaycastCache[o];{let s;return s=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(e),n):{polygon:this.bufferedScreenGeometry(e).map(l=>n.pointCoordinate3D(l)),unwrapped:!0},this._screenRaycastCache[o]=s,s}}_bufferedCameraMercator(e,n){let o=fF(e);if(this._cameraRaycastCache[o])return this._cameraRaycastCache[o];{let s;return s=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),n):{polygon:this.bufferedCameraGeometry(e).map(l=>n.pointCoordinate3D(l)),unwrapped:!0},this._cameraRaycastCache[o]=s,s}}_projectAndResample(e,n){let o=function(l,u){let d=ae.multiply([],u.pixelMatrix,u.globeMatrix),f=[0,-gs,0,1],p=[0,gs,0,1],g=[0,0,0,1];Ei.transformMat4(f,f,d),Ei.transformMat4(p,p,d),Ei.transformMat4(g,g,d);let _=new X(f[0]/f[3],f[1]/f[3]),v=new X(p[0]/p[3],p[1]/p[3]),x=qu(l,_)&&f[3]<g[3],b=qu(l,v)&&p[3]<g[3];if(!x&&!b)return null;let T=function(F,k,N){for(let B=1;B<F.length;B++){let H=_g(k.pointCoordinate3D(F[B-1]).x),G=_g(k.pointCoordinate3D(F[B]).x);if(N<0){if(H<G)return{idx:B,t:-H/(G-1-H)}}else if(G<H)return{idx:B,t:(1-H)/(G+1-H)}}return null}(l,u,x?-1:1);if(!T)return null;let{idx:E,t:M}=T,S=E>1?TE(l.slice(0,E),u):[],P=E<l.length?TE(l.slice(E),u):[];S=S.map(F=>new X(_g(F.x),F.y)),P=P.map(F=>new X(_g(F.x),F.y));let O=[...S];O.length===0&&O.push(P[P.length-1]);let A=Yt(O[O.length-1].y,(P.length===0?S[0]:P[0]).y,M),R;return R=x?[new X(0,A),new X(0,0),new X(1,0),new X(1,A)]:[new X(1,A),new X(1,1),new X(0,1),new X(0,A)],O.push(...R),P.length===0?O.push(S[0]):O.push(...P),{polygon:O.map(F=>new Fn(F.x,F.y)),unwrapped:!1}}(e,n);if(o)return o;let s=function(l,u){let d=!1,f=-1/0,p=0;for(let _=0;_<l.length-1;_++)l[_].x>f&&(f=l[_].x,p=_);for(let _=0;_<l.length-1;_++){let v=(p+_)%(l.length-1),x=l[v],b=l[v+1];Math.abs(x.x-b.x)>.5&&(x.x<b.x?(x.x+=1,v===0&&(l[l.length-1].x+=1)):(b.x+=1,v+1===l.length-1&&(l[0].x+=1)),d=!0)}let g=ao(u.center.lng);return d&&g<Math.abs(g-1)&&l.forEach(_=>{_.x-=1}),{polygon:l,unwrapped:d}}(TE(e,n).map(l=>new X(_g(l.x),l.y)),n);return{polygon:s.polygon.map(l=>new Fn(l.x,l.y)),unwrapped:s.unwrapped}}}function TE(t,e){return N2(t,n=>{let o=e.pointCoordinate3D(n);n.x=o.x,n.y=o.y},1/256)}function _g(t){return t<0?1+t%1:t%1}function fF(t){return 100*t|0}function EE(t,e,n,o,s){let l=function(u,d){if(u)return s(u);if(d){t.url&&d.tiles&&t.tiles&&delete t.tiles;let f=wo(Ne(d,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(f.vectorLayers=d.vector_layers,f.vectorLayerIds=f.vectorLayers.map(p=>p.id)),f.tiles=e.canonicalizeTileset(f,t.url),s(null,f)}};return t.url?Ge(e.transformRequest(e.normalizeSourceURL(t.url,null,n,o),ve.Source),l):Zt.frame(()=>l(null,t))}class Lv{constructor(e,n,o){this.bounds=Gs.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let n=Math.pow(2,e.z),o=Math.floor(ao(this.bounds.getWest())*n),s=Math.floor(po(this.bounds.getNorth())*n),l=Math.ceil(ao(this.bounds.getEast())*n),u=Math.ceil(po(this.bounds.getSouth())*n);return e.x>=o&&e.x<l&&e.y>=s&&e.y<u}}class pF{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Hc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let o=this.getKey(e,n);return this.positions[o]}trim(){let e=this.width,n=this.height=io(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){let s=[],l=e.length%2==1?-e[e.length-1]*o:0,u=e[0]*o,d=!0;s.push({left:l,right:u,isDash:d,zeroLength:e[0]===0});let f=e[0];for(let p=1;p<e.length;p++){d=!d;let g=e[p];l=f*o,f+=g,u=f*o,s.push({left:l,right:u,isDash:d,zeroLength:g===0})}return s}addRoundDash(e,n,o){let s=n/2;for(let l=-o;l<=o;l++){let u=this.width*(this.nextRow+o+l),d=0,f=e[d];for(let p=0;p<this.width;p++){p/f.right>1&&(f=e[++d]);let g=Math.abs(p-f.left),_=Math.abs(p-f.right),v=Math.min(g,_),x,b=l/o*(s+1);if(f.isDash){let T=s-Math.abs(b);x=Math.sqrt(v*v+T*T)}else x=s-Math.sqrt(v*v+b*b);this.image.data[u+p]=Math.max(0,Math.min(255,x+128))}}}addRegularDash(e,n){for(let f=e.length-1;f>=0;--f){let p=e[f],g=e[f+1];p.zeroLength?e.splice(f,1):g&&g.isDash===p.isDash&&(g.left=p.left,e.splice(f,1))}let o=e[0],s=e[e.length-1];o.isDash===s.isDash&&(o.left=s.left-this.width,s.right=o.right+this.width);let l=this.width*this.nextRow,u=0,d=e[u];for(let f=0;f<this.width;f++){f/d.right>1&&(d=e[++u]);let p=Math.abs(f-d.left),g=Math.abs(f-d.right),_=Math.min(p,g);this.image.data[l+f]=Math.max(0,Math.min(255,(d.isDash?_:-_)+n+128))}}addDash(e,n){let o=this.getKey(e,n);if(this.positions[o])return this.positions[o];let s=n==="round",l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return J("LineAtlas out of space"),null;e.length===0&&e.push(1);let d=0;for(let g=0;g<e.length;g++)e[g]<0&&(J("Negative value is found in line dasharray, replacing values with 0"),e[g]=0),d+=e[g];if(d!==0){let g=this.width/d,_=this.getDashRanges(e,this.width,g);s?this.addRoundDash(_,g,l):this.addRegularDash(_,n==="square"?.5*g:0)}let f=this.nextRow+l;this.nextRow+=u;let p={tl:[f,l],br:[d,0]};return this.positions[o]=p,p}}pt(pF,"LineAtlas");let mF=1*gl;class gF{constructor(e){let n={},o=[];for(let d in e){let f=e[d],p=n[d]={};for(let g in f.glyphs){let _=f.glyphs[+g];if(!_||_.bitmap.width===0||_.bitmap.height===0)continue;let v=_.metrics.localGlyph?mF:1,x={x:0,y:0,w:_.bitmap.width+2*v,h:_.bitmap.height+2*v};o.push(x),p[g]=x}}let{w:s,h:l}=eE(o),u=new Hc({width:s||1,height:l||1});for(let d in e){let f=e[d];for(let p in f.glyphs){let g=f.glyphs[+p];if(!g||g.bitmap.width===0||g.bitmap.height===0)continue;let _=n[d][p],v=g.metrics.localGlyph?mF:1;Hc.copy(g.bitmap,u,{x:0,y:0},{x:_.x+v,y:_.y+v},g.bitmap)}}this.image=u,this.positions=n}}pt(gF,"GlyphAtlas");class tq{constructor(e){this.tileID=new qn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ah(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,n,o,s,l){this.status="parsing",this.data=e,this.collisionBoxArray=new nT;let u=new sR(Object.keys(e.layers).sort()),d=new XT(this.tileID,this.promoteId);d.bucketLayerIDs=[];let f={},p=new pF(256,256),g={featureIndex:d,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:p,availableImages:o,brightness:this.brightness},_=n.familiesBySource[this.source];for(let S in _){let P=e.layers[S];if(!P)continue;let O=!1,A=!1,R=!1;for(let N of _[S])N[0].type==="symbol"?O=!0:A=!0,N[0].is3D()&&N[0].type!=="model"&&(R=!0);if(this.extraShadowCaster&&!R||this.isSymbolTile===!0&&!O||this.isSymbolTile===!1&&!A)continue;P.version===1&&J(`Vector tile source "${this.source}" layer "${S}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let F=u.encode(S),k=[];for(let N=0;N<P.length;N++){let B=P.feature(N),H=d.getId(B,S);k.push({feature:B,id:H,index:N,sourceLayerIndex:F})}for(let N of _[S]){let B=N[0];(!this.extraShadowCaster||B.is3D()&&B.type!=="model")&&(this.isSymbolTile!==void 0&&B.type==="symbol"!==this.isSymbolTile||B.minzoom&&this.zoom<Math.floor(B.minzoom)||B.maxzoom&&this.zoom>=B.maxzoom||B.visibility!=="none"&&(ME(N,this.zoom,g.brightness,o),(f[B.id]=B.createBucket({index:d.bucketLayerIDs.length,layers:N,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:F,sourceID:this.source,projection:this.projection.spec})).populate(k,g,this.tileID.canonical,this.tileTransform),d.bucketLayerIDs.push(N.map(H=>H.id))))}}let v,x,b,T;p.trim();let E={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},M=()=>{if(v)return this.status="done",l(v);if(this.extraShadowCaster)this.status="done",l(null,{buckets:wr(f).filter(S=>!S.isEmpty()),featureIndex:d,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:g.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(x&&b&&T){let S=new gF(x),P=new kR(b,T);for(let O in f){let A=f[O];A instanceof ag?(ME(A.layers,this.zoom,g.brightness,o),KG(A,x,S.positions,b,P.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):A.hasPattern&&(A instanceof vv||A instanceof Xy||A instanceof mg)&&(ME(A.layers,this.zoom,g.brightness,o),A.addFeatures(g,this.tileID.canonical,P.patternPositions,o,this.tileTransform,this.brightness))}this.status="done",l(null,{buckets:wr(f).filter(O=>!O.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:S.image,lineAtlas:p,imageAtlas:P,brightness:g.brightness})}};if(!this.extraShadowCaster){let S=nl(g.glyphDependencies,A=>Object.keys(A).map(Number));Object.keys(S).length?s.send("getGlyphs",{uid:this.uid,stacks:S,scope:this.scope},(A,R)=>{v||(v=A,x=R,M())},void 0,!1,E):x={};let P=Object.keys(g.iconDependencies);P.length?s.send("getImages",{icons:P,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(A,R)=>{v||(v=A,b=R,M())},void 0,!1,E):b={};let O=Object.keys(g.patternDependencies);O.length?s.send("getImages",{icons:O,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(A,R)=>{v||(v=A,T=R,M())},void 0,!1,E):T={}}M()}}function ME(t,e,n,o){let s=new ur(e,{brightness:n});for(let l of t)l.recalculate(s,o)}class _F{constructor(e){this.entries={},this.scheduler=e}request(e,n,o,s){let l=this.entries[e]=this.entries[e]||{callbacks:[]};if(l.result){let[u,d]=l.result;return this.scheduler?this.scheduler.add(()=>{s(u,d)},n):s(u,d),()=>{}}return l.callbacks.push(s),l.cancel||(l.cancel=o((u,d)=>{l.result=[u,d];for(let f of l.callbacks)this.scheduler?this.scheduler.add(()=>{f(u,d)},n):f(u,d);setTimeout(()=>delete this.entries[e],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(u=>u!==s),l.callbacks.length||(l.cancel(),delete this.entries[e]))}}}function yF(t,e,n){let o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},s=>{let l=Qe(t.request,(u,d,f,p)=>{u?s(u):d&&s(null,{vectorTile:n?void 0:new ZT(new nv(d)),rawData:d,cacheControl:f,expires:p})});return()=>{l.cancel(),s()}},e)}class vF extends vn{constructor(e,n,o,s){if(super(),this.id=e,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Ne(this,wo(n,["url","scheme","tileSize","promoteId"])),this._options=Ne({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s),this._tileWorkers={},this._deduped=new _F}load(e){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"}));let n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=EE(this._options,this.map._requestManager,n,o,(s,l)=>{this._tileJSONRequest=null,this._loaded=!0,s?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new Je(s))):l&&(Ne(this,l),l.bounds&&(this.tileBounds=new Lv(l.bounds,this.minzoom,this.maxzoom)),zl(l.tiles,this.map._requestManager._customAccessToken),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),e&&e(s)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();let e=os(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Ne({},this._options)}loadTile(e,n){let o=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),s={request:this.map._requestManager.transformRequest(o,ve.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:Zt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(s.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired")e.state==="loading"?e.reloadCallback=n:e.request=e.actor.send("reloadTile",s,l.bind(this));else if(e.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",s,l.bind(this),void 0,!0);else{let u=yF.call({deduped:this._deduped},s,(d,f)=>{d||!f?l.call(this,d):(s.data={cacheControl:f.cacheControl,expires:f.expires,rawData:f.rawData.slice(0)},e.actor&&e.actor.send("loadTile",s,l.bind(this),void 0,!0))},!0);e.request={cancel:u}}function l(u,d){return delete e.request,e.aborted?n(null):u&&u.status!==404?n(u):(d&&d.resourceTiming&&(e.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&d&&e.setExpiryData(d),e.loadVectorData(d,this.map.painter),ko(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class IE extends vn{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Ne({type:"raster"},n),Ne(this,wo(n,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"})),this._tileJSONRequest=EE(this._options,this.map._requestManager,null,null,(n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new Je(n)):o&&(Ne(this,o),o.bounds&&(this.tileBounds=new Lv(o.bounds,this.minzoom,this.maxzoom)),zl(o.tiles),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();let e=os(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Ne({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,n){let o=Zt.devicePixelRatio>=2,s=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),o,this.tileSize);e.request=Ft(this.map._requestManager.transformRequest(s,ve.Tile),(l,u,d,f)=>(delete e.request,e.aborted?(e.state="unloaded",n(null)):l?(e.state="errored",n(l)):u?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:d,expires:f}),e.setTexture(u,this.map.painter),e.state="loaded",ko(this.dispatcher),void n(null)):n(null)))}abortTile(e,n){e.request&&(e.request.cancel(),delete e.request),n()}unloadTile(e,n){e.texture&&e.texture instanceof fr?(e.destroy(!0),e.texture&&e.texture instanceof fr&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function nq(){return i0.workerClass!=null?new i0.workerClass:new y.Worker(i0.workerUrl)}let CE="mapboxgl_preloaded_worker_pool";class sp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<sp.workerCount;)this.workers.push(new nq);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[CE]}numActive(){return Object.keys(this.active).length}}let yg;function vg(){return yg||(yg=new sp),yg}sp.workerCount=2;let Fv,SE,vl,DE=null;function xF(){return Re()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:SE||D.DRACO_URL}let AE=5123,PE=5126,OE={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[AE]:Uint16Array,5125:Uint32Array,[PE]:Float32Array},iq={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[AE]:"DT_UINT16",5125:"DT_UINT32",[PE]:"DT_FLOAT32"},RE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function bF(t,e,n){let o=n.json.bufferViews.length,s=n.buffers.length;e.bufferView=o,n.json.bufferViews[o]={buffer:s,byteLength:t.byteLength},n.buffers[s]=t}let LE="KHR_draco_mesh_compression";function rq(t,e){let n=t.extensions&&t.extensions[LE];if(!n)return;let o=new vl.Decoder,s=MF(e,n.bufferView),l=new vl.Mesh;if(!o.DecodeArrayToMesh(s,s.byteLength,l))throw new Error("Failed to decode Draco mesh");let u=e.json.accessors[t.indices],d=OE[u.componentType],f=u.count*d.BYTES_PER_ELEMENT,p=vl._malloc(f);d===Uint16Array?o.GetTrianglesUInt16Array(l,f,p):o.GetTrianglesUInt32Array(l,f,p),bF(vl.memory.buffer.slice(p,p+f),u,e),vl._free(p);for(let g of Object.keys(n.attributes)){let _=o.GetAttributeByUniqueId(l,n.attributes[g]),v=e.json.accessors[t.attributes[g]],x=iq[v.componentType],b=v.count*RE[v.type]*OE[v.componentType].BYTES_PER_ELEMENT,T=vl._malloc(b);o.GetAttributeDataArrayForAllPoints(l,_,vl[x],b,T),bF(vl.memory.buffer.slice(T,T+b),v,e),vl._free(T)}o.destroy(),l.destroy(),delete t.extensions[LE]}let wF=1179937895,TF=new TextDecoder("utf8");function EF(t,e){return new URL(t,e).href}function oq(t,e,n,o){return fetch(EF(t.uri,o)).then(s=>s.arrayBuffer()).then(s=>{e.buffers[n]=s})}function MF(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function sq(t,e,n,o){if(t.uri){let s=EF(t.uri,o);return fetch(s).then(l=>l.blob()).then(l=>y.createImageBitmap(l)).then(l=>{e.images[n]=l})}if(t.bufferView!==void 0){let s=MF(e,t.bufferView),l=new y.Blob([s],{type:t.mimeType});return y.createImageBitmap(l).then(u=>{e.images[n]=u})}}function IF(t,e=0,n){let o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===wF){let p=new Uint32Array(t,e),g=2,_=(p[g++]>>2)-3,v=p[g++]>>2;if(g++,o.json=JSON.parse(TF.decode(p.subarray(g,g+v))),g+=v,g<_){let x=p[g++];g++;let b=e+(g<<2);o.buffers[0]=t.slice(b,b+x)}}else o.json=JSON.parse(TF.decode(new Uint8Array(t,e)));let{buffers:s,images:l,meshes:u,extensionsUsed:d}=o.json,f=Promise.resolve();if(s){let p=[];for(let g=0;g<s.length;g++){let _=s[g];_.uri?p.push(oq(_,o,g,n)):o.buffers[g]||(o.buffers[g]=null)}f=Promise.all(p)}return f.then(()=>{let p=[],g=d&&d.includes(LE);if(g&&p.push(function(){if(!vl)return Fv||(Fv=function(_){let v,x=null;function b(){v=new Uint8Array(x.buffer)}function T(){throw new Error("Unexpected Draco error.")}let E={a:{a:T,d:function(M,S,P){return v.copyWithin(M,S,S+P)},c:function(M){let S=v.length,P=Math.max(M>>>0,Math.ceil(1.2*S)),O=Math.ceil((P-S)/65536);try{return x.grow(O),b(),!0}catch{return!1}},b:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(_,E):_.then(M=>M.arrayBuffer()).then(M=>WebAssembly.instantiate(M,E))).then(M=>{let{Rb:S,Qb:P,P:O,T:A,X:R,Ja:F,La:k,Qa:N,Va:B,Wa:H,eb:G,jb:Y,f:U,e:Q,yb:te,zb:se,Ab:K,Bb:ee,Db:de,Gb:pe}=M.instance.exports;x=Q;let fe=(()=>{let be=0,Te=0,Me=0,ge=0;return Pe=>{Me&&(S(ge),S(be),Te+=Me,Me=be=0),be||(Te+=128,be=P(Te));let et=Pe.length+7&-8,tt=be;et>=Te&&(Me=et,tt=ge=P(et));for(let lt=0;lt<Pe.length;lt++)v[tt+lt]=Pe[lt];return tt}})();return b(),U(),{memory:Q,_free:S,_malloc:P,Mesh:class{constructor(){this.ptr=O()}destroy(){A(this.ptr)}},Decoder:class{constructor(){this.ptr=F()}destroy(){Y(this.ptr)}DecodeArrayToMesh(be,Te,Me){let ge=fe(be),Pe=k(this.ptr,ge,Te,Me.ptr);return!!R(Pe)}GetAttributeByUniqueId(be,Te){return{ptr:N(this.ptr,be.ptr,Te)}}GetTrianglesUInt16Array(be,Te,Me){B(this.ptr,be.ptr,Te,Me)}GetTrianglesUInt32Array(be,Te,Me){H(this.ptr,be.ptr,Te,Me)}GetAttributeDataArrayForAllPoints(be,Te,Me,ge,Pe){G(this.ptr,be.ptr,Te.ptr,Me,ge,Pe)}},DT_INT8:te(),DT_UINT8:se(),DT_INT16:K(),DT_UINT16:ee(),DT_UINT32:de(),DT_FLOAT32:pe()}})}(fetch(xF())),Fv.then(_=>{vl=_,Fv=void 0}))}()),l)for(let _=0;_<l.length;_++)p.push(sq(l[_],o,_,n));return(p.length?Promise.all(p):Promise.resolve()).then(()=>{if(g&&u)for(let{primitives:_}of u)for(let v of _)rq(v,o);return o})})}function CF(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>IF(e,0,t))}class SF{constructor(e,n,o){if(this.triangleCount=n.length/3,this.min=new X(0,0),this.max=new X(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||o===0)return;let s=e.map(g=>g.x),l=e.map(g=>g.y);this.min=new X(Math.min(...s),Math.min(...l)),this.max=new X(Math.max(...s),Math.max(...l));let u=this.max.sub(this.min);u.x=Math.max(u.x,1),u.y=Math.max(u.y,1);let d=Math.max(u.x,u.y)/o;this.cellsX=Math.max(1,Math.ceil(u.x/d)),this.cellsY=Math.max(1,Math.ceil(u.y/d)),this.xScale=1/d,this.yScale=1/d;let f=[];for(let g=0;g<this.triangleCount;g++){let _=e[n[3*g+0]].sub(this.min),v=e[n[3*g+1]].sub(this.min),x=e[n[3*g+2]].sub(this.min),b=td(Math.floor(Math.min(_.x,v.x,x.x)),this.xScale,this.cellsX),T=td(Math.floor(Math.max(_.x,v.x,x.x)),this.xScale,this.cellsX),E=td(Math.floor(Math.min(_.y,v.y,x.y)),this.yScale,this.cellsY),M=td(Math.floor(Math.max(_.y,v.y,x.y)),this.yScale,this.cellsY),S=new X(0,0),P=new X(0,0),O=new X(0,0),A=new X(0,0);for(let R=E;R<=M;++R){S.y=P.y=R*d,O.y=A.y=(R+1)*d;for(let F=b;F<=T;++F)S.x=O.x=F*d,P.x=A.x=(F+1)*d,(BT(_,v,x,S,P,A)||BT(_,v,x,S,A,O))&&f.push({cellIdx:R*this.cellsX+F,triIdx:g})}}if(f.length===0)return;f.sort((g,_)=>g.cellIdx-_.cellIdx||g.triIdx-_.triIdx);let p=0;for(;p<f.length;){let g=f[p].cellIdx,_={start:this.payload.length,len:0};for(;p<f.length&&f[p].cellIdx===g;)++_.len,this.payload.push(f[p++].triIdx);this.cells[g]=_}}query(e,n,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let f=0;f<this.lookup.length;f++)this.lookup[f]=0;let s=td(e.x-this.min.x,this.xScale,this.cellsX),l=td(n.x-this.min.x,this.xScale,this.cellsX),u=td(e.y-this.min.y,this.yScale,this.cellsY),d=td(n.y-this.min.y,this.yScale,this.cellsY);for(let f=u;f<=d;f++)for(let p=s;p<=l;p++){let g=this.cells[f*this.cellsX+p];if(g)for(let _=0;_<g.len;_++){let v=this.payload[g.start+_],x=Math.floor(v/8),b=1<<v%8;if(!(this.lookup[x]&b)&&(this.lookup[x]|=b,o.push(v),o.length===this.triangleCount))return}}}}function td(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function hh(t,e){let n=t.json.bufferViews[e.bufferView];return new OE[e.componentType](t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*RE[e.type])}function aq(t,e,n){let o=t.indices,s=t.attributes,l={};l.indexArray=new Kr;let u=e.json.accessors[o],d=u.count/3;l.indexArray.reserve(d);let f=hh(e,u);for(let v=0;v<d;v++)l.indexArray.emplaceBack(f[3*v],f[3*v+1],f[3*v+2]);l.indexArray._trim(),l.vertexArray=new nh;let p=e.json.accessors[s.POSITION];l.vertexArray.reserve(p.count);let g=hh(e,p);for(let v=0;v<p.count;v++)l.vertexArray.emplaceBack(g[3*v],g[3*v+1],g[3*v+2]);if(l.vertexArray._trim(),l.aabb=new qi(p.min,p.max),l.centroid=function(v,x){let b=[0,0,0],T=v.length;if(T>0){for(let E=0;E<T;E++){let M=3*v[E];b[0]+=x[M],b[1]+=x[M+1],b[2]+=x[M+2]}b[0]/=T,b[1]/=T,b[2]/=T}return b}(f,g),s.COLOR_0!==void 0){let v=e.json.accessors[s.COLOR_0],x=RE[v.type];if(v.componentType===PE){l.colorArray=x===3?new nh:new Fc,l.colorArray.reserve(v.count);let b=hh(e,v);if(x===3)for(let T=0;T<v.count;T++)l.colorArray.emplaceBack(b[3*T],b[3*T+1],b[3*T+2]);else for(let T=0;T<v.count;T++)l.colorArray.emplaceBack(b[4*T],b[4*T+1],b[4*T+2],b[4*T+3]);l.colorArray._trim()}else if(v.componentType===AE&&x===4){l.colorArray=new Fc,l.colorArray.resize(v.count);let b=hh(e,v),T=1/65535,E=l.colorArray.float32;for(let M=0;M<4*b.length;++M)E[M]=b[M]*T}else J(`glTF color buffer parsing for accessor ${JSON.stringify(v)} is not supported`)}if(s.NORMAL!==void 0){l.normalArray=new nh;let v=e.json.accessors[s.NORMAL];l.normalArray.reserve(v.count);let x=hh(e,v);for(let b=0;b<v.count;b++)l.normalArray.emplaceBack(x[3*b],x[3*b+1],x[3*b+2]);l.normalArray._trim()}if(s.TEXCOORD_0!==void 0&&n.length>0){l.texcoordArray=new Vm;let v=e.json.accessors[s.TEXCOORD_0];l.texcoordArray.reserve(v.count);let x=hh(e,v);for(let b=0;b<v.count;b++)l.texcoordArray.emplaceBack(x[2*b],x[2*b+1]);l.texcoordArray._trim()}let _=t.material;return l.material=function(v,x){let{emissiveFactor:b=[0,0,0],alphaMode:T="OPAQUE",alphaCutoff:E=.5,normalTexture:M,occlusionTexture:S,emissiveTexture:P,doubleSided:O}=v,{baseColorFactor:A=[1,1,1,1],metallicFactor:R=1,roughnessFactor:F=1,baseColorTexture:k,metallicRoughnessTexture:N}=v.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new tn(...A),metallicFactor:R,roughnessFactor:F,baseColorTexture:k?x[k.index]:void 0,metallicRoughnessTexture:N?x[N.index]:void 0},doubleSided:O,emissiveFactor:b,alphaMode:T,alphaCutoff:E,normalTexture:M?x[M.index]:void 0,occlusionTexture:S?x[S.index]:void 0,emissionTexture:P?x[P.index]:void 0,defined:v.defined===void 0}}(_!==void 0?e.json.materials[_]:{defined:!1},n),s._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(hh(e,e.json.accessors[s._FEATURE_RGBA4444]).buffer)),l}function DF(t,e,n){let{matrix:o,rotation:s,translation:l,scale:u,mesh:d,extras:f,children:p}=t,g={};if(g.matrix=o||ae.fromRotationTranslationScale([],s||[0,0,0,1],l||[0,0,0],u||[1,1,1]),d!==void 0){g.meshes=n[d];let _=g.anchor=[0,0];for(let v of g.meshes){let{min:x,max:b}=v.aabb;_[0]+=x[0]+b[0],_[1]+=x[1]+b[1]}_[0]=Math.floor(_[0]/g.meshes.length/2),_[1]=Math.floor(_[1]/g.meshes.length/2)}if(f&&(f.id&&(g.id=f.id),f.lights&&(g.lights=function(_){if(!_.length)return[];let v=function(M){let S=atob(M),P=new Uint8Array(S.length);for(let O=0;O<S.length;O++)P[O]=S.codePointAt(O);return P}(_),x=[],b=v.length/24,T=new Uint16Array(v.buffer),E=new Float32Array(v.buffer);for(let M=0;M<b;M++){let S=T[2*M*6]/30,P=T[2*M*6+1]/30,O=T[2*M*6+10]/100,A=E[6*M+1],R=E[6*M+2],F=E[6*M+3],k=E[6*M+4],N=F-A,B=k-R,H=Math.hypot(N,B);x.push({pos:[A+.5*N,R+.5*B,P],normal:[B/H,-N/H,0],width:H,height:S,depth:O,points:[A,R,F,k]})}return x}(f.lights))),p){let _=[];for(let v of p)_.push(DF(e.json.nodes[v],e,n));g.children=_}return g}function lq(t){if(t.vertices.length===0||t.indices.length===0)return null;let[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let u=1;u<t.vertices.length;++u){let d=t.vertices[u];e.x=Math.min(e.x,d.x),e.y=Math.min(e.y,d.y),n.x=Math.max(n.x,d.x),n.y=Math.max(n.y,d.y)}let o=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),s=Math.max(8,o),l=new SF(t.vertices,t.indices,s);return{vertices:t.vertices,indices:t.indices,grid:l,min:e,max:n}}function cq(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let o=[];for(let u of n){if(!Array.isArray(u)||u.length!==2)continue;let d=u[0],f=u[1];typeof d=="number"&&typeof f=="number"&&o.push(new X(d,f))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let s=0;for(let u=0;u<o.length;u++){let d=o[u],f=o[(u+1)%o.length],p=o[(u+2)%o.length];s+=(d.x-f.x)*(p.y-f.y)-(p.x-f.x)*(d.y-f.y)}s>0&&o.reverse();let l=Yy(o.flatMap(u=>[u.x,u.y]),[]);return l.length===0?null:{vertices:o,indices:l}}function uq(t){let e=[],n=[],o=0;for(let s of t){o=e.length;let l=s.vertexArray.float32,u=s.indexArray.uint16;for(let d=0;d<s.vertexArray.length;d++)e.push(new X(l[3*d+0],l[3*d+1]));for(let d=0;d<3*s.indexArray.length;d++)n.push(u[d]+o)}if(n.length%3!=0)return null;for(let s=0;s<n.length;s+=3){let l=e[n[s+0]],u=e[n[s+1]],d=e[n[s+2]];(l.x-u.x)*(d.y-u.y)-(d.x-u.x)*(l.y-u.y)>0&&([n[s+1],n[s+2]]=[n[s+2],n[s+1]])}return{vertices:e,indices:n}}function FE(t){let e=function(f,p){let g=[],_=y.WebGL2RenderingContext;if(f.json.textures)for(let v of f.json.textures){let x={magFilter:_.LINEAR,minFilter:_.NEAREST,wrapS:_.REPEAT,wrapT:_.REPEAT};v.sampler!==void 0&&Object.assign(x,f.json.samplers[v.sampler]),g.push({image:p[v.source],sampler:x,uploaded:!1})}return g}(t,t.images),n=function(f,p){let g=[];for(let _ of f.json.meshes){let v=[];for(let x of _.primitives)v.push(aq(x,f,p));g.push(v)}return g}(t,e),{scenes:o,scene:s,nodes:l}=t.json,u=o?o[s||0].nodes:l,d=[];for(let f of u)d.push(DF(l[f],t,n));return function(f,p,g){let _={},v=new Set;for(let x=0;x<f.length;x++){let b=g[p[x]];if(!b.extras)continue;let T=b.extras["mapbox:footprint:version"],E=b.extras["mapbox:footprint:id"];(T||E)&&v.add(x),T==="1.0.0"&&E&&(_[E]=x)}for(let x=0;x<f.length;x++){if(v.has(x))continue;let b=f[x],T=g[p[x]];if(!T.extras)continue;let E=null;b.id in _&&(E=uq(f[_[b.id]].meshes)),E||(E=cq(T)),E&&(b.footprint=lq(E))}if(v.size>0){let x=Array.from(v.values()).sort((b,T)=>b-T);for(let b=x.length-1;b>=0;b--)f.splice(x[b],1)}}(d,u,t.json.nodes),d}function dq(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,o=t.aabb.min[1]-1,s=ch/(t.aabb.max[0]-n+2),l=ch/(t.aabb.max[1]-o+2);for(let u=0;u<e.length;u+=3){let d=e[u+2],f=(e[u+0]-n)*s|0,p=(e[u+1]-o)*l|0;d>t.heightmap[p*ch+f]&&(t.heightmap[p*ch+f]=d)}}function hq(t,e){let n={};n.indexArray=new Kr,n.indexArray.reserve(4*t.length),n.vertexArray=new nh,n.vertexArray.reserve(10*t.length),n.colorArray=new Fc,n.vertexArray.reserve(10*t.length);let o=0;for(let u of t){let d=Math.min(10,Math.max(4,1.3*u.height))*e,f=[-u.normal[1],u.normal[0],0],p=Math.min(.29,.1*u.width/u.depth),g=u.width-2*u.depth*e*(p+.01),_=Z.scaleAndAdd([],u.pos,f,g/2),v=Z.scaleAndAdd([],u.pos,f,-g/2),x=[_[0],_[1],_[2]+u.height],b=[v[0],v[1],v[2]+u.height],T=Z.scaleAndAdd([],u.normal,f,p);Z.scale(T,T,d);let E=Z.scaleAndAdd([],u.normal,f,-p);Z.scale(E,E,d),Z.add(T,_,T),Z.add(E,v,E),_[2]+=.1,v[2]+=.1,n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(x[0],x[1],x[2]),n.vertexArray.emplaceBack(b[0],b[1],b[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]);let M=g/d/2;n.colorArray.emplaceBack(-M-p,-1,M,.8),n.colorArray.emplaceBack(M+p,-1,M,.8),n.colorArray.emplaceBack(-M,0,M,1.3),n.colorArray.emplaceBack(M,0,M,1.3),n.colorArray.emplaceBack(M+p,-.8,M,.7),n.colorArray.emplaceBack(M+p,-.8,M,.7),n.colorArray.emplaceBack(0,0,M,1.3),n.colorArray.emplaceBack(0,0,M,1.3),n.colorArray.emplaceBack(M+p,-1.2,M,.8),n.colorArray.emplaceBack(M+p,-1.2,M,.8),n.indexArray.emplaceBack(6+o,4+o,8+o),n.indexArray.emplaceBack(7+o,9+o,5+o),n.indexArray.emplaceBack(0+o,1+o,2+o),n.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let s={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=tn.white,s.pbrMetallicRoughness=l,n.material=s,n.aabb=new qi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}pt(SF,"TriangleGridIndex");let kE={vector:vF,raster:IE,"raster-dem":class extends IE{constructor(t,e,n,o){super(t,e,n,o),this.type="raster-dem",this.maxzoom=22,this._options=Ne({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(t,e){let n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function o(s,l){s&&(t.state="errored",e(s)),l&&(t.dem=l,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",e(null))}t.request=Ft(this.map._requestManager.transformRequest(n,ve.Tile),(function(s,l,u,d){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(s)t.state="errored",e(s);else if(l){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:u,expires:d});let p=y.ImageBitmap&&l instanceof y.ImageBitmap&&vf(),g=1-(l.width-((f=l.width)<=1?1:Math.pow(2,Math.floor(Math.log(f)/Math.LN2))))/2;g<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));let _=p?l:Zt.getImageData(l,g),v={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:_,encoding:this.encoding,padding:g};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",v,o.bind(this),void 0,!0))}var f}).bind(this))}_getNeighboringTiles(t){let e=t.canonical,n=Math.pow(2,e.z),o=(e.x-1+n)%n,s=e.x===0?t.wrap-1:t.wrap,l=(e.x+1+n)%n,u=e.x+1===n?t.wrap+1:t.wrap,d={};return d[new qn(t.overscaledZ,s,e.z,o,e.y).key]={backfilled:!1},d[new qn(t.overscaledZ,u,e.z,l,e.y).key]={backfilled:!1},e.y>0&&(d[new qn(t.overscaledZ,s,e.z,o,e.y-1).key]={backfilled:!1},d[new qn(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},d[new qn(t.overscaledZ,u,e.z,l,e.y-1).key]={backfilled:!1}),e.y+1<n&&(d[new qn(t.overscaledZ,s,e.z,o,e.y+1).key]={backfilled:!1},d[new qn(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},d[new qn(t.overscaledZ,u,e.z,l,e.y+1).key]={backfilled:!1}),d}},geojson:class extends vn{constructor(t,e,n,o){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(o),this._data=e.data,this._options=Ne({},e),this._collectResourceTiming=e.collectResourceTiming,e.maxzoom!==void 0&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;let s=ne/this.tileSize;this.workerOptions=Ne({source:this.id,scope:this.scope,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(e.buffer!==void 0?e.buffer:128)*s,tolerance:(e.tolerance!==void 0?e.tolerance:.375)*s,extent:ne,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:e.clusterMaxZoom!==void 0?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:ne,radius:(e.clusterRadius!==void 0?e.clusterRadius:50)*s,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,n,o){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:n},o),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Se("dataloading",{dataType:"source"})),this._loaded=!1;let t=Ne({},this.workerOptions);t.scope=this.scope;let e=this._data;typeof e=="string"?(t.request=this.map._requestManager.transformRequest(Zt.resolveURL(e),ve.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(n,o)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new Je(n));else{let s={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&o&&o.resourceTiming&&o.resourceTiming[this.id]&&(s.resourceTiming=o.resourceTiming[this.id]),this.fire(new Se("data",s)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(t,e){let n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;let o={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:Zt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(n,o,(s,l)=>(delete t.request,t.destroy(),t.aborted?e(null):s?e(s):(t.loadVectorData(l,this.map.painter,n==="reloadTile"),e(null))),void 0,n==="loadTile")}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Ne({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ga{constructor(t,e,n,o){super(t,e,n,o),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;let t=this.options;this.urls=[];for(let e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,ve.Source).url);(function(e,n){let o=y.document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let s=0;s<e.length;s++){let l=y.document.createElement("source");nt(e[s])||(o.crossOrigin="Anonymous"),l.src=e[s],o.appendChild(l)}})(this.urls,(e,n)=>{this._loaded=!0,e?this.fire(new Je(e)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){let e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new Je(new Ie(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let t=this.map.painter.context,e=t.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new fr(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ga,model:class extends vn{constructor(t,e,n,o){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){let t=[];for(let e in this._options.models){let n=this._options.models[e],o=CF(this.map._requestManager.transformRequest(n.uri,ve.Model).url).then(s=>{if(!s)return;let l=FE(s),u=new TL(e,n.position,n.orientation,l);u.computeBoundsAndApplyParent(),this.models.push(u)}).catch(s=>{this.fire(new Je(new Error(`Could not load model ${e} from ${n.uri}: ${s.message}`)))});t.push(o)}return Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new Je(new Error(`Could not load models: ${e.message}`)))})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends vn{constructor(t,e,n,o){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(o)}onAdd(t){this.map=t,this.load()}load(t){this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"}));let e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=EE(this._options,this.map._requestManager,e,n,(o,s)=>{this._tileJSONRequest=null,this._loaded=!0,o?(e&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${e}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new Je(o))):s&&(Ne(this,s),s.bounds&&(this.tileBounds=new Lv(s.bounds,this.minzoom,this.maxzoom)),zl(s.tiles,this.map._requestManager._customAccessToken),this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))),t&&t(o)})}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(t,e){let n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),o={request:this.map._requestManager.transformRequest(n,ve.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&t.state!=="expired")if(t.state==="loading")t.reloadCallback=e;else{if(t.buckets){let l=Object.values(t.buckets);for(let u of l)u.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",o,s.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",o,s.bind(this),void 0,!0);function s(l,u){return t.aborted?e(null):l&&l.status!==404?e(l):(u&&(u.resourceTiming&&(t.resourceTiming=u.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(u),t.buckets=Lt(Lt({},t.buckets),u.buckets)),t.state="loaded",void e(null))}}serialize(){return Ne({},this._options)}},canvas:class extends Ga{constructor(t,e,n,o){super(t,e,n,o),e.coordinates?Array.isArray(e.coordinates)&&e.coordinates.length===4&&!e.coordinates.some(s=>!Array.isArray(s)||s.length!==2||s.some(l=>typeof l!="number"))||this.fire(new Je(new Ie(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Je(new Ie(`sources.${t}`,null,'missing required property "coordinates"'))),e.animate&&typeof e.animate!="boolean"&&this.fire(new Je(new Ie(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),e.canvas?typeof e.canvas=="string"||e.canvas instanceof y.HTMLCanvasElement||this.fire(new Je(new Ie(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Je(new Ie(`sources.${t}`,null,'missing required property "canvas"'))),this.options=e,this.animate=e.animate===void 0||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.HTMLCanvasElement?this.options.canvas:y.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Je(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let e=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof xv||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new fr(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends vn{constructor(t,e,n,o){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=e,this.setEventedParent(o),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Je(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Je(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Lv(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.clearTiles=this._clearTiles.bind(this),e.coveringTiles=this._coveringTiles.bind(this),Ne(this,wo(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return wo(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Se("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new Se("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){let{x:e,y:n,z:o}=t.canonical;return this._implementation.hasTile({x:e,y:n,z:o})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){let{x:n,y:o,z:s}=t.tileID.canonical,l=new y.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:n,y:o,z:s},{signal:l.signal})).then((function(u){return delete t.request,t.aborted?(t.state="unloaded",e(null)):u===void 0?(t.state="errored",e(null)):u===null?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(d){return d instanceof y.ImageData||d instanceof y.HTMLCanvasElement||d instanceof y.ImageBitmap||d instanceof y.HTMLImageElement}(u)?(this.loadTileData(t,u),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(u=>{u.code!==20&&(t.state="errored",e(u))}),t.request.cancel=()=>l.abort()}loadTileData(t,e){t.setTexture(e,this._map.painter)}unloadTile(t,e){if(t.texture&&t.texture instanceof fr?(t.destroy(!0),t.texture&&t.texture instanceof fr&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){let{x:n,y:o,z:s}=t.tileID.canonical;this._implementation.unloadTile({x:n,y:o,z:s})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_clearTiles(){let t=os(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new Se("data",{dataType:"source",sourceDataType:"content"}))}}},NE=function(t,e,n,o){let s=new kE[e.type](t,e,n,o);if(s.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${s.id}`);return gr(["load","abort","unload","serialize","prepare"],s),s};function fq(t,e){let n=ae.identity([]);return ae.scale(n,n,[.5*t.width,.5*-t.height,1]),ae.translate(n,n,[1,-1,0]),ae.multiply(n,n,t.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(n)}function pq(t,e,n,o,s,l,u,d=!1){let f=t.tilesIn(o,u,d);f.sort(AF);let p=[];for(let _ of f)p.push({wrappedTileID:_.tile.tileID.wrapped().key,queryResults:_.tile.queryRenderedFeatures(e,n,t._state,_,s,l,fq(t.transform,_.tile.tileID),d)});let g=function(_){let v={},x={};for(let b of _){let T=b.queryResults,E=b.wrappedTileID,M=x[E]=x[E]||{};for(let S in T){let P=T[S],O=M[S]=M[S]||{},A=v[S]=v[S]||[];for(let R of P)O[R.featureIndex]||(O[R.featureIndex]=!0,A.push(R))}}return v}(p);for(let _ in g)g[_].forEach(v=>{let x=v.feature,b=x.layer;b&&b.type!=="background"&&b.type!=="sky"&&b.type!=="slot"&&(x.source=b.source,b["source-layer"]&&(x.sourceLayer=b["source-layer"]),x.state=x.id!==void 0?t.getFeatureState(b["source-layer"],x.id):{})});return g}function mq(t,e){let n=t.getRenderableIds().map(l=>t.getTileByID(l)),o=[],s={};for(let l=0;l<n.length;l++){let u=n[l],d=u.tileID.canonical.key;s[d]||(s[d]=!0,u.querySourceFeatures(o,e))}return o}function AF(t,e){let n=t.tileID,o=e.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}class gq{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(let e in this.style._mergedLayers){let n=this.style._mergedLayers[e];if(n.type==="fill-extrusion")this.layers.push(n);else if(n.type==="model"){let o=this.style.getLayerSource(n);o&&o.type==="batched-model"&&this.layers.push(n)}}}updateZOffset(e,n){this.currentBuildingBuckets=[];for(let s=0;s<this.layers.length;++s){let l=this.layers[s],u=this.style.getLayerSourceCache(l),d=1;l.type==="fill-extrusion"&&(d=l.paint.get("fill-extrusion-opacity")>0?l.paint.get("fill-extrusion-vertical-scale"):0);let f=u?u.getTile(n):null;if(!f&&u&&n.canonical.z>u.getSource().minzoom){let p=n.scaledTo(Math.min(u.getSource().maxzoom,n.overscaledZ-1));for(;p.overscaledZ>=u.getSource().minzoom&&(f=u.getTile(p),!f&&p.overscaledZ!==0);)p=p.scaledTo(p.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:f?f.getBucket(l):null,tileID:f?f.tileID:n,verticalScale:d})}e.hasAnyZOffset=!1;let o=!1;for(let s=0;s<e.symbolInstances.length;s++){let l=e.symbolInstances.get(s),u=l.zOffset,d=this._getHeightAtTileOffset(n,l.tileAnchorX,l.tileAnchorY);l.zOffset=d!==-1?d:u,o||u===l.zOffset||(o=!0),e.hasAnyZOffset||l.zOffset===0||(e.hasAnyZOffset=!0)}o&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,n,o,s){let l=n,u=o;if(e.canonical.z!==s.canonical.z){let d=s.canonical,f=1/(1<<e.canonical.z-d.z);l=(n+e.canonical.x*ne)*f-d.x*ne|0,u=(o+e.canonical.y*ne)*f-d.y*ne|0}return{tileX:l,tileY:u}}_getHeightAtTileOffset(e,n,o){let s;for(let l=0;l<this.layers.length;++l){if(this.layers[l].type!=="fill-extrusion")continue;let{bucket:u,tileID:d,verticalScale:f}=this.currentBuildingBuckets[l];if(!u)continue;let{tileX:p,tileY:g}=this._mapCoordToOverlappingTile(e,n,o,d),_=u.getHeightAtTileCoord(p,g);if(_&&_.height!==void 0){if(!_.hidden)return _.height*f;s=_.height}}for(let l=0;l<this.layers.length;++l){if(this.layers[l].type!=="model")continue;let{bucket:u,tileID:d}=this.currentBuildingBuckets[l];if(!u)continue;let{tileX:f,tileY:p}=this._mapCoordToOverlappingTile(e,n,o,d),g=u.getHeightAtTileCoord(f,p);if(g&&!g.hidden)return g.height===void 0&&s!==void 0?Math.min(g.maxHeight,s)*g.verticalScale:(g.height||0)*g.verticalScale}return-1}}var PF=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _q(t,e){let n={};for(let o in t)o!=="ref"&&(n[o]=t[o]);return PF.forEach(o=>{o in e&&(n[o]=e[o])}),n}function OF(t){t=t.slice();let e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=_q(t[n],e[t[n].ref]));return t}let Qn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function RF(t,e,n){n.push({command:Qn.addSource,args:[t,e[t]]})}function LF(t,e,n){e.push({command:Qn.removeSource,args:[t]}),n[t]=!0}function yq(t,e,n,o){LF(t,n,o),RF(t,e,n)}function vq(t,e,n){let o;for(o in t[n])if(t[n].hasOwnProperty(o)&&o!=="data"&&!Rt(t[n][o],e[n][o]))return!1;for(o in e[n])if(e[n].hasOwnProperty(o)&&o!=="data"&&!Rt(t[n][o],e[n][o]))return!1;return!0}function kv(t,e,n,o,s,l){let u;for(u in e=e||{},t=t||{})t.hasOwnProperty(u)&&(Rt(t[u],e[u])||n.push({command:l,args:[o,u,e[u],s]}));for(u in e)e.hasOwnProperty(u)&&!t.hasOwnProperty(u)&&(Rt(t[u],e[u])||n.push({command:l,args:[o,u,e[u],s]}))}function Nv(t){return t.id}function zv(t,e){return t[e.id]=e,t}class xq{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=ze(e,0,1);let n=1,o=this._distances[n],s=e*this.paddedLength+this.padding;for(;o<s&&n<this._distances.length;)o=this._distances[++n];let l=n-1,u=this._distances[l],d=o-u,f=d>0?(s-u)/d:0;return this.points[l].mult(1-f).add(this.points[n].mult(f))}}class FF{constructor(e,n,o){let s=this.boxCells=[],l=this.circleCells=[];this.xCellCount=Math.ceil(e/o),this.yCellCount=Math.ceil(n/o);for(let u=0;u<this.xCellCount*this.yCellCount;u++)s.push([]),l.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,o,s,l){this._forEachCell(n,o,s,l,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(l)}insertCircle(e,n,o,s){this._forEachCell(n-s,o-s,n+s,o+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(o),this.circles.push(s)}_insertBoxCell(e,n,o,s,l,u){this.boxCells[l].push(u)}_insertCircleCell(e,n,o,s,l,u){this.circleCells[l].push(u)}_query(e,n,o,s,l,u){if(o<0||e>this.width||s<0||n>this.height)return!l&&[];let d=[];if(e<=0&&n<=0&&this.width<=o&&this.height<=s){if(l)return!0;for(let f=0;f<this.boxKeys.length;f++)d.push({key:this.boxKeys[f],x1:this.bboxes[4*f],y1:this.bboxes[4*f+1],x2:this.bboxes[4*f+2],y2:this.bboxes[4*f+3]});for(let f=0;f<this.circleKeys.length;f++){let p=this.circles[3*f],g=this.circles[3*f+1],_=this.circles[3*f+2];d.push({key:this.circleKeys[f],x1:p-_,y1:g-_,x2:p+_,y2:g+_})}return u?d.filter(u):d}return this._forEachCell(e,n,o,s,this._queryCell,d,{hitTest:l,seenUids:{box:{},circle:{}}},u),l?d.length>0:d}_queryCircle(e,n,o,s,l){let u=e-o,d=e+o,f=n-o,p=n+o;if(d<0||u>this.width||p<0||f>this.height)return!s&&[];let g=[];return this._forEachCell(u,f,d,p,this._queryCellCircle,g,{hitTest:s,circle:{x:e,y:n,radius:o},seenUids:{box:{},circle:{}}},l),s?g.length>0:g}query(e,n,o,s,l){return this._query(e,n,o,s,!1,l)}hitTest(e,n,o,s,l){return this._query(e,n,o,s,!0,l)}hitTestCircle(e,n,o,s){return this._queryCircle(e,n,o,!0,s)}_queryCell(e,n,o,s,l,u,d,f){let p=d.seenUids,g=this.boxCells[l];if(g!==null){let v=this.bboxes;for(let x of g)if(!p.box[x]){p.box[x]=!0;let b=4*x;if(e<=v[b+2]&&n<=v[b+3]&&o>=v[b+0]&&s>=v[b+1]&&(!f||f(this.boxKeys[x]))){if(d.hitTest)return u.push(!0),!0;u.push({key:this.boxKeys[x],x1:v[b],y1:v[b+1],x2:v[b+2],y2:v[b+3]})}}}let _=this.circleCells[l];if(_!==null){let v=this.circles;for(let x of _)if(!p.circle[x]){p.circle[x]=!0;let b=3*x;if(this._circleAndRectCollide(v[b],v[b+1],v[b+2],e,n,o,s)&&(!f||f(this.circleKeys[x]))){if(d.hitTest)return u.push(!0),!0;{let T=v[b],E=v[b+1],M=v[b+2];u.push({key:this.circleKeys[x],x1:T-M,y1:E-M,x2:T+M,y2:E+M})}}}}}_queryCellCircle(e,n,o,s,l,u,d,f){let p=d.circle,g=d.seenUids,_=this.boxCells[l];if(_!==null){let x=this.bboxes;for(let b of _)if(!g.box[b]){g.box[b]=!0;let T=4*b;if(this._circleAndRectCollide(p.x,p.y,p.radius,x[T+0],x[T+1],x[T+2],x[T+3])&&(!f||f(this.boxKeys[b])))return u.push(!0),!0}}let v=this.circleCells[l];if(v!==null){let x=this.circles;for(let b of v)if(!g.circle[b]){g.circle[b]=!0;let T=3*b;if(this._circlesCollide(x[T],x[T+1],x[T+2],p.x,p.y,p.radius)&&(!f||f(this.circleKeys[b])))return u.push(!0),!0}}}_forEachCell(e,n,o,s,l,u,d,f){let p=this._convertToXCellCoord(e),g=this._convertToYCellCoord(n),_=this._convertToXCellCoord(o),v=this._convertToYCellCoord(s);for(let x=p;x<=_;x++)for(let b=g;b<=v;b++)if(l.call(this,e,n,o,s,this.xCellCount*b+x,u,d,f))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,o,s,l,u){let d=s-e,f=l-n,p=o+u;return p*p>d*d+f*f}_circleAndRectCollide(e,n,o,s,l,u,d){let f=(u-s)/2,p=Math.abs(e-(s+f));if(p>f+o)return!1;let g=(d-l)/2,_=Math.abs(n-(l+g));if(_>g+o)return!1;if(p<=f||_<=g)return!0;let v=p-f,x=_-g;return v*v+x*x<=o*o}}let ic=100;class bq{constructor(e,n,o=new FF(e.width+200,e.height+200,25),s=new FF(e.width+200,e.height+200,25)){this.transform=e,this.grid=o,this.ignoredGrid=s,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ic,this.screenBottomBoundary=e.height+ic,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=n}placeCollisionBox(e,n,o,s,l,u,d,f){let p=o.projectedAnchorX,g=o.projectedAnchorY,_=o.projectedAnchorZ,v=o.elevation,x=o.tileID,b=e.getProjection();if(v&&x){let[R,F,k]=b.upVector(x.canonical,o.tileAnchorX,o.tileAnchorY),N=b.upVectorScale(x.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;p+=R*v*N,g+=F*v*N,_+=k*v*N}let T=this.projectAndGetPerspectiveRatio(d,p,g,_,o.tileID,b.name==="globe"||!!v||this.transform.pitch>0,b),E=u*T.perspectiveRatio,M=(o.x1*n+s.x-o.padding)*E+T.point.x,S=(o.y1*n+s.y-o.padding)*E+T.point.y,P=(o.x2*n+s.x+o.padding)*E+T.point.x,O=(o.y2*n+s.y+o.padding)*E+T.point.y,A=T.perspectiveRatio<=.55||T.occluded;return!this.isInsideGrid(M,S,P,O)||!l&&this.grid.hitTest(M,S,P,O,f)||A?{box:[],offscreen:!1,occluded:T.occluded}:{box:[M,S,P,O],offscreen:this.isOffscreen(M,S,P,O),occluded:!1}}placeCollisionCircles(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T){let E=[],M=this.transform.elevation,S=e.getProjection(),P=M?M.getAtTileOffsetFunc(T,this.transform.center.lat,this.transform.worldSize,S):null,O=new X(o.tileAnchorX,o.tileAnchorY),{x:A,y:R,z:F}=S.projectTilePoint(O.x,O.y,T.canonical);if(P){let[se,K,ee]=P(O);A+=se,R+=K,F+=ee}let k=S.name==="globe",N=this.projectAndGetPerspectiveRatio(d,A,R,F,T,k||!!M||this.transform.pitch>0,S),{perspectiveRatio:B}=N,H=(_?u/B:u*B)/Ao,G=yl(A,R,F,f),Y=N.signedDistanceFromCamera>0?fL(H,l,o.lineOffsetX*H,o.lineOffsetY*H,!1,G,O,o,s,f,{},M&&!_?P:null,_&&!!M,S,T,_):null,U=!1,Q=!1,te=!0;if(Y&&!N.occluded){let se=.5*x*B+b,K=new X(-100,-100),ee=new X(this.screenRightBoundary,this.screenBottomBoundary),de=new xq,{first:pe,last:fe}=Y,be=pe.path.length,Te=[];for(let Pe=be-1;Pe>=1;Pe--)Te.push(pe.path[Pe]);for(let Pe=1;Pe<fe.path.length;Pe++)Te.push(fe.path[Pe]);let Me=2.5*se;p&&(Te=Te.map(([Pe,et,tt],lt)=>(P&&!k&&(tt=P(lt<be-1?pe.tilePath[be-1-lt]:fe.tilePath[lt-be+2])[2]),yl(Pe,et,tt,p))),Te.some(Pe=>Pe[3]<=0)&&(Te=[]));let ge=[];if(Te.length>0){let Pe=1/0,et=-1/0,tt=1/0,lt=-1/0;for(let ct of Te)Pe=Math.min(Pe,ct[0]),tt=Math.min(tt,ct[1]),et=Math.max(et,ct[0]),lt=Math.max(lt,ct[1]);et>=K.x&&Pe<=ee.x&&lt>=K.y&&tt<=ee.y&&(ge=[Te.map(ct=>new X(ct[0],ct[1]))],(Pe<K.x||et>ee.x||tt<K.y||lt>ee.y)&&(ge=FR(ge,K.x,K.y,ee.x,ee.y)))}for(let Pe of ge){de.reset(Pe,.25*se);let et=0;et=de.length<=.5*se?1:Math.ceil(de.paddedLength/Me)+1;for(let tt=0;tt<et;tt++){let lt=tt/Math.max(et-1,1),ct=de.lerp(lt),Ht=ct.x+ic,Tt=ct.y+ic;E.push(Ht,Tt,se,0);let zn=Ht-se,Dn=Tt-se,Gt=Ht+se,kt=Tt+se;if(te=te&&this.isOffscreen(zn,Dn,Gt,kt),Q=Q||this.isInsideGrid(zn,Dn,Gt,kt),!n&&this.grid.hitTestCircle(Ht,Tt,se,v)&&(U=!0,!g))return{circles:[],offscreen:!1,collisionDetected:U,occluded:!1}}}}return{circles:!g&&U||!Q?[]:E,offscreen:te,collisionDetected:U,occluded:N.occluded}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let n=[],o=1/0,s=1/0,l=-1/0,u=-1/0;for(let g of e){let _=new X(g.x+ic,g.y+ic);o=Math.min(o,_.x),s=Math.min(s,_.y),l=Math.max(l,_.x),u=Math.max(u,_.y),n.push(_)}let d=this.grid.query(o,s,l,u).concat(this.ignoredGrid.query(o,s,l,u)),f={},p={};for(let g of d){let _=g.key;f[_.bucketInstanceId]===void 0&&(f[_.bucketInstanceId]={}),f[_.bucketInstanceId][_.featureIndex]||B2(n,[new X(g.x1,g.y1),new X(g.x2,g.y1),new X(g.x2,g.y2),new X(g.x1,g.y2)])&&(f[_.bucketInstanceId][_.featureIndex]=!0,p[_.bucketInstanceId]===void 0&&(p[_.bucketInstanceId]=[]),p[_.bucketInstanceId].push(_.featureIndex))}return p}insertCollisionBox(e,n,o,s,l){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:s,collisionGroupID:l},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,o,s,l){let u=n?this.ignoredGrid:this.grid,d={bucketInstanceId:o,featureIndex:s,collisionGroupID:l};for(let f=0;f<e.length;f+=4)u.insertCircle(d,e[f],e[f+1],e[f+2])}projectAndGetPerspectiveRatio(e,n,o,s,l,u,d){let f=[n,o,s,1],p=!1;s||this.transform.pitch>0?(Ei.transformMat4(f,f,e),this.fogState&&l&&d.name!=="globe"&&(p=function(v,x,b,T,E,M){let S=M.calculateFogTileMatrix(E),P=[x,b,T];return Z.transformMat4(P,P,S),Ov(v,Z.length(P),M.pitch,M._fov)}(this.fogState,n,o,s,l.toUnwrapped(),this.transform)>.9)):yL(f,f,e);let g=f[3];return{point:new X((f[0]/g+1)/2*this.transform.width+ic,(-f[1]/g+1)/2*this.transform.height+ic),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(d)/g*.5,1.5),signedDistanceFromCamera:g,occluded:u&&f[2]>g||p}}isOffscreen(e,n,o,s){return o<ic||e>=this.screenRightBoundary||s<ic||n>this.screenBottomBoundary}isInsideGrid(e,n,o,s){return o>=0&&e<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}getViewportMatrix(){let e=ae.identity([]);return ae.translate(e,e,[-100,-100,0]),e}}function zE(t,e,n){let o=e.createTileMatrix(t,t.worldSize,n.toUnwrapped());return ae.multiply(new Float32Array(16),t.projMatrix,o)}function wq(t,e,n){if(e.projection.name===n.projection.name)return t.projMatrix;let o=n.clone();return o.setProjection(e.projection),zE(o,e.getProjection(),t)}function BE(t,e,n){return e.name===n.projection.name?t.projMatrix:zE(n,e,t)}class kF{constructor(e,n,o,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):s&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class xg{constructor(e,n,o,s,l,u=!1){this.text=new kF(e?e.text:null,n,o,l),this.icon=new kF(e?e.icon:null,n,s,l),this.clipped=u}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jE{constructor(e,n,o,s=!1){this.text=e,this.icon=n,this.skipFade=o,this.clipped=s}}class Tq{constructor(){this.invProjMatrix=ae.create(),this.viewportMatrix=ae.create(),this.circles=[]}}class Eq{constructor(e,n,o,s,l){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=s,this.tileID=l}}class Mq{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[e]}}function NF(t,e,n,o,s){let{horizontalAlign:l,verticalAlign:u}=ov(t),d=-(l-.5)*e,f=-(u-.5)*n,p=iE(t,o);return new X(d+p[0]*s,f+p[1]*s)}function VE(t,e,n,o,s){let l=new X(t,e);return n&&l._rotate(o?s:-s),l}class Iq{constructor(e,n,o,s,l,u){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new bq(this.transform,l),this.buildingIndex=u,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Mq(o),this.collisionCircleArrays={},this.prevPlacement=s,s&&(s.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,o,s){let l=o.getBucket(n),u=o.latestFeatureIndex;if(!l||!u||n.fqid!==l.layerIds[0])return;let d=l.layers[0].layout,f=o.collisionBoxArray,p=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),g=o.tileSize/ne,_=o.tileID.toUnwrapped();this.transform.setProjection(l.projection);let v=(x=o.tileID,b=l.getProjection(),T=this.transform,b.name===this.projection?T.calculateProjMatrix(x.toUnwrapped()):zE(T,b,x));var x,b,T;let E=d.get("text-pitch-alignment")==="map",M=d.get("text-rotation-alignment")==="map";n.compileFilter();let S=n.dynamicFilter(),P=n.dynamicFilterNeedsFeature(),O=this.transform.calculatePixelsToTileUnitsMatrix(o),A=uL(v,o.tileID.canonical,E,M,this.transform,l.getProjection(),O),R=null;if(E){let N=dL(v,o.tileID.canonical,E,M,this.transform,l.getProjection(),O);R=ae.multiply([],this.transform.labelPlaneMatrix,N)}let F=null;S&&o.latestFeatureIndex&&(F={unwrappedTileID:_,dynamicFilter:S,dynamicFilterNeedsFeature:P,featureIndex:o.latestFeatureIndex}),this.retainedQueryData[l.bucketInstanceId]=new Eq(l.bucketInstanceId,u,l.sourceLayerIndex,l.index,o.tileID);let k={bucket:l,layout:d,posMatrix:v,textLabelPlaneMatrix:A,labelToScreenMatrix:R,clippingData:F,scale:p,textPixelRatio:g,holdingForFade:o.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:Ql(l.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Ql(l.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(l.sourceID)};if(s)for(let N of l.sortKeyRanges){let{sortKey:B,symbolInstanceStart:H,symbolInstanceEnd:G}=N;e.push({sortKey:B,symbolInstanceStart:H,symbolInstanceEnd:G,parameters:k})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:l.symbolInstances.length,parameters:k})}attemptAnchorPlacement(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S){let{textOffset0:P,textOffset1:O,crossTileID:A}=v,R=[P,O],F=NF(e,o,s,R,l),k=this.collisionIndex.placeCollisionBox(b,l,n,VE(F.x,F.y,u,d,this.transform.angle),_,f,p,g.predicate);if(E){let N=b.getSymbolInstanceIconSize(S,this.transform.zoom,v.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(b,N,E,VE(F.x,F.y,u,d,this.transform.angle),_,f,p,g.predicate).box.length===0)return}if(k.box.length>0){let N;return this.prevPlacement&&this.prevPlacement.variableOffsets[A]&&this.prevPlacement.placements[A]&&this.prevPlacement.placements[A].text&&(N=this.prevPlacement.variableOffsets[A].anchor),this.variableOffsets[A]={textOffset:R,width:o,height:s,anchor:e,textScale:l,prevAnchor:N},this.markUsedJustification(b,e,v,T),b.allowVerticalPlacement&&(this.markUsedOrientation(b,T,v),this.placedOrientations[A]=T),{shift:F,placedGlyphBoxes:k}}}placeLayerBucketPart(e,n,o,s){let{bucket:l,layout:u,posMatrix:d,textLabelPlaneMatrix:f,labelToScreenMatrix:p,clippingData:g,textPixelRatio:_,holdingForFade:v,collisionBoxArray:x,partiallyEvaluatedTextSize:b,partiallyEvaluatedIconSize:T,collisionGroup:E}=e.parameters,M=u.get("text-optional"),S=u.get("icon-optional"),P=u.get("text-allow-overlap"),O=u.get("icon-allow-overlap"),A=u.get("text-rotation-alignment")==="map",R=u.get("text-pitch-alignment")==="map",F=u.get("symbol-z-order")==="viewport-y",k=u.get("symbol-z-elevate");this.transform.setProjection(l.projection);let N=P&&(O||!l.hasIconData()||S),B=O&&(P||!l.hasTextData()||M);!l.collisionArrays&&x&&l.deserializeCollisionBoxes(x),o&&s&&l.updateCollisionDebugBuffers(this.transform.zoom,x);let H=(G,Y,U)=>{let{crossTileID:Q,numVerticalGlyphVertices:te}=G;if(g){let Gt={zoom:this.transform.zoom,pitch:this.transform.pitch},kt=null;if(g.dynamicFilterNeedsFeature){let St=this.retainedQueryData[l.bucketInstanceId];kt=g.featureIndex.loadFeature({featureIndex:G.featureIndex,bucketIndex:St.bucketIndex,sourceLayerIndex:St.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,g.dynamicFilter)(Gt,kt,this.retainedQueryData[l.bucketInstanceId].tileID.canonical,new X(G.tileAnchorX,G.tileAnchorY),this.transform.calculateDistanceTileData(g.unwrappedTileID)))return this.placements[Q]=new jE(!1,!1,!1,!0),void n.add(Q)}if(n.has(Q))return;if(v)return void(this.placements[Q]=new jE(!1,!1,!1));let se=!1,K=!1,ee=!0,de=!1,pe=!1,fe=null,be={box:null,offscreen:null,occluded:null},Te={box:null,offscreen:null,occluded:null},Me=null,ge=null,Pe=null,et=0,tt=0,lt=0;U.textFeatureIndex?et=U.textFeatureIndex:G.useRuntimeCollisionCircles&&(et=G.featureIndex),U.verticalTextFeatureIndex&&(tt=U.verticalTextFeatureIndex);let ct=Gt=>{Gt.tileID=this.retainedQueryData[l.bucketInstanceId].tileID;let kt=this.transform.elevation;Gt.elevation=G.zOffset+(kt?kt.getAtTileOffset(Gt.tileID,Gt.tileAnchorX,Gt.tileAnchorY):0)},Ht=U.textBox;if(Ht){ct(Ht);let Gt=St=>{let Pn=rr.horizontal;if(l.allowVerticalPlacement&&!St&&this.prevPlacement){let Nn=this.prevPlacement.placedOrientations[Q];Nn&&(this.placedOrientations[Q]=Nn,Pn=Nn,this.markUsedOrientation(l,Pn,G))}return Pn},kt=(St,Pn)=>{if(l.allowVerticalPlacement&&te>0&&U.verticalTextBox){for(let Nn of l.writingModes)if(Nn===rr.vertical?(be=Pn(),Te=be):be=St(),be&&be.box&&be.box.length)break}else be=St()};if(u.get("text-variable-anchor")){let St=u.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Q]){let fn=this.prevPlacement.variableOffsets[Q];St.indexOf(fn.anchor)>0&&(St=St.filter(Ri=>Ri!==fn.anchor),St.unshift(fn.anchor))}let Pn=(fn,Ri,Or)=>{let Mi=l.getSymbolInstanceTextSize(b,G,this.transform.zoom,Y),Zi=(fn.x2-fn.x1)*Mi+2*fn.padding,jr=(fn.y2-fn.y1)*Mi+2*fn.padding,Rr=G.hasIconTextFit&&!O?Ri:null;Rr&&ct(Rr);let Xi={box:[],offscreen:!1,occluded:!1},_i=P?2*St.length:St.length;for(let zo=0;zo<_i;++zo){let oc=this.attemptAnchorPlacement(St[zo%St.length],fn,Zi,jr,Mi,A,R,_,d,E,zo>=St.length,G,Y,l,Or,Rr,b,T);if(oc&&(Xi=oc.placedGlyphBoxes,Xi&&Xi.box&&Xi.box.length)){se=!0,fe=oc.shift;break}}return Xi};kt(()=>Pn(Ht,U.iconBox,rr.horizontal),()=>{let fn=U.verticalTextBox;return fn&&ct(fn),l.allowVerticalPlacement&&!(be&&be.box&&be.box.length)&&te>0&&fn?Pn(fn,U.verticalIconBox,rr.vertical):{box:null,offscreen:null,occluded:null}}),be&&(se=be.box,ee=be.offscreen,de=be.occluded);let Nn=Gt(!(!be||!be.box));if(!se&&this.prevPlacement){let fn=this.prevPlacement.variableOffsets[Q];fn&&(this.variableOffsets[Q]=fn,this.markUsedJustification(l,fn.anchor,G,Nn))}}else{let St=(Pn,Nn)=>{let fn=l.getSymbolInstanceTextSize(b,G,this.transform.zoom,Y),Ri=this.collisionIndex.placeCollisionBox(l,fn,Pn,new X(0,0),P,_,d,E.predicate);return Ri&&Ri.box&&Ri.box.length&&(this.markUsedOrientation(l,Nn,G),this.placedOrientations[Q]=Nn),Ri};kt(()=>St(Ht,rr.horizontal),()=>{let Pn=U.verticalTextBox;return l.allowVerticalPlacement&&te>0&&Pn?(ct(Pn),St(Pn,rr.vertical)):{box:null,offscreen:null,occluded:null}}),Gt(!!(be&&be.box&&be.box.length))}}if(Me=be,se=Me&&Me.box&&Me.box.length>0,ee=Me&&Me.offscreen,de=Me&&Me.occluded,G.useRuntimeCollisionCircles){let Gt=l.text.placedSymbolArray.get(G.centerJustifiedTextSymbolIndex>=0?G.centerJustifiedTextSymbolIndex:G.verticalPlacedTextSymbolIndex),kt=Jm(l.textSizeData,b,Gt),St=u.get("text-padding");ge=this.collisionIndex.placeCollisionCircles(l,P,Gt,l.lineVertexArray,l.glyphOffsetArray,kt,d,f,p,o,R,E.predicate,G.collisionCircleDiameter*kt/Ao,St,this.retainedQueryData[l.bucketInstanceId].tileID),se=P||ge.circles.length>0&&!ge.collisionDetected,ee=ee&&ge.offscreen,de=ge.occluded}if(U.iconFeatureIndex&&(lt=U.iconFeatureIndex),U.iconBox){let Gt=kt=>{ct(kt);let St=G.hasIconTextFit&&fe?VE(fe.x,fe.y,A,R,this.transform.angle):new X(0,0),Pn=l.getSymbolInstanceIconSize(T,this.transform.zoom,G.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(l,Pn,kt,St,O,_,d,E.predicate)};Te&&Te.box&&Te.box.length&&U.verticalIconBox?(Pe=Gt(U.verticalIconBox),K=Pe.box.length>0):(Pe=Gt(U.iconBox),K=Pe.box.length>0),ee=ee&&Pe.offscreen,pe=Pe.occluded}let Tt=M||G.numHorizontalGlyphVertices===0&&te===0,zn=S||G.numIconVertices===0;if(Tt||zn?zn?Tt||(K=K&&se):se=K&&se:K=se=K&&se,se&&Me&&Me.box&&this.collisionIndex.insertCollisionBox(Me.box,u.get("text-ignore-placement"),l.bucketInstanceId,Te&&Te.box&&tt?tt:et,E.ID),K&&Pe&&this.collisionIndex.insertCollisionBox(Pe.box,u.get("icon-ignore-placement"),l.bucketInstanceId,lt,E.ID),ge&&(se&&this.collisionIndex.insertCollisionCircles(ge.circles,u.get("text-ignore-placement"),l.bucketInstanceId,et,E.ID),o)){let Gt=l.bucketInstanceId,kt=this.collisionCircleArrays[Gt];kt===void 0&&(kt=this.collisionCircleArrays[Gt]=new Tq);for(let St=0;St<ge.circles.length;St+=4)kt.circles.push(ge.circles[St+0]),kt.circles.push(ge.circles[St+1]),kt.circles.push(ge.circles[St+2]),kt.circles.push(ge.collisionDetected?1:0)}let Dn=l.projection.name!=="globe";N=N&&(Dn||!de),B=B&&(Dn||!pe),this.placements[Q]=new jE(se||N,K||B,ee||l.justReloaded),n.add(Q)};if(k&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,this.retainedQueryData[l.bucketInstanceId].tileID),l.updateZOffset()),F){let G=l.getSortedSymbolIndexes(this.transform.angle);for(let Y=G.length-1;Y>=0;--Y){let U=G[Y];H(l.symbolInstances.get(U),U,l.collisionArrays[U])}l.hasAnyZOffset&&J(`${l.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(l.hasAnyZOffset){let G=l.getSortedIndexesByZOffset();for(let Y=0;Y<G.length;++Y){let U=G[Y];H(l.symbolInstances.get(U),U,l.collisionArrays[U])}}else for(let G=e.symbolInstanceStart;G<e.symbolInstanceEnd;G++)H(l.symbolInstances.get(G),G,l.collisionArrays[G]);if(o&&l.bucketInstanceId in this.collisionCircleArrays){let G=this.collisionCircleArrays[l.bucketInstanceId];ae.invert(G.invProjMatrix,d),G.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}markUsedJustification(e,n,o,s){let{leftJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,rightJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:f,crossTileID:p}=o,g=rE(n),_=s===rr.vertical?f:g==="left"?l:g==="center"?u:g==="right"?d:-1;l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=_>=0&&l!==_?0:p),u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=_>=0&&u!==_?0:p),d>=0&&(e.text.placedSymbolArray.get(d).crossTileID=_>=0&&d!==_?0:p),f>=0&&(e.text.placedSymbolArray.get(f).crossTileID=_>=0&&f!==_?0:p)}markUsedOrientation(e,n,o){let s=n===rr.horizontal||n===rr.horizontalOnly?n:0,l=n===rr.vertical?n:0,{leftJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:d,rightJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:p}=o,g=e.text.placedSymbolArray;u>=0&&(g.get(u).placedOrientation=s),d>=0&&(g.get(d).placedOrientation=s),f>=0&&(g.get(f).placedOrientation=s),p>=0&&(g.get(p).placedOrientation=l)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let n=this.prevPlacement,o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;let s=n?n.symbolFadeChange(e):1,l=n?n.opacities:{},u=n?n.variableOffsets:{},d=n?n.placedOrientations:{};for(let f in this.placements){let p=this.placements[f],g=l[f];g?(this.opacities[f]=new xg(g,s,p.text,p.icon,null,p.clipped),o=o||p.text!==g.text.placed||p.icon!==g.icon.placed):(this.opacities[f]=new xg(null,s,p.text,p.icon,p.skipFade,p.clipped),o=o||p.text||p.icon)}for(let f in l){let p=l[f];if(!this.opacities[f]){let g=new xg(p,s,!1,!1);g.isHidden()||(this.opacities[f]=g,o=o||p.text.placed||p.icon.placed)}}for(let f in u)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=u[f]);for(let f in d)this.placedOrientations[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.placedOrientations[f]=d[f]);o?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){let o=new Set;for(let s of n){let l=s.getBucket(e);l&&s.latestFeatureIndex&&e.fqid===l.layerIds[0]&&(this.updateBucketOpacities(l,o,s.collisionBoxArray),l.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,s.tileID),l.updateZOffset()))}}updateBucketOpacities(e,n,o){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let s=e.layers[0].layout,l=!!e.layers[0].dynamicFilter(),u=new xg(null,0,!1,!1,!0),d=s.get("text-allow-overlap"),f=s.get("icon-allow-overlap"),p=s.get("text-variable-anchor"),g=s.get("text-rotation-alignment")==="map",_=s.get("text-pitch-alignment")==="map",v=new xg(null,0,d&&(f||!e.hasIconData()||s.get("icon-optional")),f&&(d||!e.hasTextData()||s.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(o);let x=(T,E,M)=>{for(let S=0;S<E/4;S++)T.opacityVertexArray.emplaceBack(M)},b=0;for(let T=0;T<e.symbolInstances.length;T++){let E=e.symbolInstances.get(T),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:S,crossTileID:P,numIconVertices:O}=E,A=n.has(P),R=this.opacities[P];A?R=u:R||(R=v,this.opacities[P]=R),n.add(P);let F=M>0||S>0,k=O>0,N=this.placedOrientations[P],B=N===rr.vertical,H=N===rr.horizontal||N===rr.horizontalOnly;if(!F&&!k||R.isHidden()||b++,F){let G=zF(R.text);x(e.text,M,B?jv:G),x(e.text,S,H?jv:G);let Y=R.text.isHidden(),{leftJustifiedTextSymbolIndex:U,centerJustifiedTextSymbolIndex:Q,rightJustifiedTextSymbolIndex:te,verticalPlacedTextSymbolIndex:se}=E,K=e.text.placedSymbolArray,ee=Y||B?1:0;U>=0&&(K.get(U).hidden=ee),Q>=0&&(K.get(Q).hidden=ee),te>=0&&(K.get(te).hidden=ee),se>=0&&(K.get(se).hidden=Y||H?1:0);let de=this.variableOffsets[P];de&&this.markUsedJustification(e,de.anchor,E,N);let pe=this.placedOrientations[P];pe&&(this.markUsedJustification(e,"left",E,pe),this.markUsedOrientation(e,pe,E))}if(k){let G=zF(R.icon),{placedIconSymbolIndex:Y,verticalPlacedIconSymbolIndex:U}=E,Q=e.icon.placedSymbolArray,te=R.icon.isHidden()?1:0;Y>=0&&(x(e.icon,O,B?jv:G),Q.get(Y).hidden=te),U>=0&&(x(e.icon,E.numVerticalIconVertices,H?jv:G),Q.get(U).hidden=te)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let G=e.collisionArrays[T];if(G){let Y=new X(0,0),U=!0;if(G.textBox||G.verticalTextBox){if(p){let te=this.variableOffsets[P];te?(Y=NF(te.anchor,te.width,te.height,te.textOffset,te.textScale),g&&Y._rotate(_?this.transform.angle:-this.transform.angle)):U=!1}l&&(U=!R.clipped),G.textBox&&Bv(e.textCollisionBox.collisionVertexArray,R.text.placed,!U||B,Y.x,Y.y),G.verticalTextBox&&Bv(e.textCollisionBox.collisionVertexArray,R.text.placed,!U||H,Y.x,Y.y)}let Q=U&&!!(!H&&G.verticalIconBox);G.iconBox&&Bv(e.iconCollisionBox.collisionVertexArray,R.icon.placed,Q,E.hasIconTextFit?Y.x:0,E.hasIconTextFit?Y.y:0),G.verticalIconBox&&Bv(e.iconCollisionBox.collisionVertexArray,R.icon.placed,!Q,E.hasIconTextFit?Y.x:0,E.hasIconTextFit?Y.y:0)}}}if(e.fullyClipped=b===0,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){let T=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=T.invProjMatrix,e.placementViewportMatrix=T.viewportMatrix,e.collisionCircleArray=T.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){let o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>e}setStale(){this.stale=!0}}function Bv(t,e,n,o,s){t.emplaceBack(e?1:0,n?1:0,o||0,s||0),t.emplaceBack(e?1:0,n?1:0,o||0,s||0),t.emplaceBack(e?1:0,n?1:0,o||0,s||0),t.emplaceBack(e?1:0,n?1:0,o||0,s||0)}let Cq=Math.pow(2,25),Sq=Math.pow(2,24),Dq=Math.pow(2,17),Aq=Math.pow(2,16),Pq=Math.pow(2,9),Oq=Math.pow(2,8),Rq=Math.pow(2,1);function zF(t){if(t.opacity===0&&!t.placed)return 0;if(t.opacity===1&&t.placed)return 4294967295;let e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Cq+e*Sq+n*Dq+e*Aq+n*Pq+e*Oq+n*Rq+e}let jv=0;class Lq{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&e.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,n,o,s,l){let u=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(u,s,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,l())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,u.sort((d,f)=>d.sortKey-f.sortKey));this._currentPartIndex<u.length;){let d=u[this._currentPartIndex];if(n.placeLayerBucketPart(d,this._seenCrossTileIDs,o,d.symbolInstanceStart===0),this._currentPartIndex++,l())return!0}return!1}}class Fq{constructor(e,n,o,s,l,u,d,f,p){this.placement=new Iq(e,l,u,d,f,p),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=s,this._done=!1}isDone(){return this._done}continuePlacement(e,n,o,s){let l=Zt.now(),u=()=>{let d=Zt.now()-l;return!this._forceFullPlacement&&d>2};for(;this._currentPlacementIndex>=0;){let d=n[e[this._currentPlacementIndex]],f=this.placement.collisionIndex.transform.zoom;if(d.type==="symbol"&&(!d.minzoom||d.minzoom<=f)&&(!d.maxzoom||d.maxzoom>f)){let p=d,g=p.layout.get("symbol-z-elevate"),_=this._inProgressLayer=this._inProgressLayer||new Lq(p),v=os(d.source,d.scope);if(_.continuePlacement(g?s[v]:o[v],this.placement,this._showCollisionBoxes,d,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let BF=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let s=o>>4;if(s!==1)throw new Error(`Got v${s} data when expected v1.`);let l=BF[15&o];if(!l)throw new Error("Unrecognized array type.");let[u]=new Uint16Array(e,2,1),[d]=new Uint32Array(e,4,1);return new Vv(d,u,l,e)}constructor(e,n=64,o=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let l=BF.indexOf(this.ArrayType),u=2*e*this.ArrayType.BYTES_PER_ELEMENT,d=e*this.IndexArrayType.BYTES_PER_ELEMENT,f=(8-d%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${o}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+d+f,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+u+d+f),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+d+f,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return UE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:u,nodeSize:d}=this,f=[0,l.length-1,0],p=[];for(;f.length;){let g=f.pop()||0,_=f.pop()||0,v=f.pop()||0;if(_-v<=d){for(let E=v;E<=_;E++){let M=u[2*E],S=u[2*E+1];M>=e&&M<=o&&S>=n&&S<=s&&p.push(l[E])}continue}let x=v+_>>1,b=u[2*x],T=u[2*x+1];b>=e&&b<=o&&T>=n&&T<=s&&p.push(l[x]),(g===0?e<=b:n<=T)&&(f.push(v),f.push(x-1),f.push(1-g)),(g===0?o>=b:s>=T)&&(f.push(x+1),f.push(_),f.push(1-g))}return p}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:s,coords:l,nodeSize:u}=this,d=[0,s.length-1,0],f=[],p=o*o;for(;d.length;){let g=d.pop()||0,_=d.pop()||0,v=d.pop()||0;if(_-v<=u){for(let E=v;E<=_;E++)VF(l[2*E],l[2*E+1],e,n)<=p&&f.push(s[E]);continue}let x=v+_>>1,b=l[2*x],T=l[2*x+1];VF(b,T,e,n)<=p&&f.push(s[x]),(g===0?e-o<=b:n-o<=T)&&(d.push(v),d.push(x-1),d.push(1-g)),(g===0?e+o>=b:n+o>=T)&&(d.push(x+1),d.push(_),d.push(1-g))}return f}}function UE(t,e,n,o,s,l){if(s-o<=n)return;let u=o+s>>1;jF(t,e,u,o,s,l),UE(t,e,n,o,u-1,1-l),UE(t,e,n,u+1,s,1-l)}function jF(t,e,n,o,s,l){for(;s>o;){if(s-o>600){let p=s-o+1,g=n-o+1,_=Math.log(p),v=.5*Math.exp(2*_/3),x=.5*Math.sqrt(_*v*(p-v)/p)*(g-p/2<0?-1:1);jF(t,e,n,Math.max(o,Math.floor(n-g*v/p+x)),Math.min(s,Math.floor(n+(p-g)*v/p+x)),l)}let u=e[2*n+l],d=o,f=s;for(bg(t,e,o,n),e[2*s+l]>u&&bg(t,e,o,s);d<f;){for(bg(t,e,d,f),d++,f--;e[2*d+l]<u;)d++;for(;e[2*f+l]>u;)f--}e[2*o+l]===u?bg(t,e,o,f):(f++,bg(t,e,f,s)),f<=n&&(o=f+1),n<=f&&(s=f-1)}}function bg(t,e,n,o){$E(t,n,o),$E(e,2*n,2*o),$E(e,2*n+1,2*o+1)}function $E(t,e,n){let o=t[e];t[e]=t[n],t[n]=o}function VF(t,e,n,o){let s=t-n,l=e-o;return s*s+l*l}let HE=512/ne/2;class kq{constructor(e,n,o){this.tileID=e,this.bucketInstanceId=o,this.index=new Vv(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let s=e.canonical.x*ne,l=e.canonical.y*ne;for(let u=0;u<n.length;u++){let{key:d,crossTileID:f,tileAnchorX:p,tileAnchorY:g}=n.get(u),_=Math.floor((s+p)*HE),v=Math.floor((l+g)*HE);this.index.add(_,v),this.keys.push(d),this.crossTileIDs.push(f)}this.index.finish()}findMatches(e,n,o){let s=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),l=HE/Math.pow(2,n.canonical.z-this.tileID.canonical.z),u=n.canonical.x*ne,d=n.canonical.y*ne;for(let f=0;f<e.length;f++){let p=e.get(f);if(p.crossTileID)continue;let{key:g,tileAnchorX:_,tileAnchorY:v}=p,x=Math.floor((u+_)*l),b=Math.floor((d+v)*l),T=this.index.range(x-s,b-s,x+s,b+s);for(let E of T){let M=this.crossTileIDs[E];if(this.keys[E]===g&&!o.has(M)){o.add(M),p.crossTileID=M;break}}}}}class Nq{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zq{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let n=Math.round((e-this.lng)/360);if(n!==0)for(let o in this.indexes){let s=this.indexes[o],l={};for(let u in s){let d=s[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),l[d.tileID.key]=d}this.indexes[o]=l}this.lng=e}addBucket(e,n,o){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let l=0;l<n.symbolInstances.length;l++)n.symbolInstances.get(l).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);let s=this.usedCrossTileIDs[e.overscaledZ];for(let l in this.indexes){let u=this.indexes[l];if(Number(l)>e.overscaledZ)for(let d in u){let f=u[d];f.tileID.isChildOf(e)&&f.findMatches(n.symbolInstances,e,s)}else{let d=u[e.scaledTo(Number(l)).key];d&&d.findMatches(n.symbolInstances,e,s)}}for(let l=0;l<n.symbolInstances.length;l++){let u=n.symbolInstances.get(l);u.crossTileID||(u.crossTileID=o.generate(),s.add(u.crossTileID))}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new kq(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(let o of n.crossTileIDs)this.usedCrossTileIDs[e].delete(o)}removeStaleBuckets(e){let n=!1;for(let o in this.indexes){let s=this.indexes[o];for(let l in s)e[s[l].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,s[l]),delete s[l],n=!0)}return n}}class Bq{constructor(){this.layerIndexes={},this.crossTileIDs=new Nq,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,o,s){let l=this.layerIndexes[e.fqid];l===void 0&&(l=this.layerIndexes[e.fqid]=new zq);let u=!1,d={};s.name!=="globe"&&l.handleWrapJump(o);for(let f of n){let p=f.getBucket(e);p&&e.fqid===p.layerIds[0]&&(p.bucketInstanceId||(p.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(f.tileID,p,this.crossTileIDs)&&(u=!0),d[p.bucketInstanceId]=!0)}return l.removeStaleBuckets(d)&&(u=!0),u}pruneUnusedLayers(e){let n={};e.forEach(o=>{n[o]=!0});for(let o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}var UF=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,$F="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",HF=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,GF=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,WF=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,qF=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ZF=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,YF=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let XF=[];Hv(UF,XF);let Uv={"_prelude_fog.vertex.glsl":GF,"_prelude_terrain.vertex.glsl":HF,"_prelude_shadow.vertex.glsl":ZF,"_prelude_fog.fragment.glsl":WF,"_prelude_shadow.fragment.glsl":YF,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":qF},$v={};di("",HF),di(WF,GF),di(YF,ZF),di(qF,"");let KF=di(`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif`,`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`),JF=UF;var QF={background:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:di("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:di(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:di("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:di("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:di("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#ifdef RENDER_CUTOFF
invariant gl_Position;
#endif
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),fillExtrusionDepth:di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:di(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:di(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;
#ifdef FORCE_ABS_FL_GROUND_RADIUS
fl_ground_radius=abs(flood_light_ground_radius);
#endif
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:di(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#elif defined(PROJECTION_GLOBE_VIEW)
in vec2 a_pos;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
uv=a_texture_pos/8192.0;
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:di(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:di(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:di(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:di("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:di(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,$F),skyboxGradient:di(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,$F),skyboxCapture:di(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:di(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:di(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
texColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(diffuse,1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
ao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:di(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:di(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Hv(t,e){let n=t.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let o of n)if(o=o.trim(),o[0]==="#"&&o.includes("if")&&!o.includes("endif")){o=o.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let s=o.split(" ");for(let l of s)e.includes(l)||e.push(l)}}function di(t,e){let n=/#include\s+"([^"]+)"/g,o=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,s=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);s&&(s=s.map(p=>{let g=p.split(" ");return g[g.length-1]}),s=[...new Set(s)]);let l={},u=[],d=[];t=t.replace(n,(p,g)=>(d.push(g),"")),e=e.replace(n,(p,g)=>(u.push(g),""));let f=[...XF];Hv(t,f),Hv(e,f);for(let p of[...u,...d])Uv[p]||console.error(`Undefined include: ${p}`),$v[p]||($v[p]=[],Hv(Uv[p],$v[p])),f=[...f,...$v[p]];return{fragmentSource:t=t.replace(o,(p,g,_,v,x)=>(l[x]=!0,g==="define"?`
#ifndef HAS_UNIFORM_u_${x}
in ${_} ${v} ${x};
#else
uniform ${_} ${v} u_${x};
#endif
`:g==="initialize"?`
#ifdef HAS_UNIFORM_u_${x}
    ${_} ${v} ${x} = u_${x};
#endif
`:g==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    in ${_} ${v} ${x};
#endif
`:g==="initialize-attribute"?"":void 0)),vertexSource:e=e.replace(o,(p,g,_,v,x)=>{let b=v==="float"?"vec2":v,T=x.match(/color/)?"color":b;return g==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${x}
in ${_} ${v} a_${x};
#endif
`:l[x]?g==="define"?`
#ifndef HAS_UNIFORM_u_${x}
uniform lowp float u_${x}_t;
in ${_} ${b} a_${x};
out ${_} ${v} ${x};
#else
uniform ${_} ${v} u_${x};
#endif
`:g==="initialize"?T==="vec4"?`
#ifndef HAS_UNIFORM_u_${x}
    ${x} = a_${x};
#else
    ${_} ${v} ${x} = u_${x};
#endif
`:`
#ifndef HAS_UNIFORM_u_${x}
    ${x} = unpack_mix_${T}(a_${x}, u_${x}_t);
#else
    ${_} ${v} ${x} = u_${x};
#endif
`:g==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    in ${_} ${v} a_${x};
    out ${_} ${v} ${x};
#endif
`:g==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    ${x} = a_${x};
#endif
`:void 0:g==="define"?`
#ifndef HAS_UNIFORM_u_${x}
uniform lowp float u_${x}_t;
in ${_} ${b} a_${x};
#else
uniform ${_} ${v} u_${x};
#endif
`:g==="define-instanced"?T==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${x}0;
in vec4 a_${x}1;
in vec4 a_${x}2;
in vec4 a_${x}3;
#else
uniform ${_} ${v} u_${x};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${_} ${b} a_${x};
#else
uniform ${_} ${v} u_${x};
#endif
`:g==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    ${_} ${v} ${x} = a_${x};
#endif
`:T==="vec4"?`
#ifndef HAS_UNIFORM_u_${x}
    ${_} ${v} ${x} = a_${x};
#else
    ${_} ${v} ${x} = u_${x};
#endif
`:`
#ifndef HAS_UNIFORM_u_${x}
    ${_} ${v} ${x} = unpack_mix_${T}(a_${x}, u_${x}_t);
#else
    ${_} ${v} ${x} = u_${x};
#endif
`}),staticAttributes:s,usedDefines:f,vertexIncludes:u,fragmentIncludes:d}}class jq{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,n,o,s,l,u,d,f){this.context=e;let p=this.boundPaintVertexBuffers.length!==s.length;for(let _=0;!p&&_<s.length;_++)this.boundPaintVertexBuffers[_]!==s[_]&&(p=!0);let g=this.boundDynamicVertexBuffers.length!==d.length;for(let _=0;!g&&_<d.length;_++)this.boundDynamicVertexBuffers[_]!==d[_]&&(g=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==o||p||g||this.boundIndexBuffer!==l||this.boundVertexOffset!==u)this.freshBind(n,o,s,l,u,d,f);else{e.bindVertexArrayOES.set(this.vao);for(let _ of d)_&&(_.bind(),f&&_.instanceCount&&_.setVertexAttribDivisor(e.gl,n,f));l&&l.dynamicDraw&&l.bind()}}freshBind(e,n,o,s,l,u,d){let f=e.numAttributes,p=this.context,g=p.gl;this.vao&&this.destroy(),this.vao=p.gl.createVertexArray(),p.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=s,this.boundVertexOffset=l,this.boundDynamicVertexBuffers=u,n.enableAttributes(g,e),n.bind(),n.setVertexAttribPointers(g,e,l);for(let _ of o)_.enableAttributes(g,e),_.bind(),_.setVertexAttribPointers(g,e,l);for(let _ of u)_&&(_.enableAttributes(g,e),_.bind(),_.setVertexAttribPointers(g,e,l),d&&_.instanceCount&&_.setVertexAttribDivisor(g,e,d));s&&s.bind(),p.currentNumAttributes=f}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Vq(t,e){let n=Math.pow(2,e.canonical.z),o=e.canonical.y;return[new Fn(0,o/n).toLngLat().lat,new Fn(0,(o+1)/n).toLngLat().lat]}function Uq(t,e,n,o,s,l,u){let d=t.context,f=d.gl,p=n.hillshadeFBO;if(!p)return;t.prepareDrawTile();let g=t.isTileAffectedByFog(e),_=t.getOrCreateProgram("hillshade",{overrideFog:g});d.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,p.colorAttachment.get());let v=((E,M,S,P)=>{let O=S.paint.get("hillshade-shadow-color"),A=S.paint.get("hillshade-highlight-color"),R=S.paint.get("hillshade-accent-color"),F=S.paint.get("hillshade-emissive-strength"),k=Vt(S.paint.get("hillshade-illumination-direction"));if(S.paint.get("hillshade-illumination-anchor")==="viewport")k-=E.transform.angle;else if(E.style&&E.style.enable3dLights()&&E.style.directionalLight){let B=E.style.directionalLight.properties.get("direction");k=Vt(ht(B.x,B.y,B.z)[1])}let N=!E.options.moving;return{u_matrix:P||E.transform.calculateProjMatrix(M.tileID.toUnwrapped(),N),u_image:0,u_latrange:Vq(0,M.tileID),u_light:[S.paint.get("hillshade-exaggeration"),k],u_shadow:O,u_highlight:A,u_emissive_strength:F,u_accent:R}})(t,n,o,t.terrain?e.projMatrix:null);t.uploadCommonUniforms(d,_,e.toUnwrapped());let{tileBoundsBuffer:x,tileBoundsIndexBuffer:b,tileBoundsSegments:T}=t.getTileBoundsBuffers(n);_.draw(t,f.TRIANGLES,s,l,u,bn.disabled,v,o.id,x,b,T)}function ek(t,e,n){if(!e.needsDEMTextureUpload)return;let o=t.context,s=o.gl;o.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(n.stride);let l=n.getPixels();e.demTexture?e.demTexture.update(l,{premultiply:!1}):e.demTexture=new fr(o,l,s.R32F,{premultiply:!1}),e.needsDEMTextureUpload=!1}function $q(t,e,n){let o=t.context,s=o.gl;if(!e.dem)return;let l=e.dem;if(o.activeTexture.set(s.TEXTURE1),ek(t,e,l),!e.demTexture)return;e.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE);let u=l.dim;o.activeTexture.set(s.TEXTURE0);let d=e.hillshadeFBO;if(!d){let v=new fr(o,{width:u,height:u,data:null},s.RGBA);v.bind(s.LINEAR,s.CLAMP_TO_EDGE),d=e.hillshadeFBO=o.createFramebuffer(u,u,!0,"renderbuffer"),d.colorAttachment.set(v.texture)}o.bindFramebuffer.set(d.framebuffer),o.viewport.set([0,0,u,u]);let{tileBoundsBuffer:f,tileBoundsIndexBuffer:p,tileBoundsSegments:g}=t.getMercatorTileBoundsBuffers(),_=[];t.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:_}).draw(t,s.TRIANGLES,$t.disabled,_n.disabled,Hn.unblended,bn.disabled,((v,x)=>{let b=x.stride,T=ae.create();return ae.ortho(T,0,ne,-ne,0,0,1),ae.translate(T,T,[0,-ne,0]),{u_matrix:T,u_image:1,u_dimension:[b,b],u_zoom:v.overscaledZ}})(e.tileID,l),n.id,f,p,g),e.needsHillshadePrepare=!1}let tk=t=>({u_matrix:new nn(t),u_image0:new En(t),u_skirt_height:new Fe(t),u_ground_shadow_factor:new an(t)}),nk=(t,e,n)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:n}),ik=(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(o),u_merc_matrix:n,u_zoom_transition:s,u_merc_center:l,u_image0:0,u_frustum_tl:u,u_frustum_tr:d,u_frustum_br:f,u_frustum_bl:p,u_globe_pos:g,u_globe_radius:_,u_viewport:v,u_grid_matrix:b?Float32Array.from(b):new Float32Array(9),u_skirt_height:x}),ap=(t,e)=>{if(e>0&&t.terrain&&J("Cutoff is currently disabled on terrain"),e<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};let n=t.transform,o=Math.max(Math.abs(n._zoom-(t.minCutoffZoom-1)),1),s=n.isLODDisabled(!1)?Si(60,45,n.pitch):Si(30,15,n.pitch),l=n._farZ-n._nearZ,u=e*n.height,d=((1-(f=s))*(.75*n.cameraToCenterDistance)+f*(n._farZ+u))*o;var f;return{shouldRenderCutoff:s<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(d-n._nearZ)/l,(d-u-n._nearZ)/l]}}};function rk(t,e){return t!=null&&e!=null&&!(!t.hasData()||!e.hasData())&&t.demTexture!=null&&e.demTexture!=null&&t.tileID.key!==e.tileID.key}let lp=new class{constructor(){this.operations={}}newMorphing(t,e,n,o,s){if(t in this.operations){let l=this.operations[t];l.to.tileID.key!==n.tileID.key&&(l.queued=n)}else this.operations[t]={startTime:o,phase:0,duration:s,from:e,to:n,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;let e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(let e in this.operations){let n=this.operations[e];for(n.phase=(t-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},ok={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sk(t,e,n){if(e===0)return 0;let o=e<1&&n===514?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*o}function Hq(t,e){let n=1<<t.z;return!e&&(t.x===0||t.x===n-1)||t.y===0||t.y===n-1}let GE=t=>({u_matrix:t});function ak(t,e,n,o,s){if(s>0){let l=Zt.now(),u=(l-t.timeAdded)/s,d=e?(l-e.timeAdded)/s:-1,f=n.getSource(),p=o.coveringZoomLevel({tileSize:f.tileSize,roundZoom:f.roundZoom}),g=!e||Math.abs(e.tileID.overscaledZ-p)>Math.abs(t.tileID.overscaledZ-p),_=g&&t.refreshedUponExpiration?1:ze(g?u:1-d,0,1);return t.refreshedUponExpiration&&u>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-_}:{opacity:_,mix:0}}return{opacity:1,mix:0}}class Gq extends _l{constructor(e){let n={type:"raster-dem",maxzoom:e.transform.maxZoom},o=new Rv(vg(),null),s=NE("mock-dem",n,o,e.style);super("mock-dem",s,!1),s.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,n){e.state="loaded",n(null)}}class Wq extends _l{constructor(e){let n=NE("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new Rv(vg(),null),e.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,n,o){if(e.freezeTileCoverage)return;this.transform=e;let s=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((l,u)=>{if(l[u.key]="",!this._tiles[u.key]){let d=new lg(u,this._source.tileSize*u.overscaleFactor(),e.tileZoom);d.state="loaded",this._tiles[u.key]=d}return l},{});for(let l in this._tiles)l in s||(this.freeFBO(l),this._tiles[l].unloadVectorData(),delete this._tiles[l])}freeFBO(e){let n=this.proxyCachedFBO[e];if(n!==void 0){let o=Object.values(n);this.renderCachePool.push(...o),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class lk extends qn{constructor(e,n,o){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=n,this.projMatrix=o}}class qq extends MG{constructor(e,n){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[o,s,l]=function(f){let p=new $s,g=new Kr,_=131;p.reserve(17161),g.reserve(33800);let v=ne/128,x=ne+v/2,b=x+v;for(let E=-v;E<b;E+=v)for(let M=-v;M<b;M+=v){let S=M<0||M>x||E<0||E>x?24575:0,P=ze(Math.round(M),0,ne),O=ze(Math.round(E),0,ne);p.emplaceBack(P+S,O)}let T=(E,M)=>{let S=M*_+E;g.emplaceBack(S+1,S,S+_),g.emplaceBack(S+_,S+_+1,S+1)};for(let E=1;E<129;E++)for(let M=1;M<129;M++)T(M,E);return[0,129].forEach(E=>{for(let M=0;M<130;M++)T(M,E),T(E,M)}),[p,g,32768]}(),u=e.context;this.gridBuffer=u.createVertexBuffer(o,Vu.members),this.gridIndexBuffer=u.createIndexBuffer(s),this.gridSegments=Ti.simpleSegment(0,0,o.length,s.length),this.gridNoSkirtSegments=Ti.simpleSegment(0,0,o.length,l),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Wq(n.map),this.orthoMatrix=ae.create(),ae.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,ne,0,ne,0,1);let d=u.gl;this._overlapStencilMode=new _n({func:d.GEQUAL,mask:255},0,255,d.KEEP,d.KEEP,d.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gq(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,n,o){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);let s=e.terrain.properties,l=e.terrain.drapeRenderMode===0,u=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=Zt.now();let d=e.terrain&&e.terrain.scope,f=s.get("source"),p=l?this._mockSourceCache:e.getSourceCache(f,d);if(!p)return void J(`Couldn't find terrain source "${f}".`);if(this.sourceCache=p,this._exaggeration=u?this.calculateExaggeration(n):s.get("exaggeration"),!n.projection.requiresDraping&&u&&this._exaggeration===0)return void this._disable();this.enabled=!0;let g=()=>{this.sourceCache.used&&J(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let _=this.getScaledDemTileSize();this.sourceCache.update(n,_,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),n.updateElevation(!0,o),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(e){let n=this._previousCameraAltitude,o=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=o;let s=n!=null?o-n:Number.MAX_VALUE;if(Math.abs(s)<2)return this._exaggeration;let l=e.zoom,u=this._style.terrain;if(!this._previousUpdateTimestamp)return u.getExaggeration(l);let d=l-this._previousZoom,f=this._previousUpdateTimestamp,p=l;this._evaluationZoom!=null&&(p=this._evaluationZoom,Math.abs(l-p)>.5&&(d=.5*(l-p+d)),d*s<0&&(p+=d)),this._evaluationZoom=p;let g=u.getExaggeration(p),_=g===u.getExaggeration(Math.max(0,p-.1));if(_&&Math.abs(g-this._exaggeration)<.01)return g;let v=Math.min(.1,.00375*(this._updateTimestamp-f));return(_||g<.1||Math.abs(d)<1e-4)&&(v=Math.min(.2,4*v)),Yt(this._exaggeration,g,v)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&e.dataType==="source"?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):e.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let n=this.proxySourceCache,o=this.painter.transform;this._initializing&&(this._initializing=o._centerAltitude===0&&this.getAtPointOrZero(Fn.fromLngLat(o.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let s=this.proxyCoords=n.getIds().map(f=>{let p=n.getTileByID(f).tileID;return p.projMatrix=o.calculateProjMatrix(p.toUnwrapped()),p});(function(f,p){let g=p.transform.pointCoordinate(p.transform.getCameraPoint()),_=new X(g.x,g.y);f.sort((v,x)=>{if(x.overscaledZ-v.overscaledZ)return x.overscaledZ-v.overscaledZ;let b=new X(v.canonical.x+(1<<v.canonical.z)*v.wrap,v.canonical.y),T=new X(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),E=_.mult(1<<v.canonical.z);return E.x-=.5,E.y-=.5,E.distSqr(b)-E.distSqr(T)})})(s,this.painter);let l=this.proxyToSource||{};this.proxyToSource={},s.forEach(f=>{this.proxyToSource[f.key]={}}),this.terrainTileForTile={};let u=this._style._mergedSourceCaches;for(let f in u){let p=u[f];if(!p.used||(p!==this.sourceCache&&this.resetTileLookupCache(p.id),this._setupProxiedCoordsForOrtho(p,e[f],l),p.usedForTerrain))continue;let g=e[f];p.getSource().reparseOverscaled&&this._assignTerrainTiles(g)}this.proxiedCoords[n.id]=s.map(f=>new lk(f,f.key,this.orthoMatrix)),this._assignTerrainTiles(s),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(l),this.renderingToTexture=!1;let d={};this._visibleDemTiles=[];for(let f of this.proxyCoords){let p=this.terrainTileForTile[f.key];if(!p)continue;let g=p.tileID.key;g in d||(this._visibleDemTiles.push(p),d[g]=g)}}_assignTerrainTiles(e){this._initializing||e.forEach(n=>{if(this.terrainTileForTile[n.key])return;let o=this._findTileCoveringTileID(n,this.sourceCache);o&&(this.terrainTileForTile[n.key]=o)})}_prepareDEMTextures(){let e=this.painter.context,n=e.gl;for(let o in this.terrainTileForTile){let s=this.terrainTileForTile[o],l=s.dem;!l||s.demTexture&&!s.needsDEMTextureUpload||(e.activeTexture.set(n.TEXTURE1),ek(this.painter,s,l))}}_prepareDemTileUniforms(e,n,o,s){if(!n||n.demTexture==null)return!1;let l=e.tileID.canonical,u=Math.pow(2,n.tileID.canonical.z-l.z),d=s||"";return o[`u_dem_tl${d}`]=[l.x*u%1,l.y*u%1],o[`u_dem_scale${d}`]=u,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let e=this.painter.context,n=e.gl;if(!this._emptyDepthBufferTexture){let o=new qr({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new fr(e,o,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0,n=this._visibleDemTiles.reduce((o,s)=>{if(!s.dem)return o;let l=s.dem.tree.minimums[0];return l>0&&e++,o+l},0);return e?n/e:0}_updateEmptyDEMTexture(){let e=this.painter.context,n=e.gl;e.activeTexture.set(n.TEXTURE2);let o=this._getLoadedAreaMinimum(),[s,l]=(()=>{let d=new J2({width:1,height:1},new Float32Array([o]));return[n.R32F,d]})();this._emptyDEMTextureDirty=!1;let u=this._emptyDEMTexture;return u?u.update(l,{premultiply:!1}):u=this._emptyDEMTexture=new fr(e,l,s,{premultiply:!1}),u}setupElevationDraw(e,n,o){let s=this.painter.context,l=s.gl,u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};u.u_exaggeration=this.exaggeration();let d=null,f=null,p=1;if(o&&o.morphing&&this._useVertexMorphing){let v=o.morphing.srcDemTile,x=o.morphing.dstDemTile;p=o.morphing.phase,v&&x&&(this._prepareDemTileUniforms(e,v,u,"_prev")&&(f=v),this._prepareDemTileUniforms(e,x,u)&&(d=x))}let g=v=>v&&v.demTexture&&this.painter.linearFloatFilteringSupported()?l.LINEAR:l.NEAREST,_=v=>{u.u_dem_size=v.size[0]===1?1:v.size[0]-2};if(f&&d)s.activeTexture.set(l.TEXTURE2),d.demTexture.bind(g(d),l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE4),f.demTexture.bind(g(f),l.CLAMP_TO_EDGE),d.demTexture&&_(d.demTexture),u.u_dem_lerp=p;else{d=this.terrainTileForTile[e.tileID.key],s.activeTexture.set(l.TEXTURE2);let v=this._prepareDemTileUniforms(e,d,u)?d.demTexture:this.emptyDEMTexture;v.bind(g(d),l.CLAMP_TO_EDGE),_(v)}if(s.activeTexture.set(l.TEXTURE3),o&&o.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),this._depthFBO&&(u.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),u.u_depth_size_inv=[1,1]),o&&o.useMeterToDem&&d){let v=(1<<d.tileID.canonical.z)*Oi(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;u.u_meter_to_dem=v}if(o&&o.labelPlaneMatrixInv&&(u.u_label_plane_matrix_inv=o.labelPlaneMatrixInv),n.setTerrainUniformValues(s,u),this.painter.transform.projection.name==="globe"){let v=this.globeUniformValues(this.painter.transform,e.tileID.canonical,o&&o.useDenormalizedUpVectorScale);n.setGlobeUniformValues(s,v)}}globeUniformValues(e,n,o){let s=e.projection;return{u_tile_tl_up:s.upVector(n,0,0),u_tile_tr_up:s.upVector(n,ne,0),u_tile_br_up:s.upVector(n,ne,ne),u_tile_bl_up:s.upVector(n,0,ne),u_tile_up_scale:o?ky(1):s.upVectorScale(n,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){let n=this.painter,o=this.painter.context;e.length!==0&&(o.bindFramebuffer.set(null),o.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(s,l,u,d,f){if(s.transform.projection.name==="globe")(function(p,g,_,v,x){let b=p.context,T=b.gl,E,M,S=p.transform,P=A2(p,b,S),O=(Y,U)=>{if(M===U)return;let Q=[ok[U],"PROJECTION_GLOBE_VIEW"];P&&Q.push("CUSTOM_ANTIALIASING");let te=p.isTileAffectedByFog(Y);E=p.getOrCreateProgram("globeRaster",{defines:Q,overrideFog:te}),M=U},A=p.colorModeForRenderPass(),R=new $t(T.LEQUAL,$t.ReadWrite,p.depthRangeFor3D);lp.update(x);let F=S2(S),k=[ao(S.center.lng),po(S.center.lat)],N=p.globeSharedBuffers,B=[S.width*Zt.devicePixelRatio,S.height*Zt.devicePixelRatio],H=Float32Array.from(S.globeMatrix),G={useDenormalizedUpVectorScale:!0};{let Y=p.transform,U=sk(Y.zoom,g.exaggeration(),g.sourceCache._source.tileSize);M=-1;let Q=T.TRIANGLES;for(let te of v){let se=_.getTile(te),K=_n.disabled,ee=g.prevTerrainTileForTile[te.key],de=g.terrainTileForTile[te.key];rk(ee,de)&&lp.newMorphing(te.key,ee,de,x,250),b.activeTexture.set(T.TEXTURE0),se.texture&&se.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE);let pe=lp.getMorphValuesForProxy(te.key),fe=pe?1:0;pe&&tr(G,{morphing:{srcDemTile:pe.from,dstDemTile:pe.to,phase:Ko(pe.phase)}});let be=Ny(te.canonical),Te=pH(be.getCenter().lat),Me=P2(te.canonical,be,Te,Y.worldSize/Y._pixelsPerMercatorPixel),ge=$u(ga(te.canonical)),Pe=ik(Y.expandedFarZProjMatrix,H,F,ge,Do(Y.zoom),k,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,B,U,Me);if(O(te,fe),E&&(g.setupElevationDraw(se,E,G),p.uploadCommonUniforms(b,E,te.toUnwrapped()),N)){let[et,tt,lt]=N.getGridBuffers(Te,U!==0);E.draw(p,Q,R,K,A,bn.backCCW,Pe,"globe_raster",et,tt,lt)}}}if(N&&(p.renderDefaultNorthPole||p.renderDefaultSouthPole)){let Y=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];P&&Y.push("CUSTOM_ANTIALIASING"),E=p.getOrCreateProgram("globeRaster",{defines:Y});for(let U of v){let{x:Q,y:te,z:se}=U.canonical,K=te===0,ee=te===(1<<se)-1,[de,pe,fe,be]=N.getPoleBuffers(se,!1);if(be&&(K||ee)){let Te=_.getTile(U);b.activeTexture.set(T.TEXTURE0),Te.texture&&Te.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE);let Me=D2(se,Q,S),ge=$u(ga(U.canonical)),Pe=(et,tt)=>et.draw(p,T.TRIANGLES,R,_n.disabled,A,bn.disabled,ik(S.expandedFarZProjMatrix,Me,Me,ge,0,k,S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.globeCenterInViewSpace,S.globeRadius,B,0),"globe_pole_raster",tt,fe,be);g.setupElevationDraw(Te,E,G),p.uploadCommonUniforms(b,E,U.toUnwrapped()),K&&p.renderDefaultNorthPole&&Pe(E,de),ee&&p.renderDefaultSouthPole&&(Me=ae.scale(ae.create(),Me,[1,-1,1]),Pe(E,pe))}}}})(s,l,u,d,f);else{let p=s.context,g=p.gl,_,v,x=s.shadowRenderer,b=ap(s,s.longestCutoffRange),T=A=>{if(v===A)return;let R=[];R.push(ok[A]),b.shouldRenderCutoff&&R.push("RENDER_CUTOFF"),_=s.getOrCreateProgram("terrainRaster",{defines:R}),v=A},E=s.colorModeForRenderPass(),M=new $t(g.LEQUAL,$t.ReadWrite,s.depthRangeFor3D);lp.update(f);let S=s.transform,P=sk(S.zoom,l.exaggeration(),l.sourceCache._source.tileSize),O=[0,0,0];if(x){let A=s.style.directionalLight,R=s.style.ambientLight;A&&R&&(O=XE(A,R))}{v=-1;let A=g.TRIANGLES,[R,F]=[l.gridIndexBuffer,l.gridSegments];for(let k of d){let N=u.getTile(k),B=_n.disabled,H=l.prevTerrainTileForTile[k.key],G=l.terrainTileForTile[k.key];rk(H,G)&&lp.newMorphing(k.key,H,G,f,250),p.activeTexture.set(g.TEXTURE0),N.texture&&N.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE);let Y=lp.getMorphValuesForProxy(k.key),U=Y?1:0,Q;Y&&(Q={morphing:{srcDemTile:Y.from,dstDemTile:Y.to,phase:Ko(Y.phase)}});let te=nk(k.projMatrix,Hq(k.canonical,S.renderWorldCopies)?P/10:P,O);if(T(U),!_)continue;l.setupElevationDraw(N,_,Q);let se=k.toUnwrapped();x&&x.setupShadows(se,_),s.uploadCommonUniforms(p,_,se,null,b),_.draw(s,A,M,B,E,bn.backCCW,te,"terrain_raster",l.gridBuffer,R,F)}}}}(n,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(this._drapedRenderBatches.length===0)return e+1;this.renderingToTexture=!0;let n=this.painter,o=this.painter.context,s=this.proxySourceCache,l=this.proxiedCoords[s.id],u=this._drapedRenderBatches.shift(),d=n.style.order,f=[],p=0;for(let g of l){let _=s.getTileByID(g.proxyTileKey),v=s.proxyCachedFBO[g.key]?s.proxyCachedFBO[g.key][e]:void 0,x=v!==void 0?s.renderCache[v]:this.pool[p++],b=v!==void 0;if(_.texture=x.tex,b&&!x.dirty){f.push(_.tileID);continue}let T;o.bindFramebuffer.set(x.fb.framebuffer),this.renderedToTile=!1,x.dirty&&(o.clear({color:tn.transparent,stencil:0}),x.dirty=!1);for(let E=u.start;E<=u.end;++E){let M=n.style._mergedLayers[d[E]];if(M.isHidden(n.transform.zoom))continue;let S=n.style.getLayerSourceCache(M),P=S?this.proxyToSource[g.key][S.id]:[g];if(!P)continue;let O=P;o.viewport.set([0,0,x.fb.width,x.fb.height]),T!==(S?S.id:null)&&(this._setupStencil(x,P,M,S),T=S?S.id:null),n.renderLayer(n,S,M,O)}if(this._drapedRenderBatches.length===0)for(let E of this._pendingGroundEffectLayers){let M=n.style._mergedLayers[d[E]];if(M.isHidden(n.transform.zoom))continue;let S=n.style.getLayerSourceCache(M),P=S?this.proxyToSource[g.key][S.id]:[g];if(!P)continue;let O=P;o.viewport.set([0,0,x.fb.width,x.fb.height]),T!==(S?S.id:null)&&(this._setupStencil(x,P,M,S),T=S?S.id:null),n.renderLayer(n,S,M,O)}this.renderedToTile?(x.dirty=!0,f.push(_.tileID)):b||--p,p===5&&(p=0,this.renderToBackBuffer(f))}return this.renderToBackBuffer(f),this.renderingToTexture=!1,o.bindFramebuffer.set(null),o.viewport.set([0,0,n.width,n.height]),u.end+1}postRender(){}isLayerOrderingCorrect(e){let n=e.order.length,o=-1,s=n;for(let l=0;l<n;++l)this._style.isLayerDraped(e._mergedLayers[e.order[l]])?o=Math.max(o,l):s=Math.min(s,l);return s>o}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{e=Math.min(e,n.dem.tree.minimums[0])}),e===0?e:(e-30)*this._exaggeration}raycast(e,n,o){if(!this._visibleDemTiles)return null;let s=this._visibleDemTiles.filter(l=>l.dem).map(l=>{let u=l.tileID,d=1<<u.overscaledZ,{x:f,y:p}=u.canonical,g=f/d,_=(f+1)/d,v=p/d,x=(p+1)/d;return{minx:g,miny:v,maxx:_,maxy:x,t:l.dem.tree.raycastRoot(g,v,_,x,e,n,o),tile:l}});s.sort((l,u)=>(l.t!==null?l.t:Number.MAX_VALUE)-(u.t!==null?u.t:Number.MAX_VALUE));for(let l of s){if(l.t==null)return null;let u=l.tile.dem.tree.raycast(l.minx,l.miny,l.maxx,l.maxy,e,n,o);if(u!=null)return u}return null}_createFBO(){let e=this.painter.context,n=e.gl,o=this.drapeBufferSize;e.activeTexture.set(n.TEXTURE0);let s=new fr(e,{width:o[0],height:o[1],data:null},n.RGBA);s.bind(n.LINEAR,n.CLAMP_TO_EDGE);let l=e.createFramebuffer(o[0],o[1],!0,null);return l.colorAttachment.set(s.texture),l.depthAttachment=new eW(e,l.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,o[0],o[1]),this._stencilRef=0,l.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):l.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:l,tex:s,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(let e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{let n=this._style._mergedLayers[e],o=n.isHidden(this.painter.transform.zoom);return n.type==="custom"?!o&&n.shouldRedrape():!o&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let e=!1;for(let o of this._style.getSources())if(o instanceof vF){e=!0;break}if(!e)return;let n={};for(let o=0;o<this._style.order.length;++o){let s=this._style._mergedLayers[this._style.order[o]],l=this._style.getLayerSourceCache(s);if(l&&!n[l.id]&&!s.isHidden(this.painter.transform.zoom)&&s.type==="line"&&s.widthExpression()instanceof Ru){n[l.id]=!0;for(let u of this.proxyCoords){let d=this.proxyToSource[u.key][l.id];if(d)for(let f of d)this._clearRenderCacheForTile(l.id,f)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o]._source instanceof IE){e=!0;break}if(!e)return;let n={};for(let o=0;o<this._style.order.length;++o){let s=this._style._mergedLayers[this._style.order[o]],l=this._style.getLayerSourceCache(s);if(!l||n[l.id]||s.isHidden(this.painter.transform.zoom)||s.type!=="raster")continue;let u=s.paint.get("raster-fade-duration");for(let d of this.proxyCoords){let f=this.proxyToSource[d.key][l.id];if(f)for(let p of f){let g=ak(l.getTile(p),l.findLoadedParent(p,0),l,this.painter.transform,u);(g.opacity!==1||g.mix!==0)&&this._clearRenderCacheForTile(l.id,p)}}}}_setupDrapedRenderBatches(){let e=this._style.order,n=e.length;if(n===0)return;let o=[];this._pendingGroundEffectLayers=[];let s,l=0,u=this._style._mergedLayers[e[l]];for(;!this._style.isLayerDraped(u)&&u.isHidden(this.painter.transform.zoom)&&++l<n;)u=this._style._mergedLayers[e[l]];for(;l<n;++l){let d=this._style._mergedLayers[e[l]];d.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(d)?s===void 0&&(s=l):(d.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(l),s!==void 0&&(o.push({start:s,end:l-1}),s=void 0)))}if(s!==void 0&&o.push({start:s,end:l-1}),o.length!==0){let d=o[o.length-1];this._pendingGroundEffectLayers.every(p=>p>d.end)||J("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=o}_setupRenderCache(e){let n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){let u=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let d=0;d<u.length;++d){let f=Object.values(u[d]);n.renderCachePool.push(...f)}}return}this._clearRasterLayersFromRenderCache();let o=this.proxyCoords,s=this._tilesDirty;for(let u=o.length-1;u>=0;u--){let d=o[u];if(n.getTileByID(d.key),n.proxyCachedFBO[d.key]!==void 0){let f=e[d.key],p=this.proxyToSource[d.key],g=0;for(let _ in p){let v=p[_],x=f[_];if(!x||x.length!==v.length||v.some((b,T)=>b!==x[T]||s[_]&&s[_].hasOwnProperty(b.key))){g=-1;break}++g}for(let _ in n.proxyCachedFBO[d.key])n.renderCache[n.proxyCachedFBO[d.key][_]].dirty=g<0||g!==Object.values(f).length}}let l=[...this._drapedRenderBatches];l.sort((u,d)=>d.end-d.start-(u.end-u.start));for(let u of l)for(let d of o){if(n.proxyCachedFBO[d.key])continue;let f=n.renderCachePool.pop();f===void 0&&n.renderCache.length<50&&(f=n.renderCache.length,n.renderCache.push(this._createFBO())),f!==void 0&&(n.proxyCachedFBO[d.key]={},n.proxyCachedFBO[d.key][u.start]=f,n.renderCache[f].dirty=!0)}this._tilesDirty={}}_setupStencil(e,n,o,s){if(!s||!this._sourceTilesOverlap[s.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let l=this.painter.context,u=l.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let d;if(o.isTileClipped())d=n.length,this._overlapStencilMode.test={func:u.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);d=1,this._overlapStencilMode.test={func:u.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+d>255&&(l.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=d,this._overlapStencilMode.ref=this._stencilRef,o.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):_n.disabled}_renderTileClippingMasks(e,n){let o=this.painter,s=this.painter.context,l=s.gl;o._tileClippingMaskIDs={},s.setColorMode(Hn.disabled),s.setDepthMode($t.disabled);let u=o.getOrCreateProgram("clippingMask");for(let d of e){let f=o._tileClippingMaskIDs[d.key]=--n;u.draw(o,l.TRIANGLES,$t.disabled,new _n({func:l.ALWAYS,mask:0},f,255,l.KEEP,l.KEEP,l.REPLACE),Hn.disabled,bn.disabled,GE(d.projMatrix),"$clipping",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments)}}pointCoordinate(e){let n=this.painter.transform;if(e.x<0||e.x>n.width||e.y<0||e.y>n.height)return null;let o=[e.x,e.y,1,1];Ei.transformMat4(o,o,n.pixelMatrixInverse),Ei.scale(o,o,1/o[3]),o[0]/=n.worldSize,o[1]/=n.worldSize;let s=n._camera.position,l=Oi(1,n.center.lat),u=[s[0],s[1],s[2]/l,0],d=Z.subtract([],o.slice(0,3),u);Z.normalize(d,d);let f=this.raycast(u,d,this._exaggeration);return f!==null&&f?(Z.scaleAndAdd(u,u,d,f),u[3]=u[2],u[2]*=l,u):null}drawDepth(){let e=this.painter,n=e.context,o=this.proxySourceCache,s=Math.ceil(e.width),l=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===s&&this._depthFBO.height===l||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let u=n.gl,d=n.createFramebuffer(s,l,!0,"renderbuffer");n.activeTexture.set(u.TEXTURE0);let f=new fr(n,{width:s,height:l,data:null},u.RGBA);f.bind(u.NEAREST,u.CLAMP_TO_EDGE),d.colorAttachment.set(f.texture);let p=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,s,l);d.depthAttachment.set(p),this._depthFBO=d,this._depthTexture=f}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,s,l]),function(u,d,f,p){if(u.transform.projection.name==="globe")return;let g=u.context,_=g.gl;g.clear({depth:1});let v=u.getOrCreateProgram("terrainDepth"),x=new $t(_.LESS,$t.ReadWrite,u.depthRangeFor3D);for(let b of p){let T=f.getTile(b),E=nk(b.projMatrix,0,[0,0,0]);d.setupElevationDraw(T,v),v.draw(u,_.TRIANGLES,x,_n.disabled,Hn.unblended,bn.backCCW,E,"terrain_depth",d.gridBuffer,d.gridIndexBuffer,d.gridNoSkirtSegments)}}(e,this,o,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,n,o){if(e.getSource()instanceof Ga)return this._setupProxiedCoordsForImageSource(e,n,o);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};let s=this.proxiedCoords[e.id]=[],l=this.proxyCoords;for(let d=0;d<l.length;d++){let f=l[d],p=this._findTileCoveringTileID(f,e);if(p){let g=this._createProxiedId(f,p,o[f.key]&&o[f.key][e.id]);s.push(g),this.proxyToSource[f.key][e.id]=[g]}}let u=!1;for(let d=0;d<n.length;d++){let f=e.getTile(n[d]);if(!f||!f.hasData())continue;let p=this._findTileCoveringTileID(f.tileID,this.proxySourceCache);if(p&&p.tileID.canonical.z!==f.tileID.canonical.z){let g=this.proxyToSource[p.tileID.key][e.id],_=this._createProxiedId(p.tileID,f,o[p.tileID.key]&&o[p.tileID.key][e.id]);g?g.splice(g.length-1,0,_):this.proxyToSource[p.tileID.key][e.id]=[_],s.push(_),u=!0}}this._sourceTilesOverlap[e.id]=u}_setupProxiedCoordsForImageSource(e,n,o){if(!e.getSource().loaded())return;let s=this.proxiedCoords[e.id]=[],l=this.proxyCoords,u=e.getSource(),d=u.tileID;if(!d)return;let f=new X(d.x,d.y)._div(1<<d.z),p=u.coordinates.map(Fn.fromLngLat).reduce((_,v)=>(_.min.x=Math.min(_.min.x,v.x-f.x),_.min.y=Math.min(_.min.y,v.y-f.y),_.max.x=Math.max(_.max.x,v.x-f.x),_.max.y=Math.max(_.max.y,v.y-f.y),_),{min:new X(Number.MAX_VALUE,Number.MAX_VALUE),max:new X(-Number.MAX_VALUE,-Number.MAX_VALUE)}),g=(_,v)=>{let x=_.wrap+_.canonical.x/(1<<_.canonical.z),b=_.canonical.y/(1<<_.canonical.z),T=ne/(1<<_.canonical.z),E=v.wrap+v.canonical.x/(1<<v.canonical.z),M=v.canonical.y/(1<<v.canonical.z);return x+T<E+p.min.x||x>E+p.max.x||b+T<M+p.min.y||b>M+p.max.y};for(let _=0;_<l.length;_++){let v=l[_];for(let x=0;x<n.length;x++){let b=e.getTile(n[x]);if(!b||!b.hasData()||g(v,b.tileID))continue;let T=this._createProxiedId(v,b,o[v.key]&&o[v.key][e.id]),E=this.proxyToSource[v.key][e.id];E?E.push(T):this.proxyToSource[v.key][e.id]=[T],s.push(T)}}}_createProxiedId(e,n,o){let s=this.orthoMatrix;if(o){let l=o.find(u=>u.key===n.tileID.key);if(l)return l}if(n.tileID.key!==e.key){let l=e.canonical.z-n.tileID.canonical.z,u,d,f;s=ae.create();let p=n.tileID.wrap-e.wrap<<e.overscaledZ;l>0?(u=ne>>l,d=u*((n.tileID.canonical.x<<l)-e.canonical.x+p),f=u*((n.tileID.canonical.y<<l)-e.canonical.y)):(u=ne<<-l,d=ne*(n.tileID.canonical.x-(e.canonical.x+p<<-l)),f=ne*(n.tileID.canonical.y-(e.canonical.y<<-l))),ae.ortho(s,0,u,0,u,0,1),ae.translate(s,s,[d,f,0])}return new lk(n.tileID,e.key,s)}_findTileCoveringTileID(e,n){let o=n.getTile(e);if(o&&o.hasData())return o;let s=this._findCoveringTileCache[n.id],l=s[e.key];if(o=l?n.getTileByID(l):null,o&&o.hasData()||l===null)return o;let u=o?o.tileID:e,d=u.overscaledZ,f=n.getSource().minzoom,p=[];if(!l){let _=n.getSource().maxzoom;if(e.canonical.z>=_){let v=e.canonical.z-_;n.getSource().reparseOverscaled?(d=Math.max(e.canonical.z+2,n.transform.tileZoom),u=new qn(d,e.wrap,_,e.canonical.x>>v,e.canonical.y>>v)):v!==0&&(d=_,u=new qn(d,e.wrap,_,e.canonical.x>>v,e.canonical.y>>v))}u.key!==e.key&&(p.push(u.key),o=n.getTile(u))}let g=_=>{p.forEach(v=>{s[v]=_}),p.length=0};for(d-=1;d>=f&&(!o||!o.hasData());d--){o&&g(o.tileID.key);let _=u.calculateScaledKey(d);if(o=n.getTileByID(_),o&&o.hasData())break;let v=s[_];if(v===null)break;v===void 0?p.push(_):o=n.getTileByID(v)}return g(o?o.tileID.key:null),o&&o.hasData()?o:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,n){let o=this._tilesDirty[e];o||(o=this._tilesDirty[e]={}),o[n.key]=!0}}function Zq(t,e,n){let o=function(d,f,p){let g=Z.dot(f,d),_=Z.dot(p,[.2126,.7152,.0722]),v=(b,T,E)=>(1-E)*b+E*T,x=v(1-.3*Math.min(_,1),1,Math.min(g+1,1));return v(.92,1,Math.asin(ze(f[2],-1,1))/Math.PI+.5)*x}(t,[0,0,1],e),s=[0,0,0];Z.scale(s,n.slice(0,3),o);let l=[0,0,0];Z.scale(l,e.slice(0,3),t[2]);let u=[0,0,0];return Z.add(u,s,l),Hi(u)}let Yq=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Xq=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class ck{static cacheKey(e,n,o,s){let l=`${n}${s?s.cacheKey:""}`;for(let u of o)e.usedDefines.includes(u)&&(l+=`/${u}`);return l}constructor(e,n,o,s,l,u){let d=e.gl;this.program=d.createProgram(),this.configuration=s,this.name=n,this.fixedDefines=[...u];let f=s?s.getBinderAttributes():[],p=(o.staticAttributes||[]).concat(f),g=s?s.defines():[];g=g.concat(u.map(E=>`#define ${E}`));let _=`#version 300 es
`,v=_+g.concat("precision mediump float;",JF,KF.fragmentSource).join(`
`);for(let E of o.fragmentIncludes)v+=`
${Uv[E]}`;v+=`
${o.fragmentSource}`;let x=_+g.concat("precision highp float;",JF,KF.vertexSource).join(`
`);for(let E of o.vertexIncludes)x+=`
${Uv[E]}`;x+=`
${o.vertexSource}`;let b=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);d.shaderSource(b,v),d.compileShader(b),d.attachShader(this.program,b);let T=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())this.failedToCreate=!0;else{d.shaderSource(T,x),d.compileShader(T),d.attachShader(this.program,T),this.attributes={},this.numAttributes=p.length;for(let E=0;E<this.numAttributes;E++)if(p[E]){let M=p[E].startsWith("a_")?p[E]:`a_${p[E]}`;d.bindAttribLocation(this.program,E,M),this.attributes[M]=E}d.linkProgram(this.program),d.deleteShader(T),d.deleteShader(b),this.fixedUniforms=l(e),this.binderUniforms=s?s.getUniforms(e):[],u.includes("TERRAIN")&&(this.terrainUniforms=(E=>({u_dem:new En(E),u_dem_prev:new En(E),u_dem_tl:new Mn(E),u_dem_scale:new Fe(E),u_dem_tl_prev:new Mn(E),u_dem_scale_prev:new Fe(E),u_dem_size:new Fe(E),u_dem_lerp:new Fe(E),u_exaggeration:new Fe(E),u_depth:new En(E),u_depth_size_inv:new Mn(E),u_meter_to_dem:new Fe(E),u_label_plane_matrix_inv:new nn(E)}))(e)),u.includes("GLOBE")&&(this.globeUniforms=(E=>({u_tile_tl_up:new an(E),u_tile_tr_up:new an(E),u_tile_br_up:new an(E),u_tile_bl_up:new an(E),u_tile_up_scale:new Fe(E)}))(e)),u.includes("FOG")&&(this.fogUniforms=(E=>({u_fog_matrix:new nn(E),u_fog_range:new Mn(E),u_fog_color:new Hs(E),u_fog_horizon_blend:new Fe(E),u_fog_vertical_limit:new Mn(E),u_fog_temporal_offset:new Fe(E),u_frustum_tl:new an(E),u_frustum_tr:new an(E),u_frustum_br:new an(E),u_frustum_bl:new an(E),u_globe_pos:new an(E),u_globe_radius:new Fe(E),u_globe_transition:new Fe(E),u_is_globe:new En(E),u_viewport:new Mn(E)}))(e)),u.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(E=>({u_cutoff_params:new Hs(E)}))(e)),u.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(E=>({u_lighting_ambient_color:new an(E),u_lighting_directional_dir:new an(E),u_lighting_directional_color:new an(E),u_ground_radiance:new an(E)}))(e)),u.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(E=>({u_light_matrix_0:new nn(E),u_light_matrix_1:new nn(E),u_fade_range:new Mn(E),u_shadow_normal_offset:new an(E),u_shadow_intensity:new Fe(E),u_shadow_texel_size:new Fe(E),u_shadow_map_resolution:new Fe(E),u_shadow_direction:new an(E),u_shadow_bias:new an(E),u_shadowmap_0:new En(E),u_shadowmap_1:new En(E)}))(e))}}setTerrainUniformValues(e,n){if(!this.terrainUniforms)return;let o=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let s in n)o[s]&&o[s].set(this.program,s,n[s])}}setGlobeUniformValues(e,n){if(!this.globeUniforms)return;let o=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let s in n)o[s]&&o[s].set(this.program,s,n[s])}}setFogUniformValues(e,n){if(!this.fogUniforms)return;let o=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let s in n)o[s].set(this.program,s,n[s])}}setCutoffUniformValues(e,n){if(!this.cutoffUniforms)return;let o=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let s in n)o[s].set(this.program,s,n[s])}}setLightsUniformValues(e,n){if(!this.lightsUniforms)return;let o=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let s in n)o[s].set(this.program,s,n[s])}}setShadowUniformValues(e,n){if(this.failedToCreate||!this.shadowUniforms)return;let o=this.shadowUniforms;e.program.set(this.program);for(let s in n)o[s].set(this.program,s,n[s])}_drawDebugWireframe(e,n,o,s,l,u,d,f,p,g){let _=e.options.wireframe;if(_.terrain===!1&&_.layers2D===!1&&_.layers3D===!1)return;let v=e.context;if(!(!(!_.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!_.layers2D||e._terrain&&e._terrain.renderingToTexture||!Yq.includes(this.name))||!(!_.layers3D||!Xq.includes(this.name))))return;let x=v.gl,b=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,l,v);if(!b)return;let T=[...this.fixedDefines];T.push("DEBUG_WIREFRAME");let E=e.getOrCreateProgram(this.name,{config:this.configuration,defines:T});v.program.set(E.program);let M=(O,A,R)=>{if(A[O]&&R[O])for(let F in A[O])R[O][F]&&R[O][F].set(R.program,F,A[O][F].current)};p&&p.setUniforms(E.program,v,E.binderUniforms,d,{zoom:f}),M("fixedUniforms",this,E),M("terrainUniforms",this,E),M("globeUniforms",this,E),M("fogUniforms",this,E),M("lightsUniforms",this,E),M("shadowUniforms",this,E),b.bind(),v.setColorMode(new Hn([x.ONE,x.ONE_MINUS_SRC_ALPHA,x.ZERO,x.ONE],tn.transparent,[!0,!0,!0,!1])),v.setDepthMode(new $t(n.func===x.LESS?x.LEQUAL:n.func,$t.ReadOnly,n.range)),v.setStencilMode(_n.disabled);let S=3*u.primitiveLength*2,P=3*u.primitiveOffset*2*2;g&&g>1?x.drawElementsInstanced(x.LINES,S,x.UNSIGNED_SHORT,P,g):x.drawElements(x.LINES,S,x.UNSIGNED_SHORT,P),l.bind(),v.program.set(this.program),v.setDepthMode(n),v.setStencilMode(o),v.setColorMode(s)}draw(e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E){let M=e.context,S=M.gl;if(this.failedToCreate)return;M.program.set(this.program),M.setDepthMode(o),M.setStencilMode(s),M.setColorMode(l),M.setCullFace(u);for(let A of Object.keys(this.fixedUniforms))this.fixedUniforms[A].set(this.program,A,d[A]);b&&b.setUniforms(this.program,M,this.binderUniforms,v,{zoom:x});let P={[S.LINES]:2,[S.TRIANGLES]:3,[S.LINE_STRIP]:1}[n],O=E&&E>0?1:void 0;for(let A of _.get()){let R=A.vaos||(A.vaos={});(R[f]||(R[f]=new jq)).bind(M,this,p,b?b.getPaintVertexBuffers():[],g,A.vertexOffset,T||[],O),E&&E>1?S.drawElementsInstanced(n,A.primitiveLength*P,S.UNSIGNED_SHORT,A.primitiveOffset*P*2,E):S.drawElements(n,A.primitiveLength*P,S.UNSIGNED_SHORT,A.primitiveOffset*P*2),n===S.TRIANGLES&&this._drawDebugWireframe(e,o,s,l,g,A,v,x,b,E)}}}function uk(t,e){let n=Math.pow(2,e.tileID.overscaledZ),o=e.tileSize*Math.pow(2,t.transform.tileZoom)/n,s=o*(e.tileID.canonical.x+e.tileID.wrap*n),l=o*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/lh(e,1,t.transform.tileZoom),u_pixel_coord_upper:[s>>16,l>>16],u_pixel_coord_lower:[65535&s,65535&l]}}let Kq=ae.create(),dk=(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T)=>{let E=e.style.light,M=E.properties.get("position"),S=[M.x,M.y,M.z],P=As.create();E.properties.get("anchor")==="viewport"&&(As.fromRotation(P,-e.transform.angle),Z.transformMat3(S,S,P));let O=E.properties.get("color"),A=e.transform,R={u_matrix:t,u_lightpos:S,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+n,u_opacity:o,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Kq,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:s,u_edge_radius:l,u_flood_light_color:_,u_vertical_scale:v,u_flood_light_intensity:x,u_ground_shadow_factor:b,u_emissive_strength:T};return A.projection.name==="globe"&&(R.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],R.u_zoom_transition=f,R.u_inv_rot_matrix=g,R.u_merc_center=p,R.u_up_dir=A.projection.upVector(new Va(0,0,0),p[0]*ne,p[1]*ne),R.u_height_lift=d),R},Jq=(t,e,n)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:n}),Qq=(t,e,n,o,s,l,u,d,f,p,g,_,v,x)=>{let b=dk(t,e,n,o,s,l,u,f,p,g,_,v,x,1,[0,0,0],0),T={u_height_factor:-Math.pow(2,u.overscaledZ)/d.tileSize/8};return Ne(b,uk(e,d),T)},hk=(t,e)=>({u_matrix:t,u_emissive_strength:e}),fk=(t,e,n,o)=>Ne(hk(t,e),uk(n,o)),eZ=(t,e,n)=>({u_matrix:t,u_world:n,u_emissive_strength:e}),tZ=(t,e,n,o,s)=>Ne(fk(t,e,n,o),{u_world:s}),nZ=(t,e,n,o)=>{let s=ne/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.getCameraToCenterDistance(o),u_extrude_scale:[e.pixelsToGLUnits[0]/s,e.pixelsToGLUnits[1]/s]}},pk=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),iZ=ae.create(),rZ=(t,e,n,o,s,l,u)=>{let d=t.transform,f=d.projection.name==="globe",p=f?I2(d.zoom,e.canonical)*d._pixelsPerMercatorPixel:lh(n,1,l),g={u_matrix:e.projMatrix,u_extrude_scale:p,u_intensity:u,u_inv_rot_matrix:iZ,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(f){g.u_inv_rot_matrix=o,g.u_merc_center=s,g.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],g.u_zoom_transition=Do(d.zoom);let _=s[0]*ne,v=s[1]*ne;g.u_up_dir=d.projection.upVector(new Va(0,0,0),_,v)}return g},mk=(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S,P,O,A)=>{return{u_matrix:t,u_normalize_matrix:e,u_globe_matrix:n,u_merc_matrix:o,u_grid_matrix:s,u_tl_parent:l,u_scale_parent:g,u_fade_t:_.mix,u_opacity:_.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(F=v.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(R=v.paint.get("raster-contrast"),R>0?1/(1-R):1+R),u_spin_weights:oZ(v.paint.get("raster-hue-rotate")),u_perspective_transform:x,u_raster_elevation:b,u_tl_br:u,u_zoom_transition:d,u_merc_center:f,u_cutoff_params:p,u_colorization_mix:sZ(E,S),u_colorization_offset:aZ(M,S),u_color_ramp:T,u_texture_offset:[O/(P+2*O),P/(P+2*O)],u_texture_res:[P+2*O,P+2*O],u_emissive_strength:A};var R,F};function oZ(t){t*=Math.PI/180;let e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}function sZ([t,e,n,o],[s,l]){if(s===l)return[0,0,0,0];let u=259/257/(l-s);return[t*u,e*u,n*u,o*u]}function aZ(t,[e,n]){return e===n?0:((t-e)/(n-e)*259-1)/257}let gk=ae.create(),_k=(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M)=>{let S=s.transform,P={u_is_size_zoom_constant:+(t==="constant"||t==="source"),u_is_size_feature_constant:+(t==="constant"||t==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:S.getCameraToCenterDistance(T),u_rotate_symbol:+n,u_aspect_ratio:S.width/S.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:l,u_label_plane_matrix:u,u_coord_matrix:d,u_is_text:+f,u_pitch_with_map:+o,u_texsize:p,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gk,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gk,u_up_vector:[0,-1,0],u_icon_transition:M||0,u_icon_saturation:E};return T.name==="globe"&&(P.u_tile_id=[g.canonical.x,g.canonical.y,1<<g.canonical.z],P.u_zoom_transition=_,P.u_inv_rot_matrix=x,P.u_merc_center=v,P.u_camera_forward=S._camera.forward(),P.u_ecef_origin=function(O,A){let R=[0,0,0],F=$u(ga(A.canonical));return Z.transformMat4(R,R,F),Z.transformMat4(R,R,O),R}(S.globeMatrix,g.toUnwrapped()),P.u_tile_matrix=Float32Array.from(S.globeMatrix),P.u_up_vector=b),P},yk=(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E)=>Ne(_k(t,e,n,o,s,l,u,d,f,p,_,v,x,b,T,E,1),{u_gamma_scale:o?s.transform.getCameraToCenterDistance(E)*Math.cos(s.terrain?0:s.transform._pitch):1,u_device_pixel_ratio:Zt.devicePixelRatio,u_is_halo:+g,undefined:void 0}),lZ=(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T)=>Ne(yk(t,e,n,o,s,l,u,d,!0,f,!0,g,_,v,x,b,T),{u_texsize_icon:p,u_texture_icon:1}),cZ=(t,e,n,o)=>({u_matrix:t,u_emissive_strength:e,u_opacity:n,u_color:o}),uZ=(t,e,n,o,s,l,u)=>Ne(function(d,f,p,g){let _=p.imageManager.getPattern(d.toString(),f),{width:v,height:x}=p.imageManager.getPixelSize(f),b=Math.pow(2,g.tileID.overscaledZ),T=g.tileSize*Math.pow(2,p.transform.tileZoom)/b,E=T*(g.tileID.canonical.x+g.tileID.wrap*b),M=T*g.tileID.canonical.y;return{u_image:0,u_pattern_tl:_.tl,u_pattern_br:_.br,u_texsize:[v,x],u_pattern_size:_.displaySize,u_tile_units_to_pixels:1/lh(g,1,p.transform.tileZoom),u_pixel_coord_upper:[E>>16,M>>16],u_pixel_coord_lower:[65535&E,65535&M]}}(s,l,o,u),{u_matrix:t,u_emissive_strength:e,u_opacity:n}),Zs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},WE=(t,e,n,o,s,l,u,d,f,p,g,_,v=[0,0,0])=>{let x=o.style.light,b=x.properties.get("position"),T=[-b.x,-b.y,b.z],E=As.create();x.properties.get("anchor")==="viewport"&&(As.fromRotation(E,-o.transform.angle),Z.transformMat3(T,T,E));let M=p.alphaMode==="MASK",S=x.properties.get("color"),P=_.paint.get("model-ambient-occlusion-intensity"),O=_.paint.get("model-color").constantOr(tn.white),A=_.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:e,u_normal_matrix:n,u_lightpos:T,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_camera_pos:v,u_opacity:s,u_baseTextureIsAlpha:0,u_alphaMask:+M,u_alphaCutoff:p.alphaCutoff,u_baseColorFactor:[l.r,l.g,l.b,l.a],u_emissiveFactor:[u[0],u[1],u[2],1],u_metallicFactor:d,u_roughnessFactor:f,u_baseColorTexture:Zs.BaseColor,u_metallicRoughnessTexture:Zs.MetallicRoughness,u_normalTexture:Zs.Normal,u_occlusionTexture:Zs.Occlusion,u_emissionTexture:Zs.Emission,u_color_mix:[O.r,O.g,O.b,A],u_aoIntensity:P,u_emissive_strength:g}},vk=new Float32Array(16),xk=(t,e=vk,n=vk)=>({u_matrix:t,u_instance:e,u_node_matrix:n}),dZ={fillExtrusion:t=>({u_matrix:new nn(t),u_lightpos:new an(t),u_lightintensity:new Fe(t),u_lightcolor:new an(t),u_vertical_gradient:new Fe(t),u_opacity:new Fe(t),u_edge_radius:new Fe(t),u_ao:new Mn(t),u_tile_id:new an(t),u_zoom_transition:new Fe(t),u_inv_rot_matrix:new nn(t),u_merc_center:new Mn(t),u_up_dir:new an(t),u_height_lift:new Fe(t),u_flood_light_color:new an(t),u_vertical_scale:new Fe(t),u_flood_light_intensity:new Fe(t),u_ground_shadow_factor:new an(t),u_emissive_strength:new Fe(t)}),fillExtrusionDepth:t=>({u_matrix:new nn(t),u_edge_radius:new Fe(t),u_vertical_scale:new Fe(t)}),fillExtrusionPattern:t=>({u_matrix:new nn(t),u_lightpos:new an(t),u_lightintensity:new Fe(t),u_lightcolor:new an(t),u_vertical_gradient:new Fe(t),u_height_factor:new Fe(t),u_edge_radius:new Fe(t),u_ao:new Mn(t),u_tile_id:new an(t),u_zoom_transition:new Fe(t),u_inv_rot_matrix:new nn(t),u_merc_center:new Mn(t),u_up_dir:new an(t),u_height_lift:new Fe(t),u_image:new En(t),u_texsize:new Mn(t),u_pixel_coord_upper:new Mn(t),u_pixel_coord_lower:new Mn(t),u_tile_units_to_pixels:new Fe(t),u_opacity:new Fe(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new nn(t),u_opacity:new Fe(t),u_ao_pass:new Fe(t),u_meter_to_tile:new Fe(t),u_ao:new Mn(t),u_flood_light_intensity:new Fe(t),u_flood_light_color:new an(t),u_attenuation:new Fe(t),u_edge_radius:new Fe(t),u_fb:new En(t),u_fb_size:new Fe(t)}),fill:t=>({u_matrix:new nn(t),u_emissive_strength:new Fe(t)}),fillPattern:t=>({u_matrix:new nn(t),u_emissive_strength:new Fe(t),u_image:new En(t),u_texsize:new Mn(t),u_pixel_coord_upper:new Mn(t),u_pixel_coord_lower:new Mn(t),u_tile_units_to_pixels:new Fe(t)}),fillOutline:t=>({u_matrix:new nn(t),u_emissive_strength:new Fe(t),u_world:new Mn(t)}),fillOutlinePattern:t=>({u_matrix:new nn(t),u_emissive_strength:new Fe(t),u_world:new Mn(t),u_image:new En(t),u_texsize:new Mn(t),u_pixel_coord_upper:new Mn(t),u_pixel_coord_lower:new Mn(t),u_tile_units_to_pixels:new Fe(t)}),circle:t=>({u_camera_to_center_distance:new Fe(t),u_extrude_scale:new sT(t),u_device_pixel_ratio:new Fe(t),u_matrix:new nn(t),u_inv_rot_matrix:new nn(t),u_merc_center:new Mn(t),u_tile_id:new an(t),u_zoom_transition:new Fe(t),u_up_dir:new an(t),u_emissive_strength:new Fe(t)}),collisionBox:t=>({u_matrix:new nn(t),u_camera_to_center_distance:new Fe(t),u_extrude_scale:new Mn(t)}),collisionCircle:t=>({u_matrix:new nn(t),u_inv_matrix:new nn(t),u_camera_to_center_distance:new Fe(t),u_viewport_size:new Mn(t)}),debug:t=>({u_color:new zf(t),u_matrix:new nn(t),u_overlay:new En(t),u_overlay_scale:new Fe(t)}),clippingMask:t=>({u_matrix:new nn(t)}),heatmap:t=>({u_extrude_scale:new Fe(t),u_intensity:new Fe(t),u_matrix:new nn(t),u_inv_rot_matrix:new nn(t),u_merc_center:new Mn(t),u_tile_id:new an(t),u_zoom_transition:new Fe(t),u_up_dir:new an(t)}),heatmapTexture:t=>({u_image:new En(t),u_color_ramp:new En(t),u_opacity:new Fe(t)}),hillshade:t=>({u_matrix:new nn(t),u_image:new En(t),u_latrange:new Mn(t),u_light:new Mn(t),u_shadow:new zf(t),u_highlight:new zf(t),u_emissive_strength:new Fe(t),u_accent:new zf(t)}),hillshadePrepare:t=>({u_matrix:new nn(t),u_image:new En(t),u_dimension:new Mn(t),u_zoom:new Fe(t)}),line:t=>({u_matrix:new nn(t),u_pixels_to_tile_units:new sT(t),u_device_pixel_ratio:new Fe(t),u_units_to_pixels:new Mn(t),u_dash_image:new En(t),u_gradient_image:new En(t),u_image_height:new Fe(t),u_texsize:new Mn(t),u_tile_units_to_pixels:new Fe(t),u_alpha_discard_threshold:new Fe(t),u_trim_offset:new Mn(t),u_emissive_strength:new Fe(t)}),linePattern:t=>({u_matrix:new nn(t),u_texsize:new Mn(t),u_pixels_to_tile_units:new sT(t),u_device_pixel_ratio:new Fe(t),u_image:new En(t),u_units_to_pixels:new Mn(t),u_tile_units_to_pixels:new Fe(t),u_alpha_discard_threshold:new Fe(t)}),raster:t=>({u_matrix:new nn(t),u_normalize_matrix:new nn(t),u_globe_matrix:new nn(t),u_merc_matrix:new nn(t),u_grid_matrix:new oT(t),u_tl_parent:new Mn(t),u_scale_parent:new Fe(t),u_fade_t:new Fe(t),u_opacity:new Fe(t),u_image0:new En(t),u_image1:new En(t),u_brightness_low:new Fe(t),u_brightness_high:new Fe(t),u_saturation_factor:new Fe(t),u_contrast_factor:new Fe(t),u_spin_weights:new an(t),u_perspective_transform:new Mn(t),u_raster_elevation:new Fe(t),u_tl_br:new Hs(t),u_zoom_transition:new Fe(t),u_merc_center:new Mn(t),u_cutoff_params:new Hs(t),u_colorization_mix:new Hs(t),u_colorization_offset:new Fe(t),u_color_ramp:new En(t),u_texture_offset:new Mn(t),u_texture_res:new Mn(t),u_emissive_strength:new Fe(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new En(t),u_is_size_feature_constant:new En(t),u_size_t:new Fe(t),u_size:new Fe(t),u_camera_to_center_distance:new Fe(t),u_rotate_symbol:new En(t),u_aspect_ratio:new Fe(t),u_fade_change:new Fe(t),u_matrix:new nn(t),u_label_plane_matrix:new nn(t),u_coord_matrix:new nn(t),u_is_text:new En(t),u_pitch_with_map:new En(t),u_texsize:new Mn(t),u_tile_id:new an(t),u_zoom_transition:new Fe(t),u_inv_rot_matrix:new nn(t),u_merc_center:new Mn(t),u_camera_forward:new an(t),u_tile_matrix:new nn(t),u_up_vector:new an(t),u_ecef_origin:new an(t),u_texture:new En(t),u_icon_transition:new Fe(t),u_icon_saturation:new Fe(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new En(t),u_is_size_feature_constant:new En(t),u_size_t:new Fe(t),u_size:new Fe(t),u_camera_to_center_distance:new Fe(t),u_rotate_symbol:new En(t),u_aspect_ratio:new Fe(t),u_fade_change:new Fe(t),u_matrix:new nn(t),u_label_plane_matrix:new nn(t),u_coord_matrix:new nn(t),u_is_text:new En(t),u_pitch_with_map:new En(t),u_texsize:new Mn(t),u_texture:new En(t),u_gamma_scale:new Fe(t),u_device_pixel_ratio:new Fe(t),u_tile_id:new an(t),u_zoom_transition:new Fe(t),u_inv_rot_matrix:new nn(t),u_merc_center:new Mn(t),u_camera_forward:new an(t),u_tile_matrix:new nn(t),u_up_vector:new an(t),u_ecef_origin:new an(t),u_is_halo:new En(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new En(t),u_is_size_feature_constant:new En(t),u_size_t:new Fe(t),u_size:new Fe(t),u_camera_to_center_distance:new Fe(t),u_rotate_symbol:new En(t),u_aspect_ratio:new Fe(t),u_fade_change:new Fe(t),u_matrix:new nn(t),u_label_plane_matrix:new nn(t),u_coord_matrix:new nn(t),u_is_text:new En(t),u_pitch_with_map:new En(t),u_texsize:new Mn(t),u_texsize_icon:new Mn(t),u_texture:new En(t),u_texture_icon:new En(t),u_gamma_scale:new Fe(t),u_device_pixel_ratio:new Fe(t),u_is_halo:new En(t)}),background:t=>({u_matrix:new nn(t),u_emissive_strength:new Fe(t),u_opacity:new Fe(t),u_color:new zf(t)}),backgroundPattern:t=>({u_matrix:new nn(t),u_emissive_strength:new Fe(t),u_opacity:new Fe(t),u_image:new En(t),u_pattern_tl:new Mn(t),u_pattern_br:new Mn(t),u_texsize:new Mn(t),u_pattern_size:new Mn(t),u_pixel_coord_upper:new Mn(t),u_pixel_coord_lower:new Mn(t),u_tile_units_to_pixels:new Fe(t)}),terrainRaster:tk,terrainDepth:tk,skybox:t=>({u_matrix:new nn(t),u_sun_direction:new an(t),u_cubemap:new En(t),u_opacity:new Fe(t),u_temporal_offset:new Fe(t)}),skyboxGradient:t=>({u_matrix:new nn(t),u_color_ramp:new En(t),u_center_direction:new an(t),u_radius:new Fe(t),u_opacity:new Fe(t),u_temporal_offset:new Fe(t)}),skyboxCapture:t=>({u_matrix_3f:new oT(t),u_sun_direction:new an(t),u_sun_intensity:new Fe(t),u_color_tint_r:new Hs(t),u_color_tint_m:new Hs(t),u_luminance:new Fe(t)}),globeRaster:t=>({u_proj_matrix:new nn(t),u_globe_matrix:new nn(t),u_normalize_matrix:new nn(t),u_merc_matrix:new nn(t),u_zoom_transition:new Fe(t),u_merc_center:new Mn(t),u_image0:new En(t),u_grid_matrix:new oT(t),u_skirt_height:new Fe(t),u_frustum_tl:new an(t),u_frustum_tr:new an(t),u_frustum_br:new an(t),u_frustum_bl:new an(t),u_globe_pos:new an(t),u_globe_radius:new Fe(t),u_viewport:new Mn(t)}),globeAtmosphere:t=>({u_frustum_tl:new an(t),u_frustum_tr:new an(t),u_frustum_br:new an(t),u_frustum_bl:new an(t),u_horizon:new Fe(t),u_transition:new Fe(t),u_fadeout_range:new Fe(t),u_color:new Hs(t),u_high_color:new Hs(t),u_space_color:new Hs(t),u_temporal_offset:new Fe(t),u_horizon_angle:new Fe(t)}),model:t=>({u_matrix:new nn(t),u_lighting_matrix:new nn(t),u_normal_matrix:new nn(t),u_lightpos:new an(t),u_lightintensity:new Fe(t),u_lightcolor:new an(t),u_camera_pos:new an(t),u_opacity:new Fe(t),u_baseColorFactor:new Hs(t),u_emissiveFactor:new Hs(t),u_metallicFactor:new Fe(t),u_roughnessFactor:new Fe(t),u_baseTextureIsAlpha:new En(t),u_alphaMask:new En(t),u_alphaCutoff:new Fe(t),u_baseColorTexture:new En(t),u_metallicRoughnessTexture:new En(t),u_normalTexture:new En(t),u_occlusionTexture:new En(t),u_emissionTexture:new En(t),u_color_mix:new Hs(t),u_aoIntensity:new Fe(t),u_emissive_strength:new Fe(t)}),modelDepth:t=>({u_matrix:new nn(t),u_instance:new nn(t),u_node_matrix:new nn(t)}),groundShadow:t=>({u_matrix:new nn(t),u_ground_shadow_factor:new an(t)}),stars:t=>({u_matrix:new nn(t),u_up:new an(t),u_right:new an(t),u_intensity_multiplier:new Fe(t)})},Gv;function bk(t,e,n,o,s,l,u){let d=t.context,f=d.gl,p=t.transform,g=t.getOrCreateProgram("collisionBox"),_=[],v=0,x=0;for(let O=0;O<o.length;O++){let A=o[O],R=e.getTile(A),F=R.getBucket(n);if(!F)continue;let k=wq(A,F,p),N=k;s[0]===0&&s[1]===0||(N=t.translatePosMatrix(k,R,s,l));let B=u?F.textCollisionBox:F.iconCollisionBox,H=F.collisionCircleArray;if(H.length>0){let G=ae.create(),Y=N;ae.mul(G,F.placementInvProjMatrix,p.glCoordMatrix),ae.mul(G,G,F.placementViewportMatrix),_.push({circleArray:H,circleOffset:x,transform:Y,invTransform:G,projection:F.getProjection()}),v+=H.length/4,x=v}B&&(t.terrain&&t.terrain.setupElevationDraw(R,g),g.draw(t,f.LINES,$t.disabled,_n.disabled,t.colorModeForRenderPass(),bn.disabled,nZ(N,p,R,F.getProjection()),n.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,null,p.zoom,null,[B.collisionVertexBuffer,B.collisionVertexBufferExt]))}if(!u||!_.length)return;let b=t.getOrCreateProgram("collisionCircle"),T=new Zw;T.resize(4*v),T._trim();let E=0;for(let O of _)for(let A=0;A<O.circleArray.length/4;A++){let R=4*A,F=O.circleArray[R+0],k=O.circleArray[R+1],N=O.circleArray[R+2],B=O.circleArray[R+3];T.emplace(E++,F,k,N,B,0),T.emplace(E++,F,k,N,B,1),T.emplace(E++,F,k,N,B,2),T.emplace(E++,F,k,N,B,3)}(!Gv||Gv.length<2*v)&&(Gv=function(O){let A=2*O,R=new Kr;R.resize(A),R._trim();for(let F=0;F<A;F++){let k=6*F;R.uint16[k+0]=4*F+0,R.uint16[k+1]=4*F+1,R.uint16[k+2]=4*F+2,R.uint16[k+3]=4*F+2,R.uint16[k+4]=4*F+3,R.uint16[k+5]=4*F+0}return R}(v));let M=d.createIndexBuffer(Gv,!0),S=d.createVertexBuffer(T,LG.members,!0);for(let O of _){let A={u_matrix:O.transform,u_inv_matrix:O.invTransform,u_camera_to_center_distance:(P=p).getCameraToCenterDistance(O.projection),u_viewport_size:[P.width,P.height]};b.draw(t,f.TRIANGLES,$t.disabled,_n.disabled,t.colorModeForRenderPass(),bn.disabled,A,n.id,S,M,Ti.simpleSegment(0,2*O.circleOffset,O.circleArray.length,O.circleArray.length/2),null,p.zoom)}var P;S.destroy(),M.destroy()}let wk=ae.create();function hZ({width:t,height:e,anchor:n,textOffset:o,textScale:s},l){let{horizontalAlign:u,verticalAlign:d}=ov(n),f=-(u-.5)*t,p=-(d-.5)*e,g=iE(n,o);return new X((f/s+g[0])*l,(p/s+g[1])*l)}function fZ(t,e,n,o,s,l,u,d,f,p,g){let _=t.text.placedSymbolArray,v=t.text.dynamicLayoutVertexArray,x=t.icon.dynamicLayoutVertexArray,b={},T=t.getProjection(),E=BE(d,T,l),M=l.elevation,S=T.upVectorScale(d.canonical,l.center.lat,l.worldSize).metersToTile;v.clear();for(let P=0;P<_.length;P++){let O=_.get(P),{tileAnchorX:A,tileAnchorY:R,numGlyphs:F}=O,k=O.hidden||!O.crossTileID||t.allowVerticalPlacement&&!O.placedOrientation?null:o[O.crossTileID];if(k){let N=0,B=0,H=0;if(M){let de=M?M.getAtTileOffset(d,A,R):0,[pe,fe,be]=T.upVector(d.canonical,A,R);N=de*pe*S,B=de*fe*S,H=de*be*S}let[G,Y,U,Q]=yl(O.projectedAnchorX+N,O.projectedAnchorY+B,O.projectedAnchorZ+H,n?E:u),te=hL(l.getCameraToCenterDistance(T),Q),se=s.evaluateSizeForFeature(t.textSizeData,p,O)*te/Ao;n&&(se*=t.tilePixelRatio/f);let K=hZ(k,se);n?({x:G,y:Y,z:U}=T.projectTilePoint(A+K.x,R+K.y,d.canonical),[G,Y,U]=yl(G+N,Y+B,U+H,u)):(e&&K._rotate(-l.angle),G+=K.x,Y+=K.y,U=0);let ee=t.allowVerticalPlacement&&O.placedOrientation===rr.vertical?Math.PI/2:0;for(let de=0;de<F;de++)np(v,G,Y,U,ee);g&&O.associatedIconIndex>=0&&(b[O.associatedIconIndex]={x:G,y:Y,z:U,angle:ee})}else rp(F,v)}if(g){x.clear();let P=t.icon.placedSymbolArray;for(let O=0;O<P.length;O++){let A=P.get(O),{numGlyphs:R}=A,F=b[O];if(A.hidden||!F)rp(R,x);else{let{x:k,y:N,z:B,angle:H}=F;for(let G=0;G<R;G++)np(x,k,N,B,H)}}t.icon.dynamicLayoutVertexBuffer.updateData(x)}t.text.dynamicLayoutVertexBuffer.updateData(v)}function pZ(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Tk(t,e,n,o,s,l,u,d,f,p,g,_,v){let x=t.context,b=x.gl,T=t.transform,E=d==="map",M=f==="map",S=E&&n.layout.get("symbol-placement")!=="point",P=E&&!M&&!S,O=n.layout.get("symbol-sort-key").constantOr(1)!==void 0,A=!1,R=t.depthModeForSublayer(0,$t.ReadOnly),F=[ao(T.center.lng),po(T.center.lat)],k=n.layout.get("text-variable-anchor"),N=T.projection.name==="globe",B=[],H=[0,-1,0],G=H;!N&&!T.mercatorFromTransition||E||(G=function(Y){let U=Y._camera.getWorldToCamera(Y.worldSize,1),Q=ae.multiply([],U,Y.globeMatrix);ae.invert(Q,Q);let te=[0,0,0],se=[0,1,0,0];return Ei.transformMat4(se,se,Q),te[0]=se[0],te[1]=se[1],te[2]=se[2],Z.normalize(te,te),te}(T));for(let Y of o){let U=e.getTile(Y),Q=U.getBucket(n);if(!Q||Q.projection.name==="mercator"&&N)continue;let te=s?Q.text:Q.icon;if(!te||Q.fullyClipped||!te.segments.get().length)continue;let se=te.programConfigurations.get(n.id),K=s||Q.sdfIcons,ee=s?Q.textSizeData:Q.iconSizeData,de=M||T.pitch!==0,pe=Ql(ee,T.zoom),fe,be,Te,Me,ge=[0,0],Pe=null;if(s)be=U.glyphAtlasTexture?U.glyphAtlasTexture:null,Te=b.LINEAR,fe=U.glyphAtlasTexture?U.glyphAtlasTexture.size:[0,0],Q.iconsInText&&(ge=U.imageAtlasTexture?U.imageAtlasTexture.size:[0,0],Pe=U.imageAtlasTexture?U.imageAtlasTexture:null,Me=de||t.options.rotating||t.options.zooming||ee.kind==="composite"||ee.kind==="camera"?b.LINEAR:b.NEAREST);else{let Xi=n.layout.get("icon-size").constantOr(0)!==1||Q.iconsNeedLinear;be=U.imageAtlasTexture?U.imageAtlasTexture:null,Te=K||t.options.rotating||t.options.zooming||Xi||de?b.LINEAR:b.NEAREST,fe=U.imageAtlasTexture?U.imageAtlasTexture.size:[0,0]}let et=Q.projection.name==="globe",tt=et?G:H,lt=et?Do(T.zoom):0,ct=BE(Y,Q.getProjection(),T),Ht=T.calculatePixelsToTileUnitsMatrix(U),Tt=Ev(ct,U.tileID.canonical,M,E,T,Q.getProjection(),Ht),zn=t.terrain&&M&&S?ae.invert(ae.create(),Tt):wk,Dn=dL(ct,U.tileID.canonical,M,E,T,Q.getProjection(),Ht),Gt=k&&Q.hasTextData(),kt=Q.hasIconTextFit()&&Gt&&Q.hasIconData();if(S){let Xi=T.elevation,_i=Xi?Xi.getAtTileOffsetFunc(Y,T.center.lat,T.worldSize,Q.getProjection()):null,zo=uL(ct,U.tileID.canonical,M,E,T,Q.getProjection(),Ht);hW(Q,ct,t,s,zo,Dn,M,p,_i,Y)}let St=S||s&&k||kt,Pn=t.translatePosMatrix(ct,U,l,u),Nn=St?wk:Tt,fn=t.translatePosMatrix(Dn,U,l,u,!0),Ri=Q.getProjection().createInversionMatrix(T,Y.canonical),Or=n.paint.get("icon-image-cross-fade").constantOr(0),Mi=[];t.terrainRenderModeElevated()&&M&&Mi.push("PITCH_WITH_MAP_TERRAIN"),et&&(Mi.push("PROJECTION_GLOBE_VIEW"),St&&Mi.push("PROJECTED_POS_ON_VIEWPORT")),Or>0&&Mi.push("ICON_TRANSITION"),te.zOffsetVertexBuffer&&Mi.push("Z_OFFSET");let Zi=K&&n.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1)!==0,jr;K?jr=Q.iconsInText?lZ(ee.kind,pe,P,M,t,Pn,Nn,fn,fe,ge,Y,lt,F,Ri,tt,Q.getProjection()):yk(ee.kind,pe,P,M,t,Pn,Nn,fn,s,fe,!0,Y,lt,F,Ri,tt,Q.getProjection()):(g<1&&Mi.push("SATURATION"),jr=_k(ee.kind,pe,P,M,t,Pn,Nn,fn,s,fe,Y,lt,F,Ri,tt,Q.getProjection(),g,Or));let Rr={program:t.getOrCreateProgram(pZ(K,s,Q),{config:se,defines:Mi}),buffers:te,uniformValues:jr,atlasTexture:be,atlasTextureIcon:Pe,atlasInterpolation:Te,atlasInterpolationIcon:Me,isSDF:K,hasHalo:Zi,tile:U,labelPlaneMatrixInv:zn};if(O&&Q.canOverlap){A=!0;let Xi=te.segments.get();for(let _i of Xi)B.push({segments:new Ti([_i]),sortKey:_i.sortKey,state:Rr})}else B.push({segments:te.segments,sortKey:0,state:Rr})}A&&B.sort((Y,U)=>Y.sortKey-U.sortKey);for(let Y of B){let U=Y.state;if(t.terrain&&t.terrain.setupElevationDraw(U.tile,U.program,{useDepthForOcclusion:T.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:U.labelPlaneMatrixInv}),x.activeTexture.set(b.TEXTURE0),U.atlasTexture&&U.atlasTexture.bind(U.atlasInterpolation,b.CLAMP_TO_EDGE),U.atlasTextureIcon&&(x.activeTexture.set(b.TEXTURE1),U.atlasTextureIcon&&U.atlasTextureIcon.bind(U.atlasInterpolationIcon,b.CLAMP_TO_EDGE)),t.uploadCommonLightUniforms(t.context,U.program),U.hasHalo){let Q=U.uniformValues;Q.u_is_halo=1,qE(U.buffers,Y.segments,n,t,U.program,R,_,v,Q,2),Q.u_is_halo=0}else{if(U.isSDF){let Q=U.uniformValues;U.hasHalo&&(Q.u_is_halo=1,qE(U.buffers,Y.segments,n,t,U.program,R,_,v,Q,1)),Q.u_is_halo=0}qE(U.buffers,Y.segments,n,t,U.program,R,_,v,U.uniformValues,1)}}}function qE(t,e,n,o,s,l,u,d,f,p){let g=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];s.draw(o,o.context.gl.TRIANGLES,l,u,d,bn.disabled,f,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,o.transform.zoom,t.programConfigurations.get(n.id),g,p)}function Ek(t,e,n,o,s,l,u){let d=t.context.gl,f=n.paint.get("fill-pattern"),p=f&&f.constantOr(1),g,_,v,x,b;u?(_=p&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",g=d.LINES):(_=p?"fillPattern":"fill",g=d.TRIANGLES);for(let T of o){let E=e.getTile(T);if(p&&!E.patternsLoaded())continue;let M=E.getBucket(n);if(!M)continue;t.prepareDrawTile();let S=M.programConfigurations.get(n.id),P=t.isTileAffectedByFog(T),O=t.getOrCreateProgram(_,{config:S,overrideFog:P});p&&(t.context.activeTexture.set(d.TEXTURE0),E.imageAtlasTexture&&E.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),S.updatePaintBuffers());let A=f.constantOr(null);if(A&&E.imageAtlas){let k=E.imageAtlas.patternPositions[A.toString()];k&&S.setConstantPatternPositions(k)}let R=t.translatePosMatrix(T.projMatrix,E,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),F=n.paint.get("fill-emissive-strength");if(u){x=M.indexBuffer2,b=M.segments2;let k=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];v=_==="fillOutlinePattern"&&p?tZ(R,F,t,E,k):eZ(R,F,k)}else x=M.indexBuffer,b=M.segments,v=p?fk(R,F,t,E):hk(R,F);t.uploadCommonUniforms(t.context,O,T.toUnwrapped()),O.draw(t,g,s,t.stencilModeForClipping(T),l,bn.disabled,v,n.id,M.layoutVertexBuffer,x,b,n.paint,t.transform.zoom,S,void 0)}}function Wv(t,e,n,o,s,l,u,d){n.resetLayerRenderingStats();let f=t.context,p=f.gl,g=t.transform,_=n.paint.get("fill-extrusion-pattern"),v=_.constantOr(1),x=n.paint.get("fill-extrusion-opacity"),b=t.style.enable3dLights(),T=n.paint.get(b&&!v?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),E=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),T],M=n.layout.get("fill-extrusion-edge-radius"),S=M>0&&!n.paint.get("fill-extrusion-rounded-roof"),P=S?0:M,O=g.projection.name==="globe"?qL():0,A=g.projection.name==="globe",R=A?Do(g.zoom):0,F=[ao(g.center.lng),po(g.center.lat)],k=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=n.paint.get("fill-extrusion-flood-light-intensity"),B=n.paint.get("fill-extrusion-vertical-scale"),H=ap(t,n.paint.get("fill-extrusion-cutoff-fade-range")),G=n.paint.get("fill-extrusion-emissive-strength"),Y=[],U;A&&Y.push("PROJECTION_GLOBE_VIEW"),E[0]>0&&Y.push("FAUX_AO"),S&&Y.push("ZERO_ROOF_RADIUS"),d&&Y.push("HAS_CENTROID"),N>0&&Y.push("FLOOD_LIGHT"),H.shouldRenderCutoff&&Y.push("RENDER_CUTOFF");let Q=t.renderPass==="shadow",te=t.shadowRenderer,se=Q&&!!te;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let K=[0,0,0];if(te){let pe=t.style.directionalLight,fe=t.style.ambientLight;pe&&fe&&(K=XE(pe,fe)),U=Y.concat(["SHADOWS_SINGLE_CASCADE"])}let ee=se?"fillExtrusionDepth":v?"fillExtrusionPattern":"fillExtrusion",de=n.getLayerRenderingStats();for(let pe of o){let fe=e.getTile(pe),be=fe.getBucket(n);if(!be||be.projection.name!==g.projection.name)continue;let Te=!1;te&&(Te=te.getMaxCascadeForTile(pe.toUnwrapped())===0);let Me=t.isTileAffectedByFog(pe),ge=be.programConfigurations.get(n.id),Pe=t.getOrCreateProgram(ee,{config:ge,defines:Te?U:Y,overrideFog:Me});if(t.terrain&&t.terrain.setupElevationDraw(fe,Pe,{useMeterToDem:!0}),!be.centroidVertexBuffer){let Tt=Pe.attributes.a_centroid_pos;Tt!==void 0&&p.vertexAttrib2f(Tt,0,0)}!Q&&te&&te.setupShadows(fe.tileID.toUnwrapped(),Pe,"vector-tile",fe.tileID.overscaledZ),v&&(t.context.activeTexture.set(p.TEXTURE0),fe.imageAtlasTexture&&fe.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),ge.updatePaintBuffers());let et=_.constantOr(null);if(et&&fe.imageAtlas){let Tt=fe.imageAtlas.patternPositions[et.toString()];Tt&&ge.setConstantPatternPositions(Tt)}let tt=n.paint.get("fill-extrusion-vertical-gradient"),lt;if(Q&&te){if(vZ(fe.tileID,be,t))continue;let Tt=te.calculateShadowPassMatrixFromTile(fe.tileID.toUnwrapped());lt=Jq(Tt,P,B)}else{let Tt=t.translatePosMatrix(pe.expandedProjMatrix,fe,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),zn=g.projection.createInversionMatrix(g,pe.canonical);lt=v?Qq(Tt,t,tt,x,E,P,pe,fe,O,R,F,zn,k,B):dk(Tt,t,tt,x,E,P,pe,O,R,F,zn,k,B,N,K,G)}t.uploadCommonUniforms(f,Pe,pe.toUnwrapped(),null,H);let ct=be.segments;if(g.projection.name==="mercator"&&!Q&&(ct=be.getVisibleSegments(fe.tileID,t.terrain,t.transform.getFrustum(0)),!ct.get().length))continue;if(de)if(Q)for(let Tt of ct.get())de.numRenderedVerticesInShadowPass+=Tt.primitiveLength;else for(let Tt of ct.get())de.numRenderedVerticesInTransparentPass+=Tt.primitiveLength;let Ht=[];(t.terrain||d)&&Ht.push(be.centroidVertexBuffer),A&&Ht.push(be.layoutVertexExtBuffer),Pe.draw(t,f.gl.TRIANGLES,s,l,u,bn.backCCW,lt,n.id,be.layoutVertexBuffer,be.indexBuffer,ct,n.paint,t.transform.zoom,ge,Ht)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function cp(t,e,n,o,s,l,u,d,f,p,g,_,v,x,b,T,E,M,S){let P=t.context,O=P.gl,A=t.transform,R=t.transform.zoom,F=[],k=ap(t,n.paint.get("fill-extrusion-cutoff-fade-range"));p==="clear"?(F.push("CLEAR_SUBPASS"),S&&(F.push("CLEAR_FROM_TEXTURE"),P.activeTexture.set(O.TEXTURE0),S.bind(O.LINEAR,O.CLAMP_TO_EDGE))):p==="sdf"&&F.push("SDF_SUBPASS"),E&&F.push("HAS_CENTROID"),k.shouldRenderCutoff&&F.push("RENDER_CUTOFF");let N=n.layout.get("fill-extrusion-edge-radius"),B=(H,G,Y,U,Q)=>{let te=G.programConfigurations.get(n.id),se=t.isTileAffectedByFog(H),K=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:te,defines:F,overrideFog:se}),ee=((pe,fe,be,Te,Me,ge,Pe,et,tt,lt,ct)=>({u_matrix:fe,u_opacity:be,u_ao_pass:Te?1:0,u_meter_to_tile:Me,u_ao:ge,u_flood_light_intensity:Pe,u_flood_light_color:et,u_attenuation:tt,u_edge_radius:lt,u_fb:0,u_fb_size:ct}))(0,U,g,f,Q,[_,v*Q],x,b,T,R>=17?0:N*Q,S?S.size[0]:0),de=[];E&&de.push(G.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(P,K,H.toUnwrapped(),null,k),K.draw(t,P.gl.TRIANGLES,s,l,u,d,ee,n.id,G.vertexBuffer,G.indexBuffer,Y,n.paint,R,te,de)};for(let H of o){let G=e.getTile(H),Y=G.getBucket(n);if(!Y||Y.projection.name!==A.projection.name||!Y.groundEffect||Y.groundEffect&&!Y.groundEffect.hasData())continue;let U=Y.groundEffect,Q=1/Y.tileToMeter;{let te=t.translatePosMatrix(H.projMatrix,G,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),se=U.getDefaultSegment();B(H,U,se,te,Q)}if(M)for(let te=0;te<4;te++){let se=y2[te](H),K=e.getTile(se);if(!K)continue;let ee=K.getBucket(n);if(!ee||ee.projection.name!==A.projection.name||!ee.groundEffect||ee.groundEffect&&!ee.groundEffect.hasData())continue;let de=ee.groundEffect,pe,fe;te===0?(pe=[-ne,0,0],fe=1):te===1?(pe=[ne,0,0],fe=0):te===2?(pe=[0,-ne,0],fe=3):(pe=[0,ne,0],fe=2);let be=de.regionSegments[fe];if(!be)continue;let Te=new Float32Array(16);ae.translate(Te,H.projMatrix,pe),B(H,de,be,t.translatePosMatrix(Te,G,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Q)}}}function mZ(t,e,n,o,s,l,u){o.centroidVertexArray.length===0&&o.createCentroidsBuffer();let d=l?l.findDEMTileFor(n):null;if(!(d&&d.dem||u))return;let f=M=>{let S=e.getSource().minzoom,P=A=>{let R=e.getTileByID(A);if(R&&R.hasData())return R.getBucket(s)},O=[0,-1,1];for(let A of O){if(M.overscaledZ+A<S)continue;let R=P(M.calculateScaledKey(M.overscaledZ+A));if(R)return R}},p=[0,0,0],g=(M,S)=>(p[0]=Math.min(M.min.y,S.min.y),p[1]=Math.max(M.max.y,S.max.y),p[2]=ne-S.min.x>M.max.x?S.min.x-ne:M.max.x,p),_=(M,S)=>(p[0]=Math.min(M.min.x,S.min.x),p[1]=Math.max(M.max.x,S.max.x),p[2]=ne-S.min.y>M.max.y?S.min.y-ne:M.max.y,p),v=[(M,S)=>g(M,S),(M,S)=>g(S,M),(M,S)=>_(M,S),(M,S)=>_(S,M)],x=(M,S,P,O,A,R,F)=>{if(!l)return 0;let k=[[R?P:M,R?M:P,0],[R?P:S,R?S:P,0]],N=F<0?ne+F:F,B=[R?N:(M+S)/2,R?(M+S)/2:N,0];return P===0&&F<0||P!==0&&F>0?l.getForTilePoints(A,[B],!0,O):k.push(B),l.getForTilePoints(n,k,!0,d),Math.max(k[0][2],k[1][2],B[2])/l.exaggeration()};for(let M=0;M<4;M++){let S=o.borderFeatureIndices[M];if(S.length===0)continue;let P=y2[M](n),O=f(P);if(!(O&&O instanceof mg)||o.borderDoneWithNeighborZ[M]===O.canonical.z)continue;O.centroidVertexArray.length===0&&O.createCentroidsBuffer();let A=l?l.findDEMTileFor(P):null;if(!(A&&A.dem||u))continue;let R=(M<2?1:5)-M,F=O.borderDoneWithNeighborZ[R]!==o.canonical.z,k=O.borderFeatureIndices[R],N=0;if(o.canonical.z!==O.canonical.z){for(let B of S)o.showCentroid(o.featuresOnBorder[B]);if(F)for(let B of k)O.showCentroid(O.featuresOnBorder[B]);o.borderDoneWithNeighborZ[M]=O.canonical.z,O.borderDoneWithNeighborZ[R]=o.canonical.z}for(let B of S){let H=o.featuresOnBorder[B],G=o.centroidData[H.centroidDataIndex],Y=H.borders[M],U;for(;N<k.length;){U=O.featuresOnBorder[k[N]];let Q=U.borders[R];if(Q[1]>Y[0]+3||Q[0]>Y[0]-3)break;O.showCentroid(U),N++}if(U&&N<k.length){let Q=N,te=0;for(;!(U.borders[R][0]>Y[1]-3)&&(te++,++N!==k.length);)U=O.featuresOnBorder[k[N]];if(U=O.featuresOnBorder[k[Q]],te>1){let ee=U.borders[R];Math.abs(Y[0]-ee[0])<3&&Math.abs(Y[1]-ee[1])<3&&(te=1,N=Q+1)}else if(te===0){o.showCentroid(H);continue}let se=O.centroidData[U.centroidDataIndex];u&&te===1&&(((T=G).flags|(E=se).flags)&nc?(T.flags|=nc,E.flags|=nc):(T.flags&=2147483647,E.flags&=2147483647));let K=new X(0,0);if(te>1)N=Q;else if(A&&A.dem&&!(H.intersectsCount()>1||U.intersectsCount()>1)){let ee=v[M](G,se),de=M%2?ne-1:0;b=x(ee[0],Math.min(ne-1,ee[1]),de,A,P,M<2,ee[2]),K=new X(Math.ceil(7*(b+450)),0)}G.centroidXY=se.centroidXY=K,o.writeCentroidToBuffer(G),O.writeCentroidToBuffer(se)}else o.showCentroid(H)}o.borderDoneWithNeighborZ[M]=O.canonical.z,O.borderDoneWithNeighborZ[R]=o.canonical.z}var b,T,E;(o.needsCentroidUpdate||!o.centroidVertexBuffer&&o.centroidVertexArray.length!==0)&&o.uploadCentroid(t)}let gZ=[1,0,0],_Z=[0,1,0],yZ=[0,0,1];function vZ(t,e,n){let o=n.transform,s=n.shadowRenderer;if(!s)return!0;let l=t.toUnwrapped(),u=o.tileSize*s._cascades[n.currentShadowCascade].scale,d=e.maxHeight;if(o.elevation){let T=o.elevation.getMinMaxForTile(t);T&&(d+=T.max)}let f=[...s.shadowDirection];f[2]=-f[2];let p=s.computeSimplifiedTileShadowVolume(l,d,u,f);if(!p)return!1;let g=[gZ,_Z,yZ,f,[f[0],0,f[2]],[0,f[1],f[2]]],_=o.projection.name==="globe",v=o.scaleZoom(u),x=Uc.fromInvProjectionMatrix(o.invProjMatrix,o.worldSize,v,!_),b=s.getCurrentCascadeFrustum();return x.intersectsPrecise(p.vertices,p.planes,g)===0||b.intersectsPrecise(p.vertices,p.planes,g)===0}function xZ(t){let e=t._nearZ,n=t.projection.farthestPixelDistance(t),o=n-e,s=.2*t.height,l=e+s;return[e,n,(l-s-e)/o,(l-e)/o]}let bZ=new tn(1,0,0,1),wZ=new tn(0,1,0,1),TZ=new tn(0,0,1,1),EZ=new tn(1,0,1,1),MZ=new tn(0,1,1,1);function IZ(t,e,n){let o=t.context,s=t.transform,l=o.gl,u=s.projection.name==="globe",d=u?["PROJECTION_GLOBE_VIEW"]:[],f=n.projMatrix;if(u&&Do(s.zoom)>0){let B=DT(T2(n.canonical,s));f=ae.multiply(new Float32Array(16),s.globeMatrix,B),ae.multiply(f,s.projMatrix,f)}let p=t.getOrCreateProgram("debug",{defines:d}),g=e.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(g,p);let _=$t.disabled,v=_n.disabled,x=t.colorModeForRenderPass(),b="$debug";o.activeTexture.set(l.TEXTURE0),t.emptyTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),u?g._makeGlobeTileDebugBuffers(t.context,s):g._makeDebugTileBoundsBuffers(t.context,s.projection);let T=g._tileDebugBuffer||t.debugBuffer,E=g._tileDebugIndexBuffer||t.debugIndexBuffer,M=g._tileDebugSegments||t.debugSegments;p.draw(t,l.LINE_STRIP,_,v,x,bn.disabled,pk(f,tn.red),b,T,E,M,null,null,null,[g._globeTileDebugBorderBuffer]);let S=g.latestRawTileData,P=Math.floor((S&&S.byteLength||0)/1024),O=e.getTile(n).tileSize,A=512/Math.min(O,512)*(n.overscaledZ/s.zoom)*.5,R=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(R+=` => ${n.overscaledZ}`),R+=` ${P}kb`,function(B,H){B.initDebugOverlayCanvas();let G=B.debugOverlayCanvas,Y=B.context.gl,U=B.debugOverlayCanvas.getContext("2d");U.clearRect(0,0,G.width,G.height),U.shadowColor="white",U.shadowBlur=2,U.lineWidth=1.5,U.strokeStyle="white",U.textBaseline="top",U.font="bold 36px Open Sans, sans-serif",U.fillText(H,5,5),U.strokeText(H,5,5),B.debugOverlayTexture.update(G),B.debugOverlayTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}(t,R);let F=g._tileDebugTextBuffer||t.debugBuffer,k=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,N=g._tileDebugTextSegments||t.debugSegments;p.draw(t,l.TRIANGLES,_,v,Hn.alphaBlended,bn.disabled,pk(f,tn.transparent,A),b,F,k,N,null,null,null,[g._globeTileDebugTextBuffer])}function Mk(t,e,n,o){qv(t,0,e+n/2,t.transform.width,n,o)}function Ik(t,e,n,o){qv(t,e-n/2,0,n,t.transform.height,o)}function qv(t,e,n,o,s,l){let u=t.context,d=u.gl;d.enable(d.SCISSOR_TEST),d.scissor(e*Zt.devicePixelRatio,n*Zt.devicePixelRatio,o*Zt.devicePixelRatio,s*Zt.devicePixelRatio),u.clear({color:l}),d.disable(d.SCISSOR_TEST)}let CZ=ri([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:SZ}=CZ;function nd(t,e,n,o){t.emplaceBack(e,n,o)}class Ck{constructor(e){this.vertexArray=new nh,this.indices=new Kr,nd(this.vertexArray,-1,-1,1),nd(this.vertexArray,1,-1,1),nd(this.vertexArray,-1,1,1),nd(this.vertexArray,1,1,1),nd(this.vertexArray,-1,-1,-1),nd(this.vertexArray,1,-1,-1),nd(this.vertexArray,-1,1,-1),nd(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,SZ),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=Ti.simpleSegment(0,0,36,12)}}function up(t,e,n,o,s,l){let u=t.context.gl,d=e.paint.get("sky-atmosphere-color"),f=e.paint.get("sky-atmosphere-halo-color"),p=e.paint.get("sky-atmosphere-sun-intensity"),g=((_,v,x,b,T)=>({u_matrix_3f:_,u_sun_direction:v,u_sun_intensity:x,u_color_tint_r:[b.r,b.g,b.b,b.a],u_color_tint_m:[T.r,T.g,T.b,T.a],u_luminance:5e-5}))(As.fromMat4(As.create(),o),s,p,d,f);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+l,e.skyboxTexture,0),n.draw(t,u.TRIANGLES,$t.disabled,_n.disabled,Hn.unblended,bn.frontCW,g,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}let DZ=ri([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class AZ{constructor(e){let n=new th;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);let o=new Kr;o.emplaceBack(0,1,2),o.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(n,DZ.members),this.indexBuffer=e.createIndexBuffer(o),this.segments=Ti.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let PZ=ri([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class OZ{constructor(){this.colorModeAlphaBlendedWriteRGB=new Hn([1,wv,1,wv],tn.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Hn([1,0,1,0],tn.transparent,[!1,!1,!1,!0])}update(e){let n=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new AZ(n);let o=100,s=200,l=function(g){let _=bw(30),v=[];for(let x=0;x<16e3;++x){let b=2*Math.PI*_(),T=Math.acos(1-2*_())-.5*Math.PI;v.push(Z.fromValues(Math.cos(T)*Math.cos(b),Math.cos(T)*Math.sin(b),Math.sin(T)))}return v}(),u=bw(300),d=new Jw,f=new Kr,p=0;for(let g=0;g<l.length;++g){let _=Z.scale([],l[g],200),v=Math.max(0,1+.01*o*(1*u()-.5)),x=Math.max(0,1+.01*s*(1*u()-.5));d.emplaceBack(_[0],_[1],_[2],-1,-1,v,x),d.emplaceBack(_[0],_[1],_[2],1,-1,v,x),d.emplaceBack(_[0],_[1],_[2],1,1,v,x),d.emplaceBack(_[0],_[1],_[2],-1,1,v,x),f.emplaceBack(p+0,p+1,p+2),f.emplaceBack(p+0,p+2,p+3),p+=4}this.starsVx=n.createVertexBuffer(d,PZ.members),this.starsIdx=n.createIndexBuffer(f),this.starsSegments=Ti.simpleSegment(0,0,d.length,f.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,n){let o=e.context,s=o.gl,l=e.transform,u=new $t(s.LEQUAL,$t.ReadOnly,[0,1]),d=Do(l.zoom),f=n.properties.get("color").toArray01(),p=n.properties.get("high-color").toArray01(),g=n.properties.get("space-color").toArray01PremultipliedAlpha(),_=5e-4,v=ze((n.properties.get("horizon-blend")-0)/1*.2495+_,5e-4,.25),x=A2(e,o,l)&&v===_?l.worldSize/(2*Math.PI*1.025)-1:l.globeRadius,b=e.frameCounter/1e3%1,T=Z.length(l.globeCenterInViewSpace),E=Math.sqrt(Math.pow(T,2)-Math.pow(x,2)),M=Math.acos(E/T),S=P=>{let O=l.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];P&&O.push("ALPHA_PASS");let A=e.getOrCreateProgram("globeAtmosphere",{defines:O}),R=((k,N,B,H,G,Y,U,Q,te,se,K,ee)=>({u_frustum_tl:k,u_frustum_tr:N,u_frustum_br:B,u_frustum_bl:H,u_horizon:G,u_transition:Y,u_fadeout_range:U,u_color:Q,u_high_color:te,u_space_color:se,u_temporal_offset:K,u_horizon_angle:ee}))(l.frustumCorners.TL,l.frustumCorners.TR,l.frustumCorners.BR,l.frustumCorners.BL,l.frustumCorners.horizon,d,v,f,p,g,b,M);e.uploadCommonUniforms(o,A);let F=this.atmosphereBuffer;F&&A.draw(e,s.TRIANGLES,u,_n.disabled,P?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,bn.backCW,R,P?"atmosphere_glow_alpha":"atmosphere_glow",F.vertexBuffer,F.indexBuffer,F.segments)};S(!1),S(!0)}drawStars(e,n){let o=ze(n.properties.get("star-intensity"),0,1);if(o===0)return;let s=e.context,l=s.gl,u=e.transform,d=e.getOrCreateProgram("stars"),f=Wo.identity([]);Wo.rotateX(f,f,-u._pitch),Wo.rotateZ(f,f,-u.angle),Wo.rotateX(f,f,Vt(u._center.lat)),Wo.rotateY(f,f,-Vt(u._center.lng));let p=ae.fromQuat(new Float32Array(16),f),g=ae.multiply([],u.starsProjMatrix,p),_=As.fromMat4([],p),v=As.invert([],_),x=[0,1,0];Z.transformMat3(x,x,v),Z.scale(x,x,.15);let b=[1,0,0];Z.transformMat3(b,b,v),Z.scale(b,b,.15);let T=((E,M,S,P)=>({u_matrix:Float32Array.from(E),u_up:M,u_right:S,u_intensity_multiplier:P}))(g,x,b,o);e.uploadCommonUniforms(s,d),this.starsVx&&this.starsIdx&&d.draw(e,l.TRIANGLES,$t.disabled,_n.disabled,this.colorModeAlphaBlendedWriteRGB,bn.disabled,T,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Sk(t,e){let n=[...t],o=e.cameraWorldSizeForFog/e.worldSize,s=ae.identity([]);return ae.scale(s,s,[o,o,1]),ae.multiply(n,s,n),ae.multiply(n,e.worldToFogMatrix,n),n}function ZE(t,e,n,o){let s=n.material,l=o.context,{baseColorTexture:u,metallicRoughnessTexture:d}=s.pbrMetallicRoughness,{normalTexture:f,occlusionTexture:p,emissionTexture:g}=s;function _(v,x,b){if(v&&(t.push(x),l.activeTexture.set(l.gl.TEXTURE0+b),v.gfxTexture)){let{minFilter:T,magFilter:E,wrapS:M,wrapT:S}=v.sampler;v.gfxTexture.bindExtraParam(T,E,M,S)}}_(u,"HAS_TEXTURE_u_baseColorTexture",Zs.BaseColor),_(d,"HAS_TEXTURE_u_metallicRoughnessTexture",Zs.MetallicRoughness),_(f,"HAS_TEXTURE_u_normalTexture",Zs.Normal),_(p,"HAS_TEXTURE_u_occlusionTexture",Zs.Occlusion),_(g,"HAS_TEXTURE_u_emissionTexture",Zs.Emission),n.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(n.texcoordBuffer)),n.colorBuffer&&(t.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(n.colorBuffer)),n.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(n.normalBuffer)),n.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(n.pbrBuffer)),s.alphaMode!=="OPAQUE"&&s.alphaMode!=="MASK"||t.push("UNPREMULT_TEXTURE_IN_SHADER"),s.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function Zv(t,e,n,o,s,l){let u=n.paint.get("model-opacity"),d=e.context,f=new $t(e.context.gl.LEQUAL,$t.ReadWrite,e.depthRangeFor3D),p=e.transform,g=t.mesh,_=g.material,v=_.pbrMetallicRoughness,x=e.style.fog,b;b=e.transform.projection.zAxisUnit==="pixels"?[...t.nodeModelMatrix]:ae.multiply([],o.zScaleMatrix,t.nodeModelMatrix),ae.multiply(b,o.negCameraPosMatrix,b);let T=ae.invert([],b);ae.transpose(T,T);let E=n.paint.get("model-emissive-strength").constantOr(0),M=WE(new Float32Array(t.worldViewProjection),new Float32Array(b),new Float32Array(T),e,u,v.baseColorFactor,_.emissiveFactor,v.metallicFactor,v.roughnessFactor,_,E,n),S={defines:[]},P=[];ZE(S.defines,P,g,e);let O=e.shadowRenderer;O&&(O.useNormalOffset=!1);let A=null;if(x){let k=Sk(t.nodeModelMatrix,e.transform);if(A=new Float32Array(k),p.projection.name!=="globe"){let N=g.aabb.min,B=g.aabb.max,[H,G]=x.getOpacityForBounds(k,N[0],N[1],B[0],B[1]);S.overrideFog=H>=dh||G>=dh}}let R=ap(e,n.paint.get("model-cutoff-fade-range"));R.shouldRenderCutoff&&S.defines.push("RENDER_CUTOFF");let F=e.getOrCreateProgram("model",S);e.uploadCommonUniforms(d,F,null,A,R),e.renderPass!=="shadow"&&O&&O.setupShadowsFromMatrix(t.nodeModelMatrix,F),F.draw(e,d.gl.TRIANGLES,f,s,l,g.material.doubleSided?bn.disabled:bn.backCCW,M,n.id,g.vertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,void 0,P)}function Dk(t,e,n,o,s,l,u){let d;d=t.projection.name==="globe"?wL(n,t):[...n],ae.multiply(d,d,e.matrix);let f=ae.multiply([],o,d);if(e.meshes)for(let p of e.meshes){if(p.material.alphaMode!=="BLEND"){u.push({mesh:p,depth:0,modelIndex:s,worldViewProjection:f,nodeModelMatrix:d});continue}let g=Z.transformMat4([],p.centroid,f);g[2]>0&&l.push({mesh:p,depth:g[2],modelIndex:s,worldViewProjection:f,nodeModelMatrix:d})}if(e.children)for(let p of e.children)Dk(t,p,n,o,s,l,u)}function YE(t,e,n,o){let s=n.shadowRenderer;if(!s)return;let l=s.getShadowPassDepthMode(),u=s.getShadowPassColorMode(),d=s.calculateShadowPassMatrixFromMatrix(e),f=xk(d);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,l,_n.disabled,u,bn.backCCW,f,o.id,t.vertexBuffer,t.indexBuffer,t.segments,o.paint,n.transform.zoom,void 0,void 0)}function RZ(t,e,n){let o=e.updateZoomBasedPaintProperties(),s=function(l,u,d){let f,p,g,_=l.terrain?l.terrain.exaggeration():0;if(l.terrain&&_>0){let v=l.terrain,x=v.findDEMTileFor(d);x&&x.dem?f=Xf.create(v,d,x):_=0}if(_===0&&(u.terrainElevationMin=0,u.terrainElevationMax=0),_===u.validForExaggeration&&(_===0||f&&f._demTile&&f._demTile.tileID===u.validForDEMTile.id&&f._dem._timestamp===u.validForDEMTile.timestamp))return!1;for(let v in u.instancesPerModel){let x=u.instancesPerModel[v];for(let b=0;b<x.instancedDataArray.length;++b){let T=(f?_*f.getElevationAt(0|x.instancedDataArray.float32[16*b],0|x.instancedDataArray.float32[16*b+1],!0,!0):0)+x.instancesEvaluatedElevation[b];x.instancedDataArray.float32[16*b+6]=T,p=p?Math.min(u.terrainElevationMin,T):T,g=g?Math.max(u.terrainElevationMax,T):T}}return u.terrainElevationMin=p||0,u.terrainElevationMax=g||0,u.validForExaggeration=_,u.validForDEMTile=f&&f._demTile?{id:f._demTile.tileID,timestamp:f._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,e,n);(o||s)&&(e.uploaded=!1,e.upload(t.context))}let rc={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new qi([0,0,0],[ne,ne,0])};function LZ(t,e){let n=1<<t.canonical.z,o=e.getFreeCameraOptions().position,s=e.elevation,l=t.canonical.x/n,u=(t.canonical.x+1)/n,d=t.canonical.y/n,f=(t.canonical.y+1)/n,p=e._centerAltitude;if(s){let x=s.getMinMaxForTile(t);x&&x.max>p&&(p=x.max)}let g=ze(o.x,l,u)-o.x,_=ze(o.y,d,f)-o.y,v=Oi(p,e.center.lat)-o.z;return e._zoomFromMercatorZ(Math.sqrt(g*g+_*_+v*v))}function Ak(t,e,n,o,s,l,u){let d=t.context,f=t.renderPass==="shadow",p=t.shadowRenderer,g=f&&p?p.getShadowPassDepthMode():new $t(d.gl.LEQUAL,$t.ReadWrite,t.depthRangeFor3D),_=t.isTileAffectedByFog(l);if(n.meshes)for(let v of n.meshes){let x=["MODEL_POSITION_ON_GPU"],b=[],T,E,M;o.instancedDataArray.length>20&&x.push("INSTANCED_ARRAYS");let S=ap(t,e.paint.get("model-cutoff-fade-range"));if(S.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),f&&p)T=t.getOrCreateProgram("modelDepth",{defines:x}),E=xk(u.shadowTileMatrix,u.shadowTileMatrix,Float32Array.from(n.matrix)),M=p.getShadowPassColorMode();else{ZE(x,b,v,t),T=t.getOrCreateProgram("model",{defines:x,overrideFog:_});let O=v.material,A=O.pbrMetallicRoughness,R=e.paint.get("model-opacity"),F=e.paint.get("model-emissive-strength").constantOr(0);E=WE(l.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),t,R,A.baseColorFactor,O.emissiveFactor,A.metallicFactor,A.roughnessFactor,O,F,e,s),p&&(u.shadowUniformsInitialized?T.setShadowUniformValues(d,p.getShadowUniformValues()):(p.setupShadows(l.toUnwrapped(),T,"model-tile",l.overscaledZ),u.shadowUniformsInitialized=!0)),M=S.shouldRenderCutoff||R<1||O.alphaMode!=="OPAQUE"?Hn.alphaBlended:Hn.unblended}t.uploadCommonUniforms(d,T,l.toUnwrapped(),null,S);let P=v.material.doubleSided?bn.disabled:bn.backCCW;if(o.instancedDataArray.length>20)b.push(o.instancedDataBuffer),T.draw(t,d.gl.TRIANGLES,g,_n.disabled,M,P,E,e.id,v.vertexBuffer,v.indexBuffer,v.segments,e.paint,t.transform.zoom,void 0,b,o.instancedDataArray.length);else{let O=f?"u_instance":"u_normal_matrix";for(let A=0;A<o.instancedDataArray.length;++A)E[O]=new Float32Array(o.instancedDataArray.arrayBuffer,64*A,16),T.draw(t,d.gl.TRIANGLES,g,_n.disabled,M,P,E,e.id,v.vertexBuffer,v.indexBuffer,v.segments,e.paint,t.transform.zoom,void 0,b)}}if(n.children)for(let v of n.children)Ak(t,e,v,o,s,l,u)}let FZ=[1,-1,1];function kZ(t,e,n,o){if(!n.modelManager)return!0;let s=n.modelManager;if(!n.shadowRenderer)return!0;let l=n.shadowRenderer,u=e.aabb,d=!0,f=t.maxHeight;if(f===0){let g=0;for(let _ in t.instancesPerModel){let v=s.getModel(_,o);v?g=Math.max(g,Math.max(Math.max(v.aabb.max[0],v.aabb.max[1]),v.aabb.max[2])):d=!1}f=t.maxScale*g*1.41+t.maxVerticalOffset,d&&(t.maxHeight=f)}u.max[2]=f,u.min[2]+=t.terrainElevationMin,u.max[2]+=t.terrainElevationMax,Z.transformMat4(u.min,u.min,e.tileMatrix),Z.transformMat4(u.max,u.max,e.tileMatrix);let p=u.intersects(l.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(t.isInsideFirstShadowMapFrustum=p===2),p===0}class NZ{}class zZ{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,n,o){{let _=this._storage.get(n.id);if(_)return _.lastUsedFrameIdx=e,_.buf}let s=o.gl,l=s.getBufferParameter(s.ELEMENT_ARRAY_BUFFER,s.BUFFER_SIZE),u=new ArrayBuffer(l),d=new Int16Array(u);s.getBufferSubData(s.ELEMENT_ARRAY_BUFFER,0,new Int16Array(u));let f=new Nu;for(let _=0;_<l/2;_+=3){let v=d[_],x=d[_+1],b=d[_+2];f.emplaceBack(v,x),f.emplaceBack(x,b),f.emplaceBack(b,v)}let p=o.bindVertexArrayOES.current,g=new NZ;return g.buf=new eL(o,f),g.lastUsedFrameIdx=e,this._storage.set(n.id,g),o.bindVertexArrayOES.set(p),g.buf}update(e){for(let[n,o]of this._storage)e-o.lastUsedFrameIdx>30&&(o.buf.destroy(),this._storage.delete(n))}destroy(){for(let[e,n]of this._storage)n.buf.destroy(),this._storage.delete(e)}}let Pk={symbol:function(t,e,n,o,s){if(t.renderPass!=="translucent")return;let l=_n.disabled,u=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(d,f,p,g,_,v,x){let b=f.transform,T=_==="map",E=v==="map";for(let M of d){let S=g.getTile(M),P=S.getBucket(p);if(!P||!P.text||!P.text.segments.get().length)continue;let O=Ql(P.textSizeData,b.zoom),A=BE(M,P.getProjection(),b),R=b.calculatePixelsToTileUnitsMatrix(S),F=Ev(A,S.tileID.canonical,E,T,b,P.getProjection(),R),k=P.hasIconTextFit()&&P.hasIconData();if(O){let N=Math.pow(2,b.zoom-S.tileID.overscaledZ);fZ(P,T,E,x,FG,b,F,M,N,O,k)}}}(o,t,n,e,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),s),n.paint.get("icon-opacity").constantOr(1)!==0&&Tk(t,e,n,o,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),n.paint.get("icon-color-saturation"),l,u),n.paint.get("text-opacity").constantOr(1)!==0&&Tk(t,e,n,o,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),n.paint.get("icon-color-saturation"),l,u),e.map.showCollisionBoxes&&(bk(t,e,n,o,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),bk(t,e,n,o,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,e,n,o){if(t.renderPass!=="translucent")return;let s=n.paint.get("circle-opacity"),l=n.paint.get("circle-stroke-width"),u=n.paint.get("circle-stroke-opacity"),d=n.layout.get("circle-sort-key").constantOr(1)!==void 0,f=n.paint.get("circle-emissive-strength");if(s.constantOr(1)===0&&(l.constantOr(1)===0||u.constantOr(1)===0))return;let p=t.context,g=p.gl,_=t.transform,v=t.depthModeForSublayer(0,$t.ReadOnly),x=_n.disabled,b=t.colorModeForDrapableLayerRenderPass(f),T=_.projection.name==="globe",E=[ao(_.center.lng),po(_.center.lat)],M=[];for(let P=0;P<o.length;P++){let O=o[P],A=e.getTile(O),R=A.getBucket(n);if(!R||R.projection.name!==_.projection.name)continue;let F=R.programConfigurations.get(n.id),k=W2(n),N=t.isTileAffectedByFog(O);T&&k.push("PROJECTION_GLOBE_VIEW");let B=t.getOrCreateProgram("circle",{config:F,defines:k,overrideFog:N}),H=R.layoutVertexBuffer,G=R.globeExtVertexBuffer,Y=R.indexBuffer,U=_.projection.createInversionMatrix(_,O.canonical),Q={programConfiguration:F,program:B,layoutVertexBuffer:H,globeExtVertexBuffer:G,indexBuffer:Y,uniformValues:DH(t,O,A,U,E,n),tile:A};if(d){let te=R.segments.get();for(let se of te)M.push({segments:new Ti([se]),sortKey:se.sortKey,state:Q})}else M.push({segments:R.segments,sortKey:0,state:Q})}d&&M.sort((P,O)=>P.sortKey-O.sortKey);let S={useDepthForOcclusion:_.depthOcclusionForSymbolsAndCircles};for(let P of M){let{programConfiguration:O,program:A,layoutVertexBuffer:R,globeExtVertexBuffer:F,indexBuffer:k,uniformValues:N,tile:B}=P.state,H=P.segments;t.terrain&&t.terrain.setupElevationDraw(B,A,S),t.uploadCommonUniforms(p,A,B.tileID.toUnwrapped()),A.draw(t,g.TRIANGLES,v,x,b,bn.disabled,N,n.id,R,k,H,n.paint,_.zoom,O,[F])}},heatmap:function(t,e,n,o){if(n.paint.get("heatmap-opacity")!==0)if(t.renderPass==="offscreen"){let s=t.context,l=s.gl,u=_n.disabled,d=new Hn([l.ONE,l.ONE,l.ONE,l.ONE],tn.transparent,[!0,!0,!0,!0]);(function(x,b,T,E){let M=x.gl,S=b.width*E,P=b.height*E;x.activeTexture.set(M.TEXTURE1),x.viewport.set([0,0,S,P]);let O=T.heatmapFbo;if(!O||O&&(O.width!==S||O.height!==P)){O&&O.destroy();let A=M.createTexture();M.bindTexture(M.TEXTURE_2D,A),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,M.CLAMP_TO_EDGE),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.LINEAR),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.LINEAR),O=T.heatmapFbo=x.createFramebuffer(S,P,!0,null),function(R,F,k,N,B,H){let G=R.gl;G.texImage2D(G.TEXTURE_2D,0,R.extRenderToTextureHalfFloat?G.RGBA16F:G.RGBA,B,H,0,G.RGBA,R.extRenderToTextureHalfFloat?G.HALF_FLOAT:G.UNSIGNED_BYTE,null),N.colorAttachment.set(k)}(x,0,A,O,S,P)}else M.bindTexture(M.TEXTURE_2D,O.colorAttachment.get()),x.bindFramebuffer.set(O.framebuffer)})(s,t,n,t.transform.projection.name==="globe"?.5:.25),s.clear({color:tn.transparent});let f=t.transform,p=f.projection.name==="globe",g=p?["PROJECTION_GLOBE_VIEW"]:[],_=p?bn.frontCCW:bn.disabled,v=[ao(f.center.lng),po(f.center.lat)];for(let x=0;x<o.length;x++){let b=o[x];if(e.hasRenderableParent(b))continue;let T=e.getTile(b),E=T.getBucket(n);if(!E||E.projection.name!==f.projection.name)continue;let M=t.isTileAffectedByFog(b),S=E.programConfigurations.get(n.id),P=t.getOrCreateProgram("heatmap",{config:S,defines:g,overrideFog:M}),{zoom:O}=t.transform;t.terrain&&t.terrain.setupElevationDraw(T,P),t.uploadCommonUniforms(s,P,b.toUnwrapped());let A=f.projection.createInversionMatrix(f,b.canonical);P.draw(t,l.TRIANGLES,$t.disabled,u,d,_,rZ(t,b,T,A,v,O,n.paint.get("heatmap-intensity")),n.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,n.paint,t.transform.zoom,S,p?[E.globeExtVertexBuffer]:null)}s.viewport.set([0,0,t.width,t.height])}else t.renderPass==="translucent"&&(t.context.setColorMode(t.colorModeForRenderPass()),function(s,l){let u=s.context,d=u.gl,f=l.heatmapFbo;if(!f)return;u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,f.colorAttachment.get()),u.activeTexture.set(d.TEXTURE1);let p=l.colorRampTexture;p||(p=l.colorRampTexture=new fr(u,l.colorRamp,d.RGBA)),p.bind(d.LINEAR,d.CLAMP_TO_EDGE),s.getOrCreateProgram("heatmapTexture").draw(s,d.TRIANGLES,$t.disabled,_n.disabled,s.colorModeForRenderPass(),bn.disabled,((g,_,v,x)=>({u_image:0,u_color_ramp:1,u_opacity:_.paint.get("heatmap-opacity")}))(0,l),l.id,s.viewportBuffer,s.quadTriangleIndexBuffer,s.viewportSegments,l.paint,s.transform.zoom)}(t,n))},line:function(t,e,n,o){if(t.renderPass!=="translucent")return;let s=n.paint.get("line-opacity"),l=n.paint.get("line-width");if(s.constantOr(1)===0||l.constantOr(1)===0)return;let u=n.paint.get("line-emissive-strength"),d=t.depthModeForSublayer(0,$t.ReadOnly),f=t.colorModeForDrapableLayerRenderPass(u),p=t.terrain&&t.terrain.renderingToTexture?1:Zt.devicePixelRatio,g=n.paint.get("line-dasharray"),_=g.constantOr(1),v=n.layout.get("line-cap"),x=n.paint.get("line-pattern"),b=x.constantOr(1),T=n.paint.get("line-pattern").constantOr(1),E=n.paint.get("line-opacity").constantOr(1)!==1,M=!T&&E,S=n.paint.get("line-gradient"),P=b?"linePattern":"line",O=t.context,A=O.gl,R=eF(n);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(M=!1);for(let F of o){let k=e.getTile(F);if(b&&!k.patternsLoaded())continue;let N=k.getBucket(n);if(!N)continue;t.prepareDrawTile();let B=N.programConfigurations.get(n.id),H=t.isTileAffectedByFog(F),G=t.getOrCreateProgram(P,{config:B,defines:R,overrideFog:H}),Y=x.constantOr(null);if(Y&&k.imageAtlas){let pe=k.imageAtlas.patternPositions[Y.toString()];pe&&B.setConstantPatternPositions(pe)}let U=g.constantOr(null),Q=v.constantOr(null);if(!b&&U&&Q&&k.lineAtlas){let pe=k.lineAtlas.getDash(U,Q);pe&&B.setConstantPatternPositions(pe)}let[te,se]=n.paint.get("line-trim-offset");(Q==="round"||Q==="square")&&te!==se&&(te===0&&(te-=1),se===1&&(se+=1));let K=t.terrain?F.projMatrix:null,ee=b?LW(t,k,n,K,p):RW(t,k,n,K,N.lineClipsArray.length,p,[te,se]);if(S){let pe=N.gradients[n.id],fe=pe.texture;if(n.gradientVersion!==pe.version){let be=256;if(n.stepInterpolant){let Te=e.getSource().maxzoom,Me=F.canonical.z===Te?Math.ceil(1<<t.transform.maxZoom-F.canonical.z):1;be=ze(io(N.maxLineLength/ne*1024*Me),256,O.maxTextureSize)}pe.gradient=Hy({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:be,image:pe.gradient||void 0,clips:N.lineClipsArray}),pe.texture?pe.texture.update(pe.gradient):pe.texture=new fr(O,pe.gradient,A.RGBA),pe.version=n.gradientVersion,fe=pe.texture}O.activeTexture.set(A.TEXTURE1),fe.bind(n.stepInterpolant?A.NEAREST:A.LINEAR,A.CLAMP_TO_EDGE)}_&&(O.activeTexture.set(A.TEXTURE0),k.lineAtlasTexture&&k.lineAtlasTexture.bind(A.LINEAR,A.REPEAT),B.updatePaintBuffers()),b&&(O.activeTexture.set(A.TEXTURE0),k.imageAtlasTexture&&k.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),B.updatePaintBuffers()),t.uploadCommonUniforms(O,G,F.toUnwrapped());let de=pe=>{G.draw(t,A.TRIANGLES,d,pe,f,bn.disabled,ee,n.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,n.paint,t.transform.zoom,B,[N.layoutVertexBuffer2])};if(M){let pe=t.stencilModeForClipping(F).ref;pe===0&&t.terrain&&O.clear({stencil:0});let fe={func:A.EQUAL,mask:255};ee.u_alpha_discard_threshold=.8,de(new _n(fe,pe,255,A.KEEP,A.KEEP,A.INVERT)),ee.u_alpha_discard_threshold=0,de(new _n(fe,pe,255,A.KEEP,A.KEEP,A.KEEP))}else de(t.stencilModeForClipping(F))}M&&(t.resetStencilClippingMasks(),t.terrain&&O.clear({stencil:0}))},fill:function(t,e,n,o){let s=n.paint.get("fill-color"),l=n.paint.get("fill-opacity");if(l.constantOr(1)===0)return;let u=n.paint.get("fill-emissive-strength"),d=t.colorModeForDrapableLayerRenderPass(u),f=n.paint.get("fill-pattern"),p=t.opaquePassEnabledForLayer()&&!f.constantOr(1)&&s.constantOr(tn.transparent).a===1&&l.constantOr(0)===1?"opaque":"translucent";if(t.renderPass===p){let g=t.depthModeForSublayer(1,t.renderPass==="opaque"?$t.ReadWrite:$t.ReadOnly);Ek(t,e,n,o,g,d,!1)}if(t.renderPass==="translucent"&&n.paint.get("fill-antialias")){let g=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,$t.ReadOnly);Ek(t,e,n,o,g,d,!0)}},"fill-extrusion":function(t,e,n,o){let s=n.paint.get("fill-extrusion-opacity"),l=t.context,u=l.gl,d=t.terrain,f=d&&d.renderingToTexture,p=n.paint.get("fill-extrusion-cutoff-fade-range");if(s===0)return;let g=t.conflationActive&&t.layerUsedInConflation(n,e.getSource());if(g&&function(_,v,x,b){for(let T of b){let E=v.getTile(T).getBucket(x);E&&(E.updateReplacement(T,_.replacementSource),E.uploadCentroid(_.context))}}(t,e,n,o),d||g)for(let _ of o){let v=e.getTile(_).getBucket(n);v&&mZ(t.context,e,_,v,n,d,g)}if(t.renderPass==="shadow"&&t.shadowRenderer){let _=t.shadowRenderer;if(d&&s<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Ru)return;let v=_.getShadowPassDepthMode(),x=_.getShadowPassColorMode();Wv(t,e,n,o,v,_n.disabled,x,g)}else if(t.renderPass==="translucent"){let _=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!f){let v=new $t(t.context.gl.LEQUAL,$t.ReadWrite,t.depthRangeFor3D);p===0&&s===1&&_?Wv(t,e,n,o,v,_n.disabled,Hn.unblended,g):(Wv(t,e,n,o,v,_n.disabled,Hn.disabled,g),Wv(t,e,n,o,v,t.stencilModeFor3D(),t.colorModeForRenderPass(),g),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&_&&(!d&&t.transform.projection.name!=="globe"||f)){let v=n.paint.get("fill-extrusion-opacity"),x=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),b=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),T=n.paint.get("fill-extrusion-flood-light-intensity"),E=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),M=x>0&&b>0,S=T>0,P=(A,R,F)=>(1-F)*A+F*R,O=A=>{let R=t.depthModeForSublayer(1,$t.ReadOnly,u.LEQUAL,!0),F=n.paint.get(A?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),k=P(.1,3,F),N=t._showOverdrawInspector;if(!N){let B=new _n({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),H=new Hn([u.ONE,u.ONE,u.ONE,u.ONE],tn.transparent,[!1,!1,!1,!0],u.MIN);cp(t,e,n,o,R,B,H,bn.disabled,A,"sdf",v,x,b,T,E,k,g,!1)}{let B=N?_n.disabled:new _n({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),H=N?t.colorModeForRenderPass():new Hn([u.ONE_MINUS_DST_ALPHA,u.DST_ALPHA,u.ONE,u.ONE],tn.transparent,[!0,!0,!0,!0]);cp(t,e,n,o,R,B,H,bn.disabled,A,"color",v,x,b,T,E,k,g,!1)}};if(f){let A=(R,F,k)=>{let N=t.depthModeForSublayer(1,$t.ReadOnly,u.LEQUAL,!1),B=n.paint.get(R?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),H=P(.1,3,B);{let G=new Hn([u.ONE,u.ONE,u.ONE,u.ONE],tn.transparent,[!1,!1,!1,!0]);cp(t,e,n,o,N,_n.disabled,G,bn.disabled,R,"clear",v,x,b,T,E,H,g,F)}{let G=new _n({func:u.ALWAYS,mask:255},255,255,u.KEEP,u.KEEP,u.REPLACE),Y=new Hn([u.ONE,u.ONE,u.ONE,u.ONE],tn.transparent,[!1,!1,!1,!0],u.MIN);cp(t,e,n,o,N,G,Y,bn.disabled,R,"sdf",v,x,b,T,E,H,g,F)}{let G=R?u.ZERO:u.ONE_MINUS_DST_ALPHA,Y=new _n({func:u.EQUAL,mask:255},255,255,u.KEEP,u.DECR,u.DECR),U=new Hn([G,u.DST_ALPHA,u.ONE_MINUS_DST_ALPHA,u.ZERO],tn.transparent,[!0,!0,!0,!0]);cp(t,e,n,o,N,Y,U,bn.disabled,R,"color",v,x,b,T,E,H,g,F)}{let G=new Hn([u.ONE,u.ONE,u.ONE,R?u.ZERO:u.ONE],tn.transparent,[!1,!1,!1,!0],R?u.FUNC_ADD:u.MAX);cp(t,e,n,o,N,_n.disabled,G,bn.disabled,R,"clear",v,x,b,T,E,H,g,F,k)}};if(M||S){let R;if(t.prepareDrawTile(),d){let F=d.drapeBufferSize[0],k=d.drapeBufferSize[1];R=d.framebufferCopyTexture,R&&(!R||R.size[0]===F&&R.size[1]===k)||(R&&R.destroy(),R=d.framebufferCopyTexture=new fr(l,new qr({width:F,height:k}),u.RGBA)),R.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,F,k,0)}M&&A(!0,!1,R),S&&A(!1,!0,R)}}else M&&O(!0),S&&O(!1)}}},hillshade:function(t,e,n,o){if(t.renderPass!=="offscreen"&&t.renderPass!=="translucent"||t.style.disableElevatedTerrain)return;let s=t.context,l=t.terrain&&t.terrain.renderingToTexture,[u,d]=t.renderPass!=="translucent"||l?[{},o]:t.stencilConfigForOverlap(o);for(let f of d){let p=e.getTile(f);if(p.needsHillshadePrepare&&t.renderPass==="offscreen")$q(t,p,n);else if(t.renderPass==="translucent"){let g=t.depthModeForSublayer(0,$t.ReadOnly),_=n.paint.get("hillshade-emissive-strength"),v=t.colorModeForDrapableLayerRenderPass(_),x=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(f):u[f.overscaledZ];Uq(t,f,p,n,g,x,v)}}s.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,e,n,o,s,l){if(t.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;let u=t.context,d=u.gl,f=e.getSource(),p=function(F,k,N){let B=F.paint.get("raster-color"),H=[],G=F.paint.get("raster-resampling"),Y=F.paint.get("raster-color-mix"),U=F.paint.get("raster-color-range"),Q=[Y[0],Y[1],Y[2],0],te=Y[3],se=G==="nearest"?N.NEAREST:N.LINEAR;if(B&&H.push("RASTER_COLOR"),B){k.activeTexture.set(N.TEXTURE2);let K=F.colorRampTexture;K||(K=F.colorRampTexture=new fr(k,F.colorRamp,N.RGBA)),K.bind(N.LINEAR,N.CLAMP_TO_EDGE)}return{mix:Q,range:U,offset:te,defines:H,resampling:se}}(n,u,d),g=p.defines,_=t.transform.projection.name==="globe",v=!1;if(f instanceof Ga&&!o.length){if(!_)return;if(f.onNorthPole)v=!0,g.push("GLOBE_POLES");else{if(!f.onSouthPole)return;v=!0,g.push("GLOBE_POLES")}}let x=n.paint.get("raster-emissive-strength"),b=t.colorModeForDrapableLayerRenderPass(x),T=t.terrain&&t.terrain.renderingToTexture,E=f instanceof Ga&&n.paint.get("raster-elevation")!==0,M=!t.options.moving,S=n.paint.get("raster-resampling")==="nearest"?d.NEAREST:d.LINEAR;if(v){let F=e.getSource();if(!(F instanceof Ga))return;let k=F.texture;if(!k)return;let N=t.globeSharedBuffers;if(!N)return;let B=new $t(d.LEQUAL,$t.ReadWrite,t.depthRangeFor3D),H=Float32Array.from(t.transform.expandedFarZProjMatrix),G=D2(0,0,t.transform),Y=Float32Array.from($u(ga(new Va(0,0,0)))),U={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),k.bind(S,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),k.bind(S,d.CLAMP_TO_EDGE),k.useMipmap&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);let[Q,te,se,K]=N.getPoleBuffers(0,!0),ee;F.onNorthPole?(ee=Q,t.renderDefaultNorthPole=!1):(G=ae.scale(ae.create(),G,[1,-1,1]),ee=te,t.renderDefaultSouthPole=!1);let de=((fe,be,Te,Me,ge,Pe,et,tt,lt,ct,Ht,Tt)=>mk(fe,be,Te,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,Me,ge,Pe||[0,0],et,2,lt,ct,Ht,1,0,Tt))(H,Y,G,U,n,F.perspectiveTransform||[0,0],n.paint.get("raster-elevation"),0,p.mix,p.offset,p.range,x),pe=t.getOrCreateProgram("raster",{defines:p.defines});return t.uploadCommonUniforms(u,pe,null),void pe.draw(t,d.TRIANGLES,B,_n.disabled,b,bn.disabled,de,n.id,ee,se,K)}if(!o.length)return;let[P,O]=f instanceof Ga||T?[{},o]:t.stencilConfigForOverlap(o),A=O[O.length-1].overscaledZ,R=E&&_;R&&p.defines.push("PROJECTION_GLOBE_VIEW"),E&&p.defines.push("RENDER_CUTOFF");for(let F of O){let k=F.toUnwrapped(),N=e.getTile(F);if(T&&(!N||!N.hasData())||!N.texture)continue;let B,H;T?(B=$t.disabled,H=F.projMatrix):E?(B=new $t(d.LEQUAL,$t.ReadWrite,t.depthRangeFor3D),H=_?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(k,M)):(B=t.depthModeForSublayer(F.overscaledZ-A,n.paint.get("raster-opacity")===1?$t.ReadWrite:$t.ReadOnly,d.LESS),H=t.transform.calculateProjMatrix(k,M));let G=t.terrain&&T?t.terrain.stencilModeForRTTOverlap(F):P[F.overscaledZ],Y=l?0:n.paint.get("raster-fade-duration");N.registerFadeDuration(Y);let U=e.findLoadedParent(F,0),Q=ak(N,U,e,t.transform,Y),te,se;t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),N.texture&&N.texture.bind(S,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),U?(U.texture&&U.texture.bind(S,d.CLAMP_TO_EDGE),te=Math.pow(2,U.tileID.overscaledZ-N.tileID.overscaledZ),se=[N.tileID.canonical.x*te%1,N.tileID.canonical.y*te%1]):N.texture&&N.texture.bind(S,d.CLAMP_TO_EDGE),N.texture&&N.texture.useMipmap&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);let K=t.transform,ee=f instanceof Ga?f.perspectiveTransform:[0,0],de=E?xZ(K):[0,0,0,0],pe,fe,be,Te,Me,ge;if(R&&f instanceof Ga&&f.coordinates.length>3){pe=Float32Array.from($u(ga(new Va(0,0,0)))),fe=Float32Array.from(K.globeMatrix),be=Float32Array.from(S2(K)),Te=[ao(K.center.lng),po(K.center.lat)],ge=[ao(f.coordinates[1][0]),po(f.coordinates[1][1]),ao(f.coordinates[3][0]),po(f.coordinates[3][1])];let lt=new Gs(f.coordinates[1],f.coordinates[3]);Me=Float32Array.from(P2(new Va(0,0,0),lt,0,K.worldSize/t.transform._pixelsPerMercatorPixel))}else pe=new Float32Array(16),fe=new Float32Array(9),be=new Float32Array(16),Te=[0,0],Me=new Float32Array(16),ge=[0,0,0,0];let Pe=mk(H,pe,fe,be,Me,se||[0,0],ge,Do(t.transform.zoom),Te,de,te||1,Q,n,ee,E?n.paint.get("raster-elevation"):0,2,p.mix,p.offset,p.range,1,0,x),et=t.isTileAffectedByFog(F),tt=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:et});if(t.uploadCommonUniforms(u,tt,k),f instanceof Ga){if(T||!_)f.boundsBuffer&&f.boundsSegments&&tt.draw(t,d.TRIANGLES,B,_n.disabled,b,bn.disabled,Pe,n.id,f.boundsBuffer,t.quadTriangleIndexBuffer,f.boundsSegments);else if(t.globeSharedBuffers){let[lt,ct,Ht]=t.globeSharedBuffers.getGridBuffers(0,!1);tt.draw(t,d.TRIANGLES,B,_n.disabled,b,bn.frontCCW,Pe,n.id,lt,ct,Ht),tt.draw(t,d.TRIANGLES,B,_n.disabled,b,bn.backCCW,Pe,n.id,lt,ct,Ht)}}else{let{tileBoundsBuffer:lt,tileBoundsIndexBuffer:ct,tileBoundsSegments:Ht}=t.getTileBoundsBuffers(N);tt.draw(t,d.TRIANGLES,B,G,b,bn.disabled,Pe,n.id,lt,ct,Ht)}}t.resetStencilClippingMasks()},background:function(t,e,n,o){let s=n.paint.get("background-color"),l=n.paint.get("background-opacity"),u=n.paint.get("background-emissive-strength");if(l===0)return;let d=t.context,f=d.gl,p=t.transform,g=p.tileSize,_=n.paint.get("background-pattern");if(t.isPatternMissing(_,n.scope))return;let v=!_&&s.a===1&&l===1&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==v)return;let x=_n.disabled,b=t.depthModeForSublayer(0,v==="opaque"?$t.ReadWrite:$t.ReadOnly),T=t.colorModeForDrapableLayerRenderPass(u),E=_?"backgroundPattern":"background",M,S=o;S||(M=t.getBackgroundTiles(),S=Object.values(M).map(P=>P.tileID)),_&&(d.activeTexture.set(f.TEXTURE0),t.imageManager.bind(t.context,n.scope));for(let P of S){let O=t.isTileAffectedByFog(P),A=t.getOrCreateProgram(E,{overrideFog:O}),R=P.toUnwrapped(),F=o?P.projMatrix:t.transform.calculateProjMatrix(R);t.prepareDrawTile();let k=e?e.getTile(P):M?M[P.key]:new lg(P,g,p.zoom,t),N=_?uZ(F,u,l,t,_,n.scope,{tileID:P,tileSize:g}):cZ(F,u,l,s);t.uploadCommonUniforms(d,A,R);let{tileBoundsBuffer:B,tileBoundsIndexBuffer:H,tileBoundsSegments:G}=t.getTileBoundsBuffers(k);A.draw(t,f.TRIANGLES,b,x,T,bn.disabled,N,n.id,B,H,G)}},sky:function(t,e,n){let o=t._atmosphere?Do(t.transform.zoom):1,s=n.paint.get("sky-opacity")*o;if(s===0)return;let l=t.context,u=n.paint.get("sky-type"),d=new $t(l.gl.LEQUAL,$t.ReadOnly,[0,1]),f=t.frameCounter/1e3%1;u==="atmosphere"?t.renderPass==="offscreen"?n.needsSkyboxCapture(t)&&(function(p,g,_,v){let x=p.context,b=x.gl,T=g.skyboxFbo;if(!T){T=g.skyboxFbo=x.createFramebuffer(32,32,!0,null),g.skyboxGeometry=new Ck(x),g.skyboxTexture=x.gl.createTexture(),b.bindTexture(b.TEXTURE_CUBE_MAP,g.skyboxTexture),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR);for(let P=0;P<6;++P)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,b.RGBA,32,32,0,b.RGBA,b.UNSIGNED_BYTE,null)}x.bindFramebuffer.set(T.framebuffer),x.viewport.set([0,0,32,32]);let E=g.getCenter(p,!0),M=p.getOrCreateProgram("skyboxCapture"),S=new Float64Array(16);ae.identity(S),ae.rotateY(S,S,.5*-Math.PI),up(p,g,M,S,E,0),ae.identity(S),ae.rotateY(S,S,.5*Math.PI),up(p,g,M,S,E,1),ae.identity(S),ae.rotateX(S,S,.5*-Math.PI),up(p,g,M,S,E,2),ae.identity(S),ae.rotateX(S,S,.5*Math.PI),up(p,g,M,S,E,3),ae.identity(S),up(p,g,M,S,E,4),ae.identity(S),ae.rotateY(S,S,Math.PI),up(p,g,M,S,E,5),x.viewport.set([0,0,p.width,p.height])}(t,n),n.markSkyboxValid(t)):t.renderPass==="sky"&&function(p,g,_,v,x){let b=p.context,T=b.gl,E=p.transform,M=p.getOrCreateProgram("skybox");b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_CUBE_MAP,g.skyboxTexture);let S=((P,O,A,R,F)=>({u_matrix:P,u_sun_direction:O,u_cubemap:0,u_opacity:R,u_temporal_offset:F}))(E.skyboxMatrix,g.getCenter(p,!1),0,v,x);p.uploadCommonUniforms(b,M),M.draw(p,T.TRIANGLES,_,_n.disabled,p.colorModeForRenderPass(),bn.backCW,S,"skybox",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(t,n,d,s,f):u==="gradient"&&t.renderPass==="sky"&&function(p,g,_,v,x){let b=p.context,T=b.gl,E=p.transform,M=p.getOrCreateProgram("skyboxGradient");g.skyboxGeometry||(g.skyboxGeometry=new Ck(b)),b.activeTexture.set(T.TEXTURE0);let S=g.colorRampTexture;S||(S=g.colorRampTexture=new fr(b,g.colorRamp,T.RGBA)),S.bind(T.LINEAR,T.CLAMP_TO_EDGE);let P=((O,A,R,F,k)=>({u_matrix:O,u_color_ramp:0,u_center_direction:A,u_radius:Vt(R),u_opacity:F,u_temporal_offset:k}))(E.skyboxMatrix,g.getCenter(p,!1),g.paint.get("sky-gradient-radius"),v,x);p.uploadCommonUniforms(b,M),M.draw(p,T.TRIANGLES,_,_n.disabled,p.colorModeForRenderPass(),bn.backCW,P,"skyboxGradient",g.skyboxGeometry.vertexBuffer,g.skyboxGeometry.indexBuffer,g.skyboxGeometry.segment)}(t,n,d,s,f)},debug:function(t,e,n){for(let o=0;o<n.length;o++)IZ(t,e,n[o])},custom:function(t,e,n,o){let s=t.context,l=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||t.renderPass==="offscreen")&&n.isLayerDraped(e)){if(t.renderPass==="offscreen"){let u=l.prerender;if(u){if(t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),t.transform.projection.name==="globe"){let d=t.transform.pointMerc;u.call(l,s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),Do(t.transform.zoom),[d.x,d.y],t.transform.pixelsPerMeterRatio)}else u.call(l,s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState()}}else if(t.renderPass==="translucent"){if(t.terrain&&t.terrain.renderingToTexture){let d=l.renderToTile;if(d){let f=o[0].canonical,p=new Fn(f.x+o[0].wrap*(1<<f.z),f.y,f.z);s.setDepthMode($t.disabled),s.setStencilMode(_n.disabled),s.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),d.call(l,s.gl,p),s.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),s.setStencilMode(_n.disabled);let u=l.renderingMode==="3d"?new $t(t.context.gl.LEQUAL,$t.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,$t.ReadOnly);if(s.setDepthMode(u),t.transform.projection.name==="globe"){let d=t.transform.pointMerc;l.render(s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),Do(t.transform.zoom),[d.x,d.y],t.transform.pixelsPerMeterRatio)}else l.render(s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState(),s.bindFramebuffer.set(null)}}else J("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,e,n,o){if(t.renderPass==="opaque")return;let s=n.paint.get("model-opacity");if(s===0)return;let l=n.paint.get("model-cast-shadows");if(t.renderPass==="shadow"&&(!l||t.terrain&&s<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof Ru))return;let u=t.shadowRenderer,d=n.paint.get("model-receive-shadows");u&&(u.useNormalOffset=!0,d||(u.enabled=!1));let f=()=>{u&&(u.useNormalOffset=!0,d||(u.enabled=!0))},p=e.getSource();if(t.renderPass==="light-beam"&&p.type!=="batched-model")return;if(p.type==="vector"||p.type==="geojson")return function(M,S,P,O){let A=M.transform;if(A.projection.name!=="mercator")return void J(`Drawing 3D models for ${A.projection.name} projection is not yet implemented`);let R=A.getFreeCameraOptions().position;if(!M.modelManager)return;let F=M.modelManager,k=M.shadowRenderer;if(!P._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let N=P._unevaluatedLayout._values["model-id"],B=Lt({},P.layout.get("model-id").parameters);for(let H of O){let G=S.getTile(H).getBucket(P);if(!G||G.projection.name!==A.projection.name)continue;let Y=LZ(H,A);B.zoom=Y;let U=N.possiblyEvaluate(B);if(RZ(M,G,H),rc.shadowUniformsInitialized=!1,rc.useSingleShadowCascade=!!k&&k.getMaxCascadeForTile(H.toUnwrapped())===0,M.renderPass==="shadow"&&k){if(M.currentShadowCascade===1&&G.isInsideFirstShadowMapFrustum)continue;let se=A.calculatePosMatrix(H.toUnwrapped(),A.worldSize);if(rc.tileMatrix.set(se),rc.shadowTileMatrix=Float32Array.from(k.calculateShadowPassMatrixFromMatrix(se)),rc.aabb.min.fill(0),rc.aabb.max[0]=rc.aabb.max[1]=ne,rc.aabb.max[2]=0,kZ(G,rc,M,P.scope))continue}let Q=1<<H.canonical.z,te=[((R.x-H.wrap)*Q-H.canonical.x)*ne,(R.y*Q-H.canonical.y)*ne,R.z*Q*ne];for(let se in G.instancesPerModel){let K=G.instancesPerModel[se];K.features.length>0&&(se=U.evaluate(K.features[0].feature,{}));let ee=F.getModel(se,P.scope);if(ee&&ee.uploaded)for(let de of ee.nodes)Ak(M,P,de,K,te,H,rc)}}}(t,e,n,o),void f();if(!p.loaded())return;if(p.type==="batched-model")return function(M,S,P,O){let A=M.context,R=M.transform,F=M.style.fog,k=M.shadowRenderer;if(R.projection.name!=="mercator")return void J(`Drawing 3D landmark models for ${R.projection.name} projection is not yet implemented`);let N=M.transform.getFreeCameraOptions().position,B=Z.scale([],[N.x,N.y,N.z],M.transform.worldSize);Z.negate(B,B);let H=ae.identity([]),G=Gu(R.center.lat,R.zoom),Y=ae.fromScaling([],[1,1,1/G]);ae.translate(H,H,B);let U=P.paint.get("model-opacity"),Q=new $t(A.gl.LEQUAL,$t.ReadWrite,M.depthRangeFor3D),te=new $t(A.gl.LEQUAL,$t.ReadOnly,M.depthRangeFor3D),se=function(K,ee){for(let de of O){let pe=S.getTile(de).getBucket(P);if(!pe||!pe.uploaded)continue;let fe=!1;k&&(fe=k.getMaxCascadeForTile(de.toUnwrapped())===0);let be=R.calculatePosMatrix(de.toUnwrapped(),R.worldSize),Te=pe.modelTraits;for(let Me of pe.getNodesInfo()){if(Me.hiddenByReplacement||!Me.node.meshes)continue;let ge=Me.node,Pe=M.renderPass==="light-beam",et=[...be],tt=Me.evaluatedScale,lt=0;M.terrain&&ge.elevation&&(lt=ge.elevation*M.terrain.exaggeration()),ae.translate(et,et,[(ge.anchor?ge.anchor[0]:0)*(tt[0]-1),(ge.anchor?ge.anchor[1]:0)*(tt[1]-1),lt]),tt!==fW&&ae.scale(et,et,tt),ae.multiply(et,et,ge.matrix);let ct=ae.multiply([],Y,et);ae.multiply(ct,H,ct);let Ht=ae.invert([],ct);ae.transpose(Ht,Ht),ae.scale(Ht,Ht,FZ);let Tt=ae.multiply([],R.expandedFarZProjMatrix,et);for(let zn=0;zn<ge.meshes.length;++zn){let Dn=ge.meshes[zn],Gt=zn===ge.lightMeshIndex;if(Gt){if(!Pe&&!M.terrain&&M.shadowRenderer){M.currentLayer<M.firstLightBeamLayer&&(M.firstLightBeamLayer=M.currentLayer);continue}}else if(Pe)continue;let kt={defines:[]},St=[];ZE(kt.defines,St,Dn,M),4&Te||kt.defines.push("DIFFUSE_SHADED"),fe&&kt.defines.push("SHADOWS_SINGLE_CASCADE");let Pn=M.renderPass==="shadow";if(Pn){YE(Dn,et,M,P);continue}let Nn=null;if(F){let jr=Sk(et,M.transform);if(Nn=new Float32Array(jr),R.projection.name!=="globe"){let Rr=Dn.aabb.min,Xi=Dn.aabb.max,[_i,zo]=F.getOpacityForBounds(jr,Rr[0],Rr[1],Xi[0],Xi[1]);kt.overrideFog=_i>=dh||zo>=dh}}let fn=M.getOrCreateProgram("model",kt);!Pn&&k&&(k.useNormalOffset=!!Dn.normalBuffer,k.setupShadowsFromMatrix(et,fn,k.useNormalOffset)),M.uploadCommonUniforms(A,fn,de.toUnwrapped(),Nn);let Ri=Dn.material,Or=Ri.pbrMetallicRoughness;Or.metallicFactor=.9,Or.roughnessFactor=.5;let Mi=0,Zi=WE(new Float32Array(Tt),new Float32Array(ct),new Float32Array(Ht),M,U,Or.baseColorFactor,Ri.emissiveFactor,Or.metallicFactor,Or.roughnessFactor,Ri,Mi,P);fn.draw(M,A.gl.TRIANGLES,ee&&!Gt?Q:te,_n.disabled,K?Gt||U<1||Me.hasTranslucentParts?Hn.alphaBlended:Hn.unblended:Hn.disabled,bn.backCCW,Zi,P.id,Dn.vertexBuffer,Dn.indexBuffer,Dn.segments,P.paint,M.transform.zoom,void 0,St)}}}};(function(K,ee,de,pe){let fe=K.terrain?K.terrain.exaggeration():0,be=K.transform.zoom;for(let Te of pe){let Me=ee.getTile(Te).getBucket(de);Me&&(K.conflationActive&&Me.updateReplacement(Te,K.replacementSource),Me.evaluateScale(K,de),K.terrain&&fe>0&&Me.elevationUpdate(K.terrain,fe,Te,de.source),Me.needsReEvaluation(K,be,de)&&Me.evaluate(de))}})(M,S,P,O),U===1?se(!0,!0):(se(!1,!0),se(!0,!1))}(t,e,n,o),void f();let g=p.getModels(),_=[],v=t.transform.getFreeCameraOptions().position,x=Z.scale([],[v.x,v.y,v.z],t.transform.worldSize);Z.negate(x,x);let b=[],T=[],E=0;for(let M of g){let S=n.paint.get("model-rotation").constantOr(null),P=n.paint.get("model-scale").constantOr(null),O=n.paint.get("model-translation").constantOr(null);M.computeModelMatrix(t,S,P,O,!0,!0,!1);let A=ae.identity([]),R=Gu(M.position.lat,t.transform.zoom),F=ae.fromScaling([],[1,1,1/R]);ae.translate(A,A,x),_.push({zScaleMatrix:F,negCameraPosMatrix:A});for(let k of M.nodes)Dk(t.transform,k,M.matrix,t.transform.expandedFarZProjMatrix,E,b,T);E++}if(b.sort((M,S)=>S.depth-M.depth),t.renderPass!=="shadow"){if(s===1)for(let M of T)Zv(M,t,n,_[M.modelIndex],_n.disabled,t.colorModeForRenderPass());else{for(let M of T)Zv(M,t,n,_[M.modelIndex],_n.disabled,Hn.disabled);for(let M of T)Zv(M,t,n,_[M.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(let M of b)Zv(M,t,n,_[M.modelIndex],_n.disabled,t.colorModeForRenderPass());f()}else{for(let M of T)YE(M.mesh,M.nodeModelMatrix,t,n);for(let M of b)YE(M.mesh,M.nodeModelMatrix,t,n);f()}}},Ok={modelUpload:function(t,e,n){let o=e.getSource();if(!o.loaded())return;if(o.type==="vector"||o.type==="geojson")return void(t.modelManager&&t.modelManager.upload(t,n));if(o.type==="batched-model")return;let s=o.getModels();for(let l of s)l.upload(t.context)}};class BZ{constructor(e,n,o){this.context=new nW(e,n),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=_l.maxUnderzooming+_l.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new vW,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new UZ(this),this._wireframeDebugCache=new zZ,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,n){let o=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(o||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new qq(this,e));let s=this._terrain;this.transform.elevation=o?s:null,s.update(e,this.transform,n),this.transform.elevation&&!s.enabled&&(this.transform.elevation=null)}_updateFog(e){let n=e.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[o,s]=n.getFovAdjustedRange(this.transform._fov);if(o>s)return void(this.transform.fogCullDistSq=null);let l=o+.78*(s-o);this.transform.fogCullDistSq=l*l}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,n){if(this.width=e*Zt.devicePixelRatio,this.height=n*Zt.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let o of this.style.order)this.style._mergedLayers[o].resize()}setup(){let e=this.context,n=new $s;n.emplaceBack(0,0),n.emplaceBack(ne,0),n.emplaceBack(0,ne),n.emplaceBack(ne,ne),this.tileExtentBuffer=e.createVertexBuffer(n,Vu.members),this.tileExtentSegments=Ti.simpleSegment(0,0,4,2);let o=new $s;o.emplaceBack(0,0),o.emplaceBack(ne,0),o.emplaceBack(0,ne),o.emplaceBack(ne,ne),this.debugBuffer=e.createVertexBuffer(o,Vu.members),this.debugSegments=Ti.simpleSegment(0,0,4,5);let s=new $s;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(-1,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,Vu.members),this.viewportSegments=Ti.simpleSegment(0,0,4,2);let l=new eh;l.emplaceBack(0,0,0,0),l.emplaceBack(ne,0,ne,0),l.emplaceBack(0,ne,0,ne),l.emplaceBack(ne,ne,ne,ne),this.mercatorBoundsBuffer=e.createVertexBuffer(l,cE.members),this.mercatorBoundsSegments=Ti.simpleSegment(0,0,4,2);let u=new Kr;u.emplaceBack(0,1,2),u.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(u);let d=new jm;for(let p of[0,1,3,2,0])d.emplaceBack(p);this.debugIndexBuffer=e.createIndexBuffer(d),this.emptyTexture=new fr(e,new qr({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=ae.create();let f=this.context.gl;this.stencilClearMode=new _n({func:f.ALWAYS,mask:0},0,255,f.ZERO,f.ZERO,f.ZERO),this.loadTimeStamps.push(y.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,$t.disabled,this.stencilClearMode,Hn.disabled,bn.disabled,GE(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,n,o){if(!n||this.currentStencilSource===n.id||!e.isTileClipped()||!o||o.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let d=!1;for(let f of o)if(this._tileClippingMaskIDs[f.key]===void 0){d=!0;break}if(!d)return}this.currentStencilSource=n.id;let s=this.context,l=s.gl;this.nextStencilID+o.length>256&&this.clearStencil(),s.setColorMode(Hn.disabled),s.setDepthMode($t.disabled);let u=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let d of o){let f=n.getTile(d),p=this._tileClippingMaskIDs[d.key]=this.nextStencilID++,{tileBoundsBuffer:g,tileBoundsIndexBuffer:_,tileBoundsSegments:v}=this.getTileBoundsBuffers(f);u.draw(this,l.TRIANGLES,$t.disabled,new _n({func:l.ALWAYS,mask:0},p,255,l.KEEP,l.KEEP,l.REPLACE),Hn.disabled,bn.disabled,GE(d.projMatrix),"$clipping",g,_,v)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,n=this.context.gl;return new _n({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);let n=this.context.gl;return new _n({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){let n=this.context.gl,o=e.sort((u,d)=>d.overscaledZ-u.overscaledZ),s=o[o.length-1].overscaledZ,l=o[0].overscaledZ-s+1;if(l>1){this.currentStencilSource=void 0,this.nextStencilID+l>256&&this.clearStencil();let u={};for(let d=0;d<l;d++)u[d+s]=new _n({func:n.GEQUAL,mask:255},d+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=l,[u,o]}return[{[s]:_n.disabled},o]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new Hn([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new tn(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Hn.unblended:Hn.alphaBlended}colorModeForDrapableLayerRenderPass(e){let n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Hn([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new tn(0,0,0,e===void 0?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,n,o,s=!1){if(!this.opaquePassEnabledForLayer()&&!s)return $t.disabled;let l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new $t(o||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=n;let o=this.style._mergedLayers,s=this.style.order,l=s.map(A=>o[A]),u=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(Zt.now()),this.imageManager.beginFrame();let d=0,f=!1;for(let A in u){let R=u[A];R.used&&(R.prepare(this.context),R.getSource().usedInConflation&&++d)}let p={},g={},_={},v={},x={};for(let A in u){let R=u[A];p[A]=R.getVisibleCoordinates(),g[A]=p[A].slice().reverse(),_[A]=R.getVisibleCoordinates(!0).reverse(),v[A]=R.getShadowCasterCoordinates(),x[A]=R.sortCoordinatesByDistance(p[A])}let b=A=>{let R=this.style.getLayerSourceCache(A);return R&&R.used?R.getSource():null};if(d){let A=[];for(let R of l)this.layerUsedInConflation(R,b(R))&&A.push(R);if(A&&A.length>1){let R=[];for(let F of A){let k=this.style.getLayerSourceCache(F);k&&k.used&&k.getSource().usedInConflation&&R.push({layer:F.fqid,cache:k})}this.replacementSource.setSources(R),f=!0}}f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let A of l){let R=A.cutoffRange();if(this.longestCutoffRange=Math.max(R,this.longestCutoffRange),R>0){let F=b(A);F&&(this.minCutoffZoom=Math.max(F.minzoom,this.minCutoffZoom)),A.minzoom&&(this.minCutoffZoom=Math.max(A.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let A=0;A<l.length;A++)if(l[A].is3D()){this.opaquePassCutoff=A;break}let T=this.style&&this.style.fog;T?(this._fogVisible=T.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=T.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_),this.opaquePassCutoff=0);let E=this._shadowRenderer;if(E){E.updateShadowParameters(this.transform,this.style.directionalLight);for(let A in u)for(let R of p[A]){let F={min:0,max:0};this.terrain&&(F=this.terrain.getMinMaxForTile(R)||F),E.addShadowReceiver(R.toUnwrapped(),F.min,F.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new _H(this.context));for(let A of l){if(A.isHidden(this.transform.zoom))continue;let R=e.getLayerSourceCache(A);this.uploadLayer(this,A,R)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new OZ),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!js.has(this.context.gl))return;this.renderPass="offscreen";for(let A of l){let R=e.getLayerSourceCache(A);if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;let F=R?g[R.id]:void 0;(A.type==="custom"||A.type==="raster"||A.isSky()||F&&F.length)&&this.renderLayer(this,R,A,F)}this.depthRangeFor3D=[0,1-(l.length+2)*this.numSublayers*this.depthEpsilon];let M=this.terrain;M&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&M.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let S=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),P=(()=>{if(n.showOverdrawInspector)return tn.black;if(this.style.fog&&this.transform.projection.supportsFog&&!S){let A=this.style.fog.properties.get("color").toArray01();return new tn(...A)}if(this.style.fog&&this.transform.projection.supportsFog&&S){let A=this.style.fog.properties.get("space-color").toArray01();return new tn(...A)}return tn.transparent})();if(this.context.clear({color:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&S&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=s.length-1;this.currentLayer>=0;this.currentLayer--){let A=l[this.currentLayer],R=e.getLayerSourceCache(A);if(A.isSky())continue;let F=R?(A.is3D()?x:g)[R.id]:void 0;this._renderTileClippingMasks(A,R,F),this.renderLayer(this,R,A,F)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&S&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Do(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<s.length;this.currentLayer++){let A=l[this.currentLayer],R=e.getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,R,A,R?g[R.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let O=0;for(E&&(O=E.getShadowCastingLayerCount());this.currentLayer<s.length;){let A=l[this.currentLayer],R=e.getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(M&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=M.renderBatch(this.currentLayer);continue}let F;if(R&&(F=(A.type==="symbol"?_:A.is3D()?x:g)[R.id]),this._renderTileClippingMasks(A,R,R?p[R.id]:void 0),this.renderLayer(this,R,A,F),!M&&E&&O>0&&A.hasShadowPass()&&--O==0&&(E.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let k=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=k;this.currentLayer++){let N=l[this.currentLayer];if(!N.hasLightBeamPass())continue;let B=e.getLayerSourceCache(N);this.renderLayer(this,B,N,B?g[B.id]:void 0)}this.currentLayer=k,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let A=null;l.forEach(R=>{let F=e.getLayerSourceCache(R);F&&!R.isHidden(this.transform.zoom)&&F.getVisibleCoordinates().length&&(!A||A.getSource().maxzoom<F.getSource().maxzoom)&&(A=F)}),A&&this.options.showTileBoundaries&&Pk.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){let R=A.transform.padding;Mk(A,A.transform.height-(R.top||0),3,bZ),Mk(A,R.bottom||0,3,wZ),Ik(A,R.left||0,3,TZ),Ik(A,A.transform.width-(R.right||0),3,EZ);let F=A.transform.centerPoint;(function(k,N,B,H){qv(k,N-1,B-10,2,20,H),qv(k,N-10,B-1,20,2,H)})(A,F.x,A.transform.height-F.y,MZ)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(y.performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}uploadLayer(e,n,o){this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&n.type==="custom")&&Ok[`${n.type}Upload`]&&Ok[`${n.type}Upload`](e,o,n.scope),this.gpuTimingEnd()}renderLayer(e,n,o,s){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="sky"||o.type==="custom"||o.type==="model"||o.type==="raster"||s&&s.length)&&(this.id=o.id,this.gpuTimingStart(o),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(o.type)||e.terrain&&o.type==="custom")&&Pk[o.type](e,n,o,s,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;let n=this.context.extTimerQuery,o=this.context.gl,s=this.gpuTimers[e.id];s||(s=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:o.createQuery()}),s.calls++,o.beginQuery(n.TIME_ELAPSED_EXT,s.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let e=this.context.extTimerQuery,n=this.context.gl,o=n.createQuery();this.deferredRenderGpuTimeQueries.push(o),n.beginQuery(e.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){let e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){let n={};for(let o in e){let s=e[o],l=this.context.extTimerQuery,u=l.getQueryParameter(s.query,this.context.gl.QUERY_RESULT)/1e6;l.deleteQueryEXT(s.query),n[o]=u}return n}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;let n=this.context.extTimerQuery,o=this.context.gl,s=0;for(let l of e)s+=n.getQueryParameter(l,o.QUERY_RESULT)/1e6,n.deleteQueryEXT(l);return s}translatePosMatrix(e,n,o,s,l){if(!o[0]&&!o[1])return e;let u=l?s==="map"?this.transform.angle:0:s==="viewport"?-this.transform.angle:0;if(u){let p=Math.sin(u),g=Math.cos(u);o=[o[0]*g-o[1]*p,o[0]*p+o[1]*g]}let d=[l?o[0]:lh(n,o[0],this.transform.zoom),l?o[1]:lh(n,o[1],this.transform.zoom),0],f=new Float32Array(16);return ae.translate(f,e,d),f}saveTileTexture(e){let n=e.size[0],o=this._tileTextures[n];o?o.push(e):this._tileTextures[n]=[e]}getTileTexture(e){let n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e,n){return e===null||e!==void 0&&!this.imageManager.getPattern(e.toString(),n)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(e,n,o){let s=o===void 0?this.terrain&&this.terrain.renderingToTexture:o,l=this.terrain&&this.terrain.exaggeration()===0,u=[];return this.style&&this.style.enable3dLights()&&(e==="globeRaster"||e==="terrainRaster"?(u.push("LIGHTING_3D_MODE"),u.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):s||u.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||u.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?u.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):u.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(u.push("TERRAIN"),this.linearFloatFilteringSupported()&&u.push("TERRAIN_DEM_FLOAT_FORMAT"),l&&u.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&u.push("GLOBE"),!this._fogVisible||s||n!==void 0&&!n||u.push("FOG","FOG_DITHERING"),s&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}getOrCreateProgram(e,n){this.cache=this.cache||{};let o=n&&n.defines||[],s=n&&n.config,l=this.currentGlobalDefines(e,n&&n.overrideFog,n&&n.overrideRtt).concat(o),u=ck.cacheKey(QF[e],e,l,s);return this.cache[u]||(this.cache[u]=new ck(this.context,e,QF[e],s,dZ[e],l)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new fr(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,n){if(this.style.enable3dLights()){let o=this.style.directionalLight,s=this.style.ambientLight;if(o&&s){let l=((u,d)=>{let f=u.properties.get("direction"),p=u.properties.get("color").toArray01(),g=u.properties.get("intensity"),_=d.properties.get("color").toArray01(),v=d.properties.get("intensity"),x=[f.x,f.y,f.z],b=Di(_,v),T=Di(p,g);return{u_lighting_ambient_color:b,u_lighting_directional_dir:x,u_lighting_directional_color:T,u_ground_radiance:Zq(x,T,b)}})(o,s);n.setLightsUniformValues(e,l)}}}uploadCommonUniforms(e,n,o,s,l){if(this.uploadCommonLightUniforms(e,n),this.terrain&&this.terrain.renderingToTexture)return;let u=this.style.fog;if(u){let d=u.getOpacity(this.transform.pitch),f=((p,g,_,v,x,b,T,E,M,S,P,O)=>{let A=p.transform,R=g.properties.get("color").toArray01();R[3]=v;let F=p.frameCounter/1e3%1,[k,N]=g.properties.get("vertical-range");return{u_fog_matrix:_?A.calculateFogTileMatrix(_):O||p.identityMat,u_fog_range:g.getFovAdjustedRange(A._fov),u_fog_color:R,u_fog_horizon_blend:g.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(k,N),N],u_fog_temporal_offset:F,u_frustum_tl:x,u_frustum_tr:b,u_frustum_br:T,u_frustum_bl:E,u_globe_pos:M,u_globe_radius:S,u_viewport:P,u_globe_transition:Do(A.zoom),u_is_globe:+(A.projection.name==="globe")}})(this,u,o,d,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*Zt.devicePixelRatio,this.transform.height*Zt.devicePixelRatio],s);n.setFogUniformValues(e,f)}l&&n.setCutoffUniformValues(e,l.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){let e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){let e=this.context.gl,n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let e=this.style&&this.style.fog;return!!e&&e.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let e=this._backgroundTiles,n=this._backgroundTiles={},o=this.transform.coveringTiles({tileSize:512});for(let s of o)n[s.key]=e[s.key]||new lg(s,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,n){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||e.sourceLayer!=="building"&&(!n||n.type!=="batched-model"))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[e.key];return n||(this._cachedTileFogOpacities[e.key]=n=this.style.fog.getOpacityForTile(e)),n[0]>=dh||n[1]>=dh}}let fh=2048;class jZ{constructor(e,n){this.aabb=e,this.lastCascade=n}}class VZ{add(e,n){let o=this.receivers[e.key];o!==void 0?(o.aabb.min[0]=Math.min(o.aabb.min[0],n.min[0]),o.aabb.min[1]=Math.min(o.aabb.min[1],n.min[1]),o.aabb.min[2]=Math.min(o.aabb.min[2],n.min[2]),o.aabb.max[0]=Math.max(o.aabb.max[0],n.max[0]),o.aabb.max[1]=Math.max(o.aabb.max[1],n.max[1]),o.aabb.max[2]=Math.max(o.aabb.max[2],n.max[2])):this.receivers[e.key]=new jZ(n,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,n,o){let s=qi.fromPoints(e.points),l=0;for(let u in this.receivers){let d=this.receivers[u];if(!d||!s.intersectsAabb(d.aabb))continue;d.aabb.min=s.closestPoint(d.aabb.min),d.aabb.max=s.closestPoint(d.aabb.max);let f=d.aabb.getCorners();for(let p=0;p<o.length;p++){let g=!0;for(let _ of f){let v=[_[0]*n,_[1]*n,_[2]];if(Z.transformMat4(v,v,o[p].matrix),v[0]<-1||v[0]>1||v[1]<-1||v[1]>1){g=!1;break}}if(d.lastCascade=p,l=Math.max(l,p),g)break}}return l+1}}class UZ{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new VZ,this._depthMode=new $t(e.context.gl.LEQUAL,$t.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(let e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,n){let o=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;let s=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||s<=0||(this._shadowLayerCount=o.style.order.reduce((x,b)=>{let T=o.style._mergedLayers[b];return x+(T.hasShadowPass()&&!T.isHidden(e.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let l=o.context,u=fh,d=fh;if(this._cascades.length===0)for(let x=0;x<2;++x){let b=o._shadowMapDebug,T=l.gl,E=l.createFramebuffer(u,d,b,"texture"),M=new fr(l,{width:u,height:d,data:null},T.DEPTH_COMPONENT);if(E.depthAttachment.set(M.texture),b){let S=new fr(l,{width:u,height:d,data:null},T.RGBA);E.colorAttachment.set(S.texture)}this._cascades.push({framebuffer:E,texture:M,matrix:[],far:0,boundingSphereRadius:0,frustum:new Uc,scale:0})}this.shadowDirection=Rk(n);let f=0;if(e.elevation){let x=e.elevation,b=[1e4,-1e4];x.visibleDemTiles.filter(T=>T.dem).forEach(T=>{let E=T.dem.tree;b[0]=Math.min(b[0],E.minimums[0]),b[1]=Math.max(b[1],E.maximums[0])}),b[0]!==1e4&&(f=(b[1]-b[0])*x.exaggeration())}let p=1.5*e.cameraToCenterDistance,g=3*p,_=new Float64Array(16);for(let x=0;x<2;++x){let b=this._cascades[x],T=e.height/50,E=1;x===0?E=p:(T=p,E=g);let[M,S]=$Z(e,this.shadowDirection,T,E,fh,f);b.scale=e.scale,b.matrix=M,b.boundingSphereRadius=S,ae.invert(_,b.matrix),b.frustum=Uc.fromInvProjectionMatrix(_,1,0,!0),b.far=E}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=s,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=fh,this._uniformValues.u_shadowmap_0=Zs.ShadowMap0,this._uniformValues.u_shadowmap_1=Zs.ShadowMap0+1,this._groundShadowTiles=o.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let v=o.transform.elevation;for(let x of this._groundShadowTiles){let b={min:0,max:0};if(v){let T=v.getMinMaxForTile(x);T&&(b=T)}this.addShadowReceiver(x.toUnwrapped(),b.min,b.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,n){if(!this._enabled)return;let o=this.painter,s=o.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(o.transform.getFrustum(0),o.transform.worldSize,this._cascades),s.viewport.set([0,0,fh,fh]);for(let l=0;l<this._numCascadesToRender;++l){o.currentShadowCascade=l,s.bindFramebuffer.set(this._cascades[l].framebuffer.framebuffer),s.clear({color:tn.white,depth:1});for(let u of e.order){let d=e._mergedLayers[u];if(!d.hasShadowPass()||d.isHidden(o.transform.zoom))continue;let f=e.getLayerSourceCache(d),p=f?n[f.id]:void 0;(d.type==="model"||p&&p.length)&&o.renderLayer(o,f,d,p)}}o.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let e=this.painter,n=e.style,o=e.context,s=n.directionalLight,l=n.ambientLight;if(!s||!l)return;let u=[],d=ap(e,e.longestCutoffRange);d.shouldRenderCutoff&&u.push("RENDER_CUTOFF");let f=XE(s,l),p=new $t(o.gl.LEQUAL,$t.ReadOnly,e.depthRangeFor3D);for(let g of this._groundShadowTiles){let _=g.toUnwrapped(),v=e.isTileAffectedByFog(g),x=e.getOrCreateProgram("groundShadow",{defines:u,overrideFog:v});this.setupShadows(_,x),e.uploadCommonUniforms(o,x,_,null,d);let b={u_matrix:e.transform.calculateProjMatrix(_),u_ground_shadow_factor:f};x.draw(e,o.gl.TRIANGLES,p,_n.disabled,Hn.multiply,bn.disabled,b,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Hn.unblended:Hn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){let n=this.painter.transform,o=n.calculatePosMatrix(e,n.worldSize);return ae.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}calculateShadowPassMatrixFromMatrix(e){return ae.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,n,o,s=0){if(!this._enabled)return;let l=this.painter.transform,u=this.painter.context,d=u.gl,f=this._uniformValues,p=new Float64Array(16),g=l.calculatePosMatrix(e,l.worldSize);for(let _=0;_<2;_++)ae.multiply(p,this._cascades[_].matrix,g),f[_===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),u.activeTexture.set(d.TEXTURE0+Zs.ShadowMap0+_),this._cascades[_].texture.bind(d.NEAREST,d.CLAMP_TO_EDGE);if(this.useNormalOffset=!!o,this.useNormalOffset){let _=Zm(e.canonical),v=2/l.tileSize*ne/fh,x=v*this._cascades[0].boundingSphereRadius,b=v*this._cascades[1].boundingSphereRadius,T=(o==="vector-tile"?1:3)/Math.pow(2,s-e.canonical.z-(1-l.zoom+Math.floor(l.zoom)));f.u_shadow_normal_offset=[_,x*T,b*T],f.u_shadow_bias=[6e-5,.0012,.012]}else f.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(u,f)}setupShadowsFromMatrix(e,n,o=!1){if(!this._enabled)return;let s=this.painter.context,l=s.gl,u=this._uniformValues,d=new Float64Array(16);for(let f=0;f<2;f++)ae.multiply(d,this._cascades[f].matrix,e),u[f===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(d),s.activeTexture.set(l.TEXTURE0+Zs.ShadowMap0+f),this._cascades[f].texture.bind(l.NEAREST,l.CLAMP_TO_EDGE);this.useNormalOffset=o,o?(u.u_shadow_normal_offset=[1,5,5],u.u_shadow_bias=[6e-5,.0012,.012]):u.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(s,u)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,n,o,s){if(s[2]>=0)return{};let l=function(f,p,g){let _=g/(1<<f.canonical.z);return new qi([f.canonical.x*_+f.wrap*g,f.canonical.y*_+f.wrap*g,0],[(f.canonical.x+1)*_+f.wrap*g,(f.canonical.y+1)*_+f.wrap*g,p])}(e,n,o).getCorners(),u=n/-s[2];s[0]<0?(Z.add(l[0],l[0],[s[0]*u,0,0]),Z.add(l[3],l[3],[s[0]*u,0,0])):s[0]>0&&(Z.add(l[1],l[1],[s[0]*u,0,0]),Z.add(l[2],l[2],[s[0]*u,0,0])),s[1]<0?(Z.add(l[0],l[0],[0,s[1]*u,0]),Z.add(l[1],l[1],[0,s[1]*u,0])):s[1]>0&&(Z.add(l[2],l[2],[0,s[1]*u,0]),Z.add(l[3],l[3],[0,s[1]*u,0]));let d={};return d.vertices=l,d.planes=[Yv(l[1],l[0],l[4]),Yv(l[2],l[1],l[5]),Yv(l[3],l[2],l[6]),Yv(l[0],l[3],l[7])],d}addShadowReceiver(e,n,o){this._receivers.add(e,qi.fromTileIdAndHeight(e,n,o))}getMaxCascadeForTile(e){let n=this._receivers.get(e);return n&&n.lastCascade?n.lastCascade:0}}function Yv(t,e,n){let o=Z.sub([],n,e),s=Z.sub([],t,e),l=Z.cross([],o,s),u=Z.length(l);return u===0?[0,0,1,0]:(Z.scale(l,l,1/u),[l[0],l[1],l[2],-Z.dot(l,e)])}function Rk(t){let e=t.properties.get("direction"),n=ht(e.x,e.y,e.z);n[2]=ze(n[2],0,75);let o=it([n[0],n[1],n[2]]);return Z.fromValues(o.x,o.y,o.z)}function XE(t,e){let n=t.properties.get("color"),o=t.properties.get("intensity"),s=t.properties.get("direction"),l=[s.x,s.y,s.z],u=e.properties.get("color"),d=e.properties.get("intensity"),f=Math.max(Z.dot([0,0,1],l),0),p=[0,0,0];Z.scale(p,u.toArray01Linear().slice(0,3),d);let g=[0,0,0];return Z.scale(g,n.toArray01Linear().slice(0,3),f*o),Hi([p[0]>0?p[0]/(p[0]+g[0]):0,p[1]>0?p[1]/(p[1]+g[1]):0,p[2]>0?p[2]/(p[2]+g[2]):0])}function $Z(t,e,n,o,s,l){let u=t.zoom,d=t.scale,f=t.worldSize,p=1/f,g=t.aspect,_=Math.sqrt(1+g*g)*Math.tan(.5*t.fovX),v=_*_,x=o-n,b=o+n,T,E;v>x/b?(T=o,E=o*_):(T=.5*b*(1+v),E=.5*Math.sqrt(x*x+2*(o*o+n*n)*v+b*b*v*v));let M=t.projection.pixelsPerMeter(t.center.lat,f),S=t._camera.getCameraToWorldMercator(),P=[0,0,-T*p];Z.transformMat4(P,P,S);let O=E*p,A=t._edgeInsets;if(!(A.left===0&&A.top===0&&A.right===0&&A.bottom===0||A.left===A.right&&A.top===A.bottom)){let pe=t._camera.getWorldToCamera(t.worldSize,t.projection.zAxisUnit==="meters"?M:1),fe=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,n,o);fe[8]=2*-t.centerOffset.x/t.width,fe[9]=2*t.centerOffset.y/t.height;let be=new Float64Array(16);ae.mul(be,fe,pe);let Te=new Float64Array(16);ae.invert(Te,be);let Me=Uc.fromInvProjectionMatrix(Te,f,u,!0);for(let ge of Me.points){let Pe=((R=ge)[0]/=d,R[1]/=d,R[2]=Oi(R[2],t._center.lat),R);O=Math.max(O,Z.len(Z.subtract([],P,Pe)))}}var R;O*=s/(s-1);let F=Math.acos(e[2]),k=Math.atan2(-e[0],-e[1]),N=new Tv;N.position=P,N.setPitchBearing(F,k);let B=N.getWorldToCamera(f,M),H=O*f,G=Math.min(t._mercatorZfromZoom(17)*f*-2,-2*H),Y=N.getCameraToClipOrthographic(-H,H,-H,H,G,(H+l*M)/e[2]),U=new Float64Array(16);ae.multiply(U,Y,B);let Q=Z.fromValues(Math.floor(1e6*P[0])/1e6*f,Math.floor(1e6*P[1])/1e6*f,0),te=.5*s,se=[0,0,0];Z.transformMat4(se,Q,U),Z.scale(se,se,te);let K=[Math.floor(se[0]),Math.floor(se[1]),Math.floor(se[2])],ee=[0,0,0];Z.sub(ee,se,K),Z.scale(ee,ee,-1/te);let de=new Float64Array(16);return ae.identity(de),ae.translate(de,de,ee),ae.multiply(U,de,U),[U,H]}class HZ extends vn{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,n){return CF(this.requestManager.transformRequest(n,ve.Model).url).then(o=>{if(!o)return;let s=FE(o),l=new TL(e,void 0,void 0,s);return l.computeBoundsAndApplyParent(),l}).catch(o=>{this.fire(new Je(new Error(`Could not load model ${e} from ${n}: ${o.message}`)))})}load(e,n){this.models[n]||(this.models[n]={});let o=Object.keys(e);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+o.length;let s=[];for(let l of o)s.push(this.loadModel(l,e[l]));Promise.allSettled(s).then(l=>{for(let u=0;u<l.length;u++){let{status:d,value:f}=l[u];d==="fulfilled"&&f&&(this.models[n][o[u]]=f)}this.numModelsLoading[n]-=o.length,this.fire(new Se("data",{dataType:"style"}))}).catch(l=>{this.fire(new Je(new Error(`Could not load models: ${l.message}`)))})}isLoaded(){for(let e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,n){return!!this.getModel(e,n)}getModel(e,n){return this.models[n]||(this.models[n]={}),this.models[n][e]}addModel(e,n,o){this.models[o]||(this.models[o]={}),this.hasModel(e,o)&&this.removeModel(e,o),this.load({[e]:this.requestManager.normalizeModelURL(n)},o)}addModels(e,n){let o={};for(let s in e)o[s]=this.requestManager.normalizeModelURL(e[s]);this.load(o,n)}removeModel(e,n){this.models[n]||(this.models[n]={});let o=this.models[n][e];delete this.models[n][e],o.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,n){this.models[n]||(this.models[n]={});for(let o in this.models[n])this.models[n][o].upload(e.context)}}let wg=(t,e)=>yy(t,e&&e.filter(n=>n.identifier!=="source.canvas")),GZ=wo(Qn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),WZ=wo(Qn,["setCenter","setZoom","setBearing","setPitch"]),Lk={version:8,layers:[],sources:{}},Fk={duration:300,delay:0},qZ=new Set(["fill","line","background","hillshade","raster"]);class xl extends vn{constructor(e,n={}){super(),this.map=e,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=Ne({},Fk),this._buildingIndex=new gq(this),this.crossTileSymbolIndex=new Bq,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new D6,this.dispatcher=n.dispatcher?n.dispatcher:new Rv(vg(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new GW,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new Jf(e._requestManager,n.localFontFamily?2:n.localIdeographFontFamily?1:0,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new HZ(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=n.config,this.dispatcher.broadcast("setReferrer",Le());let o=this;this._rtlTextPluginCallback=xl.registerForPluginStateChange(s=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:s.pluginStatus,pluginURL:s.pluginURL},(l,u)=>{if(LP(l),u&&u.every(d=>d))for(let d in o._sourceCaches){let f=o._sourceCaches[d],p=f.getSource().type;p!=="vector"&&p!=="geojson"||f.reload()}})}),this.on("data",s=>{if(s.dataType!=="source"||s.sourceDataType!=="metadata")return;let l=this.getOwnSource(s.sourceId);if(l&&l.vectorLayerIds)for(let u in this._layers){let d=this._layers[u];d.source===l.id&&this._validateLayer(d)}})}loadURL(e,n={}){this.fire(new Se("dataloading",{dataType:"style"}));let o=typeof n.validate=="boolean"?n.validate:!qt(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken),this.resolvedImports.add(e);let s=this.importsCache.get(e);if(s)return this._load(s,o);let l=this.map._requestManager.transformRequest(e,ve.Style);this._request=Ge(l,(u,d)=>{if(this._request=null,u)this.fire(new Je(u));else if(d)return this.importsCache.set(e,d),this._load(d,o)})}loadJSON(e,n={}){this.fire(new Se("dataloading",{dataType:"style"})),this._request=Zt.frame(()=>{this._request=null,this._load(e,n.validate!==!1)})}loadEmpty(){this.fire(new Se("dataloading",{dataType:"style"})),this._load(Lk,!1)}_loadImports(e,n){if(this.importDepth>=4)return J("Style doesn't support nesting deeper than 5"),Promise.resolve();let o=[];for(let s of e){let l=this._createFragmentStyle(s),u=new Promise(f=>{l.once("style.import.load",f),l.once("error",f)}).then(()=>this.mergeAll());if(o.push(u),this.resolvedImports.has(s.url)){l.loadEmpty();continue}let d=s.data||this.importsCache.get(s.url);d?l.loadJSON(d,{validate:n}):s.url?l.loadURL(s.url,{validate:n}):l.loadEmpty(),this.fragments.push({style:l,id:s.id,config:s.config})}return Promise.allSettled(o)}_createFragmentStyle(e){let n=this.scope?os(e.id,this.scope):e.id,o=new xl(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:e.config});return o.setEventedParent(this.map,{style:o}),o}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Se(e?"style.load":"style.import.load"))}_load(e,n){let o=e.schema;if(this.isRootStyle()&&(e.fragment||o&&e.fragment!==!1)){let u=Ne({},Lk,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(u,n)}if(this.setConfig(this._config,o),n&&wg(this,Rf(e)))return;this._loaded=!0,this.stylesheet=$(e);for(let u in e.sources)this.addSource(u,e.sources[u],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);let s=OF(this.stylesheet.layers);if(this._order=s.map(u=>u.id),this.stylesheet.light&&J("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let u=this.stylesheet.lights[0];this.light=new oF(u.properties,u.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new oF(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let u of s){let d=Pv(u,this.options);d.setScope(this.scope),d.isConfigDependent&&this._configDependentLayers.add(d.fqid),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize();let f=this.getOwnLayerSourceCache(d),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();f&&d.canCastShadows()&&p&&(f.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let l=this.stylesheet.terrain;l&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=Zt.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?J("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(l,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Se("data",{dataType:"style"})),e.imports?this._loadImports(e.imports,n).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let e,n,o,s,l,u,d,f;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(p=>{if(p.stylesheet){if(p.light!=null&&(e=p.light),p.stylesheet.lights)for(let g of p.stylesheet.lights)g.type==="ambient"&&p.ambientLight!=null&&(n=p.ambientLight),g.type==="directional"&&p.directionalLight!=null&&(o=p.directionalLight);s=this._prioritizeTerrain(s,p.terrain,p.stylesheet.terrain),p.stylesheet.fog&&p.fog!=null&&(l=p.fog),p.stylesheet.camera!=null&&(f=p.stylesheet.camera),p.stylesheet.projection!=null&&(u=p.stylesheet.projection),p.stylesheet.transition!=null&&(d=p.stylesheet.transition)}}),this.light=e,this.ambientLight=n,this.directionalLight=o,this.fog=l,s===null?delete this.terrain:this.terrain=s,this.camera=f||{"camera-projection":"perspective"},this.projection=u||{name:"mercator"},this.transition=Ne({},Fk,d),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){let n=o=>{for(let s of o.fragments)n(s.style);e(o)};n(this)}_prioritizeTerrain(e,n,o){let s=e&&e.drapeRenderMode===0;return o===null?n&&n.drapeRenderMode===0?n:s?e:null:n!=null&&(!e||s||n&&n.drapeRenderMode===1)?n:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{e=this._prioritizeTerrain(e,n.terrain,n.stylesheet.terrain)}),e===null?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(e=n.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){let e={},n={},o={};this.forEachFragmentStyle(s=>{for(let l in s._sourceCaches){let u=os(l,s.scope);e[u]=s._sourceCaches[l]}for(let l in s._otherSourceCaches){let u=os(l,s.scope);n[u]=s._otherSourceCaches[l]}for(let l in s._symbolSourceCaches){let u=os(l,s.scope);o[u]=s._symbolSourceCaches[l]}}),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=o}mergeLayers(){let e={},n=[],o={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(l=>{for(let u of l._order){let d=l._layers[u];if(d.type==="slot"){let f=wy(u);if(e[f])continue;e[f]=[]}d.slot&&e[d.slot]?e[d.slot].push(d):n.push(d)}}),this._mergedOrder=[];let s=(l=[])=>{for(let u of l)if(u.type==="slot"){let d=wy(u.id);e[d]&&s(e[d])}else{let d=os(u.id,u.scope);this._mergedOrder.push(d),o[d]=u,u.is3D()&&(this._has3DLayers=!0),u.type==="circle"&&(this._hasCircleLayers=!0),u.type==="symbol"&&(this._hasSymbolLayers=!0)}};s(n),this._mergedLayers=o,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=Ne({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(n,o,s){let l,u,d,f=Zt.devicePixelRatio>1?"@2x":"",p=Ge(o.transformRequest(o.normalizeSpriteURL(n,f,".json"),ve.SpriteJSON),(v,x)=>{p=null,d||(d=v,l=x,_())}),g=Ft(o.transformRequest(o.normalizeSpriteURL(n,f,".png"),ve.SpriteImage),(v,x)=>{g=null,d||(d=v,u=x,_())});function _(){if(d)s(d);else if(l&&u){let v=Zt.getImageData(u),x={};for(let b in l){let{width:T,height:E,x:M,y:S,sdf:P,pixelRatio:O,stretchX:A,stretchY:R,content:F}=l[b],k=new qr({width:T,height:E});qr.copy(v,k,{x:M,y:S},{x:0,y:0},{width:T,height:E}),x[b]={data:k,pixelRatio:O,sdf:P,stretchX:A,stretchY:R,content:F}}s(null,x)}}return{cancel(){p&&(p.cancel(),p=null),g&&(g.cancel(),g=null)}}}(e,this.map._requestManager,(n,o)=>{if(this._spriteRequest=null,n)this.fire(new Je(n));else if(o)for(let s in o)this.imageManager.addImage(s,this.scope,o[s]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Se("data",{dataType:"style"}))})}_validateLayer(e){let n=this.getOwnSource(e.source);if(!n)return;let o=e.sourceLayer;o&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(o)===-1)&&this.fire(new Je(new Error(`Source layer "${o}" does not exist on source "${n.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,n)=>{let o=this.fragments[n];return o&&o.style&&(e.data=o.style.serialize()),e})}_serializeSources(){let e={};for(let n in this._sourceCaches){let o=this._sourceCaches[n].getSource();e[o.id]||(e[o.id]=o.serialize())}return e}_serializeLayers(e){let n=[];for(let o of e){let s=this._layers[o];s&&s.type!=="custom"&&n.push(s.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&(typeof e.isLayerDraped=="function"?e.isLayerDraped(this.getLayerSourceCache(e)):qZ.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){let n=this.getOwnLayer(e);if(n)return n;this.fire(new Je(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){let n=this.getOwnSource(e);if(n)return n;this.fire(new Je(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);let n=this.calculateLightsBrightness();e.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));let o=this._changes.isDirty();if(this._changes.isDirty()){let l=this._changes.getLayerUpdatesByScope();for(let u in l){let{updatedIds:d,removedIds:f}=l[u];(d||f)&&this._updateWorkerLayers(u,d,f)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}let s={};for(let l in this._mergedSourceCaches){let u=this._mergedSourceCaches[l];s[l]=u.used,u.used=!1}for(let l of this._mergedOrder){let u=this._mergedLayers[l];if(u.recalculate(e,this._availableImages),!u.isHidden(e.zoom)){let d=this.getLayerSourceCache(u);d&&(d.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let d=u.minzoom||0;d<(u.maxzoom||25.5);d++){let f=this.map.painter;if(f){let p=u.getProgramIds();if(!p)continue;for(let g of p){let _=u.getDefaultProgramParams(g,e.zoom);_&&(f.style=this,this.fog&&(f._fogVisible=!0,_.overrideFog=!0,f.getOrCreateProgram(g,_)),f._fogVisible=!1,_.overrideFog=!1,f.getOrCreateProgram(g,_),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(_.overrideRtt=!0,f.getOrCreateProgram(g,_)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let l in s){let u=this._mergedSourceCaches[l];s[l]!==u.used&&u.getSource().fire(new Se("data",{sourceDataType:"visibility",dataType:"source",sourceId:u.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new Se("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=this._changes.getUpdatedImages();if(e.length){for(let n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,n,o){let s=this.getFragmentStyle(e);s&&this.dispatcher.broadcast("updateLayers",{layers:n?s._serializeLayers(n):[],scope:e,removedIds:o||[],options:s.options})}setState(e){if(this._checkLoaded(),wg(this,Rf(e)))return!1;(e=$(e)).layers=OF(e.layers);let n=function(s,l){if(!s)return[{command:Qn.setStyle,args:[l]}];let u=[];try{if(!Rt(s.version,l.version))return[{command:Qn.setStyle,args:[l]}];Rt(s.center,l.center)||u.push({command:Qn.setCenter,args:[l.center]}),Rt(s.zoom,l.zoom)||u.push({command:Qn.setZoom,args:[l.zoom]}),Rt(s.bearing,l.bearing)||u.push({command:Qn.setBearing,args:[l.bearing]}),Rt(s.pitch,l.pitch)||u.push({command:Qn.setPitch,args:[l.pitch]}),Rt(s.sprite,l.sprite)||u.push({command:Qn.setSprite,args:[l.sprite]}),Rt(s.glyphs,l.glyphs)||u.push({command:Qn.setGlyphs,args:[l.glyphs]}),Rt(s.imports,l.imports)||function(_=[],v=[],x){v=v||[];let b=(_=_||[]).map(Nv),T=v.map(Nv),E=_.reduce(zv,{}),M=v.reduce(zv,{}),S=b.slice(),P,O,A,R;for(P=0,O=0;P<b.length;P++)A=b[P],M.hasOwnProperty(A)?O++:(x.push({command:Qn.removeImport,args:[A]}),S.splice(S.indexOf(A,O),1));for(P=0,O=0;P<T.length;P++)A=T[T.length-1-P],S[S.length-1-P]!==A&&(E.hasOwnProperty(A)?(x.push({command:Qn.removeImport,args:[A]}),S.splice(S.lastIndexOf(A,S.length-O),1)):O++,R=S[S.length-P],x.push({command:Qn.addImport,args:[M[A],R]}),S.splice(S.length-P,0,A));for(let F of v){let k=E[F.id];if(!k||Rt(k,F))continue;Rt(k.config,F.config)||x.push({command:Qn.setImportConfig,args:[F.id,F.config]}),Rt(k.url,F.url)||x.push({command:Qn.setImportUrl,args:[F.id,F.url]});let N=F.data;Rt(k&&k.data,N)||x.push({command:Qn.setImportData,args:[F.id,N]})}}(s.imports,l.imports,u),Rt(s.transition,l.transition)||u.push({command:Qn.setTransition,args:[l.transition]}),Rt(s.light,l.light)||u.push({command:Qn.setLight,args:[l.light]}),Rt(s.fog,l.fog)||u.push({command:Qn.setFog,args:[l.fog]}),Rt(s.projection,l.projection)||u.push({command:Qn.setProjection,args:[l.projection]}),Rt(s.lights,l.lights)||u.push({command:Qn.setLights,args:[l.lights]}),Rt(s.camera,l.camera)||u.push({command:Qn.setCamera,args:[l.camera]});let d={},f=[];(function(_,v,x,b){let T;for(T in v=v||{},_=_||{})_.hasOwnProperty(T)&&(v.hasOwnProperty(T)||LF(T,x,b));for(T in v){if(!v.hasOwnProperty(T))continue;let E=v[T];_.hasOwnProperty(T)?Rt(_[T],E)||(_[T].type==="geojson"&&E.type==="geojson"&&vq(_,v,T)?x.push({command:Qn.setGeoJSONSourceData,args:[T,E.data]}):yq(T,v,x,b)):RF(T,v,x)}})(s.sources,l.sources,f,d);let p=[];s.layers&&s.layers.forEach(_=>{_.source&&d[_.source]?u.push({command:Qn.removeLayer,args:[_.id]}):p.push(_)});let g=s.terrain;g&&d[g.source]&&(u.push({command:Qn.setTerrain,args:[void 0]}),g=void 0),u=u.concat(f),Rt(g,l.terrain)||u.push({command:Qn.setTerrain,args:[l.terrain]}),function(_,v,x){v=v||[];let b=(_=_||[]).map(Nv),T=v.map(Nv),E=_.reduce(zv,{}),M=v.reduce(zv,{}),S=b.slice(),P=Object.create(null),O,A,R,F,k,N,B;for(O=0,A=0;O<b.length;O++)R=b[O],M.hasOwnProperty(R)?A++:(x.push({command:Qn.removeLayer,args:[R]}),S.splice(S.indexOf(R,A),1));for(O=0,A=0;O<T.length;O++)R=T[T.length-1-O],S[S.length-1-O]!==R&&(E.hasOwnProperty(R)?(x.push({command:Qn.removeLayer,args:[R]}),S.splice(S.lastIndexOf(R,S.length-A),1)):A++,N=S[S.length-O],x.push({command:Qn.addLayer,args:[M[R],N]}),S.splice(S.length-O,0,R),P[R]=!0);for(O=0;O<T.length;O++)if(R=T[O],F=E[R],k=M[R],!P[R]&&!Rt(F,k))if(Rt(F.source,k.source)&&Rt(F["source-layer"],k["source-layer"])&&Rt(F.type,k.type)){for(B in kv(F.layout,k.layout,x,R,null,Qn.setLayoutProperty),kv(F.paint,k.paint,x,R,null,Qn.setPaintProperty),Rt(F.slot,k.slot)||x.push({command:Qn.setSlot,args:[R,k.slot]}),Rt(F.filter,k.filter)||x.push({command:Qn.setFilter,args:[R,k.filter]}),Rt(F.minzoom,k.minzoom)&&Rt(F.maxzoom,k.maxzoom)||x.push({command:Qn.setLayerZoomRange,args:[R,k.minzoom,k.maxzoom]}),F)F.hasOwnProperty(B)&&B!=="layout"&&B!=="paint"&&B!=="filter"&&B!=="metadata"&&B!=="minzoom"&&B!=="maxzoom"&&B!=="slot"&&(B.indexOf("paint.")===0?kv(F[B],k[B],x,R,B.slice(6),Qn.setPaintProperty):Rt(F[B],k[B])||x.push({command:Qn.setLayerProperty,args:[R,B,k[B]]}));for(B in k)k.hasOwnProperty(B)&&!F.hasOwnProperty(B)&&B!=="layout"&&B!=="paint"&&B!=="filter"&&B!=="metadata"&&B!=="minzoom"&&B!=="maxzoom"&&B!=="slot"&&(B.indexOf("paint.")===0?kv(F[B],k[B],x,R,B.slice(6),Qn.setPaintProperty):Rt(F[B],k[B])||x.push({command:Qn.setLayerProperty,args:[R,B,k[B]]}))}else x.push({command:Qn.removeLayer,args:[R]}),N=S[S.lastIndexOf(R)+1],x.push({command:Qn.addLayer,args:[k,N]})}(p,l.layers,u)}catch(d){console.warn("Unable to compute style diff:",d),u=[{command:Qn.setStyle,args:[l]}]}return u}(this.serialize(),e).filter(s=>!(s.command in WZ));if(n.length===0)return!1;let o=n.filter(s=>!(s.command in GZ));if(o.length>0)throw new Error(`Unimplemented: ${o.map(s=>s.command).join(", ")}.`);return n.forEach(s=>{this[s.command].apply(this,s.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,n){return this.getImage(e)?this.fire(new Je(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,n),this._afterImageUpdated(e),this)}updateImage(e,n){this.imageManager.updateImage(e,this.scope,n)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new Je(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Se("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,n,o={}){return this._checkLoaded(),this._validate(w6,`models.${e}`,n,null,o)||(this.modelManager.addModel(e,n,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new Je(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,n,o={}){if(this._checkLoaded(),this.getOwnSource(e)!==void 0)throw new Error(`There is already a source with ID "${e}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(p6,`sources.${e}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);let s=NE(e,n,this.dispatcher,this);s.scope=this.scope,s.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s.id),source:s.serialize(),sourceId:s.id}));let l=u=>{let d=(u?"symbol:":"other:")+s.id,f=os(d,this.scope),p=this._sourceCaches[d]=new _l(f,s,u);(u?this._symbolSourceCaches:this._otherSourceCaches)[s.id]=p,p.onAdd(this.map)};l(!1),n.type!=="vector"&&n.type!=="geojson"||l(!0),s.onAdd&&s.onAdd(this.map),o.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();let n=this.getOwnSource(e);if(!n)throw new Error("There is no source with this ID");for(let s in this._layers)if(this._layers[s].source===e)return this.fire(new Je(new Error(`Source "${e}" cannot be removed while layer "${s}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new Je(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));let o=this.getOwnSourceCaches(e);for(let s of o){let l=wy(s.id);delete this._sourceCaches[l],this._changes.discardSourceCacheUpdate(s.id),s.fire(new Se("data",{sourceDataType:"metadata",dataType:"source",sourceId:s.getSource().id})),s.setEventedParent(null),s.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,n){this._checkLoaded(),this.getOwnSource(e).setData(n),this._changes.setDirty()}getOwnSource(e){let n=this.getOwnSourceCache(e);return n&&n.getSource()}getOwnSources(){let e=[];for(let n in this._otherSourceCaches){let o=this.getOwnSourceCache(n);o&&e.push(o.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;let n=this._getTransitionParameters();for(let s of e){if(this._validate(g6,"lights",s))return;switch(s.type){case"ambient":if(this.ambientLight){let l=this.ambientLight;l.set(s),l.updateTransitions(n)}else this.ambientLight=new hF(s,QW,this.scope,this.options);break;case"directional":if(this.directionalLight){let l=this.directionalLight;l.set(s),l.updateTransitions(n)}else this.directionalLight=new hF(s,eq,this.scope,this.options)}}let o=new ur(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let e=this.directionalLight,n=this.ambientLight;if(!e||!n)return;let o=_=>.2126*(_[0]<=.03928?_[0]/12.92:Math.pow((_[0]+.055)/1.055,2.4))+.7152*(_[1]<=.03928?_[1]/12.92:Math.pow((_[1]+.055)/1.055,2.4))+.0722*(_[2]<=.03928?_[2]/12.92:Math.pow((_[2]+.055)/1.055,2.4)),s=e.properties.get("color").toArray01(),l=e.properties.get("intensity"),u=e.properties.get("direction"),d=1-ht(u.x,u.y,u.z)[2]/90,f=o(s)*l*d,p=n.properties.get("color").toArray01(),g=n.properties.get("intensity");return(f+o(p)*g)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(zP(e)){let n=function(l){let u=l.indexOf(by);return u>=0?l.slice(u+1):""}(e),o=this.fragments.find(({id:l})=>l===n);if(!o)throw new Error(`Style import not found: ${e}`);let s=wy(e);return o.style.getFragmentStyle(s)}{let n=this.fragments.find(({id:o})=>o===e);if(!n)throw new Error(`Style import not found: ${e}`);return n.style}}getConfigProperty(e,n){let o=this.getFragmentStyle(e);if(!o)return null;let s=o.options.get(n),l=s?s.value||s.default:null;return l?l.serialize():null}setConfigProperty(e,n,o){let s=Ou(o);if(s.result!=="success")return void wg(this,s.value);let l=s.value.expression,u=this.getFragmentStyle(e);if(!u)return;let d=u.options.get(n);d&&(u.options.set(n,Er(Lt({},d),{value:l})),u.updateConfigDependencies())}setConfig(e,n){if(this._config=e,e||n)if(n){this.options.clear();for(let o in n){let s,l,u=Ou(n[o].default);if(u.result==="success"&&(s=u.value.expression),e&&e[o]!==void 0){let v=Ou(e[o]);v.result==="success"&&(l=v.value.expression)}let{minValue:d,maxValue:f,stepValue:p,type:g,values:_}=n[o];s?this.options.set(o,{default:s,value:l,minValue:d,maxValue:f,stepValue:p,type:g,values:_}):this.fire(new Je(new Error(`No schema defined for config option "${o}".`)))}}else this.fire(new Je(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let e of this._configDependentLayers){let n=this.getLayer(e);n&&(n.possiblyEvaluateVisibility(),this._updateLayer(n))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(e,n,o={}){this._checkLoaded();let s=e.id;if(this._layers[s])return void this.fire(new Je(new Error(`Layer with id "${s}" already exists on this map`)));let l;if(e.type==="custom"){if(wg(this,function(g){let _=[],v=g.id;return v===void 0&&_.push({message:`layers.${v}: missing required property "id"`}),g.render===void 0&&_.push({message:`layers.${v}: missing required method "render"`}),g.renderingMode&&g.renderingMode!=="2d"&&g.renderingMode!=="3d"&&_.push({message:`layers.${v}: property "renderingMode" must be either "2d" or "3d"`}),_}(e)))return;l=Pv(e,this.options)}else{if(typeof e.source=="object"&&(this.addSource(s,e.source),e=Ne(e=$(e),{source:s})),this._validate(v6,`layers.${s}`,e,{arrayIndex:-1},o))return;l=Pv(e,this.options),this._validateLayer(l),l.setEventedParent(this,{layer:{id:s}}),this._serializedLayers[l.id]=l.serialize()}l.isConfigDependent&&this._configDependentLayers.add(l.fqid),l.setScope(this.scope);let u=this._order.length;if(n){let g=this._order.indexOf(n);if(g===-1)return void this.fire(new Je(new Error(`Layer with id "${n}" does not exist on this map.`)));l.slot===this._layers[n].slot?u=g:J(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(u,0,s),this._layerOrderChanged=!0,this._layers[s]=l;let d=this.getOwnLayerSourceCache(l),f=!!this.directionalLight&&this.directionalLight.shadowsEnabled();d&&l.canCastShadows()&&f&&(d.castsShadows=!0);let p=this._changes.getRemovedLayer(l);if(p&&l.source&&d&&l.type!=="custom"){this._changes.discardLayerRemoval(l);let g=os(l.source,l.scope);p.type!==l.type?this._changes.updateSourceCache(g,"clear"):(this._changes.updateSourceCache(g,"reload"),d.pause())}this._updateLayer(l),l.onAdd&&l.onAdd(this.map),l.scope=this.scope,this.mergeLayers()}moveLayer(e,n){this._checkLoaded();let o=this._checkLayer(e);if(!o||e===n)return;let s=this._order.indexOf(e);this._order.splice(s,1);let l=this._order.length;if(n){let u=this._order.indexOf(n);if(u===-1)return void this.fire(new Je(new Error(`Layer with id "${n}" does not exist on this map.`)));o.slot===this._layers[n].slot?l=u:J(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(l,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();let n=this._checkLayer(e);if(!n)return;n.setEventedParent(null);let o=this._order.indexOf(e);this._order.splice(o,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);let s=this.getOwnLayerSourceCache(n);if(s&&s.castsShadows){let l=!1;for(let u in this._layers)if(this._layers[u].source===n.source&&this._layers[u].canCastShadows()){l=!0;break}s.castsShadows=l}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(let n in this._layers)if(this._layers[n].type===e)return!0;return!1}setLayerZoomRange(e,n,o){this._checkLoaded();let s=this._checkLayer(e);s&&(s.minzoom===n&&s.maxzoom===o||(n!=null&&(s.minzoom=n),o!=null&&(s.maxzoom=o),this._updateLayer(s)))}setSlot(e,n){this._checkLoaded();let o=this._checkLayer(e);o&&o.slot!==n&&(o.slot=n,this._updateLayer(o))}setFilter(e,n,o={}){this._checkLoaded();let s=this._checkLayer(e);if(s&&!Rt(s.filter,n))return n==null?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(Pw,`layers.${s.id}.filter`,n,{layerType:s.type},o)||(s.filter=$(n),this._updateLayer(s)))}getFilter(e){let n=this._checkLayer(e);if(n)return $(n.filter)}setLayoutProperty(e,n,o,s={}){this._checkLoaded();let l=this._checkLayer(e);l&&(Rt(l.getLayoutProperty(n),o)||(l.setLayoutProperty(n,o,s),l.isConfigDependent&&this._configDependentLayers.add(l.fqid),this._updateLayer(l)))}getLayoutProperty(e,n){let o=this._checkLayer(e);if(o)return o.getLayoutProperty(n)}setPaintProperty(e,n,o,s={}){this._checkLoaded();let l=this._checkLayer(e);if(!l||Rt(l.getPaintProperty(n),o))return;let u=l.setPaintProperty(n,o,s);l.isConfigDependent&&this._configDependentLayers.add(l.fqid),u&&this._updateLayer(l),this._changes.updatePaintProperties(l)}getPaintProperty(e,n){let o=this._checkLayer(e);if(o)return o.getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();let o=e.source,s=e.sourceLayer,l=this._checkSource(o);if(!l)return;let u=l.type;if(u==="geojson"&&s)return void this.fire(new Je(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(u==="vector"&&!s)return void this.fire(new Je(new Error("The sourceLayer parameter must be provided for vector source types.")));e.id===void 0&&this.fire(new Je(new Error("The feature id parameter must be provided.")));let d=this.getOwnSourceCaches(o);for(let f of d)f.setFeatureState(s,e.id,n)}removeFeatureState(e,n){this._checkLoaded();let o=e.source,s=this._checkSource(o);if(!s)return;let l=s.type,u=l==="vector"?e.sourceLayer:void 0;if(l==="vector"&&!u)return void this.fire(new Je(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof e.id!="string"&&typeof e.id!="number")return void this.fire(new Je(new Error("A feature id is required to remove its specific state property.")));let d=this.getOwnSourceCaches(o);for(let f of d)f.removeFeatureState(u,e.id,n)}getFeatureState(e){this._checkLoaded();let n=e.source,o=e.sourceLayer,s=this._checkSource(n);if(s){if(s.type!=="vector"||o)return e.id===void 0&&this.fire(new Je(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(o,e.id);this.fire(new Je(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=Ne({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return Ne({},this.stylesheet.transition)}serialize(){this._checkLoaded();let e=this.getTerrain(),n=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return Ae({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(e){this._changes.updateLayer(e);let n=this.getLayerSourceCache(e),o=os(e.source,e.scope),s=this._changes.getUpdatedSourceCaches();e.source&&!s[o]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(o,"reload"),n.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){let n=d=>this._mergedLayers[d].type==="fill-extrusion",o=this.order,s={},l=[];for(let d=o.length-1;d>=0;d--){let f=o[d];if(n(f)){s[f]=d;for(let p of e){let g=p[f];if(g)for(let _ of g)l.push(_)}}}l.sort((d,f)=>f.intersectionZ-d.intersectionZ);let u=[];for(let d=o.length-1;d>=0;d--){let f=o[d];if(n(f))for(let p=l.length-1;p>=0;p--){let g=l[p].feature;if(s[g.layer.id]<d)break;u.push(g),l.pop()}else for(let p of e){let g=p[f];if(g)for(let _ of g)u.push(_.feature)}}return u}queryRenderedFeatures(e,n,o){n&&n.filter&&this._validate(Pw,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;let s={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new Je(new Error("parameters.layers must be an Array."))),[];for(let p of n.layers){let g=this._mergedLayers[p];if(!g)return this.fire(new Je(new Error(`The layer '${p}' does not exist in the map's style and cannot be queried for features.`))),[];s[g.source]=!0}}let l=[],u=n.serializedLayers||{},d=n&&n.layers?n.layers.some(p=>{let g=this.getLayer(p);return g&&g.is3D()}):this.has3DLayers(),f=wE.createFromScreenPoints(e,o);for(let p in this._mergedSourceCaches){let g=this._mergedSourceCaches[p].getSource();if(!g||g.scope!==n.scope)continue;let _=this._mergedSourceCaches[p].getSource().id;n.layers&&!s[_]||l.push(pq(this._mergedSourceCaches[p],this._mergedLayers,u,f,n,o,d,!!this.map._showQueryGeometry))}return this.placement&&l.push(function(p,g,_,v,x,b,T){let E={},M=b.queryRenderedSymbols(v),S=[];for(let P of Object.keys(M).map(Number))S.push(T[P]);S.sort(AF);for(let P of S){let O=P.featureIndex.lookupSymbolFeatures(M[P.bucketInstanceId],g,P.bucketIndex,P.sourceLayerIndex,x.filter,x.layers,x.availableImages,p);for(let A in O){let R=E[A]=E[A]||[],F=O[A];F.sort((k,N)=>{let B=P.featureSortOrder;if(B){let H=B.indexOf(k.featureIndex);return B.indexOf(N.featureIndex)-H}return N.featureIndex-k.featureIndex});for(let k of F)R.push(k)}}for(let P in E)E[P].forEach(O=>{let A=O.feature,R=_(p[P]);if(!R)return;let F=R.getFeatureState(A.layer["source-layer"],A.id);A.source=A.layer.source,A.layer["source-layer"]&&(A.sourceLayer=A.layer["source-layer"]),A.state=F});return E}(this._mergedLayers,u,this.getLayerSourceCache.bind(this),f.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)}querySourceFeatures(e,n){n&&n.filter&&this._validate(Pw,"querySourceFeatures.filter",n.filter,null,n);let o=this.getOwnSourceCaches(e),s=[];for(let l of o)s=s.concat(mq(l,n));return s}addSourceType(e,n,o){return xl.getSourceType(e)?o(new Error(`A source type called "${e}" already exists.`)):(xl.setSourceType(e,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:n.workerSourceURL},o):o(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,n,o={}){this._checkLoaded();let s=this.light.getLight(),l=!1;for(let d in e)if(!Rt(e[d],s[d])){l=!0;break}if(!l)return;let u=this._getTransitionParameters();this.light.setLight(e,n,o),this.light.updateTransitions(u)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,n=1){if(this._checkLoaded(),!e)return delete this.terrain,e===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let o=e,s=e.source==null;if(n===1){if(typeof o.source=="object"){let d="terrain-dem-src";this.addSource(d,o.source),o=$(o),o=Ne(o,{source:d})}let l=Ne({},o),u={};if(this.terrain&&s){l.source=this.terrain.get().source;let d=this.terrain?this.getFragmentStyle(this.terrain.scope):null;d&&(u.style=d.serialize())}if(this._validate(_6,"terrain",l,u))return}if(!this.terrain||this.terrain.scope!==this.scope&&!s||this.terrain&&n!==this.terrain.drapeRenderMode){if(!o)return;this._createTerrain(o,n),this.fire(new Se("data",{dataType:"style"}))}else{let l=this.terrain,u=l.get();for(let d of Object.keys(q.terrain))!o.hasOwnProperty(d)&&q.terrain[d].default&&(o[d]=q.terrain[d].default);for(let d in e)if(!Rt(e[d],u[d])){l.set(e,this.options),this.stylesheet.terrain=e;let f=this._getTransitionParameters({duration:0});l.updateTransitions(f),this.fire(new Se("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){let n=this.fog=new XW(e,this.map.transform);this.stylesheet.fog=n.get();let o=this._getTransitionParameters({duration:0});n.updateTransitions(o)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let n=this.fog;if(!Rt(n.get(),e)){n.set(e),this.stylesheet.fog=n.get();let o=this._getTransitionParameters({duration:0});n.updateTransitions(o)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:Zt.now(),transition:Ne(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;let e=[],n=[];for(let o in this._mergedLayers)this.isLayerDraped(this._mergedLayers[o])?e.push(o):n.push(o);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...n)}_createTerrain(e,n){let o=this.terrain=new ZW(e,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let s=this._getTransitionParameters({duration:0});o.updateTransitions(s)}_force3DLayerUpdate(){for(let e in this._layers){let n=this._layers[e];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(let e in this._layers){let n=this._layers[e];n.type==="symbol"&&this._updateLayer(n)}}_validate(e,n,o,s,l={}){if(l&&l.validate===!1)return!1;let u=Ne({},this.serialize());return wg(this,e.call(Rf,Ne({key:n,style:u,value:o,styleSpec:q},s)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Bw.off("pluginStateChange",this._rtlTextPluginCallback);for(let e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(let e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){let n=this.getSourceCaches(e);for(let o of n)o.clearTiles()}clearSources(){for(let e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){let n=this.getSourceCaches(e);for(let o of n)o.resume(),o.reload()}reloadSources(){for(let e of this.getSources())e.reload&&e.reload()}updateSources(e){let n;this.directionalLight&&(n=Rk(this.directionalLight));for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].update(e,void 0,void 0,n)}_generateCollisionBoxes(){for(let e in this._sourceCaches){let n=this._sourceCaches[e];n.resume(),n.reload()}}_updatePlacement(e,n,o,s,l=!1){let u=!1,d=!1,f={},p={};for(let g of this._mergedOrder){let _=this._mergedLayers[g];if(_.type!=="symbol")continue;let v=os(_.source,_.scope),x=f[v];if(!x){let T=this.getLayerSourceCache(_);if(!T)continue;let E=T.getRenderableIds(!0).map(M=>T.getTileByID(M));p[v]=E.slice(),x=f[v]=E.sort((M,S)=>S.tileID.overscaledZ-M.tileID.overscaledZ||(M.tileID.isLessThan(S.tileID)?-1:1))}let b=this.crossTileSymbolIndex.addLayer(_,x,e.center.lng,e.projection);u=u||b}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),l=l||this._layerOrderChanged||o===0,this._layerOrderChanged&&this.fire(new Se("neworder")),(l||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Zt.now(),e.zoom))&&(this.pauseablePlacement=new Fq(e,this._mergedOrder,l,n,o,s,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,f,p),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Zt.now()),d=!0),u&&this.pauseablePlacement.placement.setStale()),d||u)for(let g of this._mergedOrder){let _=this._mergedLayers[g];_.type==="symbol"&&this.placement.updateLayerOpacities(_,f[os(_.source,_.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Zt.now())}_releaseSymbolFadeTiles(){for(let e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();let n=this.stylesheet.imports=this.stylesheet.imports||[];return n.findIndex(({id:s})=>s===e.id)!==-1?this.fire(new Je(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(n.push(e),this._loadImports([e],!0),this)}setImportUrl(e,n){this._checkLoaded();let o=this.stylesheet.imports||[],s=this.getImportIndex(e);if(s===-1)return this;o[s].url=n;let l=this.fragments[s];return l.style=this._createFragmentStyle(o[s]),l.style.on("style.import.load",()=>this.mergeAll()),l.style.loadURL(n),this}setImportData(e,n){this._checkLoaded();let o=this.getImportIndex(e),s=this.stylesheet.imports||[];return o===-1?this:n?(this.fragments[o].style.setState(n),this._reloadImports(),this):(delete s[o].data,this.setImportUrl(e,s[o].url))}setImportConfig(e,n){this._checkLoaded();let o=this.getImportIndex(e),s=this.stylesheet.imports||[];if(o===-1)return this;n?s[o].config=n:delete s[o].config;let l=this.fragments[o],u=l.style.stylesheet&&l.style.stylesheet.schema;return l.config=n,l.style.setConfig(n,u),l.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();let n=this.stylesheet.imports||[],o=this.getImportIndex(e);return o===-1||(n.splice(o,1),this.fragments[o].style._remove(),this.fragments.splice(o,1),this._reloadImports()),this}getImportIndex(e){let n=(this.stylesheet.imports||[]).findIndex(o=>o.id===e);return n===-1&&this.fire(new Je(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),n}getLayer(e){return this._mergedLayers[e]}getSources(){let e=[];for(let n in this._mergedOtherSourceCaches){let o=this._mergedOtherSourceCaches[n];o&&e.push(o.getSource())}return e}getSource(e,n){let o=this.getSourceCache(e,n);return o&&o.getSource()}getLayerSource(e){let n=this.getLayerSourceCache(e);return n&&n.getSource()}getSourceCache(e,n){let o=os(e,n);return this._mergedOtherSourceCaches[o]}getLayerSourceCache(e){let n=os(e.source,e.scope);return e.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){let n=[];return this._mergedOtherSourceCaches[e]&&n.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&n.push(this._mergedSymbolSourceCaches[e]),n}updateSourceCaches(){let e=this._changes.getUpdatedSourceCaches();for(let n in e){let o=e[n];o==="reload"?this.reloadSource(n):o==="clear"&&this.clearSource(n)}}updateLayers(e){let n=this._changes.getUpdatedPaintProperties();for(let o of n){let s=this.getLayer(o);s&&s.updateTransitions(e)}}getImages(e,n,o){this.imageManager.getImages(n.icons,n.scope,o),this._updateTilesForChangedImages();let s=l=>{l&&l.setDependencies(n.tileID.key,n.type,n.icons)};s(this._otherSourceCaches[n.source]),s(this._symbolSourceCaches[n.source])}getGlyphs(e,n,o){this.glyphManager.getGlyphs(n.stacks,n.scope,o)}getResource(e,n,o){return Ue(n,o)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return e.type==="symbol"?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){let n=[];return this._otherSourceCaches[e]&&n.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&n.push(this._symbolSourceCaches[e]),n}_isSourceCacheLoaded(e){let n=this.getOwnSourceCaches(e);return n.length===0?(this.fire(new Je(new Error(`There is no source with ID '${e}'`))),!1):n.every(o=>o.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function kk(t,e){let n=!1,o=null,s=()=>{o=null,n&&(t(),o=setTimeout(s,e),n=!1)};return()=>(n=!0,o||s(),o)}xl.getSourceType=function(t){return kE[t]},xl.setSourceType=function(t,e){kE[t]=e},xl.registerForPluginStateChange=function(t){return t({pluginStatus:Us,pluginURL:Fu}),Bw.on("pluginStateChange",t),t};class ZZ{constructor(e){this._hashName=e&&encodeURIComponent(e),gr(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kk(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,y.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),y.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let e=this._map;if(!e)return"";let n=Nk(e);if(this._hashName){let o=this._hashName,s=!1,l=y.location.hash.slice(1).split("&").map(u=>{let d=u.split("=")[0];return d===o?(s=!0,`${d}=${n}`):u}).filter(u=>u);return s||l.push(`${o}=${n}`),`#${l.join("&")}`}return`#${n}`}_getCurrentHash(){let e=y.location.hash.replace("#","");if(this._hashName){let n;return e.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(n=o)}),(n&&n[1]||"").split("/")}return e.split("/")}_onHashChange(){let e=this._map;if(!e)return!1;let n=this._getCurrentHash();if(n.length>=3&&!n.some(o=>isNaN(o))){let o=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(n[3]||0):e.getBearing();return e.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){let e=y.location.href.replace(/(#.+)?$/,this.getHashString());y.history.replaceState(y.history.state,null,e)}}function Nk(t,e){let n=t.getCenter(),o=Math.round(100*t.getZoom())/100,s=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,s),u=Math.round(n.lng*l)/l,d=Math.round(n.lat*l)/l,f=t.getBearing(),p=t.getPitch(),g=e?`/${u}/${d}/${o}`:`${o}/${d}/${u}`;return(f||p)&&(g+="/"+Math.round(10*f)/10),p&&(g+=`/${Math.round(p)}`),g}let Xv={linearity:.3,easing:Ut(0,0,.3,1)},YZ=Ne({deceleration:2500,maxSpeed:1400},Xv),XZ=Ne({deceleration:20,maxSpeed:1400},Xv),KZ=Ne({deceleration:1e3,maxSpeed:360},Xv),JZ=Ne({deceleration:1e3,maxSpeed:90},Xv);class QZ{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Zt.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,n=Zt.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let n={zoom:0,bearing:0,pitch:0,pan:new X(0,0),pinchAround:void 0,around:void 0};for(let{settings:l}of this._inertiaBuffer)n.zoom+=l.zoomDelta||0,n.bearing+=l.bearingDelta||0,n.pitch+=l.pitchDelta||0,l.panDelta&&n.pan._add(l.panDelta),l.around&&(n.around=l.around),l.pinchAround&&(n.pinchAround=l.pinchAround);let o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){let l=Jv(n.pan.mag(),o,Ne({},YZ,e||{}));s.offset=n.pan.mult(l.amount/n.pan.mag()),s.center=this._map.transform.center,Kv(s,l)}if(n.zoom){let l=Jv(n.zoom,o,XZ);s.zoom=this._map.transform.zoom+l.amount,Kv(s,l)}if(n.bearing){let l=Jv(n.bearing,o,KZ);s.bearing=this._map.transform.bearing+ze(l.amount,-179,179),Kv(s,l)}if(n.pitch){let l=Jv(n.pitch,o,JZ);s.pitch=this._map.transform.pitch+l.amount,Kv(s,l)}if(s.zoom||s.bearing){let l=n.pinchAround===void 0?n.around:n.pinchAround;s.around=l?this._map.unproject(l):this._map.getCenter()}return this.clear(),s.noMoveStart=!0,s}}function Kv(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Jv(t,e,n){let{maxSpeed:o,linearity:s,deceleration:l}=n,u=ze(t*s/(e/1e3),-o,o),d=Math.abs(u)/(l*s);return{easing:n.easing,duration:1e3*d,amount:u*(d/2)}}class _a extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o,s={}){let l=Ke(n.getCanvasContainer(),o);super(e,Ne({point:l,lngLat:n.unproject(l),originalEvent:o},s)),this._defaultPrevented=!1,this.target=n}}class Qv extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o){let s=e==="touchend"?o.changedTouches:o.touches,l=at(n.getCanvasContainer(),s),u=l.map(f=>n.unproject(f)),d=l.reduce((f,p,g,_)=>f.add(p.div(_.length)),new X(0,0));super(e,{points:l,point:d,lngLats:u,lngLat:n.unproject(d),originalEvent:o}),this._defaultPrevented=!1}}class e7 extends Se{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o){super(e,{originalEvent:o}),this._defaultPrevented=!1}}class t7{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new e7(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new _a(e.type,this._map,e))}mouseup(e){this._map.fire(new _a(e.type,this._map,e))}preclick(e){let n=Ne({},e);n.type="preclick",this._map.fire(new _a(n.type,this._map,n))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(e),this._map.fire(new _a(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new _a(e.type,this._map,e))}mouseover(e){this._map.fire(new _a(e.type,this._map,e))}mouseout(e){this._map.fire(new _a(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Qv(e.type,this._map,e))}touchmove(e){this._map.fire(new Qv(e.type,this._map,e))}touchend(e){this._map.fire(new Qv(e.type,this._map,e))}touchcancel(e){this._map.fire(new Qv(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class n7{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new _a(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _a("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new _a(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class i7{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(re(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;let o=n,s=this._startPos,l=this._lastPos;if(!s||!l||l.equals(o)||!this._box&&o.dist(s)<this._clickTolerance)return;this._lastPos=o,this._box||(this._box=gn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));let u=Math.min(s.x,o.x),d=Math.max(s.x,o.x),f=Math.min(s.y,o.y),p=Math.max(s.y,o.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${u}px,${f}px)`,this._box.style.width=d-u+"px",this._box.style.height=p-f+"px")})}mouseupWindow(e,n){if(!this._active)return;let o=this._startPos,s=n;if(o&&e.button===0){if(this.reset(),_e(),o.x!==s.x||o.y!==s.y)return this._map.fire(new Se("boxzoomend",{originalEvent:e})),{cameraAnimation:l=>l.fitScreenCoordinates(o,s,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),le(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new Se(e,{originalEvent:n}))}}function KE(t,e){let n={};for(let o=0;o<t.length;o++)n[t[o].identifier]=e[o];return n}class r7{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=e.timeStamp),o.length===this.numTouches&&(this.centroid=function(s){let l=new X(0,0);for(let u of s)l._add(u);return l.div(s.length)}(n),this.touches=KE(o,n)))}touchmove(e,n,o){if(this.aborted||!this.centroid)return;let s=KE(o,n);for(let l in this.touches){let u=s[l];(!u||u.dist(this.touches[l])>30)&&(this.aborted=!0)}}touchend(e,n,o){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){let s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}class JE{constructor(e){this.singleTap=new r7(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,n,o){this.singleTap.touchstart(e,n,o)}touchmove(e,n,o){this.singleTap.touchmove(e,n,o)}touchend(e,n,o){let s=this.singleTap.touchend(e,n,o);if(s){let l=e.timeStamp-this.lastTime<500,u=!this.lastTap||this.lastTap.dist(s)<30;if(l&&u||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}class o7{constructor(){this._zoomIn=new JE({numTouches:1,numTaps:2}),this._zoomOut=new JE({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,o){this._zoomIn.touchstart(e,n,o),this._zoomOut.touchstart(e,n,o)}touchmove(e,n,o){this._zoomIn.touchmove(e,n,o),this._zoomOut.touchmove(e,n,o)}touchend(e,n,o){let s=this._zoomIn.touchend(e,n,o),l=this._zoomOut.touchend(e,n,o);return s?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:u.getZoom()+1,around:u.unproject(s)},{originalEvent:e})}):l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:u=>u.easeTo({duration:300,zoom:u.getZoom()-1,around:u.unproject(l)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let s7={0:1,2:2};class QE{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,n){return!1}_move(e,n){return{}}mousedown(e,n){if(this._lastPoint)return;let o=_t(e);this._correctButton(e,o)&&(this._lastPoint=n,this._eventButton=o)}mousemoveWindow(e,n){let o=this._lastPoint;if(o){if(e.preventDefault(),this._eventButton!=null&&function(s,l){let u=s7[l];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton))this.reset();else if(this._moved||!(n.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(o,n)}}mouseupWindow(e){this._lastPoint&&_t(e)===this._eventButton&&(this._moved&&_e(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class a7 extends QE{mousedown(e,n){super.mousedown(e,n),this._lastPoint&&(this._active=!0)}_correctButton(e,n){return n===0&&!e.ctrlKey}_move(e,n){return{around:n,panDelta:n.sub(e)}}}class zk extends QE{_correctButton(e,n){return n===0&&e.ctrlKey||n===2}_move(e,n){let o=.8*(n.x-e.x);if(o)return this._active=!0,{bearingDelta:o}}contextmenu(e){e.preventDefault()}}class Bk extends QE{_correctButton(e,n){return n===0&&e.ctrlKey||n===2}_move(e,n){let o=-.5*(n.y-e.y);if(o)return this._active=!0,{pitchDelta:o}}contextmenu(e){e.preventDefault()}}class l7{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),gr(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new X(0,0)}touchstart(e,n,o){return this._calculateTransform(e,n,o)}touchmove(e,n,o){if(this._active&&!(o.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(o.length===1&&!zt())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,n,o)}}touchend(e,n,o){this._calculateTransform(e,n,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,o){o.length>0&&(this._active=!0);let s=KE(o,n),l=new X(0,0),u=new X(0,0),d=0;for(let p in s){let g=s[p],_=this._touches[p];_&&(l._add(g),u._add(g.sub(_)),d++,s[p]=g)}if(this._touches=s,d<this._minTouches||!u.mag())return;let f=u.div(d);return this._sum._add(f),this._sum.mag()<this._clickTolerance?void 0:{around:l.div(d),panDelta:f}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class eM{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,n,o){return{}}touchstart(e,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,o){let s=this._firstTwoTouches;if(!s)return;e.preventDefault();let[l,u]=s,d=e0(o,n,l),f=e0(o,n,u);if(!d||!f)return;let p=this._aroundCenter?null:d.add(f).div(2);return this._move([d,f],p,e)}touchend(e,n,o){if(!this._firstTwoTouches)return;let[s,l]=this._firstTwoTouches,u=e0(o,n,s),d=e0(o,n,l);u&&d||(this._active&&_e(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function e0(t,e,n){for(let o=0;o<t.length;o++)if(t[o].identifier===n)return e[o]}function jk(t,e){return Math.log(t/e)/Math.LN2}class c7 extends eM{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){let o=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(jk(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jk(this._distance,o),pinchAround:n}}}function Vk(t,e){return 180*t.angleWith(e)/Math.PI}class u7 extends eM{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n){let o=this._vector;if(this._vector=e[0].sub(e[1]),o&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Vk(this._vector,o),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let n=25/(Math.PI*this._minDiameter)*360,o=this._startVector;if(!o)return!1;let s=Vk(e,o);return Math.abs(s)<n}}function tM(t){return Math.abs(t.y)>Math.abs(t.x)}class d7 extends eM{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,tM(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,o){let s=this._lastPoints;if(!s)return;let l=e[0].sub(s[0]),u=e[1].sub(s[1]);return this._map._cooperativeGestures&&!zt()&&o.touches.length<3||(this._valid=this.gestureBeginsVertically(l,u,o.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+u.y)/2*-.5})}gestureBeginsVertically(e,n,o){if(this._valid!==void 0)return this._valid;let s=e.mag()>=2,l=n.mag()>=2;if(!s&&!l)return;if(!s||!l)return this._firstMove==null&&(this._firstMove=o),o-this._firstMove<100&&void 0;let u=e.y>0==n.y>0;return tM(e)&&tM(n)&&u}}let h7={panStep:100,bearingStep:15,pitchStep:10};class f7{constructor(){let e=h7;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,o=0,s=0,l=0,u=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?o=-1:(e.preventDefault(),l=-1);break;case 39:e.shiftKey?o=1:(e.preventDefault(),l=1);break;case 38:e.shiftKey?s=1:(e.preventDefault(),u=-1);break;case 40:e.shiftKey?s=-1:(e.preventDefault(),u=1);break;default:return}return this._rotationDisabled&&(o=0,s=0),{cameraAnimation:d=>{let f=d.getZoom();d.easeTo({duration:300,easeId:"keyboardHandler",easing:p7,zoom:n?Math.round(f)+n*(e.shiftKey?2:1):f,bearing:d.getBearing()+o*this._bearingStep,pitch:d.getPitch()+s*this._pitchStep,offset:[-l*this._panStep,-u*this._panStep],center:d.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function p7(t){return t*(2-t)}let Uk=4.000244140625;class m7{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,gr(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||zt()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===y.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,o=Zt.now(),s=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%Uk==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(s*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let n=Ke(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._map.transform;this._type==="wheel"&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let n=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(this._delta!==0){let p=this._type==="wheel"&&Math.abs(this._delta)>Uk?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&g!==0&&(g=1/g);let _=n(),v=Math.pow(2,_),x=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):v;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(x*g))),this._type==="wheel"&&(this._startZoom=_,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let o=typeof this._targetZoom=="number"?this._targetZoom:n(),s=this._startZoom,l=this._easing,u,d=!1;if(this._type==="wheel"&&s&&l){let p=Math.min((Zt.now()-this._lastWheelEventTime)/200,1);u=Yt(s,o,l(p)),p<1?this._frameId||(this._frameId=!0):d=!0}else u=o,d=!0;this._active=!0,d&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let f=u-n();return f*this._lastDelta<0&&(f=0),{noInertia:!0,needsRenderFrame:!d,zoomDelta:f,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=jt;if(this._prevEase){let o=this._prevEase,s=(Zt.now()-o.start)/o.duration,l=o.easing(s+.01)-o.easing(s),u=.27/Math.sqrt(l*l+1e-4)*.01;n=Ut(u,Math.sqrt(.0729-u*u),.25,1)}return this._prevEase={start:Zt.now(),duration:e,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(y.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class g7{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _7{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,n){return e.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:o.getZoom()+(e.shiftKey?-1:1),around:o.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class y7{constructor(){this._tap=new JE({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,n,o){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=n[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(e,n,o))}touchmove(e,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;let s=n[0],l=s.y-this._swipePoint.y;return this._swipePoint=s,e.preventDefault(),this._active=!0,{zoomDelta:l/128}}}else this._tap.touchmove(e,n,o)}touchend(e,n,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(e,n,o)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class v7{constructor(e,n,o){this._el=e,this._mousePan=n,this._touchPan=o}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class x7{constructor(e,n,o){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class b7{constructor(e,n,o,s){this._el=e,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let t0=t=>t.zoom||t.drag||t.pitch||t.rotate;class w7 extends Se{}class T7{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,n){let o=Z.sub([],n,e);this.radius=Z.length(o[2]<0?Z.div([],o,this.constants):[o[0],o[1],0])}projectRay(e){Z.div(e,e,this.constants),Z.normalize(e,e),Z.mul(e,e,this.constants);let n=Z.scale([],e,this.radius);if(n[2]>0){let o=Z.scale([],[0,0,1],Z.dot(n,[0,0,1])),s=Z.scale([],Z.normalize([],[n[0],n[1],0]),this.radius),l=Z.add([],n,Z.scale([],Z.sub([],Z.add([],s,o),n),2));n[0]=l[0],n[1]=l[1]}return n}}function n0(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class E7{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new QZ(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new T7,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),gr(["handleEvent","handleWindowEvent"],this);let o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[y.document,"mousemove",{capture:!0}],[y.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[y,"blur",void 0]];for(let[s,l,u]of this._listeners)s.addEventListener(l,s===y.document?this.handleWindowEvent:this.handleEvent,u)}destroy(){for(let[e,n,o]of this._listeners)e.removeEventListener(n,e===y.document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(e){let n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new t7(n,e));let s=n.boxZoom=new i7(n,e);this._add("boxZoom",s);let l=new o7,u=new _7;n.doubleClickZoom=new g7(u,l),this._add("tapZoom",l),this._add("clickZoom",u);let d=new y7;this._add("tapDragZoom",d);let f=n.touchPitch=new d7(n);this._add("touchPitch",f);let p=new zk(e),g=new Bk(e);n.dragRotate=new x7(e,p,g),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",g,["mouseRotate"]);let _=new a7(e),v=new l7(n,e);n.dragPan=new v7(o,_,v),this._add("mousePan",_),this._add("touchPan",v,["touchZoom","touchRotate"]);let x=new u7,b=new c7;n.touchZoomRotate=new b7(o,b,x,d),this._add("touchRotate",x,["touchPan","touchZoom"]),this._add("touchZoom",b,["touchPan","touchRotate"]),this._add("blockableMapEvent",new n7(n));let T=n.scrollZoom=new m7(n,this);this._add("scrollZoom",T,["mousePan"]);let E=n.keyboard=new f7;this._add("keyboard",E);for(let M of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[M]&&n[M].enable(e[M])}_add(e,n,o){this._handlers.push({handlerName:e,handler:n,allowed:o}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(let{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!t0(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,n,o){for(let s in e)if(s!==o&&(!n||n.indexOf(s)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){let n=[];for(let o of e)this._el.contains(o.target)&&n.push(o);return n}handleEvent(e,n){this._updatingCamera=!0;let o=e.type==="renderFrame",s=o?void 0:e,l={needsRenderFrame:!1},u={},d={},f=e.touches?this._getMapTouches(e.touches):void 0,p=f?at(this._el,f):o?void 0:Ke(this._el,e);for(let{handlerName:v,handler:x,allowed:b}of this._handlers){if(!x.isEnabled())continue;let T;this._blockedByActive(d,b,v)?x.reset():x[n||e.type]&&(T=x[n||e.type](e,p,f),this.mergeHandlerResult(l,u,T,v,s),T&&T.needsRenderFrame&&this._triggerRenderFrame()),(T||x.isActive())&&(d[v]=x)}let g={};for(let v in this._previousActiveHandlers)d[v]||(g[v]=s);this._previousActiveHandlers=d,(Object.keys(g).length||n0(l))&&(this._changes.push([l,u,g]),this._triggerRenderFrame()),(Object.keys(d).length||n0(l))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:_}=l;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))}mergeHandlerResult(e,n,o,s,l){if(!o)return;Ne(e,o);let u={handlerName:s,originalEvent:o.originalEvent||l};o.zoomDelta!==void 0&&(n.zoom=u),o.panDelta!==void 0&&(n.drag=u),o.pitchDelta!==void 0&&(n.pitch=u),o.bearingDelta!==void 0&&(n.rotate=u)}_applyChanges(){let e={},n={},o={};for(let[s,l,u]of this._changes)s.panDelta&&(e.panDelta=(e.panDelta||new X(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),s.around!==void 0&&(e.around=s.around),s.aroundCoord!==void 0&&(e.aroundCoord=s.aroundCoord),s.pinchAround!==void 0&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),Ne(n,l),Ne(o,u);this._updateMapTransform(e,n,o),this._changes=[]}_updateMapTransform(e,n,o){let s=this._map,l=s.transform,u=S=>[S.x,S.y,S.z];if((S=>{let P=this._eventsInProgress.drag;return P&&!this._handlersById[P.handlerName].isActive()})()&&!n0(e)){let S=l.zoom;l.cameraElevationReference="sea",this._originalZoom!=null&&l._orthographicProjectionAtLowPitch&&l.projection.name!=="globe"&&l.pitch===0?(l.cameraElevationReference="ground",l.zoom=this._originalZoom):(l.recenterOnTerrain(),l.cameraElevationReference="ground"),S!==l.zoom&&this._map._update(!0)}if(l._isCameraConstrained&&s._stop(!0),!n0(e))return void this._fireEvents(n,o,!0);let{panDelta:d,zoomDelta:f,bearingDelta:p,pitchDelta:g,around:_,aroundCoord:v,pinchAround:x}=e;l._isCameraConstrained&&(f>0&&(f=0),l._isCameraConstrained=!1),x!==void 0&&(_=x),(f||(S=>n[S]&&!this._eventsInProgress[S])("drag"))&&_&&(this._dragOrigin=u(l.pointCoordinate3D(_)),this._originalZoom=l.zoom,this._trackingEllipsoid.setup(l._camera.position,this._dragOrigin)),l.cameraElevationReference="sea",s._stop(!0),_=_||s.transform.centerPoint,p&&(l.bearing+=p),g&&(l.pitch+=g),l._updateCameraState();let b=[0,0,0];if(d)if(l.projection.name==="mercator"){let S=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(_).dir),P=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(_.sub(d)).dir);b[0]=P[0]-S[0],b[1]=P[1]-S[1]}else{let S=l.pointCoordinate(_);if(l.projection.name==="globe"){d=d.rotate(-l.angle);let P=l._pixelsPerMercatorPixel/l.worldSize;b[0]=-d.x*OT(Jr(S.y))*P,b[1]=-d.y*OT(l.center.lat)*P}else{let P=l.pointCoordinate(_.sub(d));S&&P&&(b[0]=P.x-S.x,b[1]=P.y-S.y)}}let T=l.zoom,E=[0,0,0];if(f){let S=u(v||l.pointCoordinate3D(_)),P={dir:Z.normalize([],Z.sub([],S,l._camera.position))};if(P.dir[2]<0){let O=l.zoomDeltaToMovement(S,f);Z.scale(E,P.dir,O)}}let M=Z.add(b,b,E);l._translateCameraConstrained(M),f&&Math.abs(l.zoom-T)>1e-4&&l.recenterOnTerrain(),l.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,o,!0)}_fireEvents(e,n,o){let s=t0(this._eventsInProgress),l=t0(e),u={};for(let g in e){let{originalEvent:_}=e[g];this._eventsInProgress[g]||(u[`${g}start`]=_),this._eventsInProgress[g]=e[g]}!s&&l&&this._fireEvent("movestart",l.originalEvent);for(let g in u)this._fireEvent(g,u[g]);l&&this._fireEvent("move",l.originalEvent);for(let g in e){let{originalEvent:_}=e[g];this._fireEvent(g,_)}let d={},f;for(let g in this._eventsInProgress){let{handlerName:_,originalEvent:v}=this._eventsInProgress[g];this._handlersById[_].isActive()||(delete this._eventsInProgress[g],f=n[_]||v,d[`${g}end`]=f)}for(let g in d)this._fireEvent(g,d[g]);let p=t0(this._eventsInProgress);if(o&&(s||l)&&!p){this._updatingCamera=!0;let g=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),_=v=>v!==0&&-this._bearingSnap<v&&v<this._bearingSnap;g?(_(g.bearing||this._map.getBearing())&&(g.bearing=0),this._map.easeTo(g,{originalEvent:f})):(this._map.fire(new Se("moveend",{originalEvent:f})),_(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new Se(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new w7("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let $k="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class M7 extends vn{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,gr(["_renderFrameCallback"],this)}getCenter(){return new Xt(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,o){return e=X.convert(e).mult(-1),this.panTo(this.transform.center,Ne({offset:e},n),o)}panTo(e,n,o){return this.easeTo(Ne({center:e},n),o)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,o){return this.easeTo(Ne({zoom:e},n),o)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,o){return this.easeTo(Ne({bearing:e},n),o)}resetNorth(e,n){return this.rotateTo(0,Ne({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(Ne({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=Gs.convert(e);let o=n&&n.bearing||0,s=n&&n.pitch||0,l=e.getNorthWest(),u=e.getSouthEast();return this._cameraForBounds(this.transform,l,u,o,s,n)}_extendCameraOptions(e){let n={top:0,bottom:0,right:0,left:0};if(typeof(e=Ne({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=="number"){let o=e.padding;e.padding={top:o,bottom:o,right:o,left:o}}return e.padding=Ne(n,e.padding),e}_minimumAABBFrustumDistance(e,n){let o=n.max[0]-n.min[0],s=n.max[1]-n.min[1];return o/s>e.aspect?o/(2*Math.tan(.5*e.fovX)*e.aspect):s/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,n,o,s,l,u){let d=e.clone(),f=this._extendCameraOptions(u);d.bearing=s,d.pitch=l;let p=Xt.convert(n),g=Xt.convert(o),_=.5*(p.lat+g.lat),v=.5*(p.lng+g.lng),x=Ps(_,v),b=Z.normalize([],x),T=Z.normalize([],Z.cross([],b,[0,1,0])),E=Z.cross([],T,b),M=[T[0],T[1],T[2],0,E[0],E[1],E[2],0,b[0],b[1],b[2],0,0,0,0,1],S=[x,Ps(p.lat,p.lng),Ps(g.lat,p.lng),Ps(g.lat,g.lng),Ps(p.lat,g.lng),Ps(_,p.lng),Ps(_,g.lng),Ps(p.lat,v),Ps(g.lat,v)],P=qi.fromPoints(S.map(ee=>[Z.dot(T,ee),Z.dot(E,ee),Z.dot(b,ee)])),O=Z.transformMat4([],P.center,M);Z.squaredLength(O)===0&&Z.set(O,0,0,1),Z.normalize(O,O),Z.scale(O,O,gs),d.center=function([ee,de,pe]){let fe=Math.hypot(ee,de,pe),be=Math.atan2(ee,pe),Te=.5*Math.PI-Math.acos(-de/fe);return new Xt(xi(be),xi(Te))}(O);let A=d.getWorldToCameraMatrix(),R=ae.invert(new Float64Array(16),A);P=qi.applyTransform(P,ae.multiply([],A,M)),Z.transformMat4(O,O,A);let F=.5*(P.max[2]-P.min[2]),k=this._minimumAABBFrustumDistance(d,P),N=Z.scale([],[0,0,1],F),B=Z.add(N,O,N),H=k+(d.pitch===0?0:Z.distance(O,B)),G=d.globeCenterInViewSpace,Y=Z.sub([],O,[G[0],G[1],G[2]]);Z.normalize(Y,Y),Z.scale(Y,Y,H);let U=Z.add([],O,Y);Z.transformMat4(U,U,R);let Q=$f/gs,te=Z.length(U),se=Oi(Math.max(te*Q-$f,Number.EPSILON),0),K=Math.min(d.zoomFromMercatorZAdjusted(se),f.maxZoom);return K>.5*(Wm+Uu)?(d.setProjection({name:"mercator"}),d.zoom=K,this._cameraForBounds(d,n,o,s,l,u)):{center:d.center,zoom:K,bearing:s,pitch:l}}queryTerrainElevation(e,n){let o=this.transform.elevation;return o?(n=Ne({},{exaggerated:!0},n),o.getAtPoint(Fn.fromLngLat(e),null,n.exaggerated)):null}_cameraForBounds(e,n,o,s,l,u){if(e.projection.name==="globe")return this._cameraForBoundsOnGlobe(e,n,o,s,l,u);let d=e.clone(),f=this._extendCameraOptions(u),p=d.padding;d.bearing=s,d.pitch=l;let g=Xt.convert(n),_=Xt.convert(o),v=new Xt(g.lng,_.lat),x=new Xt(_.lng,g.lat),b=d.project(g),T=d.project(_),E=this.queryTerrainElevation(g),M=this.queryTerrainElevation(_),S=this.queryTerrainElevation(v),P=this.queryTerrainElevation(x),O=[[b.x,b.y,Math.min(E||0,M||0,S||0,P||0)],[T.x,T.y,Math.max(E||0,M||0,S||0,P||0)]],A=qi.fromPoints(O),R=d.getWorldToCameraMatrix(),F=ae.invert(new Float64Array(16),R);A=qi.applyTransform(A,R);let k=Z.sub([],A.max,A.min),N=p.left||0,B=p.right||0,H=p.bottom||0,G=p.top||0,{left:Y,right:U,top:Q,bottom:te}=f.padding,se=.5*(N+B),K=.5*(G+H),ee=Math.min(d.scaleZoom(d.scale*Math.min((d.width-(N+B+Y+U))/k[0],(d.height-(H+G+te+Q))/k[1])),f.maxZoom),de=d.scale/d.zoomScale(ee);A=new qi([A.min[0]-(Y+se)*de,A.min[1]-(te+K)*de,A.min[2]],[A.max[0]+(U+se)*de,A.max[1]+(Q+K)*de,A.max[2]]);let pe=.5*k[2],fe=this._minimumAABBFrustumDistance(d,A),be=[0,0,1,0];Ei.transformMat4(be,be,R),Ei.normalize(be,be);let Te=Z.scale([],be,fe+pe),Me=Z.add([],A.center,Te),ge=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new X(f.offset.x,f.offset.y):X.convert(f.offset)).rotate(-Vt(s));A.center[0]-=ge.x*de,A.center[1]+=ge.y*de,Z.transformMat4(A.center,A.center,F),Z.transformMat4(Me,Me,F);let Pe=[A.center[0],A.center[1],Me[2]*d.pixelsPerMeter];Z.scale(Pe,Pe,1/d.worldSize);let et=Ws(Pe[0]),tt=Jr(Pe[1]),lt=Math.min(d._zoomFromMercatorZ(Pe[2]),f.maxZoom),ct=new Xt(et,tt);return d.mercatorFromTransition&&lt<.5*(Wm+Uu)?(d.setProjection({name:"globe"}),d.zoom=lt,this._cameraForBounds(d,n,o,s,l,u)):{center:ct,zoom:lt,bearing:s,pitch:l}}fitBounds(e,n,o){let s=this.cameraForBounds(e,n);return this._fitInternal(s,n,o)}fitScreenCoordinates(e,n,o,s,l){let u=X.convert(e),d=X.convert(n),f=new X(Math.min(u.x,d.x),Math.min(u.y,d.y)),p=new X(Math.max(u.x,d.x),Math.max(u.y,d.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(u,d))return this;let g=this.transform.pointLocation3D(f),_=this.transform.pointLocation3D(p),v=this.transform.pointLocation3D(new X(f.x,p.y)),x=this.transform.pointLocation3D(new X(p.x,f.y)),b=[Math.min(g.lng,_.lng,v.lng,x.lng),Math.min(g.lat,_.lat,v.lat,x.lat)],T=[Math.max(g.lng,_.lng,v.lng,x.lng),Math.max(g.lat,_.lat,v.lat,x.lat)],E=s&&s.pitch?s.pitch:this.getPitch(),M=this._cameraForBounds(this.transform,b,T,o,E,s);return this._fitInternal(M,s,l)}_fitInternal(e,n,o){return e?(delete(n=Ne(e,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(e,n){this.stop();let o=e.preloadOnly?this.transform.clone():this.transform,s=!1,l=!1,u=!1;return"zoom"in e&&o.zoom!==+e.zoom&&(s=!0,o.zoom=+e.zoom),e.center!==void 0&&(o.center=Xt.convert(e.center)),"bearing"in e&&o.bearing!==+e.bearing&&(l=!0,o.bearing=+e.bearing),"pitch"in e&&o.pitch!==+e.pitch&&(u=!0,o.pitch=+e.pitch),e.padding==null||o.isPaddingEqual(e.padding)||(o.padding=e.padding),e.preloadOnly?(this._preloadTiles(o),this):(this.fire(new Se("movestart",n)).fire(new Se("move",n)),s&&this.fire(new Se("zoomstart",n)).fire(new Se("zoom",n)).fire(new Se("zoomend",n)),l&&this.fire(new Se("rotatestart",n)).fire(new Se("rotate",n)).fire(new Se("rotateend",n)),u&&this.fire(new Se("pitchstart",n)).fire(new Se("pitch",n)).fire(new Se("pitchend",n)),this.fire(new Se("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||J($k),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,n){let o=this.transform;if(!o.projection.supportsFreeCamera)return J($k),this;this.stop();let s=o.zoom,l=o.pitch,u=o.bearing;o.setFreeCameraOptions(e);let d=s!==o.zoom,f=l!==o.pitch,p=u!==o.bearing;return this.fire(new Se("movestart",n)).fire(new Se("move",n)),d&&this.fire(new Se("zoomstart",n)).fire(new Se("zoom",n)).fire(new Se("zoomend",n)),p&&this.fire(new Se("rotatestart",n)).fire(new Se("rotate",n)).fire(new Se("rotateend",n)),f&&this.fire(new Se("pitchstart",n)).fire(new Se("pitch",n)).fire(new Se("pitchend",n)),this.fire(new Se("moveend",n)),this}easeTo(e,n){this._stop(!1,e.easeId),((e=Ne({offset:[0,0],duration:500,easing:jt},e)).animate===!1||this._prefersReducedMotion(e))&&(e.duration=0);let o=this.transform,s=this.getZoom(),l=this.getBearing(),u=this.getPitch(),d=this.getPadding(),f="zoom"in e?+e.zoom:s,p="bearing"in e?this._normalizeBearing(e.bearing,l):l,g="pitch"in e?+e.pitch:u,_="padding"in e?e.padding:o.padding,v=X.convert(e.offset),x,b,T;if(o.projection.name==="globe"){let N=Fn.fromLngLat(o.center),B=v.rotate(-o.angle);N.x+=B.x/o.worldSize,N.y+=B.y/o.worldSize;let H=N.toLngLat(),G=Xt.convert(e.center||H);this._normalizeCenter(G),x=o.centerPoint.add(B),b=new X(N.x,N.y).mult(o.worldSize),T=new X(ao(G.lng),po(G.lat)).mult(o.worldSize).sub(b)}else{x=o.centerPoint.add(v);let N=o.pointLocation(x),B=Xt.convert(e.center||N);this._normalizeCenter(B),b=o.project(N),T=o.project(B).sub(b)}let E=o.zoomScale(f-s),M,S;e.around&&(M=Xt.convert(e.around),S=o.locationPoint(M));let P=this._zooming||f!==s,O=this._rotating||l!==p,A=this._pitching||g!==u,R=!o.isPaddingEqual(_),F=N=>B=>{if(P&&(N.zoom=Yt(s,f,B)),O&&(N.bearing=Yt(l,p,B)),A&&(N.pitch=Yt(u,g,B)),R&&(N.interpolatePadding(d,_,B),x=N.centerPoint.add(v)),M)N.setLocationAtPoint(M,S);else{let H=N.zoomScale(N.zoom-s),G=f>s?Math.min(2,E):Math.max(.5,E),Y=Math.pow(G,1-B),U=N.unproject(b.add(T.mult(B*Y)).mult(H));N.setLocationAtPoint(N.renderWorldCopies?U.wrap():U,x)}return e.preloadOnly||this._fireMoveEvents(n),N};if(e.preloadOnly){let N=this._emulate(F,e.duration,o);return this._preloadTiles(N),this}let k={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=P,this._rotating=O,this._pitching=A,this._padding=R,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,k),this._ease(F(o),N=>{o.cameraElevationReference==="sea"&&o.recenterOnTerrain(),this._afterEase(n,N)},e),this}_prepareEase(e,n,o={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||o.moving||this.fire(new Se("movestart",e)),this._zooming&&!o.zooming&&this.fire(new Se("zoomstart",e)),this._rotating&&!o.rotating&&this.fire(new Se("rotatestart",e)),this._pitching&&!o.pitching&&this.fire(new Se("pitchstart",e))}_fireMoveEvents(e){this.fire(new Se("move",e)),this._zooming&&this.fire(new Se("zoom",e)),this._rotating&&this.fire(new Se("rotate",e)),this._pitching&&this.fire(new Se("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let o=this._zooming,s=this._rotating,l=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new Se("zoomend",e)),s&&this.fire(new Se("rotateend",e)),l&&this.fire(new Se("pitchend",e)),this.fire(new Se("moveend",e))}flyTo(e,n){if(this._prefersReducedMotion(e)){let ee=wo(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ee,n)}this.stop(),e=Ne({offset:[0,0],speed:1.2,curve:1.42,easing:jt},e);let o=this.transform,s=this.getZoom(),l=this.getBearing(),u=this.getPitch(),d=this.getPadding(),f="zoom"in e?ze(+e.zoom,o.minZoom,o.maxZoom):s,p="bearing"in e?this._normalizeBearing(e.bearing,l):l,g="pitch"in e?+e.pitch:u,_="padding"in e?e.padding:o.padding,v=o.zoomScale(f-s),x=X.convert(e.offset),b=o.centerPoint.add(x),T=o.pointLocation(b),E=Xt.convert(e.center||T);this._normalizeCenter(E);let M=o.project(T),S=o.project(E).sub(M),P=e.curve,O=Math.max(o.width,o.height),A=O/v,R=S.mag();if("minZoom"in e){let ee=ze(Math.min(e.minZoom,s,f),o.minZoom,o.maxZoom),de=O/o.zoomScale(ee-s);P=Math.sqrt(de/R*2)}let F=P*P;function k(ee){let de=(A*A-O*O+(ee?-1:1)*F*F*R*R)/(2*(ee?A:O)*F*R);return Math.log(Math.sqrt(de*de+1)-de)}function N(ee){return(Math.exp(ee)-Math.exp(-ee))/2}function B(ee){return(Math.exp(ee)+Math.exp(-ee))/2}let H=k(0),G=function(ee){return B(H)/B(H+P*ee)},Y=function(ee){return O*((B(H)*(N(de=H+P*ee)/B(de))-N(H))/F)/R;var de},U=(k(1)-H)/P;if(Math.abs(R)<1e-6||!isFinite(U)){if(Math.abs(O-A)<1e-6)return this.easeTo(e,n);let ee=A<O?-1:1;U=Math.abs(Math.log(A/O))/P,Y=function(){return 0},G=function(de){return Math.exp(ee*P*de)}}e.duration="duration"in e?+e.duration:1e3*U/("screenSpeed"in e?+e.screenSpeed/P:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);let Q=l!==p,te=g!==u,se=!o.isPaddingEqual(_),K=ee=>de=>{let pe=de*U,fe=1/G(pe);ee.zoom=de===1?f:s+ee.scaleZoom(fe),Q&&(ee.bearing=Yt(l,p,de)),te&&(ee.pitch=Yt(u,g,de)),se&&(ee.interpolatePadding(d,_,de),b=ee.centerPoint.add(x));let be=de===1?E:ee.unproject(M.add(S.mult(Y(pe))).mult(fe));return ee.setLocationAtPoint(ee.renderWorldCopies?be.wrap():be,b),ee._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(n),ee};if(e.preloadOnly){let ee=this._emulate(K,e.duration,o);return this._preloadTiles(ee),this}return this._zooming=!0,this._rotating=Q,this._pitching=te,this._padding=se,this._prepareEase(n,!1),this._ease(K(o),()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let o=this._onEaseEnd;this._onEaseEnd=void 0,o.call(this,n)}if(!e){let o=this.handlers;o&&o.stop(!1)}return this}_ease(e,n,o){o.animate===!1||o.duration===0?(e(1),n()):(this._easeStart=Zt.now(),this._easeOptions=o,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let e=Math.min((Zt.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=bi(e,-180,180);let o=Math.abs(e-n);return Math.abs(e-360-n)<o&&(e-=360),Math.abs(e+360-n)<o&&(e+=360),e}_normalizeCenter(e){let n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;let o=e.lng-n.center.lng;e.lng+=o>180?-360:o<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&Zt.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,n,o){let s=Math.ceil(15*n/1e3),l=[],u=e(o.clone());for(let d=0;d<=s;d++){let f=u(d/s);l.push(f.clone())}return l}}class Hk{constructor(e={}){this.options=e,gr(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){let n=this.options&&this.options.compact;return this._map=e,this._container=gn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=gn("button","mapboxgl-ctrl-attrib-button",this._container),gn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=gn("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,n){let o=this._map._getUIString(`AttributionControl.${n}`);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",o)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));let n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||D.ACCESS_TOKEN}];if(e){let o=n.reduce((s,l,u)=>(l.value&&(s+=`${l.key}=${l.value}${u<n.length-1?"&":""}`),s),"?");e.href=`${D.FEEDBACK_URL}/${o}#${Nk(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){let s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}let n=this._map.style._mergedSourceCaches;for(let s in n){let l=n[s];if(l.used){let u=l.getSource();u.attribution&&e.indexOf(u.attribution)<0&&e.push(u.attribution)}}e.sort((s,l)=>s.length-l.length),e=e.filter((s,l)=>{for(let u=l+1;u<e.length;u++)if(e[u].indexOf(s)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));let o=e.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gk{constructor(){gr(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=gn("div","mapboxgl-ctrl");let n=gn("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&e.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let e=this._map.style._sourceCaches;if(Object.entries(e).length===0)return!0;for(let n in e){let o=e[n].getSource();if(o.hasOwnProperty("mapbox_logo")&&!o.mapbox_logo)return!1}return!0}_updateCompact(){let e=this._container.children;if(e.length){let n=e[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class Wk{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){let n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(let s of o)if(s.id===e)return void(s.cancelled=!0)}run(e=0){let n=this._currentlyRunning=this._queue;this._queue=[];for(let o of n)if(!o.cancelled&&(o.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function qk(t,e,n){if(t=new Xt(t.lng,t.lat),e){let o=new Xt(t.lng-360,t.lat),s=new Xt(t.lng+360,t.lat),l=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),u=n.locationPoint(t).distSqr(e),d=e.x<0||e.y<0||e.x>n.width||e.y>n.height;n.locationPoint(o).distSqr(e)<u&&(d||Math.abs(o.lng-n.center.lng)<l)?t=o:n.locationPoint(s).distSqr(e)<u&&(d||Math.abs(s.lng-n.center.lng)<l)&&(t=s)}for(;Math.abs(t.lng-n.center.lng)>180;){let o=n.locationPoint(t);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}let nM={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class iM extends vn{constructor(e,n){if(super(),(e instanceof y.HTMLElement||n)&&(e=Ne({element:e},n)),gr(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=X.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=gn("div");let l=41,u=27,d=Mo("svg",{display:"block",height:l*this._scale+"px",width:u*this._scale+"px",viewBox:`0 0 ${u} ${l}`},this._element),f=Mo("radialGradient",{id:"shadowGradient"},Mo("defs",{},d));Mo("stop",{offset:"10%","stop-opacity":.4},f),Mo("stop",{offset:"100%","stop-opacity":.05},f),Mo("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d),Mo("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),Mo("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),Mo("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),this._offset=X.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()});let o=this._element.classList;for(let l in nM)o.remove(`mapboxgl-marker-anchor-${l}`);o.add(`mapboxgl-marker-anchor-${this._anchor}`);let s=e&&e.className?e.className.trim().split(/\s+/):[];o.add(...s),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){let e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=Xt.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let s=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(38.1-13.5+s)],"bottom-right":[-s,-1*(38.1-13.5+s)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){let n=e.code,o=e.charCode||e.keyCode;n!=="Space"&&n!=="Enter"&&o!==32&&o!==13||this.togglePopup()}_onMapClick(e){let n=e.originalEvent.target,o=this._element;this._popup&&(n===o||o.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let e=this._map,n=this._pos;if(!e||!n)return!1;let o=e.unproject(n),s=e.getFreeCameraOptions();if(!s.position)return!1;let l=s.position.toLngLat();return l.distanceTo(o)<.9*l.distanceTo(this._lngLat)}_evaluateOpacity(){let e=this._map;if(!e)return;let n=this._pos;if(!n||n.x<0||n.x>e.transform.width||n.y<0||n.y>e.transform.height)return void this._clearFadeTimer();let o=e.unproject(n),s;e._showingGlobe()&&By(e.transform,this._lngLat)?s=0:(s=1-e._queryFogOpacity(o),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(s*=this._occludedOpacity)),this._element.style.opacity=`${s}`,this._element.style.pointerEvents=s>0?"auto":"none",this._popup&&this._popup._setOpacity(s),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let e=this._pos;if(!e||!this._map)return;let n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${e.x}px,${e.y}px)
            ${nM[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){let e=this._pos,n=this._map,o=this.getPitchAlignment();if(!n||!e||o!=="map")return"";if(!n._showingGlobe()){let f=n.getPitch();return f?`rotateX(${f}deg)`:""}let s=xi(R2(n.transform,this._lngLat)),l=e.sub(O2(n.transform)),u=Math.abs(l.x)+Math.abs(l.y);if(u===0)return"";let d=s/u;return`rotateX(${-l.y*d}deg) rotateY(${l.x*d}deg)`}_calculateZTransform(){let e=this._pos,n=this._map;if(!n||!e)return"";let o=0,s=this.getRotationAlignment();if(s==="map")if(n._showingGlobe()){let l=n.project(new Xt(this._lngLat.lng,this._lngLat.lat+.001)),u=n.project(new Xt(this._lngLat.lng,this._lngLat.lat-.001)).sub(l);o=xi(Math.atan2(u.y,u.x))-90}else o=-n.getBearing();else if(s==="horizon"){let l=Si(4,6,n.getZoom()),u=O2(n.transform);u.y+=l*n.transform.height;let d=e.sub(u),f=xi(Math.atan2(d.y,d.x));o=(f>90?f-270:f+90)*(1-l)}return o+=this._rotation,o?`rotateZ(${o}deg)`:""}_update(e){y.cancelAnimationFrame(this._updateFrameId);let n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=qk(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),e===!0?this._updateFrameId=y.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=X.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){let n=this._map;if(!n)return;let o=this._pointerdownPos,s=this._positionDelta;if(o&&s){if(!this._isDragging){let l=this._clickTolerance||n._clickTolerance;if(e.point.dist(o)<l)return;this._isDragging=!0}this._pos=e.point.sub(s),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new Se("dragstart"))),this.fire(new Se("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new Se("dragend")),this._state="inactive"}_addDragHandler(e){let n=this._map,o=this._pos;n&&o&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(o),this._pointerdownPos=e.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;let n=this._map;return n&&(e?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let I7={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},C7=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zk(t=new X(0,0),e="bottom"){if(typeof t=="number"){let n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(e){case"top":return new X(0,t);case"top-left":return new X(n,n);case"top-right":return new X(-n,n);case"bottom":return new X(0,-t);case"bottom-left":return new X(n,-n);case"bottom-right":return new X(-n,-n);case"left":return new X(t,0);case"right":return new X(-t,0)}return new X(0,0)}return t instanceof X||Array.isArray(t)?X.convert(t):X.convert(t[e]||[0,0])}class S7{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;let n=Ko((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,n,o){this._start=this.getValue(n),this._end=e,this._startTime=n,this._endTime=n+o}}let D7={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},A7={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},P7={showCompass:!0,showZoom:!0,visualizePitch:!1};class O7{constructor(e,n,o=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new zk({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,o&&(this.mousePitch=new Bk({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),gr(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,n){this.mouseRotate.mousedown(e,n),this.mousePitch&&this.mousePitch.mousedown(e,n),re()}move(e,n){let o=this.map,s=this.mouseRotate.mousemoveWindow(e,n),l=s&&s.bearingDelta;if(l&&o.setBearing(o.getBearing()+l),this.mousePitch){let u=this.mousePitch.mousemoveWindow(e,n),d=u&&u.pitchDelta;d&&o.setPitch(o.getPitch()+d)}}off(){let e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){le(),y.removeEventListener("mousemove",this.mousemove),y.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(Ne({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),Ke(this.element,e)),y.addEventListener("mousemove",this.mousemove),y.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,Ke(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=at(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=at(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let R7={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},L7={maxWidth:100,unit:"metric"},F7={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},i0={version:w,supported:Vl,setRTLTextPlugin:function(t,e,n=!1){if(Us===Lw||Us===Fw||Us===kw)throw new Error("setRTLTextPlugin cannot be called multiple times.");Fu=Zt.resolveURL(t),Us=Lw,Nw=e,zw(),n||FP()},getRTLTextPluginStatus:jw,Map:class extends M7{constructor(t){hs.mark(ds.create);let e=t;if((t=Ne({},A7,t)).minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&function(n){let o=n.navigator?n.navigator.userAgent:null;return!!function(s){if(Dt==null){let l=s.navigator?s.navigator.userAgent:null;Dt=!!s.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Dt}(n)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(y)&&(t.antialias=!1,J("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new _E(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new Wk,this._domRenderTaskQueue=new Wk,this._controls=[],this._markers=[],this._popups=[],this._mapId=pi(),this._locale=Ne({},D7,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new S7(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Mt(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?Lt({},t.contextCreateOptions):{},typeof t.container=="string"){if(this._container=y.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container.toString()}' not found.`)}else{if(!(t.container instanceof y.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&J("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),gr(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),y!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in y.document?"fullscreenchange":"webkitfullscreenchange",y.addEventListener("online",this._onWindowOnline,!1),y.addEventListener("resize",this._onWindowResize,!1),y.addEventListener("orientationchange",this._onWindowResize,!1),y.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),y.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new E7(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||D.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new ZZ(typeof t.hash=="string"&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){e.center==null&&e.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});let n=t.bounds;n&&(this.resize(),this.fitBounds(n,Ne({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new Hk({customAttribution:t.customAttribution})),this._logoControl=new Gk,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new Se(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new Se(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(t,e){if(e===void 0&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new Je(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let n=t.onAdd(this);this._controls.push(t);let o=this._controlPositions[e];return e.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new Je(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(t);return e>-1&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let e=!this._moving;return e&&this.fire(new Se("movestart",t)).fire(new Se("move",t)),this.fire(new Se("resize",t)),e&&this.fire(new Se("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(Gs.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new Se("zoomstart")).fire(new Se("zoom")).fire(new Se("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new Se("zoomstart")).fire(new Se("zoom")).fire(new Se("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new Se("pitchstart")).fire(new Se("pitch")).fire(new Se("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new Se("pitchstart")).fire(new Se("pitch")).fire(new Se("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return t==="auto"?y.navigator.language:Array.isArray(t)?t.length===0?void 0:t.map(e=>e==="auto"?y.navigator.language:e):t}setLanguage(t){let e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(let n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(t){return this._lazyInitEmptyStyle(),t?typeof t=="string"&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let t=this.transform,e=t.projection.name,n;e==="globe"&&t.zoom>=Uu?(t.setMercatorFromTransition(),n=!0):e==="mercator"&&t.zoom<Uu&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(t){let e;return e=t.name==="globe"&&this.transform.zoom>=Uu?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(Xt.convert(t))}unproject(t){return this.transform.pointLocation3D(X.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,n){if(t==="mouseenter"||t==="mouseover"){let o=!1,s=u=>{let d=e.filter(p=>this.getLayer(p)),f=d.length?this.queryRenderedFeatures(u.point,{layers:d}):[];f.length?o||(o=!0,n.call(this,new _a(t,this,u.originalEvent,{features:f}))):o=!1},l=()=>{o=!1};return{layers:new Set(e),listener:n,delegates:{mousemove:s,mouseout:l}}}if(t==="mouseleave"||t==="mouseout"){let o=!1,s=u=>{let d=e.filter(f=>this.getLayer(f));(d.length?this.queryRenderedFeatures(u.point,{layers:d}):[]).length?o=!0:o&&(o=!1,n.call(this,new _a(t,this,u.originalEvent)))},l=u=>{o&&(o=!1,n.call(this,new _a(t,this,u.originalEvent)))};return{layers:new Set(e),listener:n,delegates:{mousemove:s,mouseout:l}}}{let o=s=>{let l=e.filter(d=>this.getLayer(d)),u=l.length?this.queryRenderedFeatures(s.point,{layers:l}):[];u.length&&(s.features=u,n.call(this,s),delete s.features)};return{layers:new Set(e),listener:n,delegates:{[t]:o}}}}on(t,e,n){if(n===void 0)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e){for(let s of e)if(!this._isValidId(s))return this}let o=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(o);for(let s in o.delegates)this.on(s,o.delegates[s]);return this}once(t,e,n){if(n===void 0)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e){for(let s of e)if(!this._isValidId(s))return this}let o=this._createDelegatedListener(t,e,n);for(let s in o.delegates)this.once(s,o.delegates[s]);return this}off(t,e,n){if(n===void 0)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(let l of e)if(!this._isValidId(l))return this;let o=(l,u)=>{if(l.size!==u.size)return!1;for(let d of l)if(!u.has(d))return!1;return!0},s=this._delegatedListeners?this._delegatedListeners[t]:void 0;return s&&(l=>{for(let u=0;u<l.length;u++){let d=l[u];if(d.listener===n&&o(d.layers,e)){for(let f in d.delegates)this.off(f,d.delegates[f]);return l.splice(u,1),this}}})(s),this}queryRenderedFeatures(t,e){if(!this.style)return[];if(e!==void 0||t===void 0||t instanceof X||Array.isArray(t)||(e=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(e=e||{}).layers&&Array.isArray(e.layers)){for(let n of e.layers)if(!this._isValidId(n))return[]}return this.style.queryRenderedFeatures(t,e,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(t){let{name:e}=this.transform.projection;return e!=="globe"&&e!=="mercator"&&J(`${e} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(X.convert(t))}setStyle(t,e){return(e=Ne({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){let e=this._locale[t];if(e==null)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new xl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof t=="string"?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,e){if(typeof t=="string"){let n=this._requestManager.normalizeStyleURL(t),o=this._requestManager.transformRequest(n,ve.Style);Ge(o,(s,l)=>{s?this.fire(new Je(s)):l&&this._updateDiff(l,e)})}else typeof t=="object"&&this._updateDiff(t,e)}_updateDiff(t,e){try{this.style.setState(t)&&this._update(!0)}catch(n){J(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(J("There is no style added to the map."),!1)}_isValidId(t){return t==null?(this.fire(new Je(new Error("IDs can't be empty."))),!1):!zP(t)||(this.fire(new Je(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){let t=this.style&&this.style._sourceCaches;for(let e in t){let n=t[e]._tiles;for(let o in n){let s=n[o];if(s.state!=="loaded"&&s.state!=="errored")return!1}}return!0}addSourceType(t,e,n){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(t,e,{pixelRatio:n=1,sdf:o=!1,stretchX:s,stretchY:l,content:u}={}){if(this._lazyInitEmptyStyle(),e instanceof y.HTMLImageElement||y.ImageBitmap&&e instanceof y.ImageBitmap){let{width:d,height:f,data:p}=Zt.getImageData(e);this.style.addImage(t,{data:new qr({width:d,height:f},p),pixelRatio:n,stretchX:s,stretchY:l,content:u,sdf:o,version:0})}else if(e.width===void 0||e.height===void 0)this.fire(new Je(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:d,height:f}=e,p=e;this.style.addImage(t,{data:new qr({width:d,height:f},new Uint8Array(p.data)),pixelRatio:n,stretchX:s,stretchY:l,content:u,sdf:o,version:0,userImage:p}),p.onAdd&&p.onAdd(this,t)}}updateImage(t,e){this._lazyInitEmptyStyle();let n=this.style.getImage(t);if(!n)return void this.fire(new Je(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let o=e instanceof y.HTMLImageElement||y.ImageBitmap&&e instanceof y.ImageBitmap?Zt.getImageData(e):e,{width:s,height:l}=o;s!==void 0&&l!==void 0?s===n.data.width&&l===n.data.height?(n.data.replace(o.data,!(e instanceof y.HTMLImageElement||y.ImageBitmap&&e instanceof y.ImageBitmap)),this.style.updateImage(t,n)):this.fire(new Je(new Error(`The width and height of the updated image (${s}, ${l})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`))):this.fire(new Je(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new Je(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){Ft(this._requestManager.transformRequest(t,ve.Image),(n,o)=>{e(n,o instanceof y.HTMLImageElement?Zt.getImageData(o):o)})}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new Je(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,n){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,n),this._update(!0)):this}setFilter(t,e,n={}){return this._isValidId(t)?(this.style.setFilter(t,e,n),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,n,o={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,n,o),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,n,o={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,n,o),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,n){return this.style.setConfigProperty(t,e,n),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&t.length===1&&t[0].type==="flat"){let e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let t=this.style.getLights()||[];return t.length===0&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch(t["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Xt.convert(t),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;let t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300,n,o,s,l=this._container;for(;l&&(!o||!s);){let u=y.getComputedStyle(l).transform;u&&u!=="none"&&(n=u.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(o=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(s=n[3])),l=l.parentElement}this._containerWidth=o?Math.abs(t/o):t,this._containerHeight=s?Math.abs(e/s):e}_detectMissingCSS(){y.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&J("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=gn("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();let e=this._canvasContainer=gn("div","mapboxgl-canvas-container",t);this._canvas=gn("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let n=this._controlContainer=gn("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(s=>{o[s]=gn("div",`mapboxgl-ctrl-${s}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){let n=Zt.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){let e=this._markers.indexOf(t);e!==-1&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){let e=this._popups.indexOf(t);e!==-1&&this._popups.splice(e,1)}_setupPainter(){let t=Ne({},Vl.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",t);e?(La(e,!0),this.painter=new BZ(e,this._contextCreateOptions,this.transform),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),z.testSupport(e)):this.fire(new Je(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Se("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new Se("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(t){let e;this.fire(new Se("renderstart"));let n=this.painter.context.extTimerQuery,o=Zt.now(),s=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(e=s.createQuery(),s.beginQuery(n.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],y.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],y.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();let l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let f=this.transform.zoom,p=this.transform.pitch,g=Zt.now(),_=new ur(f,{now:g,fadeDuration:l,pitch:p,transition:this.style.transition});this.style.update(_)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let u=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),u=this._updateAverageElevation(o),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):u=this._updateAverageElevation(o),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Se("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Se("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),e){let f=Zt.now()-o;s.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{let p=s.getQueryParameter(e,s.QUERY_RESULT)/1e6;s.deleteQuery(e),this.fire(new Se("gpu-timing-frame",{cpuTime:f,gpuTime:p})),y.performance.mark("frame-gpu",{startTime:o,detail:{gpuTime:p}})},50)}if(this.listens("gpu-timing-layer")){let f=this.painter.collectGpuTimers();setTimeout(()=>{let p=this.painter.queryGpuTimers(f);this.fire(new Se("gpu-timing-layer",{layerTimes:p}))},50)}if(this.listens("gpu-timing-deferred-render")){let f=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let p=this.painter.queryGpuTimeDeferredRender(f);this.fire(new Se("gpu-timing-deferred-render",{gpuTime:p}))},50)}let d=this._sourcesDirty||this._styleDirty||this._placementDirty||u;if(d||this._repaint)this.triggerRepaint();else{let f=!this.isMoving()&&this.loaded();if(f&&(u=this._updateAverageElevation(o,!0)),u)this.triggerRepaint();else if(this._triggerFrame(!1),f&&(this.fire(new Se("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let p=this._calculateSpeedIndex();this.fire(new Se("speedindexcompleted",{speedIndex:p})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,hs.mark(ds.fullLoad),this._performanceMetricsCollection&&Rd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(let e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(let e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){let n=s=>(this.transform.averageElevation=s,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);let o=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(o||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){let s=this.transform.averageElevation,l=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(l)?l=0:this._averageElevationLastSampledAt=t;let u=Math.abs(s-l);if(u>1){if(this._isInitialLoad||o)return this._averageElevation.jumpTo(l),n(l);this._averageElevation.easeTo(l,t,300)}else if(u>1e-4)return this._averageElevation.jumpTo(l),n(l)}return!!this._averageElevation.isEasing(t)&&n(this._averageElevation.getValue(t))}_authenticate(){Cr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===on||t.status===401)){let e=this.painter.context.gl;La(e,!1),this._logoControl instanceof Gk&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Je(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),yf(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){let t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());let n=this.painter.context.gl,o=n.createFramebuffer();function s(l){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,l,0);let u=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,u),u}return n.bindFramebuffer(n.FRAMEBUFFER,o),this._canvasPixelComparison(s(t),e.canvasCopies.map(s),e.timeStamps)}_canvasPixelComparison(t,e,n){let o=n[1]-n[0],s=t.length/4;for(let l=0;l<e.length;l++){let u=e[l],d=0;for(let f=0;f<u.length;f+=4)u[f]===t[f]&&u[f+1]===t[f+1]&&u[f+2]===t[f+2]&&u[f+3]===t[f+3]&&(d+=1);o+=(n[l+2]-n[l+1])*(1-d/s)}return o}remove(){this._hash&&this._hash.remove();for(let e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),y!==void 0&&(y.removeEventListener("resize",this._onWindowResize,!1),y.removeEventListener("orientationchange",this._onWindowResize,!1),y.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),y.removeEventListener("online",this._onWindowOnline,!1),y.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),js.delete(this.painter.context.gl),this._removed=!0,this.fire(new Se("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=Zt.frame(e=>{let n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(e)}))}_preloadTiles(t){return Ji(this.style?Object.values(this.style._sourceCaches):[],(e,n)=>e._preloadTiles(t,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){y.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(t,e){(function(n,o){To=n,Eo=o})(t,e)}get version(){return w}},NavigationControl:class{constructor(t){this.options=Ne({},P7,t),this._container=gn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(gr(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),gn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),gn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(gr(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{let n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:e}):n.resetNorth({},{originalEvent:e}))}),this._compassIcon=gn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let t=this._map;if(!t)return;let e=t.getZoom(),n=e===t.getMaxZoom(),o=e===t.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())}_rotateCompassArrow(){let t=this._map;if(!t)return;let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new O7(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){let t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){let n=gn("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){if(!this._map)return;let n=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",n),t.firstElementChild&&t.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends vn{constructor(t){super(),this.options=Ne({geolocation:y.navigator.geolocation},R7,t),gr(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kk(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=gn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){let e=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,t(n)};this._supportsGeolocation!==void 0?t(this._supportsGeolocation):y.navigator.permissions!==void 0?y.navigator.permissions.query({name:"geolocation"}).then(n=>e(n.state!=="denied")).catch(()=>e()):e()}_isOutOfMapMaxBounds(t){let e=this._map.getMaxBounds(),n=t.coords;return!!e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new Se("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Se("geolocate",t)),this._finish()}}_updateCamera(t){let e=new Xt(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,o=Ne({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(n),o,{geolocateSource:!0})}_updateMarker(t){if(t){let e=new Xt(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let t=this._map.transform,e=Oi(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Se("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=gn("button","mapboxgl-ctrl-geolocate",this._container),gn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){J("Geolocation support is not available so the GeolocateControl will be disabled.");let e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{let e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=gn("div","mapboxgl-user-location"),this._dotElement.appendChild(gn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(gn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new iM({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=gn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new iM({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Se("trackuserlocationend")))})}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:t.absolute===!0&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return J("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Se("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Se("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Se("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let t=()=>{y.addEventListener("ondeviceorientationabsolute"in y?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};y.DeviceMotionEvent!==void 0&&typeof y.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(e=>{e==="granted"&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),y.removeEventListener("deviceorientation",this._onDeviceOrientation),y.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hk,ScaleControl:class{constructor(t){this.options=Ne({},L7,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),gr(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let t=this.options.maxWidth||100,e=this._map,n=e._containerHeight/2,o=e._containerWidth/2-t/2,s=e.unproject([o,n]),l=e.unproject([o+t,n]),u=s.distanceTo(l);if(this.options.unit==="imperial"){let d=3.2808*u;d>5280?this._setScale(t,d/5280,"mile"):this._setScale(t,d,"foot")}else this.options.unit==="nautical"?this._setScale(t,u/1852,"nautical-mile"):u>=1e3?this._setScale(t,u/1e3,"kilometer"):this._setScale(t,u,"meter")}_setScale(t,e,n){this._map._requestDomTask(()=>{let o=function(l){let u=Math.pow(10,`${Math.floor(l)}`.length-1),d=l/u;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(f){let p=Math.pow(10,Math.ceil(-Math.log(f)/Math.LN10));return Math.round(f*p)/p}(d),u*d}(e),s=o/e;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(o):`${o}&nbsp;${F7[n]}`,this._container.style.width=t*s+"px"})}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=gn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof y.HTMLElement?this._container=t.container:J("Full screen control 'container' must be a DOM element.")),gr(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in y.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=gn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",J("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,y.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!y.document.fullscreenEnabled&&!y.document.webkitFullscreenEnabled)}_setupUI(){let t=this._fullscreenButton=gn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);gn("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(y.document.fullscreenElement||y.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?y.document.exitFullscreen?y.document.exitFullscreen():y.document.webkitCancelFullScreen&&y.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends vn{constructor(t){super(),this.options=Ne(Object.create(I7),t),gr(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new Se("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new Se("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=Xt.convert(t),this._pos=null,this._trackPointer=!1,this._update();let e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(y.document.createTextNode(t))}setHTML(t){let e=y.document.createDocumentFragment(),n=y.document.createElement("body"),o;for(n.innerHTML=t;o=n.firstChild,o;)e.appendChild(o);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=gn("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){let n=this._closeButton=gn("button","mapboxgl-popup-close-button",e);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;let e=this._map,n=this._container,o=this._pos;if(!e||!n||!o)return"bottom";let s=n.offsetWidth,l=n.offsetHeight,u=o.x<s/2,d=o.x>e.transform.width-s/2;if(o.y+t<l)return u?"top-left":d?"top-right":"top";if(o.y>e.transform.height-l){if(u)return"bottom-left";if(d)return"bottom-right"}return u?"left":d?"right":"bottom"}_updateClassList(){let t=this._container;if(!t)return;let e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){let e=this._map,n=this._content;if(!e||!this._lngLat&&!this._trackPointer||!n)return;let o=this._container;if(o||(o=this._container=gn("div","mapboxgl-popup",e.getContainer()),this._tip=gn("div","mapboxgl-popup-tip",o),o.appendChild(n)),this.options.maxWidth&&o.style.maxWidth!==this.options.maxWidth&&(o.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=qk(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){let s=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),l=Zk(this.options.offset),u=this._anchor=this._getAnchor(l.y),d=Zk(this.options.offset,u),f=s.add(d).round();e._requestDomTask(()=>{this._container&&u&&(this._container.style.transform=`${nM[u]} translate(${f.x}px,${f.y}px)`)})}if(!this._marker&&e._showingGlobe()){let s=By(e.transform,this._lngLat)?0:1;this._setOpacity(s)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let t=this._container.querySelector(C7);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:iM,Style:xl,LngLat:Xt,LngLatBounds:Gs,Point:X,MercatorCoordinate:Fn,FreeCameraOptions:oL,Evented:vn,config:D,prewarm:function(){vg().acquire(CE)},clearPrewarmedResources:function(){let t=yg;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(CE),yg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return D.ACCESS_TOKEN},set accessToken(t){D.ACCESS_TOKEN=t},get baseApiUrl(){return D.API_URL},set baseApiUrl(t){D.API_URL=t},get workerCount(){return sp.workerCount},set workerCount(t){sp.workerCount=t},get maxParallelImageRequests(){return D.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){D.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){(function(e){if(!Ns())return;let n=y.caches.delete(wi);e&&n.catch(e).then(()=>e())})(t)},workerUrl:"",workerClass:null,get dracoUrl(){return xF()},set dracoUrl(t){(function(e){SE=Zt.resolveURL(e),DE||(DE=new Rv(vg(),new vn)),DE.broadcast("setDracoUrl",SE)})(t)},setNow:Zt.setNow,restoreNow:Zt.restoreNow};m.A=dF,m.D=iv,m.E=ne,m.F=XT,m.K=Vv,m.O=qn,m.P=X,m.T=AL,m.V=Jy,m.a=Ky,m.b=aR,m.c=Pv,m.d=class extends vn{constructor(t,e,n,o,s,l){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=s||yF,this.loading={},this.loaded={},this.deduped=new _F(t.scheduler),this.isSpriteLoaded=o,this.scheduler=t.scheduler,this.brightness=l}loadTile(t,e){let n=t.uid,o=t&&t.request,s=o&&o.collectResourceTiming,l=this.loading[n]=new tq(t);l.abort=this.loadVectorData(t,(u,d)=>{let f=!this.loading[n];if(delete this.loading[n],f||u||!d)return l.status="done",f||(this.loaded[n]=l),e(u);let p=d.rawData,g={};d.expires&&(g.expires=d.expires),d.cacheControl&&(g.cacheControl=d.cacheControl),l.vectorTile=d.vectorTile||new ZT(new nv(p));let _=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,(v,x)=>{if(v||!x)return e(v);let b={};if(s){let T=ua(o);T.length>0&&(b.resourceTiming=JSON.parse(JSON.stringify(T)))}e(null,Ne({rawTileData:p.slice(0)},x,g,b))})};this.isSpriteLoaded?_():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):_()}),this.loaded=this.loaded||{},this.loaded[n]=l})}reloadTile(t,e){let n=this.loaded,o=t.uid,s=this;if(n&&n[o]){let l=n[o];l.showCollisionBoxes=t.showCollisionBoxes,l.projection=t.projection,l.brightness=t.brightness,l.tileTransform=ah(t.tileID.canonical,t.projection),l.extraShadowCaster=t.extraShadowCaster;let u=(d,f)=>{let p=l.reloadCallback;p&&(delete l.reloadCallback,l.parse(l.vectorTile,s.layerIndex,this.availableImages,s.actor,p)),e(d,f)};l.status==="parsing"?l.reloadCallback=u:l.status==="done"&&(l.vectorTile?l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,u):u())}else e(null,void 0)}abortTile(t,e){let n=t.uid,o=this.loading[n];o&&(o.abort&&o.abort(),delete this.loading[n]),e()}removeTile(t,e){let n=this.loaded,o=t.uid;n&&n[o]&&delete n[o],e()}},m.e=Ou,m.f=ua,m.g=Ve,m.h=Ge,m.i=Qe,m.j=function(t,e){let n=FE(t);for(let o of n){for(let s of o.meshes)dq(s);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(hq(o.lights,e)))}return n},m.k=ur,m.l=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==wF){let n=new Uint32Array(t,0,7),[,,o,s,l,u]=n;e=n.byteLength+s+l+u+l,(o!==t.byteLength||e>=t.byteLength)&&J("Invalid b3dm header information.")}return IF(t,e)},m.m=hv,m.n=Ba,m.o=Se,m.p=Wn,m.q=function(t){ro(),Ai&&Ai.then(e=>{e.keys().then(n=>{for(let o=0;o<n.length-t;o++)e.delete(n[o])})})},m.r=PF,m.s=i0,m.t=Zm,m.v=wr,m.w=y}),c(["./shared"],function(m){"use strict";function y(Ae){if(typeof Ae=="number"||typeof Ae=="boolean"||typeof Ae=="string"||Ae==null)return JSON.stringify(Ae);if(Array.isArray(Ae)){let W="[";for(let J of Ae)W+=`${y(J)},`;return`${W}]`}let $="{";for(let W of Object.keys(Ae).sort())$+=`${W}:${y(Ae[W])},`;return`${$}}`}function w(Ae){let $="";for(let W of m.r)$+=`/${y(Ae[W])}`;return $}class C{constructor($){this.keyCache={},this._layers={},this._layerConfigs={},$&&this.replace($)}replace($,W){this._layerConfigs={},this._layers={},this.update($,[],W)}update($,W,J){this._options=J;for(let De of $){this._layerConfigs[De.id]=De;let it=this._layers[De.id]=m.c(De,this._options);it.setScope(this.scope),it.compileFilter(),this.keyCache[De.id]&&delete this.keyCache[De.id]}for(let De of W)delete this.keyCache[De],delete this._layerConfigs[De],delete this._layers[De];this.familiesBySource={};let we=function(De,it){let ht={};for(let Et=0;Et<De.length;Et++){let Dt=it&&it[De[Et].id]||w(De[Et]);it&&(it[De[Et].id]=Dt);let zt=ht[Dt];zt||(zt=ht[Dt]=[]),zt.push(De[Et])}let Re=[];for(let Et in ht)Re.push(ht[Et]);return Re}(m.v(this._layerConfigs),this.keyCache);for(let De of we){let it=De.map(li=>this._layers[li.id]),ht=it[0];if(ht.visibility==="none")continue;let Re=ht.source||"",Et=this.familiesBySource[Re];Et||(Et=this.familiesBySource[Re]={});let Dt=ht.sourceLayer||"_geojsonTileLayer",zt=Et[Dt];zt||(zt=Et[Dt]=[]),zt.push(it)}}}class D{loadTile($,W){let{uid:J,encoding:we,rawImageData:De,padding:it}=$,ht=m.w.ImageBitmap&&De instanceof m.w.ImageBitmap?this.getImageData(De,it):De;W(null,new m.D(J,ht,we,it<1))}getImageData($,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);let J=this.offscreenCanvasContext.getImageData(-W,-W,$.width+2*W,$.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}function z(Ae,$){if(Ae.length!==0){j(Ae[0],$);for(var W=1;W<Ae.length;W++)j(Ae[W],!$)}}function j(Ae,$){for(var W=0,J=0,we=0,De=Ae.length,it=De-1;we<De;it=we++){var ht=(Ae[we][0]-Ae[it][0])*(Ae[it][1]+Ae[we][1]),Re=W+ht;J+=Math.abs(W)>=Math.abs(ht)?W-Re+ht:ht-Re+W,W=Re}W+J>=0!=!!$&&Ae.reverse()}var ie=m.g(function Ae($,W){var J,we=$&&$.type;if(we==="FeatureCollection")for(J=0;J<$.features.length;J++)Ae($.features[J],W);else if(we==="GeometryCollection")for(J=0;J<$.geometries.length;J++)Ae($.geometries[J],W);else if(we==="Feature")Ae($.geometry,W);else if(we==="Polygon")z($.coordinates,W);else if(we==="MultiPolygon")for(J=0;J<$.coordinates.length;J++)z($.coordinates[J],W);return $});let oe=m.V.prototype.toGeoJSON;var he={exports:{}},ke=m.p,rt=m.a.VectorTileFeature,Ve=Ot;function Ot(Ae,$){this.options=$||{},this.features=Ae,this.length=Ae.length}function hn(Ae,$){this.id=typeof Ae.id=="number"?Ae.id:void 0,this.type=Ae.type,this.rawGeometry=Ae.type===1?[Ae.geometry]:Ae.geometry,this.properties=Ae.tags,this.extent=$||4096}Ot.prototype.feature=function(Ae){return new hn(this.features[Ae],this.options.extent)},hn.prototype.loadGeometry=function(){var Ae=this.rawGeometry;this.geometry=[];for(var $=0;$<Ae.length;$++){for(var W=Ae[$],J=[],we=0;we<W.length;we++)J.push(new ke(W[we][0],W[we][1]));this.geometry.push(J)}return this.geometry},hn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ae=this.geometry,$=1/0,W=-1/0,J=1/0,we=-1/0,De=0;De<Ae.length;De++)for(var it=Ae[De],ht=0;ht<it.length;ht++){var Re=it[ht];$=Math.min($,Re.x),W=Math.max(W,Re.x),J=Math.min(J,Re.y),we=Math.max(we,Re.y)}return[$,J,W,we]},hn.prototype.toGeoJSON=rt.prototype.toGeoJSON;var Qt=m.b,Wn=Ve;function Kn(Ae){var $=new Qt;return function(W,J){for(var we in W.layers)J.writeMessage(3,X,W.layers[we])}(Ae,$),$.finish()}function X(Ae,$){var W;$.writeVarintField(15,Ae.version||1),$.writeStringField(1,Ae.name||""),$.writeVarintField(5,Ae.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<Ae.length;W++)J.feature=Ae.feature(W),$.writeMessage(2,Rt,J);var we=J.keys;for(W=0;W<we.length;W++)$.writeStringField(3,we[W]);var De=J.values;for(W=0;W<De.length;W++)$.writeMessage(4,Pa,De[W])}function Rt(Ae,$){var W=Ae.feature;W.id!==void 0&&$.writeVarintField(1,W.id),$.writeMessage(2,bo,Ae),$.writeVarintField(3,W.type),$.writeMessage(4,xi,W)}function bo(Ae,$){var W=Ae.feature,J=Ae.keys,we=Ae.values,De=Ae.keycache,it=Ae.valuecache;for(var ht in W.properties){var Re=W.properties[ht],Et=De[ht];if(Re!==null){Et===void 0&&(J.push(ht),De[ht]=Et=J.length-1),$.writeVarint(Et);var Dt=typeof Re;Dt!=="string"&&Dt!=="boolean"&&Dt!=="number"&&(Re=JSON.stringify(Re));var zt=Dt+":"+Re,li=it[zt];li===void 0&&(we.push(Re),it[zt]=li=we.length-1),$.writeVarint(li)}}}function ar(Ae,$){return($<<3)+(7&Ae)}function Vt(Ae){return Ae<<1^Ae>>31}function xi(Ae,$){for(var W=Ae.loadGeometry(),J=Ae.type,we=0,De=0,it=W.length,ht=0;ht<it;ht++){var Re=W[ht],Et=1;J===1&&(Et=Re.length),$.writeVarint(ar(1,Et));for(var Dt=J===3?Re.length-1:Re.length,zt=0;zt<Dt;zt++){zt===1&&J!==1&&$.writeVarint(ar(2,Dt-1));var li=Re[zt].x-we,Ni=Re[zt].y-De;$.writeVarint(Vt(li)),$.writeVarint(Vt(Ni)),we+=li,De+=Ni}J===3&&$.writeVarint(ar(7,1))}}function Pa(Ae,$){var W=typeof Ae;W==="string"?$.writeStringField(1,Ae):W==="boolean"?$.writeBooleanField(7,Ae):W==="number"&&(Ae%1!=0?$.writeDoubleField(3,Ae):Ae<0?$.writeSVarintField(6,Ae):$.writeVarintField(5,Ae))}he.exports=Kn,he.exports.fromVectorTileJs=Kn,he.exports.fromGeojsonVt=function(Ae,$){$=$||{};var W={};for(var J in Ae)W[J]=new Wn(Ae[J].features,$),W[J].name=J,W[J].version=$.version,W[J].extent=$.extent;return Kn({layers:W})},he.exports.GeoJSONWrapper=Wn;var Ko=m.g(he.exports);let Oa={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},Pt=Math.fround||(Ut=new Float32Array(1),Ae=>(Ut[0]=+Ae,Ut[0]));var Ut;let jt=3,ze=5,Si=6;class bi{constructor($){this.options=Object.assign(Object.create(Oa),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){let{log:W,minZoom:J,maxZoom:we}=this.options;W&&console.time("total time");let De=`prepare ${$.length} points`;W&&console.time(De),this.points=$;let it=[];for(let Re=0;Re<$.length;Re++){let Et=$[Re];if(!Et.geometry)continue;let[Dt,zt]=Et.geometry.coordinates,li=Pt(Ne(Dt)),Ni=Pt(wo(zt));it.push(li,Ni,1/0,Re,-1,1),this.options.reduce&&it.push(0)}let ht=this.trees[we+1]=this._createTree(it);W&&console.timeEnd(De);for(let Re=we;Re>=J;Re--){let Et=+Date.now();ht=this.trees[Re]=this._createTree(this._cluster(ht,Re)),W&&console.log("z%d: %d clusters in %dms",Re,ht.numItems,+Date.now()-Et)}return W&&console.timeEnd("total time"),this}getClusters($,W){let J=(($[0]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,$[1])),De=$[2]===180?180:(($[2]+180)%360+360)%360-180,it=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)J=-180,De=180;else if(J>De){let zt=this.getClusters([J,we,180,it],W),li=this.getClusters([-180,we,De,it],W);return zt.concat(li)}let ht=this.trees[this._limitZoom(W)],Re=ht.range(Ne(J),wo(it),Ne(De),wo(we)),Et=ht.data,Dt=[];for(let zt of Re){let li=this.stride*zt;Dt.push(Et[li+ze]>1?Ji(Et,li,this.clusterProps):this.points[Et[li+jt]])}return Dt}getChildren($){let W=this._getOriginId($),J=this._getOriginZoom($),we="No cluster with the specified id.",De=this.trees[J];if(!De)throw new Error(we);let it=De.data;if(W*this.stride>=it.length)throw new Error(we);let ht=this.options.radius/(this.options.extent*Math.pow(2,J-1)),Re=De.within(it[W*this.stride],it[W*this.stride+1],ht),Et=[];for(let Dt of Re){let zt=Dt*this.stride;it[zt+4]===$&&Et.push(it[zt+ze]>1?Ji(it,zt,this.clusterProps):this.points[it[zt+jt]])}if(Et.length===0)throw new Error(we);return Et}getLeaves($,W,J){let we=[];return this._appendLeaves(we,$,W=W||10,J=J||0,0),we}getTile($,W,J){let we=this.trees[this._limitZoom($)],De=Math.pow(2,$),{extent:it,radius:ht}=this.options,Re=ht/it,Et=(J-Re)/De,Dt=(J+1+Re)/De,zt={features:[]};return this._addTileFeatures(we.range((W-Re)/De,Et,(W+1+Re)/De,Dt),we.data,W,J,De,zt),W===0&&this._addTileFeatures(we.range(1-Re/De,Et,1,Dt),we.data,De,J,De,zt),W===De-1&&this._addTileFeatures(we.range(0,Et,Re/De,Dt),we.data,-1,J,De,zt),zt.features.length?zt:null}getClusterExpansionZoom($){let W=this._getOriginZoom($)-1;for(;W<=this.options.maxZoom;){let J=this.getChildren($);if(W++,J.length!==1)break;$=J[0].properties.cluster_id}return W}_appendLeaves($,W,J,we,De){let it=this.getChildren(W);for(let ht of it){let Re=ht.properties;if(Re&&Re.cluster?De+Re.point_count<=we?De+=Re.point_count:De=this._appendLeaves($,Re.cluster_id,J,we,De):De<we?De++:$.push(ht),$.length===J)break}return De}_createTree($){let W=new m.K($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<$.length;J+=this.stride)W.add($[J],$[J+1]);return W.finish(),W.data=$,W}_addTileFeatures($,W,J,we,De,it){for(let ht of $){let Re=ht*this.stride,Et=W[Re+ze]>1,Dt,zt,li;if(Et)Dt=wr(W,Re,this.clusterProps),zt=W[Re],li=W[Re+1];else{let Di=this.points[W[Re+jt]];Dt=Di.properties;let[Hi,wi]=Di.geometry.coordinates;zt=Ne(Hi),li=wo(wi)}let Ni={type:1,geometry:[[Math.round(this.options.extent*(zt*De-J)),Math.round(this.options.extent*(li*De-we))]],tags:Dt},Qi;Qi=Et||this.options.generateId?W[Re+jt]:this.points[W[Re+jt]].id,Qi!==void 0&&(Ni.id=Qi),it.features.push(Ni)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,W){let{radius:J,extent:we,reduce:De,minPoints:it}=this.options,ht=J/(we*Math.pow(2,W)),Re=$.data,Et=[],Dt=this.stride;for(let zt=0;zt<Re.length;zt+=Dt){if(Re[zt+2]<=W)continue;Re[zt+2]=W;let li=Re[zt],Ni=Re[zt+1],Qi=$.within(Re[zt],Re[zt+1],ht),Di=Re[zt+ze],Hi=Di;for(let wi of Qi){let To=wi*Dt;Re[To+2]>W&&(Hi+=Re[To+ze])}if(Hi>Di&&Hi>=it){let wi,To=li*Di,Eo=Ni*Di,Ai=-1,Uo=((zt/Dt|0)<<5)+(W+1)+this.points.length;for(let Ns of Qi){let ro=Ns*Dt;if(Re[ro+2]<=W)continue;Re[ro+2]=W;let zs=Re[ro+ze];To+=Re[ro]*zs,Eo+=Re[ro+1]*zs,Re[ro+4]=Uo,De&&(wi||(wi=this._map(Re,zt,!0),Ai=this.clusterProps.length,this.clusterProps.push(wi)),De(wi,this._map(Re,ro)))}Re[zt+4]=Uo,Et.push(To/Hi,Eo/Hi,1/0,Uo,-1,Hi),De&&Et.push(Ai)}else{for(let wi=0;wi<Dt;wi++)Et.push(Re[zt+wi]);if(Hi>1)for(let wi of Qi){let To=wi*Dt;if(!(Re[To+2]<=W)){Re[To+2]=W;for(let Eo=0;Eo<Dt;Eo++)Et.push(Re[To+Eo])}}}}return Et}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,W,J){if($[W+ze]>1){let it=this.clusterProps[$[W+Si]];return J?Object.assign({},it):it}let we=this.points[$[W+jt]].properties,De=this.options.map(we);return J&&De===we?Object.assign({},De):De}}function Ji(Ae,$,W){return{type:"Feature",id:Ae[$+jt],properties:wr(Ae,$,W),geometry:{type:"Point",coordinates:[(J=Ae[$],360*(J-.5)),la(Ae[$+1])]}};var J}function wr(Ae,$,W){let J=Ae[$+ze],we=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,De=Ae[$+Si],it=De===-1?{}:Object.assign({},W[De]);return Object.assign(it,{cluster:!0,cluster_id:Ae[$+jt],point_count:J,point_count_abbreviated:we})}function Ne(Ae){return Ae/360+.5}function wo(Ae){let $=Math.sin(Ae*Math.PI/180),W=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return W<0?0:W>1?1:W}function la(Ae){let $=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}var pi={exports:{}};pi.exports=function(){function Ae(ve,Ce,Le,Ue){for(var Ge,Qe=Ue,nt=Le-Ce>>1,Ye=Le-Ce,ut=ve[Ce],Be=ve[Ce+1],Ft=ve[Le],on=ve[Le+1],Mt=Ce+3;Mt<Le;Mt+=3){var qt=$(ve[Mt],ve[Mt+1],ut,Be,Ft,on);if(qt>Qe)Ge=Mt,Qe=qt;else if(qt===Qe){var ci=Math.abs(Mt-nt);ci<Ye&&(Ge=Mt,Ye=ci)}}Qe>Ue&&(Ge-Ce>3&&Ae(ve,Ce,Ge,Ue),ve[Ge+2]=Qe,Le-Ge>3&&Ae(ve,Ge,Le,Ue))}function $(ve,Ce,Le,Ue,Ge,Qe){var nt=Ge-Le,Ye=Qe-Ue;if(nt!==0||Ye!==0){var ut=((ve-Le)*nt+(Ce-Ue)*Ye)/(nt*nt+Ye*Ye);ut>1?(Le=Ge,Ue=Qe):ut>0&&(Le+=nt*ut,Ue+=Ye*ut)}return(nt=ve-Le)*nt+(Ye=Ce-Ue)*Ye}function W(ve,Ce,Le,Ue){var Ge={id:ve===void 0?null:ve,type:Ce,geometry:Le,tags:Ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Qe){var nt=Qe.geometry,Ye=Qe.type;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")J(Qe,nt);else if(Ye==="Polygon"||Ye==="MultiLineString")for(var ut=0;ut<nt.length;ut++)J(Qe,nt[ut]);else if(Ye==="MultiPolygon")for(ut=0;ut<nt.length;ut++)for(var Be=0;Be<nt[ut].length;Be++)J(Qe,nt[ut][Be])}(Ge),Ge}function J(ve,Ce){for(var Le=0;Le<Ce.length;Le+=3)ve.minX=Math.min(ve.minX,Ce[Le]),ve.minY=Math.min(ve.minY,Ce[Le+1]),ve.maxX=Math.max(ve.maxX,Ce[Le]),ve.maxY=Math.max(ve.maxY,Ce[Le+1])}function we(ve,Ce,Le,Ue){if(Ce.geometry){var Ge=Ce.geometry.coordinates,Qe=Ce.geometry.type,nt=Math.pow(Le.tolerance/((1<<Le.maxZoom)*Le.extent),2),Ye=[],ut=Ce.id;if(Le.promoteId?ut=Ce.properties[Le.promoteId]:Le.generateId&&(ut=Ue||0),Qe==="Point")De(Ge,Ye);else if(Qe==="MultiPoint")for(var Be=0;Be<Ge.length;Be++)De(Ge[Be],Ye);else if(Qe==="LineString")it(Ge,Ye,nt,!1);else if(Qe==="MultiLineString"){if(Le.lineMetrics){for(Be=0;Be<Ge.length;Be++)it(Ge[Be],Ye=[],nt,!1),ve.push(W(ut,"LineString",Ye,Ce.properties));return}ht(Ge,Ye,nt,!1)}else if(Qe==="Polygon")ht(Ge,Ye,nt,!0);else{if(Qe!=="MultiPolygon"){if(Qe==="GeometryCollection"){for(Be=0;Be<Ce.geometry.geometries.length;Be++)we(ve,{id:ut,geometry:Ce.geometry.geometries[Be],properties:Ce.properties},Le,Ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Be=0;Be<Ge.length;Be++){var Ft=[];ht(Ge[Be],Ft,nt,!0),Ye.push(Ft)}}ve.push(W(ut,Qe,Ye,Ce.properties))}}function De(ve,Ce){Ce.push(Re(ve[0])),Ce.push(Et(ve[1])),Ce.push(0)}function it(ve,Ce,Le,Ue){for(var Ge,Qe,nt=0,Ye=0;Ye<ve.length;Ye++){var ut=Re(ve[Ye][0]),Be=Et(ve[Ye][1]);Ce.push(ut),Ce.push(Be),Ce.push(0),Ye>0&&(nt+=Ue?(Ge*Be-ut*Qe)/2:Math.sqrt(Math.pow(ut-Ge,2)+Math.pow(Be-Qe,2))),Ge=ut,Qe=Be}var Ft=Ce.length-3;Ce[2]=1,Ae(Ce,0,Ft,Le),Ce[Ft+2]=1,Ce.size=Math.abs(nt),Ce.start=0,Ce.end=Ce.size}function ht(ve,Ce,Le,Ue){for(var Ge=0;Ge<ve.length;Ge++){var Qe=[];it(ve[Ge],Qe,Le,Ue),Ce.push(Qe)}}function Re(ve){return ve/360+.5}function Et(ve){var Ce=Math.sin(ve*Math.PI/180),Le=.5-.25*Math.log((1+Ce)/(1-Ce))/Math.PI;return Le<0?0:Le>1?1:Le}function Dt(ve,Ce,Le,Ue,Ge,Qe,nt,Ye){if(Ue/=Ce,Qe>=(Le/=Ce)&&nt<Ue)return ve;if(nt<Le||Qe>=Ue)return null;for(var ut=[],Be=0;Be<ve.length;Be++){var Ft=ve[Be],on=Ft.geometry,Mt=Ft.type,qt=Ge===0?Ft.minX:Ft.minY,ci=Ge===0?Ft.maxX:Ft.maxY;if(qt>=Le&&ci<Ue)ut.push(Ft);else if(!(ci<Le||qt>=Ue)){var Gi=[];if(Mt==="Point"||Mt==="MultiPoint")zt(on,Gi,Le,Ue,Ge);else if(Mt==="LineString")li(on,Gi,Le,Ue,Ge,!1,Ye.lineMetrics);else if(Mt==="MultiLineString")Qi(on,Gi,Le,Ue,Ge,!1);else if(Mt==="Polygon")Qi(on,Gi,Le,Ue,Ge,!0);else if(Mt==="MultiPolygon")for(var er=0;er<on.length;er++){var zr=[];Qi(on[er],zr,Le,Ue,Ge,!0),zr.length&&Gi.push(zr)}if(Gi.length){if(Ye.lineMetrics&&Mt==="LineString"){for(er=0;er<Gi.length;er++)ut.push(W(Ft.id,Mt,Gi[er],Ft.tags));continue}Mt!=="LineString"&&Mt!=="MultiLineString"||(Gi.length===1?(Mt="LineString",Gi=Gi[0]):Mt="MultiLineString"),Mt!=="Point"&&Mt!=="MultiPoint"||(Mt=Gi.length===3?"Point":"MultiPoint"),ut.push(W(Ft.id,Mt,Gi,Ft.tags))}}}return ut.length?ut:null}function zt(ve,Ce,Le,Ue,Ge){for(var Qe=0;Qe<ve.length;Qe+=3){var nt=ve[Qe+Ge];nt>=Le&&nt<=Ue&&(Ce.push(ve[Qe]),Ce.push(ve[Qe+1]),Ce.push(ve[Qe+2]))}}function li(ve,Ce,Le,Ue,Ge,Qe,nt){for(var Ye,ut,Be=Ni(ve),Ft=Ge===0?Hi:wi,on=ve.start,Mt=0;Mt<ve.length-3;Mt+=3){var qt=ve[Mt],ci=ve[Mt+1],Gi=ve[Mt+2],er=ve[Mt+3],zr=ve[Mt+4],ns=Ge===0?qt:ci,Br=Ge===0?er:zr,Pi=!1;nt&&(Ye=Math.sqrt(Math.pow(qt-er,2)+Math.pow(ci-zr,2))),ns<Le?Br>Le&&(ut=Ft(Be,qt,ci,er,zr,Le),nt&&(Be.start=on+Ye*ut)):ns>Ue?Br<Ue&&(ut=Ft(Be,qt,ci,er,zr,Ue),nt&&(Be.start=on+Ye*ut)):Di(Be,qt,ci,Gi),Br<Le&&ns>=Le&&(ut=Ft(Be,qt,ci,er,zr,Le),Pi=!0),Br>Ue&&ns<=Ue&&(ut=Ft(Be,qt,ci,er,zr,Ue),Pi=!0),!Qe&&Pi&&(nt&&(Be.end=on+Ye*ut),Ce.push(Be),Be=Ni(ve)),nt&&(on+=Ye)}var Ir=ve.length-3;qt=ve[Ir],ci=ve[Ir+1],Gi=ve[Ir+2],(ns=Ge===0?qt:ci)>=Le&&ns<=Ue&&Di(Be,qt,ci,Gi),Ir=Be.length-3,Qe&&Ir>=3&&(Be[Ir]!==Be[0]||Be[Ir+1]!==Be[1])&&Di(Be,Be[0],Be[1],Be[2]),Be.length&&Ce.push(Be)}function Ni(ve){var Ce=[];return Ce.size=ve.size,Ce.start=ve.start,Ce.end=ve.end,Ce}function Qi(ve,Ce,Le,Ue,Ge,Qe){for(var nt=0;nt<ve.length;nt++)li(ve[nt],Ce,Le,Ue,Ge,Qe,!1)}function Di(ve,Ce,Le,Ue){ve.push(Ce),ve.push(Le),ve.push(Ue)}function Hi(ve,Ce,Le,Ue,Ge,Qe){var nt=(Qe-Ce)/(Ue-Ce);return ve.push(Qe),ve.push(Le+(Ge-Le)*nt),ve.push(1),nt}function wi(ve,Ce,Le,Ue,Ge,Qe){var nt=(Qe-Le)/(Ge-Le);return ve.push(Ce+(Ue-Ce)*nt),ve.push(Qe),ve.push(1),nt}function To(ve,Ce){for(var Le=[],Ue=0;Ue<ve.length;Ue++){var Ge,Qe=ve[Ue],nt=Qe.type;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")Ge=Eo(Qe.geometry,Ce);else if(nt==="MultiLineString"||nt==="Polygon"){Ge=[];for(var Ye=0;Ye<Qe.geometry.length;Ye++)Ge.push(Eo(Qe.geometry[Ye],Ce))}else if(nt==="MultiPolygon")for(Ge=[],Ye=0;Ye<Qe.geometry.length;Ye++){for(var ut=[],Be=0;Be<Qe.geometry[Ye].length;Be++)ut.push(Eo(Qe.geometry[Ye][Be],Ce));Ge.push(ut)}Le.push(W(Qe.id,nt,Ge,Qe.tags))}return Le}function Eo(ve,Ce){var Le=[];Le.size=ve.size,ve.start!==void 0&&(Le.start=ve.start,Le.end=ve.end);for(var Ue=0;Ue<ve.length;Ue+=3)Le.push(ve[Ue]+Ce,ve[Ue+1],ve[Ue+2]);return Le}function Ai(ve,Ce){if(ve.transformed)return ve;var Le,Ue,Ge,Qe=1<<ve.z,nt=ve.x,Ye=ve.y;for(Le=0;Le<ve.features.length;Le++){var ut=ve.features[Le],Be=ut.geometry,Ft=ut.type;if(ut.geometry=[],Ft===1)for(Ue=0;Ue<Be.length;Ue+=2)ut.geometry.push(Uo(Be[Ue],Be[Ue+1],Ce,Qe,nt,Ye));else for(Ue=0;Ue<Be.length;Ue++){var on=[];for(Ge=0;Ge<Be[Ue].length;Ge+=2)on.push(Uo(Be[Ue][Ge],Be[Ue][Ge+1],Ce,Qe,nt,Ye));ut.geometry.push(on)}}return ve.transformed=!0,ve}function Uo(ve,Ce,Le,Ue,Ge,Qe){return[Math.round(Le*(ve*Ue-Ge)),Math.round(Le*(Ce*Ue-Qe))]}function Ns(ve,Ce,Le,Ue,Ge){for(var Qe=Ce===Ge.maxZoom?0:Ge.tolerance/((1<<Ce)*Ge.extent),nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Le,y:Ue,z:Ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ye=0;Ye<ve.length;Ye++){nt.numFeatures++,ro(nt,ve[Ye],Qe,Ge);var ut=ve[Ye].minX,Be=ve[Ye].minY,Ft=ve[Ye].maxX,on=ve[Ye].maxY;ut<nt.minX&&(nt.minX=ut),Be<nt.minY&&(nt.minY=Be),Ft>nt.maxX&&(nt.maxX=Ft),on>nt.maxY&&(nt.maxY=on)}return nt}function ro(ve,Ce,Le,Ue){var Ge=Ce.geometry,Qe=Ce.type,nt=[];if(Qe==="Point"||Qe==="MultiPoint")for(var Ye=0;Ye<Ge.length;Ye+=3)nt.push(Ge[Ye]),nt.push(Ge[Ye+1]),ve.numPoints++,ve.numSimplified++;else if(Qe==="LineString")zs(nt,Ge,ve,Le,!1,!1);else if(Qe==="MultiLineString"||Qe==="Polygon")for(Ye=0;Ye<Ge.length;Ye++)zs(nt,Ge[Ye],ve,Le,Qe==="Polygon",Ye===0);else if(Qe==="MultiPolygon")for(var ut=0;ut<Ge.length;ut++){var Be=Ge[ut];for(Ye=0;Ye<Be.length;Ye++)zs(nt,Be[Ye],ve,Le,!0,Ye===0)}if(nt.length){var Ft=Ce.tags||null;if(Qe==="LineString"&&Ue.lineMetrics){for(var on in Ft={},Ce.tags)Ft[on]=Ce.tags[on];Ft.mapbox_clip_start=Ge.start/Ge.size,Ft.mapbox_clip_end=Ge.end/Ge.size}var Mt={geometry:nt,type:Qe==="Polygon"||Qe==="MultiPolygon"?3:Qe==="LineString"||Qe==="MultiLineString"?2:1,tags:Ft};Ce.id!==null&&(Mt.id=Ce.id),ve.features.push(Mt)}}function zs(ve,Ce,Le,Ue,Ge,Qe){var nt=Ue*Ue;if(Ue>0&&Ce.size<(Ge?nt:Ue))Le.numPoints+=Ce.length/3;else{for(var Ye=[],ut=0;ut<Ce.length;ut+=3)(Ue===0||Ce[ut+2]>nt)&&(Le.numSimplified++,Ye.push(Ce[ut]),Ye.push(Ce[ut+1])),Le.numPoints++;Ge&&function(Be,Ft){for(var on=0,Mt=0,qt=Be.length,ci=qt-2;Mt<qt;ci=Mt,Mt+=2)on+=(Be[Mt]-Be[ci])*(Be[Mt+1]+Be[ci+1]);if(on>0===Ft)for(Mt=0,qt=Be.length;Mt<qt/2;Mt+=2){var Gi=Be[Mt],er=Be[Mt+1];Be[Mt]=Be[qt-2-Mt],Be[Mt+1]=Be[qt-1-Mt],Be[qt-2-Mt]=Gi,Be[qt-1-Mt]=er}}(Ye,Qe),ve.push(Ye)}}function Ts(ve,Ce){var Le=(Ce=this.options=function(Ge,Qe){for(var nt in Qe)Ge[nt]=Qe[nt];return Ge}(Object.create(this.options),Ce)).debug;if(Le&&console.time("preprocess data"),Ce.maxZoom<0||Ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ce.promoteId&&Ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ue=function(Ge,Qe){var nt=[];if(Ge.type==="FeatureCollection")for(var Ye=0;Ye<Ge.features.length;Ye++)we(nt,Ge.features[Ye],Qe,Ye);else we(nt,Ge.type==="Feature"?Ge:{geometry:Ge},Qe);return nt}(ve,Ce);this.tiles={},this.tileCoords=[],Le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ce.indexMaxZoom,Ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ue=function(Ge,Qe){var nt=Qe.buffer/Qe.extent,Ye=Ge,ut=Dt(Ge,1,-1-nt,nt,0,-1,2,Qe),Be=Dt(Ge,1,1-nt,2+nt,0,-1,2,Qe);return(ut||Be)&&(Ye=Dt(Ge,1,-nt,1+nt,0,-1,2,Qe)||[],ut&&(Ye=To(ut,1).concat(Ye)),Be&&(Ye=Ye.concat(To(Be,-1)))),Ye}(Ue,Ce)).length&&this.splitTile(Ue,0,0,0),Le&&(Ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ko(ve,Ce,Le){return 32*((1<<ve)*Le+Ce)+ve}return Ts.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ts.prototype.splitTile=function(ve,Ce,Le,Ue,Ge,Qe,nt){for(var Ye=[ve,Ce,Le,Ue],ut=this.options,Be=ut.debug;Ye.length;){Ue=Ye.pop(),Le=Ye.pop(),Ce=Ye.pop(),ve=Ye.pop();var Ft=1<<Ce,on=ko(Ce,Le,Ue),Mt=this.tiles[on];if(!Mt&&(Be>1&&console.time("creation"),Mt=this.tiles[on]=Ns(ve,Ce,Le,Ue,ut),this.tileCoords.push({z:Ce,x:Le,y:Ue}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ce,Le,Ue,Mt.numFeatures,Mt.numPoints,Mt.numSimplified),console.timeEnd("creation"));var qt="z"+Ce;this.stats[qt]=(this.stats[qt]||0)+1,this.total++}if(Mt.source=ve,Ge){if(Ce===ut.maxZoom||Ce===Ge)continue;var ci=1<<Ge-Ce;if(Le!==Math.floor(Qe/ci)||Ue!==Math.floor(nt/ci))continue}else if(Ce===ut.indexMaxZoom||Mt.numPoints<=ut.indexMaxPoints)continue;if(Mt.source=null,ve.length!==0){Be>1&&console.time("clipping");var Gi,er,zr,ns,Br,Pi,Ir=.5*ut.buffer/ut.extent,Ra=.5-Ir,Bs=.5+Ir,us=1+Ir;Gi=er=zr=ns=null,Br=Dt(ve,Ft,Le-Ir,Le+Bs,0,Mt.minX,Mt.maxX,ut),Pi=Dt(ve,Ft,Le+Ra,Le+us,0,Mt.minX,Mt.maxX,ut),ve=null,Br&&(Gi=Dt(Br,Ft,Ue-Ir,Ue+Bs,1,Mt.minY,Mt.maxY,ut),er=Dt(Br,Ft,Ue+Ra,Ue+us,1,Mt.minY,Mt.maxY,ut),Br=null),Pi&&(zr=Dt(Pi,Ft,Ue-Ir,Ue+Bs,1,Mt.minY,Mt.maxY,ut),ns=Dt(Pi,Ft,Ue+Ra,Ue+us,1,Mt.minY,Mt.maxY,ut),Pi=null),Be>1&&console.timeEnd("clipping"),Ye.push(Gi||[],Ce+1,2*Le,2*Ue),Ye.push(er||[],Ce+1,2*Le,2*Ue+1),Ye.push(zr||[],Ce+1,2*Le+1,2*Ue),Ye.push(ns||[],Ce+1,2*Le+1,2*Ue+1)}}},Ts.prototype.getTile=function(ve,Ce,Le){var Ue=this.options,Ge=Ue.extent,Qe=Ue.debug;if(ve<0||ve>24)return null;var nt=1<<ve,Ye=ko(ve,Ce=(Ce%nt+nt)%nt,Le);if(this.tiles[Ye])return Ai(this.tiles[Ye],Ge);Qe>1&&console.log("drilling down to z%d-%d-%d",ve,Ce,Le);for(var ut,Be=ve,Ft=Ce,on=Le;!ut&&Be>0;)Be--,Ft=Math.floor(Ft/2),on=Math.floor(on/2),ut=this.tiles[ko(Be,Ft,on)];return ut&&ut.source?(Qe>1&&console.log("found parent tile z%d-%d-%d",Be,Ft,on),Qe>1&&console.time("drilling down"),this.splitTile(ut.source,Be,Ft,on,ve,Ce,Le),Qe>1&&console.timeEnd("drilling down"),this.tiles[Ye]?Ai(this.tiles[Ye],Ge):null):null},function(ve,Ce){return new Ts(ve,Ce)}}();var Tn=m.g(pi.exports);function io(Ae,$){let W=Ae.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);let J=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!J)return $(null,null);let we=new class{constructor(it){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.E,this.length=it.length,this._features=it}feature(it){return new class{constructor(ht){this._feature=ht,this.extent=m.E,this.type=ht.type,this.properties=ht.tags,"id"in ht&&!isNaN(ht.id)&&(this.id=parseInt(ht.id,10))}loadGeometry(){if(this._feature.type===1){let ht=[];for(let Re of this._feature.geometry)ht.push([new m.P(Re[0],Re[1])]);return ht}{let ht=[];for(let Re of this._feature.geometry){let Et=[];for(let Dt of Re)Et.push(new m.P(Dt[0],Dt[1]));ht.push(Et)}return ht}}toGeoJSON(ht,Re,Et){return oe.call(this,ht,Re,Et)}}(this._features[it])}}(J.features),De=Ko(we);De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),$(null,{vectorTile:we,rawData:De.buffer})}class Fs extends m.d{constructor($,W,J,we,De,it){super($,W,J,we,io,it),De&&(this.loadGeoJSON=De)}loadData($,W){let J=$&&$.request,we=J&&J.collectResourceTiming;this.loadGeoJSON($,(De,it)=>{if(De||!it)return W(De);if(typeof it!="object")return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{ie(it,!0);try{if($.filter){let Re=m.e($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(Dt=>`${Dt.key}: ${Dt.message}`).join(", "));it={type:"FeatureCollection",features:it.features.filter(Dt=>Re.value.evaluate({zoom:0},Dt))}}this._geoJSONIndex=$.cluster?new bi(function({superclusterOptions:Re,clusterProperties:Et}){if(!Et||!Re)return Re;let Dt={},zt={},li={accumulated:null,zoom:0},Ni={properties:null},Qi=Object.keys(Et);for(let Di of Qi){let[Hi,wi]=Et[Di],To=m.e(wi),Eo=m.e(typeof Hi=="string"?[Hi,["accumulated"],["get",Di]]:Hi);Dt[Di]=To.value,zt[Di]=Eo.value}return Re.map=Di=>{Ni.properties=Di;let Hi={};for(let wi of Qi)Hi[wi]=Dt[wi].evaluate(li,Ni);return Hi},Re.reduce=(Di,Hi)=>{Ni.properties=Hi;for(let wi of Qi)li.accumulated=Di[wi],Di[wi]=zt[wi].evaluate(li,Ni)},Re}($)).load(it.features):Tn(it,$.geojsonVtOptions)}catch(Re){return W(Re)}this.loaded={};let ht={};if(we){let Re=m.f(J);Re&&(ht.resourceTiming={},ht.resourceTiming[$.source]=JSON.parse(JSON.stringify(Re)))}W(null,ht)}})}reloadTile($,W){let J=this.loaded;return J&&J[$.uid]?super.reloadTile($,W):this.loadTile($,W)}loadGeoJSON($,W){if($.request)m.h($.request,W);else{if(typeof $.data!="string")return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse($.data))}catch{return W(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(J){W(J)}}getClusterChildren($,W){try{W(null,this._geoJSONIndex.getChildren($.clusterId))}catch(J){W(J)}}getClusterLeaves($,W){try{W(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(J){W(J)}}}class gr{constructor($,W){this.tileID=new m.O($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.tileZoom=$.tileZoom,this.uid=$.uid,this.zoom=$.zoom,this.canonical=$.tileID.canonical,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=$.projection,this.brightness=W}parse($,W,J,we){this.status="parsing";let De=new m.O(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),it={},ht=W.familiesBySource[J.source],Re=new m.F(De,J.promoteId);return Re.bucketLayerIDs=[],m.l($).then(Et=>{if(!Et)return we(new Error("Could not parse tile"));let Dt=m.j(Et,1/m.t(J.tileID.canonical)),zt=Et.json.extensionsUsed&&Et.json.extensionsUsed.includes("MAPBOX_mesh_features"),li=new m.k(this.zoom,{brightness:this.brightness});for(let Ni in ht)for(let Qi of ht[Ni]){let Di=Qi[0],Hi=Et.json.extensionsUsed;Di.recalculate(li,[]);let wi=new m.T(Dt,De,Hi&&Hi.includes("MAPBOX_mesh_features"),this.brightness);zt||(wi.needsUpload=!0),it[Di.fqid]=wi,wi.evaluate(Di)}this.status="done",we(null,{buckets:it,featureIndex:Re})}).catch(Et=>we(new Error(Et.message)))}}class ks{constructor($,W,J,we,De,it){this.actor=$,this.layerIndex=W,this.brightness=it,this.loading={},this.loaded={}}loadTile($,W){let J=$.uid,we=this.loading[J]=new gr($,this.brightness);m.i($.request,(De,it)=>{let ht=!this.loading[J];return delete this.loading[J],ht||De?(we.status="done",ht||(this.loaded[J]=we),W(De)):it&&it.byteLength!==0?void we.parse(it,this.layerIndex,$,(Re,Et)=>{we.status="done",this.loaded=this.loaded||{},this.loaded[J]=we,Re||!Et?W(Re):W(null,Et)}):(we.status="done",this.loaded[J]=we,W())})}reloadTile($,W){let J=this.loaded,we=$.uid;if(J&&J[we]){let De=J[we];De.projection=$.projection,De.brightness=$.brightness;let it=(ht,Re)=>{De.reloadCallback&&(delete De.reloadCallback,this.loadTile($,W)),W(ht,Re)};De.status==="parsing"?De.reloadCallback=it:De.status==="done"&&this.loadTile($,W)}}abortTile($,W){let J=$.uid;this.loading[J]&&delete this.loading[J],W()}removeTile($,W){let J=this.loaded,we=$.uid;J&&J[we]&&delete J[we],W()}}class nl{constructor($){this.self=$,this.actor=new m.A($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=m.m({name:"mercator"}),this.workerSourceTypes={vector:m.d,geojson:Fs,"batched-model":ks},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,J)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=J},this.self.registerRTLTextPlugin=W=>{if(m.n.isParsed())throw new Error("RTL text plugin already registered.");m.n.applyArabicShaping=W.applyArabicShaping,m.n.processBidirectionalText=W.processBidirectionalText,m.n.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches($,W,J){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],J()}checkIfReady($,W,J){J()}setReferrer($,W){this.referrer=W}spriteLoaded($,{scope:W,isLoaded:J}){if(this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),this.isSpriteLoaded[$][W]=J,this.workerSources[$]&&this.workerSources[$][W])for(let we in this.workerSources[$][W]){let De=this.workerSources[$][W][we];for(let it in De)De[it]instanceof m.d&&(De[it].isSpriteLoaded=J,De[it].fire(new m.o("isSpriteLoaded")))}}setImages($,{scope:W,images:J},we){if(this.availableImages[$]||(this.availableImages[$]={}),this.availableImages[$][W]=J,this.workerSources[$]&&this.workerSources[$][W]){for(let De in this.workerSources[$][W]){let it=this.workerSources[$][W][De];for(let ht in it)it[ht].availableImages=J}we()}else we()}setProjection($,W){this.projections[$]=m.m(W)}setBrightness($,W,J){this.brightness=W,J()}setLayers($,W,J){this.getLayerIndex($,W.scope).replace(W.layers,W.options),J()}updateLayers($,W,J){this.getLayerIndex($,W.scope).update(W.layers,W.removedIds,W.options),J()}loadTile($,W,J){W.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,W.type,W.source,W.scope).loadTile(W,J)}loadDEMTile($,W,J){this.getDEMWorkerSource($,W.source,W.scope).loadTile(W,J)}reloadTile($,W,J){W.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,W.type,W.source,W.scope).reloadTile(W,J)}abortTile($,W,J){this.getWorkerSource($,W.type,W.source,W.scope).abortTile(W,J)}removeTile($,W,J){this.getWorkerSource($,W.type,W.source,W.scope).removeTile(W,J)}removeSource($,W,J){if(!(this.workerSources[$]&&this.workerSources[$][W.scope]&&this.workerSources[$][W.scope][W.type]&&this.workerSources[$][W.scope][W.type][W.source]))return;let we=this.workerSources[$][W.scope][W.type][W.source];delete this.workerSources[$][W.scope][W.type][W.source],we.removeSource!==void 0?we.removeSource(W,J):J()}loadWorkerSource($,W,J){try{this.self.importScripts(W.url),J()}catch(we){J(we.toString())}}syncRTLPluginState($,W,J){try{m.n.setState(W);let we=m.n.getPluginURL();if(m.n.isLoaded()&&!m.n.isParsed()&&we!=null){this.self.importScripts(we);let De=m.n.isParsed();J(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${we}`),De)}}catch(we){J(we.toString())}}setDracoUrl($,W){this.dracoUrl=W}getAvailableImages($,W){this.availableImages[$]||(this.availableImages[$]={});let J=this.availableImages[$][W];return J||(J=[]),J}getLayerIndex($,W){this.layerIndexes[$]||(this.layerIndexes[$]={});let J=this.layerIndexes[$][W];return J||(J=this.layerIndexes[$][W]=new C,J.scope=W),J}getWorkerSource($,W,J,we){if(this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][we]||(this.workerSources[$][we]={}),this.workerSources[$][we][W]||(this.workerSources[$][we][W]={}),this.isSpriteLoaded[$]||(this.isSpriteLoaded[$]={}),!this.workerSources[$][we][W][J]){let De={send:(it,ht,Re,Et,Dt,zt)=>{this.actor.send(it,ht,Re,$,Dt,zt)},scheduler:this.actor.scheduler};this.workerSources[$][we][W][J]=new this.workerSourceTypes[W](De,this.getLayerIndex($,we),this.getAvailableImages($,we),this.isSpriteLoaded[$][we],void 0,this.brightness)}return this.workerSources[$][we][W][J]}getDEMWorkerSource($,W,J){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][J]||(this.demWorkerSources[$][J]={}),this.demWorkerSources[$][J][W]||(this.demWorkerSources[$][J][W]=new D),this.demWorkerSources[$][J][W]}enforceCacheSizeLimit($,W){m.q(W)}getWorkerPerformanceMetrics($,W,J){J(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new nl(self)),nl}),c(["./shared"],function(m){"use strict";return m.s});var h=a;return h})});var I$=hM((PA,OA)=>{"use strict";(function(i,r){typeof PA=="object"&&typeof OA<"u"?OA.exports=r():typeof define=="function"&&define.amd?define(r):(i=typeof globalThis<"u"?globalThis:i||self).MapboxDraw=r()})(PA,function(){"use strict";var i=function(I,L){var V={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},re={on:function(ue,_e,Ke){if(V[ue]===void 0)throw new Error("Invalid event type: "+ue);V[ue].push({selector:_e,fn:Ke})},render:function(ue){L.store.featureChanged(ue)}},le=function(ue,_e){for(var Ke=V[ue],at=Ke.length;at--;){var _t=Ke[at];if(_t.selector(_e)){_t.fn.call(re,_e)||L.store.render(),L.ui.updateMapClasses();break}}};return I.start.call(re),{render:I.render,stop:function(){I.stop&&I.stop()},trash:function(){I.trash&&(I.trash(),L.store.render())},combineFeatures:function(){I.combineFeatures&&I.combineFeatures()},uncombineFeatures:function(){I.uncombineFeatures&&I.uncombineFeatures()},drag:function(ue){le("drag",ue)},click:function(ue){le("click",ue)},mousemove:function(ue){le("mousemove",ue)},mousedown:function(ue){le("mousedown",ue)},mouseup:function(ue){le("mouseup",ue)},mouseout:function(ue){le("mouseout",ue)},keydown:function(ue){le("keydown",ue)},keyup:function(ue){le("keyup",ue)},touchstart:function(ue){le("touchstart",ue)},touchmove:function(ue){le("touchmove",ue)},touchend:function(ue){le("touchend",ue)},tap:function(ue){le("tap",ue)}}};function r(I){return I&&I.__esModule&&Object.prototype.hasOwnProperty.call(I,"default")?I.default:I}function a(I){if(I.__esModule)return I;var L=I.default;if(typeof L=="function"){var V=function re(){if(this instanceof re){var le=[null];le.push.apply(le,arguments);var ue=Function.bind.apply(L,le);return new ue}return L.apply(this,arguments)};V.prototype=L.prototype}else V={};return Object.defineProperty(V,"__esModule",{value:!0}),Object.keys(I).forEach(function(re){var le=Object.getOwnPropertyDescriptor(I,re);Object.defineProperty(V,re,le.get?le:{enumerable:!0,get:function(){return I[re]}})}),V}var c={},h={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},m=h;function y(I){var L=0;if(I&&I.length>0){L+=Math.abs(w(I[0]));for(var V=1;V<I.length;V++)L-=Math.abs(w(I[V]))}return L}function w(I){var L,V,re,le,ue,_e,Ke=0,at=I.length;if(at>2){for(_e=0;_e<at;_e++)_e===at-2?(re=at-2,le=at-1,ue=0):_e===at-1?(re=at-1,le=0,ue=1):(re=_e,le=_e+1,ue=_e+2),L=I[re],V=I[le],Ke+=(C(I[ue][0])-C(L[0]))*Math.sin(C(V[1]));Ke=Ke*m.RADIUS*m.RADIUS/2}return Ke}function C(I){return I*Math.PI/180}c.geometry=function I(L){var V,re=0;switch(L.type){case"Polygon":return y(L.coordinates);case"MultiPolygon":for(V=0;V<L.coordinates.length;V++)re+=y(L.coordinates[V]);return re;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(V=0;V<L.geometries.length;V++)re+=I(L.geometries[V]);return re}},c.ring=w;var D={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},z={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},j={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ie={POLYGON:"polygon",LINE:"line_string",POINT:"point"},oe={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},he={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},ke={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},rt={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},Ve={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Ot={ACTIVE:"true",INACTIVE:"false"},hn=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Qt=-85,Wn=Object.freeze({__proto__:null,classes:D,sources:z,cursors:j,types:ie,geojsonTypes:oe,modes:he,events:ke,updateActions:rt,meta:Ve,activeStates:Ot,interactions:hn,LAT_MIN:-90,LAT_RENDERED_MIN:Qt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),Kn={Point:0,LineString:1,MultiLineString:1,Polygon:2};function X(I,L){var V=Kn[I.geometry.type]-Kn[L.geometry.type];return V===0&&I.geometry.type===oe.POLYGON?I.area-L.area:V}function Rt(I){return I.map(function(L){return L.geometry.type===oe.POLYGON&&(L.area=c.geometry({type:oe.FEATURE,property:{},geometry:L.geometry})),L}).sort(X).map(function(L){return delete L.area,L})}function bo(I,L){return L===void 0&&(L=0),[[I.point.x-L,I.point.y-L],[I.point.x+L,I.point.y+L]]}function ar(I){if(this._items={},this._nums={},this._length=I?I.length:0,I)for(var L=0,V=I.length;L<V;L++)this.add(I[L]),I[L]!==void 0&&(typeof I[L]=="string"?this._items[I[L]]=L:this._nums[I[L]]=L)}ar.prototype.add=function(I){return this.has(I)||(this._length++,typeof I=="string"?this._items[I]=this._length:this._nums[I]=this._length),this},ar.prototype.delete=function(I){return this.has(I)===!1||(this._length--,delete this._items[I],delete this._nums[I]),this},ar.prototype.has=function(I){return(typeof I=="string"||typeof I=="number")&&(this._items[I]!==void 0||this._nums[I]!==void 0)},ar.prototype.values=function(){var I=this,L=[];return Object.keys(this._items).forEach(function(V){L.push({k:V,v:I._items[V]})}),Object.keys(this._nums).forEach(function(V){L.push({k:JSON.parse(V),v:I._nums[V]})}),L.sort(function(V,re){return V.v-re.v}).map(function(V){return V.k})},ar.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Vt=[Ve.FEATURE,Ve.MIDPOINT,Ve.VERTEX],xi={click:function(I,L,V){return Pa(I,L,V,V.options.clickBuffer)},touch:function(I,L,V){return Pa(I,L,V,V.options.touchBuffer)}};function Pa(I,L,V,re){if(V.map===null)return[];var le=I?bo(I,re):L,ue={};V.options.styles&&(ue.layers=V.options.styles.map(function(_t){return _t.id}).filter(function(_t){return V.map.getLayer(_t)!=null}));var _e=V.map.queryRenderedFeatures(le,ue).filter(function(_t){return Vt.indexOf(_t.properties.meta)!==-1}),Ke=new ar,at=[];return _e.forEach(function(_t){var vt=_t.properties.id;Ke.has(vt)||(Ke.add(vt),at.push(_t))}),Rt(at)}function Ko(I,L){var V=xi.click(I,null,L),re={mouse:j.NONE};return V[0]&&(re.mouse=V[0].properties.active===Ot.ACTIVE?j.MOVE:j.POINTER,re.feature=V[0].properties.meta),L.events.currentModeName().indexOf("draw")!==-1&&(re.mouse=j.ADD),L.ui.queueMapClasses(re),L.ui.updateMapClasses(),V[0]}function Oa(I,L){var V=I.x-L.x,re=I.y-L.y;return Math.sqrt(V*V+re*re)}function Pt(I,L,V){V===void 0&&(V={});var re=V.fineTolerance!=null?V.fineTolerance:4,le=V.grossTolerance!=null?V.grossTolerance:12,ue=V.interval!=null?V.interval:500;I.point=I.point||L.point,I.time=I.time||L.time;var _e=Oa(I.point,L.point);return _e<re||_e<le&&L.time-I.time<ue}function Ut(I,L,V){V===void 0&&(V={});var re=V.tolerance!=null?V.tolerance:25,le=V.interval!=null?V.interval:250;return I.point=I.point||L.point,I.time=I.time||L.time,Oa(I.point,L.point)<re&&L.time-I.time<le}var jt={exports:{}},ze=jt.exports=function(I,L){if(L||(L=16),I===void 0&&(I=128),I<=0)return"0";for(var V=Math.log(Math.pow(2,I))/Math.log(L),re=2;V===1/0;re*=2)V=Math.log(Math.pow(2,I/re))/Math.log(L)*re;var le=V-Math.floor(V),ue="";for(re=0;re<Math.floor(V);re++)ue=Math.floor(Math.random()*L).toString(L)+ue;if(le){var _e=Math.pow(L,le);ue=Math.floor(Math.random()*_e).toString(L)+ue}var Ke=parseInt(ue,L);return Ke!==1/0&&Ke>=Math.pow(2,I)?ze(I,L):ue};ze.rack=function(I,L,V){var re=function(ue){var _e=0;do{if(_e++>10){if(!V)throw new Error("too many ID collisions, use more bits");I+=V}var Ke=ze(I,L)}while(Object.hasOwnProperty.call(le,Ke));return le[Ke]=ue,Ke},le=re.hats={};return re.get=function(ue){return re.hats[ue]},re.set=function(ue,_e){return re.hats[ue]=_e,re},re.bits=I||128,re.base=L||16,re};var Si=r(jt.exports),bi=function(I,L){this.ctx=I,this.properties=L.properties||{},this.coordinates=L.geometry.coordinates,this.id=L.id||Si(),this.type=L.geometry.type};bi.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},bi.prototype.incomingCoords=function(I){this.setCoordinates(I)},bi.prototype.setCoordinates=function(I){this.coordinates=I,this.changed()},bi.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},bi.prototype.setProperty=function(I,L){this.properties[I]=L},bi.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:oe.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},bi.prototype.internal=function(I){var L={id:this.id,meta:Ve.FEATURE,"meta:type":this.type,active:Ot.INACTIVE,mode:I};if(this.ctx.options.userProperties)for(var V in this.properties)L["user_"+V]=this.properties[V];return{type:oe.FEATURE,properties:L,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Ji=function(I,L){bi.call(this,I,L)};(Ji.prototype=Object.create(bi.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Ji.prototype.updateCoordinate=function(I,L,V){this.coordinates=arguments.length===3?[L,V]:[I,L],this.changed()},Ji.prototype.getCoordinate=function(){return this.getCoordinates()};var wr=function(I,L){bi.call(this,I,L)};(wr.prototype=Object.create(bi.prototype)).isValid=function(){return this.coordinates.length>1},wr.prototype.addCoordinate=function(I,L,V){this.changed();var re=parseInt(I,10);this.coordinates.splice(re,0,[L,V])},wr.prototype.getCoordinate=function(I){var L=parseInt(I,10);return JSON.parse(JSON.stringify(this.coordinates[L]))},wr.prototype.removeCoordinate=function(I){this.changed(),this.coordinates.splice(parseInt(I,10),1)},wr.prototype.updateCoordinate=function(I,L,V){var re=parseInt(I,10);this.coordinates[re]=[L,V],this.changed()};var Ne=function(I,L){bi.call(this,I,L),this.coordinates=this.coordinates.map(function(V){return V.slice(0,-1)})};(Ne.prototype=Object.create(bi.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(I){return I.length>2})},Ne.prototype.incomingCoords=function(I){this.coordinates=I.map(function(L){return L.slice(0,-1)}),this.changed()},Ne.prototype.setCoordinates=function(I){this.coordinates=I,this.changed()},Ne.prototype.addCoordinate=function(I,L,V){this.changed();var re=I.split(".").map(function(le){return parseInt(le,10)});this.coordinates[re[0]].splice(re[1],0,[L,V])},Ne.prototype.removeCoordinate=function(I){this.changed();var L=I.split(".").map(function(re){return parseInt(re,10)}),V=this.coordinates[L[0]];V&&(V.splice(L[1],1),V.length<3&&this.coordinates.splice(L[0],1))},Ne.prototype.getCoordinate=function(I){var L=I.split(".").map(function(re){return parseInt(re,10)}),V=this.coordinates[L[0]];return JSON.parse(JSON.stringify(V[L[1]]))},Ne.prototype.getCoordinates=function(){return this.coordinates.map(function(I){return I.concat([I[0]])})},Ne.prototype.updateCoordinate=function(I,L,V){this.changed();var re=I.split("."),le=parseInt(re[0],10),ue=parseInt(re[1],10);this.coordinates[le]===void 0&&(this.coordinates[le]=[]),this.coordinates[le][ue]=[L,V]};var wo={MultiPoint:Ji,MultiLineString:wr,MultiPolygon:Ne},la=function(I,L,V,re,le){var ue=V.split("."),_e=parseInt(ue[0],10),Ke=ue[1]?ue.slice(1).join("."):null;return I[_e][L](Ke,re,le)},pi=function(I,L){if(bi.call(this,I,L),delete this.coordinates,this.model=wo[L.geometry.type],this.model===void 0)throw new TypeError(L.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(L.geometry.coordinates)};function Tn(I){this.map=I.map,this.drawConfig=JSON.parse(JSON.stringify(I.options||{})),this._ctx=I}(pi.prototype=Object.create(bi.prototype))._coordinatesToFeatures=function(I){var L=this,V=this.model.bind(this);return I.map(function(re){return new V(L.ctx,{id:Si(),type:oe.FEATURE,properties:{},geometry:{coordinates:re,type:L.type.replace("Multi","")}})})},pi.prototype.isValid=function(){return this.features.every(function(I){return I.isValid()})},pi.prototype.setCoordinates=function(I){this.features=this._coordinatesToFeatures(I),this.changed()},pi.prototype.getCoordinate=function(I){return la(this.features,"getCoordinate",I)},pi.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(I){return I.type===oe.POLYGON?I.getCoordinates():I.coordinates})))},pi.prototype.updateCoordinate=function(I,L,V){la(this.features,"updateCoordinate",I,L,V),this.changed()},pi.prototype.addCoordinate=function(I,L,V){la(this.features,"addCoordinate",I,L,V),this.changed()},pi.prototype.removeCoordinate=function(I){la(this.features,"removeCoordinate",I),this.changed()},pi.prototype.getFeatures=function(){return this.features},Tn.prototype.setSelected=function(I){return this._ctx.store.setSelected(I)},Tn.prototype.setSelectedCoordinates=function(I){var L=this;this._ctx.store.setSelectedCoordinates(I),I.reduce(function(V,re){return V[re.feature_id]===void 0&&(V[re.feature_id]=!0,L._ctx.store.get(re.feature_id).changed()),V},{})},Tn.prototype.getSelected=function(){return this._ctx.store.getSelected()},Tn.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Tn.prototype.isSelected=function(I){return this._ctx.store.isSelected(I)},Tn.prototype.getFeature=function(I){return this._ctx.store.get(I)},Tn.prototype.select=function(I){return this._ctx.store.select(I)},Tn.prototype.deselect=function(I){return this._ctx.store.deselect(I)},Tn.prototype.deleteFeature=function(I,L){return L===void 0&&(L={}),this._ctx.store.delete(I,L)},Tn.prototype.addFeature=function(I){return this._ctx.store.add(I)},Tn.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Tn.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Tn.prototype.setActionableState=function(I){I===void 0&&(I={});var L={trash:I.trash||!1,combineFeatures:I.combineFeatures||!1,uncombineFeatures:I.uncombineFeatures||!1};return this._ctx.events.actionable(L)},Tn.prototype.changeMode=function(I,L,V){return L===void 0&&(L={}),V===void 0&&(V={}),this._ctx.events.changeMode(I,L,V)},Tn.prototype.updateUIClasses=function(I){return this._ctx.ui.queueMapClasses(I)},Tn.prototype.activateUIButton=function(I){return this._ctx.ui.setActiveButton(I)},Tn.prototype.featuresAt=function(I,L,V){if(V===void 0&&(V="click"),V!=="click"&&V!=="touch")throw new Error("invalid buffer type");return xi[V](I,L,this._ctx)},Tn.prototype.newFeature=function(I){var L=I.geometry.type;return L===oe.POINT?new Ji(this._ctx,I):L===oe.LINE_STRING?new wr(this._ctx,I):L===oe.POLYGON?new Ne(this._ctx,I):new pi(this._ctx,I)},Tn.prototype.isInstanceOf=function(I,L){if(I===oe.POINT)return L instanceof Ji;if(I===oe.LINE_STRING)return L instanceof wr;if(I===oe.POLYGON)return L instanceof Ne;if(I==="MultiFeature")return L instanceof pi;throw new Error("Unknown feature class: "+I)},Tn.prototype.doRender=function(I){return this._ctx.store.featureChanged(I)},Tn.prototype.onSetup=function(){},Tn.prototype.onDrag=function(){},Tn.prototype.onClick=function(){},Tn.prototype.onMouseMove=function(){},Tn.prototype.onMouseDown=function(){},Tn.prototype.onMouseUp=function(){},Tn.prototype.onMouseOut=function(){},Tn.prototype.onKeyUp=function(){},Tn.prototype.onKeyDown=function(){},Tn.prototype.onTouchStart=function(){},Tn.prototype.onTouchMove=function(){},Tn.prototype.onTouchEnd=function(){},Tn.prototype.onTap=function(){},Tn.prototype.onStop=function(){},Tn.prototype.onTrash=function(){},Tn.prototype.onCombineFeature=function(){},Tn.prototype.onUncombineFeature=function(){},Tn.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var io={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Fs=Object.keys(io);function gr(I){var L=Object.keys(I);return function(V,re){re===void 0&&(re={});var le={},ue=L.reduce(function(_e,Ke){return _e[Ke]=I[Ke],_e},new Tn(V));return{start:function(){var _e=this;le=ue.onSetup(re),Fs.forEach(function(Ke){var at,_t=io[Ke],vt=function(){return!1};I[_t]&&(vt=function(){return!0}),_e.on(Ke,vt,(at=_t,function(ft){return ue[at](le,ft)}))})},stop:function(){ue.onStop(le)},trash:function(){ue.onTrash(le)},combineFeatures:function(){ue.onCombineFeatures(le)},uncombineFeatures:function(){ue.onUncombineFeatures(le)},render:function(_e,Ke){ue.toDisplayFeatures(le,_e,Ke)}}}}function ks(I){return[].concat(I).filter(function(L){return L!==void 0})}function nl(){var I=this;if(!(I.ctx.map&&I.ctx.map.getSource(z.HOT)!==void 0))return at();var L=I.ctx.events.currentModeName();I.ctx.ui.queueMapClasses({mode:L});var V=[],re=[];I.isDirty?re=I.getAllIds():(V=I.getChangedIds().filter(function(_t){return I.get(_t)!==void 0}),re=I.sources.hot.filter(function(_t){return _t.properties.id&&V.indexOf(_t.properties.id)===-1&&I.get(_t.properties.id)!==void 0}).map(function(_t){return _t.properties.id})),I.sources.hot=[];var le=I.sources.cold.length;I.sources.cold=I.isDirty?[]:I.sources.cold.filter(function(_t){var vt=_t.properties.id||_t.properties.parent;return V.indexOf(vt)===-1});var ue=le!==I.sources.cold.length||re.length>0;function _e(_t,vt){var ft=I.get(_t).internal(L);I.ctx.events.currentModeRender(ft,function(yn){I.sources[vt].push(yn)})}if(V.forEach(function(_t){return _e(_t,"hot")}),re.forEach(function(_t){return _e(_t,"cold")}),ue&&I.ctx.map.getSource(z.COLD).setData({type:oe.FEATURE_COLLECTION,features:I.sources.cold}),I.ctx.map.getSource(z.HOT).setData({type:oe.FEATURE_COLLECTION,features:I.sources.hot}),I._emitSelectionChange&&(I.ctx.map.fire(ke.SELECTION_CHANGE,{features:I.getSelected().map(function(_t){return _t.toGeoJSON()}),points:I.getSelectedCoordinates().map(function(_t){return{type:oe.FEATURE,properties:{},geometry:{type:oe.POINT,coordinates:_t.coordinates}}})}),I._emitSelectionChange=!1),I._deletedFeaturesToEmit.length){var Ke=I._deletedFeaturesToEmit.map(function(_t){return _t.toGeoJSON()});I._deletedFeaturesToEmit=[],I.ctx.map.fire(ke.DELETE,{features:Ke})}function at(){I.isDirty=!1,I.clearChangedIds()}at(),I.ctx.map.fire(ke.RENDER,{})}function Ae(I){var L,V=this;this._features={},this._featureIds=new ar,this._selectedFeatureIds=new ar,this._selectedCoordinates=[],this._changedFeatureIds=new ar,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=I,this.sources={hot:[],cold:[]},this.render=function(){L||(L=requestAnimationFrame(function(){L=null,nl.call(V)}))},this.isDirty=!1}function $(I,L){var V=I._selectedCoordinates.filter(function(re){return I._selectedFeatureIds.has(re.feature_id)});I._selectedCoordinates.length===V.length||L.silent||(I._emitSelectionChange=!0),I._selectedCoordinates=V}Ae.prototype.createRenderBatch=function(){var I=this,L=this.render,V=0;return this.render=function(){V++},function(){I.render=L,V>0&&I.render()}},Ae.prototype.setDirty=function(){return this.isDirty=!0,this},Ae.prototype.featureChanged=function(I){return this._changedFeatureIds.add(I),this},Ae.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Ae.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Ae.prototype.getAllIds=function(){return this._featureIds.values()},Ae.prototype.add=function(I){return this.featureChanged(I.id),this._features[I.id]=I,this._featureIds.add(I.id),this},Ae.prototype.delete=function(I,L){var V=this;return L===void 0&&(L={}),ks(I).forEach(function(re){V._featureIds.has(re)&&(V._featureIds.delete(re),V._selectedFeatureIds.delete(re),L.silent||V._deletedFeaturesToEmit.indexOf(V._features[re])===-1&&V._deletedFeaturesToEmit.push(V._features[re]),delete V._features[re],V.isDirty=!0)}),$(this,L),this},Ae.prototype.get=function(I){return this._features[I]},Ae.prototype.getAll=function(){var I=this;return Object.keys(this._features).map(function(L){return I._features[L]})},Ae.prototype.select=function(I,L){var V=this;return L===void 0&&(L={}),ks(I).forEach(function(re){V._selectedFeatureIds.has(re)||(V._selectedFeatureIds.add(re),V._changedFeatureIds.add(re),L.silent||(V._emitSelectionChange=!0))}),this},Ae.prototype.deselect=function(I,L){var V=this;return L===void 0&&(L={}),ks(I).forEach(function(re){V._selectedFeatureIds.has(re)&&(V._selectedFeatureIds.delete(re),V._changedFeatureIds.add(re),L.silent||(V._emitSelectionChange=!0))}),$(this,L),this},Ae.prototype.clearSelected=function(I){return I===void 0&&(I={}),this.deselect(this._selectedFeatureIds.values(),{silent:I.silent}),this},Ae.prototype.setSelected=function(I,L){var V=this;return L===void 0&&(L={}),I=ks(I),this.deselect(this._selectedFeatureIds.values().filter(function(re){return I.indexOf(re)===-1}),{silent:L.silent}),this.select(I.filter(function(re){return!V._selectedFeatureIds.has(re)}),{silent:L.silent}),this},Ae.prototype.setSelectedCoordinates=function(I){return this._selectedCoordinates=I,this._emitSelectionChange=!0,this},Ae.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Ae.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Ae.prototype.getSelected=function(){var I=this;return this._selectedFeatureIds.values().map(function(L){return I.get(L)})},Ae.prototype.getSelectedCoordinates=function(){var I=this;return this._selectedCoordinates.map(function(L){return{coordinates:I.get(L.feature_id).getCoordinate(L.coord_path)}})},Ae.prototype.isSelected=function(I){return this._selectedFeatureIds.has(I)},Ae.prototype.setFeatureProperty=function(I,L,V){this.get(I).setProperty(L,V),this.featureChanged(I)},Ae.prototype.storeMapConfig=function(){var I=this;hn.forEach(function(L){I.ctx.map[L]&&(I._mapInitialConfig[L]=I.ctx.map[L].isEnabled())})},Ae.prototype.restoreMapConfig=function(){var I=this;Object.keys(this._mapInitialConfig).forEach(function(L){I._mapInitialConfig[L]?I.ctx.map[L].enable():I.ctx.map[L].disable()})},Ae.prototype.getInitialConfigValue=function(I){return this._mapInitialConfig[I]===void 0||this._mapInitialConfig[I]};var W=function(){for(var I=arguments,L={},V=0;V<arguments.length;V++){var re=I[V];for(var le in re)J.call(re,le)&&(L[le]=re[le])}return L},J=Object.prototype.hasOwnProperty,we=r(W),De=["mode","feature","mouse"];function it(I){var L=null,V=null,re={onRemove:function(){return I.map.off("load",re.connect),clearInterval(V),re.removeLayers(),I.store.restoreMapConfig(),I.ui.removeButtons(),I.events.removeEventListeners(),I.ui.clearMapClasses(),I.boxZoomInitial&&I.map.boxZoom.enable(),I.map=null,I.container=null,I.store=null,L&&L.parentNode&&L.parentNode.removeChild(L),L=null,this},connect:function(){I.map.off("load",re.connect),clearInterval(V),re.addLayers(),I.store.storeMapConfig(),I.events.addEventListeners()},onAdd:function(le){var ue=le.fire;return le.fire=function(_e,Ke){var at=arguments;return ue.length===1&&arguments.length!==1&&(at=[we({},{type:_e},Ke)]),ue.apply(le,at)},I.map=le,I.events=function(_e){var Ke=Object.keys(_e.options.modes).reduce(function(q,Ie){return q[Ie]=gr(_e.options.modes[Ie]),q},{}),at={},_t={},vt={},ft=null,yn=null;vt.drag=function(q,Ie){Ie({point:q.point,time:new Date().getTime()})?(_e.ui.queueMapClasses({mouse:j.DRAG}),yn.drag(q)):q.originalEvent.stopPropagation()},vt.mousedrag=function(q){vt.drag(q,function(Ie){return!Pt(at,Ie)})},vt.touchdrag=function(q){vt.drag(q,function(Ie){return!Ut(_t,Ie)})},vt.mousemove=function(q){if((q.originalEvent.buttons!==void 0?q.originalEvent.buttons:q.originalEvent.which)===1)return vt.mousedrag(q);var Ie=Ko(q,_e);q.featureTarget=Ie,yn.mousemove(q)},vt.mousedown=function(q){at={time:new Date().getTime(),point:q.point};var Ie=Ko(q,_e);q.featureTarget=Ie,yn.mousedown(q)},vt.mouseup=function(q){var Ie=Ko(q,_e);q.featureTarget=Ie,Pt(at,{point:q.point,time:new Date().getTime()})?yn.click(q):yn.mouseup(q)},vt.mouseout=function(q){yn.mouseout(q)},vt.touchstart=function(q){if(_e.options.touchEnabled){_t={time:new Date().getTime(),point:q.point};var Ie=xi.touch(q,null,_e)[0];q.featureTarget=Ie,yn.touchstart(q)}},vt.touchmove=function(q){if(_e.options.touchEnabled)return yn.touchmove(q),vt.touchdrag(q)},vt.touchend=function(q){if(q.originalEvent.preventDefault(),_e.options.touchEnabled){var Ie=xi.touch(q,null,_e)[0];q.featureTarget=Ie,Ut(_t,{time:new Date().getTime(),point:q.point})?yn.tap(q):yn.touchend(q)}};var Se=function(q){return!(q===8||q===46||q>=48&&q<=57)};function Je(q,Ie,mi){mi===void 0&&(mi={}),yn.stop();var tr=Ke[q];if(tr===void 0)throw new Error(q+" is not valid");ft=q;var $n=tr(_e,Ie);yn=i($n,_e),mi.silent||_e.map.fire(ke.MODE_CHANGE,{mode:q}),_e.store.setDirty(),_e.store.render()}vt.keydown=function(q){(q.srcElement||q.target).classList.contains("mapboxgl-canvas")&&(q.keyCode!==8&&q.keyCode!==46||!_e.options.controls.trash?Se(q.keyCode)?yn.keydown(q):q.keyCode===49&&_e.options.controls.point?Je(he.DRAW_POINT):q.keyCode===50&&_e.options.controls.line_string?Je(he.DRAW_LINE_STRING):q.keyCode===51&&_e.options.controls.polygon&&Je(he.DRAW_POLYGON):(q.preventDefault(),yn.trash()))},vt.keyup=function(q){Se(q.keyCode)&&yn.keyup(q)},vt.zoomend=function(){_e.store.changeZoom()},vt.data=function(q){if(q.dataType==="style"){var Ie=_e.setup,mi=_e.map,tr=_e.options,$n=_e.store;tr.styles.some(function(Bt){return mi.getLayer(Bt.id)})||(Ie.addLayers(),$n.setDirty(),$n.render())}};var vn={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){ft=_e.options.defaultMode,yn=i(Ke[ft](_e),_e)},changeMode:Je,actionable:function(q){var Ie=!1;Object.keys(q).forEach(function(mi){if(vn[mi]===void 0)throw new Error("Invalid action type");vn[mi]!==q[mi]&&(Ie=!0),vn[mi]=q[mi]}),Ie&&_e.map.fire(ke.ACTIONABLE,{actions:vn})},currentModeName:function(){return ft},currentModeRender:function(q,Ie){return yn.render(q,Ie)},fire:function(q,Ie){vt[q]&&vt[q](Ie)},addEventListeners:function(){_e.map.on("mousemove",vt.mousemove),_e.map.on("mousedown",vt.mousedown),_e.map.on("mouseup",vt.mouseup),_e.map.on("data",vt.data),_e.map.on("touchmove",vt.touchmove),_e.map.on("touchstart",vt.touchstart),_e.map.on("touchend",vt.touchend),_e.container.addEventListener("mouseout",vt.mouseout),_e.options.keybindings&&(_e.container.addEventListener("keydown",vt.keydown),_e.container.addEventListener("keyup",vt.keyup))},removeEventListeners:function(){_e.map.off("mousemove",vt.mousemove),_e.map.off("mousedown",vt.mousedown),_e.map.off("mouseup",vt.mouseup),_e.map.off("data",vt.data),_e.map.off("touchmove",vt.touchmove),_e.map.off("touchstart",vt.touchstart),_e.map.off("touchend",vt.touchend),_e.container.removeEventListener("mouseout",vt.mouseout),_e.options.keybindings&&(_e.container.removeEventListener("keydown",vt.keydown),_e.container.removeEventListener("keyup",vt.keyup))},trash:function(q){yn.trash(q)},combineFeatures:function(){yn.combineFeatures()},uncombineFeatures:function(){yn.uncombineFeatures()},getMode:function(){return ft}}}(I),I.ui=function(_e){var Ke={},at=null,_t={mode:null,feature:null,mouse:null},vt={mode:null,feature:null,mouse:null};function ft(q){vt=we(vt,q)}function yn(){var q,Ie;if(_e.container){var mi=[],tr=[];De.forEach(function($n){vt[$n]!==_t[$n]&&(mi.push($n+"-"+_t[$n]),vt[$n]!==null&&tr.push($n+"-"+vt[$n]))}),mi.length>0&&(q=_e.container.classList).remove.apply(q,mi),tr.length>0&&(Ie=_e.container.classList).add.apply(Ie,tr),_t=we(_t,vt)}}function Se(q,Ie){Ie===void 0&&(Ie={});var mi=document.createElement("button");return mi.className=D.CONTROL_BUTTON+" "+Ie.className,mi.setAttribute("title",Ie.title),Ie.container.appendChild(mi),mi.addEventListener("click",function(tr){if(tr.preventDefault(),tr.stopPropagation(),tr.target===at)return Je(),void Ie.onDeactivate();vn(q),Ie.onActivate()},!0),mi}function Je(){at&&(at.classList.remove(D.ACTIVE_BUTTON),at=null)}function vn(q){Je();var Ie=Ke[q];Ie&&Ie&&q!=="trash"&&(Ie.classList.add(D.ACTIVE_BUTTON),at=Ie)}return{setActiveButton:vn,queueMapClasses:ft,updateMapClasses:yn,clearMapClasses:function(){ft({mode:null,feature:null,mouse:null}),yn()},addButtons:function(){var q=_e.options.controls,Ie=document.createElement("div");return Ie.className=D.CONTROL_GROUP+" "+D.CONTROL_BASE,q&&(q[ie.LINE]&&(Ke[ie.LINE]=Se(ie.LINE,{container:Ie,className:D.CONTROL_BUTTON_LINE,title:"LineString tool "+(_e.options.keybindings?"(l)":""),onActivate:function(){return _e.events.changeMode(he.DRAW_LINE_STRING)},onDeactivate:function(){return _e.events.trash()}})),q[ie.POLYGON]&&(Ke[ie.POLYGON]=Se(ie.POLYGON,{container:Ie,className:D.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(_e.options.keybindings?"(p)":""),onActivate:function(){return _e.events.changeMode(he.DRAW_POLYGON)},onDeactivate:function(){return _e.events.trash()}})),q[ie.POINT]&&(Ke[ie.POINT]=Se(ie.POINT,{container:Ie,className:D.CONTROL_BUTTON_POINT,title:"Marker tool "+(_e.options.keybindings?"(m)":""),onActivate:function(){return _e.events.changeMode(he.DRAW_POINT)},onDeactivate:function(){return _e.events.trash()}})),q.trash&&(Ke.trash=Se("trash",{container:Ie,className:D.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){_e.events.trash()}})),q.combine_features&&(Ke.combine_features=Se("combineFeatures",{container:Ie,className:D.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){_e.events.combineFeatures()}})),q.uncombine_features&&(Ke.uncombine_features=Se("uncombineFeatures",{container:Ie,className:D.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){_e.events.uncombineFeatures()}}))),Ie},removeButtons:function(){Object.keys(Ke).forEach(function(q){var Ie=Ke[q];Ie.parentNode&&Ie.parentNode.removeChild(Ie),delete Ke[q]})}}}(I),I.container=le.getContainer(),I.store=new Ae(I),L=I.ui.addButtons(),I.options.boxSelect&&(I.boxZoomInitial=le.boxZoom.isEnabled(),le.boxZoom.disable(),le.dragPan.disable(),le.dragPan.enable()),le.loaded()?re.connect():(le.on("load",re.connect),V=setInterval(function(){le.loaded()&&re.connect()},16)),I.events.start(),L},addLayers:function(){I.map.addSource(z.COLD,{data:{type:oe.FEATURE_COLLECTION,features:[]},type:"geojson"}),I.map.addSource(z.HOT,{data:{type:oe.FEATURE_COLLECTION,features:[]},type:"geojson"}),I.options.styles.forEach(function(le){I.map.addLayer(le)}),I.store.setDirty(!0),I.store.render()},removeLayers:function(){I.options.styles.forEach(function(le){I.map.getLayer(le.id)&&I.map.removeLayer(le.id)}),I.map.getSource(z.COLD)&&I.map.removeSource(z.COLD),I.map.getSource(z.HOT)&&I.map.removeSource(z.HOT)}};return I.setup=re,re}var ht=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Re(I){return function(L){var V=L.featureTarget;return!!V&&!!V.properties&&V.properties.meta===I}}function Et(I){return!!I.originalEvent&&!!I.originalEvent.shiftKey&&I.originalEvent.button===0}function Dt(I){return!!I.featureTarget&&!!I.featureTarget.properties&&I.featureTarget.properties.active===Ot.ACTIVE&&I.featureTarget.properties.meta===Ve.FEATURE}function zt(I){return!!I.featureTarget&&!!I.featureTarget.properties&&I.featureTarget.properties.active===Ot.INACTIVE&&I.featureTarget.properties.meta===Ve.FEATURE}function li(I){return I.featureTarget===void 0}function Ni(I){return!!I.featureTarget&&!!I.featureTarget.properties&&I.featureTarget.properties.meta===Ve.FEATURE}function Qi(I){var L=I.featureTarget;return!!L&&!!L.properties&&L.properties.meta===Ve.VERTEX}function Di(I){return!!I.originalEvent&&I.originalEvent.shiftKey===!0}function Hi(I){return I.keyCode===27}function wi(I){return I.keyCode===13}var To=Object.freeze({__proto__:null,isOfMetaType:Re,isShiftMousedown:Et,isActiveFeature:Dt,isInactiveFeature:zt,noTarget:li,isFeature:Ni,isVertex:Qi,isShiftDown:Di,isEscapeKey:Hi,isEnterKey:wi,isTrue:function(){return!0}}),Eo=Ai;function Ai(I,L){this.x=I,this.y=L}Ai.prototype={clone:function(){return new Ai(this.x,this.y)},add:function(I){return this.clone()._add(I)},sub:function(I){return this.clone()._sub(I)},multByPoint:function(I){return this.clone()._multByPoint(I)},divByPoint:function(I){return this.clone()._divByPoint(I)},mult:function(I){return this.clone()._mult(I)},div:function(I){return this.clone()._div(I)},rotate:function(I){return this.clone()._rotate(I)},rotateAround:function(I,L){return this.clone()._rotateAround(I,L)},matMult:function(I){return this.clone()._matMult(I)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(I){return this.x===I.x&&this.y===I.y},dist:function(I){return Math.sqrt(this.distSqr(I))},distSqr:function(I){var L=I.x-this.x,V=I.y-this.y;return L*L+V*V},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(I){return Math.atan2(this.y-I.y,this.x-I.x)},angleWith:function(I){return this.angleWithSep(I.x,I.y)},angleWithSep:function(I,L){return Math.atan2(this.x*L-this.y*I,this.x*I+this.y*L)},_matMult:function(I){var L=I[0]*this.x+I[1]*this.y,V=I[2]*this.x+I[3]*this.y;return this.x=L,this.y=V,this},_add:function(I){return this.x+=I.x,this.y+=I.y,this},_sub:function(I){return this.x-=I.x,this.y-=I.y,this},_mult:function(I){return this.x*=I,this.y*=I,this},_div:function(I){return this.x/=I,this.y/=I,this},_multByPoint:function(I){return this.x*=I.x,this.y*=I.y,this},_divByPoint:function(I){return this.x/=I.x,this.y/=I.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var I=this.y;return this.y=this.x,this.x=-I,this},_rotate:function(I){var L=Math.cos(I),V=Math.sin(I),re=L*this.x-V*this.y,le=V*this.x+L*this.y;return this.x=re,this.y=le,this},_rotateAround:function(I,L){var V=Math.cos(I),re=Math.sin(I),le=L.x+V*(this.x-L.x)-re*(this.y-L.y),ue=L.y+re*(this.x-L.x)+V*(this.y-L.y);return this.x=le,this.y=ue,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ai.convert=function(I){return I instanceof Ai?I:Array.isArray(I)?new Ai(I[0],I[1]):I};var Uo=r(Eo);function Ns(I,L){var V=L.getBoundingClientRect();return new Uo(I.clientX-V.left-(L.clientLeft||0),I.clientY-V.top-(L.clientTop||0))}function ro(I,L,V,re){return{type:oe.FEATURE,properties:{meta:Ve.VERTEX,parent:I,coord_path:V,active:re?Ot.ACTIVE:Ot.INACTIVE},geometry:{type:oe.POINT,coordinates:L}}}function zs(I,L,V){var re=L.geometry.coordinates,le=V.geometry.coordinates;if(re[1]>85||re[1]<Qt||le[1]>85||le[1]<Qt)return null;var ue={lng:(re[0]+le[0])/2,lat:(re[1]+le[1])/2};return{type:oe.FEATURE,properties:{meta:Ve.MIDPOINT,parent:I,lng:ue.lng,lat:ue.lat,coord_path:V.properties.coord_path},geometry:{type:oe.POINT,coordinates:[ue.lng,ue.lat]}}}function Ts(I,L,V){L===void 0&&(L={}),V===void 0&&(V=null);var re,le=I.geometry,ue=le.type,_e=le.coordinates,Ke=I.properties&&I.properties.id,at=[];function _t(ft,yn){var Se="",Je=null;ft.forEach(function(vn,q){var Ie=yn!=null?yn+"."+q:String(q),mi=ro(Ke,vn,Ie,vt(Ie));if(L.midpoints&&Je){var tr=zs(Ke,Je,mi);tr&&at.push(tr)}Je=mi;var $n=JSON.stringify(vn);Se!==$n&&at.push(mi),q===0&&(Se=$n)})}function vt(ft){return!!L.selectedPaths&&L.selectedPaths.indexOf(ft)!==-1}return ue===oe.POINT?at.push(ro(Ke,_e,V,vt(V))):ue===oe.POLYGON?_e.forEach(function(ft,yn){_t(ft,V!==null?V+"."+yn:String(yn))}):ue===oe.LINE_STRING?_t(_e,V):ue.indexOf(oe.MULTI_PREFIX)===0&&(re=ue.replace(oe.MULTI_PREFIX,""),_e.forEach(function(ft,yn){var Se={type:oe.FEATURE,properties:I.properties,geometry:{type:re,coordinates:ft}};at=at.concat(Ts(Se,L,yn))})),at}var ko={enable:function(I){setTimeout(function(){I.map&&I.map.doubleClickZoom&&I._ctx&&I._ctx.store&&I._ctx.store.getInitialConfigValue&&I._ctx.store.getInitialConfigValue("doubleClickZoom")&&I.map.doubleClickZoom.enable()},0)},disable:function(I){setTimeout(function(){I.map&&I.map.doubleClickZoom&&I.map.doubleClickZoom.disable()},0)}},ve={exports:{}},Ce=function(I){if(!I||!I.type)return null;var L=Le[I.type];if(!L)return null;if(L==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:I}]};if(L==="feature")return{type:"FeatureCollection",features:[I]};if(L==="featurecollection")return I},Le={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ue=r(Ce),Ge=Object.freeze({__proto__:null,default:function I(L){switch(L&&L.type||null){case"FeatureCollection":return L.features=L.features.reduce(function(V,re){return V.concat(I(re))},[]),L;case"Feature":return L.geometry?I(L.geometry).map(function(V){var re={type:"Feature",properties:JSON.parse(JSON.stringify(L.properties)),geometry:V};return L.id!==void 0&&(re.id=L.id),re}):[L];case"MultiPoint":return L.coordinates.map(function(V){return{type:"Point",coordinates:V}});case"MultiPolygon":return L.coordinates.map(function(V){return{type:"Polygon",coordinates:V}});case"MultiLineString":return L.coordinates.map(function(V){return{type:"LineString",coordinates:V}});case"GeometryCollection":return L.geometries.map(I).reduce(function(V,re){return V.concat(re)},[]);case"Point":case"Polygon":case"LineString":return[L]}}}),Qe=Ce,nt=a(Ge),Ye=function(I){return function L(V){return Array.isArray(V)&&V.length&&typeof V[0]=="number"?[V]:V.reduce(function(re,le){return Array.isArray(le)&&Array.isArray(le[0])?re.concat(L(le)):(re.push(le),re)},[])}(I)};nt instanceof Function||(nt=nt.default);var ut={exports:{}},Be=ut.exports=function(I){return new Ft(I)};function Ft(I){this.value=I}function on(I,L,V){var re=[],le=[],ue=!0;return function _e(Ke){var at=V?Mt(Ke):Ke,_t={},vt=!0,ft={node:at,node_:Ke,path:[].concat(re),parent:le[le.length-1],parents:le,key:re.slice(-1)[0],isRoot:re.length===0,level:re.length,circular:null,update:function(Je,vn){ft.isRoot||(ft.parent.node[ft.key]=Je),ft.node=Je,vn&&(vt=!1)},delete:function(Je){delete ft.parent.node[ft.key],Je&&(vt=!1)},remove:function(Je){Gi(ft.parent.node)?ft.parent.node.splice(ft.key,1):delete ft.parent.node[ft.key],Je&&(vt=!1)},keys:null,before:function(Je){_t.before=Je},after:function(Je){_t.after=Je},pre:function(Je){_t.pre=Je},post:function(Je){_t.post=Je},stop:function(){ue=!1},block:function(){vt=!1}};if(!ue)return ft;function yn(){if(typeof ft.node=="object"&&ft.node!==null){ft.keys&&ft.node_===ft.node||(ft.keys=qt(ft.node)),ft.isLeaf=ft.keys.length==0;for(var Je=0;Je<le.length;Je++)if(le[Je].node_===Ke){ft.circular=le[Je];break}}else ft.isLeaf=!0,ft.keys=null;ft.notLeaf=!ft.isLeaf,ft.notRoot=!ft.isRoot}yn();var Se=L.call(ft,ft.node);return Se!==void 0&&ft.update&&ft.update(Se),_t.before&&_t.before.call(ft,ft.node),vt&&(typeof ft.node!="object"||ft.node===null||ft.circular||(le.push(ft),yn(),er(ft.keys,function(Je,vn){re.push(Je),_t.pre&&_t.pre.call(ft,ft.node[Je],Je);var q=_e(ft.node[Je]);V&&zr.call(ft.node,Je)&&(ft.node[Je]=q.node),q.isLast=vn==ft.keys.length-1,q.isFirst=vn==0,_t.post&&_t.post.call(ft,q),re.pop()}),le.pop()),_t.after&&_t.after.call(ft,ft.node)),ft}(I).node}function Mt(I){if(typeof I=="object"&&I!==null){var L;if(Gi(I))L=[];else if(ci(I)==="[object Date]")L=new Date(I.getTime?I.getTime():I);else if(function(le){return ci(le)==="[object RegExp]"}(I))L=new RegExp(I);else if(function(le){return ci(le)==="[object Error]"}(I))L={message:I.message};else if(function(le){return ci(le)==="[object Boolean]"}(I))L=new Boolean(I);else if(function(le){return ci(le)==="[object Number]"}(I))L=new Number(I);else if(function(le){return ci(le)==="[object String]"}(I))L=new String(I);else if(Object.create&&Object.getPrototypeOf)L=Object.create(Object.getPrototypeOf(I));else if(I.constructor===Object)L={};else{var V=I.constructor&&I.constructor.prototype||I.__proto__||{},re=function(){};re.prototype=V,L=new re}return er(qt(I),function(le){L[le]=I[le]}),L}return I}Ft.prototype.get=function(I){for(var L=this.value,V=0;V<I.length;V++){var re=I[V];if(!L||!zr.call(L,re)){L=void 0;break}L=L[re]}return L},Ft.prototype.has=function(I){for(var L=this.value,V=0;V<I.length;V++){var re=I[V];if(!L||!zr.call(L,re))return!1;L=L[re]}return!0},Ft.prototype.set=function(I,L){for(var V=this.value,re=0;re<I.length-1;re++){var le=I[re];zr.call(V,le)||(V[le]={}),V=V[le]}return V[I[re]]=L,L},Ft.prototype.map=function(I){return on(this.value,I,!0)},Ft.prototype.forEach=function(I){return this.value=on(this.value,I,!1),this.value},Ft.prototype.reduce=function(I,L){var V=arguments.length===1,re=V?this.value:L;return this.forEach(function(le){this.isRoot&&V||(re=I.call(this,re,le))}),re},Ft.prototype.paths=function(){var I=[];return this.forEach(function(L){I.push(this.path)}),I},Ft.prototype.nodes=function(){var I=[];return this.forEach(function(L){I.push(this.node)}),I},Ft.prototype.clone=function(){var I=[],L=[];return function V(re){for(var le=0;le<I.length;le++)if(I[le]===re)return L[le];if(typeof re=="object"&&re!==null){var ue=Mt(re);return I.push(re),L.push(ue),er(qt(re),function(_e){ue[_e]=V(re[_e])}),I.pop(),L.pop(),ue}return re}(this.value)};var qt=Object.keys||function(I){var L=[];for(var V in I)L.push(V);return L};function ci(I){return Object.prototype.toString.call(I)}var Gi=Array.isArray||function(I){return Object.prototype.toString.call(I)==="[object Array]"},er=function(I,L){if(I.forEach)return I.forEach(L);for(var V=0;V<I.length;V++)L(I[V],V,I)};er(qt(Ft.prototype),function(I){Be[I]=function(L){var V=[].slice.call(arguments,1),re=new Ft(L);return re[I].apply(re,V)}});var zr=Object.hasOwnProperty||function(I,L){return L in I},ns=ut.exports,Br=Pi;function Pi(I){if(!(this instanceof Pi))return new Pi(I);this._bbox=I||[1/0,1/0,-1/0,-1/0],this._valid=!!I}Pi.prototype.include=function(I){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],I[0]),this._bbox[1]=Math.min(this._bbox[1],I[1]),this._bbox[2]=Math.max(this._bbox[2],I[0]),this._bbox[3]=Math.max(this._bbox[3],I[1]),this},Pi.prototype.equals=function(I){var L;return L=I instanceof Pi?I.bbox():I,this._bbox[0]==L[0]&&this._bbox[1]==L[1]&&this._bbox[2]==L[2]&&this._bbox[3]==L[3]},Pi.prototype.center=function(I){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Pi.prototype.union=function(I){var L;return this._valid=!0,L=I instanceof Pi?I.bbox():I,this._bbox[0]=Math.min(this._bbox[0],L[0]),this._bbox[1]=Math.min(this._bbox[1],L[1]),this._bbox[2]=Math.max(this._bbox[2],L[2]),this._bbox[3]=Math.max(this._bbox[3],L[3]),this},Pi.prototype.bbox=function(){return this._valid?this._bbox:null},Pi.prototype.contains=function(I){if(!I)return this._fastContains();if(!this._valid)return null;var L=I[0],V=I[1];return this._bbox[0]<=L&&this._bbox[1]<=V&&this._bbox[2]>=L&&this._bbox[3]>=V},Pi.prototype.intersect=function(I){return this._valid?(L=I instanceof Pi?I.bbox():I,!(this._bbox[0]>L[2]||this._bbox[2]<L[0]||this._bbox[3]<L[1]||this._bbox[1]>L[3])):null;var L},Pi.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var I="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",I)},Pi.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Ir=function(I){if(!I)return[];var L=nt(Qe(I)),V=[];return L.features.forEach(function(re){re.geometry&&(V=V.concat(Ye(re.geometry.coordinates)))}),V},Ra=ns,Bs=Br,us={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},zl=Object.keys(us);function il(I){for(var L=Bs(),V=Ir(I),re=0;re<V.length;re++)L.include(V[re]);return L}ve.exports=function(I){return il(I).bbox()},ve.exports.polygon=function(I){return il(I).polygon()},ve.exports.bboxify=function(I){return Ra(I).map(function(L){L&&zl.some(function(V){return!!L[V]&&us[V].indexOf(L.type)!==-1})&&(L.bbox=il(L).bbox(),this.update(L))})};var yf=r(ve.exports),Bl=-90;function Rd(I,L){var V=Bl,re=90,le=Bl,ue=90,_e=270,Ke=-270;I.forEach(function(_t){var vt=yf(_t),ft=vt[1],yn=vt[3],Se=vt[0],Je=vt[2];ft>V&&(V=ft),yn<re&&(re=yn),yn>le&&(le=yn),ft<ue&&(ue=ft),Se<_e&&(_e=Se),Je>Ke&&(Ke=Je)});var at=L;return V+at.lat>85&&(at.lat=85-V),le+at.lat>90&&(at.lat=90-le),re+at.lat<-85&&(at.lat=-85-re),ue+at.lat<Bl&&(at.lat=Bl-ue),_e+at.lng<=-270&&(at.lng+=360*Math.ceil(Math.abs(at.lng)/360)),Ke+at.lng>=270&&(at.lng-=360*Math.ceil(Math.abs(at.lng)/360)),at}function jl(I,L){var V=Rd(I.map(function(re){return re.toGeoJSON()}),L);I.forEach(function(re){var le,ue=re.getCoordinates(),_e=function(at){var _t={lng:at[0]+V.lng,lat:at[1]+V.lat};return[_t.lng,_t.lat]},Ke=function(at){return at.map(function(_t){return _e(_t)})};re.type===oe.POINT?le=_e(ue):re.type===oe.LINE_STRING||re.type===oe.MULTI_POINT?le=ue.map(_e):re.type===oe.POLYGON||re.type===oe.MULTI_LINE_STRING?le=ue.map(Ke):re.type===oe.MULTI_POLYGON&&(le=ue.map(function(at){return at.map(function(_t){return Ke(_t)})})),re.incomingCoords(le)})}var Cr={onSetup:function(I){var L=this,V={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:I.featureIds||[]};return this.setSelected(V.initiallySelectedFeatureIds.filter(function(re){return L.getFeature(re)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),V},fireUpdate:function(){this.map.fire(ke.UPDATE,{action:rt.MOVE,features:this.getSelected().map(function(I){return I.toGeoJSON()})})},fireActionable:function(){var I=this,L=this.getSelected(),V=L.filter(function(Ke){return I.isInstanceOf("MultiFeature",Ke)}),re=!1;if(L.length>1){re=!0;var le=L[0].type.replace("Multi","");L.forEach(function(Ke){Ke.type.replace("Multi","")!==le&&(re=!1)})}var ue=V.length>0,_e=L.length>0;this.setActionableState({combineFeatures:re,uncombineFeatures:ue,trash:_e})},getUniqueIds:function(I){return I.length?I.map(function(L){return L.properties.id}).filter(function(L){return L!==void 0}).reduce(function(L,V){return L.add(V),L},new ar).values():[]},stopExtendedInteractions:function(I){I.boxSelectElement&&(I.boxSelectElement.parentNode&&I.boxSelectElement.parentNode.removeChild(I.boxSelectElement),I.boxSelectElement=null),this.map.dragPan.enable(),I.boxSelecting=!1,I.canBoxSelect=!1,I.dragMoving=!1,I.canDragMove=!1},onStop:function(){ko.enable(this)},onMouseMove:function(I,L){return Ni(L)&&I.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(I),!0},onMouseOut:function(I){return!I.dragMoving||this.fireUpdate()}};Cr.onTap=Cr.onClick=function(I,L){return li(L)?this.clickAnywhere(I,L):Re(Ve.VERTEX)(L)?this.clickOnVertex(I,L):Ni(L)?this.clickOnFeature(I,L):void 0},Cr.clickAnywhere=function(I){var L=this,V=this.getSelectedIds();V.length&&(this.clearSelectedFeatures(),V.forEach(function(re){return L.doRender(re)})),ko.enable(this),this.stopExtendedInteractions(I)},Cr.clickOnVertex=function(I,L){this.changeMode(he.DIRECT_SELECT,{featureId:L.featureTarget.properties.parent,coordPath:L.featureTarget.properties.coord_path,startPos:L.lngLat}),this.updateUIClasses({mouse:j.MOVE})},Cr.startOnActiveFeature=function(I,L){this.stopExtendedInteractions(I),this.map.dragPan.disable(),this.doRender(L.featureTarget.properties.id),I.canDragMove=!0,I.dragMoveLocation=L.lngLat},Cr.clickOnFeature=function(I,L){var V=this;ko.disable(this),this.stopExtendedInteractions(I);var re=Di(L),le=this.getSelectedIds(),ue=L.featureTarget.properties.id,_e=this.isSelected(ue);if(!re&&_e&&this.getFeature(ue).type!==oe.POINT)return this.changeMode(he.DIRECT_SELECT,{featureId:ue});_e&&re?(this.deselect(ue),this.updateUIClasses({mouse:j.POINTER}),le.length===1&&ko.enable(this)):!_e&&re?(this.select(ue),this.updateUIClasses({mouse:j.MOVE})):_e||re||(le.forEach(function(Ke){return V.doRender(Ke)}),this.setSelected(ue),this.updateUIClasses({mouse:j.MOVE})),this.doRender(ue)},Cr.onMouseDown=function(I,L){return Dt(L)?this.startOnActiveFeature(I,L):this.drawConfig.boxSelect&&Et(L)?this.startBoxSelect(I,L):void 0},Cr.startBoxSelect=function(I,L){this.stopExtendedInteractions(I),this.map.dragPan.disable(),I.boxSelectStartLocation=Ns(L.originalEvent,this.map.getContainer()),I.canBoxSelect=!0},Cr.onTouchStart=function(I,L){if(Dt(L))return this.startOnActiveFeature(I,L)},Cr.onDrag=function(I,L){return I.canDragMove?this.dragMove(I,L):this.drawConfig.boxSelect&&I.canBoxSelect?this.whileBoxSelect(I,L):void 0},Cr.whileBoxSelect=function(I,L){I.boxSelecting=!0,this.updateUIClasses({mouse:j.ADD}),I.boxSelectElement||(I.boxSelectElement=document.createElement("div"),I.boxSelectElement.classList.add(D.BOX_SELECT),this.map.getContainer().appendChild(I.boxSelectElement));var V=Ns(L.originalEvent,this.map.getContainer()),re=Math.min(I.boxSelectStartLocation.x,V.x),le=Math.max(I.boxSelectStartLocation.x,V.x),ue=Math.min(I.boxSelectStartLocation.y,V.y),_e=Math.max(I.boxSelectStartLocation.y,V.y),Ke="translate("+re+"px, "+ue+"px)";I.boxSelectElement.style.transform=Ke,I.boxSelectElement.style.WebkitTransform=Ke,I.boxSelectElement.style.width=le-re+"px",I.boxSelectElement.style.height=_e-ue+"px"},Cr.dragMove=function(I,L){I.dragMoving=!0,L.originalEvent.stopPropagation();var V={lng:L.lngLat.lng-I.dragMoveLocation.lng,lat:L.lngLat.lat-I.dragMoveLocation.lat};jl(this.getSelected(),V),I.dragMoveLocation=L.lngLat},Cr.onTouchEnd=Cr.onMouseUp=function(I,L){var V=this;if(I.dragMoving)this.fireUpdate();else if(I.boxSelecting){var re=[I.boxSelectStartLocation,Ns(L.originalEvent,this.map.getContainer())],le=this.featuresAt(null,re,"click"),ue=this.getUniqueIds(le).filter(function(_e){return!V.isSelected(_e)});ue.length&&(this.select(ue),ue.forEach(function(_e){return V.doRender(_e)}),this.updateUIClasses({mouse:j.MOVE}))}this.stopExtendedInteractions(I)},Cr.toDisplayFeatures=function(I,L,V){L.properties.active=this.isSelected(L.properties.id)?Ot.ACTIVE:Ot.INACTIVE,V(L),this.fireActionable(),L.properties.active===Ot.ACTIVE&&L.geometry.type!==oe.POINT&&Ts(L).forEach(V)},Cr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Cr.onCombineFeatures=function(){var I=this.getSelected();if(!(I.length===0||I.length<2)){for(var L=[],V=[],re=I[0].type.replace("Multi",""),le=0;le<I.length;le++){var ue=I[le];if(ue.type.replace("Multi","")!==re)return;ue.type.includes("Multi")?ue.getCoordinates().forEach(function(Ke){L.push(Ke)}):L.push(ue.getCoordinates()),V.push(ue.toGeoJSON())}if(V.length>1){var _e=this.newFeature({type:oe.FEATURE,properties:V[0].properties,geometry:{type:"Multi"+re,coordinates:L}});this.addFeature(_e),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([_e.id]),this.map.fire(ke.COMBINE_FEATURES,{createdFeatures:[_e.toGeoJSON()],deletedFeatures:V})}this.fireActionable()}},Cr.onUncombineFeatures=function(){var I=this,L=this.getSelected();if(L.length!==0){for(var V=[],re=[],le=function(_e){var Ke=L[_e];I.isInstanceOf("MultiFeature",Ke)&&(Ke.getFeatures().forEach(function(at){I.addFeature(at),at.properties=Ke.properties,V.push(at.toGeoJSON()),I.select([at.id])}),I.deleteFeature(Ke.id,{silent:!0}),re.push(Ke.toGeoJSON()))},ue=0;ue<L.length;ue++)le(ue);V.length>1&&this.map.fire(ke.UNCOMBINE_FEATURES,{createdFeatures:V,deletedFeatures:re}),this.fireActionable()}};var js=Re(Ve.VERTEX),La=Re(Ve.MIDPOINT),ds={fireUpdate:function(){this.map.fire(ke.UPDATE,{action:rt.CHANGE_COORDINATES,features:this.getSelected().map(function(I){return I.toGeoJSON()})})},fireActionable:function(I){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:I.selectedCoordPaths.length>0})},startDragging:function(I,L){this.map.dragPan.disable(),I.canDragMove=!0,I.dragMoveLocation=L.lngLat},stopDragging:function(I){this.map.dragPan.enable(),I.dragMoving=!1,I.canDragMove=!1,I.dragMoveLocation=null},onVertex:function(I,L){this.startDragging(I,L);var V=L.featureTarget.properties,re=I.selectedCoordPaths.indexOf(V.coord_path);Di(L)||re!==-1?Di(L)&&re===-1&&I.selectedCoordPaths.push(V.coord_path):I.selectedCoordPaths=[V.coord_path];var le=this.pathsToCoordinates(I.featureId,I.selectedCoordPaths);this.setSelectedCoordinates(le)},onMidpoint:function(I,L){this.startDragging(I,L);var V=L.featureTarget.properties;I.feature.addCoordinate(V.coord_path,V.lng,V.lat),this.fireUpdate(),I.selectedCoordPaths=[V.coord_path]},pathsToCoordinates:function(I,L){return L.map(function(V){return{feature_id:I,coord_path:V}})},onFeature:function(I,L){I.selectedCoordPaths.length===0?this.startDragging(I,L):this.stopDragging(I)},dragFeature:function(I,L,V){jl(this.getSelected(),V),I.dragMoveLocation=L.lngLat},dragVertex:function(I,L,V){for(var re=I.selectedCoordPaths.map(function(Ke){return I.feature.getCoordinate(Ke)}),le=Rd(re.map(function(Ke){return{type:oe.FEATURE,properties:{},geometry:{type:oe.POINT,coordinates:Ke}}}),V),ue=0;ue<re.length;ue++){var _e=re[ue];I.feature.updateCoordinate(I.selectedCoordPaths[ue],_e[0]+le.lng,_e[1]+le.lat)}},clickNoTarget:function(){this.changeMode(he.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(he.SIMPLE_SELECT)},clickActiveFeature:function(I){I.selectedCoordPaths=[],this.clearSelectedCoordinates(),I.feature.changed()},onSetup:function(I){var L=I.featureId,V=this.getFeature(L);if(!V)throw new Error("You must provide a featureId to enter direct_select mode");if(V.type===oe.POINT)throw new TypeError("direct_select mode doesn't handle point features");var re={featureId:L,feature:V,dragMoveLocation:I.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:I.coordPath?[I.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(L,re.selectedCoordPaths)),this.setSelected(L),ko.disable(this),this.setActionableState({trash:!0}),re},onStop:function(){ko.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(I,L,V){I.featureId===L.properties.id?(L.properties.active=Ot.ACTIVE,V(L),Ts(L,{map:this.map,midpoints:!0,selectedPaths:I.selectedCoordPaths}).forEach(V)):(L.properties.active=Ot.INACTIVE,V(L)),this.fireActionable(I)},onTrash:function(I){I.selectedCoordPaths.sort(function(L,V){return V.localeCompare(L,"en",{numeric:!0})}).forEach(function(L){return I.feature.removeCoordinate(L)}),this.fireUpdate(),I.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(I),I.feature.isValid()===!1&&(this.deleteFeature([I.featureId]),this.changeMode(he.SIMPLE_SELECT,{}))},onMouseMove:function(I,L){var V=Dt(L),re=js(L),le=La(L),ue=I.selectedCoordPaths.length===0;return V&&ue||re&&!ue?this.updateUIClasses({mouse:j.MOVE}):this.updateUIClasses({mouse:j.NONE}),(re||V||le)&&I.dragMoving&&this.fireUpdate(),this.stopDragging(I),!0},onMouseOut:function(I){return I.dragMoving&&this.fireUpdate(),!0}};ds.onTouchStart=ds.onMouseDown=function(I,L){return js(L)?this.onVertex(I,L):Dt(L)?this.onFeature(I,L):La(L)?this.onMidpoint(I,L):void 0},ds.onDrag=function(I,L){if(I.canDragMove===!0){I.dragMoving=!0,L.originalEvent.stopPropagation();var V={lng:L.lngLat.lng-I.dragMoveLocation.lng,lat:L.lngLat.lat-I.dragMoveLocation.lat};I.selectedCoordPaths.length>0?this.dragVertex(I,L,V):this.dragFeature(I,L,V),I.dragMoveLocation=L.lngLat}},ds.onClick=function(I,L){return li(L)?this.clickNoTarget(I,L):Dt(L)?this.clickActiveFeature(I,L):zt(L)?this.clickInactive(I,L):void this.stopDragging(I)},ds.onTap=function(I,L){return li(L)?this.clickNoTarget(I,L):Dt(L)?this.clickActiveFeature(I,L):zt(L)?this.clickInactive(I,L):void 0},ds.onTouchEnd=ds.onMouseUp=function(I){I.dragMoving&&this.fireUpdate(),this.stopDragging(I)};var hs={};function bc(I,L){return!!I.lngLat&&I.lngLat.lng===L[0]&&I.lngLat.lat===L[1]}hs.onSetup=function(){var I=this.newFeature({type:oe.FEATURE,properties:{},geometry:{type:oe.POINT,coordinates:[]}});return this.addFeature(I),this.clearSelectedFeatures(),this.updateUIClasses({mouse:j.ADD}),this.activateUIButton(ie.POINT),this.setActionableState({trash:!0}),{point:I}},hs.stopDrawingAndRemove=function(I){this.deleteFeature([I.point.id],{silent:!0}),this.changeMode(he.SIMPLE_SELECT)},hs.onTap=hs.onClick=function(I,L){this.updateUIClasses({mouse:j.MOVE}),I.point.updateCoordinate("",L.lngLat.lng,L.lngLat.lat),this.map.fire(ke.CREATE,{features:[I.point.toGeoJSON()]}),this.changeMode(he.SIMPLE_SELECT,{featureIds:[I.point.id]})},hs.onStop=function(I){this.activateUIButton(),I.point.getCoordinate().length||this.deleteFeature([I.point.id],{silent:!0})},hs.toDisplayFeatures=function(I,L,V){var re=L.properties.id===I.point.id;if(L.properties.active=re?Ot.ACTIVE:Ot.INACTIVE,!re)return V(L)},hs.onTrash=hs.stopDrawingAndRemove,hs.onKeyUp=function(I,L){if(Hi(L)||wi(L))return this.stopDrawingAndRemove(I,L)};var ca={onSetup:function(){var I=this.newFeature({type:oe.FEATURE,properties:{},geometry:{type:oe.POLYGON,coordinates:[[]]}});return this.addFeature(I),this.clearSelectedFeatures(),ko.disable(this),this.updateUIClasses({mouse:j.ADD}),this.activateUIButton(ie.POLYGON),this.setActionableState({trash:!0}),{polygon:I,currentVertexPosition:0}},clickAnywhere:function(I,L){if(I.currentVertexPosition>0&&bc(L,I.polygon.coordinates[0][I.currentVertexPosition-1]))return this.changeMode(he.SIMPLE_SELECT,{featureIds:[I.polygon.id]});this.updateUIClasses({mouse:j.ADD}),I.polygon.updateCoordinate("0."+I.currentVertexPosition,L.lngLat.lng,L.lngLat.lat),I.currentVertexPosition++,I.polygon.updateCoordinate("0."+I.currentVertexPosition,L.lngLat.lng,L.lngLat.lat)},clickOnVertex:function(I){return this.changeMode(he.SIMPLE_SELECT,{featureIds:[I.polygon.id]})},onMouseMove:function(I,L){I.polygon.updateCoordinate("0."+I.currentVertexPosition,L.lngLat.lng,L.lngLat.lat),Qi(L)&&this.updateUIClasses({mouse:j.POINTER})}};ca.onTap=ca.onClick=function(I,L){return Qi(L)?this.clickOnVertex(I,L):this.clickAnywhere(I,L)},ca.onKeyUp=function(I,L){Hi(L)?(this.deleteFeature([I.polygon.id],{silent:!0}),this.changeMode(he.SIMPLE_SELECT)):wi(L)&&this.changeMode(he.SIMPLE_SELECT,{featureIds:[I.polygon.id]})},ca.onStop=function(I){this.updateUIClasses({mouse:j.NONE}),ko.enable(this),this.activateUIButton(),this.getFeature(I.polygon.id)!==void 0&&(I.polygon.removeCoordinate("0."+I.currentVertexPosition),I.polygon.isValid()?this.map.fire(ke.CREATE,{features:[I.polygon.toGeoJSON()]}):(this.deleteFeature([I.polygon.id],{silent:!0}),this.changeMode(he.SIMPLE_SELECT,{},{silent:!0})))},ca.toDisplayFeatures=function(I,L,V){var re=L.properties.id===I.polygon.id;if(L.properties.active=re?Ot.ACTIVE:Ot.INACTIVE,!re)return V(L);if(L.geometry.coordinates.length!==0){var le=L.geometry.coordinates[0].length;if(!(le<3)){if(L.properties.meta=Ve.FEATURE,V(ro(I.polygon.id,L.geometry.coordinates[0][0],"0.0",!1)),le>3){var ue=L.geometry.coordinates[0].length-3;V(ro(I.polygon.id,L.geometry.coordinates[0][ue],"0."+ue,!1))}if(le<=4){var _e=[[L.geometry.coordinates[0][0][0],L.geometry.coordinates[0][0][1]],[L.geometry.coordinates[0][1][0],L.geometry.coordinates[0][1][1]]];if(V({type:oe.FEATURE,properties:L.properties,geometry:{coordinates:_e,type:oe.LINE_STRING}}),le===3)return}return V(L)}}},ca.onTrash=function(I){this.deleteFeature([I.polygon.id],{silent:!0}),this.changeMode(he.SIMPLE_SELECT)};var ua={onSetup:function(I){var L,V,re=(I=I||{}).featureId,le="forward";if(re){if(!(L=this.getFeature(re)))throw new Error("Could not find a feature with the provided featureId");var ue=I.from;if(ue&&ue.type==="Feature"&&ue.geometry&&ue.geometry.type==="Point"&&(ue=ue.geometry),ue&&ue.type==="Point"&&ue.coordinates&&ue.coordinates.length===2&&(ue=ue.coordinates),!ue||!Array.isArray(ue))throw new Error("Please use the `from` property to indicate which point to continue the line from");var _e=L.coordinates.length-1;if(L.coordinates[_e][0]===ue[0]&&L.coordinates[_e][1]===ue[1])V=_e+1,L.addCoordinate.apply(L,[V].concat(L.coordinates[_e]));else{if(L.coordinates[0][0]!==ue[0]||L.coordinates[0][1]!==ue[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");le="backwards",V=0,L.addCoordinate.apply(L,[V].concat(L.coordinates[0]))}}else L=this.newFeature({type:oe.FEATURE,properties:{},geometry:{type:oe.LINE_STRING,coordinates:[]}}),V=0,this.addFeature(L);return this.clearSelectedFeatures(),ko.disable(this),this.updateUIClasses({mouse:j.ADD}),this.activateUIButton(ie.LINE),this.setActionableState({trash:!0}),{line:L,currentVertexPosition:V,direction:le}},clickAnywhere:function(I,L){if(I.currentVertexPosition>0&&bc(L,I.line.coordinates[I.currentVertexPosition-1])||I.direction==="backwards"&&bc(L,I.line.coordinates[I.currentVertexPosition+1]))return this.changeMode(he.SIMPLE_SELECT,{featureIds:[I.line.id]});this.updateUIClasses({mouse:j.ADD}),I.line.updateCoordinate(I.currentVertexPosition,L.lngLat.lng,L.lngLat.lat),I.direction==="forward"?(I.currentVertexPosition++,I.line.updateCoordinate(I.currentVertexPosition,L.lngLat.lng,L.lngLat.lat)):I.line.addCoordinate(0,L.lngLat.lng,L.lngLat.lat)},clickOnVertex:function(I){return this.changeMode(he.SIMPLE_SELECT,{featureIds:[I.line.id]})},onMouseMove:function(I,L){I.line.updateCoordinate(I.currentVertexPosition,L.lngLat.lng,L.lngLat.lat),Qi(L)&&this.updateUIClasses({mouse:j.POINTER})}};ua.onTap=ua.onClick=function(I,L){if(Qi(L))return this.clickOnVertex(I,L);this.clickAnywhere(I,L)},ua.onKeyUp=function(I,L){wi(L)?this.changeMode(he.SIMPLE_SELECT,{featureIds:[I.line.id]}):Hi(L)&&(this.deleteFeature([I.line.id],{silent:!0}),this.changeMode(he.SIMPLE_SELECT))},ua.onStop=function(I){ko.enable(this),this.activateUIButton(),this.getFeature(I.line.id)!==void 0&&(I.line.removeCoordinate(""+I.currentVertexPosition),I.line.isValid()?this.map.fire(ke.CREATE,{features:[I.line.toGeoJSON()]}):(this.deleteFeature([I.line.id],{silent:!0}),this.changeMode(he.SIMPLE_SELECT,{},{silent:!0})))},ua.onTrash=function(I){this.deleteFeature([I.line.id],{silent:!0}),this.changeMode(he.SIMPLE_SELECT)},ua.toDisplayFeatures=function(I,L,V){var re=L.properties.id===I.line.id;if(L.properties.active=re?Ot.ACTIVE:Ot.INACTIVE,!re)return V(L);L.geometry.coordinates.length<2||(L.properties.meta=Ve.FEATURE,V(ro(I.line.id,L.geometry.coordinates[I.direction==="forward"?L.geometry.coordinates.length-2:1],""+(I.direction==="forward"?L.geometry.coordinates.length-2:1),!1)),V(L))};var Vl={simple_select:Cr,direct_select:ds,draw_point:hs,draw_polygon:ca,draw_line_string:ua},Ul={defaultMode:he.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:ht,modes:Vl,controls:{},userProperties:!1},Es={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Fa={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function rl(I,L){return I.map(function(V){return V.source?V:we(V,{id:V.id+"."+L,source:L==="hot"?z.HOT:z.COLD})})}var ol={exports:{}};(function(I,L){var V="__lodash_hash_undefined__",re=9007199254740991,le="[object Arguments]",ue="[object Array]",_e="[object Boolean]",Ke="[object Date]",at="[object Error]",_t="[object Function]",vt="[object Map]",ft="[object Number]",yn="[object Object]",Se="[object Promise]",Je="[object RegExp]",vn="[object Set]",q="[object String]",Ie="[object Symbol]",mi="[object WeakMap]",tr="[object ArrayBuffer]",$n="[object DataView]",Bt=/^\[object .+?Constructor\]$/,xe=/^(?:0|[1-9]\d*)$/,$e={};$e["[object Float32Array]"]=$e["[object Float64Array]"]=$e["[object Int8Array]"]=$e["[object Int16Array]"]=$e["[object Int32Array]"]=$e["[object Uint8Array]"]=$e["[object Uint8ClampedArray]"]=$e["[object Uint16Array]"]=$e["[object Uint32Array]"]=!0,$e[le]=$e[ue]=$e[tr]=$e[_e]=$e[$n]=$e[Ke]=$e[at]=$e[_t]=$e[vt]=$e[ft]=$e[yn]=$e[Je]=$e[vn]=$e[q]=$e[mi]=!1;var Wt=typeof global=="object"&&global&&global.Object===Object&&global,lr=typeof self=="object"&&self&&self.Object===Object&&self,Wi=Wt||lr||Function("return this")(),Ze=L&&!L.nodeType&&L,Jt=Ze&&I&&!I.nodeType&&I,Sn=Jt&&Jt.exports===Ze,fo=Sn&&Wt.process,Yr=function(){try{return fo&&fo.binding&&fo.binding("util")}catch{}}(),Ln=Yr&&Yr.isTypedArray;function Tc(ye,Oe){for(var ne=-1,sn=ye==null?0:ye.length;++ne<sn;)if(Oe(ye[ne],ne,ye))return!0;return!1}function Ld(ye){var Oe=-1,ne=Array(ye.size);return ye.forEach(function(sn,_r){ne[++Oe]=[_r,sn]}),ne}function Fd(ye){var Oe=-1,ne=Array(ye.size);return ye.forEach(function(sn){ne[++Oe]=sn}),ne}var is,Sr,ny,kd=Array.prototype,bm=Function.prototype,$l=Object.prototype,Nd=Wi["__core-js_shared__"],wm=bm.toString,Ms=$l.hasOwnProperty,xf=(is=/[^.]+$/.exec(Nd&&Nd.keys&&Nd.keys.IE_PROTO||""))?"Symbol(src)_1."+is:"",zd=$l.toString,Tm=RegExp("^"+wm.call(Ms).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rs=Sn?Wi.Buffer:void 0,tn=Wi.Symbol,bf=Wi.Uint8Array,wf=$l.propertyIsEnumerable,fs=kd.splice,No=tn?tn.toStringTag:void 0,Em=Object.getOwnPropertySymbols,Iu=rs?rs.isBuffer:void 0,oo=(Sr=Object.keys,ny=Object,function(ye){return Sr(ny(ye))}),Ec=Cs(Wi,"DataView"),Mc=Cs(Wi,"Map"),Ic=Cs(Wi,"Promise"),Xr=Cs(Wi,"Set"),Bd=Cs(Wi,"WeakMap"),Cc=Cs(Object,"create"),sl=Gl(Ec),jd=Gl(Mc),Vd=Gl(Ic),ui=Gl(Xr),ew=Gl(Bd),Tf=tn?tn.prototype:void 0,al=Tf?Tf.valueOf:void 0;function Sc(ye){var Oe=-1,ne=ye==null?0:ye.length;for(this.clear();++Oe<ne;){var sn=ye[Oe];this.set(sn[0],sn[1])}}function ka(ye){var Oe=-1,ne=ye==null?0:ye.length;for(this.clear();++Oe<ne;){var sn=ye[Oe];this.set(sn[0],sn[1])}}function Is(ye){var Oe=-1,ne=ye==null?0:ye.length;for(this.clear();++Oe<ne;){var sn=ye[Oe];this.set(sn[0],sn[1])}}function Ef(ye){var Oe=-1,ne=ye==null?0:ye.length;for(this.__data__=new Is;++Oe<ne;)this.add(ye[Oe])}function $o(ye){var Oe=this.__data__=new ka(ye);this.size=Oe.size}function Mf(ye,Oe){var ne=Gd(ye),sn=!ne&&Im(ye),_r=!ne&&!sn&&If(ye),gi=!ne&&!sn&&!_r&&Dm(ye),Gr=ne||sn||_r||gi,Wr=Gr?function(Dr,Ss){for(var ps=-1,Ho=Array(Dr);++ps<Dr;)Ho[ps]=Ss(ps);return Ho}(ye.length,String):[],Io=Wr.length;for(var so in ye)!Oe&&!Ms.call(ye,so)||Gr&&(so=="length"||_r&&(so=="offset"||so=="parent")||gi&&(so=="buffer"||so=="byteLength"||so=="byteOffset")||iw(so,Io))||Wr.push(so);return Wr}function Ud(ye,Oe){for(var ne=ye.length;ne--;)if(ry(ye[ne][0],Oe))return ne;return-1}function $d(ye){return ye==null?ye===void 0?"[object Undefined]":"[object Null]":No&&No in Object(ye)?function(Oe){var ne=Ms.call(Oe,No),sn=Oe[No];try{Oe[No]=void 0;var _r=!0}catch{}var gi=zd.call(Oe);return _r&&(ne?Oe[No]=sn:delete Oe[No]),gi}(ye):function(Oe){return zd.call(Oe)}(ye)}function iy(ye){return Pc(ye)&&$d(ye)==le}function Cu(ye,Oe,ne,sn,_r){return ye===Oe||(ye==null||Oe==null||!Pc(ye)&&!Pc(Oe)?ye!=ye&&Oe!=Oe:function(gi,Gr,Wr,Io,so,Dr){var Ss=Gd(gi),ps=Gd(Gr),Ho=Ss?ue:Hl(gi),ll=ps?ue:Hl(Gr),Oc=(Ho=Ho==le?yn:Ho)==yn,Wd=(ll=ll==le?yn:ll)==yn,Wl=Ho==ll;if(Wl&&If(gi)){if(!If(Gr))return!1;Ss=!0,Oc=!1}if(Wl&&!Oc)return Dr||(Dr=new $o),Ss||Dm(gi)?Dc(gi,Gr,Wr,Io,so,Dr):function(cr,nr,Rc,ql,Cf,ms,Vs){switch(Rc){case $n:if(cr.byteLength!=nr.byteLength||cr.byteOffset!=nr.byteOffset)return!1;cr=cr.buffer,nr=nr.buffer;case tr:return!(cr.byteLength!=nr.byteLength||!ms(new bf(cr),new bf(nr)));case _e:case Ke:case ft:return ry(+cr,+nr);case at:return cr.name==nr.name&&cr.message==nr.message;case Je:case q:return cr==nr+"";case vt:var Na=Ld;case vn:var cl=1&ql;if(Na||(Na=Fd),cr.size!=nr.size&&!cl)return!1;var Du=Vs.get(cr);if(Du)return Du==nr;ql|=2,Vs.set(cr,nr);var da=Dc(Na(cr),Na(nr),ql,Cf,ms,Vs);return Vs.delete(cr),da;case Ie:if(al)return al.call(cr)==al.call(nr)}return!1}(gi,Gr,Ho,Wr,Io,so,Dr);if(!(1&Wr)){var qd=Oc&&Ms.call(gi,"__wrapped__"),oy=Wd&&Ms.call(Gr,"__wrapped__");if(qd||oy){var rw=qd?gi.value():gi,ow=oy?Gr.value():Gr;return Dr||(Dr=new $o),so(rw,ow,Wr,Io,Dr)}}return Wl?(Dr||(Dr=new $o),function(cr,nr,Rc,ql,Cf,ms){var Vs=1&Rc,Na=Mm(cr),cl=Na.length,Du=Mm(nr).length;if(cl!=Du&&!Vs)return!1;for(var da=cl;da--;){var ha=Na[da];if(!(Vs?ha in nr:Ms.call(nr,ha)))return!1}var Sf=ms.get(cr);if(Sf&&ms.get(nr))return Sf==nr;var ul=!0;ms.set(cr,nr),ms.set(nr,cr);for(var Zd=Vs;++da<cl;){var Yd=cr[ha=Na[da]],Au=nr[ha];if(ql)var Pm=Vs?ql(Au,Yd,ha,nr,cr,ms):ql(Yd,Au,ha,cr,nr,ms);if(!(Pm===void 0?Yd===Au||Cf(Yd,Au,Rc,ql,ms):Pm)){ul=!1;break}Zd||(Zd=ha=="constructor")}if(ul&&!Zd){var Pu=cr.constructor,Lc=nr.constructor;Pu==Lc||!("constructor"in cr)||!("constructor"in nr)||typeof Pu=="function"&&Pu instanceof Pu&&typeof Lc=="function"&&Lc instanceof Lc||(ul=!1)}return ms.delete(cr),ms.delete(nr),ul}(gi,Gr,Wr,Io,so,Dr)):!1}(ye,Oe,ne,sn,Cu,_r))}function Hd(ye){return!(!Su(ye)||function(Oe){return!!xf&&xf in Oe}(ye))&&(Cm(ye)?Tm:Bt).test(Gl(ye))}function tw(ye){if(ne=(Oe=ye)&&Oe.constructor,sn=typeof ne=="function"&&ne.prototype||$l,Oe!==sn)return oo(ye);var Oe,ne,sn,_r=[];for(var gi in Object(ye))Ms.call(ye,gi)&&gi!="constructor"&&_r.push(gi);return _r}function Dc(ye,Oe,ne,sn,_r,gi){var Gr=1&ne,Wr=ye.length,Io=Oe.length;if(Wr!=Io&&!(Gr&&Io>Wr))return!1;var so=gi.get(ye);if(so&&gi.get(Oe))return so==Oe;var Dr=-1,Ss=!0,ps=2&ne?new Ef:void 0;for(gi.set(ye,Oe),gi.set(Oe,ye);++Dr<Wr;){var Ho=ye[Dr],ll=Oe[Dr];if(sn)var Oc=Gr?sn(ll,Ho,Dr,Oe,ye,gi):sn(Ho,ll,Dr,ye,Oe,gi);if(Oc!==void 0){if(Oc)continue;Ss=!1;break}if(ps){if(!Tc(Oe,function(Wd,Wl){if(qd=Wl,!ps.has(qd)&&(Ho===Wd||_r(Ho,Wd,ne,sn,gi)))return ps.push(Wl);var qd})){Ss=!1;break}}else if(Ho!==ll&&!_r(Ho,ll,ne,sn,gi)){Ss=!1;break}}return gi.delete(ye),gi.delete(Oe),Ss}function Mm(ye){return function(Oe,ne,sn){var _r=ne(Oe);return Gd(Oe)?_r:function(gi,Gr){for(var Wr=-1,Io=Gr.length,so=gi.length;++Wr<Io;)gi[so+Wr]=Gr[Wr];return gi}(_r,sn(Oe))}(ye,Am,nw)}function Ac(ye,Oe){var ne,sn,_r=ye.__data__;return((sn=typeof(ne=Oe))=="string"||sn=="number"||sn=="symbol"||sn=="boolean"?ne!=="__proto__":ne===null)?_r[typeof Oe=="string"?"string":"hash"]:_r.map}function Cs(ye,Oe){var ne=function(sn,_r){return sn?.[_r]}(ye,Oe);return Hd(ne)?ne:void 0}Sc.prototype.clear=function(){this.__data__=Cc?Cc(null):{},this.size=0},Sc.prototype.delete=function(ye){var Oe=this.has(ye)&&delete this.__data__[ye];return this.size-=Oe?1:0,Oe},Sc.prototype.get=function(ye){var Oe=this.__data__;if(Cc){var ne=Oe[ye];return ne===V?void 0:ne}return Ms.call(Oe,ye)?Oe[ye]:void 0},Sc.prototype.has=function(ye){var Oe=this.__data__;return Cc?Oe[ye]!==void 0:Ms.call(Oe,ye)},Sc.prototype.set=function(ye,Oe){var ne=this.__data__;return this.size+=this.has(ye)?0:1,ne[ye]=Cc&&Oe===void 0?V:Oe,this},ka.prototype.clear=function(){this.__data__=[],this.size=0},ka.prototype.delete=function(ye){var Oe=this.__data__,ne=Ud(Oe,ye);return!(ne<0)&&(ne==Oe.length-1?Oe.pop():fs.call(Oe,ne,1),--this.size,!0)},ka.prototype.get=function(ye){var Oe=this.__data__,ne=Ud(Oe,ye);return ne<0?void 0:Oe[ne][1]},ka.prototype.has=function(ye){return Ud(this.__data__,ye)>-1},ka.prototype.set=function(ye,Oe){var ne=this.__data__,sn=Ud(ne,ye);return sn<0?(++this.size,ne.push([ye,Oe])):ne[sn][1]=Oe,this},Is.prototype.clear=function(){this.size=0,this.__data__={hash:new Sc,map:new(Mc||ka),string:new Sc}},Is.prototype.delete=function(ye){var Oe=Ac(this,ye).delete(ye);return this.size-=Oe?1:0,Oe},Is.prototype.get=function(ye){return Ac(this,ye).get(ye)},Is.prototype.has=function(ye){return Ac(this,ye).has(ye)},Is.prototype.set=function(ye,Oe){var ne=Ac(this,ye),sn=ne.size;return ne.set(ye,Oe),this.size+=ne.size==sn?0:1,this},Ef.prototype.add=Ef.prototype.push=function(ye){return this.__data__.set(ye,V),this},Ef.prototype.has=function(ye){return this.__data__.has(ye)},$o.prototype.clear=function(){this.__data__=new ka,this.size=0},$o.prototype.delete=function(ye){var Oe=this.__data__,ne=Oe.delete(ye);return this.size=Oe.size,ne},$o.prototype.get=function(ye){return this.__data__.get(ye)},$o.prototype.has=function(ye){return this.__data__.has(ye)},$o.prototype.set=function(ye,Oe){var ne=this.__data__;if(ne instanceof ka){var sn=ne.__data__;if(!Mc||sn.length<199)return sn.push([ye,Oe]),this.size=++ne.size,this;ne=this.__data__=new Is(sn)}return ne.set(ye,Oe),this.size=ne.size,this};var nw=Em?function(ye){return ye==null?[]:(ye=Object(ye),function(Oe,ne){for(var sn=-1,_r=Oe==null?0:Oe.length,gi=0,Gr=[];++sn<_r;){var Wr=Oe[sn];ne(Wr,sn,Oe)&&(Gr[gi++]=Wr)}return Gr}(Em(ye),function(Oe){return wf.call(ye,Oe)}))}:function(){return[]},Hl=$d;function iw(ye,Oe){return!!(Oe=Oe??re)&&(typeof ye=="number"||xe.test(ye))&&ye>-1&&ye%1==0&&ye<Oe}function Gl(ye){if(ye!=null){try{return wm.call(ye)}catch{}try{return ye+""}catch{}}return""}function ry(ye,Oe){return ye===Oe||ye!=ye&&Oe!=Oe}(Ec&&Hl(new Ec(new ArrayBuffer(1)))!=$n||Mc&&Hl(new Mc)!=vt||Ic&&Hl(Ic.resolve())!=Se||Xr&&Hl(new Xr)!=vn||Bd&&Hl(new Bd)!=mi)&&(Hl=function(ye){var Oe=$d(ye),ne=Oe==yn?ye.constructor:void 0,sn=ne?Gl(ne):"";if(sn)switch(sn){case sl:return $n;case jd:return vt;case Vd:return Se;case ui:return vn;case ew:return mi}return Oe});var Im=iy(function(){return arguments}())?iy:function(ye){return Pc(ye)&&Ms.call(ye,"callee")&&!wf.call(ye,"callee")},Gd=Array.isArray,If=Iu||function(){return!1};function Cm(ye){if(!Su(ye))return!1;var Oe=$d(ye);return Oe==_t||Oe=="[object GeneratorFunction]"||Oe=="[object AsyncFunction]"||Oe=="[object Proxy]"}function Sm(ye){return typeof ye=="number"&&ye>-1&&ye%1==0&&ye<=re}function Su(ye){var Oe=typeof ye;return ye!=null&&(Oe=="object"||Oe=="function")}function Pc(ye){return ye!=null&&typeof ye=="object"}var Dm=Ln?function(ye){return function(Oe){return ye(Oe)}}(Ln):function(ye){return Pc(ye)&&Sm(ye.length)&&!!$e[$d(ye)]};function Am(ye){return(Oe=ye)!=null&&Sm(Oe.length)&&!Cm(Oe)?Mf(ye):tw(ye);var Oe}I.exports=function(ye,Oe){return Cu(ye,Oe)}})(ol,ol.exports);var wc=r(ol.exports);function Jo(I,L){return I.length===L.length&&JSON.stringify(I.map(function(V){return V}).sort())===JSON.stringify(L.map(function(V){return V}).sort())}var vf={Polygon:Ne,LineString:wr,Point:Ji,MultiPolygon:pi,MultiLineString:pi,MultiPoint:pi},Zt=Object.freeze({__proto__:null,CommonSelectors:To,constrainFeatureMovement:Rd,createMidPoint:zs,createSupplementaryPoints:Ts,createVertex:ro,doubleClickZoom:ko,euclideanDistance:Oa,featuresAt:xi,getFeatureAtAndSetCursors:Ko,isClick:Pt,isEventAtCoordinates:bc,isTap:Ut,mapEventToBoundingBox:bo,ModeHandler:i,moveFeatures:jl,sortFeatures:Rt,stringSetsAreEqual:Jo,StringSet:ar,theme:ht,toDenseArray:ks}),gn=function(I,L){var V={options:I=function(le){le===void 0&&(le={});var ue=we(le);return le.controls||(ue.controls={}),le.displayControlsDefault===!1?ue.controls=we(Fa,le.controls):ue.controls=we(Es,le.controls),(ue=we(Ul,ue)).styles=rl(ue.styles,"cold").concat(rl(ue.styles,"hot")),ue}(I)};L=function(le,ue){return ue.modes=he,ue.getFeatureIdsAt=function(_e){return xi.click({point:_e},null,le).map(function(Ke){return Ke.properties.id})},ue.getSelectedIds=function(){return le.store.getSelectedIds()},ue.getSelected=function(){return{type:oe.FEATURE_COLLECTION,features:le.store.getSelectedIds().map(function(_e){return le.store.get(_e)}).map(function(_e){return _e.toGeoJSON()})}},ue.getSelectedPoints=function(){return{type:oe.FEATURE_COLLECTION,features:le.store.getSelectedCoordinates().map(function(_e){return{type:oe.FEATURE,properties:{},geometry:{type:oe.POINT,coordinates:_e.coordinates}}})}},ue.set=function(_e){if(_e.type===void 0||_e.type!==oe.FEATURE_COLLECTION||!Array.isArray(_e.features))throw new Error("Invalid FeatureCollection");var Ke=le.store.createRenderBatch(),at=le.store.getAllIds().slice(),_t=ue.add(_e),vt=new ar(_t);return(at=at.filter(function(ft){return!vt.has(ft)})).length&&ue.delete(at),Ke(),_t},ue.add=function(_e){var Ke=JSON.parse(JSON.stringify(Ue(_e))).features.map(function(at){if(at.id=at.id||Si(),at.geometry===null)throw new Error("Invalid geometry: null");if(le.store.get(at.id)===void 0||le.store.get(at.id).type!==at.geometry.type){var _t=vf[at.geometry.type];if(_t===void 0)throw new Error("Invalid geometry type: "+at.geometry.type+".");var vt=new _t(le,at);le.store.add(vt)}else{var ft=le.store.get(at.id);ft.properties=at.properties,wc(ft.properties,at.properties)||le.store.featureChanged(ft.id),wc(ft.getCoordinates(),at.geometry.coordinates)||ft.incomingCoords(at.geometry.coordinates)}return at.id});return le.store.render(),Ke},ue.get=function(_e){var Ke=le.store.get(_e);if(Ke)return Ke.toGeoJSON()},ue.getAll=function(){return{type:oe.FEATURE_COLLECTION,features:le.store.getAll().map(function(_e){return _e.toGeoJSON()})}},ue.delete=function(_e){return le.store.delete(_e,{silent:!0}),ue.getMode()!==he.DIRECT_SELECT||le.store.getSelectedIds().length?le.store.render():le.events.changeMode(he.SIMPLE_SELECT,void 0,{silent:!0}),ue},ue.deleteAll=function(){return le.store.delete(le.store.getAllIds(),{silent:!0}),ue.getMode()===he.DIRECT_SELECT?le.events.changeMode(he.SIMPLE_SELECT,void 0,{silent:!0}):le.store.render(),ue},ue.changeMode=function(_e,Ke){return Ke===void 0&&(Ke={}),_e===he.SIMPLE_SELECT&&ue.getMode()===he.SIMPLE_SELECT?(Jo(Ke.featureIds||[],le.store.getSelectedIds())||(le.store.setSelected(Ke.featureIds,{silent:!0}),le.store.render()),ue):(_e===he.DIRECT_SELECT&&ue.getMode()===he.DIRECT_SELECT&&Ke.featureId===le.store.getSelectedIds()[0]||le.events.changeMode(_e,Ke,{silent:!0}),ue)},ue.getMode=function(){return le.events.getMode()},ue.trash=function(){return le.events.trash({silent:!0}),ue},ue.combineFeatures=function(){return le.events.combineFeatures({silent:!0}),ue},ue.uncombineFeatures=function(){return le.events.uncombineFeatures({silent:!0}),ue},ue.setFeatureProperty=function(_e,Ke,at){return le.store.setFeatureProperty(_e,Ke,at),ue},ue}(V,L),V.api=L;var re=it(V);return L.onAdd=re.onAdd,L.onRemove=re.onRemove,L.types=ie,L.options=I,L};function Mo(I){gn(I,this)}return Mo.modes=Vl,Mo.constants=Wn,Mo.lib=Zt,Mo})});var z$=hM((FA,kA)=>{"use strict";(function(i,r){typeof FA=="object"&&typeof kA<"u"?kA.exports=r():typeof define=="function"&&define.amd?define(r):(i=typeof globalThis<"u"?globalThis:i||self,i.DOMPurify=r())})(FA,function(){"use strict";let{entries:i,setPrototypeOf:r,isFrozen:a,getPrototypeOf:c,getOwnPropertyDescriptor:h}=Object,{freeze:m,seal:y,create:w}=Object,{apply:C,construct:D}=typeof Reflect<"u"&&Reflect;m||(m=function(W){return W}),y||(y=function(W){return W}),C||(C=function(W,J,we){return W.apply(J,we)}),D||(D=function(W,J){return new W(...J)});let z=Wn(Array.prototype.forEach),j=Wn(Array.prototype.pop),ie=Wn(Array.prototype.push),oe=Wn(String.prototype.toLowerCase),he=Wn(String.prototype.toString),ke=Wn(String.prototype.match),rt=Wn(String.prototype.replace),Ve=Wn(String.prototype.indexOf),Ot=Wn(String.prototype.trim),hn=Wn(RegExp.prototype.test),Qt=Kn(TypeError);function Wn($){return function(W){for(var J=arguments.length,we=new Array(J>1?J-1:0),De=1;De<J;De++)we[De-1]=arguments[De];return C($,W,we)}}function Kn($){return function(){for(var W=arguments.length,J=new Array(W),we=0;we<W;we++)J[we]=arguments[we];return D($,J)}}function X($,W){let J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:oe;r&&r($,null);let we=W.length;for(;we--;){let De=W[we];if(typeof De=="string"){let it=J(De);it!==De&&(a(W)||(W[we]=it),De=it)}$[De]=!0}return $}function Rt($){let W=w(null);for(let[J,we]of i($))h($,J)!==void 0&&(W[J]=we);return W}function bo($,W){for(;$!==null;){let we=h($,W);if(we){if(we.get)return Wn(we.get);if(typeof we.value=="function")return Wn(we.value)}$=c($)}function J(we){return console.warn("fallback value for",we),null}return J}let ar=m(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Vt=m(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),xi=m(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Pa=m(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ko=m(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Oa=m(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Pt=m(["#text"]),Ut=m(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),jt=m(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ze=m(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Si=m(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),bi=y(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ji=y(/<%[\w\W]*|[\w\W]*%>/gm),wr=y(/\${[\w\W]*}/gm),Ne=y(/^data-[\-\w.\u00B7-\uFFFF]/),wo=y(/^aria-[\-\w]+$/),la=y(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),pi=y(/^(?:\w+script|data):/i),Tn=y(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),io=y(/^html$/i);var Fs=Object.freeze({__proto__:null,MUSTACHE_EXPR:bi,ERB_EXPR:Ji,TMPLIT_EXPR:wr,DATA_ATTR:Ne,ARIA_ATTR:wo,IS_ALLOWED_URI:la,IS_SCRIPT_OR_DATA:pi,ATTR_WHITESPACE:Tn,DOCTYPE_NAME:io});let gr=function(){return typeof window>"u"?null:window},ks=function(W,J){if(typeof W!="object"||typeof W.createPolicy!="function")return null;let we=null,De="data-tt-policy-suffix";J&&J.hasAttribute(De)&&(we=J.getAttribute(De));let it="dompurify"+(we?"#"+we:"");try{return W.createPolicy(it,{createHTML(ht){return ht},createScriptURL(ht){return ht}})}catch{return console.warn("TrustedTypes policy "+it+" could not be created."),null}};function nl(){let $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:gr(),W=Bt=>nl(Bt);if(W.version="3.0.6",W.removed=[],!$||!$.document||$.document.nodeType!==9)return W.isSupported=!1,W;let{document:J}=$,we=J,De=we.currentScript,{DocumentFragment:it,HTMLTemplateElement:ht,Node:Re,Element:Et,NodeFilter:Dt,NamedNodeMap:zt=$.NamedNodeMap||$.MozNamedAttrMap,HTMLFormElement:li,DOMParser:Ni,trustedTypes:Qi}=$,Di=Et.prototype,Hi=bo(Di,"cloneNode"),wi=bo(Di,"nextSibling"),To=bo(Di,"childNodes"),Eo=bo(Di,"parentNode");if(typeof ht=="function"){let Bt=J.createElement("template");Bt.content&&Bt.content.ownerDocument&&(J=Bt.content.ownerDocument)}let Ai,Uo="",{implementation:Ns,createNodeIterator:ro,createDocumentFragment:zs,getElementsByTagName:Ts}=J,{importNode:ko}=we,ve={};W.isSupported=typeof i=="function"&&typeof Eo=="function"&&Ns&&Ns.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:Ce,ERB_EXPR:Le,TMPLIT_EXPR:Ue,DATA_ATTR:Ge,ARIA_ATTR:Qe,IS_SCRIPT_OR_DATA:nt,ATTR_WHITESPACE:Ye}=Fs,{IS_ALLOWED_URI:ut}=Fs,Be=null,Ft=X({},[...ar,...Vt,...xi,...Ko,...Pt]),on=null,Mt=X({},[...Ut,...jt,...ze,...Si]),qt=Object.seal(w(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ci=null,Gi=null,er=!0,zr=!0,ns=!1,Br=!0,Pi=!1,Ir=!1,Ra=!1,Bs=!1,us=!1,zl=!1,il=!1,yf=!0,Bl=!1,Rd="user-content-",jl=!0,Cr=!1,js={},La=null,ds=X({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),hs=null,bc=X({},["audio","video","img","source","image","track"]),ca=null,ua=X({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Vl="http://www.w3.org/1998/Math/MathML",Ul="http://www.w3.org/2000/svg",Es="http://www.w3.org/1999/xhtml",Fa=Es,rl=!1,ol=null,wc=X({},[Vl,Ul,Es],he),Jo=null,vf=["application/xhtml+xml","text/html"],Zt="text/html",gn=null,Mo=null,I=J.createElement("form"),L=function(xe){return xe instanceof RegExp||xe instanceof Function},V=function(){let xe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Mo&&Mo===xe)){if((!xe||typeof xe!="object")&&(xe={}),xe=Rt(xe),Jo=vf.indexOf(xe.PARSER_MEDIA_TYPE)===-1?Jo=Zt:Jo=xe.PARSER_MEDIA_TYPE,gn=Jo==="application/xhtml+xml"?he:oe,Be="ALLOWED_TAGS"in xe?X({},xe.ALLOWED_TAGS,gn):Ft,on="ALLOWED_ATTR"in xe?X({},xe.ALLOWED_ATTR,gn):Mt,ol="ALLOWED_NAMESPACES"in xe?X({},xe.ALLOWED_NAMESPACES,he):wc,ca="ADD_URI_SAFE_ATTR"in xe?X(Rt(ua),xe.ADD_URI_SAFE_ATTR,gn):ua,hs="ADD_DATA_URI_TAGS"in xe?X(Rt(bc),xe.ADD_DATA_URI_TAGS,gn):bc,La="FORBID_CONTENTS"in xe?X({},xe.FORBID_CONTENTS,gn):ds,ci="FORBID_TAGS"in xe?X({},xe.FORBID_TAGS,gn):{},Gi="FORBID_ATTR"in xe?X({},xe.FORBID_ATTR,gn):{},js="USE_PROFILES"in xe?xe.USE_PROFILES:!1,er=xe.ALLOW_ARIA_ATTR!==!1,zr=xe.ALLOW_DATA_ATTR!==!1,ns=xe.ALLOW_UNKNOWN_PROTOCOLS||!1,Br=xe.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Pi=xe.SAFE_FOR_TEMPLATES||!1,Ir=xe.WHOLE_DOCUMENT||!1,us=xe.RETURN_DOM||!1,zl=xe.RETURN_DOM_FRAGMENT||!1,il=xe.RETURN_TRUSTED_TYPE||!1,Bs=xe.FORCE_BODY||!1,yf=xe.SANITIZE_DOM!==!1,Bl=xe.SANITIZE_NAMED_PROPS||!1,jl=xe.KEEP_CONTENT!==!1,Cr=xe.IN_PLACE||!1,ut=xe.ALLOWED_URI_REGEXP||la,Fa=xe.NAMESPACE||Es,qt=xe.CUSTOM_ELEMENT_HANDLING||{},xe.CUSTOM_ELEMENT_HANDLING&&L(xe.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(qt.tagNameCheck=xe.CUSTOM_ELEMENT_HANDLING.tagNameCheck),xe.CUSTOM_ELEMENT_HANDLING&&L(xe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(qt.attributeNameCheck=xe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),xe.CUSTOM_ELEMENT_HANDLING&&typeof xe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(qt.allowCustomizedBuiltInElements=xe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pi&&(zr=!1),zl&&(us=!0),js&&(Be=X({},[...Pt]),on=[],js.html===!0&&(X(Be,ar),X(on,Ut)),js.svg===!0&&(X(Be,Vt),X(on,jt),X(on,Si)),js.svgFilters===!0&&(X(Be,xi),X(on,jt),X(on,Si)),js.mathMl===!0&&(X(Be,Ko),X(on,ze),X(on,Si))),xe.ADD_TAGS&&(Be===Ft&&(Be=Rt(Be)),X(Be,xe.ADD_TAGS,gn)),xe.ADD_ATTR&&(on===Mt&&(on=Rt(on)),X(on,xe.ADD_ATTR,gn)),xe.ADD_URI_SAFE_ATTR&&X(ca,xe.ADD_URI_SAFE_ATTR,gn),xe.FORBID_CONTENTS&&(La===ds&&(La=Rt(La)),X(La,xe.FORBID_CONTENTS,gn)),jl&&(Be["#text"]=!0),Ir&&X(Be,["html","head","body"]),Be.table&&(X(Be,["tbody"]),delete ci.tbody),xe.TRUSTED_TYPES_POLICY){if(typeof xe.TRUSTED_TYPES_POLICY.createHTML!="function")throw Qt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof xe.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Qt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');Ai=xe.TRUSTED_TYPES_POLICY,Uo=Ai.createHTML("")}else Ai===void 0&&(Ai=ks(Qi,De)),Ai!==null&&typeof Uo=="string"&&(Uo=Ai.createHTML(""));m&&m(xe),Mo=xe}},re=X({},["mi","mo","mn","ms","mtext"]),le=X({},["foreignobject","desc","title","annotation-xml"]),ue=X({},["title","style","font","a","script"]),_e=X({},Vt);X(_e,xi),X(_e,Pa);let Ke=X({},Ko);X(Ke,Oa);let at=function(xe){let $e=Eo(xe);(!$e||!$e.tagName)&&($e={namespaceURI:Fa,tagName:"template"});let Wt=oe(xe.tagName),lr=oe($e.tagName);return ol[xe.namespaceURI]?xe.namespaceURI===Ul?$e.namespaceURI===Es?Wt==="svg":$e.namespaceURI===Vl?Wt==="svg"&&(lr==="annotation-xml"||re[lr]):!!_e[Wt]:xe.namespaceURI===Vl?$e.namespaceURI===Es?Wt==="math":$e.namespaceURI===Ul?Wt==="math"&&le[lr]:!!Ke[Wt]:xe.namespaceURI===Es?$e.namespaceURI===Ul&&!le[lr]||$e.namespaceURI===Vl&&!re[lr]?!1:!Ke[Wt]&&(ue[Wt]||!_e[Wt]):!!(Jo==="application/xhtml+xml"&&ol[xe.namespaceURI]):!1},_t=function(xe){ie(W.removed,{element:xe});try{xe.parentNode.removeChild(xe)}catch{xe.remove()}},vt=function(xe,$e){try{ie(W.removed,{attribute:$e.getAttributeNode(xe),from:$e})}catch{ie(W.removed,{attribute:null,from:$e})}if($e.removeAttribute(xe),xe==="is"&&!on[xe])if(us||zl)try{_t($e)}catch{}else try{$e.setAttribute(xe,"")}catch{}},ft=function(xe){let $e=null,Wt=null;if(Bs)xe="<remove></remove>"+xe;else{let Ze=ke(xe,/^[\r\n\t ]+/);Wt=Ze&&Ze[0]}Jo==="application/xhtml+xml"&&Fa===Es&&(xe='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+xe+"</body></html>");let lr=Ai?Ai.createHTML(xe):xe;if(Fa===Es)try{$e=new Ni().parseFromString(lr,Jo)}catch{}if(!$e||!$e.documentElement){$e=Ns.createDocument(Fa,"template",null);try{$e.documentElement.innerHTML=rl?Uo:lr}catch{}}let Wi=$e.body||$e.documentElement;return xe&&Wt&&Wi.insertBefore(J.createTextNode(Wt),Wi.childNodes[0]||null),Fa===Es?Ts.call($e,Ir?"html":"body")[0]:Ir?$e.documentElement:Wi},yn=function(xe){return ro.call(xe.ownerDocument||xe,xe,Dt.SHOW_ELEMENT|Dt.SHOW_COMMENT|Dt.SHOW_TEXT,null)},Se=function(xe){return xe instanceof li&&(typeof xe.nodeName!="string"||typeof xe.textContent!="string"||typeof xe.removeChild!="function"||!(xe.attributes instanceof zt)||typeof xe.removeAttribute!="function"||typeof xe.setAttribute!="function"||typeof xe.namespaceURI!="string"||typeof xe.insertBefore!="function"||typeof xe.hasChildNodes!="function")},Je=function(xe){return typeof Re=="function"&&xe instanceof Re},vn=function(xe,$e,Wt){ve[xe]&&z(ve[xe],lr=>{lr.call(W,$e,Wt,Mo)})},q=function(xe){let $e=null;if(vn("beforeSanitizeElements",xe,null),Se(xe))return _t(xe),!0;let Wt=gn(xe.nodeName);if(vn("uponSanitizeElement",xe,{tagName:Wt,allowedTags:Be}),xe.hasChildNodes()&&!Je(xe.firstElementChild)&&hn(/<[/\w]/g,xe.innerHTML)&&hn(/<[/\w]/g,xe.textContent))return _t(xe),!0;if(!Be[Wt]||ci[Wt]){if(!ci[Wt]&&mi(Wt)&&(qt.tagNameCheck instanceof RegExp&&hn(qt.tagNameCheck,Wt)||qt.tagNameCheck instanceof Function&&qt.tagNameCheck(Wt)))return!1;if(jl&&!La[Wt]){let lr=Eo(xe)||xe.parentNode,Wi=To(xe)||xe.childNodes;if(Wi&&lr){let Ze=Wi.length;for(let Jt=Ze-1;Jt>=0;--Jt)lr.insertBefore(Hi(Wi[Jt],!0),wi(xe))}}return _t(xe),!0}return xe instanceof Et&&!at(xe)||(Wt==="noscript"||Wt==="noembed"||Wt==="noframes")&&hn(/<\/no(script|embed|frames)/i,xe.innerHTML)?(_t(xe),!0):(Pi&&xe.nodeType===3&&($e=xe.textContent,z([Ce,Le,Ue],lr=>{$e=rt($e,lr," ")}),xe.textContent!==$e&&(ie(W.removed,{element:xe.cloneNode()}),xe.textContent=$e)),vn("afterSanitizeElements",xe,null),!1)},Ie=function(xe,$e,Wt){if(yf&&($e==="id"||$e==="name")&&(Wt in J||Wt in I))return!1;if(!(zr&&!Gi[$e]&&hn(Ge,$e))){if(!(er&&hn(Qe,$e))){if(!on[$e]||Gi[$e]){if(!(mi(xe)&&(qt.tagNameCheck instanceof RegExp&&hn(qt.tagNameCheck,xe)||qt.tagNameCheck instanceof Function&&qt.tagNameCheck(xe))&&(qt.attributeNameCheck instanceof RegExp&&hn(qt.attributeNameCheck,$e)||qt.attributeNameCheck instanceof Function&&qt.attributeNameCheck($e))||$e==="is"&&qt.allowCustomizedBuiltInElements&&(qt.tagNameCheck instanceof RegExp&&hn(qt.tagNameCheck,Wt)||qt.tagNameCheck instanceof Function&&qt.tagNameCheck(Wt))))return!1}else if(!ca[$e]){if(!hn(ut,rt(Wt,Ye,""))){if(!(($e==="src"||$e==="xlink:href"||$e==="href")&&xe!=="script"&&Ve(Wt,"data:")===0&&hs[xe])){if(!(ns&&!hn(nt,rt(Wt,Ye,"")))){if(Wt)return!1}}}}}}return!0},mi=function(xe){return xe.indexOf("-")>0},tr=function(xe){vn("beforeSanitizeAttributes",xe,null);let{attributes:$e}=xe;if(!$e)return;let Wt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:on},lr=$e.length;for(;lr--;){let Wi=$e[lr],{name:Ze,namespaceURI:Jt,value:Sn}=Wi,fo=gn(Ze),Yr=Ze==="value"?Sn:Ot(Sn);if(Wt.attrName=fo,Wt.attrValue=Yr,Wt.keepAttr=!0,Wt.forceKeepAttr=void 0,vn("uponSanitizeAttribute",xe,Wt),Yr=Wt.attrValue,Wt.forceKeepAttr||(vt(Ze,xe),!Wt.keepAttr))continue;if(!Br&&hn(/\/>/i,Yr)){vt(Ze,xe);continue}Pi&&z([Ce,Le,Ue],Tc=>{Yr=rt(Yr,Tc," ")});let Ln=gn(xe.nodeName);if(Ie(Ln,fo,Yr)){if(Bl&&(fo==="id"||fo==="name")&&(vt(Ze,xe),Yr=Rd+Yr),Ai&&typeof Qi=="object"&&typeof Qi.getAttributeType=="function"&&!Jt)switch(Qi.getAttributeType(Ln,fo)){case"TrustedHTML":{Yr=Ai.createHTML(Yr);break}case"TrustedScriptURL":{Yr=Ai.createScriptURL(Yr);break}}try{Jt?xe.setAttributeNS(Jt,Ze,Yr):xe.setAttribute(Ze,Yr),j(W.removed)}catch{}}}vn("afterSanitizeAttributes",xe,null)},$n=function Bt(xe){let $e=null,Wt=yn(xe);for(vn("beforeSanitizeShadowDOM",xe,null);$e=Wt.nextNode();)vn("uponSanitizeShadowNode",$e,null),!q($e)&&($e.content instanceof it&&Bt($e.content),tr($e));vn("afterSanitizeShadowDOM",xe,null)};return W.sanitize=function(Bt){let xe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},$e=null,Wt=null,lr=null,Wi=null;if(rl=!Bt,rl&&(Bt="<!-->"),typeof Bt!="string"&&!Je(Bt))if(typeof Bt.toString=="function"){if(Bt=Bt.toString(),typeof Bt!="string")throw Qt("dirty is not a string, aborting")}else throw Qt("toString is not a function");if(!W.isSupported)return Bt;if(Ra||V(xe),W.removed=[],typeof Bt=="string"&&(Cr=!1),Cr){if(Bt.nodeName){let Sn=gn(Bt.nodeName);if(!Be[Sn]||ci[Sn])throw Qt("root node is forbidden and cannot be sanitized in-place")}}else if(Bt instanceof Re)$e=ft("<!---->"),Wt=$e.ownerDocument.importNode(Bt,!0),Wt.nodeType===1&&Wt.nodeName==="BODY"||Wt.nodeName==="HTML"?$e=Wt:$e.appendChild(Wt);else{if(!us&&!Pi&&!Ir&&Bt.indexOf("<")===-1)return Ai&&il?Ai.createHTML(Bt):Bt;if($e=ft(Bt),!$e)return us?null:il?Uo:""}$e&&Bs&&_t($e.firstChild);let Ze=yn(Cr?Bt:$e);for(;lr=Ze.nextNode();)q(lr)||(lr.content instanceof it&&$n(lr.content),tr(lr));if(Cr)return Bt;if(us){if(zl)for(Wi=zs.call($e.ownerDocument);$e.firstChild;)Wi.appendChild($e.firstChild);else Wi=$e;return(on.shadowroot||on.shadowrootmode)&&(Wi=ko.call(we,Wi,!0)),Wi}let Jt=Ir?$e.outerHTML:$e.innerHTML;return Ir&&Be["!doctype"]&&$e.ownerDocument&&$e.ownerDocument.doctype&&$e.ownerDocument.doctype.name&&hn(io,$e.ownerDocument.doctype.name)&&(Jt="<!DOCTYPE "+$e.ownerDocument.doctype.name+`>
`+Jt),Pi&&z([Ce,Le,Ue],Sn=>{Jt=rt(Jt,Sn," ")}),Ai&&il?Ai.createHTML(Jt):Jt},W.setConfig=function(){let Bt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};V(Bt),Ra=!0},W.clearConfig=function(){Mo=null,Ra=!1},W.isValidAttribute=function(Bt,xe,$e){Mo||V({});let Wt=gn(Bt),lr=gn(xe);return Ie(Wt,lr,$e)},W.addHook=function(Bt,xe){typeof xe=="function"&&(ve[Bt]=ve[Bt]||[],ie(ve[Bt],xe))},W.removeHook=function(Bt){if(ve[Bt])return j(ve[Bt])},W.removeHooks=function(Bt){ve[Bt]&&(ve[Bt]=[])},W.removeAllHooks=function(){ve={}},W}var Ae=nl();return Ae})});var sN=null;var pM=1,aN=Symbol("SIGNAL");function qo(i){let r=sN;return sN=i,r}var lN={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function H7(i){if(!(_M(i)&&!i.dirty)&&!(!i.dirty&&i.lastCleanEpoch===pM)){if(!i.producerMustRecompute(i)&&!mM(i)){i.dirty=!1,i.lastCleanEpoch=pM;return}i.producerRecomputeValue(i),i.dirty=!1,i.lastCleanEpoch=pM}}function cN(i){return i&&(i.nextProducerIndex=0),qo(i)}function uN(i,r){if(qo(r),!(!i||i.producerNode===void 0||i.producerIndexOfThis===void 0||i.producerLastReadVersion===void 0)){if(_M(i))for(let a=i.nextProducerIndex;a<i.producerNode.length;a++)gM(i.producerNode[a],i.producerIndexOfThis[a]);for(;i.producerNode.length>i.nextProducerIndex;)i.producerNode.pop(),i.producerLastReadVersion.pop(),i.producerIndexOfThis.pop()}}function mM(i){a0(i);for(let r=0;r<i.producerNode.length;r++){let a=i.producerNode[r],c=i.producerLastReadVersion[r];if(c!==a.version||(H7(a),c!==a.version))return!0}return!1}function dN(i){if(a0(i),_M(i))for(let r=0;r<i.producerNode.length;r++)gM(i.producerNode[r],i.producerIndexOfThis[r]);i.producerNode.length=i.producerLastReadVersion.length=i.producerIndexOfThis.length=0,i.liveConsumerNode&&(i.liveConsumerNode.length=i.liveConsumerIndexOfThis.length=0)}function gM(i,r){if(G7(i),a0(i),i.liveConsumerNode.length===1)for(let c=0;c<i.producerNode.length;c++)gM(i.producerNode[c],i.producerIndexOfThis[c]);let a=i.liveConsumerNode.length-1;if(i.liveConsumerNode[r]=i.liveConsumerNode[a],i.liveConsumerIndexOfThis[r]=i.liveConsumerIndexOfThis[a],i.liveConsumerNode.length--,i.liveConsumerIndexOfThis.length--,r<i.liveConsumerNode.length){let c=i.liveConsumerIndexOfThis[r],h=i.liveConsumerNode[r];a0(h),h.producerIndexOfThis[c]=r}}function _M(i){return i.consumerIsAlwaysLive||(i?.liveConsumerNode?.length??0)>0}function a0(i){i.producerNode??=[],i.producerIndexOfThis??=[],i.producerLastReadVersion??=[]}function G7(i){i.liveConsumerNode??=[],i.liveConsumerIndexOfThis??=[]}function W7(){throw new Error}var q7=W7;function hN(i){q7=i}function Rn(i){return typeof i=="function"}function fp(i){let a=i(c=>{Error.call(c),c.stack=new Error().stack});return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}var l0=fp(i=>function(a){i(this),this.message=a?`${a.length} errors occurred during unsubscription:
${a.map((c,h)=>`${h+1}) ${c.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=a});function gh(i,r){if(i){let a=i.indexOf(r);0<=a&&i.splice(a,1)}}var Po=class i{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;let{_parentage:a}=this;if(a)if(this._parentage=null,Array.isArray(a))for(let m of a)m.remove(this);else a.remove(this);let{initialTeardown:c}=this;if(Rn(c))try{c()}catch(m){r=m instanceof l0?m.errors:[m]}let{_finalizers:h}=this;if(h){this._finalizers=null;for(let m of h)try{fN(m)}catch(y){r=r??[],y instanceof l0?r=[...r,...y.errors]:r.push(y)}}if(r)throw new l0(r)}}add(r){var a;if(r&&r!==this)if(this.closed)fN(r);else{if(r instanceof i){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(a=this._finalizers)!==null&&a!==void 0?a:[]).push(r)}}_hasParent(r){let{_parentage:a}=this;return a===r||Array.isArray(a)&&a.includes(r)}_addParent(r){let{_parentage:a}=this;this._parentage=Array.isArray(a)?(a.push(r),a):a?[a,r]:r}_removeParent(r){let{_parentage:a}=this;a===r?this._parentage=null:Array.isArray(a)&&gh(a,r)}remove(r){let{_finalizers:a}=this;a&&gh(a,r),r instanceof i&&r._removeParent(this)}};Po.EMPTY=(()=>{let i=new Po;return i.closed=!0,i})();var yM=Po.EMPTY;function c0(i){return i instanceof Po||i&&"closed"in i&&Rn(i.remove)&&Rn(i.add)&&Rn(i.unsubscribe)}function fN(i){Rn(i)?i():i.unsubscribe()}var bl={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var pp={setTimeout(i,r,...a){let{delegate:c}=pp;return c?.setTimeout?c.setTimeout(i,r,...a):setTimeout(i,r,...a)},clearTimeout(i){let{delegate:r}=pp;return(r?.clearTimeout||clearTimeout)(i)},delegate:void 0};function u0(i){pp.setTimeout(()=>{let{onUnhandledError:r}=bl;if(r)r(i);else throw i})}function Yc(){}var pN=vM("C",void 0,void 0);function mN(i){return vM("E",void 0,i)}function gN(i){return vM("N",i,void 0)}function vM(i,r,a){return{kind:i,value:r,error:a}}var _h=null;function mp(i){if(bl.useDeprecatedSynchronousErrorHandling){let r=!_h;if(r&&(_h={errorThrown:!1,error:null}),i(),r){let{errorThrown:a,error:c}=_h;if(_h=null,a)throw c}}else i()}function _N(i){bl.useDeprecatedSynchronousErrorHandling&&_h&&(_h.errorThrown=!0,_h.error=i)}var yh=class extends Po{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,c0(r)&&r.add(this)):this.destination=X7}static create(r,a,c){return new Xc(r,a,c)}next(r){this.isStopped?bM(gN(r),this):this._next(r)}error(r){this.isStopped?bM(mN(r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?bM(pN,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Z7=Function.prototype.bind;function xM(i,r){return Z7.call(i,r)}var wM=class{constructor(r){this.partialObserver=r}next(r){let{partialObserver:a}=this;if(a.next)try{a.next(r)}catch(c){d0(c)}}error(r){let{partialObserver:a}=this;if(a.error)try{a.error(r)}catch(c){d0(c)}else d0(r)}complete(){let{partialObserver:r}=this;if(r.complete)try{r.complete()}catch(a){d0(a)}}},Xc=class extends yh{constructor(r,a,c){super();let h;if(Rn(r)||!r)h={next:r??void 0,error:a??void 0,complete:c??void 0};else{let m;this&&bl.useDeprecatedNextContext?(m=Object.create(r),m.unsubscribe=()=>this.unsubscribe(),h={next:r.next&&xM(r.next,m),error:r.error&&xM(r.error,m),complete:r.complete&&xM(r.complete,m)}):h=r}this.destination=new wM(h)}};function d0(i){bl.useDeprecatedSynchronousErrorHandling?_N(i):u0(i)}function Y7(i){throw i}function bM(i,r){let{onStoppedNotification:a}=bl;a&&pp.setTimeout(()=>a(i,r))}var X7={closed:!0,next:Yc,error:Y7,complete:Yc};var gp=typeof Symbol=="function"&&Symbol.observable||"@@observable";function mo(i){return i}function _p(...i){return TM(i)}function TM(i){return i.length===0?mo:i.length===1?i[0]:function(a){return i.reduce((c,h)=>h(c),a)}}var un=(()=>{class i{constructor(a){a&&(this._subscribe=a)}lift(a){let c=new i;return c.source=this,c.operator=a,c}subscribe(a,c,h){let m=J7(a)?a:new Xc(a,c,h);return mp(()=>{let{operator:y,source:w}=this;m.add(y?y.call(m,w):w?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(a){try{return this._subscribe(a)}catch(c){a.error(c)}}forEach(a,c){return c=yN(c),new c((h,m)=>{let y=new Xc({next:w=>{try{a(w)}catch(C){m(C),y.unsubscribe()}},error:m,complete:h});this.subscribe(y)})}_subscribe(a){var c;return(c=this.source)===null||c===void 0?void 0:c.subscribe(a)}[gp](){return this}pipe(...a){return TM(a)(this)}toPromise(a){return a=yN(a),new a((c,h)=>{let m;this.subscribe(y=>m=y,y=>h(y),()=>c(m))})}}return i.create=r=>new i(r),i})();function yN(i){var r;return(r=i??bl.Promise)!==null&&r!==void 0?r:Promise}function K7(i){return i&&Rn(i.next)&&Rn(i.error)&&Rn(i.complete)}function J7(i){return i&&i instanceof yh||K7(i)&&c0(i)}function EM(i){return Rn(i?.lift)}function In(i){return r=>{if(EM(r))return r.lift(function(a){try{return i(a,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function en(i,r,a,c,h){return new MM(i,r,a,c,h)}var MM=class extends yh{constructor(r,a,c,h,m,y){super(r),this.onFinalize=m,this.shouldUnsubscribe=y,this._next=a?function(w){try{a(w)}catch(C){r.error(C)}}:super._next,this._error=h?function(w){try{h(w)}catch(C){r.error(C)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(w){r.error(w)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:a}=this;super.unsubscribe(),!a&&((r=this.onFinalize)===null||r===void 0||r.call(this))}}};function yp(){return In((i,r)=>{let a=null;i._refCount++;let c=en(r,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount){a=null;return}let h=i._connection,m=a;a=null,h&&(!m||h===m)&&h.unsubscribe(),r.unsubscribe()});i.subscribe(c),c.closed||(a=i.connect())})}var vp=class extends un{constructor(r,a){super(),this.source=r,this.subjectFactory=a,this._subject=null,this._refCount=0,this._connection=null,EM(r)&&(this.lift=r.lift)}_subscribe(r){return this.getSubject().subscribe(r)}getSubject(){let r=this._subject;return(!r||r.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:r}=this;this._subject=this._connection=null,r?.unsubscribe()}connect(){let r=this._connection;if(!r){r=this._connection=new Po;let a=this.getSubject();r.add(this.source.subscribe(en(a,void 0,()=>{this._teardown(),a.complete()},c=>{this._teardown(),a.error(c)},()=>this._teardown()))),r.closed&&(this._connection=null,r=Po.EMPTY)}return r}refCount(){return yp()(this)}};var vN=fp(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Qr=(()=>{class i extends un{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(a){let c=new h0(this,this);return c.operator=a,c}_throwIfClosed(){if(this.closed)throw new vN}next(a){mp(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let c of this.currentObservers)c.next(a)}})}error(a){mp(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=a;let{observers:c}=this;for(;c.length;)c.shift().error(a)}})}complete(){mp(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:a}=this;for(;a.length;)a.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var a;return((a=this.observers)===null||a===void 0?void 0:a.length)>0}_trySubscribe(a){return this._throwIfClosed(),super._trySubscribe(a)}_subscribe(a){return this._throwIfClosed(),this._checkFinalizedStatuses(a),this._innerSubscribe(a)}_innerSubscribe(a){let{hasError:c,isStopped:h,observers:m}=this;return c||h?yM:(this.currentObservers=null,m.push(a),new Po(()=>{this.currentObservers=null,gh(m,a)}))}_checkFinalizedStatuses(a){let{hasError:c,thrownError:h,isStopped:m}=this;c?a.error(h):m&&a.complete()}asObservable(){let a=new un;return a.source=this,a}}return i.create=(r,a)=>new h0(r,a),i})(),h0=class extends Qr{constructor(r,a){super(),this.destination=r,this.source=a}next(r){var a,c;(c=(a=this.destination)===null||a===void 0?void 0:a.next)===null||c===void 0||c.call(a,r)}error(r){var a,c;(c=(a=this.destination)===null||a===void 0?void 0:a.error)===null||c===void 0||c.call(a,r)}complete(){var r,a;(a=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||a===void 0||a.call(r)}_subscribe(r){var a,c;return(c=(a=this.source)===null||a===void 0?void 0:a.subscribe(r))!==null&&c!==void 0?c:yM}};var pr=class extends Qr{constructor(r){super(),this._value=r}get value(){return this.getValue()}_subscribe(r){let a=super._subscribe(r);return!a.closed&&r.next(this._value),a}getValue(){let{hasError:r,thrownError:a,_value:c}=this;if(r)throw a;return this._throwIfClosed(),c}next(r){super.next(this._value=r)}};var Mg={now(){return(Mg.delegate||Date).now()},delegate:void 0};var Kc=class extends Qr{constructor(r=1/0,a=1/0,c=Mg){super(),this._bufferSize=r,this._windowTime=a,this._timestampProvider=c,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=a===1/0,this._bufferSize=Math.max(1,r),this._windowTime=Math.max(1,a)}next(r){let{isStopped:a,_buffer:c,_infiniteTimeWindow:h,_timestampProvider:m,_windowTime:y}=this;a||(c.push(r),!h&&c.push(m.now()+y)),this._trimBuffer(),super.next(r)}_subscribe(r){this._throwIfClosed(),this._trimBuffer();let a=this._innerSubscribe(r),{_infiniteTimeWindow:c,_buffer:h}=this,m=h.slice();for(let y=0;y<m.length&&!r.closed;y+=c?1:2)r.next(m[y]);return this._checkFinalizedStatuses(r),a}_trimBuffer(){let{_bufferSize:r,_timestampProvider:a,_buffer:c,_infiniteTimeWindow:h}=this,m=(h?1:2)*r;if(r<1/0&&m<c.length&&c.splice(0,c.length-m),!h){let y=a.now(),w=0;for(let C=1;C<c.length&&c[C]<=y;C+=2)w=C;w&&c.splice(0,w+1)}}};var f0=class extends Po{constructor(r,a){super()}schedule(r,a=0){return this}};var Ig={setInterval(i,r,...a){let{delegate:c}=Ig;return c?.setInterval?c.setInterval(i,r,...a):setInterval(i,r,...a)},clearInterval(i){let{delegate:r}=Ig;return(r?.clearInterval||clearInterval)(i)},delegate:void 0};var p0=class extends f0{constructor(r,a){super(r,a),this.scheduler=r,this.work=a,this.pending=!1}schedule(r,a=0){var c;if(this.closed)return this;this.state=r;let h=this.id,m=this.scheduler;return h!=null&&(this.id=this.recycleAsyncId(m,h,a)),this.pending=!0,this.delay=a,this.id=(c=this.id)!==null&&c!==void 0?c:this.requestAsyncId(m,this.id,a),this}requestAsyncId(r,a,c=0){return Ig.setInterval(r.flush.bind(r,this),c)}recycleAsyncId(r,a,c=0){if(c!=null&&this.delay===c&&this.pending===!1)return a;a!=null&&Ig.clearInterval(a)}execute(r,a){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let c=this._execute(r,a);if(c)return c;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(r,a){let c=!1,h;try{this.work(r)}catch(m){c=!0,h=m||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),h}unsubscribe(){if(!this.closed){let{id:r,scheduler:a}=this,{actions:c}=a;this.work=this.state=this.scheduler=null,this.pending=!1,gh(c,this),r!=null&&(this.id=this.recycleAsyncId(a,r,null)),this.delay=null,super.unsubscribe()}}};var xp=class i{constructor(r,a=i.now){this.schedulerActionCtor=r,this.now=a}schedule(r,a=0,c){return new this.schedulerActionCtor(this,r).schedule(c,a)}};xp.now=Mg.now;var m0=class extends xp{constructor(r,a=xp.now){super(r,a),this.actions=[],this._active=!1}flush(r){let{actions:a}=this;if(this._active){a.push(r);return}let c;this._active=!0;do if(c=r.execute(r.state,r.delay))break;while(r=a.shift());if(this._active=!1,c){for(;r=a.shift();)r.unsubscribe();throw c}}};var Cg=new m0(p0),xN=Cg;var Lr=new un(i=>i.complete());function g0(i){return i&&Rn(i.schedule)}function IM(i){return i[i.length-1]}function bp(i){return Rn(IM(i))?i.pop():void 0}function ac(i){return g0(IM(i))?i.pop():void 0}function bN(i,r){return typeof IM(i)=="number"?i.pop():r}function TN(i,r){var a={};for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&r.indexOf(c)<0&&(a[c]=i[c]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,c=Object.getOwnPropertySymbols(i);h<c.length;h++)r.indexOf(c[h])<0&&Object.prototype.propertyIsEnumerable.call(i,c[h])&&(a[c[h]]=i[c[h]]);return a}function _0(i,r,a,c){var h=arguments.length,m=h<3?r:c===null?c=Object.getOwnPropertyDescriptor(r,a):c,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(i,r,a,c);else for(var w=i.length-1;w>=0;w--)(y=i[w])&&(m=(h<3?y(m):h>3?y(r,a,m):y(r,a))||m);return h>3&&m&&Object.defineProperty(r,a,m),m}function y0(i,r,a,c){function h(m){return m instanceof a?m:new a(function(y){y(m)})}return new(a||(a=Promise))(function(m,y){function w(z){try{D(c.next(z))}catch(j){y(j)}}function C(z){try{D(c.throw(z))}catch(j){y(j)}}function D(z){z.done?m(z.value):h(z.value).then(w,C)}D((c=c.apply(i,r||[])).next())})}function wN(i){var r=typeof Symbol=="function"&&Symbol.iterator,a=r&&i[r],c=0;if(a)return a.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&c>=i.length&&(i=void 0),{value:i&&i[c++],done:!i}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function vh(i){return this instanceof vh?(this.v=i,this):new vh(i)}function EN(i,r,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=a.apply(i,r||[]),h,m=[];return h={},y("next"),y("throw"),y("return"),h[Symbol.asyncIterator]=function(){return this},h;function y(ie){c[ie]&&(h[ie]=function(oe){return new Promise(function(he,ke){m.push([ie,oe,he,ke])>1||w(ie,oe)})})}function w(ie,oe){try{C(c[ie](oe))}catch(he){j(m[0][3],he)}}function C(ie){ie.value instanceof vh?Promise.resolve(ie.value.v).then(D,z):j(m[0][2],ie)}function D(ie){w("next",ie)}function z(ie){w("throw",ie)}function j(ie,oe){ie(oe),m.shift(),m.length&&w(m[0][0],m[0][1])}}function MN(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i[Symbol.asyncIterator],a;return r?r.call(i):(i=typeof wN=="function"?wN(i):i[Symbol.iterator](),a={},c("next"),c("throw"),c("return"),a[Symbol.asyncIterator]=function(){return this},a);function c(m){a[m]=i[m]&&function(y){return new Promise(function(w,C){y=i[m](y),h(w,C,y.done,y.value)})}}function h(m,y,w,C){Promise.resolve(C).then(function(D){m({value:D,done:w})},y)}}var wp=i=>i&&typeof i.length=="number"&&typeof i!="function";function v0(i){return Rn(i?.then)}function x0(i){return Rn(i[gp])}function b0(i){return Symbol.asyncIterator&&Rn(i?.[Symbol.asyncIterator])}function w0(i){return new TypeError(`You provided ${i!==null&&typeof i=="object"?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Q7(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var T0=Q7();function E0(i){return Rn(i?.[T0])}function M0(i){return EN(this,arguments,function*(){let a=i.getReader();try{for(;;){let{value:c,done:h}=yield vh(a.read());if(h)return yield vh(void 0);yield yield vh(c)}}finally{a.releaseLock()}})}function I0(i){return Rn(i?.getReader)}function yi(i){if(i instanceof un)return i;if(i!=null){if(x0(i))return e9(i);if(wp(i))return t9(i);if(v0(i))return n9(i);if(b0(i))return IN(i);if(E0(i))return i9(i);if(I0(i))return r9(i)}throw w0(i)}function e9(i){return new un(r=>{let a=i[gp]();if(Rn(a.subscribe))return a.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function t9(i){return new un(r=>{for(let a=0;a<i.length&&!r.closed;a++)r.next(i[a]);r.complete()})}function n9(i){return new un(r=>{i.then(a=>{r.closed||(r.next(a),r.complete())},a=>r.error(a)).then(null,u0)})}function i9(i){return new un(r=>{for(let a of i)if(r.next(a),r.closed)return;r.complete()})}function IN(i){return new un(r=>{o9(i,r).catch(a=>r.error(a))})}function r9(i){return IN(M0(i))}function o9(i,r){var a,c,h,m;return y0(this,void 0,void 0,function*(){try{for(a=MN(i);c=yield a.next(),!c.done;){let y=c.value;if(r.next(y),r.closed)return}}catch(y){h={error:y}}finally{try{c&&!c.done&&(m=a.return)&&(yield m.call(a))}finally{if(h)throw h.error}}r.complete()})}function Ks(i,r,a,c=0,h=!1){let m=r.schedule(function(){a(),h?i.add(this.schedule(null,c)):this.unsubscribe()},c);if(i.add(m),!h)return m}function C0(i,r=0){return In((a,c)=>{a.subscribe(en(c,h=>Ks(c,i,()=>c.next(h),r),()=>Ks(c,i,()=>c.complete(),r),h=>Ks(c,i,()=>c.error(h),r)))})}function S0(i,r=0){return In((a,c)=>{c.add(i.schedule(()=>a.subscribe(c),r))})}function CN(i,r){return yi(i).pipe(S0(r),C0(r))}function SN(i,r){return yi(i).pipe(S0(r),C0(r))}function DN(i,r){return new un(a=>{let c=0;return r.schedule(function(){c===i.length?a.complete():(a.next(i[c++]),a.closed||this.schedule())})})}function AN(i,r){return new un(a=>{let c;return Ks(a,r,()=>{c=i[T0](),Ks(a,r,()=>{let h,m;try{({value:h,done:m}=c.next())}catch(y){a.error(y);return}m?a.complete():a.next(h)},0,!0)}),()=>Rn(c?.return)&&c.return()})}function D0(i,r){if(!i)throw new Error("Iterable cannot be null");return new un(a=>{Ks(a,r,()=>{let c=i[Symbol.asyncIterator]();Ks(a,r,()=>{c.next().then(h=>{h.done?a.complete():a.next(h.value)})},0,!0)})})}function PN(i,r){return D0(M0(i),r)}function ON(i,r){if(i!=null){if(x0(i))return CN(i,r);if(wp(i))return DN(i,r);if(v0(i))return SN(i,r);if(b0(i))return D0(i,r);if(E0(i))return AN(i,r);if(I0(i))return PN(i,r)}throw w0(i)}function vr(i,r){return r?ON(i,r):yi(i)}function Nt(...i){let r=ac(i);return vr(i,r)}function Tp(i,r){let a=Rn(i)?i:()=>i,c=h=>h.error(a());return new un(r?h=>r.schedule(c,0,h):c)}function xh(i){return!!i&&(i instanceof un||Rn(i.lift)&&Rn(i.subscribe))}var Jc=fp(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});function RN(i){return i instanceof Date&&!isNaN(i)}function st(i,r){return In((a,c)=>{let h=0;a.subscribe(en(c,m=>{c.next(i.call(r,m,h++))}))})}var{isArray:s9}=Array;function a9(i,r){return s9(r)?i(...r):i(r)}function Ep(i){return st(r=>a9(i,r))}var{isArray:l9}=Array,{getPrototypeOf:c9,prototype:u9,keys:d9}=Object;function A0(i){if(i.length===1){let r=i[0];if(l9(r))return{args:r,keys:null};if(h9(r)){let a=d9(r);return{args:a.map(c=>r[c]),keys:a}}}return{args:i,keys:null}}function h9(i){return i&&typeof i=="object"&&c9(i)===u9}function P0(i,r){return i.reduce((a,c,h)=>(a[c]=r[h],a),{})}function lc(...i){let r=ac(i),a=bp(i),{args:c,keys:h}=A0(i);if(c.length===0)return vr([],r);let m=new un(f9(c,r,h?y=>P0(h,y):mo));return a?m.pipe(Ep(a)):m}function f9(i,r,a=mo){return c=>{LN(r,()=>{let{length:h}=i,m=new Array(h),y=h,w=h;for(let C=0;C<h;C++)LN(r,()=>{let D=vr(i[C],r),z=!1;D.subscribe(en(c,j=>{m[C]=j,z||(z=!0,w--),w||c.next(a(m.slice()))},()=>{--y||c.complete()}))},c)},c)}}function LN(i,r,a){i?Ks(a,i,r):r()}function FN(i,r,a,c,h,m,y,w){let C=[],D=0,z=0,j=!1,ie=()=>{j&&!C.length&&!D&&r.complete()},oe=ke=>D<c?he(ke):C.push(ke),he=ke=>{m&&r.next(ke),D++;let rt=!1;yi(a(ke,z++)).subscribe(en(r,Ve=>{h?.(Ve),m?oe(Ve):r.next(Ve)},()=>{rt=!0},void 0,()=>{if(rt)try{for(D--;C.length&&D<c;){let Ve=C.shift();y?Ks(r,y,()=>he(Ve)):he(Ve)}ie()}catch(Ve){r.error(Ve)}}))};return i.subscribe(en(r,oe,()=>{j=!0,ie()})),()=>{w?.()}}function Oo(i,r,a=1/0){return Rn(r)?Oo((c,h)=>st((m,y)=>r(c,m,h,y))(yi(i(c,h))),a):(typeof r=="number"&&(a=r),In((c,h)=>FN(c,h,i,a)))}function Sg(i=1/0){return Oo(mo,i)}function kN(){return Sg(1)}function cc(...i){return kN()(vr(i,ac(i)))}function rd(i){return new un(r=>{yi(i()).subscribe(r)})}function CM(...i){let r=bp(i),{args:a,keys:c}=A0(i),h=new un(m=>{let{length:y}=a;if(!y){m.complete();return}let w=new Array(y),C=y,D=y;for(let z=0;z<y;z++){let j=!1;yi(a[z]).subscribe(en(m,ie=>{j||(j=!0,D--),w[z]=ie},()=>C--,void 0,()=>{(!C||!j)&&(D||m.next(c?P0(c,w):w),m.complete())}))}});return r?h.pipe(Ep(r)):h}var p9=["addListener","removeListener"],m9=["addEventListener","removeEventListener"],g9=["on","off"];function Wa(i,r,a,c){if(Rn(a)&&(c=a,a=void 0),c)return Wa(i,r,a).pipe(Ep(c));let[h,m]=v9(i)?m9.map(y=>w=>i[y](r,w,a)):_9(i)?p9.map(NN(i,r)):y9(i)?g9.map(NN(i,r)):[];if(!h&&wp(i))return Oo(y=>Wa(y,r,a))(yi(i));if(!h)throw new TypeError("Invalid event target");return new un(y=>{let w=(...C)=>y.next(1<C.length?C:C[0]);return h(w),()=>m(w)})}function NN(i,r){return a=>c=>i[a](r,c)}function _9(i){return Rn(i.addListener)&&Rn(i.removeListener)}function y9(i){return Rn(i.on)&&Rn(i.off)}function v9(i){return Rn(i.addEventListener)&&Rn(i.removeEventListener)}function Zo(i=0,r,a=xN){let c=-1;return r!=null&&(g0(r)?a=r:c=r),new un(h=>{let m=RN(i)?+i-a.now():i;m<0&&(m=0);let y=0;return a.schedule(function(){h.closed||(h.next(y++),0<=c?this.schedule(void 0,c):h.complete())},m)})}function go(...i){let r=ac(i),a=bN(i,1/0),c=i;return c.length?c.length===1?yi(c[0]):Sg(a)(vr(c,r)):Lr}var{isArray:x9}=Array;function zN(i){return i.length===1&&x9(i[0])?i[0]:i}function zi(i,r){return In((a,c)=>{let h=0;a.subscribe(en(c,m=>i.call(r,m,h++)&&c.next(m)))})}function SM(...i){return i=zN(i),i.length===1?yi(i[0]):new un(b9(i))}function b9(i){return r=>{let a=[];for(let c=0;a&&!r.closed&&c<i.length;c++)a.push(yi(i[c]).subscribe(en(r,h=>{if(a){for(let m=0;m<a.length;m++)m!==c&&a[m].unsubscribe();a=null}r.next(h)})))}}function wl(i){return In((r,a)=>{let c=null,h=!1,m;c=r.subscribe(en(a,void 0,void 0,y=>{m=yi(i(y,wl(i)(r))),c?(c.unsubscribe(),c=null,m.subscribe(a)):h=!0})),h&&(c.unsubscribe(),c=null,m.subscribe(a))})}function BN(i,r,a,c,h){return(m,y)=>{let w=a,C=r,D=0;m.subscribe(en(y,z=>{let j=D++;C=w?i(C,z,j):(w=!0,z),c&&y.next(C)},h&&(()=>{w&&y.next(C),y.complete()})))}}function od(i,r){return Rn(r)?Oo(i,r,1):Oo(i,1)}function O0(i,r=Cg){return In((a,c)=>{let h=null,m=null,y=null,w=()=>{if(h){h.unsubscribe(),h=null;let D=m;m=null,c.next(D)}};function C(){let D=y+i,z=r.now();if(z<D){h=this.schedule(void 0,D-z),c.add(h);return}w()}a.subscribe(en(c,D=>{m=D,y=r.now(),h||(h=r.schedule(C,i),c.add(h))},()=>{w(),c.complete()},void 0,()=>{m=h=null}))})}function sd(i){return In((r,a)=>{let c=!1;r.subscribe(en(a,h=>{c=!0,a.next(h)},()=>{c||a.next(i),a.complete()}))})}function Bo(i){return i<=0?()=>Lr:In((r,a)=>{let c=0;r.subscribe(en(a,h=>{++c<=i&&(a.next(h),i<=c&&a.complete())}))})}function DM(){return In((i,r)=>{i.subscribe(en(r,Yc))})}function AM(i){return st(()=>i)}function Ro(i,r=mo){return i=i??w9,In((a,c)=>{let h,m=!0;a.subscribe(en(c,y=>{let w=r(y);(m||!i(h,w))&&(m=!1,h=w,c.next(y))}))})}function w9(i,r){return i===r}function R0(i=T9){return In((r,a)=>{let c=!1;r.subscribe(en(a,h=>{c=!0,a.next(h)},()=>c?a.complete():a.error(i())))})}function T9(){return new Jc}function Qc(i){return In((r,a)=>{try{r.subscribe(a)}finally{a.add(i)}})}function Tl(i,r){let a=arguments.length>=2;return c=>c.pipe(i?zi((h,m)=>i(h,m,c)):mo,Bo(1),a?sd(r):R0(()=>new Jc))}function Mp(i){return i<=0?()=>Lr:In((r,a)=>{let c=[];r.subscribe(en(a,h=>{c.push(h),i<c.length&&c.shift()},()=>{for(let h of c)a.next(h);a.complete()},void 0,()=>{c=null}))})}function PM(i,r){let a=arguments.length>=2;return c=>c.pipe(i?zi((h,m)=>i(h,m,c)):mo,Mp(1),a?sd(r):R0(()=>new Jc))}function L0(i){let r=1/0,a;return i!=null&&(typeof i=="object"?{count:r=1/0,delay:a}=i:r=i),r<=0?()=>Lr:In((c,h)=>{let m=0,y,w=()=>{if(y?.unsubscribe(),y=null,a!=null){let D=typeof a=="number"?Zo(a):yi(a(m)),z=en(h,()=>{z.unsubscribe(),C()});D.subscribe(z)}else C()},C=()=>{let D=!1;y=c.subscribe(en(h,void 0,()=>{++m<r?y?w():D=!0:h.complete()})),D&&w()};C()})}function Dg(i){return In((r,a)=>{let c,h=!1,m,y=!1,w=!1,C=()=>w&&y&&(a.complete(),!0),D=()=>(m||(m=new Qr,yi(i(m)).subscribe(en(a,()=>{c?z():h=!0},()=>{y=!0,C()}))),m),z=()=>{w=!1,c=r.subscribe(en(a,void 0,()=>{w=!0,!C()&&D().next()})),h&&(c.unsubscribe(),c=null,h=!1,z())};z()})}function F0(i,r){return In(BN(i,r,arguments.length>=2,!0))}function ya(i={}){let{connector:r=()=>new Qr,resetOnError:a=!0,resetOnComplete:c=!0,resetOnRefCountZero:h=!0}=i;return m=>{let y,w,C,D=0,z=!1,j=!1,ie=()=>{w?.unsubscribe(),w=void 0},oe=()=>{ie(),y=C=void 0,z=j=!1},he=()=>{let ke=y;oe(),ke?.unsubscribe()};return In((ke,rt)=>{D++,!j&&!z&&ie();let Ve=C=C??r();rt.add(()=>{D--,D===0&&!j&&!z&&(w=OM(he,h))}),Ve.subscribe(rt),!y&&D>0&&(y=new Xc({next:Ot=>Ve.next(Ot),error:Ot=>{j=!0,ie(),w=OM(oe,a,Ot),Ve.error(Ot)},complete:()=>{z=!0,ie(),w=OM(oe,c),Ve.complete()}}),yi(ke).subscribe(y))})(m)}}function OM(i,r,...a){if(r===!0){i();return}if(r===!1)return;let c=new Xc({next:()=>{c.unsubscribe(),i()}});return yi(r(...a)).subscribe(c)}function va(i,r,a){let c,h=!1;return i&&typeof i=="object"?{bufferSize:c=1/0,windowTime:r=1/0,refCount:h=!1,scheduler:a}=i:c=i??1/0,ya({connector:()=>new Kc(c,r,a),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:h})}function RM(i){return zi((r,a)=>i<=a)}function LM(i){return In((r,a)=>{let c=!1,h=0;r.subscribe(en(a,m=>(c||(c=!i(m,h++)))&&a.next(m)))})}function xr(...i){let r=ac(i);return In((a,c)=>{(r?cc(i,a,r):cc(i,a)).subscribe(c)})}function Fi(i,r){return In((a,c)=>{let h=null,m=0,y=!1,w=()=>y&&!h&&c.complete();a.subscribe(en(c,C=>{h?.unsubscribe();let D=0,z=m++;yi(i(C,z)).subscribe(h=en(c,j=>c.next(r?r(C,j,z,D++):j),()=>{h=null,w()}))},()=>{y=!0,w()}))})}function Ii(i){return In((r,a)=>{yi(i).subscribe(en(a,()=>a.complete(),Yc)),!a.closed&&r.subscribe(a)})}function k0(i,r=!1){return In((a,c)=>{let h=0;a.subscribe(en(c,m=>{let y=i(m,h++);(y||r)&&c.next(m),!y&&c.complete()}))})}function Vr(i,r,a){let c=Rn(i)||r||a?{next:i,error:r,complete:a}:i;return c?In((h,m)=>{var y;(y=c.subscribe)===null||y===void 0||y.call(c);let w=!0;h.subscribe(en(m,C=>{var D;(D=c.next)===null||D===void 0||D.call(c,C),m.next(C)},()=>{var C;w=!1,(C=c.complete)===null||C===void 0||C.call(c),m.complete()},C=>{var D;w=!1,(D=c.error)===null||D===void 0||D.call(c,C),m.error(C)},()=>{var C,D;w&&((C=c.unsubscribe)===null||C===void 0||C.call(c)),(D=c.finalize)===null||D===void 0||D.call(c)}))}):mo}function jN(i,r){return In((a,c)=>{let{leading:h=!0,trailing:m=!1}=r??{},y=!1,w=null,C=null,D=!1,z=()=>{C?.unsubscribe(),C=null,m&&(oe(),D&&c.complete())},j=()=>{C=null,D&&c.complete()},ie=he=>C=yi(i(he)).subscribe(en(c,z,j)),oe=()=>{if(y){y=!1;let he=w;w=null,c.next(he),!D&&ie(he)}};a.subscribe(en(c,he=>{y=!0,w=he,!(C&&!C.closed)&&(h?oe():ie(he))},()=>{D=!0,!(m&&y&&C&&!C.closed)&&c.complete()}))})}function bh(i,r=Cg,a){let c=Zo(i,r);return jN(()=>c,a)}function Ag(...i){let r=bp(i);return In((a,c)=>{let h=i.length,m=new Array(h),y=i.map(()=>!1),w=!1;for(let C=0;C<h;C++)yi(i[C]).subscribe(en(c,D=>{m[C]=D,!w&&!y[C]&&(y[C]=!0,(w=y.every(mo))&&(y=null))},Yc));a.subscribe(en(c,C=>{if(w){let D=[C,...m];c.next(r?r(...D):D)}}))})}var P3="https://g.co/ng/security#xss",mt=class extends Error{constructor(r,a){super(wx(r,a)),this.code=r}};function wx(i,r){return`${`NG0${Math.abs(i)}`}${r?": "+r:""}`}function Fr(i){for(let r in i)if(i[r]===Fr)return r;throw Error("Could not find renamed property on target object.")}function E9(i,r){for(let a in r)r.hasOwnProperty(a)&&!i.hasOwnProperty(a)&&(i[a]=r[a])}function Rs(i){if(typeof i=="string")return i;if(Array.isArray(i))return"["+i.map(Rs).join(", ")+"]";if(i==null)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;let r=i.toString();if(r==null)return""+r;let a=r.indexOf(`
`);return a===-1?r:r.substring(0,a)}function VN(i,r){return i==null||i===""?r===null?"":r:r==null||r===""?i:i+" "+r}var M9=Fr({__forward_ref__:Fr});function Lh(i){return i.__forward_ref__=Lh,i.toString=function(){return Rs(this())},i}function Os(i){return O3(i)?i():i}function O3(i){return typeof i=="function"&&i.hasOwnProperty(M9)&&i.__forward_ref__===Lh}function R3(i){return i&&!!i.\u0275providers}var I9=Fr({\u0275cmp:Fr}),C9=Fr({\u0275dir:Fr}),S9=Fr({\u0275pipe:Fr}),D9=Fr({\u0275mod:Fr}),J0=Fr({\u0275fac:Fr}),Pg=Fr({__NG_ELEMENT_ID__:Fr}),UN=Fr({__NG_ENV_ID__:Fr});function Eh(i){return typeof i=="string"?i:i==null?"":String(i)}function A9(i){return typeof i=="function"?i.name||i.toString():typeof i=="object"&&i!=null&&typeof i.type=="function"?i.type.name||i.type.toString():Eh(i)}function P9(i,r){let a=r?`. Dependency path: ${r.join(" > ")} > ${i}`:"";throw new mt(-200,i)}function iC(i,r){throw new mt(-201,!1)}function gt(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function bt(i){return{providers:i.providers||[],imports:i.imports||[]}}function Tx(i){return $N(i,F3)||$N(i,k3)}function L3(i){return Tx(i)!==null}function $N(i,r){return i.hasOwnProperty(r)?i[r]:null}function O9(i){let r=i&&(i[F3]||i[k3]);return r||null}function HN(i){return i&&(i.hasOwnProperty(GN)||i.hasOwnProperty(R9))?i[GN]:null}var F3=Fr({\u0275prov:Fr}),GN=Fr({\u0275inj:Fr}),k3=Fr({ngInjectableDef:Fr}),R9=Fr({ngInjectorDef:Fr}),vi=function(i){return i[i.Default=0]="Default",i[i.Host=1]="Host",i[i.Self=2]="Self",i[i.SkipSelf=4]="SkipSelf",i[i.Optional=8]="Optional",i}(vi||{}),eI;function L9(){return eI}function Js(i){let r=eI;return eI=i,r}function N3(i,r,a){let c=Tx(i);if(c&&c.providedIn=="root")return c.value===void 0?c.value=c.factory():c.value;if(a&vi.Optional)return null;if(r!==void 0)return r;iC(i,"Injector")}var xa=globalThis;var ot=class{constructor(r,a){this._desc=r,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof a=="number"?this.__NG_ELEMENT_ID__=a:a!==void 0&&(this.\u0275prov=gt({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};var F9={},Lg=F9,tI="__NG_DI_FLAG__",Q0="ngTempTokenPath",k9="ngTokenPath",N9=/\n/gm,z9="\u0275",WN="__source",Og;function ad(i){let r=Og;return Og=i,r}function B9(i,r=vi.Default){if(Og===void 0)throw new mt(-203,!1);return Og===null?N3(i,void 0,r):Og.get(i,r&vi.Optional?null:void 0,r)}function Ct(i,r=vi.Default){return(L9()||B9)(Os(i),r)}function Ee(i,r=vi.Default){return Ct(i,Ex(r))}function Ex(i){return typeof i>"u"||typeof i=="number"?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function nI(i){let r=[];for(let a=0;a<i.length;a++){let c=Os(i[a]);if(Array.isArray(c)){if(c.length===0)throw new mt(900,!1);let h,m=vi.Default;for(let y=0;y<c.length;y++){let w=c[y],C=j9(w);typeof C=="number"?C===-1?h=w.token:m|=C:h=w}r.push(Ct(h,m))}else r.push(Ct(c))}return r}function rC(i,r){return i[tI]=r,i.prototype[tI]=r,i}function j9(i){return i[tI]}function V9(i,r,a,c){let h=i[Q0];throw r[WN]&&h.unshift(r[WN]),i.message=U9(`
`+i.message,h,a,c),i[k9]=h,i[Q0]=null,i}function U9(i,r,a,c=null){i=i&&i.charAt(0)===`
`&&i.charAt(1)==z9?i.slice(2):i;let h=Rs(r);if(Array.isArray(r))h=r.map(Rs).join(" -> ");else if(typeof r=="object"){let m=[];for(let y in r)if(r.hasOwnProperty(y)){let w=r[y];m.push(y+":"+(typeof w=="string"?JSON.stringify(w):Rs(w)))}h=`{${m.join(", ")}}`}return`${a}${c?"("+c+")":""}[${h}]: ${i.replace(N9,`
  `)}`}function Xg(i){return{toString:i}.toString()}var z3=function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i}(z3||{}),fc=function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i}(fc||{}),Ap={},ba=[],Bi=function(i){return i[i.None=0]="None",i[i.SignalBased=1]="SignalBased",i[i.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",i}(Bi||{});function B3(i,r,a){let c=i.length;for(;;){let h=i.indexOf(r,a);if(h===-1)return h;if(h===0||i.charCodeAt(h-1)<=32){let m=r.length;if(h+m===c||i.charCodeAt(h+m)<=32)return h}a=h+1}}function iI(i,r,a){let c=0;for(;c<a.length;){let h=a[c];if(typeof h=="number"){if(h!==0)break;c++;let m=a[c++],y=a[c++],w=a[c++];i.setAttribute(r,y,w,m)}else{let m=h,y=a[++c];$9(m)?i.setProperty(r,m,y):i.setAttribute(r,m,y),c++}}return c}function j3(i){return i===3||i===4||i===6}function $9(i){return i.charCodeAt(0)===64}function Fg(i,r){if(!(r===null||r.length===0))if(i===null||i.length===0)i=r.slice();else{let a=-1;for(let c=0;c<r.length;c++){let h=r[c];typeof h=="number"?a=h:a===0||(a===-1||a===2?qN(i,a,h,null,r[++c]):qN(i,a,h,null,null))}}return i}function qN(i,r,a,c,h){let m=0,y=i.length;if(r===-1)y=-1;else for(;m<i.length;){let w=i[m++];if(typeof w=="number"){if(w===r){y=-1;break}else if(w>r){y=m-1;break}}}for(;m<i.length;){let w=i[m];if(typeof w=="number")break;if(w===a){if(c===null){h!==null&&(i[m+1]=h);return}else if(c===i[m+1]){i[m+2]=h;return}}m++,c!==null&&m++,h!==null&&m++}y!==-1&&(i.splice(y,0,r),m=y+1),i.splice(m++,0,a),c!==null&&i.splice(m++,0,c),h!==null&&i.splice(m++,0,h)}var V3="ng-template";function H9(i,r,a){let c=0,h=!0;for(;c<i.length;){let m=i[c++];if(typeof m=="string"&&h){let y=i[c++];if(a&&m==="class"&&B3(y.toLowerCase(),r,0)!==-1)return!0}else if(m===1){for(;c<i.length&&typeof(m=i[c++])=="string";)if(m.toLowerCase()===r)return!0;return!1}else typeof m=="number"&&(h=!1)}return!1}function U3(i){return i.type===4&&i.value!==V3}function G9(i,r,a){let c=i.type===4&&!a?V3:i.value;return r===c}function W9(i,r,a){let c=4,h=i.attrs||[],m=Y9(h),y=!1;for(let w=0;w<r.length;w++){let C=r[w];if(typeof C=="number"){if(!y&&!El(c)&&!El(C))return!1;if(y&&El(C))continue;y=!1,c=C|c&1;continue}if(!y)if(c&4){if(c=2|c&1,C!==""&&!G9(i,C,a)||C===""&&r.length===1){if(El(c))return!1;y=!0}}else{let D=c&8?C:r[++w];if(c&8&&i.attrs!==null){if(!H9(i.attrs,D,a)){if(El(c))return!1;y=!0}continue}let z=c&8?"class":C,j=q9(z,h,U3(i),a);if(j===-1){if(El(c))return!1;y=!0;continue}if(D!==""){let ie;j>m?ie="":ie=h[j+1].toLowerCase();let oe=c&8?ie:null;if(oe&&B3(oe,D,0)!==-1||c&2&&D!==ie){if(El(c))return!1;y=!0}}}}return El(c)||y}function El(i){return(i&1)===0}function q9(i,r,a,c){if(r===null)return-1;let h=0;if(c||!a){let m=!1;for(;h<r.length;){let y=r[h];if(y===i)return h;if(y===3||y===6)m=!0;else if(y===1||y===2){let w=r[++h];for(;typeof w=="string";)w=r[++h];continue}else{if(y===4)break;if(y===0){h+=4;continue}}h+=m?1:2}return-1}else return X9(r,i)}function $3(i,r,a=!1){for(let c=0;c<r.length;c++)if(W9(i,r[c],a))return!0;return!1}function Z9(i){let r=i.attrs;if(r!=null){let a=r.indexOf(5);if(!(a&1))return r[a+1]}return null}function Y9(i){for(let r=0;r<i.length;r++){let a=i[r];if(j3(a))return r}return i.length}function X9(i,r){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){let c=i[a];if(typeof c=="number")return-1;if(c===r)return a;a++}return-1}function K9(i,r){e:for(let a=0;a<r.length;a++){let c=r[a];if(i.length===c.length){for(let h=0;h<i.length;h++)if(i[h]!==c[h])continue e;return!0}}return!1}function ZN(i,r){return i?":not("+r.trim()+")":r}function J9(i){let r=i[0],a=1,c=2,h="",m=!1;for(;a<i.length;){let y=i[a];if(typeof y=="string")if(c&2){let w=i[++a];h+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else c&8?h+="."+y:c&4&&(h+=" "+y);else h!==""&&!El(y)&&(r+=ZN(m,h),h=""),c=y,m=m||!El(c);a++}return h!==""&&(r+=ZN(m,h)),r}function Q9(i){return i.map(J9).join(",")}function eY(i){let r=[],a=[],c=1,h=2;for(;c<i.length;){let m=i[c];if(typeof m=="string")h===2?m!==""&&r.push(m,i[++c]):h===8&&a.push(m);else{if(!El(h))break;h=m}c++}return{attrs:r,classes:a}}function Cn(i){return Xg(()=>{let r=Z3(i),a=Er(Lt({},r),{decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===z3.OnPush,directiveDefs:null,pipeDefs:null,dependencies:r.standalone&&i.dependencies||null,getStandaloneInjector:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||fc.Emulated,styles:i.styles||ba,_:null,schemas:i.schemas||null,tView:null,id:""});Y3(a);let c=i.dependencies;return a.directiveDefs=XN(c,!1),a.pipeDefs=XN(c,!0),a.id=iY(a),a})}function tY(i){return Mh(i)||H3(i)}function nY(i){return i!==null}function wt(i){return Xg(()=>({type:i.type,bootstrap:i.bootstrap||ba,declarations:i.declarations||ba,imports:i.imports||ba,exports:i.exports||ba,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function YN(i,r){if(i==null)return Ap;let a={};for(let c in i)if(i.hasOwnProperty(c)){let h=i[c],m,y,w=Bi.None;Array.isArray(h)?(w=h[0],m=h[1],y=h[2]??m):(m=h,y=h),r?(a[m]=w!==Bi.None?[c,w]:c,r[m]=y):a[m]=c}return a}function pn(i){return Xg(()=>{let r=Z3(i);return Y3(r),r})}function qa(i){return{type:i.type,name:i.name,factory:null,pure:i.pure!==!1,standalone:i.standalone===!0,onDestroy:i.type.prototype.ngOnDestroy||null}}function Mh(i){return i[I9]||null}function H3(i){return i[C9]||null}function G3(i){return i[S9]||null}function W3(i){let r=Mh(i)||H3(i)||G3(i);return r!==null?r.standalone:!1}function q3(i,r){let a=i[D9]||null;if(!a&&r===!0)throw new Error(`Type ${Rs(i)} does not have '\u0275mod' property.`);return a}function Z3(i){let r={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:r,inputTransforms:null,inputConfig:i.inputs||Ap,exportAs:i.exportAs||null,standalone:i.standalone===!0,signals:i.signals===!0,selectors:i.selectors||ba,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:YN(i.inputs,r),outputs:YN(i.outputs),debugInfo:null}}function Y3(i){i.features?.forEach(r=>r(i))}function XN(i,r){if(!i)return null;let a=r?G3:tY;return()=>(typeof i=="function"?i():i).map(c=>a(c)).filter(nY)}function iY(i){let r=0,a=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,i.consts,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery].join("|");for(let h of a)r=Math.imul(31,r)+h.charCodeAt(0)<<0;return r+=2147483648,"c"+r}var Qs=0,Yn=1,Bn=2,Qo=3,Ml=4,Ta=5,Il=6,kg=7,_s=8,Pp=9,tu=10,eo=11,Ng=12,KN=13,kp=14,ea=15,Kg=16,Ip=17,hc=18,Mx=19,X3=20,Rg=21,FM=22,Ih=23,to=25,oC=1,zg=6,nu=7,ex=8,Op=9,ss=10,sC=function(i){return i[i.None=0]="None",i[i.HasTransplantedViews=2]="HasTransplantedViews",i}(sC||{});function eu(i){return Array.isArray(i)&&typeof i[oC]=="object"}function pc(i){return Array.isArray(i)&&i[oC]===!0}function aC(i){return(i.flags&4)!==0}function Jg(i){return i.componentOffset>-1}function Ix(i){return(i.flags&1)===1}function iu(i){return!!i.template}function K3(i){return(i[Bn]&512)!==0}function Ch(i,r){let a=i.hasOwnProperty(J0);return a?i[J0]:null}var rI=class{constructor(r,a,c){this.previousValue=r,this.currentValue=a,this.firstChange=c}isFirstChange(){return this.firstChange}};function J3(i,r,a,c){r!==null?r.applyValueToInputSignal(r,c):i[a]=c}function na(){return Q3}function Q3(i){return i.type.prototype.ngOnChanges&&(i.setInput=oY),rY}na.ngInherit=!0;function rY(){let i=tz(this),r=i?.current;if(r){let a=i.previous;if(a===Ap)i.previous=r;else for(let c in r)a[c]=r[c];i.current=null,this.ngOnChanges(r)}}function oY(i,r,a,c,h){let m=this.declaredInputs[c],y=tz(i)||sY(i,{previous:Ap,current:null}),w=y.current||(y.current={}),C=y.previous,D=C[m];w[m]=new rI(D&&D.currentValue,a,C===Ap),J3(i,r,h,a)}var ez="__ngSimpleChanges__";function tz(i){return i[ez]||null}function sY(i,r){return i[ez]=r}var JN=null;var uc=function(i,r,a){JN?.(i,r,a)},nz="svg",aY="math",lY=!1;function cY(){return lY}function Cl(i){for(;Array.isArray(i);)i=i[Qs];return i}function uY(i){for(;Array.isArray(i);){if(typeof i[oC]=="object")return i;i=i[Qs]}return null}function iz(i,r){return Cl(r[i])}function Ea(i,r){return Cl(r[i.index])}function lC(i,r){return i.data[r]}function Qg(i,r){return i[r]}function cd(i,r){let a=r[i];return eu(a)?a:a[Qs]}function dY(i){return(i[Bn]&4)===4}function cC(i){return(i[Bn]&128)===128}function hY(i){return pc(i[Qo])}function Rp(i,r){return r==null?null:i[r]}function rz(i){i[Ip]=0}function fY(i){i[Bn]&1024||(i[Bn]|=1024,cC(i)&&Bg(i))}function pY(i,r){for(;i>0;)r=r[kp],i--;return r}function uC(i){return!!(i[Bn]&9216||i[Ih]?.dirty)}function oI(i){uC(i)?Bg(i):i[Bn]&64&&(cY()?(i[Bn]|=1024,Bg(i)):i[tu].changeDetectionScheduler?.notify())}function Bg(i){i[tu].changeDetectionScheduler?.notify();let r=jg(i);for(;r!==null&&!(r[Bn]&8192||(r[Bn]|=8192,!cC(r)));)r=jg(r)}function mY(i,r){if((i[Bn]&256)===256)throw new mt(911,!1);i[Rg]===null&&(i[Rg]=[]),i[Rg].push(r)}function jg(i){let r=i[Qo];return pc(r)?r[Qo]:r}var ei={lFrame:hz(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function gY(){return ei.lFrame.elementDepthCount}function _Y(){ei.lFrame.elementDepthCount++}function yY(){ei.lFrame.elementDepthCount--}function oz(){return ei.bindingsEnabled}function Np(){return ei.skipHydrationRootTNode!==null}function vY(i){return ei.skipHydrationRootTNode===i}function xY(i){ei.skipHydrationRootTNode=i}function bY(){ei.skipHydrationRootTNode=null}function hi(){return ei.lFrame.lView}function Yo(){return ei.lFrame.tView}function ji(i){return ei.lFrame.contextLView=i,i[_s]}function Vi(i){return ei.lFrame.contextLView=null,i}function ia(){let i=sz();for(;i!==null&&i.type===64;)i=i.parent;return i}function sz(){return ei.lFrame.currentTNode}function wY(){let i=ei.lFrame,r=i.currentTNode;return i.isParent?r:r.parent}function Fh(i,r){let a=ei.lFrame;a.currentTNode=i,a.isParent=r}function dC(){return ei.lFrame.isParent}function hC(){ei.lFrame.isParent=!1}function TY(){return ei.lFrame.contextLView}function zp(){let i=ei.lFrame,r=i.bindingRootIndex;return r===-1&&(r=i.bindingRootIndex=i.tView.bindingStartIndex),r}function EY(){return ei.lFrame.bindingIndex}function MY(i){return ei.lFrame.bindingIndex=i}function kh(){return ei.lFrame.bindingIndex++}function az(i){let r=ei.lFrame,a=r.bindingIndex;return r.bindingIndex=r.bindingIndex+i,a}function IY(){return ei.lFrame.inI18n}function CY(i,r){let a=ei.lFrame;a.bindingIndex=a.bindingRootIndex=i,sI(r)}function SY(){return ei.lFrame.currentDirectiveIndex}function sI(i){ei.lFrame.currentDirectiveIndex=i}function lz(i){let r=ei.lFrame.currentDirectiveIndex;return r===-1?null:i[r]}function cz(){return ei.lFrame.currentQueryIndex}function fC(i){ei.lFrame.currentQueryIndex=i}function DY(i){let r=i[Yn];return r.type===2?r.declTNode:r.type===1?i[Ta]:null}function uz(i,r,a){if(a&vi.SkipSelf){let h=r,m=i;for(;h=h.parent,h===null&&!(a&vi.Host);)if(h=DY(m),h===null||(m=m[kp],h.type&10))break;if(h===null)return!1;r=h,i=m}let c=ei.lFrame=dz();return c.currentTNode=r,c.lView=i,!0}function pC(i){let r=dz(),a=i[Yn];ei.lFrame=r,r.currentTNode=a.firstChild,r.lView=i,r.tView=a,r.contextLView=i,r.bindingIndex=a.bindingStartIndex,r.inI18n=!1}function dz(){let i=ei.lFrame,r=i===null?null:i.child;return r===null?hz(i):r}function hz(i){let r={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return i!==null&&(i.child=r),r}function fz(){let i=ei.lFrame;return ei.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}var pz=fz;function mC(){let i=fz();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function AY(i){return(ei.lFrame.contextLView=pY(i,ei.lFrame.contextLView))[_s]}function ud(){return ei.lFrame.selectedIndex}function Sh(i){ei.lFrame.selectedIndex=i}function Cx(){let i=ei.lFrame;return lC(i.tView,i.selectedIndex)}function Sl(){ei.lFrame.currentNamespace=nz}function mz(){PY()}function PY(){ei.lFrame.currentNamespace=null}function gz(){return ei.lFrame.currentNamespace}var _z=!0;function Sx(){return _z}function dd(i){_z=i}function OY(i,r,a){let{ngOnChanges:c,ngOnInit:h,ngDoCheck:m}=r.type.prototype;if(c){let y=Q3(r);(a.preOrderHooks??=[]).push(i,y),(a.preOrderCheckHooks??=[]).push(i,y)}h&&(a.preOrderHooks??=[]).push(0-i,h),m&&((a.preOrderHooks??=[]).push(i,m),(a.preOrderCheckHooks??=[]).push(i,m))}function Dx(i,r){for(let a=r.directiveStart,c=r.directiveEnd;a<c;a++){let m=i.data[a].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:C,ngAfterViewChecked:D,ngOnDestroy:z}=m;y&&(i.contentHooks??=[]).push(-a,y),w&&((i.contentHooks??=[]).push(a,w),(i.contentCheckHooks??=[]).push(a,w)),C&&(i.viewHooks??=[]).push(-a,C),D&&((i.viewHooks??=[]).push(a,D),(i.viewCheckHooks??=[]).push(a,D)),z!=null&&(i.destroyHooks??=[]).push(a,z)}}function W0(i,r,a){yz(i,r,3,a)}function q0(i,r,a,c){(i[Bn]&3)===a&&yz(i,r,a,c)}function kM(i,r){let a=i[Bn];(a&3)===r&&(a&=16383,a+=1,i[Bn]=a)}function yz(i,r,a,c){let h=c!==void 0?i[Ip]&65535:0,m=c??-1,y=r.length-1,w=0;for(let C=h;C<y;C++)if(typeof r[C+1]=="number"){if(w=r[C],c!=null&&w>=c)break}else r[C]<0&&(i[Ip]+=65536),(w<m||m==-1)&&(RY(i,a,r,C),i[Ip]=(i[Ip]&4294901760)+C+2),C++}function QN(i,r){uc(4,i,r);let a=qo(null);try{r.call(i)}finally{qo(a),uc(5,i,r)}}function RY(i,r,a,c){let h=a[c]<0,m=a[c+1],y=h?-a[c]:a[c],w=i[y];h?i[Bn]>>14<i[Ip]>>16&&(i[Bn]&3)===r&&(i[Bn]+=16384,QN(w,m)):QN(w,m)}var Dp=-1,Dh=class{constructor(r,a,c){this.factory=r,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=c}};function LY(i){return i instanceof Dh}function FY(i){return(i.flags&8)!==0}function kY(i){return(i.flags&16)!==0}function vz(i){return i!==Dp}function tx(i){return i&32767}function NY(i){return i>>16}function nx(i,r){let a=NY(i),c=r;for(;a>0;)c=c[kp],a--;return c}var aI=!0;function ix(i){let r=aI;return aI=i,r}var zY=256,xz=zY-1,bz=5,BY=0,dc={};function jY(i,r,a){let c;typeof a=="string"?c=a.charCodeAt(0)||0:a.hasOwnProperty(Pg)&&(c=a[Pg]),c==null&&(c=a[Pg]=BY++);let h=c&xz,m=1<<h;r.data[i+(h>>bz)]|=m}function rx(i,r){let a=wz(i,r);if(a!==-1)return a;let c=r[Yn];c.firstCreatePass&&(i.injectorIndex=r.length,NM(c.data,i),NM(r,null),NM(c.blueprint,null));let h=gC(i,r),m=i.injectorIndex;if(vz(h)){let y=tx(h),w=nx(h,r),C=w[Yn].data;for(let D=0;D<8;D++)r[m+D]=w[y+D]|C[y+D]}return r[m+8]=h,m}function NM(i,r){i.push(0,0,0,0,0,0,0,0,r)}function wz(i,r){return i.injectorIndex===-1||i.parent&&i.parent.injectorIndex===i.injectorIndex||r[i.injectorIndex+8]===null?-1:i.injectorIndex}function gC(i,r){if(i.parent&&i.parent.injectorIndex!==-1)return i.parent.injectorIndex;let a=0,c=null,h=r;for(;h!==null;){if(c=Cz(h),c===null)return Dp;if(a++,h=h[kp],c.injectorIndex!==-1)return c.injectorIndex|a<<16}return Dp}function lI(i,r,a){jY(i,r,a)}function VY(i,r){if(r==="class")return i.classes;if(r==="style")return i.styles;let a=i.attrs;if(a){let c=a.length,h=0;for(;h<c;){let m=a[h];if(j3(m))break;if(m===0)h=h+2;else if(typeof m=="number")for(h++;h<c&&typeof a[h]=="string";)h++;else{if(m===r)return a[h+1];h=h+2}}}return null}function Tz(i,r,a){if(a&vi.Optional||i!==void 0)return i;iC(r,"NodeInjector")}function Ez(i,r,a,c){if(a&vi.Optional&&c===void 0&&(c=null),!(a&(vi.Self|vi.Host))){let h=i[Pp],m=Js(void 0);try{return h?h.get(r,c,a&vi.Optional):N3(r,c,a&vi.Optional)}finally{Js(m)}}return Tz(c,r,a)}function Mz(i,r,a,c=vi.Default,h){if(i!==null){if(r[Bn]&2048&&!(c&vi.Self)){let y=GY(i,r,a,c,dc);if(y!==dc)return y}let m=Iz(i,r,a,c,dc);if(m!==dc)return m}return Ez(r,a,c,h)}function Iz(i,r,a,c,h){let m=$Y(a);if(typeof m=="function"){if(!uz(r,i,c))return c&vi.Host?Tz(h,a,c):Ez(r,a,c,h);try{let y;if(y=m(c),y==null&&!(c&vi.Optional))iC(a);else return y}finally{pz()}}else if(typeof m=="number"){let y=null,w=wz(i,r),C=Dp,D=c&vi.Host?r[ea][Ta]:null;for((w===-1||c&vi.SkipSelf)&&(C=w===-1?gC(i,r):r[w+8],C===Dp||!t3(c,!1)?w=-1:(y=r[Yn],w=tx(C),r=nx(C,r)));w!==-1;){let z=r[Yn];if(e3(m,w,z.data)){let j=UY(w,r,a,y,c,D);if(j!==dc)return j}C=r[w+8],C!==Dp&&t3(c,r[Yn].data[w+8]===D)&&e3(m,w,r)?(y=z,w=tx(C),r=nx(C,r)):w=-1}}return h}function UY(i,r,a,c,h,m){let y=r[Yn],w=y.data[i+8],C=c==null?Jg(w)&&aI:c!=y&&(w.type&3)!==0,D=h&vi.Host&&m===w,z=Z0(w,y,a,C,D);return z!==null?Ah(r,y,z,w):dc}function Z0(i,r,a,c,h){let m=i.providerIndexes,y=r.data,w=m&1048575,C=i.directiveStart,D=i.directiveEnd,z=m>>20,j=c?w:w+z,ie=h?w+z:D;for(let oe=j;oe<ie;oe++){let he=y[oe];if(oe<C&&a===he||oe>=C&&he.type===a)return oe}if(h){let oe=y[C];if(oe&&iu(oe)&&oe.type===a)return C}return null}function Ah(i,r,a,c){let h=i[a],m=r.data;if(LY(h)){let y=h;y.resolving&&P9(A9(m[a]));let w=ix(y.canSeeViewProviders);y.resolving=!0;let C,D=y.injectImpl?Js(y.injectImpl):null,z=uz(i,c,vi.Default);try{h=i[a]=y.factory(void 0,m,i,c),r.firstCreatePass&&a>=c.directiveStart&&OY(a,m[a],r)}finally{D!==null&&Js(D),ix(w),y.resolving=!1,pz()}}return h}function $Y(i){if(typeof i=="string")return i.charCodeAt(0)||0;let r=i.hasOwnProperty(Pg)?i[Pg]:void 0;return typeof r=="number"?r>=0?r&xz:HY:r}function e3(i,r,a){let c=1<<i;return!!(a[r+(i>>bz)]&c)}function t3(i,r){return!(i&vi.Self)&&!(i&vi.Host&&r)}var Th=class{constructor(r,a){this._tNode=r,this._lView=a}get(r,a,c){return Mz(this._tNode,this._lView,r,Ex(c),a)}};function HY(){return new Th(ia(),hi())}function _o(i){return Xg(()=>{let r=i.prototype.constructor,a=r[J0]||cI(r),c=Object.prototype,h=Object.getPrototypeOf(i.prototype).constructor;for(;h&&h!==c;){let m=h[J0]||cI(h);if(m&&m!==a)return m;h=Object.getPrototypeOf(h)}return m=>new m})}function cI(i){return O3(i)?()=>{let r=cI(Os(i));return r&&r()}:Ch(i)}function GY(i,r,a,c,h){let m=i,y=r;for(;m!==null&&y!==null&&y[Bn]&2048&&!(y[Bn]&512);){let w=Iz(m,y,a,c|vi.Self,dc);if(w!==dc)return w;let C=m.parent;if(!C){let D=y[X3];if(D){let z=D.get(a,dc,c);if(z!==dc)return z}C=Cz(y),y=y[kp]}m=C}return h}function Cz(i){let r=i[Yn],a=r.type;return a===2?r.declTNode:a===1?i[Ta]:null}function _C(i){return VY(ia(),i)}var N0="__parameters__";function WY(i){return function(...a){if(i){let c=i(...a);for(let h in c)this[h]=c[h]}}}function yC(i,r,a){return Xg(()=>{let c=WY(r);function h(...m){if(this instanceof h)return c.apply(this,m),this;let y=new h(...m);return w.annotation=y,w;function w(C,D,z){let j=C.hasOwnProperty(N0)?C[N0]:Object.defineProperty(C,N0,{value:[]})[N0];for(;j.length<=z;)j.push(null);return(j[z]=j[z]||[]).push(y),C}}return a&&(h.prototype=Object.create(a.prototype)),h.prototype.ngMetadataName=i,h.annotationCls=h,h})}function qY(i){return typeof i=="function"}function ZY(i,r,a){if(i.length!==r.length)return!1;for(let c=0;c<i.length;c++){let h=i[c],m=r[c];if(a&&(h=a(h),m=a(m)),m!==h)return!1}return!0}function YY(i){return i.flat(Number.POSITIVE_INFINITY)}function vC(i,r){i.forEach(a=>Array.isArray(a)?vC(a,r):r(a))}function Sz(i,r,a){r>=i.length?i.push(a):i.splice(r,0,a)}function ox(i,r){return r>=i.length-1?i.pop():i.splice(r,1)[0]}function XY(i,r){let a=[];for(let c=0;c<i;c++)a.push(r);return a}function KY(i,r,a,c){let h=i.length;if(h==r)i.push(a,c);else if(h===1)i.push(c,i[0]),i[0]=a;else{for(h--,i.push(i[h-1],i[h]);h>r;){let m=h-2;i[h]=i[m],h--}i[r]=a,i[r+1]=c}}function JY(i,r,a){let c=e_(i,r);return c>=0?i[c|1]=a:(c=~c,KY(i,c,r,a)),c}function zM(i,r){let a=e_(i,r);if(a>=0)return i[a|1]}function e_(i,r){return QY(i,r,1)}function QY(i,r,a){let c=0,h=i.length>>a;for(;h!==c;){let m=c+(h-c>>1),y=i[m<<a];if(r===y)return m<<a;y>r?h=m:c=m+1}return~(h<<a)}var cu=rC(yC("Optional"),8),Dz=rC(yC("Self"),2),Bp=rC(yC("SkipSelf"),4);var Ph=new ot(""),Nh=new ot("",-1),Az=new ot(""),sx=class{get(r,a=Lg){if(a===Lg){let c=new Error(`NullInjectorError: No provider for ${Rs(r)}!`);throw c.name="NullInjectorError",c}return a}};function hd(i){return{\u0275providers:i}}function xC(...i){return{\u0275providers:Pz(!0,i),\u0275fromNgModule:!0}}function Pz(i,...r){let a=[],c=new Set,h,m=y=>{a.push(y)};return vC(r,y=>{let w=y;uI(w,m,[],c)&&(h||=[],h.push(w))}),h!==void 0&&Oz(h,m),a}function Oz(i,r){for(let a=0;a<i.length;a++){let{ngModule:c,providers:h}=i[a];bC(h,m=>{r(m,c)})}}function uI(i,r,a,c){if(i=Os(i),!i)return!1;let h=null,m=HN(i),y=!m&&Mh(i);if(!m&&!y){let C=i.ngModule;if(m=HN(C),m)h=C;else return!1}else{if(y&&!y.standalone)return!1;h=i}let w=c.has(h);if(y){if(w)return!1;if(c.add(h),y.dependencies){let C=typeof y.dependencies=="function"?y.dependencies():y.dependencies;for(let D of C)uI(D,r,a,c)}}else if(m){if(m.imports!=null&&!w){c.add(h);let D;try{vC(m.imports,z=>{uI(z,r,a,c)&&(D||=[],D.push(z))})}finally{}D!==void 0&&Oz(D,r)}if(!w){let D=Ch(h)||(()=>new h);r({provide:h,useFactory:D,deps:ba},h),r({provide:Az,useValue:h,multi:!0},h),r({provide:Ph,useValue:()=>Ct(h),multi:!0},h)}let C=m.providers;if(C!=null&&!w){let D=i;bC(C,z=>{r(z,D)})}}else return!1;return h!==i&&i.providers!==void 0}function bC(i,r){for(let a of i)R3(a)&&(a=a.\u0275providers),Array.isArray(a)?bC(a,r):r(a)}var eX=Fr({provide:String,useValue:Fr});function Rz(i){return i!==null&&typeof i=="object"&&eX in i}function tX(i){return!!(i&&i.useExisting)}function nX(i){return!!(i&&i.useFactory)}function Lp(i){return typeof i=="function"}function iX(i){return!!i.useClass}var Ax=new ot(""),Y0={},rX={},BM;function wC(){return BM===void 0&&(BM=new sx),BM}var ta=class{},Vg=class extends ta{get destroyed(){return this._destroyed}constructor(r,a,c,h){super(),this.parent=a,this.source=c,this.scopes=h,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,hI(r,y=>this.processProvider(y)),this.records.set(Nh,Cp(void 0,this)),h.has("environment")&&this.records.set(ta,Cp(void 0,this));let m=this.records.get(Ax);m!=null&&typeof m.value=="string"&&this.scopes.add(m.value),this.injectorDefTypes=new Set(this.get(Az,ba,vi.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(let a of this._ngOnDestroyHooks)a.ngOnDestroy();let r=this._onDestroyHooks;this._onDestroyHooks=[];for(let a of r)a()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(r){return this.assertNotDestroyed(),this._onDestroyHooks.push(r),()=>this.removeOnDestroy(r)}runInContext(r){this.assertNotDestroyed();let a=ad(this),c=Js(void 0),h;try{return r()}finally{ad(a),Js(c)}}get(r,a=Lg,c=vi.Default){if(this.assertNotDestroyed(),r.hasOwnProperty(UN))return r[UN](this);c=Ex(c);let h,m=ad(this),y=Js(void 0);try{if(!(c&vi.SkipSelf)){let C=this.records.get(r);if(C===void 0){let D=cX(r)&&Tx(r);D&&this.injectableDefInScope(D)?C=Cp(dI(r),Y0):C=null,this.records.set(r,C)}if(C!=null)return this.hydrate(r,C)}let w=c&vi.Self?wC():this.parent;return a=c&vi.Optional&&a===Lg?null:a,w.get(r,a)}catch(w){if(w.name==="NullInjectorError"){if((w[Q0]=w[Q0]||[]).unshift(Rs(r)),m)throw w;return V9(w,r,"R3InjectorError",this.source)}else throw w}finally{Js(y),ad(m)}}resolveInjectorInitializers(){let r=ad(this),a=Js(void 0),c;try{let h=this.get(Ph,ba,vi.Self);for(let m of h)m()}finally{ad(r),Js(a)}}toString(){let r=[],a=this.records;for(let c of a.keys())r.push(Rs(c));return`R3Injector[${r.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new mt(205,!1)}processProvider(r){r=Os(r);let a=Lp(r)?r:Os(r&&r.provide),c=sX(r);if(!Lp(r)&&r.multi===!0){let h=this.records.get(a);h||(h=Cp(void 0,Y0,!0),h.factory=()=>nI(h.multi),this.records.set(a,h)),a=r,h.multi.push(r)}this.records.set(a,c)}hydrate(r,a){return a.value===Y0&&(a.value=rX,a.value=a.factory()),typeof a.value=="object"&&a.value&&lX(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(r){if(!r.providedIn)return!1;let a=Os(r.providedIn);return typeof a=="string"?a==="any"||this.scopes.has(a):this.injectorDefTypes.has(a)}removeOnDestroy(r){let a=this._onDestroyHooks.indexOf(r);a!==-1&&this._onDestroyHooks.splice(a,1)}};function dI(i){let r=Tx(i),a=r!==null?r.factory:Ch(i);if(a!==null)return a;if(i instanceof ot)throw new mt(204,!1);if(i instanceof Function)return oX(i);throw new mt(204,!1)}function oX(i){if(i.length>0)throw new mt(204,!1);let a=O9(i);return a!==null?()=>a.factory(i):()=>new i}function sX(i){if(Rz(i))return Cp(void 0,i.useValue);{let r=Lz(i);return Cp(r,Y0)}}function Lz(i,r,a){let c;if(Lp(i)){let h=Os(i);return Ch(h)||dI(h)}else if(Rz(i))c=()=>Os(i.useValue);else if(nX(i))c=()=>i.useFactory(...nI(i.deps||[]));else if(tX(i))c=()=>Ct(Os(i.useExisting));else{let h=Os(i&&(i.useClass||i.provide));if(aX(i))c=()=>new h(...nI(i.deps));else return Ch(h)||dI(h)}return c}function Cp(i,r,a=!1){return{factory:i,value:r,multi:a?[]:void 0}}function aX(i){return!!i.deps}function lX(i){return i!==null&&typeof i=="object"&&typeof i.ngOnDestroy=="function"}function cX(i){return typeof i=="function"||typeof i=="object"&&i instanceof ot}function hI(i,r){for(let a of i)Array.isArray(a)?hI(a,r):a&&R3(a)?hI(a.\u0275providers,r):r(a)}function uu(i,r){i instanceof Vg&&i.assertNotDestroyed();let a,c=ad(i),h=Js(void 0);try{return r()}finally{ad(c),Js(h)}}function n3(i,r=null,a=null,c){let h=Fz(i,r,a,c);return h.resolveInjectorInitializers(),h}function Fz(i,r=null,a=null,c,h=new Set){let m=[a||ba,xC(i)];return c=c||(typeof i=="object"?void 0:Rs(i)),new Vg(m,r||wC(),c||null,h)}var ys=(()=>{let r=class r{static create(c,h){if(Array.isArray(c))return n3({name:""},h,c,"");{let m=c.name??"";return n3({name:m},c.parent,c.providers,m)}}};r.THROW_IF_NOT_FOUND=Lg,r.NULL=new sx,r.\u0275prov=gt({token:r,providedIn:"any",factory:()=>Ct(Nh)}),r.__NG_ELEMENT_ID__=-1;let i=r;return i})();var fI;function kz(i){fI=i}function t_(){if(fI!==void 0)return fI;if(typeof document<"u")return document;throw new mt(210,!1)}var Px=new ot("",{providedIn:"root",factory:()=>uX}),uX="ng",TC=new ot(""),vs=new ot("",{providedIn:"platform",factory:()=>"unknown"});var EC=new ot(""),MC=new ot("",{providedIn:"root",factory:()=>t_().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function Ox(i){return i.ownerDocument.defaultView}function dX(i){return i.ownerDocument.body}function Nz(i){return i instanceof Function?i():i}function z0(i){return(i??Ee(ys)).get(vs)==="browser"}var hX="ngSkipHydration",fX="ngskiphydration";function zz(i){let r=i.mergedAttrs;if(r===null)return!1;for(let a=0;a<r.length;a+=2){let c=r[a];if(typeof c=="number")return!1;if(typeof c=="string"&&c.toLowerCase()===fX)return!0}return!1}function Bz(i){return i.hasAttribute(hX)}function ax(i){return(i.flags&128)===128}function pX(i){if(ax(i))return!0;let r=i.parent;for(;r;){if(ax(i)||zz(r))return!0;r=r.parent}return!1}var ru=function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i}(ru||{}),mX=/^>|^->|<!--|-->|--!>|<!-$/g,gX=/(<|>)/g,_X="\u200B$1\u200B";function yX(i){return i.replace(mX,r=>r.replace(gX,_X))}var jz=new Map,vX=0;function xX(){return vX++}function bX(i){jz.set(i[Mx],i)}function wX(i){jz.delete(i[Mx])}var i3="__ngContext__";function ld(i,r){eu(r)?(i[i3]=r[Mx],bX(r)):i[i3]=r}var TX;function IC(i,r){return TX(i,r)}function Sp(i,r,a,c,h){if(c!=null){let m,y=!1;pc(c)?m=c:eu(c)&&(y=!0,c=c[Qs]);let w=Cl(c);i===0&&a!==null?h==null?Wz(r,a,w):lx(r,a,w,h||null,!0):i===1&&a!==null?lx(r,a,w,h||null,!0):i===2?Yz(r,w,y):i===3&&r.destroyNode(w),m!=null&&zX(r,i,m,a,h)}}function Vz(i,r){return i.createText(r)}function EX(i,r,a){i.setValue(r,a)}function Uz(i,r){return i.createComment(yX(r))}function CC(i,r,a){return i.createElement(r,a)}function MX(i,r){$z(i,r),r[Qs]=null,r[Ta]=null}function IX(i,r,a,c,h,m){c[Qs]=h,c[Ta]=r,Fx(i,c,a,1,h,m)}function $z(i,r){Fx(i,r,r[eo],2,null,null)}function CX(i){let r=i[Ng];if(!r)return jM(i[Yn],i);for(;r;){let a=null;if(eu(r))a=r[Ng];else{let c=r[ss];c&&(a=c)}if(!a){for(;r&&!r[Ml]&&r!==i;)eu(r)&&jM(r[Yn],r),r=r[Qo];r===null&&(r=i),eu(r)&&jM(r[Yn],r),a=r&&r[Ml]}r=a}}function SX(i,r,a,c){let h=ss+c,m=a.length;c>0&&(a[h-1][Ml]=r),c<m-ss?(r[Ml]=a[h],Sz(a,ss+c,r)):(a.push(r),r[Ml]=null),r[Qo]=a;let y=r[Kg];y!==null&&a!==y&&DX(y,r);let w=r[hc];w!==null&&w.insertView(i),oI(r),r[Bn]|=128}function DX(i,r){let a=i[Op],h=r[Qo][Qo][ea];r[ea]!==h&&(i[Bn]|=sC.HasTransplantedViews),a===null?i[Op]=[r]:a.push(r)}function Hz(i,r){let a=i[Op],c=a.indexOf(r);a.splice(c,1)}function Ug(i,r){if(i.length<=ss)return;let a=ss+r,c=i[a];if(c){let h=c[Kg];h!==null&&h!==i&&Hz(h,c),r>0&&(i[a-1][Ml]=c[Ml]);let m=ox(i,ss+r);MX(c[Yn],c);let y=m[hc];y!==null&&y.detachView(m[Yn]),c[Qo]=null,c[Ml]=null,c[Bn]&=-129}return c}function Rx(i,r){if(!(r[Bn]&256)){let a=r[eo];a.destroyNode&&Fx(i,r,a,3,null,null),CX(r)}}function jM(i,r){if(!(r[Bn]&256)){r[Bn]&=-129,r[Bn]|=256,r[Ih]&&dN(r[Ih]),PX(i,r),AX(i,r),r[Yn].type===1&&r[eo].destroy();let a=r[Kg];if(a!==null&&pc(r[Qo])){a!==r[Qo]&&Hz(a,r);let c=r[hc];c!==null&&c.detachView(i)}wX(r)}}function AX(i,r){let a=i.cleanup,c=r[kg];if(a!==null)for(let m=0;m<a.length-1;m+=2)if(typeof a[m]=="string"){let y=a[m+3];y>=0?c[y]():c[-y].unsubscribe(),m+=2}else{let y=c[a[m+1]];a[m].call(y)}c!==null&&(r[kg]=null);let h=r[Rg];if(h!==null){r[Rg]=null;for(let m=0;m<h.length;m++){let y=h[m];y()}}}function PX(i,r){let a;if(i!=null&&(a=i.destroyHooks)!=null)for(let c=0;c<a.length;c+=2){let h=r[a[c]];if(!(h instanceof Dh)){let m=a[c+1];if(Array.isArray(m))for(let y=0;y<m.length;y+=2){let w=h[m[y]],C=m[y+1];uc(4,w,C);try{C.call(w)}finally{uc(5,w,C)}}else{uc(4,h,m);try{m.call(h)}finally{uc(5,h,m)}}}}}function Gz(i,r,a){return OX(i,r.parent,a)}function OX(i,r,a){let c=r;for(;c!==null&&c.type&40;)r=c,c=r.parent;if(c===null)return a[Qs];{let{componentOffset:h}=c;if(h>-1){let{encapsulation:m}=i.data[c.directiveStart+h];if(m===fc.None||m===fc.Emulated)return null}return Ea(c,a)}}function lx(i,r,a,c,h){i.insertBefore(r,a,c,h)}function Wz(i,r,a){i.appendChild(r,a)}function r3(i,r,a,c,h){c!==null?lx(i,r,a,c,h):Wz(i,r,a)}function RX(i,r,a,c){i.removeChild(r,a,c)}function SC(i,r){return i.parentNode(r)}function LX(i,r){return i.nextSibling(r)}function qz(i,r,a){return kX(i,r,a)}function FX(i,r,a){return i.type&40?Ea(i,a):null}var kX=FX,o3;function Lx(i,r,a,c){let h=Gz(i,c,r),m=r[eo],y=c.parent||r[Ta],w=qz(y,c,r);if(h!=null)if(Array.isArray(a))for(let C=0;C<a.length;C++)r3(m,h,a[C],w,!1);else r3(m,h,a,w,!1);o3!==void 0&&o3(m,c,r,a,h)}function X0(i,r){if(r!==null){let a=r.type;if(a&3)return Ea(r,i);if(a&4)return pI(-1,i[r.index]);if(a&8){let c=r.child;if(c!==null)return X0(i,c);{let h=i[r.index];return pc(h)?pI(-1,h):Cl(h)}}else{if(a&32)return IC(r,i)()||Cl(i[r.index]);{let c=Zz(i,r);if(c!==null){if(Array.isArray(c))return c[0];let h=jg(i[ea]);return X0(h,c)}else return X0(i,r.next)}}}return null}function Zz(i,r){if(r!==null){let c=i[ea][Ta],h=r.projection;return c.projection[h]}return null}function pI(i,r){let a=ss+i+1;if(a<r.length){let c=r[a],h=c[Yn].firstChild;if(h!==null)return X0(c,h)}return r[nu]}function Yz(i,r,a){let c=SC(i,r);c&&RX(i,c,r,a)}function Xz(i){i.textContent=""}function DC(i,r,a,c,h,m,y){for(;a!=null;){let w=c[a.index],C=a.type;if(y&&r===0&&(w&&ld(Cl(w),c),a.flags|=2),(a.flags&32)!==32)if(C&8)DC(i,r,a.child,c,h,m,!1),Sp(r,i,h,w,m);else if(C&32){let D=IC(a,c),z;for(;z=D();)Sp(r,i,h,z,m);Sp(r,i,h,w,m)}else C&16?Kz(i,r,c,a,h,m):Sp(r,i,h,w,m);a=y?a.projectionNext:a.next}}function Fx(i,r,a,c,h,m){DC(a,c,i.firstChild,r,h,m,!1)}function NX(i,r,a){let c=r[eo],h=Gz(i,a,r),m=a.parent||r[Ta],y=qz(m,a,r);Kz(c,0,r,a,h,y)}function Kz(i,r,a,c,h,m){let y=a[ea],C=y[Ta].projection[c.projection];if(Array.isArray(C))for(let D=0;D<C.length;D++){let z=C[D];Sp(r,i,h,z,m)}else{let D=C,z=y[Qo];ax(c)&&(D.flags|=128),DC(i,r,D,z,h,m,!0)}}function zX(i,r,a,c,h){let m=a[nu],y=Cl(a);m!==y&&Sp(r,i,c,m,h);for(let w=ss;w<a.length;w++){let C=a[w];Fx(C[Yn],C,i,r,c,m)}}function BX(i,r,a,c,h){if(r)h?i.addClass(a,c):i.removeClass(a,c);else{let m=c.indexOf("-")===-1?void 0:ru.DashCase;h==null?i.removeStyle(a,c,m):(typeof h=="string"&&h.endsWith("!important")&&(h=h.slice(0,-10),m|=ru.Important),i.setStyle(a,c,h,m))}}function jX(i,r,a){i.setAttribute(r,"style",a)}function Jz(i,r,a){a===""?i.removeAttribute(r,"class"):i.setAttribute(r,"class",a)}function Qz(i,r,a){let{mergedAttrs:c,classes:h,styles:m}=a;c!==null&&iI(i,r,c),h!==null&&Jz(i,r,h),m!==null&&jX(i,r,m)}var B0;function VX(){if(B0===void 0&&(B0=null,xa.trustedTypes))try{B0=xa.trustedTypes.createPolicy("angular",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return B0}function kx(i){return VX()?.createHTML(i)||i}var j0;function eB(){if(j0===void 0&&(j0=null,xa.trustedTypes))try{j0=xa.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return j0}function s3(i){return eB()?.createHTML(i)||i}function a3(i){return eB()?.createScriptURL(i)||i}var ou=class{constructor(r){this.changingThisBreaksApplicationSecurity=r}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${P3})`}},mI=class extends ou{getTypeName(){return"HTML"}},gI=class extends ou{getTypeName(){return"Style"}},_I=class extends ou{getTypeName(){return"Script"}},yI=class extends ou{getTypeName(){return"URL"}},vI=class extends ou{getTypeName(){return"ResourceURL"}};function Dl(i){return i instanceof ou?i.changingThisBreaksApplicationSecurity:i}function du(i,r){let a=UX(i);if(a!=null&&a!==r){if(a==="ResourceURL"&&r==="URL")return!0;throw new Error(`Required a safe ${r}, got a ${a} (see ${P3})`)}return a===r}function UX(i){return i instanceof ou&&i.getTypeName()||null}function tB(i){return new mI(i)}function nB(i){return new gI(i)}function iB(i){return new _I(i)}function rB(i){return new yI(i)}function oB(i){return new vI(i)}function $X(i){let r=new bI(i);return HX()?new xI(r):r}var xI=class{constructor(r){this.inertDocumentHelper=r}getInertBodyElement(r){r="<body><remove></remove>"+r;try{let a=new window.DOMParser().parseFromString(kx(r),"text/html").body;return a===null?this.inertDocumentHelper.getInertBodyElement(r):(a.removeChild(a.firstChild),a)}catch{return null}}},bI=class{constructor(r){this.defaultDoc=r,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(r){let a=this.inertDocument.createElement("template");return a.innerHTML=kx(r),a}};function HX(){try{return!!new window.DOMParser().parseFromString(kx(""),"text/html")}catch{return!1}}var GX=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Nx(i){return i=String(i),i.match(GX)?i:"unsafe:"+i}function hu(i){let r={};for(let a of i.split(","))r[a]=!0;return r}function n_(...i){let r={};for(let a of i)for(let c in a)a.hasOwnProperty(c)&&(r[c]=!0);return r}var sB=hu("area,br,col,hr,img,wbr"),aB=hu("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),lB=hu("rp,rt"),WX=n_(lB,aB),qX=n_(aB,hu("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ZX=n_(lB,hu("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),l3=n_(sB,qX,ZX,WX),cB=hu("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),YX=hu("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),XX=hu("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),KX=n_(cB,YX,XX),JX=hu("script,style,template"),wI=class{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(r){let a=r.firstChild,c=!0;for(;a;){if(a.nodeType===Node.ELEMENT_NODE?c=this.startElement(a):a.nodeType===Node.TEXT_NODE?this.chars(a.nodeValue):this.sanitizedSomething=!0,c&&a.firstChild){a=a.firstChild;continue}for(;a;){a.nodeType===Node.ELEMENT_NODE&&this.endElement(a);let h=this.checkClobberedElement(a,a.nextSibling);if(h){a=h;break}a=this.checkClobberedElement(a,a.parentNode)}}return this.buf.join("")}startElement(r){let a=r.nodeName.toLowerCase();if(!l3.hasOwnProperty(a))return this.sanitizedSomething=!0,!JX.hasOwnProperty(a);this.buf.push("<"),this.buf.push(a);let c=r.attributes;for(let h=0;h<c.length;h++){let m=c.item(h),y=m.name,w=y.toLowerCase();if(!KX.hasOwnProperty(w)){this.sanitizedSomething=!0;continue}let C=m.value;cB[w]&&(C=Nx(C)),this.buf.push(" ",y,'="',c3(C),'"')}return this.buf.push(">"),!0}endElement(r){let a=r.nodeName.toLowerCase();l3.hasOwnProperty(a)&&!sB.hasOwnProperty(a)&&(this.buf.push("</"),this.buf.push(a),this.buf.push(">"))}chars(r){this.buf.push(c3(r))}checkClobberedElement(r,a){if(a&&(r.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${r.outerHTML}`);return a}},QX=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,eK=/([^\#-~ |!])/g;function c3(i){return i.replace(/&/g,"&amp;").replace(QX,function(r){let a=r.charCodeAt(0),c=r.charCodeAt(1);return"&#"+((a-55296)*1024+(c-56320)+65536)+";"}).replace(eK,function(r){return"&#"+r.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var V0;function AC(i,r){let a=null;try{V0=V0||$X(i);let c=r?String(r):"";a=V0.getInertBodyElement(c);let h=5,m=c;do{if(h===0)throw new Error("Failed to sanitize html because the input is unstable");h--,c=m,m=a.innerHTML,a=V0.getInertBodyElement(c)}while(c!==m);let w=new wI().sanitizeChildren(u3(a)||a);return kx(w)}finally{if(a){let c=u3(a)||a;for(;c.firstChild;)c.removeChild(c.firstChild)}}}function u3(i){return"content"in i&&tK(i)?i.content:null}function tK(i){return i.nodeType===Node.ELEMENT_NODE&&i.nodeName==="TEMPLATE"}var Xo=function(i){return i[i.NONE=0]="NONE",i[i.HTML=1]="HTML",i[i.STYLE=2]="STYLE",i[i.SCRIPT=3]="SCRIPT",i[i.URL=4]="URL",i[i.RESOURCE_URL=5]="RESOURCE_URL",i}(Xo||{});function fu(i){let r=PC();return r?s3(r.sanitize(Xo.HTML,i)||""):du(i,"HTML")?s3(Dl(i)):AC(t_(),Eh(i))}function jp(i){let r=PC();return r?r.sanitize(Xo.URL,i)||"":du(i,"URL")?Dl(i):Nx(Eh(i))}function nK(i){let r=PC();if(r)return a3(r.sanitize(Xo.RESOURCE_URL,i)||"");if(du(i,"ResourceURL"))return a3(Dl(i));throw new mt(904,!1)}function iK(i,r){return r==="src"&&(i==="embed"||i==="frame"||i==="iframe"||i==="media"||i==="script")||r==="href"&&(i==="base"||i==="link")?nK:jp}function uB(i,r,a){return iK(r,a)(i)}function PC(){let i=hi();return i&&i[tu].sanitizer}var $g=class{};function rK(){let i=new zh;return Ee(vs)==="browser"&&(i.store=oK(t_(),Ee(Px))),i}var zh=(()=>{let r=class r{constructor(){this.store={},this.onSerializeCallbacks={}}get(c,h){return this.store[c]!==void 0?this.store[c]:h}set(c,h){this.store[c]=h}remove(c){delete this.store[c]}hasKey(c){return this.store.hasOwnProperty(c)}get isEmpty(){return Object.keys(this.store).length===0}onSerialize(c,h){this.onSerializeCallbacks[c]=h}toJson(){for(let c in this.onSerializeCallbacks)if(this.onSerializeCallbacks.hasOwnProperty(c))try{this.store[c]=this.onSerializeCallbacks[c]()}catch(h){console.warn("Exception in onSerialize callback: ",h)}return JSON.stringify(this.store).replace(/</g,"\\u003C")}};r.\u0275prov=gt({token:r,providedIn:"root",factory:rK});let i=r;return i})();function oK(i,r){let a=i.getElementById(r+"-state");if(a?.textContent)try{return JSON.parse(a.textContent)}catch(c){console.warn("Exception while restoring TransferState for app "+r,c)}return{}}var dB="h",hB="b",TI=function(i){return i.FirstChild="f",i.NextSibling="n",i}(TI||{}),sK="e",aK="t",OC="c",fB="x",cx="r",lK="i",cK="n",uK="d",dK="__nghData__",pB=dK,VM="ngh",hK="nghm",mB=()=>null;function fK(i,r,a=!1){let c=i.getAttribute(VM);if(c==null)return null;let[h,m]=c.split("|");if(c=a?m:h,!c)return null;let y=m?`|${m}`:"",w=a?h:y,C={};if(c!==""){let z=r.get(zh,null,{optional:!0});z!==null&&(C=z.get(pB,[])[Number(c)])}let D={data:C,firstChild:i.firstChild??null};return a&&(D.firstChild=i,zx(D,0,i.nextSibling)),w?i.setAttribute(VM,w):i.removeAttribute(VM),D}function pK(){mB=fK}function RC(i,r,a=!1){return mB(i,r,a)}function mK(i){let r=i._lView;return r[Yn].type===2?null:(K3(r)&&(r=r[to]),r)}function gK(i){return i.textContent?.replace(/\s/gm,"")}function _K(i){let r=t_(),a=r.createNodeIterator(i,NodeFilter.SHOW_COMMENT,{acceptNode(m){let y=gK(m);return y==="ngetn"||y==="ngtns"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),c,h=[];for(;c=a.nextNode();)h.push(c);for(let m of h)m.textContent==="ngetn"?m.replaceWith(r.createTextNode("")):m.remove()}function zx(i,r,a){i.segmentHeads??={},i.segmentHeads[r]=a}function EI(i,r){return i.segmentHeads?.[r]??null}function yK(i,r){let a=i.data,c=a[sK]?.[r]??null;return c===null&&a[OC]?.[r]&&(c=LC(i,r)),c}function gB(i,r){return i.data[OC]?.[r]??null}function LC(i,r){let a=gB(i,r)??[],c=0;for(let h of a)c+=h[cx]*(h[fB]??1);return c}function Bx(i,r){if(typeof i.disconnectedNodes>"u"){let a=i.data[uK];i.disconnectedNodes=a?new Set(a):null}return!!i.disconnectedNodes?.has(r)}var MI=class{},ux=class{};function vK(i){let r=Error(`No component factory found for ${Rs(i)}.`);return r[xK]=i,r}var xK="ngComponent";var II=class{resolveComponentFactory(r){throw vK(r)}},pu=(()=>{let r=class r{};r.NULL=new II;let i=r;return i})();function bK(){return Vp(ia(),hi())}function Vp(i,r){return new mn(Ea(i,r))}var mn=(()=>{let r=class r{constructor(c){this.nativeElement=c}};r.__NG_ELEMENT_ID__=bK;let i=r;return i})();function wK(i){return i instanceof mn?i.nativeElement:i}var su=class{},Za=(()=>{let r=class r{constructor(){this.destroyNode=null}};r.__NG_ELEMENT_ID__=()=>TK();let i=r;return i})();function TK(){let i=hi(),r=ia(),a=cd(r.index,i);return(eu(a)?a:i)[eo]}var EK=(()=>{let r=class r{};r.\u0275prov=gt({token:r,providedIn:"root",factory:()=>null});let i=r;return i})(),UM={};function FC(i){let r=qo(null);try{return i()}finally{qo(r)}}function _B(i){return IK(i)?Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i:!1}function MK(i,r){if(Array.isArray(i))for(let a=0;a<i.length;a++)r(i[a]);else{let a=i[Symbol.iterator](),c;for(;!(c=a.next()).done;)r(c.value)}}function IK(i){return i!==null&&(typeof i=="function"||typeof i=="object")}var CI=class{constructor(){}supports(r){return _B(r)}create(r){return new SI(r)}},CK=(i,r)=>r,SI=class{constructor(r){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=r||CK}forEachItem(r){let a;for(a=this._itHead;a!==null;a=a._next)r(a)}forEachOperation(r){let a=this._itHead,c=this._removalsHead,h=0,m=null;for(;a||c;){let y=!c||a&&a.currentIndex<d3(c,h,m)?a:c,w=d3(y,h,m),C=y.currentIndex;if(y===c)h--,c=c._nextRemoved;else if(a=a._next,y.previousIndex==null)h++;else{m||(m=[]);let D=w-h,z=C-h;if(D!=z){for(let ie=0;ie<D;ie++){let oe=ie<m.length?m[ie]:m[ie]=0,he=oe+ie;z<=he&&he<D&&(m[ie]=oe+1)}let j=y.previousIndex;m[j]=z-D}}w!==C&&r(y,w,C)}}forEachPreviousItem(r){let a;for(a=this._previousItHead;a!==null;a=a._nextPrevious)r(a)}forEachAddedItem(r){let a;for(a=this._additionsHead;a!==null;a=a._nextAdded)r(a)}forEachMovedItem(r){let a;for(a=this._movesHead;a!==null;a=a._nextMoved)r(a)}forEachRemovedItem(r){let a;for(a=this._removalsHead;a!==null;a=a._nextRemoved)r(a)}forEachIdentityChange(r){let a;for(a=this._identityChangesHead;a!==null;a=a._nextIdentityChange)r(a)}diff(r){if(r==null&&(r=[]),!_B(r))throw new mt(900,!1);return this.check(r)?this:null}onDestroy(){}check(r){this._reset();let a=this._itHead,c=!1,h,m,y;if(Array.isArray(r)){this.length=r.length;for(let w=0;w<this.length;w++)m=r[w],y=this._trackByFn(w,m),a===null||!Object.is(a.trackById,y)?(a=this._mismatch(a,m,y,w),c=!0):(c&&(a=this._verifyReinsertion(a,m,y,w)),Object.is(a.item,m)||this._addIdentityChange(a,m)),a=a._next}else h=0,MK(r,w=>{y=this._trackByFn(h,w),a===null||!Object.is(a.trackById,y)?(a=this._mismatch(a,w,y,h),c=!0):(c&&(a=this._verifyReinsertion(a,w,y,h)),Object.is(a.item,w)||this._addIdentityChange(a,w)),a=a._next,h++}),this.length=h;return this._truncate(a),this.collection=r,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let r;for(r=this._previousItHead=this._itHead;r!==null;r=r._next)r._nextPrevious=r._next;for(r=this._additionsHead;r!==null;r=r._nextAdded)r.previousIndex=r.currentIndex;for(this._additionsHead=this._additionsTail=null,r=this._movesHead;r!==null;r=r._nextMoved)r.previousIndex=r.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(r,a,c,h){let m;return r===null?m=this._itTail:(m=r._prev,this._remove(r)),r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null),r!==null?(Object.is(r.item,a)||this._addIdentityChange(r,a),this._reinsertAfter(r,m,h)):(r=this._linkedRecords===null?null:this._linkedRecords.get(c,h),r!==null?(Object.is(r.item,a)||this._addIdentityChange(r,a),this._moveAfter(r,m,h)):r=this._addAfter(new DI(a,c),m,h)),r}_verifyReinsertion(r,a,c,h){let m=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null);return m!==null?r=this._reinsertAfter(m,r._prev,h):r.currentIndex!=h&&(r.currentIndex=h,this._addToMoves(r,h)),r}_truncate(r){for(;r!==null;){let a=r._next;this._addToRemovals(this._unlink(r)),r=a}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(r,a,c){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(r);let h=r._prevRemoved,m=r._nextRemoved;return h===null?this._removalsHead=m:h._nextRemoved=m,m===null?this._removalsTail=h:m._prevRemoved=h,this._insertAfter(r,a,c),this._addToMoves(r,c),r}_moveAfter(r,a,c){return this._unlink(r),this._insertAfter(r,a,c),this._addToMoves(r,c),r}_addAfter(r,a,c){return this._insertAfter(r,a,c),this._additionsTail===null?this._additionsTail=this._additionsHead=r:this._additionsTail=this._additionsTail._nextAdded=r,r}_insertAfter(r,a,c){let h=a===null?this._itHead:a._next;return r._next=h,r._prev=a,h===null?this._itTail=r:h._prev=r,a===null?this._itHead=r:a._next=r,this._linkedRecords===null&&(this._linkedRecords=new dx),this._linkedRecords.put(r),r.currentIndex=c,r}_remove(r){return this._addToRemovals(this._unlink(r))}_unlink(r){this._linkedRecords!==null&&this._linkedRecords.remove(r);let a=r._prev,c=r._next;return a===null?this._itHead=c:a._next=c,c===null?this._itTail=a:c._prev=a,r}_addToMoves(r,a){return r.previousIndex===a||(this._movesTail===null?this._movesTail=this._movesHead=r:this._movesTail=this._movesTail._nextMoved=r),r}_addToRemovals(r){return this._unlinkedRecords===null&&(this._unlinkedRecords=new dx),this._unlinkedRecords.put(r),r.currentIndex=null,r._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=r,r._prevRemoved=null):(r._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=r),r}_addIdentityChange(r,a){return r.item=a,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=r:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=r,r}},DI=class{constructor(r,a){this.item=r,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},AI=class{constructor(){this._head=null,this._tail=null}add(r){this._head===null?(this._head=this._tail=r,r._nextDup=null,r._prevDup=null):(this._tail._nextDup=r,r._prevDup=this._tail,r._nextDup=null,this._tail=r)}get(r,a){let c;for(c=this._head;c!==null;c=c._nextDup)if((a===null||a<=c.currentIndex)&&Object.is(c.trackById,r))return c;return null}remove(r){let a=r._prevDup,c=r._nextDup;return a===null?this._head=c:a._nextDup=c,c===null?this._tail=a:c._prevDup=a,this._head===null}},dx=class{constructor(){this.map=new Map}put(r){let a=r.trackById,c=this.map.get(a);c||(c=new AI,this.map.set(a,c)),c.add(r)}get(r,a){let c=r,h=this.map.get(c);return h?h.get(r,a):null}remove(r){let a=r.trackById;return this.map.get(a).remove(r)&&this.map.delete(a),r}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function d3(i,r,a){let c=i.previousIndex;if(c===null)return c;let h=0;return a&&c<a.length&&(h=a[c]),c+r+h}function h3(){return new kC([new CI])}var kC=(()=>{let r=class r{constructor(c){this.factories=c}static create(c,h){if(h!=null){let m=h.factories.slice();c=c.concat(m)}return new r(c)}static extend(c){return{provide:r,useFactory:h=>r.create(c,h||h3()),deps:[[r,new Bp,new cu]]}}find(c){let h=this.factories.find(m=>m.supports(c));if(h!=null)return h;throw new mt(901,!1)}};r.\u0275prov=gt({token:r,providedIn:"root",factory:h3});let i=r;return i})();function hx(i,r,a,c,h=!1){for(;a!==null;){let m=r[a.index];m!==null&&c.push(Cl(m)),pc(m)&&SK(m,c);let y=a.type;if(y&8)hx(i,r,a.child,c);else if(y&32){let w=IC(a,r),C;for(;C=w();)c.push(C)}else if(y&16){let w=Zz(r,a);if(Array.isArray(w))c.push(...w);else{let C=jg(r[ea]);hx(C[Yn],C,w,c,!0)}}a=h?a.projectionNext:a.next}return c}function SK(i,r){for(let a=ss;a<i.length;a++){let c=i[a],h=c[Yn].firstChild;h!==null&&hx(c[Yn],c,h,r)}i[nu]!==i[Qs]&&r.push(i[nu])}var yB=[];function DK(i){return i[Ih]??AK(i)}function AK(i){let r=yB.pop()??Object.create(OK);return r.lView=i,r}function PK(i){i.lView[Ih]!==i&&(i.lView=null,yB.push(i))}var OK=Er(Lt({},lN),{consumerIsAlwaysLive:!0,consumerMarkedDirty:i=>{Bg(i.lView)},consumerOnSignalRead(){this.lView[Ih]=this}});function vB(i){return bB(i[Ng])}function xB(i){return bB(i[Ml])}function bB(i){for(;i!==null&&!pc(i);)i=i[Ml];return i}var RK="ngOriginalError";function $M(i){return i[RK]}var au=class{constructor(){this._console=console}handleError(r){let a=this._findOriginalError(r);this._console.error("ERROR",r),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(r){let a=r&&$M(r);for(;a&&$M(a);)a=$M(a);return a||null}},wB=new ot("",{providedIn:"root",factory:()=>Ee(au).handleError.bind(void 0)}),U0=new ot(""),TB=!1,EB=new ot("",{providedIn:"root",factory:()=>TB});var mu={};function qe(i=1){MB(Yo(),hi(),ud()+i,!1)}function MB(i,r,a,c){if(!c)if((r[Bn]&3)===3){let m=i.preOrderCheckHooks;m!==null&&W0(r,m,a)}else{let m=i.preOrderHooks;m!==null&&q0(r,m,0,a)}Sh(a)}function me(i,r=vi.Default){let a=hi();if(a===null)return Ct(i,r);let c=ia();return Mz(c,a,Os(i),r)}function NC(){let i="invalid";throw new Error(i)}function IB(i,r,a,c,h,m){let y=qo(null);try{let w=null;h&Bi.SignalBased&&(w=r[c][aN]),w!==null&&w.transformFn!==void 0&&(m=w.transformFn(m)),h&Bi.HasDecoratorInputTransform&&(m=i.inputTransforms[c].call(r,m)),i.setInput!==null?i.setInput(r,w,m,a,c):J3(r,w,c,m)}finally{qo(y)}}function LK(i,r){let a=i.hostBindingOpCodes;if(a!==null)try{for(let c=0;c<a.length;c++){let h=a[c];if(h<0)Sh(~h);else{let m=h,y=a[++c],w=a[++c];CY(y,m);let C=r[m];w(2,C)}}}finally{Sh(-1)}}function jx(i,r,a,c,h,m,y,w,C,D,z){let j=r.blueprint.slice();return j[Qs]=h,j[Bn]=c|4|128|8|64,(D!==null||i&&i[Bn]&2048)&&(j[Bn]|=2048),rz(j),j[Qo]=j[kp]=i,j[_s]=a,j[tu]=y||i&&i[tu],j[eo]=w||i&&i[eo],j[Pp]=C||i&&i[Pp]||null,j[Ta]=m,j[Mx]=xX(),j[Il]=z,j[X3]=D,j[ea]=r.type==2?i[ea]:j,j}function Up(i,r,a,c,h){let m=i.data[r];if(m===null)m=FK(i,r,a,c,h),IY()&&(m.flags|=32);else if(m.type&64){m.type=a,m.value=c,m.attrs=h;let y=wY();m.injectorIndex=y===null?-1:y.injectorIndex}return Fh(m,!0),m}function FK(i,r,a,c,h){let m=sz(),y=dC(),w=y?m:m&&m.parent,C=i.data[r]=UK(i,w,a,r,c,h);return i.firstChild===null&&(i.firstChild=C),m!==null&&(y?m.child==null&&C.parent!==null&&(m.child=C):m.next===null&&(m.next=C,C.prev=m)),C}function CB(i,r,a,c){if(a===0)return-1;let h=r.length;for(let m=0;m<a;m++)r.push(c),i.blueprint.push(c),i.data.push(null);return h}function SB(i,r,a,c,h){let m=ud(),y=c&2;try{Sh(-1),y&&r.length>to&&MB(i,r,to,!1),uc(y?2:0,h),a(c,h)}finally{Sh(m),uc(y?3:1,h)}}function zC(i,r,a){if(aC(r)){let c=qo(null);try{let h=r.directiveStart,m=r.directiveEnd;for(let y=h;y<m;y++){let w=i.data[y];w.contentQueries&&w.contentQueries(1,a[y],y)}}finally{qo(c)}}}function BC(i,r,a){oz()&&(ZK(i,r,a,Ea(a,r)),(a.flags&64)===64&&OB(i,r,a))}function jC(i,r,a=Ea){let c=r.localNames;if(c!==null){let h=r.index+1;for(let m=0;m<c.length;m+=2){let y=c[m+1],w=y===-1?a(r,i):i[y];i[h++]=w}}}function DB(i){let r=i.tView;return r===null||r.incompleteFirstPass?i.tView=VC(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):r}function VC(i,r,a,c,h,m,y,w,C,D,z){let j=to+c,ie=j+h,oe=kK(j,ie),he=typeof D=="function"?D():D;return oe[Yn]={type:i,blueprint:oe,template:a,queries:null,viewQuery:w,declTNode:r,data:oe.slice().fill(null,j),bindingStartIndex:j,expandoStartIndex:ie,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof m=="function"?m():m,pipeRegistry:typeof y=="function"?y():y,firstChild:null,schemas:C,consts:he,incompleteFirstPass:!1,ssrId:z}}function kK(i,r){let a=[];for(let c=0;c<r;c++)a.push(c<i?null:mu);return a}function NK(i,r,a,c){let m=c.get(EB,TB)||a===fc.ShadowDom,y=i.selectRootElement(r,m);return zK(y),y}function zK(i){AB(i)}var AB=()=>null;function BK(i){Bz(i)?Xz(i):_K(i)}function jK(){AB=BK}function VK(i,r,a,c){let h=FB(r);h.push(a),i.firstCreatePass&&kB(i).push(c,h.length-1)}function UK(i,r,a,c,h,m){let y=r?r.injectorIndex:-1,w=0;return Np()&&(w|=128),{type:a,index:c,insertBeforeIndex:null,injectorIndex:y,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:w,providerIndexes:0,value:h,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:r,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function f3(i,r,a,c,h){for(let m in r){if(!r.hasOwnProperty(m))continue;let y=r[m];if(y===void 0)continue;c??={};let w,C=Bi.None;Array.isArray(y)?(w=y[0],C=y[1]):w=y;let D=m;if(h!==null){if(!h.hasOwnProperty(m))continue;D=h[m]}i===0?p3(c,a,D,w,C):p3(c,a,D,w)}return c}function p3(i,r,a,c,h){let m;i.hasOwnProperty(a)?(m=i[a]).push(r,c):m=i[a]=[r,c],h!==void 0&&m.push(h)}function $K(i,r,a){let c=r.directiveStart,h=r.directiveEnd,m=i.data,y=r.attrs,w=[],C=null,D=null;for(let z=c;z<h;z++){let j=m[z],ie=a?a.get(j):null,oe=ie?ie.inputs:null,he=ie?ie.outputs:null;C=f3(0,j.inputs,z,C,oe),D=f3(1,j.outputs,z,D,he);let ke=C!==null&&y!==null&&!U3(r)?oJ(C,z,y):null;w.push(ke)}C!==null&&(C.hasOwnProperty("class")&&(r.flags|=8),C.hasOwnProperty("style")&&(r.flags|=16)),r.initialInputs=w,r.inputs=C,r.outputs=D}function HK(i){return i==="class"?"className":i==="for"?"htmlFor":i==="formaction"?"formAction":i==="innerHtml"?"innerHTML":i==="readonly"?"readOnly":i==="tabindex"?"tabIndex":i}function UC(i,r,a,c,h,m,y,w){let C=Ea(r,a),D=r.inputs,z;!w&&D!=null&&(z=D[c])?(HC(i,a,z,c,h),Jg(r)&&GK(a,r.index)):r.type&3?(c=HK(c),h=y!=null?y(h,r.value||"",c):h,m.setProperty(C,c,h)):r.type&12}function GK(i,r){let a=cd(r,i);a[Bn]&16||(a[Bn]|=64)}function $C(i,r,a,c){if(oz()){let h=c===null?null:{"":-1},m=XK(i,a),y,w;m===null?y=w=null:[y,w]=m,y!==null&&PB(i,r,a,y,h,w),h&&KK(a,c,h)}a.mergedAttrs=Fg(a.mergedAttrs,a.attrs)}function PB(i,r,a,c,h,m){for(let D=0;D<c.length;D++)lI(rx(a,r),i,c[D].type);QK(a,i.data.length,c.length);for(let D=0;D<c.length;D++){let z=c[D];z.providersResolver&&z.providersResolver(z)}let y=!1,w=!1,C=CB(i,r,c.length,null);for(let D=0;D<c.length;D++){let z=c[D];a.mergedAttrs=Fg(a.mergedAttrs,z.hostAttrs),eJ(i,a,r,C,z),JK(C,z,h),z.contentQueries!==null&&(a.flags|=4),(z.hostBindings!==null||z.hostAttrs!==null||z.hostVars!==0)&&(a.flags|=64);let j=z.type.prototype;!y&&(j.ngOnChanges||j.ngOnInit||j.ngDoCheck)&&((i.preOrderHooks??=[]).push(a.index),y=!0),!w&&(j.ngOnChanges||j.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(a.index),w=!0),C++}$K(i,a,m)}function WK(i,r,a,c,h){let m=h.hostBindings;if(m){let y=i.hostBindingOpCodes;y===null&&(y=i.hostBindingOpCodes=[]);let w=~r.index;qK(y)!=w&&y.push(w),y.push(a,c,m)}}function qK(i){let r=i.length;for(;r>0;){let a=i[--r];if(typeof a=="number"&&a<0)return a}return 0}function ZK(i,r,a,c){let h=a.directiveStart,m=a.directiveEnd;Jg(a)&&tJ(r,a,i.data[h+a.componentOffset]),i.firstCreatePass||rx(a,r),ld(c,r);let y=a.initialInputs;for(let w=h;w<m;w++){let C=i.data[w],D=Ah(r,i,w,a);if(ld(D,r),y!==null&&rJ(r,w-h,D,C,a,y),iu(C)){let z=cd(a.index,r);z[_s]=Ah(r,i,w,a)}}}function OB(i,r,a){let c=a.directiveStart,h=a.directiveEnd,m=a.index,y=SY();try{Sh(m);for(let w=c;w<h;w++){let C=i.data[w],D=r[w];sI(w),(C.hostBindings!==null||C.hostVars!==0||C.hostAttrs!==null)&&YK(C,D)}}finally{Sh(-1),sI(y)}}function YK(i,r){i.hostBindings!==null&&i.hostBindings(1,r)}function XK(i,r){let a=i.directiveRegistry,c=null,h=null;if(a)for(let m=0;m<a.length;m++){let y=a[m];if($3(r,y.selectors,!1))if(c||(c=[]),iu(y))if(y.findHostDirectiveDefs!==null){let w=[];h=h||new Map,y.findHostDirectiveDefs(y,w,h),c.unshift(...w,y);let C=w.length;PI(i,r,C)}else c.unshift(y),PI(i,r,0);else h=h||new Map,y.findHostDirectiveDefs?.(y,c,h),c.push(y)}return c===null?null:[c,h]}function PI(i,r,a){r.componentOffset=a,(i.components??=[]).push(r.index)}function KK(i,r,a){if(r){let c=i.localNames=[];for(let h=0;h<r.length;h+=2){let m=a[r[h+1]];if(m==null)throw new mt(-301,!1);c.push(r[h],m)}}}function JK(i,r,a){if(a){if(r.exportAs)for(let c=0;c<r.exportAs.length;c++)a[r.exportAs[c]]=i;iu(r)&&(a[""]=i)}}function QK(i,r,a){i.flags|=1,i.directiveStart=r,i.directiveEnd=r+a,i.providerIndexes=r}function eJ(i,r,a,c,h){i.data[c]=h;let m=h.factory||(h.factory=Ch(h.type,!0)),y=new Dh(m,iu(h),me);i.blueprint[c]=y,a[c]=y,WK(i,r,c,CB(i,a,h.hostVars,mu),h)}function tJ(i,r,a){let c=Ea(r,i),h=DB(a),m=i[tu].rendererFactory,y=16;a.signals?y=4096:a.onPush&&(y=64);let w=Vx(i,jx(i,h,null,y,c,r,null,m.createRenderer(c,a),null,null,null));i[r.index]=w}function nJ(i,r,a,c,h,m){let y=Ea(i,r);iJ(r[eo],y,m,i.value,a,c,h)}function iJ(i,r,a,c,h,m,y){if(m==null)i.removeAttribute(r,h,a);else{let w=y==null?Eh(m):y(m,c||"",h);i.setAttribute(r,h,w,a)}}function rJ(i,r,a,c,h,m){let y=m[r];if(y!==null)for(let w=0;w<y.length;){let C=y[w++],D=y[w++],z=y[w++],j=y[w++];IB(c,a,C,D,z,j)}}function oJ(i,r,a){let c=null,h=0;for(;h<a.length;){let m=a[h];if(m===0){h+=4;continue}else if(m===5){h+=2;continue}if(typeof m=="number")break;if(i.hasOwnProperty(m)){c===null&&(c=[]);let y=i[m];for(let w=0;w<y.length;w+=3)if(y[w]===r){c.push(m,y[w+1],y[w+2],a[h+1]);break}}h+=2}return c}function RB(i,r,a,c){return[i,!0,0,r,null,c,null,a,null,null]}function LB(i,r){let a=i.contentQueries;if(a!==null){let c=qo(null);try{for(let h=0;h<a.length;h+=2){let m=a[h],y=a[h+1];if(y!==-1){let w=i.data[y];fC(m),w.contentQueries(2,r[y],y)}}}finally{qo(c)}}}function Vx(i,r){return i[Ng]?i[KN][Ml]=r:i[Ng]=r,i[KN]=r,r}function OI(i,r,a){fC(0);let c=qo(null);try{r(i,a)}finally{qo(c)}}function FB(i){return i[kg]||(i[kg]=[])}function kB(i){return i.cleanup||(i.cleanup=[])}function sJ(i,r,a){return(i===null||iu(i))&&(a=uY(a[r.index])),a[eo]}function NB(i,r){let a=i[Pp],c=a?a.get(au,null):null;c&&c.handleError(r)}function HC(i,r,a,c,h){for(let m=0;m<a.length;){let y=a[m++],w=a[m++],C=a[m++],D=r[y],z=i.data[y];IB(z,D,c,w,C,h)}}function zB(i,r,a){let c=iz(r,i);EX(i[eo],c,a)}var BB=100;function jB(i,r=!0,a=0){let c=i[tu],h=c.rendererFactory,m=!1;m||h.begin?.();try{aJ(i,a)}catch(y){throw r&&NB(i,y),y}finally{m||(h.end?.(),c.inlineEffectRunner?.flush())}}function aJ(i,r){RI(i,r);let a=0;for(;uC(i);){if(a===BB)throw new mt(103,!1);a++,RI(i,1)}}function lJ(i,r,a,c){let h=r[Bn];if((h&256)===256)return;let m=!1;!m&&r[tu].inlineEffectRunner?.flush(),pC(r);let y=null,w=null;!m&&cJ(i)&&(w=DK(r),y=cN(w));try{rz(r),MY(i.bindingStartIndex),a!==null&&SB(i,r,a,2,c);let C=(h&3)===3;if(!m)if(C){let j=i.preOrderCheckHooks;j!==null&&W0(r,j,null)}else{let j=i.preOrderHooks;j!==null&&q0(r,j,0,null),kM(r,0)}if(uJ(r),VB(r,0),i.contentQueries!==null&&LB(i,r),!m)if(C){let j=i.contentCheckHooks;j!==null&&W0(r,j)}else{let j=i.contentHooks;j!==null&&q0(r,j,1),kM(r,1)}LK(i,r);let D=i.components;D!==null&&$B(r,D,0);let z=i.viewQuery;if(z!==null&&OI(2,z,c),!m)if(C){let j=i.viewCheckHooks;j!==null&&W0(r,j)}else{let j=i.viewHooks;j!==null&&q0(r,j,2),kM(r,2)}if(i.firstUpdatePass===!0&&(i.firstUpdatePass=!1),r[FM]){for(let j of r[FM])j();r[FM]=null}m||(r[Bn]&=-73)}catch(C){throw Bg(r),C}finally{w!==null&&(uN(w,y),PK(w)),mC()}}function cJ(i){return i.type!==2}function VB(i,r){for(let a=vB(i);a!==null;a=xB(a))for(let c=ss;c<a.length;c++){let h=a[c];UB(h,r)}}function uJ(i){for(let r=vB(i);r!==null;r=xB(r)){if(!(r[Bn]&sC.HasTransplantedViews))continue;let a=r[Op];for(let c=0;c<a.length;c++){let h=a[c],m=h[Qo];fY(h)}}}function dJ(i,r,a){let c=cd(r,i);UB(c,a)}function UB(i,r){cC(i)&&RI(i,r)}function RI(i,r){let c=i[Yn],h=i[Bn],m=i[Ih],y=!!(r===0&&h&16);if(y||=!!(h&64&&r===0),y||=!!(h&1024),y||=!!(m?.dirty&&mM(m)),m&&(m.dirty=!1),i[Bn]&=-9217,y)lJ(c,i,c.template,i[_s]);else if(h&8192){VB(i,1);let w=c.components;w!==null&&$B(i,w,1)}}function $B(i,r,a){for(let c=0;c<r.length;c++)dJ(i,r[c],a)}function GC(i){for(i[tu].changeDetectionScheduler?.notify();i;){i[Bn]|=64;let r=jg(i);if(K3(i)&&!r)return i;i=r}return null}var Oh=class{get rootNodes(){let r=this._lView,a=r[Yn];return hx(a,r,a.firstChild,[])}constructor(r,a,c=!0){this._lView=r,this._cdRefInjectingView=a,this.notifyErrorHandler=c,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[_s]}set context(r){this._lView[_s]=r}get destroyed(){return(this._lView[Bn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let r=this._lView[Qo];if(pc(r)){let a=r[ex],c=a?a.indexOf(this):-1;c>-1&&(Ug(r,c),ox(a,c))}this._attachedToViewContainer=!1}Rx(this._lView[Yn],this._lView)}onDestroy(r){mY(this._lView,r)}markForCheck(){GC(this._cdRefInjectingView||this._lView)}detach(){this._lView[Bn]&=-129}reattach(){oI(this._lView),this._lView[Bn]|=128}detectChanges(){this._lView[Bn]|=1024,jB(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new mt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,$z(this._lView[Yn],this._lView)}attachToAppRef(r){if(this._attachedToViewContainer)throw new mt(902,!1);this._appRef=r,oI(this._lView)}},co=(()=>{let r=class r{};r.__NG_ELEMENT_ID__=hJ;let i=r;return i})();function hJ(i){return fJ(ia(),hi(),(i&16)===16)}function fJ(i,r,a){if(Jg(i)&&!a){let c=cd(i.index,r);return new Oh(c,c)}else if(i.type&47){let c=r[ea];return new Oh(c,r)}return null}var m3=new Set;function Bh(i){m3.has(i)||(m3.add(i),performance?.mark?.("mark_feature_usage",{detail:{feature:i}}))}var LI=class extends Qr{constructor(r=!1){super(),this.__isAsync=r}emit(r){super.next(r)}subscribe(r,a,c){let h=r,m=a||(()=>null),y=c;if(r&&typeof r=="object"){let C=r;h=C.next?.bind(C),m=C.error?.bind(C),y=C.complete?.bind(C)}this.__isAsync&&(m=HM(m),h&&(h=HM(h)),y&&(y=HM(y)));let w=super.subscribe({next:h,error:m,complete:y});return r instanceof Po&&r.add(w),w}};function HM(i){return r=>{setTimeout(i,void 0,r)}}var Zn=LI;function g3(...i){}function pJ(){let i=typeof xa.requestAnimationFrame=="function",r=xa[i?"requestAnimationFrame":"setTimeout"],a=xa[i?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&r&&a){let c=r[Zone.__symbol__("OriginalDelegate")];c&&(r=c);let h=a[Zone.__symbol__("OriginalDelegate")];h&&(a=h)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:a}}var oi=class i{constructor({enableLongStackTrace:r=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:c=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Zn(!1),this.onMicrotaskEmpty=new Zn(!1),this.onStable=new Zn(!1),this.onError=new Zn(!1),typeof Zone>"u")throw new mt(908,!1);Zone.assertZonePatched();let h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!c&&a,h.shouldCoalesceRunChangeDetection=c,h.lastRequestAnimationFrameId=-1,h.nativeRequestAnimationFrame=pJ().nativeRequestAnimationFrame,_J(h)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!i.isInAngularZone())throw new mt(909,!1)}static assertNotInAngularZone(){if(i.isInAngularZone())throw new mt(909,!1)}run(r,a,c){return this._inner.run(r,a,c)}runTask(r,a,c,h){let m=this._inner,y=m.scheduleEventTask("NgZoneEvent: "+h,r,mJ,g3,g3);try{return m.runTask(y,a,c)}finally{m.cancelTask(y)}}runGuarded(r,a,c){return this._inner.runGuarded(r,a,c)}runOutsideAngular(r){return this._outer.run(r)}},mJ={};function WC(i){if(i._nesting==0&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function gJ(i){i.isCheckStableRunning||i.lastRequestAnimationFrameId!==-1||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(xa,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,FI(i),i.isCheckStableRunning=!0,WC(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),FI(i))}function _J(i){let r=()=>{gJ(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,c,h,m,y,w)=>{if(yJ(w))return a.invokeTask(h,m,y,w);try{return _3(i),a.invokeTask(h,m,y,w)}finally{(i.shouldCoalesceEventChangeDetection&&m.type==="eventTask"||i.shouldCoalesceRunChangeDetection)&&r(),y3(i)}},onInvoke:(a,c,h,m,y,w,C)=>{try{return _3(i),a.invoke(h,m,y,w,C)}finally{i.shouldCoalesceRunChangeDetection&&r(),y3(i)}},onHasTask:(a,c,h,m)=>{a.hasTask(h,m),c===h&&(m.change=="microTask"?(i._hasPendingMicrotasks=m.microTask,FI(i),WC(i)):m.change=="macroTask"&&(i.hasPendingMacrotasks=m.macroTask))},onHandleError:(a,c,h,m)=>(a.handleError(h,m),i.runOutsideAngular(()=>i.onError.emit(m)),!1)})}function FI(i){i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&i.lastRequestAnimationFrameId!==-1?i.hasPendingMicrotasks=!0:i.hasPendingMicrotasks=!1}function _3(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function y3(i){i._nesting--,WC(i)}function yJ(i){return!Array.isArray(i)||i.length!==1?!1:i[0].data?.__ignore_ng_zone__===!0}var HB=(()=>{let r=class r{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){let c=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let h of c)h();this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};r.\u0275prov=gt({token:r,providedIn:"root",factory:()=>new r});let i=r;return i})();function vJ(i,r){let a=cd(r,i),c=a[Yn];xJ(c,a);let h=a[Qs];h!==null&&a[Il]===null&&(a[Il]=RC(h,a[Pp])),qC(c,a,a[_s])}function xJ(i,r){for(let a=r.length;a<i.blueprint.length;a++)r.push(i.blueprint[a])}function qC(i,r,a){pC(r);try{let c=i.viewQuery;c!==null&&OI(1,c,a);let h=i.template;h!==null&&SB(i,r,h,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&LB(i,r),i.staticViewQueries&&OI(2,i.viewQuery,a);let m=i.components;m!==null&&bJ(r,m)}catch(c){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),c}finally{r[Bn]&=-5,mC()}}function bJ(i,r){for(let a=0;a<r.length;a++)vJ(i,r[a])}function fx(i,r,a){let c=a?i.styles:null,h=a?i.classes:null,m=0;if(r!==null)for(let y=0;y<r.length;y++){let w=r[y];if(typeof w=="number")m=w;else if(m==1)h=VN(h,w);else if(m==2){let C=w,D=r[++y];c=VN(c,C+": "+D+";")}}a?i.styles=c:i.stylesWithoutHost=c,a?i.classes=h:i.classesWithoutHost=h}var px=class extends pu{constructor(r){super(),this.ngModule=r}resolveComponentFactory(r){let a=Mh(r);return new Hg(a,this.ngModule)}};function v3(i){let r=[];for(let a in i){if(!i.hasOwnProperty(a))continue;let c=i[a];c!==void 0&&r.push({propName:Array.isArray(c)?c[0]:c,templateName:a})}return r}function wJ(i){let r=i.toLowerCase();return r==="svg"?nz:r==="math"?aY:null}var kI=class{constructor(r,a){this.injector=r,this.parentInjector=a}get(r,a,c){c=Ex(c);let h=this.injector.get(r,UM,c);return h!==UM||a===UM?h:this.parentInjector.get(r,a,c)}},Hg=class extends ux{get inputs(){let r=this.componentDef,a=r.inputTransforms,c=v3(r.inputs);if(a!==null)for(let h of c)a.hasOwnProperty(h.propName)&&(h.transform=a[h.propName]);return c}get outputs(){return v3(this.componentDef.outputs)}constructor(r,a){super(),this.componentDef=r,this.ngModule=a,this.componentType=r.type,this.selector=Q9(r.selectors),this.ngContentSelectors=r.ngContentSelectors?r.ngContentSelectors:[],this.isBoundToModule=!!a}create(r,a,c,h){h=h||this.ngModule;let m=h instanceof ta?h:h?.injector;m&&this.componentDef.getStandaloneInjector!==null&&(m=this.componentDef.getStandaloneInjector(m)||m);let y=m?new kI(r,m):r,w=y.get(su,null);if(w===null)throw new mt(407,!1);let C=y.get(EK,null),D=y.get(HB,null),z=y.get($g,null),j={rendererFactory:w,sanitizer:C,inlineEffectRunner:null,afterRenderEventManager:D,changeDetectionScheduler:z},ie=w.createRenderer(null,this.componentDef),oe=this.componentDef.selectors[0][0]||"div",he=c?NK(ie,c,this.componentDef.encapsulation,y):CC(ie,oe,wJ(oe)),ke=512;this.componentDef.signals?ke|=4096:this.componentDef.onPush||(ke|=16);let rt=null;he!==null&&(rt=RC(he,y,!0));let Ve=VC(0,null,null,1,0,null,null,null,null,null,null),Ot=jx(null,Ve,null,ke,null,null,j,ie,y,null,rt);pC(Ot);let hn,Qt;try{let Wn=this.componentDef,Kn,X=null;Wn.findHostDirectiveDefs?(Kn=[],X=new Map,Wn.findHostDirectiveDefs(Wn,Kn,X),Kn.push(Wn)):Kn=[Wn];let Rt=TJ(Ot,he),bo=EJ(Rt,he,Wn,Kn,Ot,j,ie);Qt=lC(Ve,to),he&&CJ(ie,Wn,he,c),a!==void 0&&SJ(Qt,this.ngContentSelectors,a),hn=IJ(bo,Wn,Kn,X,Ot,[DJ]),qC(Ve,Ot,null)}finally{mC()}return new NI(this.componentType,hn,Vp(Qt,Ot),Ot,Qt)}},NI=class extends MI{constructor(r,a,c,h,m){super(),this.location=c,this._rootLView=h,this._tNode=m,this.previousInputValues=null,this.instance=a,this.hostView=this.changeDetectorRef=new Oh(h,void 0,!1),this.componentType=r}setInput(r,a){let c=this._tNode.inputs,h;if(c!==null&&(h=c[r])){if(this.previousInputValues??=new Map,this.previousInputValues.has(r)&&Object.is(this.previousInputValues.get(r),a))return;let m=this._rootLView;HC(m[Yn],m,h,r,a),this.previousInputValues.set(r,a);let y=cd(this._tNode.index,m);GC(y)}}get injector(){return new Th(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(r){this.hostView.onDestroy(r)}};function TJ(i,r){let a=i[Yn],c=to;return i[c]=r,Up(a,c,2,"#host",null)}function EJ(i,r,a,c,h,m,y){let w=h[Yn];MJ(c,i,r,y);let C=null;r!==null&&(C=RC(r,h[Pp]));let D=m.rendererFactory.createRenderer(r,a),z=16;a.signals?z=4096:a.onPush&&(z=64);let j=jx(h,DB(a),null,z,h[i.index],i,m,D,null,null,C);return w.firstCreatePass&&PI(w,i,c.length-1),Vx(h,j),h[i.index]=j}function MJ(i,r,a,c){for(let h of i)r.mergedAttrs=Fg(r.mergedAttrs,h.hostAttrs);r.mergedAttrs!==null&&(fx(r,r.mergedAttrs,!0),a!==null&&Qz(c,a,r))}function IJ(i,r,a,c,h,m){let y=ia(),w=h[Yn],C=Ea(y,h);PB(w,h,y,a,null,c);for(let z=0;z<a.length;z++){let j=y.directiveStart+z,ie=Ah(h,w,j,y);ld(ie,h)}OB(w,h,y),C&&ld(C,h);let D=Ah(h,w,y.directiveStart+y.componentOffset,y);if(i[_s]=h[_s]=D,m!==null)for(let z of m)z(D,r);return zC(w,y,i),D}function CJ(i,r,a,c){if(c)iI(i,a,["ng-version","17.1.3"]);else{let{attrs:h,classes:m}=eY(r.selectors[0]);h&&iI(i,a,h),m&&m.length>0&&Jz(i,a,m.join(" "))}}function SJ(i,r,a){let c=i.projection=[];for(let h=0;h<r.length;h++){let m=a[h];c.push(m!=null?Array.from(m):null)}}function DJ(){let i=ia();Dx(hi()[Yn],i)}function AJ(i){return Object.getPrototypeOf(i.prototype).constructor}function uo(i){let r=AJ(i.type),a=!0,c=[i];for(;r;){let h;if(iu(i))h=r.\u0275cmp||r.\u0275dir;else{if(r.\u0275cmp)throw new mt(903,!1);h=r.\u0275dir}if(h){if(a){c.push(h);let y=i;y.inputs=$0(i.inputs),y.inputTransforms=$0(i.inputTransforms),y.declaredInputs=$0(i.declaredInputs),y.outputs=$0(i.outputs);let w=h.hostBindings;w&&FJ(i,w);let C=h.viewQuery,D=h.contentQueries;if(C&&RJ(i,C),D&&LJ(i,D),PJ(i,h),E9(i.outputs,h.outputs),iu(h)&&h.data.animation){let z=i.data;z.animation=(z.animation||[]).concat(h.data.animation)}}let m=h.features;if(m)for(let y=0;y<m.length;y++){let w=m[y];w&&w.ngInherit&&w(i),w===uo&&(a=!1)}}r=Object.getPrototypeOf(r)}OJ(c)}function PJ(i,r){for(let a in r.inputs){if(!r.inputs.hasOwnProperty(a)||i.inputs.hasOwnProperty(a))continue;let c=r.inputs[a];if(c!==void 0&&(i.inputs[a]=c,i.declaredInputs[a]=r.declaredInputs[a],r.inputTransforms!==null)){let h=Array.isArray(c)?c[0]:c;if(!r.inputTransforms.hasOwnProperty(h))continue;i.inputTransforms??={},i.inputTransforms[h]=r.inputTransforms[h]}}}function OJ(i){let r=0,a=null;for(let c=i.length-1;c>=0;c--){let h=i[c];h.hostVars=r+=h.hostVars,h.hostAttrs=Fg(h.hostAttrs,a=Fg(a,h.hostAttrs))}}function $0(i){return i===Ap?{}:i===ba?[]:i}function RJ(i,r){let a=i.viewQuery;a?i.viewQuery=(c,h)=>{r(c,h),a(c,h)}:i.viewQuery=r}function LJ(i,r){let a=i.contentQueries;a?i.contentQueries=(c,h,m)=>{r(c,h,m),a(c,h,m)}:i.contentQueries=r}function FJ(i,r){let a=i.hostBindings;a?i.hostBindings=(c,h)=>{r(c,h),a(c,h)}:i.hostBindings=r}function ZC(i){let r=i.inputConfig,a={};for(let c in r)if(r.hasOwnProperty(c)){let h=r[c];Array.isArray(h)&&h[3]&&(a[c]=h[3])}i.inputTransforms=a}function GB(i){let r=i[zg]??[],c=i[Qo][eo];for(let h of r)kJ(h,c);i[zg]=ba}function kJ(i,r){let a=0,c=i.firstChild;if(c){let h=i.data[cx];for(;a<h;){let m=c.nextSibling;Yz(r,c,!1),c=m,a++}}}function WB(i){GB(i);for(let r=ss;r<i.length;r++)mx(i[r])}function mx(i){let r=i[Yn];for(let a=to;a<r.bindingStartIndex;a++)if(pc(i[a])){let c=i[a];WB(c)}else eu(i[a])&&mx(i[a])}function NJ(i){let r=i._views;for(let a of r){let c=mK(a);if(c!==null&&c[Qs]!==null)if(eu(c))mx(c);else{let h=c[Qs];mx(h),WB(c)}}}var zJ=new RegExp(`^(\\d+)*(${hB}|${dB})*(.*)`);function BJ(i){let r=i.match(zJ),[a,c,h,m]=r,y=c?parseInt(c,10):h,w=[];for(let[C,D,z]of m.matchAll(/(f|n)(\d*)/g)){let j=parseInt(z,10)||1;w.push(D,j)}return[y,...w]}function jJ(i){return!i.prev&&i.parent?.type===8}function GM(i){return i.index-to}function Ux(i,r,a,c){let h=null,m=GM(c),y=i.data[cK];if(y?.[m])h=UJ(y[m],a);else if(r.firstChild===c)h=i.firstChild;else{let w=c.prev===null,C=c.prev??c.parent;if(jJ(c)){let D=GM(c.parent);h=EI(i,D)}else{let D=Ea(C,a);if(w)h=D.firstChild;else{let z=GM(C),j=EI(i,z);if(C.type===2&&j){let oe=LC(i,z)+1;h=$x(oe,j)}else h=D.nextSibling}}}return h}function $x(i,r){let a=r;for(let c=0;c<i;c++)a=a.nextSibling;return a}function VJ(i,r){let a=i;for(let c=0;c<r.length;c+=2){let h=r[c],m=r[c+1];for(let y=0;y<m;y++)switch(h){case TI.FirstChild:a=a.firstChild;break;case TI.NextSibling:a=a.nextSibling;break}}return a}function UJ(i,r){let[a,...c]=BJ(i),h;if(a===dB)h=r[ea][Qs];else if(a===hB)h=dX(r[ea][Qs]);else{let m=Number(a);h=Cl(r[m+to])}return VJ(h,c)}function $J(i,r){let a=[];for(let c of r)for(let h=0;h<(c[fB]??1);h++){let m={data:c,firstChild:null};c[cx]>0&&(m.firstChild=i,i=$x(c[cx],i)),a.push(m)}return[i,a]}var qB=()=>null;function HJ(i,r){let a=i[zg];return!r||a===null||a.length===0?null:a[0].data[lK]===r?a.shift():(GB(i),null)}function GJ(){qB=HJ}function Gg(i,r){return qB(i,r)}function Hx(i,r,a,c){let h=r.tView,y=i[Bn]&4096?4096:16,w=jx(i,h,a,y,null,r,null,null,null,c?.injector??null,c?.dehydratedView??null),C=i[r.index];w[Kg]=C;let D=i[hc];return D!==null&&(w[hc]=D.createEmbeddedView(h)),qC(h,w,a),w}function ZB(i,r){let a=ss+r;if(a<i.length)return i[a]}function Wg(i,r){return!r||r.firstChild===null||ax(i)}function Gx(i,r,a,c=!0){let h=r[Yn];if(SX(h,r,i,a),c){let y=pI(a,i),w=r[eo],C=SC(w,i[nu]);C!==null&&IX(h,i[Ta],w,r,C,y)}let m=r[Il];m!==null&&m.firstChild!==null&&(m.firstChild=null)}function YB(i,r){let a=Ug(i,r);return a!==void 0&&Rx(a[Yn],a),a}var as=(()=>{let r=class r{};r.__NG_ELEMENT_ID__=WJ;let i=r;return i})();function WJ(){let i=ia();return KB(i,hi())}var qJ=as,XB=class extends qJ{constructor(r,a,c){super(),this._lContainer=r,this._hostTNode=a,this._hostLView=c}get element(){return Vp(this._hostTNode,this._hostLView)}get injector(){return new Th(this._hostTNode,this._hostLView)}get parentInjector(){let r=gC(this._hostTNode,this._hostLView);if(vz(r)){let a=nx(r,this._hostLView),c=tx(r),h=a[Yn].data[c+8];return new Th(h,a)}else return new Th(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(r){let a=x3(this._lContainer);return a!==null&&a[r]||null}get length(){return this._lContainer.length-ss}createEmbeddedView(r,a,c){let h,m;typeof c=="number"?h=c:c!=null&&(h=c.index,m=c.injector);let y=Gg(this._lContainer,r.ssrId),w=r.createEmbeddedViewImpl(a||{},m,y);return this.insertImpl(w,h,Wg(this._hostTNode,y)),w}createComponent(r,a,c,h,m){let y=r&&!qY(r),w;if(y)w=a;else{let he=a||{};w=he.index,c=he.injector,h=he.projectableNodes,m=he.environmentInjector||he.ngModuleRef}let C=y?r:new Hg(Mh(r)),D=c||this.parentInjector;if(!m&&C.ngModule==null){let ke=(y?D:this.parentInjector).get(ta,null);ke&&(m=ke)}let z=Mh(C.componentType??{}),j=Gg(this._lContainer,z?.id??null),ie=j?.firstChild??null,oe=C.create(D,h,ie,m);return this.insertImpl(oe.hostView,w,Wg(this._hostTNode,j)),oe}insert(r,a){return this.insertImpl(r,a,!0)}insertImpl(r,a,c){let h=r._lView;if(hY(h)){let w=this.indexOf(r);if(w!==-1)this.detach(w);else{let C=h[Qo],D=new XB(C,C[Ta],C[Qo]);D.detach(D.indexOf(r))}}let m=this._adjustIndex(a),y=this._lContainer;return Gx(y,h,m,c),r.attachToViewContainerRef(),Sz(WM(y),m,r),r}move(r,a){return this.insert(r,a)}indexOf(r){let a=x3(this._lContainer);return a!==null?a.indexOf(r):-1}remove(r){let a=this._adjustIndex(r,-1),c=Ug(this._lContainer,a);c&&(ox(WM(this._lContainer),a),Rx(c[Yn],c))}detach(r){let a=this._adjustIndex(r,-1),c=Ug(this._lContainer,a);return c&&ox(WM(this._lContainer),a)!=null?new Oh(c):null}_adjustIndex(r,a=0){return r??this.length+a}};function x3(i){return i[ex]}function WM(i){return i[ex]||(i[ex]=[])}function KB(i,r){let a,c=r[i.index];return pc(c)?a=c:(a=RB(c,r,null,i),r[i.index]=a,Vx(r,a)),JB(a,r,i,c),new XB(a,i,r)}function ZJ(i,r){let a=i[eo],c=a.createComment(""),h=Ea(r,i),m=SC(a,h);return lx(a,m,c,LX(a,h),!1),c}var JB=QB,YC=()=>!1;function YJ(i,r,a){return YC(i,r,a)}function QB(i,r,a,c){if(i[nu])return;let h;a.type&8?h=Cl(c):h=ZJ(r,a),i[nu]=h}function XJ(i,r,a){if(i[nu]&&i[zg])return!0;let c=a[Il],h=r.index-to;if(!c||pX(r)||Bx(c,h))return!1;let y=EI(c,h),w=c.data[OC]?.[h],[C,D]=$J(y,w);return i[nu]=C,i[zg]=D,!0}function KJ(i,r,a,c){YC(i,a,r)||QB(i,r,a,c)}function JJ(){JB=KJ,YC=XJ}var lu=class{},qg=class{};function ej(i,r){return new gx(i,r??null,[])}var gx=class extends lu{constructor(r,a,c){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new px(this);let h=q3(r);this._bootstrapComponents=Nz(h.bootstrap),this._r3Injector=Fz(r,a,[{provide:lu,useValue:this},{provide:pu,useValue:this.componentFactoryResolver},...c],Rs(r),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(r)}get injector(){return this._r3Injector}destroy(){let r=this._r3Injector;!r.destroyed&&r.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(r){this.destroyCbs.push(r)}},zI=class extends qg{constructor(r){super(),this.moduleType=r}create(r){return new gx(this.moduleType,r,[])}};var _x=class extends lu{constructor(r){super(),this.componentFactoryResolver=new px(this),this.instance=null;let a=new Vg([...r.providers,{provide:lu,useValue:this},{provide:pu,useValue:this.componentFactoryResolver}],r.parent||wC(),r.debugName,new Set(["environment"]));this.injector=a,r.runEnvironmentInitializers&&a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(r){this.injector.onDestroy(r)}};function XC(i,r,a=null){return new _x({providers:i,parent:r,debugName:a,runEnvironmentInitializers:!0}).injector}var jh=(()=>{let r=class r{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new pr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let c=this.taskId++;return this.pendingTasks.add(c),c}remove(c){this.pendingTasks.delete(c),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function i_(i,r,a){return i[r]=a}function QJ(i,r){return i[r]}function wa(i,r,a){let c=i[r];return Object.is(c,a)?!1:(i[r]=a,!0)}function yx(i,r,a,c){let h=wa(i,r,a);return wa(i,r+1,c)||h}function tj(i,r,a,c,h,m){let y=yx(i,r,a,c);return yx(i,r+2,h,m)||y}function eQ(i,r,a,c,h,m,y,w,C){let D=r.consts,z=Up(r,i,4,y||null,Rp(D,w));$C(r,a,z,Rp(D,C)),Dx(r,z);let j=z.tView=VC(2,z,c,h,m,r.directiveRegistry,r.pipeRegistry,null,r.schemas,D,null);return r.queries!==null&&(r.queries.template(r,z),j.queries=r.queries.embeddedTView(z)),z}function It(i,r,a,c,h,m,y,w){let C=hi(),D=Yo(),z=i+to,j=D.firstCreatePass?eQ(z,D,C,r,a,c,h,m,y):D.data[z];Fh(j,!1);let ie=nj(D,C,j,i);Sx()&&Lx(D,C,ie,j),ld(ie,C);let oe=RB(ie,C,ie,j);return C[z]=oe,Vx(C,oe),YJ(oe,j,C),Ix(j)&&BC(D,C,j),y!=null&&jC(C,j,w),It}var nj=ij;function ij(i,r,a,c){return dd(!0),r[eo].createComment("")}function tQ(i,r,a,c){let h=r[Il],m=!h||Np()||Bx(h,c);if(dd(m),m)return ij(i,r,a,c);let y=h.data[aK]?.[c]??null;y!==null&&a.tView!==null&&a.tView.ssrId===null&&(a.tView.ssrId=y);let w=Ux(h,i,r,a);zx(h,c,w);let C=LC(h,c);return $x(C,w)}function nQ(){nj=tQ}function Mr(i,r,a,c){let h=hi(),m=kh();if(wa(h,m,r)){let y=Yo(),w=Cx();nJ(w,h,i,r,a,c)}return Mr}function iQ(i,r,a,c){return wa(i,kh(),a)?r+Eh(a)+c:mu}function rQ(i,r,a,c,h,m){let y=EY(),w=yx(i,y,a,h);return az(2),w?r+Eh(a)+c+Eh(h)+m:mu}function H0(i,r){return i<<17|r<<2}function Rh(i){return i>>17&32767}function oQ(i){return(i&2)==2}function sQ(i,r){return i&131071|r<<17}function BI(i){return i|2}function Fp(i){return(i&131068)>>2}function qM(i,r){return i&-131069|r<<2}function aQ(i){return(i&1)===1}function jI(i){return i|1}function lQ(i,r,a,c,h,m){let y=m?r.classBindings:r.styleBindings,w=Rh(y),C=Fp(y);i[c]=a;let D=!1,z;if(Array.isArray(a)){let j=a;z=j[1],(z===null||e_(j,z)>0)&&(D=!0)}else z=a;if(h)if(C!==0){let ie=Rh(i[w+1]);i[c+1]=H0(ie,w),ie!==0&&(i[ie+1]=qM(i[ie+1],c)),i[w+1]=sQ(i[w+1],c)}else i[c+1]=H0(w,0),w!==0&&(i[w+1]=qM(i[w+1],c)),w=c;else i[c+1]=H0(C,0),w===0?w=c:i[C+1]=qM(i[C+1],c),C=c;D&&(i[c+1]=BI(i[c+1])),b3(i,z,c,!0),b3(i,z,c,!1),cQ(r,z,i,c,m),y=H0(w,C),m?r.classBindings=y:r.styleBindings=y}function cQ(i,r,a,c,h){let m=h?i.residualClasses:i.residualStyles;m!=null&&typeof r=="string"&&e_(m,r)>=0&&(a[c+1]=jI(a[c+1]))}function b3(i,r,a,c){let h=i[a+1],m=r===null,y=c?Rh(h):Fp(h),w=!1;for(;y!==0&&(w===!1||m);){let C=i[y],D=i[y+1];uQ(C,r)&&(w=!0,i[y+1]=c?jI(D):BI(D)),y=c?Rh(D):Fp(D)}w&&(i[a+1]=c?BI(h):jI(h))}function uQ(i,r){return i===null||r==null||(Array.isArray(i)?i[1]:i)===r?!0:Array.isArray(i)&&typeof r=="string"?e_(i,r)>=0:!1}function Xe(i,r,a){let c=hi(),h=kh();if(wa(c,h,r)){let m=Yo(),y=Cx();UC(m,y,c,i,r,c[eo],a,!1)}return Xe}function w3(i,r,a,c,h){let m=r.inputs,y=h?"class":"style";HC(i,a,m[y],y,c)}function Al(i,r,a){return rj(i,r,a,!1),Al}function ti(i,r){return rj(i,r,null,!0),ti}function rj(i,r,a,c){let h=hi(),m=Yo(),y=az(2);if(m.firstUpdatePass&&hQ(m,i,y,c),r!==mu&&wa(h,y,r)){let w=m.data[ud()];_Q(m,w,h,h[eo],i,h[y+1]=yQ(r,a),c,y)}}function dQ(i,r){return r>=i.expandoStartIndex}function hQ(i,r,a,c){let h=i.data;if(h[a+1]===null){let m=h[ud()],y=dQ(i,a);vQ(m,c)&&r===null&&!y&&(r=!1),r=fQ(h,m,r,c),lQ(h,m,r,a,y,c)}}function fQ(i,r,a,c){let h=lz(i),m=c?r.residualClasses:r.residualStyles;if(h===null)(c?r.classBindings:r.styleBindings)===0&&(a=ZM(null,i,r,a,c),a=Zg(a,r.attrs,c),m=null);else{let y=r.directiveStylingLast;if(y===-1||i[y]!==h)if(a=ZM(h,i,r,a,c),m===null){let C=pQ(i,r,c);C!==void 0&&Array.isArray(C)&&(C=ZM(null,i,r,C[1],c),C=Zg(C,r.attrs,c),mQ(i,r,c,C))}else m=gQ(i,r,c)}return m!==void 0&&(c?r.residualClasses=m:r.residualStyles=m),a}function pQ(i,r,a){let c=a?r.classBindings:r.styleBindings;if(Fp(c)!==0)return i[Rh(c)]}function mQ(i,r,a,c){let h=a?r.classBindings:r.styleBindings;i[Rh(h)]=c}function gQ(i,r,a){let c,h=r.directiveEnd;for(let m=1+r.directiveStylingLast;m<h;m++){let y=i[m].hostAttrs;c=Zg(c,y,a)}return Zg(c,r.attrs,a)}function ZM(i,r,a,c,h){let m=null,y=a.directiveEnd,w=a.directiveStylingLast;for(w===-1?w=a.directiveStart:w++;w<y&&(m=r[w],c=Zg(c,m.hostAttrs,h),m!==i);)w++;return i!==null&&(a.directiveStylingLast=w),c}function Zg(i,r,a){let c=a?1:2,h=-1;if(r!==null)for(let m=0;m<r.length;m++){let y=r[m];typeof y=="number"?h=y:h===c&&(Array.isArray(i)||(i=i===void 0?[]:["",i]),JY(i,y,a?!0:r[++m]))}return i===void 0?null:i}function _Q(i,r,a,c,h,m,y,w){if(!(r.type&3))return;let C=i.data,D=C[w+1],z=aQ(D)?T3(C,r,a,h,Fp(D),y):void 0;if(!vx(z)){vx(m)||oQ(D)&&(m=T3(C,null,a,h,w,y));let j=iz(ud(),a);BX(c,y,j,h,m)}}function T3(i,r,a,c,h,m){let y=r===null,w;for(;h>0;){let C=i[h],D=Array.isArray(C),z=D?C[1]:C,j=z===null,ie=a[h+1];ie===mu&&(ie=j?ba:void 0);let oe=j?zM(ie,c):z===c?ie:void 0;if(D&&!vx(oe)&&(oe=zM(C,c)),vx(oe)&&(w=oe,y))return w;let he=i[h+1];h=y?Rh(he):Fp(he)}if(r!==null){let C=m?r.residualClasses:r.residualStyles;C!=null&&(w=zM(C,c))}return w}function vx(i){return i!==void 0}function yQ(i,r){return i==null||i===""||(typeof r=="string"?i=i+r:typeof i=="object"&&(i=Rs(Dl(i)))),i}function vQ(i,r){return(i.flags&(r?8:16))!==0}var VI=class{destroy(r){}updateValue(r,a){}swap(r,a){let c=Math.min(r,a),h=Math.max(r,a),m=this.detach(h);if(h-c>1){let y=this.detach(c);this.attach(c,m),this.attach(h,y)}else this.attach(c,m)}move(r,a){this.attach(a,this.detach(r))}};function YM(i,r,a,c,h){return i===a&&Object.is(r,c)?1:Object.is(h(i,r),h(a,c))?-1:0}function xQ(i,r,a){let c,h,m=0,y=i.length-1;if(Array.isArray(r)){let w=r.length-1;for(;m<=y&&m<=w;){let C=i.at(m),D=r[m],z=YM(m,C,m,D,a);if(z!==0){z<0&&i.updateValue(m,D),m++;continue}let j=i.at(y),ie=r[w],oe=YM(y,j,w,ie,a);if(oe!==0){oe<0&&i.updateValue(y,ie),y--,w--;continue}let he=a(m,C),ke=a(y,j),rt=a(m,D);if(Object.is(rt,ke)){let Ve=a(w,ie);Object.is(Ve,he)?(i.swap(m,y),i.updateValue(y,ie),w--,y--):i.move(y,m),i.updateValue(m,D),m++;continue}if(c??=new xx,h??=M3(i,m,y,a),UI(i,c,m,rt))i.updateValue(m,D),m++,y++;else if(h.has(rt))c.set(he,i.detach(m)),y--;else{let Ve=i.create(m,r[m]);i.attach(m,Ve),m++,y++}}for(;m<=w;)E3(i,c,a,m,r[m]),m++}else if(r!=null){let w=r[Symbol.iterator](),C=w.next();for(;!C.done&&m<=y;){let D=i.at(m),z=C.value,j=YM(m,D,m,z,a);if(j!==0)j<0&&i.updateValue(m,z),m++,C=w.next();else{c??=new xx,h??=M3(i,m,y,a);let ie=a(m,z);if(UI(i,c,m,ie))i.updateValue(m,z),m++,y++,C=w.next();else if(!h.has(ie))i.attach(m,i.create(m,z)),m++,y++,C=w.next();else{let oe=a(m,D);c.set(oe,i.detach(m)),y--}}}for(;!C.done;)E3(i,c,a,i.length,C.value),C=w.next()}for(;m<=y;)i.destroy(i.detach(y--));c?.forEach(w=>{i.destroy(w)})}function UI(i,r,a,c){return r!==void 0&&r.has(c)?(i.attach(a,r.get(c)),r.delete(c),!0):!1}function E3(i,r,a,c,h){if(UI(i,r,c,a(c,h)))i.updateValue(c,h);else{let m=i.create(c,h);i.attach(c,m)}}function M3(i,r,a,c){let h=new Set;for(let m=r;m<=a;m++)h.add(c(m,i.at(m)));return h}var xx=class{constructor(){this.kvMap=new Map,this._vMap=void 0}has(r){return this.kvMap.has(r)}delete(r){if(!this.has(r))return!1;let a=this.kvMap.get(r);return this._vMap!==void 0&&this._vMap.has(a)?(this.kvMap.set(r,this._vMap.get(a)),this._vMap.delete(a)):this.kvMap.delete(r),!0}get(r){return this.kvMap.get(r)}set(r,a){if(this.kvMap.has(r)){let c=this.kvMap.get(r);this._vMap===void 0&&(this._vMap=new Map);let h=this._vMap;for(;h.has(c);)c=h.get(c);h.set(c,a)}else this.kvMap.set(r,a)}forEach(r){for(let[a,c]of this.kvMap)if(r(c,a),this._vMap!==void 0){let h=this._vMap;for(;h.has(c);)c=h.get(c),r(c,a)}}};function Vh(i,r,a){Bh("NgControlFlow");let c=hi(),h=kh(),m=WI(c,to+i),y=0;if(wa(c,h,r)){let w=qo(null);try{if(YB(m,y),r!==-1){let C=qI(c[Yn],to+r),D=Gg(m,C.tView.ssrId),z=Hx(c,C,a,{dehydratedView:D});Gx(m,z,y,Wg(C,D))}}finally{qo(w)}}else{let w=ZB(m,y);w!==void 0&&(w[_s]=a)}}var $I=class{constructor(r,a,c){this.lContainer=r,this.$implicit=a,this.$index=c}get $count(){return this.lContainer.length-ss}};function Wx(i,r){return r}var HI=class{constructor(r,a,c){this.hasEmptyBlock=r,this.trackByFn=a,this.liveCollection=c}};function Uh(i,r,a,c,h,m,y,w,C,D,z,j,ie){Bh("NgControlFlow");let oe=C!==void 0,he=hi(),ke=w?y.bind(he[ea][_s]):y,rt=new HI(oe,ke);he[to+i]=rt,It(i+1,r,a,c,h,m),oe&&It(i+2,C,D,z,j,ie)}var GI=class extends VI{constructor(r,a,c){super(),this.lContainer=r,this.hostLView=a,this.templateTNode=c,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-ss}at(r){return this.getLView(r)[_s].$implicit}attach(r,a){let c=a[Il];this.needsIndexUpdate||=r!==this.length,Gx(this.lContainer,a,r,Wg(this.templateTNode,c))}detach(r){return this.needsIndexUpdate||=r!==this.length-1,bQ(this.lContainer,r)}create(r,a){let c=Gg(this.lContainer,this.templateTNode.tView.ssrId);return Hx(this.hostLView,this.templateTNode,new $I(this.lContainer,a,r),{dehydratedView:c})}destroy(r){Rx(r[Yn],r)}updateValue(r,a){this.getLView(r)[_s].$implicit=a}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let r=0;r<this.length;r++)this.getLView(r)[_s].$index=r}getLView(r){return wQ(this.lContainer,r)}};function $h(i){let r=qo(null),a=ud();try{let c=hi(),h=c[Yn],m=c[a];if(m.liveCollection===void 0){let w=a+1,C=WI(c,w),D=qI(h,w);m.liveCollection=new GI(C,c,D)}else m.liveCollection.reset();let y=m.liveCollection;if(xQ(y,i,m.trackByFn),y.updateIndexes(),m.hasEmptyBlock){let w=kh(),C=y.length===0;if(wa(c,w,C)){let D=a+2,z=WI(c,D);if(C){let j=qI(h,D),ie=Gg(z,j.tView.ssrId),oe=Hx(c,j,void 0,{dehydratedView:ie});Gx(z,oe,0,Wg(j,ie))}else YB(z,0)}}}finally{qo(r)}}function WI(i,r){return i[r]}function bQ(i,r){return Ug(i,r)}function wQ(i,r){return ZB(i,r)}function qI(i,r){return lC(i,r)}function TQ(i,r,a,c,h,m){let y=r.consts,w=Rp(y,h),C=Up(r,i,2,c,w);return $C(r,a,C,Rp(y,m)),C.attrs!==null&&fx(C,C.attrs,!1),C.mergedAttrs!==null&&fx(C,C.mergedAttrs,!0),r.queries!==null&&r.queries.elementStart(r,C),C}function He(i,r,a,c){let h=hi(),m=Yo(),y=to+i,w=h[eo],C=m.firstCreatePass?TQ(y,m,h,r,a,c):m.data[y],D=oj(m,h,C,w,r,i);h[y]=D;let z=Ix(C);return Fh(C,!0),Qz(w,D,C),(C.flags&32)!==32&&Sx()&&Lx(m,h,D,C),gY()===0&&ld(D,h),_Y(),z&&(BC(m,h,C),zC(m,C,h)),c!==null&&jC(h,C),He}function We(){let i=ia();dC()?hC():(i=i.parent,Fh(i,!1));let r=i;vY(r)&&bY(),yY();let a=Yo();return a.firstCreatePass&&(Dx(a,i),aC(i)&&a.queries.elementEnd(i)),r.classesWithoutHost!=null&&FY(r)&&w3(a,r,hi(),r.classesWithoutHost,!0),r.stylesWithoutHost!=null&&kY(r)&&w3(a,r,hi(),r.stylesWithoutHost,!1),We}function wn(i,r,a,c){return He(i,r,a,c),We(),wn}var oj=(i,r,a,c,h,m)=>(dd(!0),CC(c,h,gz()));function EQ(i,r,a,c,h,m){let y=r[Il],w=!y||Np()||Bx(y,m);if(dd(w),w)return CC(c,h,gz());let C=Ux(y,i,r,a);return gB(y,m)&&zx(y,m,C.nextSibling),y&&(zz(a)||Bz(C))&&Jg(a)&&(xY(a),Xz(C)),C}function MQ(){oj=EQ}function IQ(i,r,a,c,h){let m=r.consts,y=Rp(m,c),w=Up(r,i,8,"ng-container",y);y!==null&&fx(w,y,!0);let C=Rp(m,h);return $C(r,a,w,C),r.queries!==null&&r.queries.elementStart(r,w),w}function Ur(i,r,a){let c=hi(),h=Yo(),m=i+to,y=h.firstCreatePass?IQ(m,h,c,r,a):h.data[m];Fh(y,!0);let w=sj(h,c,y,i);return c[m]=w,Sx()&&Lx(h,c,w,y),ld(w,c),Ix(y)&&(BC(h,c,y),zC(h,y,c)),a!=null&&jC(c,y),Ur}function $r(){let i=ia(),r=Yo();return dC()?hC():(i=i.parent,Fh(i,!1)),r.firstCreatePass&&(Dx(r,i),aC(i)&&r.queries.elementEnd(i)),$r}function Pl(i,r,a){return Ur(i,r,a),$r(),Pl}var sj=(i,r,a,c)=>(dd(!0),Uz(r[eo],""));function CQ(i,r,a,c){let h,m=r[Il],y=!m||Np();if(dd(y),y)return Uz(r[eo],"");let w=Ux(m,i,r,a),C=yK(m,c);return zx(m,c,w),h=$x(C,w),h}function SQ(){sj=CQ}function Zr(){return hi()}function Hh(i,r,a){let c=hi(),h=kh();if(wa(c,h,r)){let m=Yo(),y=Cx();UC(m,y,c,i,r,c[eo],a,!0)}return Hh}function r_(i,r,a){let c=hi(),h=kh();if(wa(c,h,r)){let m=Yo(),y=Cx(),w=lz(m.data),C=sJ(w,y,c);UC(m,y,c,i,r,C,a,!0)}return r_}var wh=void 0;function DQ(i){let r=i,a=Math.floor(Math.abs(i)),c=i.toString().replace(/^[^.]*\.?/,"").length;return a===1&&c===0?1:5}var AQ=["en",[["a","p"],["AM","PM"],wh],[["AM","PM"],wh,wh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],wh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],wh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",wh,"{1} 'at' {0}",wh],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",DQ],XM={};function Ya(i){let r=PQ(i),a=I3(r);if(a)return a;let c=r.split("-")[0];if(a=I3(c),a)return a;if(c==="en")return AQ;throw new mt(701,!1)}function I3(i){return i in XM||(XM[i]=xa.ng&&xa.ng.common&&xa.ng.common.locales&&xa.ng.common.locales[i]),XM[i]}var Lo=function(i){return i[i.LocaleId=0]="LocaleId",i[i.DayPeriodsFormat=1]="DayPeriodsFormat",i[i.DayPeriodsStandalone=2]="DayPeriodsStandalone",i[i.DaysFormat=3]="DaysFormat",i[i.DaysStandalone=4]="DaysStandalone",i[i.MonthsFormat=5]="MonthsFormat",i[i.MonthsStandalone=6]="MonthsStandalone",i[i.Eras=7]="Eras",i[i.FirstDayOfWeek=8]="FirstDayOfWeek",i[i.WeekendRange=9]="WeekendRange",i[i.DateFormat=10]="DateFormat",i[i.TimeFormat=11]="TimeFormat",i[i.DateTimeFormat=12]="DateTimeFormat",i[i.NumberSymbols=13]="NumberSymbols",i[i.NumberFormats=14]="NumberFormats",i[i.CurrencyCode=15]="CurrencyCode",i[i.CurrencySymbol=16]="CurrencySymbol",i[i.CurrencyName=17]="CurrencyName",i[i.Currencies=18]="Currencies",i[i.Directionality=19]="Directionality",i[i.PluralCase=20]="PluralCase",i[i.ExtraData=21]="ExtraData",i}(Lo||{});function PQ(i){return i.toLowerCase().replace(/_/g,"-")}var bx="en-US";var OQ=bx;function RQ(i){typeof i=="string"&&(OQ=i.toLowerCase().replace(/_/g,"-"))}function fd(i){return!!i&&typeof i.then=="function"}function KC(i){return!!i&&typeof i.subscribe=="function"}function Kt(i,r,a,c){let h=hi(),m=Yo(),y=ia();return FQ(m,h,h[eo],y,i,r,c),Kt}function LQ(i,r,a,c){let h=i.cleanup;if(h!=null)for(let m=0;m<h.length-1;m+=2){let y=h[m];if(y===a&&h[m+1]===c){let w=r[kg],C=h[m+2];return w.length>C?w[C]:null}typeof y=="string"&&(m+=2)}return null}function FQ(i,r,a,c,h,m,y){let w=Ix(c),D=i.firstCreatePass&&kB(i),z=r[_s],j=FB(r),ie=!0;if(c.type&3||y){let ke=Ea(c,r),rt=y?y(ke):ke,Ve=j.length,Ot=y?Qt=>y(Cl(Qt[c.index])):c.index,hn=null;if(!y&&w&&(hn=LQ(i,r,h,c.index)),hn!==null){let Qt=hn.__ngLastListenerFn__||hn;Qt.__ngNextListenerFn__=m,hn.__ngLastListenerFn__=m,ie=!1}else{m=S3(c,r,z,m,!1);let Qt=a.listen(rt,h,m);j.push(m,Qt),D&&D.push(h,Ot,Ve,Ve+1)}}else m=S3(c,r,z,m,!1);let oe=c.outputs,he;if(ie&&oe!==null&&(he=oe[h])){let ke=he.length;if(ke)for(let rt=0;rt<ke;rt+=2){let Ve=he[rt],Ot=he[rt+1],Wn=r[Ve][Ot].subscribe(m),Kn=j.length;j.push(m,Wn),D&&D.push(h,c.index,Kn,-(Kn+1))}}}function C3(i,r,a,c){try{return uc(6,r,a),a(c)!==!1}catch(h){return NB(i,h),!1}finally{uc(7,r,a)}}function S3(i,r,a,c,h){return function m(y){if(y===Function)return c;let w=i.componentOffset>-1?cd(i.index,r):r;GC(w);let C=C3(r,a,c,y),D=m.__ngNextListenerFn__;for(;D;)C=C3(r,a,D,y)&&C,D=D.__ngNextListenerFn__;return h&&C===!1&&y.preventDefault(),C}}function yt(i=1){return AY(i)}function kQ(i,r){let a=null,c=Z9(i);for(let h=0;h<r.length;h++){let m=r[h];if(m==="*"){a=h;continue}if(c===null?$3(i,m,!0):K9(c,m))return h}return a}function xs(i){let r=hi()[ea][Ta];if(!r.projection){let a=i?i.length:1,c=r.projection=XY(a,null),h=c.slice(),m=r.child;for(;m!==null;){let y=i?kQ(m,i):0;y!==null&&(h[y]?h[y].projectionNext=m:c[y]=m,h[y]=m),m=m.next}}}function Fo(i,r=0,a){let c=hi(),h=Yo(),m=Up(h,to+i,16,null,a||null);m.projection===null&&(m.projection=r),hC(),(!c[Il]||Np())&&(m.flags&32)!==32&&NX(h,c,m)}function NQ(){return this._results[Symbol.iterator]()}var Yg=class i{get changes(){return this._changes??=new Zn}constructor(r=!1){this._emitDistinctChangesOnly=r,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let a=i.prototype;a[Symbol.iterator]||(a[Symbol.iterator]=NQ)}get(r){return this._results[r]}map(r){return this._results.map(r)}filter(r){return this._results.filter(r)}find(r){return this._results.find(r)}reduce(r,a){return this._results.reduce(r,a)}forEach(r){this._results.forEach(r)}some(r){return this._results.some(r)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(r,a){this.dirty=!1;let c=YY(r);(this._changesDetected=!ZY(this._results,c,a))&&(this._results=c,this.length=c.length,this.last=c[this.length-1],this.first=c[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}},es=(()=>{let r=class r{};r.__NG_ELEMENT_ID__=jQ;let i=r;return i})(),zQ=es,BQ=class extends zQ{constructor(r,a,c){super(),this._declarationLView=r,this._declarationTContainer=a,this.elementRef=c}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(r,a){return this.createEmbeddedViewImpl(r,a)}createEmbeddedViewImpl(r,a,c){let h=Hx(this._declarationLView,this._declarationTContainer,r,{injector:a,dehydratedView:c});return new Oh(h)}};function jQ(){return qx(ia(),hi())}function qx(i,r){return i.type&4?new BQ(r,i,Vp(i,r)):null}var ZI=class i{constructor(r){this.queryList=r,this.matches=null}clone(){return new i(this.queryList)}setDirty(){this.queryList.setDirty()}},YI=class i{constructor(r=[]){this.queries=r}createEmbeddedView(r){let a=r.queries;if(a!==null){let c=r.contentQueries!==null?r.contentQueries[0]:a.length,h=[];for(let m=0;m<c;m++){let y=a.getByIndex(m),w=this.queries[y.indexInDeclarationView];h.push(w.clone())}return new i(h)}return null}insertView(r){this.dirtyQueriesWithMatches(r)}detachView(r){this.dirtyQueriesWithMatches(r)}dirtyQueriesWithMatches(r){for(let a=0;a<this.queries.length;a++)lj(r,a).matches!==null&&this.queries[a].setDirty()}},XI=class{constructor(r,a,c=null){this.predicate=r,this.flags=a,this.read=c}},KI=class i{constructor(r=[]){this.queries=r}elementStart(r,a){for(let c=0;c<this.queries.length;c++)this.queries[c].elementStart(r,a)}elementEnd(r){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(r)}embeddedTView(r){let a=null;for(let c=0;c<this.length;c++){let h=a!==null?a.length:0,m=this.getByIndex(c).embeddedTView(r,h);m&&(m.indexInDeclarationView=c,a!==null?a.push(m):a=[m])}return a!==null?new i(a):null}template(r,a){for(let c=0;c<this.queries.length;c++)this.queries[c].template(r,a)}getByIndex(r){return this.queries[r]}get length(){return this.queries.length}track(r){this.queries.push(r)}},JI=class i{constructor(r,a=-1){this.metadata=r,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(r,a){this.isApplyingToNode(a)&&this.matchTNode(r,a)}elementEnd(r){this._declarationNodeIndex===r.index&&(this._appliesToNextNode=!1)}template(r,a){this.elementStart(r,a)}embeddedTView(r,a){return this.isApplyingToNode(r)?(this.crossesNgTemplate=!0,this.addMatch(-r.index,a),new i(this.metadata)):null}isApplyingToNode(r){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let a=this._declarationNodeIndex,c=r.parent;for(;c!==null&&c.type&8&&c.index!==a;)c=c.parent;return a===(c!==null?c.index:-1)}return this._appliesToNextNode}matchTNode(r,a){let c=this.metadata.predicate;if(Array.isArray(c))for(let h=0;h<c.length;h++){let m=c[h];this.matchTNodeWithReadOption(r,a,VQ(a,m)),this.matchTNodeWithReadOption(r,a,Z0(a,r,m,!1,!1))}else c===es?a.type&4&&this.matchTNodeWithReadOption(r,a,-1):this.matchTNodeWithReadOption(r,a,Z0(a,r,c,!1,!1))}matchTNodeWithReadOption(r,a,c){if(c!==null){let h=this.metadata.read;if(h!==null)if(h===mn||h===as||h===es&&a.type&4)this.addMatch(a.index,-2);else{let m=Z0(a,r,h,!1,!1);m!==null&&this.addMatch(a.index,m)}else this.addMatch(a.index,c)}}addMatch(r,a){this.matches===null?this.matches=[r,a]:this.matches.push(r,a)}};function VQ(i,r){let a=i.localNames;if(a!==null){for(let c=0;c<a.length;c+=2)if(a[c]===r)return a[c+1]}return null}function UQ(i,r){return i.type&11?Vp(i,r):i.type&4?qx(i,r):null}function $Q(i,r,a,c){return a===-1?UQ(r,i):a===-2?HQ(i,r,c):Ah(i,i[Yn],a,r)}function HQ(i,r,a){if(a===mn)return Vp(r,i);if(a===es)return qx(r,i);if(a===as)return KB(r,i)}function aj(i,r,a,c){let h=r[hc].queries[c];if(h.matches===null){let m=i.data,y=a.matches,w=[];for(let C=0;C<y.length;C+=2){let D=y[C];if(D<0)w.push(null);else{let z=m[D];w.push($Q(r,z,y[C+1],a.metadata.read))}}h.matches=w}return h.matches}function QI(i,r,a,c){let h=i.queries.getByIndex(a),m=h.matches;if(m!==null){let y=aj(i,r,h,a);for(let w=0;w<m.length;w+=2){let C=m[w];if(C>0)c.push(y[w/2]);else{let D=m[w+1],z=r[-C];for(let j=ss;j<z.length;j++){let ie=z[j];ie[Kg]===ie[Qo]&&QI(ie[Yn],ie,D,c)}if(z[Op]!==null){let j=z[Op];for(let ie=0;ie<j.length;ie++){let oe=j[ie];QI(oe[Yn],oe,D,c)}}}}}return c}function GQ(i,r){return i[hc].queries[r].queryList}function WQ(i,r,a){let c=new Yg((a&4)===4);VK(i,r,c,c.destroy),r[hc]===null&&(r[hc]=new YI),r[hc].queries.push(new ZI(c))}function qQ(i,r,a){i.queries===null&&(i.queries=new KI),i.queries.track(new JI(r,a))}function lj(i,r){return i.queries.getByIndex(r)}function cj(i,r,a){let c=Yo();c.firstCreatePass&&(qQ(c,new XI(i,r,a),-1),(r&2)===2&&(c.staticViewQueries=!0)),WQ(c,hi(),r)}function JC(i){let r=hi(),a=Yo(),c=cz();fC(c+1);let h=lj(a,c);if(i.dirty&&dY(r)===((h.metadata.flags&2)===2)){if(h.matches===null)i.reset([]);else{let m=h.crossesNgTemplate?QI(a,r,c,[]):aj(a,r,h,c);i.reset(m,wK),i.notifyOnChanges()}return!0}return!1}function QC(){return GQ(hi(),cz())}function ZQ(i,r,a,c){a>=i.data.length&&(i.data[a]=null,i.blueprint[a]=null),r[a]=c}function pd(i){let r=TY();return Qg(r,to+i)}function On(i,r=""){let a=hi(),c=Yo(),h=i+to,m=c.firstCreatePass?Up(c,h,1,r,null):c.data[h],y=uj(c,a,m,r,i);a[h]=y,Sx()&&Lx(c,a,y,m),Fh(m,!1)}var uj=(i,r,a,c,h)=>(dd(!0),Vz(r[eo],c));function YQ(i,r,a,c,h){let m=r[Il],y=!m||Np()||Bx(m,h);return dd(y),y?Vz(r[eo],c):Ux(m,i,r,a)}function XQ(){uj=YQ}function no(i){return jo("",i,""),no}function jo(i,r,a){let c=hi(),h=iQ(c,i,r,a);return h!==mu&&zB(c,ud(),h),jo}function Zx(i,r,a,c,h){let m=hi(),y=rQ(m,i,r,a,c,h);return y!==mu&&zB(m,ud(),y),Zx}function KQ(i,r,a){let c=Yo();if(c.firstCreatePass){let h=iu(i);eC(a,c.data,c.blueprint,h,!0),eC(r,c.data,c.blueprint,h,!1)}}function eC(i,r,a,c,h){if(i=Os(i),Array.isArray(i))for(let m=0;m<i.length;m++)eC(i[m],r,a,c,h);else{let m=Yo(),y=hi(),w=ia(),C=Lp(i)?i:Os(i.provide),D=Lz(i),z=w.providerIndexes&1048575,j=w.directiveStart,ie=w.providerIndexes>>20;if(Lp(i)||!i.multi){let oe=new Dh(D,h,me),he=JM(C,r,h?z:z+ie,j);he===-1?(lI(rx(w,y),m,C),KM(m,i,r.length),r.push(C),w.directiveStart++,w.directiveEnd++,h&&(w.providerIndexes+=1048576),a.push(oe),y.push(oe)):(a[he]=oe,y[he]=oe)}else{let oe=JM(C,r,z+ie,j),he=JM(C,r,z,z+ie),ke=oe>=0&&a[oe],rt=he>=0&&a[he];if(h&&!rt||!h&&!ke){lI(rx(w,y),m,C);let Ve=eee(h?QQ:JQ,a.length,h,c,D);!h&&rt&&(a[he].providerFactory=Ve),KM(m,i,r.length,0),r.push(C),w.directiveStart++,w.directiveEnd++,h&&(w.providerIndexes+=1048576),a.push(Ve),y.push(Ve)}else{let Ve=dj(a[h?he:oe],D,!h&&c);KM(m,i,oe>-1?oe:he,Ve)}!h&&c&&rt&&a[he].componentProviders++}}}function KM(i,r,a,c){let h=Lp(r),m=iX(r);if(h||m){let C=(m?Os(r.useClass):r).prototype.ngOnDestroy;if(C){let D=i.destroyHooks||(i.destroyHooks=[]);if(!h&&r.multi){let z=D.indexOf(a);z===-1?D.push(a,[c,C]):D[z+1].push(c,C)}else D.push(a,C)}}}function dj(i,r,a){return a&&i.componentProviders++,i.multi.push(r)-1}function JM(i,r,a,c){for(let h=a;h<c;h++)if(r[h]===i)return h;return-1}function JQ(i,r,a,c){return tC(this.multi,[])}function QQ(i,r,a,c){let h=this.multi,m;if(this.providerFactory){let y=this.providerFactory.componentProviders,w=Ah(a,a[Yn],this.providerFactory.index,c);m=w.slice(0,y),tC(h,m);for(let C=y;C<w.length;C++)m.push(w[C])}else m=[],tC(h,m);return m}function tC(i,r){for(let a=0;a<i.length;a++){let c=i[a];r.push(c())}return r}function eee(i,r,a,c,h){let m=new Dh(i,a,me);return m.multi=[],m.index=r,m.componentProviders=0,dj(m,h,c&&!a),m}function si(i,r=[]){return a=>{a.providersResolver=(c,h)=>KQ(c,h?h(i):i,r)}}var tee=(()=>{let r=class r{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c)){let h=Pz(!1,c.type),m=h.length>0?XC([h],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c,m)}return this.cachedInjectors.get(c)}ngOnDestroy(){try{for(let c of this.cachedInjectors.values())c!==null&&c.destroy()}finally{this.cachedInjectors.clear()}}};r.\u0275prov=gt({token:r,providedIn:"environment",factory:()=>new r(Ct(ta))});let i=r;return i})();function ra(i){Bh("NgStandalone"),i.getStandaloneInjector=r=>r.get(tee).getOrCreateStandaloneInjector(i)}function Yx(i,r,a,c){return fj(hi(),zp(),i,r,a,c)}function hj(i,r,a,c,h,m,y,w){let C=zp()+i,D=hi(),z=tj(D,C,a,c,h,m);return wa(D,C+4,y)||z?i_(D,C+5,w?r.call(w,a,c,h,m,y):r(a,c,h,m,y)):QJ(D,C+5)}function Xx(i,r){let a=i[r];return a===mu?void 0:a}function fj(i,r,a,c,h,m){let y=r+a;return wa(i,y,h)?i_(i,y+1,m?c.call(m,h):c(h)):Xx(i,y+1)}function nee(i,r,a,c,h,m,y){let w=r+a;return yx(i,w,h,m)?i_(i,w+2,y?c.call(y,h,m):c(h,m)):Xx(i,w+2)}function iee(i,r,a,c,h,m,y,w,C){let D=r+a;return tj(i,D,h,m,y,w)?i_(i,D+4,C?c.call(C,h,m,y,w):c(h,m,y,w)):Xx(i,D+4)}function ree(i,r,a,c,h,m){let y=r+a,w=!1;for(let C=0;C<h.length;C++)wa(i,y++,h[C])&&(w=!0);return w?i_(i,y,c.apply(m,h)):Xx(i,y)}function ai(i,r){let a=Yo(),c,h=i+to;a.firstCreatePass?(c=oee(r,a.pipeRegistry),a.data[h]=c,c.onDestroy&&(a.destroyHooks??=[]).push(h,c.onDestroy)):c=a.data[h];let m=c.factory||(c.factory=Ch(c.type,!0)),y,w=Js(me);try{let C=ix(!1),D=m();return ix(C),ZQ(a,hi(),h,D),D}finally{Js(w)}}function oee(i,r){if(r)for(let a=r.length-1;a>=0;a--){let c=r[a];if(i===c.name)return c}}function br(i,r,a){let c=i+to,h=hi(),m=Qg(h,c);return Kx(h,c)?fj(h,zp(),r,m.transform,a,m):m.transform(a)}function Xa(i,r,a,c){let h=i+to,m=hi(),y=Qg(m,h);return Kx(m,h)?nee(m,zp(),r,y.transform,a,c,y):y.transform(a,c)}function pj(i,r,a,c,h,m){let y=i+to,w=hi(),C=Qg(w,y);return Kx(w,y)?iee(w,zp(),r,C.transform,a,c,h,m,C):C.transform(a,c,h,m)}function mj(i,r,a){let c=i+to,h=hi(),m=Qg(h,c);return Kx(h,c)?ree(h,zp(),r,m.transform,a,m):m.transform.apply(m,a)}function Kx(i,r){return i[Yn].data[r].pure}function md(i,r){return qx(i,r)}var Jx=(()=>{let r=class r{log(c){console.log(c)}warn(c){console.warn(c)}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"platform"});let i=r;return i})(),nC=class{constructor(r,a){this.ngModuleFactory=r,this.componentFactories=a}},eS=(()=>{let r=class r{compileModuleSync(c){return new zI(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){let h=this.compileModuleSync(c),m=q3(c),y=Nz(m.declarations).reduce((w,C)=>{let D=Mh(C);return D&&w.push(new Hg(D)),w},[]);return new nC(h,y)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var gj=new ot("");var _j=new ot(""),yj=(()=>{let r=class r{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((c,h)=>{this.resolve=c,this.reject=h}),this.appInits=Ee(_j,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let c=[];for(let m of this.appInits){let y=m();if(fd(y))c.push(y);else if(KC(y)){let w=new Promise((C,D)=>{y.subscribe({complete:C,error:D})});c.push(w)}}let h=()=>{this.done=!0,this.resolve()};Promise.all(c).then(()=>{h()}).catch(m=>{this.reject(m)}),c.length===0&&h(),this.initialized=!0}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})(),$p=new ot("");function see(){hN(()=>{throw new mt(600,!1)})}function aee(i){return i.isBoundToModule}function lee(i,r,a){try{let c=a();return fd(c)?c.catch(h=>{throw r.runOutsideAngular(()=>i.handleError(h)),h}):c}catch(c){throw r.runOutsideAngular(()=>i.handleError(c)),c}}var gd=(()=>{let r=class r{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ee(wB),this.afterRenderEffectManager=Ee(HB),this.componentTypes=[],this.components=[],this.isStable=Ee(jh).hasPendingTasks.pipe(st(c=>!c)),this._injector=Ee(ta)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(c,h){let m=c instanceof ux;if(!this._injector.get(yj).done){let oe=!m&&W3(c),he=!1;throw new mt(405,he)}let w;m?w=c:w=this._injector.get(pu).resolveComponentFactory(c),this.componentTypes.push(w.componentType);let C=aee(w)?void 0:this._injector.get(lu),D=h||w.selector,z=w.create(ys.NULL,[],D,C),j=z.location.nativeElement,ie=z.injector.get(gj,null);return ie?.registerApplication(j),z.onDestroy(()=>{this.detachView(z.hostView),QM(this.components,z),ie?.unregisterApplication(j)}),this._loadComponent(z),z}tick(){if(this._runningTick)throw new mt(101,!1);try{this._runningTick=!0,this.detectChangesInAttachedViews()}catch(c){this.internalErrorHandler(c)}finally{this._runningTick=!1}}detectChangesInAttachedViews(){let c=0;do{if(c===BB)throw new mt(103,!1);let h=c===0;for(let{_lView:m,notifyErrorHandler:y}of this._views)!h&&!D3(m)||this.detectChangesInView(m,y,h);this.afterRenderEffectManager.execute(),c++}while(this._views.some(({_lView:h})=>D3(h)))}detectChangesInView(c,h,m){let y;m?(y=0,c[Bn]|=1024):c[Bn]&64?y=0:y=1,jB(c,h,y)}attachView(c){let h=c;this._views.push(h),h.attachToAppRef(this)}detachView(c){let h=c;QM(this._views,h),h.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);let h=this._injector.get($p,[]);[...this._bootstrapListeners,...h].forEach(m=>m(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>QM(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new mt(406,!1);let c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function QM(i,r){let a=i.indexOf(r);a>-1&&i.splice(a,1)}var G0;function tS(i){G0??=new WeakMap;let r=G0.get(i);if(r)return r;let a=i.isStable.pipe(Tl(c=>c)).toPromise().then(()=>{});return G0.set(i,a),i.onDestroy(()=>G0?.delete(i)),a}function D3(i){return uC(i)}var cee=(()=>{let r=class r{constructor(){this.zone=Ee(oi),this.applicationRef=Ee(gd)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function uee(i){return[{provide:oi,useFactory:i},{provide:Ph,multi:!0,useFactory:()=>{let r=Ee(cee,{optional:!0});return()=>r.initialize()}},{provide:Ph,multi:!0,useFactory:()=>{let r=Ee(pee);return()=>{r.initialize()}}},{provide:wB,useFactory:dee}]}function dee(){let i=Ee(oi),r=Ee(au);return a=>i.runOutsideAngular(()=>r.handleError(a))}function hee(i){let r=uee(()=>new oi(fee(i)));return hd([[],r])}function fee(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}var pee=(()=>{let r=class r{constructor(){this.subscription=new Po,this.initialized=!1,this.zone=Ee(oi),this.pendingTasks=Ee(jh)}initialize(){if(this.initialized)return;this.initialized=!0;let c=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(c=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{oi.assertNotInAngularZone(),queueMicrotask(()=>{c!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(c),c=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{oi.assertInAngularZone(),c??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function mee(){return typeof $localize<"u"&&$localize.locale||bx}var o_=new ot("",{providedIn:"root",factory:()=>Ee(o_,vi.Optional|vi.SkipSelf)||mee()});var vj=new ot("");var K0=null;function gee(i=[],r){return ys.create({name:r,providers:[{provide:Ax,useValue:"platform"},{provide:vj,useValue:new Set([()=>K0=null])},...i]})}function _ee(i=[]){if(K0)return K0;let r=gee(i);return K0=r,see(),yee(r),r}function yee(i){i.get(TC,null)?.forEach(a=>a())}function xj(){return!1}function bj(i){try{let{rootComponent:r,appProviders:a,platformProviders:c}=i,h=_ee(c),m=[hee(),...a||[]],w=new _x({providers:m,parent:h,debugName:"",runEnvironmentInitializers:!1}).injector,C=w.get(oi);return C.run(()=>{w.resolveInjectorInitializers();let D=w.get(au,null),z;C.runOutsideAngular(()=>{z=C.onError.subscribe({next:oe=>{D.handleError(oe)}})});let j=()=>w.destroy(),ie=h.get(vj);return ie.add(j),w.onDestroy(()=>{z.unsubscribe(),ie.delete(j)}),lee(D,C,()=>{let oe=w.get(yj);return oe.runInitializers(),oe.donePromise.then(()=>{let he=w.get(o_,bx);RQ(he||bx);let ke=w.get(gd);return r!==void 0&&ke.bootstrap(r),ke})})})}catch(r){return Promise.reject(r)}}var A3=!1;function vee(){A3||(A3=!0,pK(),MQ(),XQ(),SQ(),nQ(),JJ(),GJ(),jK())}function xee(i,r){return tS(i)}function wj(){return hd([{provide:U0,useFactory:()=>{let i=!0;return z0()&&(i=!!Ee(zh,{optional:!0})?.get(pB,null)),i&&Bh("NgHydration"),i}},{provide:Ph,useValue:()=>{z0()&&Ee(U0)&&(bee(),vee())},multi:!0},{provide:EB,useFactory:()=>z0()&&Ee(U0)},{provide:$p,useFactory:()=>{if(z0()&&Ee(U0)){let i=Ee(gd),r=Ee(ys);return()=>{xee(i,r).then(()=>{oi.assertInAngularZone(),NJ(i)})}}return()=>{}},multi:!0}])}function bee(){let i=t_(),r;for(let a of i.body.childNodes)if(a.nodeType===Node.COMMENT_NODE&&a.textContent?.trim()===hK){r=a;break}if(!r)throw new mt(-507,!1)}function Gh(i){return typeof i=="boolean"?i:i!=null&&i!=="false"}var Dj=null;function vu(){return Dj}function Aj(i){Dj??=i}var ab=class{},jn=new ot(""),Pj=(()=>{let r=class r{historyGo(c){throw new Error("")}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:()=>Ee(wee),providedIn:"platform"});let i=r;return i})();var wee=(()=>{let r=class r extends Pj{constructor(){super(),this._doc=Ee(jn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return vu().getBaseHref(this._doc)}onPopState(c){let h=vu().getGlobalEventTarget(this._doc,"window");return h.addEventListener("popstate",c,!1),()=>h.removeEventListener("popstate",c)}onHashChange(c){let h=vu().getGlobalEventTarget(this._doc,"window");return h.addEventListener("hashchange",c,!1),()=>h.removeEventListener("hashchange",c)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(c){this._location.pathname=c}pushState(c,h,m){this._history.pushState(c,h,m)}replaceState(c,h,m){this._history.replaceState(c,h,m)}forward(){this._history.forward()}back(){this._history.back()}historyGo(c=0){this._history.go(c)}getState(){return this._history.state}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:()=>new r,providedIn:"platform"});let i=r;return i})();function Oj(i,r){if(i.length==0)return r;if(r.length==0)return i;let a=0;return i.endsWith("/")&&a++,r.startsWith("/")&&a++,a==2?i+r.substring(1):a==1?i+r:i+"/"+r}function Tj(i){let r=i.match(/#|\?|$/),a=r&&r.index||i.length,c=a-(i[a-1]==="/"?1:0);return i.slice(0,c)+i.slice(a)}function Wh(i){return i&&i[0]!=="?"?"?"+i:i}var Gp=(()=>{let r=class r{historyGo(c){throw new Error("")}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:()=>Ee(Rj),providedIn:"root"});let i=r;return i})(),Tee=new ot(""),Rj=(()=>{let r=class r extends Gp{constructor(c,h){super(),this._platformLocation=c,this._removeListenerFns=[],this._baseHref=h??this._platformLocation.getBaseHrefFromDOM()??Ee(jn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(c){this._removeListenerFns.push(this._platformLocation.onPopState(c),this._platformLocation.onHashChange(c))}getBaseHref(){return this._baseHref}prepareExternalUrl(c){return Oj(this._baseHref,c)}path(c=!1){let h=this._platformLocation.pathname+Wh(this._platformLocation.search),m=this._platformLocation.hash;return m&&c?`${h}${m}`:h}pushState(c,h,m,y){let w=this.prepareExternalUrl(m+Wh(y));this._platformLocation.pushState(c,h,w)}replaceState(c,h,m,y){let w=this.prepareExternalUrl(m+Wh(y));this._platformLocation.replaceState(c,h,w)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(c=0){this._platformLocation.historyGo?.(c)}};r.\u0275fac=function(h){return new(h||r)(Ct(Pj),Ct(Tee,8))},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var s_=(()=>{let r=class r{constructor(c){this._subject=new Zn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=c;let h=this._locationStrategy.getBaseHref();this._basePath=Iee(Tj(Ej(h))),this._locationStrategy.onPopState(m=>{this._subject.emit({url:this.path(!0),pop:!0,state:m.state,type:m.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(c=!1){return this.normalize(this._locationStrategy.path(c))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(c,h=""){return this.path()==this.normalize(c+Wh(h))}normalize(c){return r.stripTrailingSlash(Mee(this._basePath,Ej(c)))}prepareExternalUrl(c){return c&&c[0]!=="/"&&(c="/"+c),this._locationStrategy.prepareExternalUrl(c)}go(c,h="",m=null){this._locationStrategy.pushState(m,"",c,h),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+Wh(h)),m)}replaceState(c,h="",m=null){this._locationStrategy.replaceState(m,"",c,h),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+Wh(h)),m)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(c=0){this._locationStrategy.historyGo?.(c)}onUrlChange(c){return this._urlChangeListeners.push(c),this._urlChangeSubscription??=this.subscribe(h=>{this._notifyUrlChangeListeners(h.url,h.state)}),()=>{let h=this._urlChangeListeners.indexOf(c);this._urlChangeListeners.splice(h,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(c="",h){this._urlChangeListeners.forEach(m=>m(c,h))}subscribe(c,h,m){return this._subject.subscribe({next:c,error:h,complete:m})}};r.normalizeQueryParams=Wh,r.joinWithSlash=Oj,r.stripTrailingSlash=Tj,r.\u0275fac=function(h){return new(h||r)(Ct(Gp))},r.\u0275prov=gt({token:r,factory:()=>Eee(),providedIn:"root"});let i=r;return i})();function Eee(){return new s_(Ct(Gp))}function Mee(i,r){if(!i||!r.startsWith(i))return r;let a=r.substring(i.length);return a===""||["/",";","?","#"].includes(a[0])?a:r}function Ej(i){return i.replace(/\/index.html$/,"")}function Iee(i){if(new RegExp("^(https?:)?//").test(i)){let[,a]=i.split(/\/\/[^\/]+/);return a}return i}var Ls=function(i){return i[i.Format=0]="Format",i[i.Standalone=1]="Standalone",i}(Ls||{}),kr=function(i){return i[i.Narrow=0]="Narrow",i[i.Abbreviated=1]="Abbreviated",i[i.Wide=2]="Wide",i[i.Short=3]="Short",i}(kr||{}),Ma=function(i){return i[i.Short=0]="Short",i[i.Medium=1]="Medium",i[i.Long=2]="Long",i[i.Full=3]="Full",i}(Ma||{}),_u=function(i){return i[i.Decimal=0]="Decimal",i[i.Group=1]="Group",i[i.List=2]="List",i[i.PercentSign=3]="PercentSign",i[i.PlusSign=4]="PlusSign",i[i.MinusSign=5]="MinusSign",i[i.Exponential=6]="Exponential",i[i.SuperscriptingExponent=7]="SuperscriptingExponent",i[i.PerMille=8]="PerMille",i[i.Infinity=9]="Infinity",i[i.NaN=10]="NaN",i[i.TimeSeparator=11]="TimeSeparator",i[i.CurrencyDecimal=12]="CurrencyDecimal",i[i.CurrencyGroup=13]="CurrencyGroup",i}(_u||{});function Cee(i){return Ya(i)[Lo.LocaleId]}function See(i,r,a){let c=Ya(i),h=[c[Lo.DayPeriodsFormat],c[Lo.DayPeriodsStandalone]],m=Ka(h,r);return Ka(m,a)}function Dee(i,r,a){let c=Ya(i),h=[c[Lo.DaysFormat],c[Lo.DaysStandalone]],m=Ka(h,r);return Ka(m,a)}function Aee(i,r,a){let c=Ya(i),h=[c[Lo.MonthsFormat],c[Lo.MonthsStandalone]],m=Ka(h,r);return Ka(m,a)}function Pee(i,r){let c=Ya(i)[Lo.Eras];return Ka(c,r)}function Qx(i,r){let a=Ya(i);return Ka(a[Lo.DateFormat],r)}function eb(i,r){let a=Ya(i);return Ka(a[Lo.TimeFormat],r)}function tb(i,r){let c=Ya(i)[Lo.DateTimeFormat];return Ka(c,r)}function cb(i,r){let a=Ya(i),c=a[Lo.NumberSymbols][r];if(typeof c>"u"){if(r===_u.CurrencyDecimal)return a[Lo.NumberSymbols][_u.Decimal];if(r===_u.CurrencyGroup)return a[Lo.NumberSymbols][_u.Group]}return c}function Lj(i){if(!i[Lo.ExtraData])throw new Error(`Missing extra locale data for the locale "${i[Lo.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Oee(i){let r=Ya(i);return Lj(r),(r[Lo.ExtraData][2]||[]).map(c=>typeof c=="string"?nS(c):[nS(c[0]),nS(c[1])])}function Ree(i,r,a){let c=Ya(i);Lj(c);let h=[c[Lo.ExtraData][0],c[Lo.ExtraData][1]],m=Ka(h,r)||[];return Ka(m,a)||[]}function Ka(i,r){for(let a=r;a>-1;a--)if(typeof i[a]<"u")return i[a];throw new Error("Locale data API: locale data undefined")}function nS(i){let[r,a]=i.split(":");return{hours:+r,minutes:+a}}var Lee=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,nb={},Fee=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/,yu=function(i){return i[i.Short=0]="Short",i[i.ShortGMT=1]="ShortGMT",i[i.Long=2]="Long",i[i.Extended=3]="Extended",i}(yu||{}),sr=function(i){return i[i.FullYear=0]="FullYear",i[i.Month=1]="Month",i[i.Date=2]="Date",i[i.Hours=3]="Hours",i[i.Minutes=4]="Minutes",i[i.Seconds=5]="Seconds",i[i.FractionalSeconds=6]="FractionalSeconds",i[i.Day=7]="Day",i}(sr||{}),or=function(i){return i[i.DayPeriods=0]="DayPeriods",i[i.Days=1]="Days",i[i.Months=2]="Months",i[i.Eras=3]="Eras",i}(or||{});function kee(i,r,a,c){let h=Gee(i);r=gu(a,r)||r;let y=[],w;for(;r;)if(w=Fee.exec(r),w){y=y.concat(w.slice(1));let z=y.pop();if(!z)break;r=z}else{y.push(r);break}let C=h.getTimezoneOffset();c&&(C=kj(c,C),h=Hee(h,c,!0));let D="";return y.forEach(z=>{let j=Uee(z);D+=j?j(h,a,C):z==="''"?"'":z.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),D}function lb(i,r,a){let c=new Date(0);return c.setFullYear(i,r,a),c.setHours(0,0,0),c}function gu(i,r){let a=Cee(i);if(nb[a]??={},nb[a][r])return nb[a][r];let c="";switch(r){case"shortDate":c=Qx(i,Ma.Short);break;case"mediumDate":c=Qx(i,Ma.Medium);break;case"longDate":c=Qx(i,Ma.Long);break;case"fullDate":c=Qx(i,Ma.Full);break;case"shortTime":c=eb(i,Ma.Short);break;case"mediumTime":c=eb(i,Ma.Medium);break;case"longTime":c=eb(i,Ma.Long);break;case"fullTime":c=eb(i,Ma.Full);break;case"short":let h=gu(i,"shortTime"),m=gu(i,"shortDate");c=ib(tb(i,Ma.Short),[h,m]);break;case"medium":let y=gu(i,"mediumTime"),w=gu(i,"mediumDate");c=ib(tb(i,Ma.Medium),[y,w]);break;case"long":let C=gu(i,"longTime"),D=gu(i,"longDate");c=ib(tb(i,Ma.Long),[C,D]);break;case"full":let z=gu(i,"fullTime"),j=gu(i,"fullDate");c=ib(tb(i,Ma.Full),[z,j]);break}return c&&(nb[a][r]=c),c}function ib(i,r){return r&&(i=i.replace(/\{([^}]+)}/g,function(a,c){return r!=null&&c in r?r[c]:a})),i}function Ol(i,r,a="-",c,h){let m="";(i<0||h&&i<=0)&&(h?i=-i+1:(i=-i,m=a));let y=String(i);for(;y.length<r;)y="0"+y;return c&&(y=y.slice(y.length-r)),m+y}function Nee(i,r){return Ol(i,3).substring(0,r)}function Vo(i,r,a=0,c=!1,h=!1){return function(m,y){let w=zee(i,m);if((a>0||w>-a)&&(w+=a),i===sr.Hours)w===0&&a===-12&&(w=12);else if(i===sr.FractionalSeconds)return Nee(w,r);let C=cb(y,_u.MinusSign);return Ol(w,r,C,c,h)}}function zee(i,r){switch(i){case sr.FullYear:return r.getFullYear();case sr.Month:return r.getMonth();case sr.Date:return r.getDate();case sr.Hours:return r.getHours();case sr.Minutes:return r.getMinutes();case sr.Seconds:return r.getSeconds();case sr.FractionalSeconds:return r.getMilliseconds();case sr.Day:return r.getDay();default:throw new Error(`Unknown DateType value "${i}".`)}}function Hr(i,r,a=Ls.Format,c=!1){return function(h,m){return Bee(h,m,i,r,a,c)}}function Bee(i,r,a,c,h,m){switch(a){case or.Months:return Aee(r,h,c)[i.getMonth()];case or.Days:return Dee(r,h,c)[i.getDay()];case or.DayPeriods:let y=i.getHours(),w=i.getMinutes();if(m){let D=Oee(r),z=Ree(r,h,c),j=D.findIndex(ie=>{if(Array.isArray(ie)){let[oe,he]=ie,ke=y>=oe.hours&&w>=oe.minutes,rt=y<he.hours||y===he.hours&&w<he.minutes;if(oe.hours<he.hours){if(ke&&rt)return!0}else if(ke||rt)return!0}else if(ie.hours===y&&ie.minutes===w)return!0;return!1});if(j!==-1)return z[j]}return See(r,h,c)[y<12?0:1];case or.Eras:return Pee(r,c)[i.getFullYear()<=0?0:1];default:let C=a;throw new Error(`unexpected translation type ${C}`)}}function rb(i){return function(r,a,c){let h=-1*c,m=cb(a,_u.MinusSign),y=h>0?Math.floor(h/60):Math.ceil(h/60);switch(i){case yu.Short:return(h>=0?"+":"")+Ol(y,2,m)+Ol(Math.abs(h%60),2,m);case yu.ShortGMT:return"GMT"+(h>=0?"+":"")+Ol(y,1,m);case yu.Long:return"GMT"+(h>=0?"+":"")+Ol(y,2,m)+":"+Ol(Math.abs(h%60),2,m);case yu.Extended:return c===0?"Z":(h>=0?"+":"")+Ol(y,2,m)+":"+Ol(Math.abs(h%60),2,m);default:throw new Error(`Unknown zone width "${i}"`)}}}var jee=0,sb=4;function Vee(i){let r=lb(i,jee,1).getDay();return lb(i,0,1+(r<=sb?sb:sb+7)-r)}function Fj(i){let r=i.getDay(),a=r===0?-3:sb-r;return lb(i.getFullYear(),i.getMonth(),i.getDate()+a)}function iS(i,r=!1){return function(a,c){let h;if(r){let m=new Date(a.getFullYear(),a.getMonth(),1).getDay()-1,y=a.getDate();h=1+Math.floor((y+m)/7)}else{let m=Fj(a),y=Vee(m.getFullYear()),w=m.getTime()-y.getTime();h=1+Math.round(w/6048e5)}return Ol(h,i,cb(c,_u.MinusSign))}}function ob(i,r=!1){return function(a,c){let m=Fj(a).getFullYear();return Ol(m,i,cb(c,_u.MinusSign),r)}}var rS={};function Uee(i){if(rS[i])return rS[i];let r;switch(i){case"G":case"GG":case"GGG":r=Hr(or.Eras,kr.Abbreviated);break;case"GGGG":r=Hr(or.Eras,kr.Wide);break;case"GGGGG":r=Hr(or.Eras,kr.Narrow);break;case"y":r=Vo(sr.FullYear,1,0,!1,!0);break;case"yy":r=Vo(sr.FullYear,2,0,!0,!0);break;case"yyy":r=Vo(sr.FullYear,3,0,!1,!0);break;case"yyyy":r=Vo(sr.FullYear,4,0,!1,!0);break;case"Y":r=ob(1);break;case"YY":r=ob(2,!0);break;case"YYY":r=ob(3);break;case"YYYY":r=ob(4);break;case"M":case"L":r=Vo(sr.Month,1,1);break;case"MM":case"LL":r=Vo(sr.Month,2,1);break;case"MMM":r=Hr(or.Months,kr.Abbreviated);break;case"MMMM":r=Hr(or.Months,kr.Wide);break;case"MMMMM":r=Hr(or.Months,kr.Narrow);break;case"LLL":r=Hr(or.Months,kr.Abbreviated,Ls.Standalone);break;case"LLLL":r=Hr(or.Months,kr.Wide,Ls.Standalone);break;case"LLLLL":r=Hr(or.Months,kr.Narrow,Ls.Standalone);break;case"w":r=iS(1);break;case"ww":r=iS(2);break;case"W":r=iS(1,!0);break;case"d":r=Vo(sr.Date,1);break;case"dd":r=Vo(sr.Date,2);break;case"c":case"cc":r=Vo(sr.Day,1);break;case"ccc":r=Hr(or.Days,kr.Abbreviated,Ls.Standalone);break;case"cccc":r=Hr(or.Days,kr.Wide,Ls.Standalone);break;case"ccccc":r=Hr(or.Days,kr.Narrow,Ls.Standalone);break;case"cccccc":r=Hr(or.Days,kr.Short,Ls.Standalone);break;case"E":case"EE":case"EEE":r=Hr(or.Days,kr.Abbreviated);break;case"EEEE":r=Hr(or.Days,kr.Wide);break;case"EEEEE":r=Hr(or.Days,kr.Narrow);break;case"EEEEEE":r=Hr(or.Days,kr.Short);break;case"a":case"aa":case"aaa":r=Hr(or.DayPeriods,kr.Abbreviated);break;case"aaaa":r=Hr(or.DayPeriods,kr.Wide);break;case"aaaaa":r=Hr(or.DayPeriods,kr.Narrow);break;case"b":case"bb":case"bbb":r=Hr(or.DayPeriods,kr.Abbreviated,Ls.Standalone,!0);break;case"bbbb":r=Hr(or.DayPeriods,kr.Wide,Ls.Standalone,!0);break;case"bbbbb":r=Hr(or.DayPeriods,kr.Narrow,Ls.Standalone,!0);break;case"B":case"BB":case"BBB":r=Hr(or.DayPeriods,kr.Abbreviated,Ls.Format,!0);break;case"BBBB":r=Hr(or.DayPeriods,kr.Wide,Ls.Format,!0);break;case"BBBBB":r=Hr(or.DayPeriods,kr.Narrow,Ls.Format,!0);break;case"h":r=Vo(sr.Hours,1,-12);break;case"hh":r=Vo(sr.Hours,2,-12);break;case"H":r=Vo(sr.Hours,1);break;case"HH":r=Vo(sr.Hours,2);break;case"m":r=Vo(sr.Minutes,1);break;case"mm":r=Vo(sr.Minutes,2);break;case"s":r=Vo(sr.Seconds,1);break;case"ss":r=Vo(sr.Seconds,2);break;case"S":r=Vo(sr.FractionalSeconds,1);break;case"SS":r=Vo(sr.FractionalSeconds,2);break;case"SSS":r=Vo(sr.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":r=rb(yu.Short);break;case"ZZZZZ":r=rb(yu.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":r=rb(yu.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":r=rb(yu.Long);break;default:return null}return rS[i]=r,r}function kj(i,r){i=i.replace(/:/g,"");let a=Date.parse("Jan 01, 1970 00:00:00 "+i)/6e4;return isNaN(a)?r:a}function $ee(i,r){return i=new Date(i.getTime()),i.setMinutes(i.getMinutes()+r),i}function Hee(i,r,a){let c=a?-1:1,h=i.getTimezoneOffset(),m=kj(r,h);return $ee(i,c*(m-h))}function Gee(i){if(Mj(i))return i;if(typeof i=="number"&&!isNaN(i))return new Date(i);if(typeof i=="string"){if(i=i.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(i)){let[h,m=1,y=1]=i.split("-").map(w=>+w);return lb(h,m-1,y)}let a=parseFloat(i);if(!isNaN(i-a))return new Date(a);let c;if(c=i.match(Lee))return Wee(c)}let r=new Date(i);if(!Mj(r))throw new Error(`Unable to convert "${i}" into a date`);return r}function Wee(i){let r=new Date(0),a=0,c=0,h=i[8]?r.setUTCFullYear:r.setFullYear,m=i[8]?r.setUTCHours:r.setHours;i[9]&&(a=Number(i[9]+i[10]),c=Number(i[9]+i[11])),h.call(r,Number(i[1]),Number(i[2])-1,Number(i[3]));let y=Number(i[4]||0)-a,w=Number(i[5]||0)-c,C=Number(i[6]||0),D=Math.floor(parseFloat("0."+(i[7]||0))*1e3);return m.call(r,y,w,C,D),r}function Mj(i){return i instanceof Date&&!isNaN(i.valueOf())}function ub(i,r){r=encodeURIComponent(r);for(let a of i.split(";")){let c=a.indexOf("="),[h,m]=c==-1?[a,""]:[a.slice(0,c),a.slice(c+1)];if(h.trim()===r)return decodeURIComponent(m)}return null}var Nj=(()=>{let r=class r{constructor(c){this._viewContainerRef=c,this.ngComponentOutlet=null,this._inputsUsed=new Map}_needToReCreateNgModuleInstance(c){return c.ngComponentOutletNgModule!==void 0||c.ngComponentOutletNgModuleFactory!==void 0}_needToReCreateComponentInstance(c){return c.ngComponentOutlet!==void 0||c.ngComponentOutletContent!==void 0||c.ngComponentOutletInjector!==void 0||this._needToReCreateNgModuleInstance(c)}ngOnChanges(c){if(this._needToReCreateComponentInstance(c)&&(this._viewContainerRef.clear(),this._inputsUsed.clear(),this._componentRef=void 0,this.ngComponentOutlet)){let h=this.ngComponentOutletInjector||this._viewContainerRef.parentInjector;this._needToReCreateNgModuleInstance(c)&&(this._moduleRef?.destroy(),this.ngComponentOutletNgModule?this._moduleRef=ej(this.ngComponentOutletNgModule,Ij(h)):this.ngComponentOutletNgModuleFactory?this._moduleRef=this.ngComponentOutletNgModuleFactory.create(Ij(h)):this._moduleRef=void 0),this._componentRef=this._viewContainerRef.createComponent(this.ngComponentOutlet,{injector:h,ngModuleRef:this._moduleRef,projectableNodes:this.ngComponentOutletContent})}}ngDoCheck(){if(this._componentRef){if(this.ngComponentOutletInputs)for(let c of Object.keys(this.ngComponentOutletInputs))this._inputsUsed.set(c,!0);this._applyInputStateDiff(this._componentRef)}}ngOnDestroy(){this._moduleRef?.destroy()}_applyInputStateDiff(c){for(let[h,m]of this._inputsUsed)m?(c.setInput(h,this.ngComponentOutletInputs[h]),this._inputsUsed.set(h,!1)):(c.setInput(h,void 0),this._inputsUsed.delete(h))}};r.\u0275fac=function(h){return new(h||r)(me(as))},r.\u0275dir=pn({type:r,selectors:[["","ngComponentOutlet",""]],inputs:{ngComponentOutlet:"ngComponentOutlet",ngComponentOutletInputs:"ngComponentOutletInputs",ngComponentOutletInjector:"ngComponentOutletInjector",ngComponentOutletContent:"ngComponentOutletContent",ngComponentOutletNgModule:"ngComponentOutletNgModule",ngComponentOutletNgModuleFactory:"ngComponentOutletNgModuleFactory"},standalone:!0,features:[na]});let i=r;return i})();function Ij(i){return i.get(lu).injector}var oS=class{constructor(r,a,c,h){this.$implicit=r,this.ngForOf=a,this.index=c,this.count=h}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Ja=(()=>{let r=class r{set ngForOf(c){this._ngForOf=c,this._ngForOfDirty=!0}set ngForTrackBy(c){this._trackByFn=c}get ngForTrackBy(){return this._trackByFn}constructor(c,h,m){this._viewContainer=c,this._template=h,this._differs=m,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(c){c&&(this._template=c)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let c=this._ngForOf;if(!this._differ&&c)if(0)try{}catch{}else this._differ=this._differs.find(c).create(this.ngForTrackBy)}if(this._differ){let c=this._differ.diff(this._ngForOf);c&&this._applyChanges(c)}}_applyChanges(c){let h=this._viewContainer;c.forEachOperation((m,y,w)=>{if(m.previousIndex==null)h.createEmbeddedView(this._template,new oS(m.item,this._ngForOf,-1,-1),w===null?void 0:w);else if(w==null)h.remove(y===null?void 0:y);else if(y!==null){let C=h.get(y);h.move(C,w),Cj(C,m)}});for(let m=0,y=h.length;m<y;m++){let C=h.get(m).context;C.index=m,C.count=y,C.ngForOf=this._ngForOf}c.forEachIdentityChange(m=>{let y=h.get(m.currentIndex);Cj(y,m)})}static ngTemplateContextGuard(c,h){return!0}};r.\u0275fac=function(h){return new(h||r)(me(as),me(es),me(kC))},r.\u0275dir=pn({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let i=r;return i})();function Cj(i,r){i.context.$implicit=r.item}var Ki=(()=>{let r=class r{constructor(c,h){this._viewContainer=c,this._context=new sS,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=h}set ngIf(c){this._context.$implicit=this._context.ngIf=c,this._updateView()}set ngIfThen(c){Sj("ngIfThen",c),this._thenTemplateRef=c,this._thenViewRef=null,this._updateView()}set ngIfElse(c){Sj("ngIfElse",c),this._elseTemplateRef=c,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(c,h){return!0}};r.\u0275fac=function(h){return new(h||r)(me(as),me(es))},r.\u0275dir=pn({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let i=r;return i})(),sS=class{constructor(){this.$implicit=null,this.ngIf=null}};function Sj(i,r){if(!!!(!r||r.createEmbeddedView))throw new Error(`${i} must be a TemplateRef, but received '${Rs(r)}'.`)}function zj(i,r){return new mt(2100,!1)}var aS=class{createSubscription(r,a){return FC(()=>r.subscribe({next:a,error:c=>{throw c}}))}dispose(r){FC(()=>r.unsubscribe())}},lS=class{createSubscription(r,a){return r.then(a,c=>{throw c})}dispose(r){}},qee=new lS,Zee=new aS,yo=(()=>{let r=class r{constructor(c){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=c}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(c){return this._obj?c!==this._obj?(this._dispose(),this.transform(c)):this._latestValue:(c&&this._subscribe(c),this._latestValue)}_subscribe(c){this._obj=c,this._strategy=this._selectStrategy(c),this._subscription=this._strategy.createSubscription(c,h=>this._updateLatestValue(c,h))}_selectStrategy(c){if(fd(c))return qee;if(KC(c))return Zee;throw zj(r,c)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(c,h){c===this._obj&&(this._latestValue=h,this._ref.markForCheck())}};r.\u0275fac=function(h){return new(h||r)(me(co,16))},r.\u0275pipe=qa({name:"async",type:r,pure:!1,standalone:!0});let i=r;return i})();var Yee="mediumDate",Xee=new ot(""),Kee=new ot(""),db=(()=>{let r=class r{constructor(c,h,m){this.locale=c,this.defaultTimezone=h,this.defaultOptions=m}transform(c,h,m,y){if(c==null||c===""||c!==c)return null;try{let w=h??this.defaultOptions?.dateFormat??Yee,C=m??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return kee(c,w,y||this.locale,C)}catch(w){throw zj(r,w.message)}}};r.\u0275fac=function(h){return new(h||r)(me(o_,16),me(Xee,24),me(Kee,24))},r.\u0275pipe=qa({name:"date",type:r,pure:!0,standalone:!0});let i=r;return i})();var Xn=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275mod=wt({type:r}),r.\u0275inj=bt({});let i=r;return i})(),uS="browser",Jee="server";function Bj(i){return i===uS}function qh(i){return i===Jee}var Hp=class{};var l_=class{},c_=class{},mc=class i{constructor(r){this.normalizedNames=new Map,this.lazyUpdate=null,r?typeof r=="string"?this.lazyInit=()=>{this.headers=new Map,r.split(`
`).forEach(a=>{let c=a.indexOf(":");if(c>0){let h=a.slice(0,c),m=h.toLowerCase(),y=a.slice(c+1).trim();this.maybeSetNormalizedName(h,m),this.headers.has(m)?this.headers.get(m).push(y):this.headers.set(m,[y])}})}:typeof Headers<"u"&&r instanceof Headers?(this.headers=new Map,r.forEach((a,c)=>{this.setHeaderEntries(c,a)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(r).forEach(([a,c])=>{this.setHeaderEntries(a,c)})}:this.headers=new Map}has(r){return this.init(),this.headers.has(r.toLowerCase())}get(r){this.init();let a=this.headers.get(r.toLowerCase());return a&&a.length>0?a[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(r){return this.init(),this.headers.get(r.toLowerCase())||null}append(r,a){return this.clone({name:r,value:a,op:"a"})}set(r,a){return this.clone({name:r,value:a,op:"s"})}delete(r,a){return this.clone({name:r,value:a,op:"d"})}maybeSetNormalizedName(r,a){this.normalizedNames.has(a)||this.normalizedNames.set(a,r)}init(){this.lazyInit&&(this.lazyInit instanceof i?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(r=>this.applyUpdate(r)),this.lazyUpdate=null))}copyFrom(r){r.init(),Array.from(r.headers.keys()).forEach(a=>{this.headers.set(a,r.headers.get(a)),this.normalizedNames.set(a,r.normalizedNames.get(a))})}clone(r){let a=new i;return a.lazyInit=this.lazyInit&&this.lazyInit instanceof i?this.lazyInit:this,a.lazyUpdate=(this.lazyUpdate||[]).concat([r]),a}applyUpdate(r){let a=r.name.toLowerCase();switch(r.op){case"a":case"s":let c=r.value;if(typeof c=="string"&&(c=[c]),c.length===0)return;this.maybeSetNormalizedName(r.name,a);let h=(r.op==="a"?this.headers.get(a):void 0)||[];h.push(...c),this.headers.set(a,h);break;case"d":let m=r.value;if(!m)this.headers.delete(a),this.normalizedNames.delete(a);else{let y=this.headers.get(a);if(!y)return;y=y.filter(w=>m.indexOf(w)===-1),y.length===0?(this.headers.delete(a),this.normalizedNames.delete(a)):this.headers.set(a,y)}break}}setHeaderEntries(r,a){let c=(Array.isArray(a)?a:[a]).map(m=>m.toString()),h=r.toLowerCase();this.headers.set(h,c),this.maybeSetNormalizedName(r,h)}forEach(r){this.init(),Array.from(this.normalizedNames.keys()).forEach(a=>r(this.normalizedNames.get(a),this.headers.get(a)))}};var fS=class{encodeKey(r){return jj(r)}encodeValue(r){return jj(r)}decodeKey(r){return decodeURIComponent(r)}decodeValue(r){return decodeURIComponent(r)}};function ete(i,r){let a=new Map;return i.length>0&&i.replace(/^\?/,"").split("&").forEach(h=>{let m=h.indexOf("="),[y,w]=m==-1?[r.decodeKey(h),""]:[r.decodeKey(h.slice(0,m)),r.decodeValue(h.slice(m+1))],C=a.get(y)||[];C.push(w),a.set(y,C)}),a}var tte=/%(\d[a-f0-9])/gi,nte={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function jj(i){return encodeURIComponent(i).replace(tte,(r,a)=>nte[a]??r)}function hb(i){return`${i}`}var yd=class i{constructor(r={}){if(this.updates=null,this.cloneFrom=null,this.encoder=r.encoder||new fS,r.fromString){if(r.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=ete(r.fromString,this.encoder)}else r.fromObject?(this.map=new Map,Object.keys(r.fromObject).forEach(a=>{let c=r.fromObject[a],h=Array.isArray(c)?c.map(hb):[hb(c)];this.map.set(a,h)})):this.map=null}has(r){return this.init(),this.map.has(r)}get(r){this.init();let a=this.map.get(r);return a?a[0]:null}getAll(r){return this.init(),this.map.get(r)||null}keys(){return this.init(),Array.from(this.map.keys())}append(r,a){return this.clone({param:r,value:a,op:"a"})}appendAll(r){let a=[];return Object.keys(r).forEach(c=>{let h=r[c];Array.isArray(h)?h.forEach(m=>{a.push({param:c,value:m,op:"a"})}):a.push({param:c,value:h,op:"a"})}),this.clone(a)}set(r,a){return this.clone({param:r,value:a,op:"s"})}delete(r,a){return this.clone({param:r,value:a,op:"d"})}toString(){return this.init(),this.keys().map(r=>{let a=this.encoder.encodeKey(r);return this.map.get(r).map(c=>a+"="+this.encoder.encodeValue(c)).join("&")}).filter(r=>r!=="").join("&")}clone(r){let a=new i({encoder:this.encoder});return a.cloneFrom=this.cloneFrom||this,a.updates=(this.updates||[]).concat(r),a}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(r=>this.map.set(r,this.cloneFrom.map.get(r))),this.updates.forEach(r=>{switch(r.op){case"a":case"s":let a=(r.op==="a"?this.map.get(r.param):void 0)||[];a.push(hb(r.value)),this.map.set(r.param,a);break;case"d":if(r.value!==void 0){let c=this.map.get(r.param)||[],h=c.indexOf(hb(r.value));h!==-1&&c.splice(h,1),c.length>0?this.map.set(r.param,c):this.map.delete(r.param)}else{this.map.delete(r.param);break}}}),this.cloneFrom=this.updates=null)}};var pS=class{constructor(){this.map=new Map}set(r,a){return this.map.set(r,a),this}get(r){return this.map.has(r)||this.map.set(r,r.defaultValue()),this.map.get(r)}delete(r){return this.map.delete(r),this}has(r){return this.map.has(r)}keys(){return this.map.keys()}};function ite(i){switch(i){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Vj(i){return typeof ArrayBuffer<"u"&&i instanceof ArrayBuffer}function Uj(i){return typeof Blob<"u"&&i instanceof Blob}function $j(i){return typeof FormData<"u"&&i instanceof FormData}function rte(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams}var a_=class i{constructor(r,a,c,h){this.url=a,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=r.toUpperCase();let m;if(ite(this.method)||h?(this.body=c!==void 0?c:null,m=h):m=c,m&&(this.reportProgress=!!m.reportProgress,this.withCredentials=!!m.withCredentials,m.responseType&&(this.responseType=m.responseType),m.headers&&(this.headers=m.headers),m.context&&(this.context=m.context),m.params&&(this.params=m.params),this.transferCache=m.transferCache),this.headers??=new mc,this.context??=new pS,!this.params)this.params=new yd,this.urlWithParams=a;else{let y=this.params.toString();if(y.length===0)this.urlWithParams=a;else{let w=a.indexOf("?"),C=w===-1?"?":w<a.length-1?"&":"";this.urlWithParams=a+C+y}}}serializeBody(){return this.body===null?null:Vj(this.body)||Uj(this.body)||$j(this.body)||rte(this.body)||typeof this.body=="string"?this.body:this.body instanceof yd?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||$j(this.body)?null:Uj(this.body)?this.body.type||null:Vj(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof yd?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(r={}){let a=r.method||this.method,c=r.url||this.url,h=r.responseType||this.responseType,m=r.body!==void 0?r.body:this.body,y=r.withCredentials!==void 0?r.withCredentials:this.withCredentials,w=r.reportProgress!==void 0?r.reportProgress:this.reportProgress,C=r.headers||this.headers,D=r.params||this.params,z=r.context??this.context;return r.setHeaders!==void 0&&(C=Object.keys(r.setHeaders).reduce((j,ie)=>j.set(ie,r.setHeaders[ie]),C)),r.setParams&&(D=Object.keys(r.setParams).reduce((j,ie)=>j.set(ie,r.setParams[ie]),D)),new i(a,c,m,{params:D,headers:C,context:z,reportProgress:w,responseType:h,withCredentials:y})}},vd=function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i}(vd||{}),u_=class{constructor(r,a=d_.Ok,c="OK"){this.headers=r.headers||new mc,this.status=r.status!==void 0?r.status:a,this.statusText=r.statusText||c,this.url=r.url||null,this.ok=this.status>=200&&this.status<300}},pb=class i extends u_{constructor(r={}){super(r),this.type=vd.ResponseHeader}clone(r={}){return new i({headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},Zh=class i extends u_{constructor(r={}){super(r),this.type=vd.Response,this.body=r.body!==void 0?r.body:null}clone(r={}){return new i({body:r.body!==void 0?r.body:this.body,headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},_d=class extends u_{constructor(r){super(r,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${r.url||"(unknown url)"}`:this.message=`Http failure response for ${r.url||"(unknown url)"}: ${r.status} ${r.statusText}`,this.error=r.error||null}},d_=function(i){return i[i.Continue=100]="Continue",i[i.SwitchingProtocols=101]="SwitchingProtocols",i[i.Processing=102]="Processing",i[i.EarlyHints=103]="EarlyHints",i[i.Ok=200]="Ok",i[i.Created=201]="Created",i[i.Accepted=202]="Accepted",i[i.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",i[i.NoContent=204]="NoContent",i[i.ResetContent=205]="ResetContent",i[i.PartialContent=206]="PartialContent",i[i.MultiStatus=207]="MultiStatus",i[i.AlreadyReported=208]="AlreadyReported",i[i.ImUsed=226]="ImUsed",i[i.MultipleChoices=300]="MultipleChoices",i[i.MovedPermanently=301]="MovedPermanently",i[i.Found=302]="Found",i[i.SeeOther=303]="SeeOther",i[i.NotModified=304]="NotModified",i[i.UseProxy=305]="UseProxy",i[i.Unused=306]="Unused",i[i.TemporaryRedirect=307]="TemporaryRedirect",i[i.PermanentRedirect=308]="PermanentRedirect",i[i.BadRequest=400]="BadRequest",i[i.Unauthorized=401]="Unauthorized",i[i.PaymentRequired=402]="PaymentRequired",i[i.Forbidden=403]="Forbidden",i[i.NotFound=404]="NotFound",i[i.MethodNotAllowed=405]="MethodNotAllowed",i[i.NotAcceptable=406]="NotAcceptable",i[i.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",i[i.RequestTimeout=408]="RequestTimeout",i[i.Conflict=409]="Conflict",i[i.Gone=410]="Gone",i[i.LengthRequired=411]="LengthRequired",i[i.PreconditionFailed=412]="PreconditionFailed",i[i.PayloadTooLarge=413]="PayloadTooLarge",i[i.UriTooLong=414]="UriTooLong",i[i.UnsupportedMediaType=415]="UnsupportedMediaType",i[i.RangeNotSatisfiable=416]="RangeNotSatisfiable",i[i.ExpectationFailed=417]="ExpectationFailed",i[i.ImATeapot=418]="ImATeapot",i[i.MisdirectedRequest=421]="MisdirectedRequest",i[i.UnprocessableEntity=422]="UnprocessableEntity",i[i.Locked=423]="Locked",i[i.FailedDependency=424]="FailedDependency",i[i.TooEarly=425]="TooEarly",i[i.UpgradeRequired=426]="UpgradeRequired",i[i.PreconditionRequired=428]="PreconditionRequired",i[i.TooManyRequests=429]="TooManyRequests",i[i.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",i[i.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",i[i.InternalServerError=500]="InternalServerError",i[i.NotImplemented=501]="NotImplemented",i[i.BadGateway=502]="BadGateway",i[i.ServiceUnavailable=503]="ServiceUnavailable",i[i.GatewayTimeout=504]="GatewayTimeout",i[i.HttpVersionNotSupported=505]="HttpVersionNotSupported",i[i.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",i[i.InsufficientStorage=507]="InsufficientStorage",i[i.LoopDetected=508]="LoopDetected",i[i.NotExtended=510]="NotExtended",i[i.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",i}(d_||{});function dS(i,r){return{body:r,headers:i.headers,context:i.context,observe:i.observe,params:i.params,reportProgress:i.reportProgress,responseType:i.responseType,withCredentials:i.withCredentials,transferCache:i.transferCache}}var _S=(()=>{let r=class r{constructor(c){this.handler=c}request(c,h,m={}){let y;if(c instanceof a_)y=c;else{let D;m.headers instanceof mc?D=m.headers:D=new mc(m.headers);let z;m.params&&(m.params instanceof yd?z=m.params:z=new yd({fromObject:m.params})),y=new a_(c,h,m.body!==void 0?m.body:null,{headers:D,context:m.context,params:z,reportProgress:m.reportProgress,responseType:m.responseType||"json",withCredentials:m.withCredentials,transferCache:m.transferCache})}let w=Nt(y).pipe(od(D=>this.handler.handle(D)));if(c instanceof a_||m.observe==="events")return w;let C=w.pipe(zi(D=>D instanceof Zh));switch(m.observe||"body"){case"body":switch(y.responseType){case"arraybuffer":return C.pipe(st(D=>{if(D.body!==null&&!(D.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return D.body}));case"blob":return C.pipe(st(D=>{if(D.body!==null&&!(D.body instanceof Blob))throw new Error("Response is not a Blob.");return D.body}));case"text":return C.pipe(st(D=>{if(D.body!==null&&typeof D.body!="string")throw new Error("Response is not a string.");return D.body}));case"json":default:return C.pipe(st(D=>D.body))}case"response":return C;default:throw new Error(`Unreachable: unhandled observe type ${m.observe}}`)}}delete(c,h={}){return this.request("DELETE",c,h)}get(c,h={}){return this.request("GET",c,h)}head(c,h={}){return this.request("HEAD",c,h)}jsonp(c,h){return this.request("JSONP",c,{params:new yd().append(h,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(c,h={}){return this.request("OPTIONS",c,h)}patch(c,h,m={}){return this.request("PATCH",c,dS(m,h))}post(c,h,m={}){return this.request("POST",c,dS(m,h))}put(c,h,m={}){return this.request("PUT",c,dS(m,h))}};r.\u0275fac=function(h){return new(h||r)(Ct(l_))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),ote=/^\)\]\}',?\n/,ste="X-Request-URL";function Hj(i){if(i.url)return i.url;let r=ste.toLocaleLowerCase();return i.headers.get(r)}var hS=(()=>{let r=class r{constructor(){this.fetchImpl=Ee(mS,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Ee(oi)}handle(c){return new un(h=>{let m=new AbortController;return this.doRequest(c,m.signal,h).then(gS,y=>h.error(new _d({error:y}))),()=>m.abort()})}doRequest(c,h,m){return s0(this,null,function*(){let y=this.createRequestInit(c),w;try{let he=this.fetchImpl(c.urlWithParams,Lt({signal:h},y));ate(he),m.next({type:vd.Sent}),w=yield he}catch(he){m.error(new _d({error:he,status:he.status??0,statusText:he.statusText,url:c.urlWithParams,headers:he.headers}));return}let C=new mc(w.headers),D=w.statusText,z=Hj(w)??c.urlWithParams,j=w.status,ie=null;if(c.reportProgress&&m.next(new pb({headers:C,status:j,statusText:D,url:z})),w.body){let he=w.headers.get("content-length"),ke=[],rt=w.body.getReader(),Ve=0,Ot,hn,Qt=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>s0(this,null,function*(){for(;;){let{done:Kn,value:X}=yield rt.read();if(Kn)break;if(ke.push(X),Ve+=X.length,c.reportProgress){hn=c.responseType==="text"?(hn??"")+(Ot??=new TextDecoder).decode(X,{stream:!0}):void 0;let Rt=()=>m.next({type:vd.DownloadProgress,total:he?+he:void 0,loaded:Ve,partialText:hn});Qt?Qt.run(Rt):Rt()}}}));let Wn=this.concatChunks(ke,Ve);try{let Kn=w.headers.get("Content-Type")??"";ie=this.parseBody(c,Wn,Kn)}catch(Kn){m.error(new _d({error:Kn,headers:new mc(w.headers),status:w.status,statusText:w.statusText,url:Hj(w)??c.urlWithParams}));return}}j===0&&(j=ie?d_.Ok:0),j>=200&&j<300?(m.next(new Zh({body:ie,headers:C,status:j,statusText:D,url:z})),m.complete()):m.error(new _d({error:ie,headers:C,status:j,statusText:D,url:z}))})}parseBody(c,h,m){switch(c.responseType){case"json":let y=new TextDecoder().decode(h).replace(ote,"");return y===""?null:JSON.parse(y);case"text":return new TextDecoder().decode(h);case"blob":return new Blob([h],{type:m});case"arraybuffer":return h.buffer}}createRequestInit(c){let h={},m=c.withCredentials?"include":void 0;if(c.headers.forEach((y,w)=>h[y]=w.join(",")),h.Accept??="application/json, text/plain, */*",!h["Content-Type"]){let y=c.detectContentTypeHeader();y!==null&&(h["Content-Type"]=y)}return{body:c.serializeBody(),method:c.method,headers:h,credentials:m}}concatChunks(c,h){let m=new Uint8Array(h),y=0;for(let w of c)m.set(w,y),y+=w.length;return m}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),mS=class{};function gS(){}function ate(i){i.then(gS,gS)}function eV(i,r){return r(i)}function lte(i,r){return(a,c)=>r.intercept(a,{handle:h=>i(h,c)})}function cte(i,r,a){return(c,h)=>uu(a,()=>r(c,m=>i(m,h)))}var ute=new ot(""),yS=new ot(""),tV=new ot(""),nV=new ot("");function dte(){let i=null;return(r,a)=>{i===null&&(i=(Ee(ute,{optional:!0})??[]).reduceRight(lte,eV));let c=Ee(jh),h=c.add();return i(r,a).pipe(Qc(()=>c.remove(h)))}}var Gj=(()=>{let r=class r extends l_{constructor(c,h){super(),this.backend=c,this.injector=h,this.chain=null,this.pendingTasks=Ee(jh);let m=Ee(nV,{optional:!0});this.backend=m??c}handle(c){if(this.chain===null){let m=Array.from(new Set([...this.injector.get(yS),...this.injector.get(tV,[])]));this.chain=m.reduceRight((y,w)=>cte(y,w,this.injector),eV)}let h=this.pendingTasks.add();return this.chain(c,m=>this.backend.handle(m)).pipe(Qc(()=>this.pendingTasks.remove(h)))}};r.\u0275fac=function(h){return new(h||r)(Ct(c_),Ct(ta))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})();var hte=/^\)\]\}',?\n/;function fte(i){return"responseURL"in i&&i.responseURL?i.responseURL:/^X-Request-URL:/m.test(i.getAllResponseHeaders())?i.getResponseHeader("X-Request-URL"):null}var Wj=(()=>{let r=class r{constructor(c){this.xhrFactory=c}handle(c){if(c.method==="JSONP")throw new mt(-2800,!1);let h=this.xhrFactory;return(h.\u0275loadImpl?vr(h.\u0275loadImpl()):Nt(null)).pipe(Fi(()=>new un(y=>{let w=h.build();if(w.open(c.method,c.urlWithParams),c.withCredentials&&(w.withCredentials=!0),c.headers.forEach((rt,Ve)=>w.setRequestHeader(rt,Ve.join(","))),c.headers.has("Accept")||w.setRequestHeader("Accept","application/json, text/plain, */*"),!c.headers.has("Content-Type")){let rt=c.detectContentTypeHeader();rt!==null&&w.setRequestHeader("Content-Type",rt)}if(c.responseType){let rt=c.responseType.toLowerCase();w.responseType=rt!=="json"?rt:"text"}let C=c.serializeBody(),D=null,z=()=>{if(D!==null)return D;let rt=w.statusText||"OK",Ve=new mc(w.getAllResponseHeaders()),Ot=fte(w)||c.url;return D=new pb({headers:Ve,status:w.status,statusText:rt,url:Ot}),D},j=()=>{let{headers:rt,status:Ve,statusText:Ot,url:hn}=z(),Qt=null;Ve!==d_.NoContent&&(Qt=typeof w.response>"u"?w.responseText:w.response),Ve===0&&(Ve=Qt?d_.Ok:0);let Wn=Ve>=200&&Ve<300;if(c.responseType==="json"&&typeof Qt=="string"){let Kn=Qt;Qt=Qt.replace(hte,"");try{Qt=Qt!==""?JSON.parse(Qt):null}catch(X){Qt=Kn,Wn&&(Wn=!1,Qt={error:X,text:Qt})}}Wn?(y.next(new Zh({body:Qt,headers:rt,status:Ve,statusText:Ot,url:hn||void 0})),y.complete()):y.error(new _d({error:Qt,headers:rt,status:Ve,statusText:Ot,url:hn||void 0}))},ie=rt=>{let{url:Ve}=z(),Ot=new _d({error:rt,status:w.status||0,statusText:w.statusText||"Unknown Error",url:Ve||void 0});y.error(Ot)},oe=!1,he=rt=>{oe||(y.next(z()),oe=!0);let Ve={type:vd.DownloadProgress,loaded:rt.loaded};rt.lengthComputable&&(Ve.total=rt.total),c.responseType==="text"&&w.responseText&&(Ve.partialText=w.responseText),y.next(Ve)},ke=rt=>{let Ve={type:vd.UploadProgress,loaded:rt.loaded};rt.lengthComputable&&(Ve.total=rt.total),y.next(Ve)};return w.addEventListener("load",j),w.addEventListener("error",ie),w.addEventListener("timeout",ie),w.addEventListener("abort",ie),c.reportProgress&&(w.addEventListener("progress",he),C!==null&&w.upload&&w.upload.addEventListener("progress",ke)),w.send(C),y.next({type:vd.Sent}),()=>{w.removeEventListener("error",ie),w.removeEventListener("abort",ie),w.removeEventListener("load",j),w.removeEventListener("timeout",ie),c.reportProgress&&(w.removeEventListener("progress",he),C!==null&&w.upload&&w.upload.removeEventListener("progress",ke)),w.readyState!==w.DONE&&w.abort()}})))}};r.\u0275fac=function(h){return new(h||r)(Ct(Hp))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),iV=new ot(""),pte="XSRF-TOKEN",mte=new ot("",{providedIn:"root",factory:()=>pte}),gte="X-XSRF-TOKEN",_te=new ot("",{providedIn:"root",factory:()=>gte}),mb=class{},yte=(()=>{let r=class r{constructor(c,h,m){this.doc=c,this.platform=h,this.cookieName=m,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let c=this.doc.cookie||"";return c!==this.lastCookieString&&(this.parseCount++,this.lastToken=ub(c,this.cookieName),this.lastCookieString=c),this.lastToken}};r.\u0275fac=function(h){return new(h||r)(Ct(jn),Ct(vs),Ct(mte))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})();function vte(i,r){let a=i.url.toLowerCase();if(!Ee(iV)||i.method==="GET"||i.method==="HEAD"||a.startsWith("http://")||a.startsWith("https://"))return r(i);let c=Ee(mb).getToken(),h=Ee(_te);return c!=null&&!i.headers.has(h)&&(i=i.clone({headers:i.headers.set(h,c)})),r(i)}var vS=function(i){return i[i.Interceptors=0]="Interceptors",i[i.LegacyInterceptors=1]="LegacyInterceptors",i[i.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",i[i.NoXsrfProtection=3]="NoXsrfProtection",i[i.JsonpSupport=4]="JsonpSupport",i[i.RequestsMadeViaParent=5]="RequestsMadeViaParent",i[i.Fetch=6]="Fetch",i}(vS||{});function rV(i,r){return{\u0275kind:i,\u0275providers:r}}function xS(...i){let r=[_S,Wj,Gj,{provide:l_,useExisting:Gj},{provide:c_,useExisting:Wj},{provide:yS,useValue:vte,multi:!0},{provide:iV,useValue:!0},{provide:mb,useClass:yte}];for(let a of i)r.push(...a.\u0275providers);return hd(r)}var qj=new ot("");function xte(){return rV(vS.LegacyInterceptors,[{provide:qj,useFactory:dte},{provide:yS,useExisting:qj,multi:!0}])}function oV(){return rV(vS.Fetch,[hS,{provide:c_,useExisting:hS},{provide:nV,useExisting:hS}])}var sV=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275mod=wt({type:r}),r.\u0275inj=bt({providers:[xS(xte())]});let i=r;return i})();var Zj="b",Yj="h",Xj="s",Kj="st",Jj="u",Qj="rt",fb=new ot(""),bte=["GET","HEAD"];function wte(i,r){let z=Ee(fb),{isCacheActive:a}=z,c=hp(z,["isCacheActive"]),{transferCache:h,method:m}=i;if(!a||m==="POST"&&!c.includePostRequests&&!h||m!=="POST"&&!bte.includes(m)||h===!1||c.filter?.(i)===!1)return r(i);let y=Ee(zh),w=Ete(i),C=y.get(w,null),D=c.includeHeaders;if(typeof h=="object"&&h.includeHeaders&&(D=h.includeHeaders),C){let{[Zj]:j,[Qj]:ie,[Yj]:oe,[Xj]:he,[Kj]:ke,[Jj]:rt}=C,Ve=j;switch(ie){case"arraybuffer":Ve=new TextEncoder().encode(j).buffer;break;case"blob":Ve=new Blob([j]);break}let Ot=new mc(oe);return Nt(new Zh({body:Ve,headers:Ot,status:he,statusText:ke,url:rt}))}return r(i).pipe(Vr(j=>{j instanceof Zh&&y.set(w,{[Zj]:j.body,[Yj]:Tte(j.headers,D),[Xj]:j.status,[Kj]:j.statusText,[Jj]:j.url||"",[Qj]:i.responseType})}))}function Tte(i,r){if(!r)return{};let a={};for(let c of r){let h=i.getAll(c);h!==null&&(a[c]=h)}return a}function Ete(i){let{params:r,method:a,responseType:c,url:h}=i,m=r.keys().sort().map(C=>`${C}=${r.getAll(C)}`).join("&"),y=a+"."+c+"."+h+"?"+m,w=Mte(y);return w}function Mte(i){let r=0;for(let a of i)r=Math.imul(31,r)+a.charCodeAt(0)<<0;return r+=2147483648,r.toString()}function aV(i){return[{provide:fb,useFactory:()=>(Bh("NgHttpTransferCache"),Lt({isCacheActive:!0},i))},{provide:tV,useValue:wte,multi:!0,deps:[zh,fb]},{provide:$p,multi:!0,useFactory:()=>{let r=Ee(gd),a=Ee(fb);return()=>{tS(r).then(()=>{a.isCacheActive=!1})}}}]}var TS=class extends ab{constructor(){super(...arguments),this.supportsDOMEvents=!0}},ES=class i extends TS{static makeCurrent(){Aj(new i)}onAndCancel(r,a,c){return r.addEventListener(a,c),()=>{r.removeEventListener(a,c)}}dispatchEvent(r,a){r.dispatchEvent(a)}remove(r){r.parentNode&&r.parentNode.removeChild(r)}createElement(r,a){return a=a||this.getDefaultDocument(),a.createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,a){return a==="window"?window:a==="document"?r:a==="body"?r.body:null}getBaseHref(r){let a=Ite();return a==null?null:Cte(a)}resetBaseElement(){h_=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return ub(document.cookie,r)}},h_=null;function Ite(){return h_=h_||document.querySelector("base"),h_?h_.getAttribute("href"):null}function Cte(i){return new URL(i,document.baseURI).pathname}var Ste=(()=>{let r=class r{build(){return new XMLHttpRequest}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),Wp=new ot(""),uV=(()=>{let r=class r{constructor(c,h){this._zone=h,this._eventNameToPlugin=new Map,c.forEach(m=>{m.manager=this}),this._plugins=c.slice().reverse()}addEventListener(c,h,m){return this._findPluginFor(h).addEventListener(c,h,m)}getZone(){return this._zone}_findPluginFor(c){let h=this._eventNameToPlugin.get(c);if(h)return h;if(h=this._plugins.find(y=>y.supports(c)),!h)throw new mt(5101,!1);return this._eventNameToPlugin.set(c,h),h}};r.\u0275fac=function(h){return new(h||r)(Ct(Wp),Ct(oi))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),gb=class{constructor(r){this._doc=r}},bS="ng-app-id",dV=(()=>{let r=class r{constructor(c,h,m,y={}){this.doc=c,this.appId=h,this.nonce=m,this.platformId=y,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=qh(y),this.resetHostNodes()}addStyles(c){for(let h of c)this.changeUsageCount(h,1)===1&&this.onStyleAdded(h)}removeStyles(c){for(let h of c)this.changeUsageCount(h,-1)<=0&&this.onStyleRemoved(h)}ngOnDestroy(){let c=this.styleNodesInDOM;c&&(c.forEach(h=>h.remove()),c.clear());for(let h of this.getAllStyles())this.onStyleRemoved(h);this.resetHostNodes()}addHost(c){this.hostNodes.add(c);for(let h of this.getAllStyles())this.addStyleToHost(c,h)}removeHost(c){this.hostNodes.delete(c)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(c){for(let h of this.hostNodes)this.addStyleToHost(h,c)}onStyleRemoved(c){let h=this.styleRef;h.get(c)?.elements?.forEach(m=>m.remove()),h.delete(c)}collectServerRenderedStyles(){let c=this.doc.head?.querySelectorAll(`style[${bS}="${this.appId}"]`);if(c?.length){let h=new Map;return c.forEach(m=>{m.textContent!=null&&h.set(m.textContent,m)}),h}return null}changeUsageCount(c,h){let m=this.styleRef;if(m.has(c)){let y=m.get(c);return y.usage+=h,y.usage}return m.set(c,{usage:h,elements:[]}),h}getStyleElement(c,h){let m=this.styleNodesInDOM,y=m?.get(h);if(y?.parentNode===c)return m.delete(h),y.removeAttribute(bS),y;{let w=this.doc.createElement("style");return this.nonce&&w.setAttribute("nonce",this.nonce),w.textContent=h,this.platformIsServer&&w.setAttribute(bS,this.appId),c.appendChild(w),w}}addStyleToHost(c,h){let m=this.getStyleElement(c,h),y=this.styleRef,w=y.get(h)?.elements;w?w.push(m):y.set(h,{elements:[m],usage:1})}resetHostNodes(){let c=this.hostNodes;c.clear(),c.add(this.doc.head)}};r.\u0275fac=function(h){return new(h||r)(Ct(jn),Ct(Px),Ct(MC,8),Ct(vs))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),wS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},CS=/%COMP%/g,hV="%COMP%",Dte=`_nghost-${hV}`,Ate=`_ngcontent-${hV}`,Pte=!0,Ote=new ot("",{providedIn:"root",factory:()=>Pte});function Rte(i){return Ate.replace(CS,i)}function Lte(i){return Dte.replace(CS,i)}function fV(i,r){return r.map(a=>a.replace(CS,i))}var _b=(()=>{let r=class r{constructor(c,h,m,y,w,C,D,z=null){this.eventManager=c,this.sharedStylesHost=h,this.appId=m,this.removeStylesOnCompDestroy=y,this.doc=w,this.platformId=C,this.ngZone=D,this.nonce=z,this.rendererByCompId=new Map,this.platformIsServer=qh(C),this.defaultRenderer=new f_(c,w,D,this.platformIsServer)}createRenderer(c,h){if(!c||!h)return this.defaultRenderer;this.platformIsServer&&h.encapsulation===fc.ShadowDom&&(h=Er(Lt({},h),{encapsulation:fc.Emulated}));let m=this.getOrCreateRenderer(c,h);return m instanceof yb?m.applyToHost(c):m instanceof p_&&m.applyStyles(),m}getOrCreateRenderer(c,h){let m=this.rendererByCompId,y=m.get(h.id);if(!y){let w=this.doc,C=this.ngZone,D=this.eventManager,z=this.sharedStylesHost,j=this.removeStylesOnCompDestroy,ie=this.platformIsServer;switch(h.encapsulation){case fc.Emulated:y=new yb(D,z,h,this.appId,j,w,C,ie);break;case fc.ShadowDom:return new MS(D,z,c,h,w,C,this.nonce,ie);default:y=new p_(D,z,h,j,w,C,ie);break}m.set(h.id,y)}return y}ngOnDestroy(){this.rendererByCompId.clear()}};r.\u0275fac=function(h){return new(h||r)(Ct(uV),Ct(dV),Ct(Px),Ct(Ote),Ct(jn),Ct(vs),Ct(oi),Ct(MC))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),f_=class{constructor(r,a,c,h){this.eventManager=r,this.doc=a,this.ngZone=c,this.platformIsServer=h,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(r,a){return a?this.doc.createElementNS(wS[a]||a,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,a){(lV(r)?r.content:r).appendChild(a)}insertBefore(r,a,c){r&&(lV(r)?r.content:r).insertBefore(a,c)}removeChild(r,a){r&&r.removeChild(a)}selectRootElement(r,a){let c=typeof r=="string"?this.doc.querySelector(r):r;if(!c)throw new mt(-5104,!1);return a||(c.textContent=""),c}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,a,c,h){if(h){a=h+":"+a;let m=wS[h];m?r.setAttributeNS(m,a,c):r.setAttribute(a,c)}else r.setAttribute(a,c)}removeAttribute(r,a,c){if(c){let h=wS[c];h?r.removeAttributeNS(h,a):r.removeAttribute(`${c}:${a}`)}else r.removeAttribute(a)}addClass(r,a){r.classList.add(a)}removeClass(r,a){r.classList.remove(a)}setStyle(r,a,c,h){h&(ru.DashCase|ru.Important)?r.style.setProperty(a,c,h&ru.Important?"important":""):r.style[a]=c}removeStyle(r,a,c){c&ru.DashCase?r.style.removeProperty(a):r.style[a]=""}setProperty(r,a,c){r!=null&&(r[a]=c)}setValue(r,a){r.nodeValue=a}listen(r,a,c){if(typeof r=="string"&&(r=vu().getGlobalEventTarget(this.doc,r),!r))throw new Error(`Unsupported event target ${r} for event ${a}`);return this.eventManager.addEventListener(r,a,this.decoratePreventDefault(c))}decoratePreventDefault(r){return a=>{if(a==="__ngUnwrap__")return r;(this.platformIsServer?this.ngZone.runGuarded(()=>r(a)):r(a))===!1&&a.preventDefault()}}};function lV(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var MS=class extends f_{constructor(r,a,c,h,m,y,w,C){super(r,m,y,C),this.sharedStylesHost=a,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let D=fV(h.id,h.styles);for(let z of D){let j=document.createElement("style");w&&j.setAttribute("nonce",w),j.textContent=z,this.shadowRoot.appendChild(j)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,a){return super.appendChild(this.nodeOrShadowRoot(r),a)}insertBefore(r,a,c){return super.insertBefore(this.nodeOrShadowRoot(r),a,c)}removeChild(r,a){return super.removeChild(this.nodeOrShadowRoot(r),a)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},p_=class extends f_{constructor(r,a,c,h,m,y,w,C){super(r,m,y,w),this.sharedStylesHost=a,this.removeStylesOnCompDestroy=h,this.styles=C?fV(C,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},yb=class extends p_{constructor(r,a,c,h,m,y,w,C){let D=h+"-"+c.id;super(r,a,c,m,y,w,C,D),this.contentAttr=Rte(D),this.hostAttr=Lte(D)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,a){let c=super.createElement(r,a);return super.setAttribute(c,this.contentAttr,""),c}},Fte=(()=>{let r=class r extends gb{constructor(c){super(c)}supports(c){return!0}addEventListener(c,h,m){return c.addEventListener(h,m,!1),()=>this.removeEventListener(c,h,m)}removeEventListener(c,h,m){return c.removeEventListener(h,m)}};r.\u0275fac=function(h){return new(h||r)(Ct(jn))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),cV=["alt","control","meta","shift"],kte={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Nte={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},zte=(()=>{let r=class r extends gb{constructor(c){super(c)}supports(c){return r.parseEventName(c)!=null}addEventListener(c,h,m){let y=r.parseEventName(h),w=r.eventCallback(y.fullKey,m,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>vu().onAndCancel(c,y.domEventName,w))}static parseEventName(c){let h=c.toLowerCase().split("."),m=h.shift();if(h.length===0||!(m==="keydown"||m==="keyup"))return null;let y=r._normalizeKey(h.pop()),w="",C=h.indexOf("code");if(C>-1&&(h.splice(C,1),w="code."),cV.forEach(z=>{let j=h.indexOf(z);j>-1&&(h.splice(j,1),w+=z+".")}),w+=y,h.length!=0||y.length===0)return null;let D={};return D.domEventName=m,D.fullKey=w,D}static matchEventFullKeyCode(c,h){let m=kte[c.key]||c.key,y="";return h.indexOf("code.")>-1&&(m=c.code,y="code."),m==null||!m?!1:(m=m.toLowerCase(),m===" "?m="space":m==="."&&(m="dot"),cV.forEach(w=>{if(w!==m){let C=Nte[w];C(c)&&(y+=w+".")}}),y+=m,y===h)}static eventCallback(c,h,m){return y=>{r.matchEventFullKeyCode(y,c)&&m.runGuarded(()=>h(y))}}static _normalizeKey(c){return c==="esc"?"escape":c}};r.\u0275fac=function(h){return new(h||r)(Ct(jn))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})();function pV(i,r){return bj(Lt({rootComponent:i},Bte(r)))}function Bte(i){return{appProviders:[...Hte,...i?.providers??[]],platformProviders:$te}}function jte(){ES.makeCurrent()}function Vte(){return new au}function Ute(){return kz(document),document}var $te=[{provide:vs,useValue:uS},{provide:TC,useValue:jte,multi:!0},{provide:jn,useFactory:Ute,deps:[]}];var Hte=[{provide:Ax,useValue:"root"},{provide:au,useFactory:Vte,deps:[]},{provide:Wp,useClass:Fte,multi:!0,deps:[jn,oi,vs]},{provide:Wp,useClass:zte,multi:!0,deps:[jn]},_b,dV,uV,{provide:su,useExisting:_b},{provide:Hp,useClass:Ste,deps:[]},[]];var vb=(()=>{let r=class r{constructor(c){this._doc=c}getTitle(){return this._doc.title}setTitle(c){this._doc.title=c||""}};r.\u0275fac=function(h){return new(h||r)(Ct(jn))},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var m_=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:function(h){let m=null;return h?m=new(h||r):m=Ct(Gte),m},providedIn:"root"});let i=r;return i})(),Gte=(()=>{let r=class r extends m_{constructor(c){super(),this._doc=c}sanitize(c,h){if(h==null)return null;switch(c){case Xo.NONE:return h;case Xo.HTML:return du(h,"HTML")?Dl(h):AC(this._doc,String(h)).toString();case Xo.STYLE:return du(h,"Style")?Dl(h):h;case Xo.SCRIPT:if(du(h,"Script"))return Dl(h);throw new mt(5200,!1);case Xo.URL:return du(h,"URL")?Dl(h):Nx(String(h));case Xo.RESOURCE_URL:if(du(h,"ResourceURL"))return Dl(h);throw new mt(5201,!1);default:throw new mt(5202,!1)}}bypassSecurityTrustHtml(c){return tB(c)}bypassSecurityTrustStyle(c){return nB(c)}bypassSecurityTrustScript(c){return iB(c)}bypassSecurityTrustUrl(c){return rB(c)}bypassSecurityTrustResourceUrl(c){return oB(c)}};r.\u0275fac=function(h){return new(h||r)(Ct(jn))},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})(),IS=function(i){return i[i.NoHttpTransferCache=0]="NoHttpTransferCache",i[i.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",i}(IS||{});function mV(...i){let r=[],a=new Set,c=a.has(IS.HttpTransferCacheOptions);for(let{\u0275providers:h,\u0275kind:m}of i)a.add(m),h.length&&r.push(h);return hd([[],wj(),a.has(IS.NoHttpTransferCache)||c?[]:aV({}),r])}var Jn=function(i){return i[i.State=0]="State",i[i.Transition=1]="Transition",i[i.Sequence=2]="Sequence",i[i.Group=3]="Group",i[i.Animate=4]="Animate",i[i.Keyframes=5]="Keyframes",i[i.Style=6]="Style",i[i.Trigger=7]="Trigger",i[i.Reference=8]="Reference",i[i.AnimateChild=9]="AnimateChild",i[i.AnimateRef=10]="AnimateRef",i[i.Query=11]="Query",i[i.Stagger=12]="Stagger",i}(Jn||{}),gc="*";function Nr(i,r){return{type:Jn.Trigger,name:i,definitions:r,options:{}}}function Vn(i,r=null){return{type:Jn.Animate,styles:r,timings:i}}function gV(i,r=null){return{type:Jn.Sequence,steps:i,options:r}}function dt(i){return{type:Jn.Style,styles:i,offset:null}}function ni(i,r,a=null){return{type:Jn.Transition,expr:i,animation:r,options:a}}function __(i=null){return{type:Jn.AnimateChild,options:i}}function xo(i,r,a=null){return{type:Jn.Query,selector:i,animation:r,options:a}}function ls(i,r){return{type:Jn.Stagger,timings:i,animation:r}}var xd=class{constructor(r=0,a=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=r+a}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(r=>r()),this._onDoneFns=[])}onStart(r){this._originalOnStartFns.push(r),this._onStartFns.push(r)}onDone(r){this._originalOnDoneFns.push(r),this._onDoneFns.push(r)}onDestroy(r){this._onDestroyFns.push(r)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(r=>r()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(r=>r()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(r){this._position=this.totalTime?r*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(r){let a=r=="start"?this._onStartFns:this._onDoneFns;a.forEach(c=>c()),a.length=0}},g_=class{constructor(r){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=r;let a=0,c=0,h=0,m=this.players.length;m==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(y=>{y.onDone(()=>{++a==m&&this._onFinish()}),y.onDestroy(()=>{++c==m&&this._onDestroy()}),y.onStart(()=>{++h==m&&this._onStart()})}),this.totalTime=this.players.reduce((y,w)=>Math.max(y,w.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(r=>r()),this._onDoneFns=[])}init(){this.players.forEach(r=>r.init())}onStart(r){this._onStartFns.push(r)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(r=>r()),this._onStartFns=[])}onDone(r){this._onDoneFns.push(r)}onDestroy(r){this._onDestroyFns.push(r)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(r=>r.play())}pause(){this.players.forEach(r=>r.pause())}restart(){this.players.forEach(r=>r.restart())}finish(){this._onFinish(),this.players.forEach(r=>r.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(r=>r.destroy()),this._onDestroyFns.forEach(r=>r()),this._onDestroyFns=[])}reset(){this.players.forEach(r=>r.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(r){let a=r*this.totalTime;this.players.forEach(c=>{let h=c.totalTime?Math.min(1,a/c.totalTime):1;c.setPosition(h)})}getPosition(){let r=this.players.reduce((a,c)=>a===null||c.totalTime>a.totalTime?c:a,null);return r!=null?r.getPosition():0}beforeDestroy(){this.players.forEach(r=>{r.beforeDestroy&&r.beforeDestroy()})}triggerCallback(r){let a=r=="start"?this._onStartFns:this._onDoneFns;a.forEach(c=>c()),a.length=0}},xb="!";function _V(i){return new mt(3e3,!1)}function qte(){return new mt(3100,!1)}function Zte(){return new mt(3101,!1)}function Yte(i){return new mt(3001,!1)}function Xte(i){return new mt(3003,!1)}function Kte(i){return new mt(3004,!1)}function Jte(i,r){return new mt(3005,!1)}function Qte(){return new mt(3006,!1)}function ene(){return new mt(3007,!1)}function tne(i,r){return new mt(3008,!1)}function nne(i){return new mt(3002,!1)}function ine(i,r,a,c,h){return new mt(3010,!1)}function rne(){return new mt(3011,!1)}function one(){return new mt(3012,!1)}function sne(){return new mt(3200,!1)}function ane(){return new mt(3202,!1)}function lne(){return new mt(3013,!1)}function cne(i){return new mt(3014,!1)}function une(i){return new mt(3015,!1)}function dne(i){return new mt(3016,!1)}function hne(i,r){return new mt(3404,!1)}function fne(i){return new mt(3502,!1)}function pne(i){return new mt(3503,!1)}function mne(){return new mt(3300,!1)}function gne(i){return new mt(3504,!1)}function _ne(i){return new mt(3301,!1)}function yne(i,r){return new mt(3302,!1)}function vne(i){return new mt(3303,!1)}function xne(i,r){return new mt(3400,!1)}function bne(i){return new mt(3401,!1)}function wne(i){return new mt(3402,!1)}function Tne(i,r){return new mt(3505,!1)}function bd(i){switch(i.length){case 0:return new xd;case 1:return i[0];default:return new g_(i)}}function PV(i,r,a=new Map,c=new Map){let h=[],m=[],y=-1,w=null;if(r.forEach(C=>{let D=C.get("offset"),z=D==y,j=z&&w||new Map;C.forEach((ie,oe)=>{let he=oe,ke=ie;if(oe!=="offset")switch(he=i.normalizePropertyName(he,h),ke){case xb:ke=a.get(oe);break;case gc:ke=c.get(oe);break;default:ke=i.normalizeStyleValue(oe,he,ke,h);break}j.set(he,ke)}),z||m.push(j),w=j,y=D}),h.length)throw fne(h);return m}function XS(i,r,a,c){switch(r){case"start":i.onStart(()=>c(a&&SS(a,"start",i)));break;case"done":i.onDone(()=>c(a&&SS(a,"done",i)));break;case"destroy":i.onDestroy(()=>c(a&&SS(a,"destroy",i)));break}}function SS(i,r,a){let c=a.totalTime,h=!!a.disabled,m=KS(i.element,i.triggerName,i.fromState,i.toState,r||i.phaseName,c??i.totalTime,h),y=i._data;return y!=null&&(m._data=y),m}function KS(i,r,a,c,h="",m=0,y){return{element:i,triggerName:r,fromState:a,toState:c,phaseName:h,totalTime:m,disabled:!!y}}function Ca(i,r,a){let c=i.get(r);return c||i.set(r,c=a),c}function yV(i){let r=i.indexOf(":"),a=i.substring(1,r),c=i.slice(r+1);return[a,c]}var Ene=typeof document>"u"?null:document.documentElement;function JS(i){let r=i.parentNode||i.host||null;return r===Ene?null:r}function Mne(i){return i.substring(1,6)=="ebkit"}var Yh=null,vV=!1;function Ine(i){Yh||(Yh=Cne()||{},vV=Yh.style?"WebkitAppearance"in Yh.style:!1);let r=!0;return Yh.style&&!Mne(i)&&(r=i in Yh.style,!r&&vV&&(r="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in Yh.style)),r}function Cne(){return typeof document<"u"?document.body:null}function OV(i,r){for(;r;){if(r===i)return!0;r=JS(r)}return!1}function RV(i,r,a){if(a)return Array.from(i.querySelectorAll(r));let c=i.querySelector(r);return c?[c]:[]}var QS=(()=>{let r=class r{validateStyleProperty(c){return Ine(c)}matchesElement(c,h){return!1}containsElement(c,h){return OV(c,h)}getParentElement(c){return JS(c)}query(c,h,m){return RV(c,h,m)}computeStyle(c,h,m){return m||""}animate(c,h,m,y,w,C=[],D){return new xd(m,y)}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})(),iD=class iD{};iD.NOOP=new QS;var Jh=iD,Qh=class{};var Sne=1e3,LV="{{",Dne="}}",FV="ng-enter",LS="ng-leave",bb="ng-trigger",Ib=".ng-trigger",xV="ng-animating",FS=".ng-animating";function xu(i){if(typeof i=="number")return i;let r=i.match(/^(-?[\.\d]+)(m?s)/);return!r||r.length<2?0:kS(parseFloat(r[1]),r[2])}function kS(i,r){switch(r){case"s":return i*Sne;default:return i}}function Cb(i,r,a){return i.hasOwnProperty("duration")?i:Ane(i,r,a)}function Ane(i,r,a){let c=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,h,m=0,y="";if(typeof i=="string"){let w=i.match(c);if(w===null)return r.push(_V(i)),{duration:0,delay:0,easing:""};h=kS(parseFloat(w[1]),w[2]);let C=w[3];C!=null&&(m=kS(parseFloat(C),w[4]));let D=w[5];D&&(y=D)}else h=i;if(!a){let w=!1,C=r.length;h<0&&(r.push(qte()),w=!0),m<0&&(r.push(Zte()),w=!0),w&&r.splice(C,0,_V(i))}return{duration:h,delay:m,easing:y}}function Pne(i){return i.length?i[0]instanceof Map?i:i.map(r=>new Map(Object.entries(r))):[]}function _c(i,r,a){r.forEach((c,h)=>{let m=eD(h);a&&!a.has(h)&&a.set(h,i.style[m]),i.style[m]=c})}function Kh(i,r){r.forEach((a,c)=>{let h=eD(c);i.style[h]=""})}function y_(i){return Array.isArray(i)?i.length==1?i[0]:gV(i):i}function One(i,r,a){let c=r.params||{},h=kV(i);h.length&&h.forEach(m=>{c.hasOwnProperty(m)||a.push(Yte(m))})}var NS=new RegExp(`${LV}\\s*(.+?)\\s*${Dne}`,"g");function kV(i){let r=[];if(typeof i=="string"){let a;for(;a=NS.exec(i);)r.push(a[1]);NS.lastIndex=0}return r}function x_(i,r,a){let c=`${i}`,h=c.replace(NS,(m,y)=>{let w=r[y];return w==null&&(a.push(Xte(y)),w=""),w.toString()});return h==c?i:h}var Rne=/-+([a-z0-9])/g;function eD(i){return i.replace(Rne,(...r)=>r[1].toUpperCase())}function Lne(i,r){return i===0||r===0}function Fne(i,r,a){if(a.size&&r.length){let c=r[0],h=[];if(a.forEach((m,y)=>{c.has(y)||h.push(y),c.set(y,m)}),h.length)for(let m=1;m<r.length;m++){let y=r[m];h.forEach(w=>y.set(w,tD(i,w)))}}return r}function Ia(i,r,a){switch(r.type){case Jn.Trigger:return i.visitTrigger(r,a);case Jn.State:return i.visitState(r,a);case Jn.Transition:return i.visitTransition(r,a);case Jn.Sequence:return i.visitSequence(r,a);case Jn.Group:return i.visitGroup(r,a);case Jn.Animate:return i.visitAnimate(r,a);case Jn.Keyframes:return i.visitKeyframes(r,a);case Jn.Style:return i.visitStyle(r,a);case Jn.Reference:return i.visitReference(r,a);case Jn.AnimateChild:return i.visitAnimateChild(r,a);case Jn.AnimateRef:return i.visitAnimateRef(r,a);case Jn.Query:return i.visitQuery(r,a);case Jn.Stagger:return i.visitStagger(r,a);default:throw Kte(r.type)}}function tD(i,r){return window.getComputedStyle(i)[r]}var kne=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Sb=class extends Qh{normalizePropertyName(r,a){return eD(r)}normalizeStyleValue(r,a,c,h){let m="",y=c.toString().trim();if(kne.has(a)&&c!==0&&c!=="0")if(typeof c=="number")m="px";else{let w=c.match(/^[+-]?[\d\.]+([a-z]*)$/);w&&w[1].length==0&&h.push(Jte(r,c))}return y+m}};var Db="*";function Nne(i,r){let a=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(c=>zne(c,a,r)):a.push(i),a}function zne(i,r,a){if(i[0]==":"){let C=Bne(i,a);if(typeof C=="function"){r.push(C);return}i=C}let c=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(c==null||c.length<4)return a.push(une(i)),r;let h=c[1],m=c[2],y=c[3];r.push(bV(h,y));let w=h==Db&&y==Db;m[0]=="<"&&!w&&r.push(bV(y,h))}function Bne(i,r){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(a,c)=>parseFloat(c)>parseFloat(a);case":decrement":return(a,c)=>parseFloat(c)<parseFloat(a);default:return r.push(dne(i)),"* => *"}}var wb=new Set(["true","1"]),Tb=new Set(["false","0"]);function bV(i,r){let a=wb.has(i)||Tb.has(i),c=wb.has(r)||Tb.has(r);return(h,m)=>{let y=i==Db||i==h,w=r==Db||r==m;return!y&&a&&typeof h=="boolean"&&(y=h?wb.has(i):Tb.has(i)),!w&&c&&typeof m=="boolean"&&(w=m?wb.has(r):Tb.has(r)),y&&w}}var NV=":self",jne=new RegExp(`s*${NV}s*,?`,"g");function zV(i,r,a,c){return new zS(i).build(r,a,c)}var wV="",zS=class{constructor(r){this._driver=r}build(r,a,c){let h=new BS(a);return this._resetContextStyleTimingState(h),Ia(this,y_(r),h)}_resetContextStyleTimingState(r){r.currentQuerySelector=wV,r.collectedStyles=new Map,r.collectedStyles.set(wV,new Map),r.currentTime=0}visitTrigger(r,a){let c=a.queryCount=0,h=a.depCount=0,m=[],y=[];return r.name.charAt(0)=="@"&&a.errors.push(Qte()),r.definitions.forEach(w=>{if(this._resetContextStyleTimingState(a),w.type==Jn.State){let C=w,D=C.name;D.toString().split(/\s*,\s*/).forEach(z=>{C.name=z,m.push(this.visitState(C,a))}),C.name=D}else if(w.type==Jn.Transition){let C=this.visitTransition(w,a);c+=C.queryCount,h+=C.depCount,y.push(C)}else a.errors.push(ene())}),{type:Jn.Trigger,name:r.name,states:m,transitions:y,queryCount:c,depCount:h,options:null}}visitState(r,a){let c=this.visitStyle(r.styles,a),h=r.options&&r.options.params||null;if(c.containsDynamicStyles){let m=new Set,y=h||{};c.styles.forEach(w=>{w instanceof Map&&w.forEach(C=>{kV(C).forEach(D=>{y.hasOwnProperty(D)||m.add(D)})})}),m.size&&a.errors.push(tne(r.name,[...m.values()]))}return{type:Jn.State,name:r.name,style:c,options:h?{params:h}:null}}visitTransition(r,a){a.queryCount=0,a.depCount=0;let c=Ia(this,y_(r.animation),a),h=Nne(r.expr,a.errors);return{type:Jn.Transition,matchers:h,animation:c,queryCount:a.queryCount,depCount:a.depCount,options:Xh(r.options)}}visitSequence(r,a){return{type:Jn.Sequence,steps:r.steps.map(c=>Ia(this,c,a)),options:Xh(r.options)}}visitGroup(r,a){let c=a.currentTime,h=0,m=r.steps.map(y=>{a.currentTime=c;let w=Ia(this,y,a);return h=Math.max(h,a.currentTime),w});return a.currentTime=h,{type:Jn.Group,steps:m,options:Xh(r.options)}}visitAnimate(r,a){let c=Hne(r.timings,a.errors);a.currentAnimateTimings=c;let h,m=r.styles?r.styles:dt({});if(m.type==Jn.Keyframes)h=this.visitKeyframes(m,a);else{let y=r.styles,w=!1;if(!y){w=!0;let D={};c.easing&&(D.easing=c.easing),y=dt(D)}a.currentTime+=c.duration+c.delay;let C=this.visitStyle(y,a);C.isEmptyStep=w,h=C}return a.currentAnimateTimings=null,{type:Jn.Animate,timings:c,style:h,options:null}}visitStyle(r,a){let c=this._makeStyleAst(r,a);return this._validateStyleAst(c,a),c}_makeStyleAst(r,a){let c=[],h=Array.isArray(r.styles)?r.styles:[r.styles];for(let w of h)typeof w=="string"?w===gc?c.push(w):a.errors.push(nne(w)):c.push(new Map(Object.entries(w)));let m=!1,y=null;return c.forEach(w=>{if(w instanceof Map&&(w.has("easing")&&(y=w.get("easing"),w.delete("easing")),!m)){for(let C of w.values())if(C.toString().indexOf(LV)>=0){m=!0;break}}}),{type:Jn.Style,styles:c,easing:y,offset:r.offset,containsDynamicStyles:m,options:null}}_validateStyleAst(r,a){let c=a.currentAnimateTimings,h=a.currentTime,m=a.currentTime;c&&m>0&&(m-=c.duration+c.delay),r.styles.forEach(y=>{typeof y!="string"&&y.forEach((w,C)=>{let D=a.collectedStyles.get(a.currentQuerySelector),z=D.get(C),j=!0;z&&(m!=h&&m>=z.startTime&&h<=z.endTime&&(a.errors.push(ine(C,z.startTime,z.endTime,m,h)),j=!1),m=z.startTime),j&&D.set(C,{startTime:m,endTime:h}),a.options&&One(w,a.options,a.errors)})})}visitKeyframes(r,a){let c={type:Jn.Keyframes,styles:[],options:null};if(!a.currentAnimateTimings)return a.errors.push(rne()),c;let h=1,m=0,y=[],w=!1,C=!1,D=0,z=r.steps.map(Ve=>{let Ot=this._makeStyleAst(Ve,a),hn=Ot.offset!=null?Ot.offset:$ne(Ot.styles),Qt=0;return hn!=null&&(m++,Qt=Ot.offset=hn),C=C||Qt<0||Qt>1,w=w||Qt<D,D=Qt,y.push(Qt),Ot});C&&a.errors.push(one()),w&&a.errors.push(sne());let j=r.steps.length,ie=0;m>0&&m<j?a.errors.push(ane()):m==0&&(ie=h/(j-1));let oe=j-1,he=a.currentTime,ke=a.currentAnimateTimings,rt=ke.duration;return z.forEach((Ve,Ot)=>{let hn=ie>0?Ot==oe?1:ie*Ot:y[Ot],Qt=hn*rt;a.currentTime=he+ke.delay+Qt,ke.duration=Qt,this._validateStyleAst(Ve,a),Ve.offset=hn,c.styles.push(Ve)}),c}visitReference(r,a){return{type:Jn.Reference,animation:Ia(this,y_(r.animation),a),options:Xh(r.options)}}visitAnimateChild(r,a){return a.depCount++,{type:Jn.AnimateChild,options:Xh(r.options)}}visitAnimateRef(r,a){return{type:Jn.AnimateRef,animation:this.visitReference(r.animation,a),options:Xh(r.options)}}visitQuery(r,a){let c=a.currentQuerySelector,h=r.options||{};a.queryCount++,a.currentQuery=r;let[m,y]=Vne(r.selector);a.currentQuerySelector=c.length?c+" "+m:m,Ca(a.collectedStyles,a.currentQuerySelector,new Map);let w=Ia(this,y_(r.animation),a);return a.currentQuery=null,a.currentQuerySelector=c,{type:Jn.Query,selector:m,limit:h.limit||0,optional:!!h.optional,includeSelf:y,animation:w,originalSelector:r.selector,options:Xh(r.options)}}visitStagger(r,a){a.currentQuery||a.errors.push(lne());let c=r.timings==="full"?{duration:0,delay:0,easing:"full"}:Cb(r.timings,a.errors,!0);return{type:Jn.Stagger,animation:Ia(this,y_(r.animation),a),timings:c,options:null}}};function Vne(i){let r=!!i.split(/\s*,\s*/).find(a=>a==NV);return r&&(i=i.replace(jne,"")),i=i.replace(/@\*/g,Ib).replace(/@\w+/g,a=>Ib+"-"+a.slice(1)).replace(/:animating/g,FS),[i,r]}function Une(i){return i?Lt({},i):null}var BS=class{constructor(r){this.errors=r,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function $ne(i){if(typeof i=="string")return null;let r=null;if(Array.isArray(i))i.forEach(a=>{if(a instanceof Map&&a.has("offset")){let c=a;r=parseFloat(c.get("offset")),c.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let a=i;r=parseFloat(a.get("offset")),a.delete("offset")}return r}function Hne(i,r){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let m=Cb(i,r).duration;return DS(m,0,"")}let a=i;if(a.split(/\s+/).some(m=>m.charAt(0)=="{"&&m.charAt(1)=="{")){let m=DS(0,0,"");return m.dynamic=!0,m.strValue=a,m}let h=Cb(a,r);return DS(h.duration,h.delay,h.easing)}function Xh(i){return i?(i=Lt({},i),i.params&&(i.params=Une(i.params))):i={},i}function DS(i,r,a){return{duration:i,delay:r,easing:a}}function nD(i,r,a,c,h,m,y=null,w=!1){return{type:1,element:i,keyframes:r,preStyleProps:a,postStyleProps:c,duration:h,delay:m,totalTime:h+m,easing:y,subTimeline:w}}var b_=class{constructor(){this._map=new Map}get(r){return this._map.get(r)||[]}append(r,a){let c=this._map.get(r);c||this._map.set(r,c=[]),c.push(...a)}has(r){return this._map.has(r)}clear(){this._map.clear()}},Gne=1,Wne=":enter",qne=new RegExp(Wne,"g"),Zne=":leave",Yne=new RegExp(Zne,"g");function BV(i,r,a,c,h,m=new Map,y=new Map,w,C,D=[]){return new jS().buildKeyframes(i,r,a,c,h,m,y,w,C,D)}var jS=class{buildKeyframes(r,a,c,h,m,y,w,C,D,z=[]){D=D||new b_;let j=new VS(r,a,D,h,m,z,[]);j.options=C;let ie=C.delay?xu(C.delay):0;j.currentTimeline.delayNextStep(ie),j.currentTimeline.setStyles([y],null,j.errors,C),Ia(this,c,j);let oe=j.timelines.filter(he=>he.containsAnimation());if(oe.length&&w.size){let he;for(let ke=oe.length-1;ke>=0;ke--){let rt=oe[ke];if(rt.element===a){he=rt;break}}he&&!he.allowOnlyTimelineStyles()&&he.setStyles([w],null,j.errors,C)}return oe.length?oe.map(he=>he.buildKeyframes()):[nD(a,[],[],[],0,ie,"",!1)]}visitTrigger(r,a){}visitState(r,a){}visitTransition(r,a){}visitAnimateChild(r,a){let c=a.subInstructions.get(a.element);if(c){let h=a.createSubContext(r.options),m=a.currentTimeline.currentTime,y=this._visitSubInstructions(c,h,h.options);m!=y&&a.transformIntoNewTimeline(y)}a.previousNode=r}visitAnimateRef(r,a){let c=a.createSubContext(r.options);c.transformIntoNewTimeline(),this._applyAnimationRefDelays([r.options,r.animation.options],a,c),this.visitReference(r.animation,c),a.transformIntoNewTimeline(c.currentTimeline.currentTime),a.previousNode=r}_applyAnimationRefDelays(r,a,c){for(let h of r){let m=h?.delay;if(m){let y=typeof m=="number"?m:xu(x_(m,h?.params??{},a.errors));c.delayNextStep(y)}}}_visitSubInstructions(r,a,c){let m=a.currentTimeline.currentTime,y=c.duration!=null?xu(c.duration):null,w=c.delay!=null?xu(c.delay):null;return y!==0&&r.forEach(C=>{let D=a.appendInstructionToTimeline(C,y,w);m=Math.max(m,D.duration+D.delay)}),m}visitReference(r,a){a.updateOptions(r.options,!0),Ia(this,r.animation,a),a.previousNode=r}visitSequence(r,a){let c=a.subContextCount,h=a,m=r.options;if(m&&(m.params||m.delay)&&(h=a.createSubContext(m),h.transformIntoNewTimeline(),m.delay!=null)){h.previousNode.type==Jn.Style&&(h.currentTimeline.snapshotCurrentStyles(),h.previousNode=Ab);let y=xu(m.delay);h.delayNextStep(y)}r.steps.length&&(r.steps.forEach(y=>Ia(this,y,h)),h.currentTimeline.applyStylesToKeyframe(),h.subContextCount>c&&h.transformIntoNewTimeline()),a.previousNode=r}visitGroup(r,a){let c=[],h=a.currentTimeline.currentTime,m=r.options&&r.options.delay?xu(r.options.delay):0;r.steps.forEach(y=>{let w=a.createSubContext(r.options);m&&w.delayNextStep(m),Ia(this,y,w),h=Math.max(h,w.currentTimeline.currentTime),c.push(w.currentTimeline)}),c.forEach(y=>a.currentTimeline.mergeTimelineCollectedStyles(y)),a.transformIntoNewTimeline(h),a.previousNode=r}_visitTiming(r,a){if(r.dynamic){let c=r.strValue,h=a.params?x_(c,a.params,a.errors):c;return Cb(h,a.errors)}else return{duration:r.duration,delay:r.delay,easing:r.easing}}visitAnimate(r,a){let c=a.currentAnimateTimings=this._visitTiming(r.timings,a),h=a.currentTimeline;c.delay&&(a.incrementTime(c.delay),h.snapshotCurrentStyles());let m=r.style;m.type==Jn.Keyframes?this.visitKeyframes(m,a):(a.incrementTime(c.duration),this.visitStyle(m,a),h.applyStylesToKeyframe()),a.currentAnimateTimings=null,a.previousNode=r}visitStyle(r,a){let c=a.currentTimeline,h=a.currentAnimateTimings;!h&&c.hasCurrentStyleProperties()&&c.forwardFrame();let m=h&&h.easing||r.easing;r.isEmptyStep?c.applyEmptyStep(m):c.setStyles(r.styles,m,a.errors,a.options),a.previousNode=r}visitKeyframes(r,a){let c=a.currentAnimateTimings,h=a.currentTimeline.duration,m=c.duration,w=a.createSubContext().currentTimeline;w.easing=c.easing,r.styles.forEach(C=>{let D=C.offset||0;w.forwardTime(D*m),w.setStyles(C.styles,C.easing,a.errors,a.options),w.applyStylesToKeyframe()}),a.currentTimeline.mergeTimelineCollectedStyles(w),a.transformIntoNewTimeline(h+m),a.previousNode=r}visitQuery(r,a){let c=a.currentTimeline.currentTime,h=r.options||{},m=h.delay?xu(h.delay):0;m&&(a.previousNode.type===Jn.Style||c==0&&a.currentTimeline.hasCurrentStyleProperties())&&(a.currentTimeline.snapshotCurrentStyles(),a.previousNode=Ab);let y=c,w=a.invokeQuery(r.selector,r.originalSelector,r.limit,r.includeSelf,!!h.optional,a.errors);a.currentQueryTotal=w.length;let C=null;w.forEach((D,z)=>{a.currentQueryIndex=z;let j=a.createSubContext(r.options,D);m&&j.delayNextStep(m),D===a.element&&(C=j.currentTimeline),Ia(this,r.animation,j),j.currentTimeline.applyStylesToKeyframe();let ie=j.currentTimeline.currentTime;y=Math.max(y,ie)}),a.currentQueryIndex=0,a.currentQueryTotal=0,a.transformIntoNewTimeline(y),C&&(a.currentTimeline.mergeTimelineCollectedStyles(C),a.currentTimeline.snapshotCurrentStyles()),a.previousNode=r}visitStagger(r,a){let c=a.parentContext,h=a.currentTimeline,m=r.timings,y=Math.abs(m.duration),w=y*(a.currentQueryTotal-1),C=y*a.currentQueryIndex;switch(m.duration<0?"reverse":m.easing){case"reverse":C=w-C;break;case"full":C=c.currentStaggerTime;break}let z=a.currentTimeline;C&&z.delayNextStep(C);let j=z.currentTime;Ia(this,r.animation,a),a.previousNode=r,c.currentStaggerTime=h.currentTime-j+(h.startTime-c.currentTimeline.startTime)}},Ab={},VS=class i{constructor(r,a,c,h,m,y,w,C){this._driver=r,this.element=a,this.subInstructions=c,this._enterClassName=h,this._leaveClassName=m,this.errors=y,this.timelines=w,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Ab,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=C||new Pb(this._driver,a,0),w.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(r,a){if(!r)return;let c=r,h=this.options;c.duration!=null&&(h.duration=xu(c.duration)),c.delay!=null&&(h.delay=xu(c.delay));let m=c.params;if(m){let y=h.params;y||(y=this.options.params={}),Object.keys(m).forEach(w=>{(!a||!y.hasOwnProperty(w))&&(y[w]=x_(m[w],y,this.errors))})}}_copyOptions(){let r={};if(this.options){let a=this.options.params;if(a){let c=r.params={};Object.keys(a).forEach(h=>{c[h]=a[h]})}}return r}createSubContext(r=null,a,c){let h=a||this.element,m=new i(this._driver,h,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(h,c||0));return m.previousNode=this.previousNode,m.currentAnimateTimings=this.currentAnimateTimings,m.options=this._copyOptions(),m.updateOptions(r),m.currentQueryIndex=this.currentQueryIndex,m.currentQueryTotal=this.currentQueryTotal,m.parentContext=this,this.subContextCount++,m}transformIntoNewTimeline(r){return this.previousNode=Ab,this.currentTimeline=this.currentTimeline.fork(this.element,r),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(r,a,c){let h={duration:a??r.duration,delay:this.currentTimeline.currentTime+(c??0)+r.delay,easing:""},m=new US(this._driver,r.element,r.keyframes,r.preStyleProps,r.postStyleProps,h,r.stretchStartingKeyframe);return this.timelines.push(m),h}incrementTime(r){this.currentTimeline.forwardTime(this.currentTimeline.duration+r)}delayNextStep(r){r>0&&this.currentTimeline.delayNextStep(r)}invokeQuery(r,a,c,h,m,y){let w=[];if(h&&w.push(this.element),r.length>0){r=r.replace(qne,"."+this._enterClassName),r=r.replace(Yne,"."+this._leaveClassName);let C=c!=1,D=this._driver.query(this.element,r,C);c!==0&&(D=c<0?D.slice(D.length+c,D.length):D.slice(0,c)),w.push(...D)}return!m&&w.length==0&&y.push(cne(a)),w}},Pb=class i{constructor(r,a,c,h){this._driver=r,this.element=a,this.startTime=c,this._elementTimelineStylesLookup=h,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(a),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(a,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(r){let a=this._keyframes.size===1&&this._pendingStyles.size;this.duration||a?(this.forwardTime(this.currentTime+r),a&&this.snapshotCurrentStyles()):this.startTime+=r}fork(r,a){return this.applyStylesToKeyframe(),new i(this._driver,r,a||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=Gne,this._loadKeyframe()}forwardTime(r){this.applyStylesToKeyframe(),this.duration=r,this._loadKeyframe()}_updateStyle(r,a){this._localTimelineStyles.set(r,a),this._globalTimelineStyles.set(r,a),this._styleSummary.set(r,{time:this.currentTime,value:a})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(r){r&&this._previousKeyframe.set("easing",r);for(let[a,c]of this._globalTimelineStyles)this._backFill.set(a,c||gc),this._currentKeyframe.set(a,gc);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(r,a,c,h){a&&this._previousKeyframe.set("easing",a);let m=h&&h.params||{},y=Xne(r,this._globalTimelineStyles);for(let[w,C]of y){let D=x_(C,m,c);this._pendingStyles.set(w,D),this._localTimelineStyles.has(w)||this._backFill.set(w,this._globalTimelineStyles.get(w)??gc),this._updateStyle(w,D)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((r,a)=>{this._currentKeyframe.set(a,r)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((r,a)=>{this._currentKeyframe.has(a)||this._currentKeyframe.set(a,r)}))}snapshotCurrentStyles(){for(let[r,a]of this._localTimelineStyles)this._pendingStyles.set(r,a),this._updateStyle(r,a)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let r=[];for(let a in this._currentKeyframe)r.push(a);return r}mergeTimelineCollectedStyles(r){r._styleSummary.forEach((a,c)=>{let h=this._styleSummary.get(c);(!h||a.time>h.time)&&this._updateStyle(c,a.value)})}buildKeyframes(){this.applyStylesToKeyframe();let r=new Set,a=new Set,c=this._keyframes.size===1&&this.duration===0,h=[];this._keyframes.forEach((w,C)=>{let D=new Map([...this._backFill,...w]);D.forEach((z,j)=>{z===xb?r.add(j):z===gc&&a.add(j)}),c||D.set("offset",C/this.duration),h.push(D)});let m=[...r.values()],y=[...a.values()];if(c){let w=h[0],C=new Map(w);w.set("offset",0),C.set("offset",1),h=[w,C]}return nD(this.element,h,m,y,this.duration,this.startTime,this.easing,!1)}},US=class extends Pb{constructor(r,a,c,h,m,y,w=!1){super(r,a,y.delay),this.keyframes=c,this.preStyleProps=h,this.postStyleProps=m,this._stretchStartingKeyframe=w,this.timings={duration:y.duration,delay:y.delay,easing:y.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let r=this.keyframes,{delay:a,duration:c,easing:h}=this.timings;if(this._stretchStartingKeyframe&&a){let m=[],y=c+a,w=a/y,C=new Map(r[0]);C.set("offset",0),m.push(C);let D=new Map(r[0]);D.set("offset",TV(w)),m.push(D);let z=r.length-1;for(let j=1;j<=z;j++){let ie=new Map(r[j]),oe=ie.get("offset"),he=a+oe*c;ie.set("offset",TV(he/y)),m.push(ie)}c=y,a=0,h="",r=m}return nD(this.element,r,this.preStyleProps,this.postStyleProps,c,a,h,!0)}};function TV(i,r=3){let a=Math.pow(10,r-1);return Math.round(i*a)/a}function Xne(i,r){let a=new Map,c;return i.forEach(h=>{if(h==="*"){c??=r.keys();for(let m of c)a.set(m,gc)}else for(let[m,y]of h)a.set(m,y)}),a}function EV(i,r,a,c,h,m,y,w,C,D,z,j,ie){return{type:0,element:i,triggerName:r,isRemovalTransition:h,fromState:a,fromStyles:m,toState:c,toStyles:y,timelines:w,queriedElements:C,preStyleProps:D,postStyleProps:z,totalTime:j,errors:ie}}var AS={},Ob=class{constructor(r,a,c){this._triggerName=r,this.ast=a,this._stateStyles=c}match(r,a,c,h){return Kne(this.ast.matchers,r,a,c,h)}buildStyles(r,a,c){let h=this._stateStyles.get("*");return r!==void 0&&(h=this._stateStyles.get(r?.toString())||h),h?h.buildStyles(a,c):new Map}build(r,a,c,h,m,y,w,C,D,z){let j=[],ie=this.ast.options&&this.ast.options.params||AS,oe=w&&w.params||AS,he=this.buildStyles(c,oe,j),ke=C&&C.params||AS,rt=this.buildStyles(h,ke,j),Ve=new Set,Ot=new Map,hn=new Map,Qt=h==="void",Wn={params:jV(ke,ie),delay:this.ast.options?.delay},Kn=z?[]:BV(r,a,this.ast.animation,m,y,he,rt,Wn,D,j),X=0;return Kn.forEach(Rt=>{X=Math.max(Rt.duration+Rt.delay,X)}),j.length?EV(a,this._triggerName,c,h,Qt,he,rt,[],[],Ot,hn,X,j):(Kn.forEach(Rt=>{let bo=Rt.element,ar=Ca(Ot,bo,new Set);Rt.preStyleProps.forEach(xi=>ar.add(xi));let Vt=Ca(hn,bo,new Set);Rt.postStyleProps.forEach(xi=>Vt.add(xi)),bo!==a&&Ve.add(bo)}),EV(a,this._triggerName,c,h,Qt,he,rt,Kn,[...Ve.values()],Ot,hn,X))}};function Kne(i,r,a,c,h){return i.some(m=>m(r,a,c,h))}function jV(i,r){let a=Lt({},r);return Object.entries(i).forEach(([c,h])=>{h!=null&&(a[c]=h)}),a}var $S=class{constructor(r,a,c){this.styles=r,this.defaultParams=a,this.normalizer=c}buildStyles(r,a){let c=new Map,h=jV(r,this.defaultParams);return this.styles.styles.forEach(m=>{typeof m!="string"&&m.forEach((y,w)=>{y&&(y=x_(y,h,a));let C=this.normalizer.normalizePropertyName(w,a);y=this.normalizer.normalizeStyleValue(w,C,y,a),c.set(w,y)})}),c}};function Jne(i,r,a){return new HS(i,r,a)}var HS=class{constructor(r,a,c){this.name=r,this.ast=a,this._normalizer=c,this.transitionFactories=[],this.states=new Map,a.states.forEach(h=>{let m=h.options&&h.options.params||{};this.states.set(h.name,new $S(h.style,m,c))}),MV(this.states,"true","1"),MV(this.states,"false","0"),a.transitions.forEach(h=>{this.transitionFactories.push(new Ob(r,h,this.states))}),this.fallbackTransition=Qne(r,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(r,a,c,h){return this.transitionFactories.find(y=>y.match(r,a,c,h))||null}matchStyles(r,a,c){return this.fallbackTransition.buildStyles(r,a,c)}};function Qne(i,r,a){let c=[(y,w)=>!0],h={type:Jn.Sequence,steps:[],options:null},m={type:Jn.Transition,animation:h,matchers:c,options:null,queryCount:0,depCount:0};return new Ob(i,m,r)}function MV(i,r,a){i.has(r)?i.has(a)||i.set(a,i.get(r)):i.has(a)&&i.set(r,i.get(a))}var eie=new b_,GS=class{constructor(r,a,c){this.bodyNode=r,this._driver=a,this._normalizer=c,this._animations=new Map,this._playersById=new Map,this.players=[]}register(r,a){let c=[],h=[],m=zV(this._driver,a,c,h);if(c.length)throw pne(c);h.length&&void 0,this._animations.set(r,m)}_buildPlayer(r,a,c){let h=r.element,m=PV(this._normalizer,r.keyframes,a,c);return this._driver.animate(h,m,r.duration,r.delay,r.easing,[],!0)}create(r,a,c={}){let h=[],m=this._animations.get(r),y,w=new Map;if(m?(y=BV(this._driver,a,m,FV,LS,new Map,new Map,c,eie,h),y.forEach(z=>{let j=Ca(w,z.element,new Map);z.postStyleProps.forEach(ie=>j.set(ie,null))})):(h.push(mne()),y=[]),h.length)throw gne(h);w.forEach((z,j)=>{z.forEach((ie,oe)=>{z.set(oe,this._driver.computeStyle(j,oe,gc))})});let C=y.map(z=>{let j=w.get(z.element);return this._buildPlayer(z,new Map,j)}),D=bd(C);return this._playersById.set(r,D),D.onDestroy(()=>this.destroy(r)),this.players.push(D),D}destroy(r){let a=this._getPlayer(r);a.destroy(),this._playersById.delete(r);let c=this.players.indexOf(a);c>=0&&this.players.splice(c,1)}_getPlayer(r){let a=this._playersById.get(r);if(!a)throw _ne(r);return a}listen(r,a,c,h){let m=KS(a,"","","");return XS(this._getPlayer(r),c,m,h),()=>{}}command(r,a,c,h){if(c=="register"){this.register(r,h[0]);return}if(c=="create"){let y=h[0]||{};this.create(r,a,y);return}let m=this._getPlayer(r);switch(c){case"play":m.play();break;case"pause":m.pause();break;case"reset":m.reset();break;case"restart":m.restart();break;case"finish":m.finish();break;case"init":m.init();break;case"setPosition":m.setPosition(parseFloat(h[0]));break;case"destroy":this.destroy(r);break}}},IV="ng-animate-queued",tie=".ng-animate-queued",PS="ng-animate-disabled",nie=".ng-animate-disabled",iie="ng-star-inserted",rie=".ng-star-inserted",oie=[],VV={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},sie={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Rl="__ng_removed",w_=class{get params(){return this.options.params}constructor(r,a=""){this.namespaceId=a;let c=r&&r.hasOwnProperty("value"),h=c?r.value:r;if(this.value=lie(h),c){let m=r,{value:y}=m,w=hp(m,["value"]);this.options=w}else this.options={};this.options.params||(this.options.params={})}absorbOptions(r){let a=r.params;if(a){let c=this.options.params;Object.keys(a).forEach(h=>{c[h]==null&&(c[h]=a[h])})}}},v_="void",OS=new w_(v_),WS=class{constructor(r,a,c){this.id=r,this.hostElement=a,this._engine=c,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+r,Qa(a,this._hostClassName)}listen(r,a,c,h){if(!this._triggers.has(a))throw yne(c,a);if(c==null||c.length==0)throw vne(a);if(!cie(c))throw xne(c,a);let m=Ca(this._elementListeners,r,[]),y={name:a,phase:c,callback:h};m.push(y);let w=Ca(this._engine.statesByElement,r,new Map);return w.has(a)||(Qa(r,bb),Qa(r,bb+"-"+a),w.set(a,OS)),()=>{this._engine.afterFlush(()=>{let C=m.indexOf(y);C>=0&&m.splice(C,1),this._triggers.has(a)||w.delete(a)})}}register(r,a){return this._triggers.has(r)?!1:(this._triggers.set(r,a),!0)}_getTrigger(r){let a=this._triggers.get(r);if(!a)throw bne(r);return a}trigger(r,a,c,h=!0){let m=this._getTrigger(a),y=new T_(this.id,a,r),w=this._engine.statesByElement.get(r);w||(Qa(r,bb),Qa(r,bb+"-"+a),this._engine.statesByElement.set(r,w=new Map));let C=w.get(a),D=new w_(c,this.id);if(!(c&&c.hasOwnProperty("value"))&&C&&D.absorbOptions(C.options),w.set(a,D),C||(C=OS),!(D.value===v_)&&C.value===D.value){if(!hie(C.params,D.params)){let ke=[],rt=m.matchStyles(C.value,C.params,ke),Ve=m.matchStyles(D.value,D.params,ke);ke.length?this._engine.reportError(ke):this._engine.afterFlush(()=>{Kh(r,rt),_c(r,Ve)})}return}let ie=Ca(this._engine.playersByElement,r,[]);ie.forEach(ke=>{ke.namespaceId==this.id&&ke.triggerName==a&&ke.queued&&ke.destroy()});let oe=m.matchTransition(C.value,D.value,r,D.params),he=!1;if(!oe){if(!h)return;oe=m.fallbackTransition,he=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:r,triggerName:a,transition:oe,fromState:C,toState:D,player:y,isFallbackTransition:he}),he||(Qa(r,IV),y.onStart(()=>{qp(r,IV)})),y.onDone(()=>{let ke=this.players.indexOf(y);ke>=0&&this.players.splice(ke,1);let rt=this._engine.playersByElement.get(r);if(rt){let Ve=rt.indexOf(y);Ve>=0&&rt.splice(Ve,1)}}),this.players.push(y),ie.push(y),y}deregister(r){this._triggers.delete(r),this._engine.statesByElement.forEach(a=>a.delete(r)),this._elementListeners.forEach((a,c)=>{this._elementListeners.set(c,a.filter(h=>h.name!=r))})}clearElementCache(r){this._engine.statesByElement.delete(r),this._elementListeners.delete(r);let a=this._engine.playersByElement.get(r);a&&(a.forEach(c=>c.destroy()),this._engine.playersByElement.delete(r))}_signalRemovalForInnerTriggers(r,a){let c=this._engine.driver.query(r,Ib,!0);c.forEach(h=>{if(h[Rl])return;let m=this._engine.fetchNamespacesByElement(h);m.size?m.forEach(y=>y.triggerLeaveAnimation(h,a,!1,!0)):this.clearElementCache(h)}),this._engine.afterFlushAnimationsDone(()=>c.forEach(h=>this.clearElementCache(h)))}triggerLeaveAnimation(r,a,c,h){let m=this._engine.statesByElement.get(r),y=new Map;if(m){let w=[];if(m.forEach((C,D)=>{if(y.set(D,C.value),this._triggers.has(D)){let z=this.trigger(r,D,v_,h);z&&w.push(z)}}),w.length)return this._engine.markElementAsRemoved(this.id,r,!0,a,y),c&&bd(w).onDone(()=>this._engine.processLeaveNode(r)),!0}return!1}prepareLeaveAnimationListeners(r){let a=this._elementListeners.get(r),c=this._engine.statesByElement.get(r);if(a&&c){let h=new Set;a.forEach(m=>{let y=m.name;if(h.has(y))return;h.add(y);let C=this._triggers.get(y).fallbackTransition,D=c.get(y)||OS,z=new w_(v_),j=new T_(this.id,y,r);this._engine.totalQueuedPlayers++,this._queue.push({element:r,triggerName:y,transition:C,fromState:D,toState:z,player:j,isFallbackTransition:!0})})}}removeNode(r,a){let c=this._engine;if(r.childElementCount&&this._signalRemovalForInnerTriggers(r,a),this.triggerLeaveAnimation(r,a,!0))return;let h=!1;if(c.totalAnimations){let m=c.players.length?c.playersByQueriedElement.get(r):[];if(m&&m.length)h=!0;else{let y=r;for(;y=y.parentNode;)if(c.statesByElement.get(y)){h=!0;break}}}if(this.prepareLeaveAnimationListeners(r),h)c.markElementAsRemoved(this.id,r,!1,a);else{let m=r[Rl];(!m||m===VV)&&(c.afterFlush(()=>this.clearElementCache(r)),c.destroyInnerAnimations(r),c._onRemovalComplete(r,a))}}insertNode(r,a){Qa(r,this._hostClassName)}drainQueuedTransitions(r){let a=[];return this._queue.forEach(c=>{let h=c.player;if(h.destroyed)return;let m=c.element,y=this._elementListeners.get(m);y&&y.forEach(w=>{if(w.name==c.triggerName){let C=KS(m,c.triggerName,c.fromState.value,c.toState.value);C._data=r,XS(c.player,w.phase,C,w.callback)}}),h.markedForDestroy?this._engine.afterFlush(()=>{h.destroy()}):a.push(c)}),this._queue=[],a.sort((c,h)=>{let m=c.transition.ast.depCount,y=h.transition.ast.depCount;return m==0||y==0?m-y:this._engine.driver.containsElement(c.element,h.element)?1:-1})}destroy(r){this.players.forEach(a=>a.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,r)}},qS=class{_onRemovalComplete(r,a){this.onRemovalComplete(r,a)}constructor(r,a,c,h){this.bodyNode=r,this.driver=a,this._normalizer=c,this.scheduler=h,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(m,y)=>{}}get queuedPlayers(){let r=[];return this._namespaceList.forEach(a=>{a.players.forEach(c=>{c.queued&&r.push(c)})}),r}createNamespace(r,a){let c=new WS(r,a,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,a)?this._balanceNamespaceList(c,a):(this.newHostElements.set(a,c),this.collectEnterElement(a)),this._namespaceLookup[r]=c}_balanceNamespaceList(r,a){let c=this._namespaceList,h=this.namespacesByHostElement;if(c.length-1>=0){let y=!1,w=this.driver.getParentElement(a);for(;w;){let C=h.get(w);if(C){let D=c.indexOf(C);c.splice(D+1,0,r),y=!0;break}w=this.driver.getParentElement(w)}y||c.unshift(r)}else c.push(r);return h.set(a,r),r}register(r,a){let c=this._namespaceLookup[r];return c||(c=this.createNamespace(r,a)),c}registerTrigger(r,a,c){let h=this._namespaceLookup[r];h&&h.register(a,c)&&this.totalAnimations++}destroy(r,a){r&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let c=this._fetchNamespace(r);this.namespacesByHostElement.delete(c.hostElement);let h=this._namespaceList.indexOf(c);h>=0&&this._namespaceList.splice(h,1),c.destroy(a),delete this._namespaceLookup[r]}))}_fetchNamespace(r){return this._namespaceLookup[r]}fetchNamespacesByElement(r){let a=new Set,c=this.statesByElement.get(r);if(c){for(let h of c.values())if(h.namespaceId){let m=this._fetchNamespace(h.namespaceId);m&&a.add(m)}}return a}trigger(r,a,c,h){if(Eb(a)){let m=this._fetchNamespace(r);if(m)return m.trigger(a,c,h),!0}return!1}insertNode(r,a,c,h){if(!Eb(a))return;let m=a[Rl];if(m&&m.setForRemoval){m.setForRemoval=!1,m.setForMove=!0;let y=this.collectedLeaveElements.indexOf(a);y>=0&&this.collectedLeaveElements.splice(y,1)}if(r){let y=this._fetchNamespace(r);y&&y.insertNode(a,c)}h&&this.collectEnterElement(a)}collectEnterElement(r){this.collectedEnterElements.push(r)}markElementAsDisabled(r,a){a?this.disabledNodes.has(r)||(this.disabledNodes.add(r),Qa(r,PS)):this.disabledNodes.has(r)&&(this.disabledNodes.delete(r),qp(r,PS))}removeNode(r,a,c){if(Eb(a)){this.scheduler?.notify();let h=r?this._fetchNamespace(r):null;h?h.removeNode(a,c):this.markElementAsRemoved(r,a,!1,c);let m=this.namespacesByHostElement.get(a);m&&m.id!==r&&m.removeNode(a,c)}else this._onRemovalComplete(a,c)}markElementAsRemoved(r,a,c,h,m){this.collectedLeaveElements.push(a),a[Rl]={namespaceId:r,setForRemoval:h,hasAnimation:c,removedBeforeQueried:!1,previousTriggersValues:m}}listen(r,a,c,h,m){return Eb(a)?this._fetchNamespace(r).listen(a,c,h,m):()=>{}}_buildInstruction(r,a,c,h,m){return r.transition.build(this.driver,r.element,r.fromState.value,r.toState.value,c,h,r.fromState.options,r.toState.options,a,m)}destroyInnerAnimations(r){let a=this.driver.query(r,Ib,!0);a.forEach(c=>this.destroyActiveAnimationsForElement(c)),this.playersByQueriedElement.size!=0&&(a=this.driver.query(r,FS,!0),a.forEach(c=>this.finishActiveQueriedAnimationOnElement(c)))}destroyActiveAnimationsForElement(r){let a=this.playersByElement.get(r);a&&a.forEach(c=>{c.queued?c.markedForDestroy=!0:c.destroy()})}finishActiveQueriedAnimationOnElement(r){let a=this.playersByQueriedElement.get(r);a&&a.forEach(c=>c.finish())}whenRenderingDone(){return new Promise(r=>{if(this.players.length)return bd(this.players).onDone(()=>r());r()})}processLeaveNode(r){let a=r[Rl];if(a&&a.setForRemoval){if(r[Rl]=VV,a.namespaceId){this.destroyInnerAnimations(r);let c=this._fetchNamespace(a.namespaceId);c&&c.clearElementCache(r)}this._onRemovalComplete(r,a.setForRemoval)}r.classList?.contains(PS)&&this.markElementAsDisabled(r,!1),this.driver.query(r,nie,!0).forEach(c=>{this.markElementAsDisabled(c,!1)})}flush(r=-1){let a=[];if(this.newHostElements.size&&(this.newHostElements.forEach((c,h)=>this._balanceNamespaceList(c,h)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let c=0;c<this.collectedEnterElements.length;c++){let h=this.collectedEnterElements[c];Qa(h,iie)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let c=[];try{a=this._flushAnimations(c,r)}finally{for(let h=0;h<c.length;h++)c[h]()}}else for(let c=0;c<this.collectedLeaveElements.length;c++){let h=this.collectedLeaveElements[c];this.processLeaveNode(h)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(c=>c()),this._flushFns=[],this._whenQuietFns.length){let c=this._whenQuietFns;this._whenQuietFns=[],a.length?bd(a).onDone(()=>{c.forEach(h=>h())}):c.forEach(h=>h())}}reportError(r){throw wne(r)}_flushAnimations(r,a){let c=new b_,h=[],m=new Map,y=[],w=new Map,C=new Map,D=new Map,z=new Set;this.disabledNodes.forEach(Pt=>{z.add(Pt);let Ut=this.driver.query(Pt,tie,!0);for(let jt=0;jt<Ut.length;jt++)z.add(Ut[jt])});let j=this.bodyNode,ie=Array.from(this.statesByElement.keys()),oe=DV(ie,this.collectedEnterElements),he=new Map,ke=0;oe.forEach((Pt,Ut)=>{let jt=FV+ke++;he.set(Ut,jt),Pt.forEach(ze=>Qa(ze,jt))});let rt=[],Ve=new Set,Ot=new Set;for(let Pt=0;Pt<this.collectedLeaveElements.length;Pt++){let Ut=this.collectedLeaveElements[Pt],jt=Ut[Rl];jt&&jt.setForRemoval&&(rt.push(Ut),Ve.add(Ut),jt.hasAnimation?this.driver.query(Ut,rie,!0).forEach(ze=>Ve.add(ze)):Ot.add(Ut))}let hn=new Map,Qt=DV(ie,Array.from(Ve));Qt.forEach((Pt,Ut)=>{let jt=LS+ke++;hn.set(Ut,jt),Pt.forEach(ze=>Qa(ze,jt))}),r.push(()=>{oe.forEach((Pt,Ut)=>{let jt=he.get(Ut);Pt.forEach(ze=>qp(ze,jt))}),Qt.forEach((Pt,Ut)=>{let jt=hn.get(Ut);Pt.forEach(ze=>qp(ze,jt))}),rt.forEach(Pt=>{this.processLeaveNode(Pt)})});let Wn=[],Kn=[];for(let Pt=this._namespaceList.length-1;Pt>=0;Pt--)this._namespaceList[Pt].drainQueuedTransitions(a).forEach(jt=>{let ze=jt.player,Si=jt.element;if(Wn.push(ze),this.collectedEnterElements.length){let pi=Si[Rl];if(pi&&pi.setForMove){if(pi.previousTriggersValues&&pi.previousTriggersValues.has(jt.triggerName)){let Tn=pi.previousTriggersValues.get(jt.triggerName),io=this.statesByElement.get(jt.element);if(io&&io.has(jt.triggerName)){let Fs=io.get(jt.triggerName);Fs.value=Tn,io.set(jt.triggerName,Fs)}}ze.destroy();return}}let bi=!j||!this.driver.containsElement(j,Si),Ji=hn.get(Si),wr=he.get(Si),Ne=this._buildInstruction(jt,c,wr,Ji,bi);if(Ne.errors&&Ne.errors.length){Kn.push(Ne);return}if(bi){ze.onStart(()=>Kh(Si,Ne.fromStyles)),ze.onDestroy(()=>_c(Si,Ne.toStyles)),h.push(ze);return}if(jt.isFallbackTransition){ze.onStart(()=>Kh(Si,Ne.fromStyles)),ze.onDestroy(()=>_c(Si,Ne.toStyles)),h.push(ze);return}let wo=[];Ne.timelines.forEach(pi=>{pi.stretchStartingKeyframe=!0,this.disabledNodes.has(pi.element)||wo.push(pi)}),Ne.timelines=wo,c.append(Si,Ne.timelines);let la={instruction:Ne,player:ze,element:Si};y.push(la),Ne.queriedElements.forEach(pi=>Ca(w,pi,[]).push(ze)),Ne.preStyleProps.forEach((pi,Tn)=>{if(pi.size){let io=C.get(Tn);io||C.set(Tn,io=new Set),pi.forEach((Fs,gr)=>io.add(gr))}}),Ne.postStyleProps.forEach((pi,Tn)=>{let io=D.get(Tn);io||D.set(Tn,io=new Set),pi.forEach((Fs,gr)=>io.add(gr))})});if(Kn.length){let Pt=[];Kn.forEach(Ut=>{Pt.push(Tne(Ut.triggerName,Ut.errors))}),Wn.forEach(Ut=>Ut.destroy()),this.reportError(Pt)}let X=new Map,Rt=new Map;y.forEach(Pt=>{let Ut=Pt.element;c.has(Ut)&&(Rt.set(Ut,Ut),this._beforeAnimationBuild(Pt.player.namespaceId,Pt.instruction,X))}),h.forEach(Pt=>{let Ut=Pt.element;this._getPreviousPlayers(Ut,!1,Pt.namespaceId,Pt.triggerName,null).forEach(ze=>{Ca(X,Ut,[]).push(ze),ze.destroy()})});let bo=rt.filter(Pt=>AV(Pt,C,D)),ar=new Map;SV(ar,this.driver,Ot,D,gc).forEach(Pt=>{AV(Pt,C,D)&&bo.push(Pt)});let xi=new Map;oe.forEach((Pt,Ut)=>{SV(xi,this.driver,new Set(Pt),C,xb)}),bo.forEach(Pt=>{let Ut=ar.get(Pt),jt=xi.get(Pt);ar.set(Pt,new Map([...Ut?.entries()??[],...jt?.entries()??[]]))});let Pa=[],Ko=[],Oa={};y.forEach(Pt=>{let{element:Ut,player:jt,instruction:ze}=Pt;if(c.has(Ut)){if(z.has(Ut)){jt.onDestroy(()=>_c(Ut,ze.toStyles)),jt.disabled=!0,jt.overrideTotalTime(ze.totalTime),h.push(jt);return}let Si=Oa;if(Rt.size>1){let Ji=Ut,wr=[];for(;Ji=Ji.parentNode;){let Ne=Rt.get(Ji);if(Ne){Si=Ne;break}wr.push(Ji)}wr.forEach(Ne=>Rt.set(Ne,Si))}let bi=this._buildAnimation(jt.namespaceId,ze,X,m,xi,ar);if(jt.setRealPlayer(bi),Si===Oa)Pa.push(jt);else{let Ji=this.playersByElement.get(Si);Ji&&Ji.length&&(jt.parentPlayer=bd(Ji)),h.push(jt)}}else Kh(Ut,ze.fromStyles),jt.onDestroy(()=>_c(Ut,ze.toStyles)),Ko.push(jt),z.has(Ut)&&h.push(jt)}),Ko.forEach(Pt=>{let Ut=m.get(Pt.element);if(Ut&&Ut.length){let jt=bd(Ut);Pt.setRealPlayer(jt)}}),h.forEach(Pt=>{Pt.parentPlayer?Pt.syncPlayerEvents(Pt.parentPlayer):Pt.destroy()});for(let Pt=0;Pt<rt.length;Pt++){let Ut=rt[Pt],jt=Ut[Rl];if(qp(Ut,LS),jt&&jt.hasAnimation)continue;let ze=[];if(w.size){let bi=w.get(Ut);bi&&bi.length&&ze.push(...bi);let Ji=this.driver.query(Ut,FS,!0);for(let wr=0;wr<Ji.length;wr++){let Ne=w.get(Ji[wr]);Ne&&Ne.length&&ze.push(...Ne)}}let Si=ze.filter(bi=>!bi.destroyed);Si.length?uie(this,Ut,Si):this.processLeaveNode(Ut)}return rt.length=0,Pa.forEach(Pt=>{this.players.push(Pt),Pt.onDone(()=>{Pt.destroy();let Ut=this.players.indexOf(Pt);this.players.splice(Ut,1)}),Pt.play()}),Pa}afterFlush(r){this._flushFns.push(r)}afterFlushAnimationsDone(r){this._whenQuietFns.push(r)}_getPreviousPlayers(r,a,c,h,m){let y=[];if(a){let w=this.playersByQueriedElement.get(r);w&&(y=w)}else{let w=this.playersByElement.get(r);if(w){let C=!m||m==v_;w.forEach(D=>{D.queued||!C&&D.triggerName!=h||y.push(D)})}}return(c||h)&&(y=y.filter(w=>!(c&&c!=w.namespaceId||h&&h!=w.triggerName))),y}_beforeAnimationBuild(r,a,c){let h=a.triggerName,m=a.element,y=a.isRemovalTransition?void 0:r,w=a.isRemovalTransition?void 0:h;for(let C of a.timelines){let D=C.element,z=D!==m,j=Ca(c,D,[]);this._getPreviousPlayers(D,z,y,w,a.toState).forEach(oe=>{let he=oe.getRealPlayer();he.beforeDestroy&&he.beforeDestroy(),oe.destroy(),j.push(oe)})}Kh(m,a.fromStyles)}_buildAnimation(r,a,c,h,m,y){let w=a.triggerName,C=a.element,D=[],z=new Set,j=new Set,ie=a.timelines.map(he=>{let ke=he.element;z.add(ke);let rt=ke[Rl];if(rt&&rt.removedBeforeQueried)return new xd(he.duration,he.delay);let Ve=ke!==C,Ot=die((c.get(ke)||oie).map(X=>X.getRealPlayer())).filter(X=>{let Rt=X;return Rt.element?Rt.element===ke:!1}),hn=m.get(ke),Qt=y.get(ke),Wn=PV(this._normalizer,he.keyframes,hn,Qt),Kn=this._buildPlayer(he,Wn,Ot);if(he.subTimeline&&h&&j.add(ke),Ve){let X=new T_(r,w,ke);X.setRealPlayer(Kn),D.push(X)}return Kn});D.forEach(he=>{Ca(this.playersByQueriedElement,he.element,[]).push(he),he.onDone(()=>aie(this.playersByQueriedElement,he.element,he))}),z.forEach(he=>Qa(he,xV));let oe=bd(ie);return oe.onDestroy(()=>{z.forEach(he=>qp(he,xV)),_c(C,a.toStyles)}),j.forEach(he=>{Ca(h,he,[]).push(oe)}),oe}_buildPlayer(r,a,c){return a.length>0?this.driver.animate(r.element,a,r.duration,r.delay,r.easing,c):new xd(r.duration,r.delay)}},T_=class{constructor(r,a,c){this.namespaceId=r,this.triggerName=a,this.element=c,this._player=new xd,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(r){this._containsRealPlayer||(this._player=r,this._queuedCallbacks.forEach((a,c)=>{a.forEach(h=>XS(r,c,void 0,h))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(r.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(r){this.totalTime=r}syncPlayerEvents(r){let a=this._player;a.triggerCallback&&r.onStart(()=>a.triggerCallback("start")),r.onDone(()=>this.finish()),r.onDestroy(()=>this.destroy())}_queueEvent(r,a){Ca(this._queuedCallbacks,r,[]).push(a)}onDone(r){this.queued&&this._queueEvent("done",r),this._player.onDone(r)}onStart(r){this.queued&&this._queueEvent("start",r),this._player.onStart(r)}onDestroy(r){this.queued&&this._queueEvent("destroy",r),this._player.onDestroy(r)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(r){this.queued||this._player.setPosition(r)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(r){let a=this._player;a.triggerCallback&&a.triggerCallback(r)}};function aie(i,r,a){let c=i.get(r);if(c){if(c.length){let h=c.indexOf(a);c.splice(h,1)}c.length==0&&i.delete(r)}return c}function lie(i){return i??null}function Eb(i){return i&&i.nodeType===1}function cie(i){return i=="start"||i=="done"}function CV(i,r){let a=i.style.display;return i.style.display=r??"none",a}function SV(i,r,a,c,h){let m=[];a.forEach(C=>m.push(CV(C)));let y=[];c.forEach((C,D)=>{let z=new Map;C.forEach(j=>{let ie=r.computeStyle(D,j,h);z.set(j,ie),(!ie||ie.length==0)&&(D[Rl]=sie,y.push(D))}),i.set(D,z)});let w=0;return a.forEach(C=>CV(C,m[w++])),y}function DV(i,r){let a=new Map;if(i.forEach(w=>a.set(w,[])),r.length==0)return a;let c=1,h=new Set(r),m=new Map;function y(w){if(!w)return c;let C=m.get(w);if(C)return C;let D=w.parentNode;return a.has(D)?C=D:h.has(D)?C=c:C=y(D),m.set(w,C),C}return r.forEach(w=>{let C=y(w);C!==c&&a.get(C).push(w)}),a}function Qa(i,r){i.classList?.add(r)}function qp(i,r){i.classList?.remove(r)}function uie(i,r,a){bd(a).onDone(()=>i.processLeaveNode(r))}function die(i){let r=[];return UV(i,r),r}function UV(i,r){for(let a=0;a<i.length;a++){let c=i[a];c instanceof g_?UV(c.players,r):r.push(c)}}function hie(i,r){let a=Object.keys(i),c=Object.keys(r);if(a.length!=c.length)return!1;for(let h=0;h<a.length;h++){let m=a[h];if(!r.hasOwnProperty(m)||i[m]!==r[m])return!1}return!0}function AV(i,r,a){let c=a.get(i);if(!c)return!1;let h=r.get(i);return h?c.forEach(m=>h.add(m)):r.set(i,c),a.delete(i),!0}var wd=class{constructor(r,a,c,h){this._driver=a,this._normalizer=c,this._triggerCache={},this.onRemovalComplete=(m,y)=>{},this._transitionEngine=new qS(r.body,a,c,h),this._timelineEngine=new GS(r.body,a,c),this._transitionEngine.onRemovalComplete=(m,y)=>this.onRemovalComplete(m,y)}registerTrigger(r,a,c,h,m){let y=r+"-"+h,w=this._triggerCache[y];if(!w){let C=[],D=[],z=zV(this._driver,m,C,D);if(C.length)throw hne(h,C);D.length&&void 0,w=Jne(h,z,this._normalizer),this._triggerCache[y]=w}this._transitionEngine.registerTrigger(a,h,w)}register(r,a){this._transitionEngine.register(r,a)}destroy(r,a){this._transitionEngine.destroy(r,a)}onInsert(r,a,c,h){this._transitionEngine.insertNode(r,a,c,h)}onRemove(r,a,c){this._transitionEngine.removeNode(r,a,c)}disableAnimations(r,a){this._transitionEngine.markElementAsDisabled(r,a)}process(r,a,c,h){if(c.charAt(0)=="@"){let[m,y]=yV(c),w=h;this._timelineEngine.command(m,a,y,w)}else this._transitionEngine.trigger(r,a,c,h)}listen(r,a,c,h,m){if(c.charAt(0)=="@"){let[y,w]=yV(c);return this._timelineEngine.listen(y,a,w,m)}return this._transitionEngine.listen(r,a,c,h,m)}flush(r=-1){this._transitionEngine.flush(r)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(r){this._transitionEngine.afterFlushAnimationsDone(r)}};function fie(i,r){let a=null,c=null;return Array.isArray(r)&&r.length?(a=RS(r[0]),r.length>1&&(c=RS(r[r.length-1]))):r instanceof Map&&(a=RS(r)),a||c?new ZS(i,a,c):null}var Zp=class Zp{constructor(r,a,c){this._element=r,this._startStyles=a,this._endStyles=c,this._state=0;let h=Zp.initialStylesByElement.get(r);h||Zp.initialStylesByElement.set(r,h=new Map),this._initialStyles=h}start(){this._state<1&&(this._startStyles&&_c(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(_c(this._element,this._initialStyles),this._endStyles&&(_c(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Zp.initialStylesByElement.delete(this._element),this._startStyles&&(Kh(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Kh(this._element,this._endStyles),this._endStyles=null),_c(this._element,this._initialStyles),this._state=3)}};Zp.initialStylesByElement=new WeakMap;var ZS=Zp;function RS(i){let r=null;return i.forEach((a,c)=>{pie(c)&&(r=r||new Map,r.set(c,a))}),r}function pie(i){return i==="display"||i==="position"}var Rb=class{constructor(r,a,c,h){this.element=r,this.keyframes=a,this.options=c,this._specialStyles=h,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=c.duration,this._delay=c.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(r=>r()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let r=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,r,this.options),this._finalKeyframe=r.length?r[r.length-1]:new Map;let a=()=>this._onFinish();this.domPlayer.addEventListener("finish",a),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",a)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(r){let a=[];return r.forEach(c=>{a.push(Object.fromEntries(c))}),a}_triggerWebAnimation(r,a,c){return r.animate(this._convertKeyframesToObject(a),c)}onStart(r){this._originalOnStartFns.push(r),this._onStartFns.push(r)}onDone(r){this._originalOnDoneFns.push(r),this._onDoneFns.push(r)}onDestroy(r){this._onDestroyFns.push(r)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(r=>r()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(r=>r()),this._onDestroyFns=[])}setPosition(r){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=r*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let r=new Map;this.hasStarted()&&this._finalKeyframe.forEach((c,h)=>{h!=="offset"&&r.set(h,this._finished?c:tD(this.element,h))}),this.currentSnapshot=r}triggerCallback(r){let a=r==="start"?this._onStartFns:this._onDoneFns;a.forEach(c=>c()),a.length=0}},Lb=class{validateStyleProperty(r){return!0}validateAnimatableStyleProperty(r){return!0}matchesElement(r,a){return!1}containsElement(r,a){return OV(r,a)}getParentElement(r){return JS(r)}query(r,a,c){return RV(r,a,c)}computeStyle(r,a,c){return tD(r,a)}animate(r,a,c,h,m,y=[]){let w=h==0?"both":"forwards",C={duration:c,delay:h,fill:w};m&&(C.easing=m);let D=new Map,z=y.filter(oe=>oe instanceof Rb);Lne(c,h)&&z.forEach(oe=>{oe.currentSnapshot.forEach((he,ke)=>D.set(ke,he))});let j=Pne(a).map(oe=>new Map(oe));j=Fne(r,j,D);let ie=fie(r,j);return new Rb(r,j,C,ie)}};var Mb="@",$V="@.disabled",Fb=class{constructor(r,a,c,h){this.namespaceId=r,this.delegate=a,this.engine=c,this._onDestroy=h,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(r){this.delegate.destroyNode?.(r)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(r,a){return this.delegate.createElement(r,a)}createComment(r){return this.delegate.createComment(r)}createText(r){return this.delegate.createText(r)}appendChild(r,a){this.delegate.appendChild(r,a),this.engine.onInsert(this.namespaceId,a,r,!1)}insertBefore(r,a,c,h=!0){this.delegate.insertBefore(r,a,c),this.engine.onInsert(this.namespaceId,a,r,h)}removeChild(r,a,c){this.engine.onRemove(this.namespaceId,a,this.delegate)}selectRootElement(r,a){return this.delegate.selectRootElement(r,a)}parentNode(r){return this.delegate.parentNode(r)}nextSibling(r){return this.delegate.nextSibling(r)}setAttribute(r,a,c,h){this.delegate.setAttribute(r,a,c,h)}removeAttribute(r,a,c){this.delegate.removeAttribute(r,a,c)}addClass(r,a){this.delegate.addClass(r,a)}removeClass(r,a){this.delegate.removeClass(r,a)}setStyle(r,a,c,h){this.delegate.setStyle(r,a,c,h)}removeStyle(r,a,c){this.delegate.removeStyle(r,a,c)}setProperty(r,a,c){a.charAt(0)==Mb&&a==$V?this.disableAnimations(r,!!c):this.delegate.setProperty(r,a,c)}setValue(r,a){this.delegate.setValue(r,a)}listen(r,a,c){return this.delegate.listen(r,a,c)}disableAnimations(r,a){this.engine.disableAnimations(r,a)}},YS=class extends Fb{constructor(r,a,c,h,m){super(a,c,h,m),this.factory=r,this.namespaceId=a}setProperty(r,a,c){a.charAt(0)==Mb?a.charAt(1)=="."&&a==$V?(c=c===void 0?!0:!!c,this.disableAnimations(r,c)):this.engine.process(this.namespaceId,r,a.slice(1),c):this.delegate.setProperty(r,a,c)}listen(r,a,c){if(a.charAt(0)==Mb){let h=mie(r),m=a.slice(1),y="";return m.charAt(0)!=Mb&&([m,y]=gie(m)),this.engine.listen(this.namespaceId,h,m,y,w=>{let C=w._data||-1;this.factory.scheduleListenerCallback(C,c,w)})}return this.delegate.listen(r,a,c)}};function mie(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function gie(i){let r=i.indexOf("."),a=i.substring(0,r),c=i.slice(r+1);return[a,c]}var kb=class{constructor(r,a,c){this.delegate=r,this.engine=a,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,a.onRemovalComplete=(h,m)=>{let y=m?.parentNode(h);y&&m.removeChild(y,h)}}createRenderer(r,a){let c="",h=this.delegate.createRenderer(r,a);if(!r||!a?.data?.animation){let D=this._rendererCache,z=D.get(h);if(!z){let j=()=>D.delete(h);z=new Fb(c,h,this.engine,j),D.set(h,z)}return z}let m=a.id,y=a.id+"-"+this._currentId;this._currentId++,this.engine.register(y,r);let w=D=>{Array.isArray(D)?D.forEach(w):this.engine.registerTrigger(m,y,r,D.name,D)};return a.data.animation.forEach(w),new YS(this,y,h,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(r,a,c){if(r>=0&&r<this._microtaskId){this._zone.run(()=>a(c));return}let h=this._animationCallbacksBuffer;h.length==0&&queueMicrotask(()=>{this._zone.run(()=>{h.forEach(m=>{let[y,w]=m;y(w)}),this._animationCallbacksBuffer=[]})}),h.push([a,c])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var yie=(()=>{let r=class r extends wd{constructor(c,h,m){super(c,h,m,Ee($g,{optional:!0}))}ngOnDestroy(){this.flush()}};r.\u0275fac=function(h){return new(h||r)(Ct(jn),Ct(Jh),Ct(Qh))},r.\u0275prov=gt({token:r,factory:r.\u0275fac});let i=r;return i})();function vie(){return new Sb}function xie(i,r,a){return new kb(i,r,a)}var HV=[{provide:Qh,useFactory:vie},{provide:wd,useClass:yie},{provide:su,useFactory:xie,deps:[_b,wd,oi]}],bie=[{provide:Jh,useFactory:()=>new Lb},{provide:EC,useValue:"BrowserAnimations"},...HV],qye=[{provide:Jh,useClass:QS},{provide:EC,useValue:"NoopAnimations"},...HV];function GV(){return[...bie]}var QV=(()=>{let r=class r{constructor(c,h){this._renderer=c,this._elementRef=h,this.onChange=m=>{},this.onTouched=()=>{}}setProperty(c,h){this._renderer.setProperty(this._elementRef.nativeElement,c,h)}registerOnTouched(c){this.onTouched=c}registerOnChange(c){this.onChange=c}setDisabledState(c){this.setProperty("disabled",c)}};r.\u0275fac=function(h){return new(h||r)(me(Za),me(mn))},r.\u0275dir=pn({type:r});let i=r;return i})(),wie=(()=>{let r=class r extends QV{};r.\u0275fac=(()=>{let c;return function(m){return(c||(c=_o(r)))(m||r)}})(),r.\u0275dir=pn({type:r,features:[uo]});let i=r;return i})(),sD=new ot("");var Tie={provide:sD,useExisting:Lh(()=>Xp),multi:!0};function Eie(){let i=vu()?vu().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var Mie=new ot(""),Xp=(()=>{let r=class r extends QV{constructor(c,h,m){super(c,h),this._compositionMode=m,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Eie())}writeValue(c){let h=c??"";this.setProperty("value",h)}_handleInput(c){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(c)}_compositionStart(){this._composing=!0}_compositionEnd(c){this._composing=!1,this._compositionMode&&this.onChange(c)}};r.\u0275fac=function(h){return new(h||r)(me(Za),me(mn),me(Mie,8))},r.\u0275dir=pn({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(h,m){h&1&&Kt("input",function(w){return m._handleInput(w.target.value)})("blur",function(){return m.onTouched()})("compositionstart",function(){return m._compositionStart()})("compositionend",function(w){return m._compositionEnd(w.target.value)})},features:[si([Tie]),uo]});let i=r;return i})();function Td(i){return i==null||(typeof i=="string"||Array.isArray(i))&&i.length===0}function eU(i){return i!=null&&typeof i.length=="number"}var aD=new ot(""),lD=new ot(""),Iie=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,ef=class{static min(r){return Cie(r)}static max(r){return Sie(r)}static required(r){return Die(r)}static requiredTrue(r){return Aie(r)}static email(r){return Pie(r)}static minLength(r){return Oie(r)}static maxLength(r){return Rie(r)}static pattern(r){return Lie(r)}static nullValidator(r){return tU(r)}static compose(r){return aU(r)}static composeAsync(r){return cU(r)}};function Cie(i){return r=>{if(Td(r.value)||Td(i))return null;let a=parseFloat(r.value);return!isNaN(a)&&a<i?{min:{min:i,actual:r.value}}:null}}function Sie(i){return r=>{if(Td(r.value)||Td(i))return null;let a=parseFloat(r.value);return!isNaN(a)&&a>i?{max:{max:i,actual:r.value}}:null}}function Die(i){return Td(i.value)?{required:!0}:null}function Aie(i){return i.value===!0?null:{required:!0}}function Pie(i){return Td(i.value)||Iie.test(i.value)?null:{email:!0}}function Oie(i){return r=>Td(r.value)||!eU(r.value)?null:r.value.length<i?{minlength:{requiredLength:i,actualLength:r.value.length}}:null}function Rie(i){return r=>eU(r.value)&&r.value.length>i?{maxlength:{requiredLength:i,actualLength:r.value.length}}:null}function Lie(i){if(!i)return tU;let r,a;return typeof i=="string"?(a="",i.charAt(0)!=="^"&&(a+="^"),a+=i,i.charAt(i.length-1)!=="$"&&(a+="$"),r=new RegExp(a)):(a=i.toString(),r=i),c=>{if(Td(c.value))return null;let h=c.value;return r.test(h)?null:{pattern:{requiredPattern:a,actualValue:h}}}}function tU(i){return null}function nU(i){return i!=null}function iU(i){return fd(i)?vr(i):i}function rU(i){let r={};return i.forEach(a=>{r=a!=null?Lt(Lt({},r),a):r}),Object.keys(r).length===0?null:r}function oU(i,r){return r.map(a=>a(i))}function Fie(i){return!i.validate}function sU(i){return i.map(r=>Fie(r)?r:a=>r.validate(a))}function aU(i){if(!i)return null;let r=i.filter(nU);return r.length==0?null:function(a){return rU(oU(a,r))}}function lU(i){return i!=null?aU(sU(i)):null}function cU(i){if(!i)return null;let r=i.filter(nU);return r.length==0?null:function(a){let c=oU(a,r).map(iU);return CM(c).pipe(st(rU))}}function uU(i){return i!=null?cU(sU(i)):null}function WV(i,r){return i===null?[r]:Array.isArray(i)?[...i,r]:[i,r]}function dU(i){return i._rawValidators}function hU(i){return i._rawAsyncValidators}function rD(i){return i?Array.isArray(i)?i:[i]:[]}function zb(i,r){return Array.isArray(i)?i.includes(r):i===r}function qV(i,r){let a=rD(r);return rD(i).forEach(h=>{zb(a,h)||a.push(h)}),a}function ZV(i,r){return rD(r).filter(a=>!zb(i,a))}var Bb=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(r){this._rawValidators=r||[],this._composedValidatorFn=lU(this._rawValidators)}_setAsyncValidators(r){this._rawAsyncValidators=r||[],this._composedAsyncValidatorFn=uU(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(r){this._onDestroyCallbacks.push(r)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(r=>r()),this._onDestroyCallbacks=[]}reset(r=void 0){this.control&&this.control.reset(r)}hasError(r,a){return this.control?this.control.hasError(r,a):!1}getError(r,a){return this.control?this.control.getError(r,a):null}},tf=class extends Bb{get formDirective(){return null}get path(){return null}},nf=class extends Bb{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},jb=class{constructor(r){this._cd=r}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},kie={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},uve=Er(Lt({},kie),{"[class.ng-submitted]":"isSubmitted"}),Gb=(()=>{let r=class r extends jb{constructor(c){super(c)}};r.\u0275fac=function(h){return new(h||r)(me(nf,2))},r.\u0275dir=pn({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(h,m){h&2&&ti("ng-untouched",m.isUntouched)("ng-touched",m.isTouched)("ng-pristine",m.isPristine)("ng-dirty",m.isDirty)("ng-valid",m.isValid)("ng-invalid",m.isInvalid)("ng-pending",m.isPending)},features:[uo]});let i=r;return i})(),fU=(()=>{let r=class r extends jb{constructor(c){super(c)}};r.\u0275fac=function(h){return new(h||r)(me(tf,10))},r.\u0275dir=pn({type:r,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(h,m){h&2&&ti("ng-untouched",m.isUntouched)("ng-touched",m.isTouched)("ng-pristine",m.isPristine)("ng-dirty",m.isDirty)("ng-valid",m.isValid)("ng-invalid",m.isInvalid)("ng-pending",m.isPending)("ng-submitted",m.isSubmitted)},features:[uo]});let i=r;return i})();var E_="VALID",Nb="INVALID",Yp="PENDING",M_="DISABLED";function pU(i){return(Wb(i)?i.validators:i)||null}function Nie(i){return Array.isArray(i)?lU(i):i||null}function mU(i,r){return(Wb(r)?r.asyncValidators:i)||null}function zie(i){return Array.isArray(i)?uU(i):i||null}function Wb(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function Bie(i,r,a){let c=i.controls;if(!(r?Object.keys(c):c).length)throw new mt(1e3,"");if(!c[a])throw new mt(1001,"")}function jie(i,r,a){i._forEachChild((c,h)=>{if(a[h]===void 0)throw new mt(1002,"")})}var Vb=class{constructor(r,a){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(r),this._assignAsyncValidators(a)}get validator(){return this._composedValidatorFn}set validator(r){this._rawValidators=this._composedValidatorFn=r}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(r){this._rawAsyncValidators=this._composedAsyncValidatorFn=r}get parent(){return this._parent}get valid(){return this.status===E_}get invalid(){return this.status===Nb}get pending(){return this.status==Yp}get disabled(){return this.status===M_}get enabled(){return this.status!==M_}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(r){this._assignValidators(r)}setAsyncValidators(r){this._assignAsyncValidators(r)}addValidators(r){this.setValidators(qV(r,this._rawValidators))}addAsyncValidators(r){this.setAsyncValidators(qV(r,this._rawAsyncValidators))}removeValidators(r){this.setValidators(ZV(r,this._rawValidators))}removeAsyncValidators(r){this.setAsyncValidators(ZV(r,this._rawAsyncValidators))}hasValidator(r){return zb(this._rawValidators,r)}hasAsyncValidator(r){return zb(this._rawAsyncValidators,r)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(r={}){this.touched=!0,this._parent&&!r.onlySelf&&this._parent.markAsTouched(r)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(r=>r.markAllAsTouched())}markAsUntouched(r={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(a=>{a.markAsUntouched({onlySelf:!0})}),this._parent&&!r.onlySelf&&this._parent._updateTouched(r)}markAsDirty(r={}){this.pristine=!1,this._parent&&!r.onlySelf&&this._parent.markAsDirty(r)}markAsPristine(r={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(a=>{a.markAsPristine({onlySelf:!0})}),this._parent&&!r.onlySelf&&this._parent._updatePristine(r)}markAsPending(r={}){this.status=Yp,r.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!r.onlySelf&&this._parent.markAsPending(r)}disable(r={}){let a=this._parentMarkedDirty(r.onlySelf);this.status=M_,this.errors=null,this._forEachChild(c=>{c.disable(Er(Lt({},r),{onlySelf:!0}))}),this._updateValue(),r.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Er(Lt({},r),{skipPristineCheck:a})),this._onDisabledChange.forEach(c=>c(!0))}enable(r={}){let a=this._parentMarkedDirty(r.onlySelf);this.status=E_,this._forEachChild(c=>{c.enable(Er(Lt({},r),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:r.emitEvent}),this._updateAncestors(Er(Lt({},r),{skipPristineCheck:a})),this._onDisabledChange.forEach(c=>c(!1))}_updateAncestors(r){this._parent&&!r.onlySelf&&(this._parent.updateValueAndValidity(r),r.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(r){this._parent=r}getRawValue(){return this.value}updateValueAndValidity(r={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===E_||this.status===Yp)&&this._runAsyncValidator(r.emitEvent)),r.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!r.onlySelf&&this._parent.updateValueAndValidity(r)}_updateTreeValidity(r={emitEvent:!0}){this._forEachChild(a=>a._updateTreeValidity(r)),this.updateValueAndValidity({onlySelf:!0,emitEvent:r.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?M_:E_}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(r){if(this.asyncValidator){this.status=Yp,this._hasOwnPendingAsyncValidator=!0;let a=iU(this.asyncValidator(this));this._asyncValidationSubscription=a.subscribe(c=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(c,{emitEvent:r})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(r,a={}){this.errors=r,this._updateControlsErrors(a.emitEvent!==!1)}get(r){let a=r;return a==null||(Array.isArray(a)||(a=a.split(".")),a.length===0)?null:a.reduce((c,h)=>c&&c._find(h),this)}getError(r,a){let c=a?this.get(a):this;return c&&c.errors?c.errors[r]:null}hasError(r,a){return!!this.getError(r,a)}get root(){let r=this;for(;r._parent;)r=r._parent;return r}_updateControlsErrors(r){this.status=this._calculateStatus(),r&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(r)}_initObservables(){this.valueChanges=new Zn,this.statusChanges=new Zn}_calculateStatus(){return this._allControlsDisabled()?M_:this.errors?Nb:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Yp)?Yp:this._anyControlsHaveStatus(Nb)?Nb:E_}_anyControlsHaveStatus(r){return this._anyControls(a=>a.status===r)}_anyControlsDirty(){return this._anyControls(r=>r.dirty)}_anyControlsTouched(){return this._anyControls(r=>r.touched)}_updatePristine(r={}){this.pristine=!this._anyControlsDirty(),this._parent&&!r.onlySelf&&this._parent._updatePristine(r)}_updateTouched(r={}){this.touched=this._anyControlsTouched(),this._parent&&!r.onlySelf&&this._parent._updateTouched(r)}_registerOnCollectionChange(r){this._onCollectionChange=r}_setUpdateStrategy(r){Wb(r)&&r.updateOn!=null&&(this._updateOn=r.updateOn)}_parentMarkedDirty(r){let a=this._parent&&this._parent.dirty;return!r&&!!a&&!this._parent._anyControlsDirty()}_find(r){return null}_assignValidators(r){this._rawValidators=Array.isArray(r)?r.slice():r,this._composedValidatorFn=Nie(this._rawValidators)}_assignAsyncValidators(r){this._rawAsyncValidators=Array.isArray(r)?r.slice():r,this._composedAsyncValidatorFn=zie(this._rawAsyncValidators)}},Ub=class extends Vb{constructor(r,a,c){super(pU(a),mU(c,a)),this.controls=r,this._initObservables(),this._setUpdateStrategy(a),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(r,a){return this.controls[r]?this.controls[r]:(this.controls[r]=a,a.setParent(this),a._registerOnCollectionChange(this._onCollectionChange),a)}addControl(r,a,c={}){this.registerControl(r,a),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}removeControl(r,a={}){this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),delete this.controls[r],this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}setControl(r,a,c={}){this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),delete this.controls[r],a&&this.registerControl(r,a),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}contains(r){return this.controls.hasOwnProperty(r)&&this.controls[r].enabled}setValue(r,a={}){jie(this,!0,r),Object.keys(r).forEach(c=>{Bie(this,!0,c),this.controls[c].setValue(r[c],{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a)}patchValue(r,a={}){r!=null&&(Object.keys(r).forEach(c=>{let h=this.controls[c];h&&h.patchValue(r[c],{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a))}reset(r={},a={}){this._forEachChild((c,h)=>{c.reset(r?r[h]:null,{onlySelf:!0,emitEvent:a.emitEvent})}),this._updatePristine(a),this._updateTouched(a),this.updateValueAndValidity(a)}getRawValue(){return this._reduceChildren({},(r,a,c)=>(r[c]=a.getRawValue(),r))}_syncPendingControls(){let r=this._reduceChildren(!1,(a,c)=>c._syncPendingControls()?!0:a);return r&&this.updateValueAndValidity({onlySelf:!0}),r}_forEachChild(r){Object.keys(this.controls).forEach(a=>{let c=this.controls[a];c&&r(c,a)})}_setUpControls(){this._forEachChild(r=>{r.setParent(this),r._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(r){for(let[a,c]of Object.entries(this.controls))if(this.contains(a)&&r(c))return!0;return!1}_reduceValue(){let r={};return this._reduceChildren(r,(a,c,h)=>((c.enabled||this.disabled)&&(a[h]=c.value),a))}_reduceChildren(r,a){let c=r;return this._forEachChild((h,m)=>{c=a(c,h,m)}),c}_allControlsDisabled(){for(let r of Object.keys(this.controls))if(this.controls[r].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(r){return this.controls.hasOwnProperty(r)?this.controls[r]:null}};var qb=new ot("CallSetDisabledState",{providedIn:"root",factory:()=>Zb}),Zb="always";function gU(i,r){return[...r.path,i]}function oD(i,r,a=Zb){cD(i,r),r.valueAccessor.writeValue(i.value),(i.disabled||a==="always")&&r.valueAccessor.setDisabledState?.(i.disabled),Uie(i,r),Hie(i,r),$ie(i,r),Vie(i,r)}function YV(i,r,a=!0){let c=()=>{};r.valueAccessor&&(r.valueAccessor.registerOnChange(c),r.valueAccessor.registerOnTouched(c)),Hb(i,r),i&&(r._invokeOnDestroyCallbacks(),i._registerOnCollectionChange(()=>{}))}function $b(i,r){i.forEach(a=>{a.registerOnValidatorChange&&a.registerOnValidatorChange(r)})}function Vie(i,r){if(r.valueAccessor.setDisabledState){let a=c=>{r.valueAccessor.setDisabledState(c)};i.registerOnDisabledChange(a),r._registerOnDestroy(()=>{i._unregisterOnDisabledChange(a)})}}function cD(i,r){let a=dU(i);r.validator!==null?i.setValidators(WV(a,r.validator)):typeof a=="function"&&i.setValidators([a]);let c=hU(i);r.asyncValidator!==null?i.setAsyncValidators(WV(c,r.asyncValidator)):typeof c=="function"&&i.setAsyncValidators([c]);let h=()=>i.updateValueAndValidity();$b(r._rawValidators,h),$b(r._rawAsyncValidators,h)}function Hb(i,r){let a=!1;if(i!==null){if(r.validator!==null){let h=dU(i);if(Array.isArray(h)&&h.length>0){let m=h.filter(y=>y!==r.validator);m.length!==h.length&&(a=!0,i.setValidators(m))}}if(r.asyncValidator!==null){let h=hU(i);if(Array.isArray(h)&&h.length>0){let m=h.filter(y=>y!==r.asyncValidator);m.length!==h.length&&(a=!0,i.setAsyncValidators(m))}}}let c=()=>{};return $b(r._rawValidators,c),$b(r._rawAsyncValidators,c),a}function Uie(i,r){r.valueAccessor.registerOnChange(a=>{i._pendingValue=a,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&_U(i,r)})}function $ie(i,r){r.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&_U(i,r),i.updateOn!=="submit"&&i.markAsTouched()})}function _U(i,r){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),r.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function Hie(i,r){let a=(c,h)=>{r.valueAccessor.writeValue(c),h&&r.viewToModelUpdate(c)};i.registerOnChange(a),r._registerOnDestroy(()=>{i._unregisterOnChange(a)})}function Gie(i,r){i==null,cD(i,r)}function Wie(i,r){return Hb(i,r)}function yU(i,r){if(!i.hasOwnProperty("model"))return!1;let a=i.model;return a.isFirstChange()?!0:!Object.is(r,a.currentValue)}function qie(i){return Object.getPrototypeOf(i.constructor)===wie}function Zie(i,r){i._syncPendingControls(),r.forEach(a=>{let c=a.control;c.updateOn==="submit"&&c._pendingChange&&(a.viewToModelUpdate(c._pendingValue),c._pendingChange=!1)})}function vU(i,r){if(!r)return null;Array.isArray(r);let a,c,h;return r.forEach(m=>{m.constructor===Xp?a=m:qie(m)?c=m:h=m}),h||c||a||null}function Yie(i,r){let a=i.indexOf(r);a>-1&&i.splice(a,1)}function XV(i,r){let a=i.indexOf(r);a>-1&&i.splice(a,1)}function KV(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var rf=class extends Vb{constructor(r=null,a,c){super(pU(a),mU(c,a)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(r),this._setUpdateStrategy(a),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Wb(a)&&(a.nonNullable||a.initialValueIsDefault)&&(KV(r)?this.defaultValue=r.value:this.defaultValue=r)}setValue(r,a={}){this.value=this._pendingValue=r,this._onChange.length&&a.emitModelToViewChange!==!1&&this._onChange.forEach(c=>c(this.value,a.emitViewToModelChange!==!1)),this.updateValueAndValidity(a)}patchValue(r,a={}){this.setValue(r,a)}reset(r=this.defaultValue,a={}){this._applyFormState(r),this.markAsPristine(a),this.markAsUntouched(a),this.setValue(this.value,a),this._pendingChange=!1}_updateValue(){}_anyControls(r){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(r){this._onChange.push(r)}_unregisterOnChange(r){XV(this._onChange,r)}registerOnDisabledChange(r){this._onDisabledChange.push(r)}_unregisterOnDisabledChange(r){XV(this._onDisabledChange,r)}_forEachChild(r){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(r){KV(r)?(this.value=this._pendingValue=r.value,r.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=r}};var Xie=i=>i instanceof rf;var Kie={provide:nf,useExisting:Lh(()=>uD)},JV=Promise.resolve(),uD=(()=>{let r=class r extends nf{constructor(c,h,m,y,w,C){super(),this._changeDetectorRef=w,this.callSetDisabledState=C,this.control=new rf,this._registered=!1,this.name="",this.update=new Zn,this._parent=c,this._setValidators(h),this._setAsyncValidators(m),this.valueAccessor=vU(this,y)}ngOnChanges(c){if(this._checkForErrors(),!this._registered||"name"in c){if(this._registered&&(this._checkName(),this.formDirective)){let h=c.name.previousValue;this.formDirective.removeControl({name:h,path:this._getPath(h)})}this._setUpControl()}"isDisabled"in c&&this._updateDisabled(c),yU(c,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(c){this.viewModel=c,this.update.emit(c)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){oD(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(c){JV.then(()=>{this.control.setValue(c,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(c){let h=c.isDisabled.currentValue,m=h!==0&&Gh(h);JV.then(()=>{m&&!this.control.disabled?this.control.disable():!m&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(c){return this._parent?gU(c,this._parent):[c]}};r.\u0275fac=function(h){return new(h||r)(me(tf,9),me(aD,10),me(lD,10),me(sD,10),me(co,8),me(qb,8))},r.\u0275dir=pn({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[Bi.None,"disabled","isDisabled"],model:[Bi.None,"ngModel","model"],options:[Bi.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[si([Kie]),uo,na]});let i=r;return i})(),xU=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275dir=pn({type:r,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let i=r;return i})();var bU=new ot("");var Jie={provide:tf,useExisting:Lh(()=>dD)},dD=(()=>{let r=class r extends tf{constructor(c,h,m){super(),this.callSetDisabledState=m,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Zn,this._setValidators(c),this._setAsyncValidators(h)}ngOnChanges(c){this._checkFormPresent(),c.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Hb(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(c){let h=this.form.get(c.path);return oD(h,c,this.callSetDisabledState),h.updateValueAndValidity({emitEvent:!1}),this.directives.push(c),h}getControl(c){return this.form.get(c.path)}removeControl(c){YV(c.control||null,c,!1),Yie(this.directives,c)}addFormGroup(c){this._setUpFormContainer(c)}removeFormGroup(c){this._cleanUpFormContainer(c)}getFormGroup(c){return this.form.get(c.path)}addFormArray(c){this._setUpFormContainer(c)}removeFormArray(c){this._cleanUpFormContainer(c)}getFormArray(c){return this.form.get(c.path)}updateModel(c,h){this.form.get(c.path).setValue(h)}onSubmit(c){return this.submitted=!0,Zie(this.form,this.directives),this.ngSubmit.emit(c),c?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(c=void 0){this.form.reset(c),this.submitted=!1}_updateDomValue(){this.directives.forEach(c=>{let h=c.control,m=this.form.get(c.path);h!==m&&(YV(h||null,c),Xie(m)&&(oD(m,c,this.callSetDisabledState),c.control=m))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(c){let h=this.form.get(c.path);Gie(h,c),h.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(c){if(this.form){let h=this.form.get(c.path);h&&Wie(h,c)&&h.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){cD(this.form,this),this._oldForm&&Hb(this._oldForm,this)}_checkFormPresent(){this.form}};r.\u0275fac=function(h){return new(h||r)(me(aD,10),me(lD,10),me(qb,8))},r.\u0275dir=pn({type:r,selectors:[["","formGroup",""]],hostBindings:function(h,m){h&1&&Kt("submit",function(w){return m.onSubmit(w)})("reset",function(){return m.onReset()})},inputs:{form:[Bi.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[si([Jie]),uo,na]});let i=r;return i})();var Qie={provide:nf,useExisting:Lh(()=>hD)},hD=(()=>{let r=class r extends nf{set isDisabled(c){}constructor(c,h,m,y,w){super(),this._ngModelWarningConfig=w,this._added=!1,this.name=null,this.update=new Zn,this._ngModelWarningSent=!1,this._parent=c,this._setValidators(h),this._setAsyncValidators(m),this.valueAccessor=vU(this,y)}ngOnChanges(c){this._added||this._setUpControl(),yU(c,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(c){this.viewModel=c,this.update.emit(c)}get path(){return gU(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};r._ngModelWarningSentOnce=!1,r.\u0275fac=function(h){return new(h||r)(me(tf,13),me(aD,10),me(lD,10),me(sD,10),me(bU,8))},r.\u0275dir=pn({type:r,selectors:[["","formControlName",""]],inputs:{name:[Bi.None,"formControlName","name"],isDisabled:[Bi.None,"disabled","isDisabled"],model:[Bi.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[si([Qie]),uo,na]});let i=r;return i})();var wU=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275mod=wt({type:r}),r.\u0275inj=bt({});let i=r;return i})();var TU=(()=>{let r=class r{static withConfig(c){return{ngModule:r,providers:[{provide:qb,useValue:c.callSetDisabledState??Zb}]}}};r.\u0275fac=function(h){return new(h||r)},r.\u0275mod=wt({type:r}),r.\u0275inj=bt({imports:[wU]});let i=r;return i})(),EU=(()=>{let r=class r{static withConfig(c){return{ngModule:r,providers:[{provide:bU,useValue:c.warnOnNgModelWithFormControl??"always"},{provide:qb,useValue:c.callSetDisabledState??Zb}]}}};r.\u0275fac=function(h){return new(h||r)},r.\u0275mod=wt({type:r}),r.\u0275inj=bt({imports:[wU]});let i=r;return i})();var ts=()=>!1,Ed=()=>!0;var IU={bottom:0,height:0,left:0,right:0,top:0,width:0,x:0,y:0},mve=new Yg,CU=[];var ere=Object.assign(Object.assign({},IU),{toJSON(){return IU}});var Yb=Nr("tuiParentAnimation",[ni(":leave",[xo(":scope > *",[__()],{optional:!0})])]),gve=Nr("tuiParentStop",[ni(":enter",[])]),Xb=1e3/15,SU=i=>"ownerSVGElement"in i?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT,I_="\xA0",DU="\u2013";var AU="3.65.0";function PU(i){return i.toLowerCase().includes("firefox")}function OU({ownerDocument:i}){var r,a,c,h,m,y,w,C;let D=i?.defaultView,z=typeof D.safari<"u"&&((a=(r=D.safari)===null||r===void 0?void 0:r.pushNotification)===null||a===void 0?void 0:a.toString())==="[object SafariRemoteNotification]",j=!!(!((h=(c=D.navigator)===null||c===void 0?void 0:c.vendor)===null||h===void 0)&&h.includes("Apple"))&&!(!((y=(m=D.navigator)===null||m===void 0?void 0:m.userAgent)===null||y===void 0)&&y.includes("CriOS"))&&!(!((C=(w=D.navigator)===null||w===void 0?void 0:w.userAgent)===null||C===void 0)&&C.includes("FxiOS"));return z||j}function RU(i,r,a){return Math.min(a,Math.max(r,i))}function of(i,r,a){return i>=r&&i<a}function Kb(i,r,a){return Number.isNaN(i)||i<=r?r:i>=a?a:Math.round(i)}function LU(i,r){return i.slice(0,Math.max(r,0)).concat(i.slice(Math.max(r+1,0)))}function bu(i){return typeof i=="string"}function ki(i){return ii(()=>i)}function ii(i){return new ot("",{factory:i})}function FU(i){return!i}function kU(i){return typeof i=="number"}function NU(i){return i!=null}function Jb(i,r,a){return i===null?r===null:r===null?!1:a(i,r)}function tre(i,r,a){let c=i;for(;c!==r.parentElement;){if(Math.floor(c.scrollTop)>0&&!a||Math.ceil(c.scrollTop+c.clientHeight)<c.scrollHeight&&a)return!0;if(c.parentElement)c=c.parentElement;else return!1}return!1}function nre(i,r,a){let c=i;for(;c!==r.parentElement;){if(Math.floor(c.scrollLeft)>0&&!a||Math.ceil(c.scrollLeft+c.clientWidth)<c.scrollWidth&&a)return!0;if(c.parentElement)c=c.parentElement;else return!1}return!1}function C_(i,r,a,c){return a?tre(i,r,c):nre(i,r,c)}function Qb(i,r){try{return i.contains(r)||!!(r.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_PRECEDING)}catch{return!1}}function sf(i){return!!i&&"nodeType"in i&&i.nodeType===Node.ELEMENT_NODE}function Md(i){return!!i&&i instanceof i.ownerDocument.defaultView.HTMLElement}function Id(i){return i.composedPath()[0]}function S_(i){return"getRootNode"in i&&i.isConnected?i.getRootNode():i.ownerDocument}function zU(i,r){let{offsetTop:a,offsetLeft:c,offsetParent:h}=r;for(;Md(h)&&h!==i;)a+=h.offsetTop,c+=h.offsetLeft,h=h.offsetParent;return{offsetTop:a,offsetLeft:c}}function e1(i,r=!0){return i===null?null:r&&i.scrollHeight>i.clientHeight||!r&&i.scrollWidth>i.clientWidth?i:e1(i.parentElement,r)}function D_({activeElement:i}){if(!i?.shadowRoot)return i;let r=i.shadowRoot.activeElement;for(;r?.shadowRoot;)r=r.shadowRoot.activeElement;return r}function t1(i){let r=D_(i);Md(r)&&r.blur()}function BU(i){if(i.hasAttribute("disabled")||i.getAttribute("tabIndex")==="-1")return!1;if(Md(i)&&i.isContentEditable||i.getAttribute("tabIndex")==="0")return!0;switch(i.tagName){case"BUTTON":case"SELECT":case"TEXTAREA":return!0;case"VIDEO":case"AUDIO":return i.hasAttribute("controls");case"INPUT":return i.getAttribute("type")!=="hidden";case"A":case"LINK":return i.hasAttribute("href");default:return!1}}function ire(i){return!i.hasAttribute("disabled")&&(i.getAttribute("tabIndex")==="-1"||BU(i))}function jU({initial:i,root:r,previous:a=!1,keyboard:c=!0}){if(!r.ownerDocument)return null;let h=c?BU:ire,m=r.ownerDocument.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,SU);for(m.currentNode=i;a?m.previousNode():m.nextNode();)if(Md(m.currentNode)&&(i=m.currentNode),Md(i)&&h(i))return i;return null}function Kp(i){return!!i?.ownerDocument&&D_(i.ownerDocument)===i&&i.ownerDocument.hasFocus()}function n1(i){if(!i.ownerDocument||!i.contains)return!1;let r=D_(i.ownerDocument);return r!==null&&i.contains(r)&&i.ownerDocument.hasFocus()}function Jp(i){return`${i}px`}function rre(i){return i.platform.startsWith("Mac")||i.platform==="iPhone"}var ore=/ipad|iphone|ipod/;function fD(i){return ore.test(i.userAgent.toLowerCase())||rre(i)&&i.maxTouchPoints>1}var sre=/^((?!chrome|android).)*safari/i;function VU(i){return fD(i)||sre.test(i.userAgent.toLowerCase())}function are(){return Math.floor(Math.random()*Date.now())}function lre(i){return i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function cre(i){var r;let a=((r=i.match(/url\(("?)('*)#(.*?)('*)\)/g))!==null&&r!==void 0?r:[]).map(c=>c.slice(4,c.length-1).replace(/['"#]+/g,""));return Array.from(new Set(a))}function ure(i,r){try{let a=new DOMParser().parseFromString(i,"text/html");return a.body.querySelectorAll("[fill^=url]").forEach(c=>c.setAttribute("fill",`${c.getAttribute("fill")} ${r}`.trim())),a.body.innerHTML.trim()}catch{return i}}function i1(i,r=are(),a="rgba(0, 0, 0, 0.7)"){if(bu(i)){let h=cre(i).reduce((m,y)=>{let w=lre(y),C=`id_${r}_${y}`;return m.replace(new RegExp(`"${w}"`,"g"),`"${C}"`).replace(new RegExp(`'${w}'`,"g"),`'${C}'`).replace(new RegExp(`url\\('#${w}'\\)`,"g"),`url('#${C}')`).replace(new RegExp(`url\\("#${w}"\\)`,"g"),`url("#${C}")`).replace(new RegExp(`url\\(#${w}\\)`,"g"),`url(#${C})`)},i);return ure(h,a)}return i}var r1=class extends Error{constructor(r){super("")}},o1=class extends Error{constructor(r){super("")}},s1=class extends Error{constructor(r){super("")}},a1=class extends Error{constructor(){super("")}},A_=class extends Error{constructor(){super("")}},P_=class extends Error{constructor(){super("")}};function Un(i,r,a={}){return Wa(i,r,a)}function hre(i){return go(Un(i,"mouseup"),Un(i,"dragend"))}function UU(i=0){return _p(Fi(()=>Zo(i).pipe(st(ts),xr(!0))),Ro())}var pD,mD;function $U(i){let r=Un(i,"blur"),{ownerDocument:a}=i;if(!a)throw new A_;return(!mD||!pD)&&(pD=Un(a,"mouseup",{capture:!0}).pipe(UU(),xr(!1),va({bufferSize:1,refCount:!0})),mD=Un(a,"mousedown",{capture:!0}).pipe(UU(),xr(!1),va({bufferSize:1,refCount:!0}))),go(cc(Un(i,"focus").pipe(Bo(1)),r.pipe(zi(()=>!Kp(i)),Bo(1),DM())).pipe(L0(),Ag(mD,pD,(c,h,m)=>h||m),zi(FU))).pipe(Fi(()=>r.pipe(st(ts),Bo(1),xr(!0))),Ro())}function HU(i){var r,a;return"observed"in i?i.observed:!!(!((a=(r=i)===null||r===void 0?void 0:r.observers)===null||a===void 0)&&a.length)}function GU(i,{onlyTrusted:r}={onlyTrusted:!0}){let{ownerDocument:a}=i;if(!a)throw new A_;return Un(i,"mousedown").pipe(zi(({isTrusted:c})=>c||!r),Fi(()=>hre(a).pipe(st(ts),Bo(1),xr(!0))))}function WU(i){return Un(i===i.ownerDocument.documentElement?i.ownerDocument:i,"scroll")}function qU(){return Vr(i=>{i.stopPropagation()})}function ZU(i){return Vr(()=>{i.markForCheck()})}function fre(i){return r=>new un(a=>r.subscribe({next:c=>i.run(()=>a.next(c)),error:c=>i.run(()=>a.error(c)),complete:()=>i.run(()=>a.complete())}))}function wu(i){return r=>new un(a=>i.runOutsideAngular(()=>r.subscribe(a)))}function Ll(i){return _p(wu(i),fre(i))}var lf=new ot("POLYMORPHEUS_CONTEXT"),af=class{constructor(r,a){this.component=r,this.i=a}createInjector(r,a){return ys.create({parent:this.i||r,providers:[{provide:lf,useValue:a}]})}},pre=(()=>{class i{constructor(a,c){this.template=a,this.cdr=c,this.polymorpheus=""}check(){this.cdr.markForCheck()}static ngTemplateContextGuard(a,c){return!0}}return i.\u0275fac=function(a){return new(a||i)(me(es,2),me(co))},i.\u0275dir=pn({type:i,selectors:[["ng-template","polymorpheus",""]],inputs:{polymorpheus:"polymorpheus"},exportAs:["polymorpheus"]}),i})(),l1=class{constructor(r){this.$implicit=r}get polymorpheusOutlet(){return this.$implicit}};var oa=(()=>{class i{constructor(a,c,h){this.vcr=a,this.i=c,this.t=h,this.content=""}get template(){return gD(this.content)?this.content.template:this.content instanceof es?this.content:this.t}ngOnChanges({content:a}){var c;let h=this.getContext();if((c=this.c)===null||c===void 0||c.injector.get(co).markForCheck(),!a)return;this.vcr.clear();let m=h&&new Proxy(h,{get:(y,w)=>{var C;return(C=this.getContext())===null||C===void 0?void 0:C[w]}});YU(this.content)?this.process(this.content,m):(h instanceof l1&&h.$implicit)!=null&&this.vcr.createEmbeddedView(this.template,m)}ngDoCheck(){gD(this.content)&&this.content.check()}static ngTemplateContextGuard(a,c){return!0}getContext(){return mre(this.content)||YU(this.content)?this.context:new l1(typeof this.content=="function"?this.content(this.context):this.content)}process(a,c){let h=a.createInjector(this.i,c);this.c=this.vcr.createComponent(h.get(pu).resolveComponentFactory(a.component),0,h)}}return i.\u0275fac=function(a){return new(a||i)(me(as),me(ys),me(es))},i.\u0275dir=pn({type:i,selectors:[["","polymorpheusOutlet",""]],inputs:{content:[Bi.None,"polymorpheusOutlet","content"],context:[Bi.None,"polymorpheusOutletContext","context"]},features:[na]}),i})();function gD(i){return i instanceof pre}function YU(i){return i instanceof af}function mre(i){return gD(i)||i instanceof es}var sa=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var Ui=new ot("An abstraction over global window object",{factory:()=>{let{defaultView:i}=Ee(jn);if(!i)throw new Error("Window is not available");return i}}),uf=new ot("Shared Observable based on `window.requestAnimationFrame`",{factory:()=>{let{requestAnimationFrame:i,cancelAnimationFrame:r}=Ee(Ui);return new un(c=>{let h=NaN,m=y=>{c.next(y),h=i(m)};return h=i(m),()=>{r(h)}}).pipe(ya())}}),Zve=new ot("An abstraction over window.caches object",{factory:()=>Ee(Ui).caches}),Yve=new ot("An abstraction over window.crypto object",{factory:()=>Ee(Ui).crypto}),XU=new ot("An abstraction over window.CSS object",{factory:()=>Ee(Ui).CSS||{escape:i=>i,supports:()=>!1}}),KU=new ot("An abstraction over window.history object",{factory:()=>Ee(Ui).history}),Xve=new ot("An abstraction over window.localStorage object",{factory:()=>Ee(Ui).localStorage}),Kve=new ot("An abstraction over window.location object",{factory:()=>Ee(Ui).location}),Qp=new ot("An abstraction over window.navigator object",{factory:()=>Ee(Ui).navigator}),Jve=new ot("An abstraction over window.navigator.mediaDevices object",{factory:()=>Ee(Qp).mediaDevices}),Qve=new ot("An abstraction over window.navigator.connection object",{factory:()=>Ee(Qp).connection||null}),e0e=new ot("Shared Observable based on `document visibility changed`",{factory:()=>{let i=Ee(jn);return Wa(i,"visibilitychange").pipe(xr(0),st(()=>i.visibilityState!=="hidden"),Ro(),va({refCount:!1,bufferSize:1}))}}),gre=new ot("An abstraction over window.performance object",{factory:()=>Ee(Ui).performance}),t0e=new ot("An abstraction over window.screen object",{factory:()=>Ee(Ui).screen}),n0e=new ot("An abstraction over window.sessionStorage object",{factory:()=>Ee(Ui).sessionStorage}),i0e=new ot("An abstraction over SpeechRecognition class",{factory:()=>{let i=Ee(Ui);return i.speechRecognition||i.webkitSpeechRecognition||null}}),r0e=new ot("An abstraction over window.speechSynthesis object",{factory:()=>Ee(Ui).speechSynthesis}),O_=new ot("An abstraction over window.navigator.userAgent object",{factory:()=>Ee(Qp).userAgent});function _D(i,r={}){let{selector:a}=r,c=TN(r,["selector"]);return new un(h=>{let m=new AbortController,{signal:y}=m,w=!0,{signal:C}=c;if(C)if(C.aborted)m.abort();else{let j=()=>{y.aborted||m.abort()};C.addEventListener("abort",j),h.add(()=>C.removeEventListener("abort",j))}let D=Object.assign(Object.assign({},c),{signal:y}),z=j=>{w=!1,h.error(j)};return fetch(i,D).then(j=>{a?yi(a(j)).subscribe(en(h,void 0,()=>{w=!1,h.complete()},z)):(w=!1,h.next(j),h.complete())}).catch(z),()=>{w&&m.abort()}})}var _re=ii(()=>{let i={onRemovalComplete:()=>{}},r=new pr(null),a=Ee(wd,vi.Optional)||i,{onRemovalComplete:c=i.onRemovalComplete}=a;return a.onRemovalComplete=(h,m)=>{r.next(h),c.call(a,h,m)},r.pipe(Fi(h=>Zo(0).pipe(st(()=>null),xr(h))),ya())});function JU(i,r=null){return S_(i).activeElement!==i&&!i.matches(":disabled")&&!r?.contains(i)}function yre(i){return go(Un(i,"focusin").pipe(st(({target:r})=>r)),Un(i,"focusout").pipe(zi(({target:r,relatedTarget:a})=>!!a&&JU(r)),st(({relatedTarget:r})=>r)))}var QU=ii(()=>{let i=Ee(_re),r=Ee(Ui),a=Ee(jn),c=Un(r,"focusout"),h=Un(r,"focusin"),m=Un(r,"blur"),y=Un(r,"mousedown"),w=Un(r,"mouseup");return go(c.pipe(Ii(y),Dg(()=>w),Ag(i),zi(([C,D])=>JU(Id(C),D)),st(([{relatedTarget:C}])=>C)),m.pipe(st(()=>a.activeElement),zi(C=>!!C?.matches("iframe"))),h.pipe(Fi(C=>{let D=Id(C),z=S_(D);return z===a?Nt(D):yre(z).pipe(xr(D))})),y.pipe(Fi(C=>{let D=Id(C);return!a.activeElement||a.activeElement===a.body?Nt(D):c.pipe(Bo(1),st(()=>D),Ii(Zo(0)))}))).pipe(Ro(),ya())}),yD=ki([]);function e4(i){return{provide:yD,multi:!0,useExisting:i}}var t4=ii(()=>{var i,r;return(r=(i=Ee(jn).querySelector("base"))===null||i===void 0?void 0:i.href)!==null&&r!==void 0?r:""}),w0e=ii(()=>Ee(su).createRenderer(null,null)),R_=ki([]);function n4(i){return{provide:R_,multi:!0,useExisting:i}}var T0e=ii(()=>{var i;let r=(i=Ee(jn).querySelector("base"))===null||i===void 0?void 0:i.href;if(r)return r;let a=Ee(jn).createElement("a");return a.href="",a.pathname}),L_=new ot("[TUI_FOCUSABLE_ITEM_ACCESSOR]");function c1(i){return{provide:L_,useExisting:i}}var E0e=new ot("[TUI_FONTS_READY]",{factory:()=>{var i;return vr(((i=Ee(jn).fonts)===null||i===void 0?void 0:i.ready)||Lr).pipe(va({bufferSize:1,refCount:!1}))}}),Tu=ii(()=>fD(Ee(Qp))),vre=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/,xre=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/,Eu=ii(()=>vre.test(Ee(O_).toLowerCase())||xre.test(Ee(O_).slice(0,4).toLowerCase())),i4=ii(()=>Ee(Eu)&&!Ee(Tu)),M0e=ii(()=>VU(Ee(Qp))),I0e=ii(()=>!!Ee(Ui).chrome),bre=ii(()=>!!Ee(Ui).Cypress),wre=ii(ts),C0e=ii(()=>Ee(bre)||Ee(wre)),S0e=ii(()=>{var i;return typeof((i=Ee(Ui))===null||i===void 0?void 0:i.mozCancelFullScreen)<"u"}),D0e=ii(()=>Ee(Ui).location.host.endsWith("stackblitz.io")),Tre=ii(()=>{var i;return!!(!((i=Ee(Ui))===null||i===void 0)&&i.webkitConvertPointFromNodeToPage)}),A0e=ki("web");var P0e=ii(()=>Bj(Ee(vs))?new Range:{}),df=ii(()=>new mn(Ee(jn).documentElement)),O0e=ki({timeout:500,threshold:30}),r4=ii(Ed),R0e=ii(()=>Ee(Ui).matchMedia("(any-pointer: coarse)").matches),vD=new ot("[TUI_WINDOW_SIZE]",{factory:()=>{let i=Ee(Ui);return Un(i,"resize").pipe(xr(null),st(()=>{var r,a;let c=Math.max(i.document.documentElement.clientWidth||0,i.innerWidth||0,((r=i.visualViewport)===null||r===void 0?void 0:r.width)||0),h=Math.max(i.document.documentElement.clientHeight||0,i.innerHeight||0,((a=i.visualViewport)===null||a===void 0?void 0:a.height)||0);return{width:c,height:h,top:0,left:0,right:c,bottom:h}}),va({bufferSize:1,refCount:!0}))}}),L0e=ii(()=>Ee(vD).pipe(st(({height:i})=>i))),F0e=ki({wheelSensitivity:.01});var Ci=(()=>{class i extends Kc{constructor(){super(1)}ngOnDestroy(){this.next(),this.complete()}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})();var xD=(()=>{class i extends un{constructor({nativeElement:a},c,h){super(m=>this.focusVisible$.subscribe(m)),this.focusVisible$=$U(a).pipe(ZU(c),Ii(h))}}return i.\u0275fac=function(a){return new(a||i)(Ct(mn),Ct(co),Ct(Ci,2))},i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),Ere="tui_",u1=(()=>{class i{generate(){return`${Ere}${i.autoId++}${Date.now()}`}}return i.autoId=0,i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var o4=(()=>{class i{constructor(a,c){this.win=a,this.platformId=c,this.cache=new Map}request(a){let c=this.cache.get(a);if(c)return c;let m=("AbortController"in this.win||qh(this.platformId)?_D(a):rd(()=>vr(fetch(a)))).pipe(Fi(y=>y0(this,void 0,void 0,function*(){if(y.ok)return y.text();throw new Error(`Failed to load ${a} (${y.statusText})`)})),va({bufferSize:1,refCount:!1}));return this.cache.set(a,m),m}}return i.\u0275fac=function(a){return new(a||i)(Ct(Ui),Ct(vs))},i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Mre=["viewContainer"],Ire="tui_interactive_",d1=(()=>{class i{constructor(){this.pseudoHover=null,this.pseudoActive=null,this.pseudoFocus=null,this.focusable=!0,this.nativeId="",this.focusedChange=new Zn,this.focusVisibleChange=new Zn,this.focusVisible=!1,this.autoIdString=`${Ire}${i.autoId++}${Date.now()}`}get computedDisabled(){return this.disabled}get computedFocusable(){return!this.computedDisabled&&(this.focusable||this.focused)}get computedFocused(){var a;return!this.computedDisabled&&((a=this.pseudoFocus)!==null&&a!==void 0?a:this.focused)}get computedFocusVisible(){var a;return!this.computedDisabled&&((a=this.pseudoFocus)!==null&&a!==void 0?a:this.focusVisible)}get id(){return this.nativeId||this.autoIdString}updateFocused(a){this.focusedChange.emit(a)}updateFocusVisible(a){this.focusVisible!==a&&(this.focusVisible=a,this.focusVisibleChange.emit(a))}}return i.autoId=0,i.\u0275fac=function(a){return new(a||i)},i.\u0275dir=pn({type:i,hostVars:7,hostBindings:function(a,c){a&2&&(Mr("data-focused",c.pseudoFocus),ti("_disabled",c.computedDisabled)("_focused",c.computedFocused)("_focus-visible",c.computedFocusVisible))},inputs:{pseudoHover:"pseudoHover",pseudoActive:"pseudoActive",pseudoFocus:"pseudoFocus",focusable:"focusable",nativeId:"nativeId"},outputs:{focusedChange:"focusedChange",focusVisibleChange:"focusVisibleChange"}}),i})();var s4=(()=>{class i{constructor(){this.change$=new Qr}ngOnChanges(){this.change$.next()}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275dir=pn({type:i,features:[na]}),i})(),h1=(()=>{class i extends un{constructor(a){super(c=>this.dialogs$.subscribe(c)),this.idService=a,this.dialogs$=new pr([])}open(a,c={}){return new un(h=>{let m=w=>{h.next(w),h.complete()},y=Object.assign(Object.assign(Object.assign({},this.defaultOptions),c),{content:a,completeWith:m,$implicit:h,component:this.component,createdAt:Date.now(),id:this.idService.generate()});return this.dialogs$.next([...this.dialogs$.value,y]),()=>{this.dialogs$.next(this.dialogs$.value.filter(w=>w!==y))}})}}return i.\u0275fac=function(a){return new(a||i)(Ct(u1))},i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})();var f1=(()=>{class i{get safeHost(){if(!this.host)throw new a1;return this.host}attach(a){this.host=a}add(a){return this.safeHost.addComponentChild(a)}remove({hostView:a}){a.destroyed||a.destroy()}addTemplate(a,c){return this.safeHost.addTemplateChild(a,c)}removeTemplate(a){a.destroyed||a.destroy()}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),bD=(()=>{class i{constructor(a,c,h){this.injector=a,this.el=c,h.attach(this)}get clientRect(){return this.el.nativeElement.getBoundingClientRect()}addComponentChild(a){let c=a.createInjector(this.injector),m=c.get(pu).resolveComponentFactory(a.component),y=[{provide:i,useValue:this}],w=ys.create({parent:c,providers:y}),C=this.vcr.createComponent(m,void 0,w);return C.changeDetectorRef.detectChanges(),C}addTemplateChild(a,c){return this.vcr.createEmbeddedView(a,c)}}return i.\u0275fac=function(a){return new(a||i)(me(Nh),me(mn),me(f1))},i.\u0275dir=pn({type:i,viewQuery:function(a,c){if(a&1&&cj(Mre,5,as),a&2){let h;JC(h=QC())&&(c.vcr=h.first)}}}),i})();function a4(i){return i!==null&&typeof i<"u"&&`${i}`!="false"}var em=(()=>{class i{transform(a,c,...h){return c(a,...h)}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275pipe=qa({name:"tuiMapper",type:i,pure:!0}),i})(),tm=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();function Cre(i,r){if(i&1&&(Pl(0,3),ai(1,"tuiMapper")),i&2){let a=r.$implicit,c=yt(2);Xe("ngComponentOutlet",a.component.component)("ngComponentOutletInjector",Xa(1,2,a,c.mapper))}}function Sre(i,r){if(i&1&&(He(0,"div",1),It(1,Cre,2,5,"ng-container",2),We()),i&2){let a=r.$implicit;Xe("@tuiParentAnimation",void 0),qe(),Xe("ngForOf",a)}}var l4=(()=>{class i{constructor(a,c,h,m){this.allAlerts=a,this.injector=c,this.destroy$=h,this.cdr=m,this.alerts=[],this.trackBy=y=>y,this.mapper=y=>ys.create({providers:[{provide:lf,useValue:y}],parent:this.injector})}ngOnInit(){lc(this.allAlerts).pipe(Ii(this.destroy$)).subscribe(a=>{this.alerts=a,this.cdr.detectChanges()})}}return i.\u0275fac=function(a){return new(a||i)(me(yD),me(Nh),me(Ci,2),me(co))},i.\u0275cmp=Cn({type:i,selectors:[["tui-alert-host"]],features:[si([Ci])],decls:1,vars:2,consts:[["class","t-wrapper",4,"ngFor","ngForOf","ngForTrackBy"],[1,"t-wrapper"],[3,"ngComponentOutlet","ngComponentOutletInjector",4,"ngFor","ngForOf"],[3,"ngComponentOutlet","ngComponentOutletInjector"]],template:function(a,c){a&1&&It(0,Sre,2,2,"div",0),a&2&&Xe("ngForOf",c.alerts)("ngForTrackBy",c.trackBy)},dependencies:[Ja,Nj,em],styles:[`tui-alert-host>.t-wrapper{position:fixed;top:0;left:0;display:flex;width:100%;height:100%;flex-direction:column;pointer-events:none}tui-alert-host>.t-wrapper>*{pointer-events:auto}
`],encapsulation:2,data:{animation:[Yb]}}),i})(),c4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,tm]]}),i})();function Dre(i,r){if(i&1&&(He(0,"div",3),wn(1,"div",4),We()),i&2){let a=yt().ngIf;ti("t-bar_has-horizontal",a[1])}}function Are(i,r){if(i&1&&(He(0,"div",5),wn(1,"div",6),We()),i&2){let a=yt().ngIf;ti("t-bar_has-vertical",a[0])}}function Pre(i,r){if(i&1&&(Ur(0),It(1,Dre,2,2,"div",1)(2,Are,2,2,"div",2),$r()),i&2){let a=r.ngIf;qe(),Xe("ngIf",a[0]),qe(),Xe("ngIf",a[1])}}var p1=24;function Ore({clientY:i},{top:r,height:a}){return(i-r)/a}function Rre({clientX:i},{left:r,width:a}){return(i-r)/a}var Lre=(()=>{class i{constructor(a,c,h,m,y,w){this.container=m,this.doc=y,this.el=w,this.tuiScrollbar="vertical";let{nativeElement:C}=this.el,D=Un(C,"mousedown"),z=Un(this.doc,"mousemove"),j=Un(this.doc,"mouseup"),ie=Un(this.wrapper,"mousedown");go(ie.pipe(st(oe=>this.getScrolled(oe,.5,.5))),D.pipe(qU(),Fi(oe=>{let he=C.getBoundingClientRect(),ke=Ore(oe,he),rt=Rre(oe,he);return z.pipe(st(Ve=>this.getScrolled(Ve,ke,rt)),Ii(j))}))).pipe(wu(a),Ii(c)).subscribe(([oe,he])=>{this.tuiScrollbar==="vertical"?this.element.scrollTop=oe:this.element.scrollLeft=he}),go(h.pipe(bh(Xb)),WU(this.element)).pipe(wu(a),Ii(c)).subscribe(()=>{this.tuiScrollbar==="vertical"?(C.style.top=`${this.thumb*100}%`,C.style.height=`${this.view*100}%`):(C.style.left=`${this.thumb*100}%`,C.style.width=`${this.view*100}%`)})}get wrapper(){return this.el.nativeElement.parentElement}get scrolled(){let{scrollTop:a,scrollHeight:c,clientHeight:h,scrollLeft:m,scrollWidth:y,clientWidth:w}=this.element;return this.tuiScrollbar==="vertical"?a/(c-h):m/(y-w)}get compensation(){let{clientHeight:a,scrollHeight:c,clientWidth:h,scrollWidth:m}=this.element;return a*a/c>p1&&this.tuiScrollbar==="vertical"||h*h/m>p1&&this.tuiScrollbar==="horizontal"?0:this.tuiScrollbar==="vertical"?p1/a:p1/h}get thumb(){let a=this.compensation||this.view;return this.scrolled*(1-a)}get view(){let{clientHeight:a,scrollHeight:c,clientWidth:h,scrollWidth:m}=this.element;return this.tuiScrollbar==="vertical"?Math.ceil(a/c*100)/100:Math.ceil(h/m*100)/100}get element(){return this.container.nativeElement}getScrolled({clientY:a,clientX:c},h,m){let{offsetHeight:y,offsetWidth:w}=this.el.nativeElement,{top:C,left:D,width:z,height:j}=this.wrapper.getBoundingClientRect(),ie=this.element.scrollHeight-j,oe=this.element.scrollWidth-z,he=(a-C-y*h)/(j-y),ke=(c-D-w*m)/(z-w);return[ie*he,oe*ke]}}return i.\u0275fac=function(a){return new(a||i)(me(oi),me(Ci,2),me(uf),me(df),me(jn),me(mn))},i.\u0275dir=pn({type:i,selectors:[["","tuiScrollbar",""]],inputs:{tuiScrollbar:"tuiScrollbar"},features:[si([Ci])]}),i})(),nm=(()=>{class i{constructor(a,c,h){this.zone=a,this.scrollRef=c,this.animationFrame$=h,this.refresh$=this.animationFrame$.pipe(bh(300),st(()=>this.scrollbars),xr([!1,!1]),Ro((m,y)=>m[0]===y[0]&&m[1]===y[1]),Ll(this.zone))}get scrollbars(){let{clientHeight:a,scrollHeight:c,clientWidth:h,scrollWidth:m}=this.scrollRef.nativeElement;return[Math.ceil(a/c*100)<100,Math.ceil(h/m*100)<100]}}return i.\u0275fac=function(a){return new(a||i)(me(oi),me(df),me(uf))},i.\u0275cmp=Cn({type:i,selectors:[["tui-scroll-controls"]],decls:2,vars:3,consts:[[4,"ngIf"],["class","t-bar t-bar_vertical",3,"t-bar_has-horizontal",4,"ngIf"],["class","t-bar t-bar_horizontal",3,"t-bar_has-vertical",4,"ngIf"],[1,"t-bar","t-bar_vertical"],["tuiScrollbar","vertical",1,"t-thumb"],[1,"t-bar","t-bar_horizontal"],["tuiScrollbar","horizontal",1,"t-thumb"]],template:function(a,c){a&1&&(It(0,Pre,3,2,"ng-container",0),ai(1,"async")),a&2&&Xe("ngIf",br(1,1,c.refresh$))},dependencies:[Ki,Lre,yo],styles:["[_nghost-%COMP%]{position:-webkit-sticky;position:sticky;top:0;left:0;z-index:1;min-width:calc(100% - 1px);min-height:calc(100% - 1px);max-width:calc(100% - 1px);max-height:calc(100% - 1px);float:left;-webkit-margin-end:calc(-100% + 1px);margin-inline-end:calc(-100% + 1px);pointer-events:none}.t-bar[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;pointer-events:auto;animation:tuiFadeIn var(--tui-duration, .3s) ease-in-out}.t-bar_vertical[_ngcontent-%COMP%]{top:0;width:.875rem}.t-bar_horizontal[_ngcontent-%COMP%]{left:0;height:.875rem}.t-bar_has-horizontal[_ngcontent-%COMP%]{bottom:.5rem}.t-bar_has-vertical[_ngcontent-%COMP%]{right:.5rem}.t-thumb[_ngcontent-%COMP%]{position:absolute;border-radius:6.25rem;border:.25rem solid transparent;cursor:pointer;pointer-events:auto;-webkit-user-select:none;-moz-user-select:none;user-select:none;background:currentColor;background-clip:content-box;box-sizing:border-box;transition:all var(--tui-duration, .3s) ease-in-out;transition-property:width,height,opacity;opacity:.2}.t-thumb[_ngcontent-%COMP%]:hover{opacity:.24}.t-thumb[_ngcontent-%COMP%]:active{opacity:.48}.t-bar_vertical[_ngcontent-%COMP%]   .t-thumb[_ngcontent-%COMP%]{right:0;width:.75rem;min-height:1.25rem}.t-bar_vertical[_ngcontent-%COMP%]:hover   .t-thumb[_ngcontent-%COMP%], .t-bar_vertical[_ngcontent-%COMP%]   .t-thumb[_ngcontent-%COMP%]:active{width:.875rem}.t-bar_horizontal[_ngcontent-%COMP%]   .t-thumb[_ngcontent-%COMP%]{bottom:0;height:.75rem;min-width:1.25rem}.t-bar_horizontal[_ngcontent-%COMP%]:hover   .t-thumb[_ngcontent-%COMP%], .t-bar_horizontal[_ngcontent-%COMP%]   .t-thumb[_ngcontent-%COMP%]:active{height:.875rem}"],changeDetection:0}),i})();var u4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275dir=pn({type:i,selectors:[["","tuiScrollRef",""]],features:[si([{provide:df,useExisting:mn}])]}),i})(),im=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn]]}),i})();function kre(i){let r=[],a=!1,c;return function(...m){return a&&r.length===m.length&&m.every((w,C)=>w===r[C])||(r=m,c=i.apply(this,m),a=!0),c}}function d4(i,r,a=!0){return function(){let h=i.call(this);return Object.defineProperty(this,r,{enumerable:a,value:h}),h}}function m1(i,r,a){if(typeof i=="function"){let C=r;if(C.kind==="getter")return d4(i,C.name);if(C.kind==="method")return kre(i);throw new P_}let{get:c,enumerable:h,value:m}=a,y=r;if(c)return{configurable:!0,enumerable:h,get:d4(c,y,h)};if(typeof m!="function")throw new P_;let w=m;return{configurable:!0,enumerable:h,get(){let C=[],D=!1,z,j=(...ie)=>(D&&C.length===ie.length&&ie.every((he,ke)=>he===C[ke])||(C=ie,z=w.apply(this,ie),D=!0),z);return Object.defineProperty(this,y,{configurable:!0,value:j}),j}}}var h4=(()=>{class i{constructor(a,c,h,m){var y;this.active$=a,this.zone=c,this.el=h,this.directParentActiveZone=m,this.subActiveZones=[],this.tuiActiveZoneParent=null,this.tuiActiveZoneChange=this.active$.pipe(st(w=>!!w&&this.contains(w)),xr(!1),Ro(),RM(1),Ll(this.zone)),(y=this.directParentActiveZone)===null||y===void 0||y.addSubActiveZone(this)}set tuiActiveZoneParentSetter(a){this.setZone(a)}ngOnDestroy(){var a,c;(a=this.directParentActiveZone)===null||a===void 0||a.removeSubActiveZone(this),(c=this.tuiActiveZoneParent)===null||c===void 0||c.removeSubActiveZone(this)}contains(a){return this.el.nativeElement.contains(a)||this.subActiveZones.some((c,h,m)=>m.indexOf(c)===h&&c.contains(a))}setZone(a){var c;(c=this.tuiActiveZoneParent)===null||c===void 0||c.removeSubActiveZone(this),a?.addSubActiveZone(this),this.tuiActiveZoneParent=a}addSubActiveZone(a){this.subActiveZones=[...this.subActiveZones,a]}removeSubActiveZone(a){this.subActiveZones=LU(this.subActiveZones,this.subActiveZones.indexOf(a))}}return i.\u0275fac=function(a){return new(a||i)(me(QU),me(oi),me(mn),me(i,12))},i.\u0275dir=pn({type:i,selectors:[["","tuiActiveZone","",5,"ng-container"],["","tuiActiveZoneChange","",5,"ng-container"],["","tuiActiveZoneParent","",5,"ng-container"]],inputs:{tuiActiveZoneParentSetter:[Bi.None,"tuiActiveZoneParent","tuiActiveZoneParentSetter"]},outputs:{tuiActiveZoneChange:"tuiActiveZoneChange"},exportAs:["tuiActiveZone"]}),_0([m1],i.prototype,"setZone",null),i})(),f4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var p4=(()=>{class i{constructor(a,c){this.focusable=a,this.el=c}get element(){var a;return((a=this.focusable)===null||a===void 0?void 0:a.nativeFocusableElement)||this.el.nativeElement}get isTextFieldElement(){return this.element.matches("input, textarea, [contenteditable]")}}return i.\u0275fac=function(a){NC()},i.\u0275dir=pn({type:i}),i})(),Nre=1e3,zre=".ng-animating",Bre=(()=>{class i extends p4{constructor(a,c,h){super(a,c),this.animationFrame$=h}setFocus(){this.isTextFieldElement?SM(Zo(Nre),this.animationFrame$.pipe(bh(Xb),st(()=>this.element.closest(zre)),LM(Boolean),Bo(1))).subscribe(()=>this.element.focus({preventScroll:!0})):this.element.focus({preventScroll:!0})}}return i.\u0275fac=function(a){return new(a||i)(me(L_,10),me(mn),me(uf))},i.\u0275dir=pn({type:i,features:[uo]}),i})(),jre=["type","inputMode","autocomplete","accept","min","max","step","pattern","size","maxlength"],Vre=(()=>{class i extends p4{constructor(a,c,h,m,y){super(a,c),this.renderer=h,this.zone=m,this.win=y,this.patchCssStyles()}setFocus(){this.isTextFieldElement?this.zone.runOutsideAngular(()=>this.iosWebkitAutofocus()):this.element.focus({preventScroll:!0})}iosWebkitAutofocus(){var a;let c=this.makeFakeInput(),h=this.getDurationTimeBeforeFocus(),m=0,y=0,w=()=>c.focus({preventScroll:!0}),C=()=>{clearTimeout(m),m=this.win.setTimeout(()=>{clearTimeout(y),c.removeEventListener("blur",w),c.removeEventListener("focus",C),y=this.win.setTimeout(()=>{this.element.focus({preventScroll:!1}),c.remove()},h)})};c.addEventListener("blur",w,{once:!0}),c.addEventListener("focus",C),this.insideDialog()?this.win.document.body.appendChild(c):(a=this.element.parentElement)===null||a===void 0||a.appendChild(c),c.focus({preventScroll:!0})}makeFakeInput(){let a=this.renderer.createElement("input"),c=this.element.getBoundingClientRect();return this.patchFakeInputFromFocusableElement(a),a.style.height=Jp(c.height),a.style.width=Jp(c.width/2),a.style.position="fixed",a.style.zIndex="-99999999",a.style.caretColor="transparent",a.style.border="none",a.style.outline="none",a.style.color="transparent",a.style.background="transparent",a.style.cursor="none",a.style.fontSize=Jp(16),a.style.top=Jp(c.top),a.style.left=Jp(c.left),a}getDurationTimeBeforeFocus(){return parseFloat(this.win.getComputedStyle(this.element).getPropertyValue("--tui-duration"))||0}insideDialog(){return!!this.element.closest("tui-dialog")}patchCssStyles(){[this.win.document.documentElement,this.win.document.body].forEach(a=>{a.style.setProperty("overflow","auto"),a.style.setProperty("height","100%")})}patchFakeInputFromFocusableElement(a){jre.forEach(c=>{let h=this.element.getAttribute(c);NU(h)&&a.setAttribute(c,h)})}}return i.\u0275fac=function(a){return new(a||i)(me(L_,10),me(mn),me(Za),me(oi),me(Ui))},i.\u0275dir=pn({type:i,features:[uo]}),i})(),Ure={delay:NaN},$re=ki(Ure);var m4=new ot("[TUI_AUTOFOCUS_HANDLER]"),Hre=[{provide:m4,useFactory:(i,r,a,c,h,m,y)=>y?new Vre(i,r,c,h,m):new Bre(i,r,a),deps:[[new cu,new Dz,L_],mn,uf,Za,oi,Ui,Tu]},Ci],g4=(()=>{class i{constructor(a,c,h){this.handler=a,this.options=c,this.destroy$=h,this.autoFocus=!0}ngAfterViewInit(){a4(this.autoFocus)&&this.focus()}focus(){Number.isNaN(this.options.delay)?Promise.resolve().then(()=>this.handler.setFocus()):Zo(this.options.delay).pipe(Ii(this.destroy$)).subscribe(()=>this.handler.setFocus())}}return i.\u0275fac=function(a){return new(a||i)(me(m4),me($re),me(Ci,2))},i.\u0275dir=pn({type:i,selectors:[["","tuiAutoFocus",""]],inputs:{autoFocus:[Bi.None,"tuiAutoFocus","autoFocus"]},features:[si(Hre)]}),i})(),_4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var y4=(()=>{class i{constructor(a,c,h){this.doc=a,this.el=c,this.renderer=h,this.activeElement=D_(this.doc),Promise.resolve().then(()=>this.el.nativeElement.focus())}onBlur(){this.renderer.removeAttribute(this.el.nativeElement,"tabIndex")}onFocusIn(a){let{nativeElement:c}=this.el;if(Qb(c,a))return;let h=jU({initial:c,root:c});h&&h.focus()}ngOnDestroy(){t1(this.doc),Promise.resolve().then(()=>{Md(this.activeElement)&&this.activeElement.focus()})}}return i.\u0275fac=function(a){return new(a||i)(me(jn),me(mn),me(Za))},i.\u0275dir=pn({type:i,selectors:[["","tuiFocusTrap",""]],hostAttrs:["tabIndex","0"],hostBindings:function(a,c){a&1&&Kt("blur",function(){return c.onBlur()})("focusin.silent",function(m){return c.onFocusIn(m.target)},!1,Ox)}}),i})(),v4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var x4=(()=>{class i{constructor(){this.focusable=!0}get tabIndex(){return this.focusable?0:-1}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275dir=pn({type:i,selectors:[["","tuiFocusable",""]],hostVars:1,hostBindings:function(a,c){a&2&&Hh("tabIndex",c.tabIndex)},inputs:{focusable:[Bi.None,"tuiFocusable","focusable"]}}),i})(),b4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();function Gre({currentTarget:i,relatedTarget:r}){return!sf(r)||!sf(i)||!i.contains(r)}var w4=(()=>{class i extends un{constructor(a,c){super(h=>this.stream$.subscribe(h)),this.el=a,this.zone=c,this.stream$=go(Un(this.el.nativeElement,"mouseenter").pipe(st(Ed)),Un(this.el.nativeElement,"mouseleave").pipe(st(ts)),Un(this.el.nativeElement,"mouseout").pipe(zi(Gre),st(ts))).pipe(Ro(),Ll(this.zone))}}return i.\u0275fac=function(a){return new(a||i)(Ct(mn),Ct(oi))},i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),_1=(()=>{class i{constructor(a){this.tuiHoveredChange=a}}return i.\u0275fac=function(a){return new(a||i)(me(w4))},i.\u0275dir=pn({type:i,selectors:[["","tuiHoveredChange",""]],outputs:{tuiHoveredChange:"tuiHoveredChange"},features:[si([w4])]}),i})(),y1=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var wD=class{constructor(r){this.internalDirectiveInstance=r}get $implicit(){return this.internalDirectiveInstance.tuiLet}get tuiLet(){return this.internalDirectiveInstance.tuiLet}},Cd=(()=>{class i{constructor(a,c){a.createEmbeddedView(c,new wD(this))}static ngTemplateContextGuard(a,c){return!0}}return i.\u0275fac=function(a){return new(a||i)(me(as),me(es))},i.\u0275dir=pn({type:i,selectors:[["","tuiLet",""]],inputs:{tuiLet:"tuiLet"}}),i})(),yc=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var T4=(()=>{class i{constructor({nativeElement:a},c,h){this.mode="scroll",Un(a,"wheel",{passive:!1}).pipe(zi(()=>this.enabled),wu(c),Ii(h)).subscribe(m=>{this.processEvent(m,!!m.deltaY,m.deltaY?m.deltaY<0:m.deltaX<0)}),Un(a,"touchstart",{passive:!0}).pipe(Fi(({touches:m})=>{let{clientX:y,clientY:w}=m[0],C=0,D=0,z;return Un(a,"touchmove",{passive:!1}).pipe(zi(()=>this.enabled),Vr(j=>{let ie=j.changedTouches[0];C=y-ie.clientX,D=w-ie.clientY,y=ie.clientX,w=ie.clientY,z===void 0&&(z=Math.abs(D)>Math.abs(C)),this.processEvent(j,z,z?D<0:C<0)}))}),wu(c),Ii(h)).subscribe()}get enabled(){return this.mode!=="none"}get overscrollBehavior(){return this.enabled?"contain":null}processEvent(a,c,h){var m;let{target:y,currentTarget:w,cancelable:C}=a;if(!(!C||!sf(y)||((m=y)===null||m===void 0?void 0:m.type)==="range")){if(this.mode==="all"&&(c&&!w.contains(e1(y))||!c&&!w.contains(e1(y,!1)))){a.preventDefault();return}if(c&&(h&&!C_(y,w,!0,!1)||!h&&!C_(y,w,!0,!0))){a.preventDefault();return}!c&&(h&&!C_(y,w,!1,!1)||!h&&!C_(y,w,!1,!0))&&a.preventDefault()}}}return i.\u0275fac=function(a){return new(a||i)(me(mn),me(oi),me(Ci,2))},i.\u0275dir=pn({type:i,selectors:[["","tuiOverscroll",""]],hostVars:2,hostBindings:function(a,c){a&2&&Al("overscroll-behavior",c.overscrollBehavior)},inputs:{mode:[Bi.None,"tuiOverscroll","mode"]},features:[si([Ci])]}),i})(),E4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var Wre=["*"],qre=(()=>{class i extends f1{}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),M4=(()=>{class i extends bD{}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275cmp=Cn({type:i,selectors:[["tui-dropdown-host"]],features:[si([{provide:f1,useExisting:qre},{provide:bD,useExisting:i}]),uo],ngContentSelectors:Wre,decls:3,vars:0,consts:[["viewContainer",""]],template:function(a,c){a&1&&(xs(),Fo(0),Pl(1,null,0))},styles:['[_nghost-%COMP%]{position:relative;z-index:0;display:block;height:100%}[_nghost-%COMP%]:before{content:"";display:block;overflow:hidden}.t-position-fixed-offset[_ngcontent-%COMP%]{position:fixed;left:0;top:0;pointer-events:none;visibility:hidden;width:100%;height:100%}'],changeDetection:0}),i})(),I4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var v1=(()=>{class i{constructor(a,c){this.el=a,this.takeOnlyTrustedEvents=c,this.tuiPressedChange=GU(this.el.nativeElement,{onlyTrusted:this.takeOnlyTrustedEvents})}}return i.\u0275fac=function(a){return new(a||i)(me(mn),me(r4))},i.\u0275dir=pn({type:i,selectors:[["","tuiPressedChange",""]],outputs:{tuiPressedChange:"tuiPressedChange"}}),i})(),x1=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var Zre=65536,TD=class{constructor(r){this.$implicit=r}},b1=(()=>{class i{constructor(a,c){this.viewContainer=a,this.templateRef=c}set tuiRepeatTimesOf(a){let c=Math.floor(RU(a,0,Zre)),{length:h}=this.viewContainer;a<h?this.removeContainers(h-a):this.addContainers(c)}addContainers(a){for(let c=this.viewContainer.length;c<a;c++)this.viewContainer.createEmbeddedView(this.templateRef,new TD(c))}removeContainers(a){for(let c=0;c<a;c++)this.viewContainer.remove()}}return i.\u0275fac=function(a){return new(a||i)(me(as),me(es))},i.\u0275dir=pn({type:i,selectors:[["","tuiRepeatTimes","","tuiRepeatTimesOf",""]],inputs:{tuiRepeatTimesOf:"tuiRepeatTimesOf"}}),i})(),w1=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();function Yre(i,r){i&1&&Pl(0)}function Xre(i,r){i&1&&wn(0,"tui-scroll-controls",5)}function Kre(i,r){if(i&1&&(He(0,"section",2),It(1,Yre,1,0,"ng-container",3)(2,Xre,1,0,"tui-scroll-controls",4),We()),i&2){let a=r.$implicit,c=yt();Xe("@host",void 0),Mr("aria-labelledby",a.id),qe(),Xe("polymorpheusOutlet",a.component)("polymorpheusOutletContext",a),qe(),Xe("ngIf",!c.isMobile)}}function Jre(i,r){if(i&1){let a=Zr();He(0,"div",6),Kt("transitionend",function(h){let y=ji(a).tuiLet,w=yt();return Vi(w.onDialog(h,!!w.dialogs.length,!!y))})("popstate",function(){let m=ji(a).tuiLet,y=yt();return Vi(y.closeLast(y.dialogs,!!m))},!1,Ox),We()}if(i&2){let a=yt();ti("t-overlay_visible",a.dialogs.length)}}var ED={label:"ignoreMe"},Qre=i=>i?.label===ED.label,eoe=ki(Nt(!1)),C4=(()=>{class i{constructor(a,c,h,m,y,w,C,D){this.isMobile=a,this.isDialogClosesOnBack$=c,this.dialogsByType=h,this.historyRef=m,this.titleService=y,this.destroy$=w,this.cdr=C,this.doc=D,this.dialogs=[]}ngOnInit(){lc(this.dialogsByType).pipe(st(a=>[].concat(...a).sort((c,h)=>c.createdAt-h.createdAt)),Ii(this.destroy$)).subscribe(a=>{var c;this.dialogs=a,this.cdr.markForCheck(),(c=this.doc.defaultView)===null||c===void 0||c.document.documentElement.classList.toggle("t-overscroll-none",!!a.length)})}closeLast(a,c){if(!c)return;let[h]=a.slice(-1);h&&(a.length>1&&this.historyRef.pushState(ED,this.titleService.getTitle()),h.$implicit.complete())}onDialog({propertyName:a},c,h){!h||a!=="letter-spacing"||(c?this.historyRef.pushState(ED,this.titleService.getTitle()):Qre(this.historyRef.state)&&this.historyRef.back())}}return i.\u0275fac=function(a){return new(a||i)(me(Eu),me(eoe),me(R_),me(KU),me(vb),me(Ci,2),me(co),me(jn))},i.\u0275cmp=Cn({type:i,selectors:[["tui-dialog-host"]],features:[si([Ci])],decls:3,vars:4,consts:[["aria-modal","true","role","dialog","tuiFocusTrap","","tuiOverscroll","all","tuiScrollRef","","class","t-dialog",4,"ngFor","ngForOf"],["class","t-overlay",3,"t-overlay_visible","transitionend","popstate",4,"tuiLet"],["aria-modal","true","role","dialog","tuiFocusTrap","","tuiOverscroll","all","tuiScrollRef","",1,"t-dialog"],[4,"polymorpheusOutlet","polymorpheusOutletContext"],["class","t-scrollbars",4,"ngIf"],[1,"t-scrollbars"],[1,"t-overlay",3,"transitionend","popstate"]],template:function(a,c){a&1&&(It(0,Kre,3,5,"section",0)(1,Jre,1,2,"div",1),ai(2,"async")),a&2&&(Xe("ngForOf",c.dialogs),qe(),Xe("tuiLet",br(2,2,c.isDialogClosesOnBack$)))},dependencies:[nm,Ja,y4,T4,u4,oa,Ki,Cd,yo],styles:["[_nghost-%COMP%]{position:fixed;left:0;bottom:0;width:100%;height:0}.t-overlay[_ngcontent-%COMP%], .t-dialog[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;align-items:flex-start;outline:none;overflow:auto;scrollbar-width:none;-ms-overflow-style:none}.t-overlay.ng-animating[_ngcontent-%COMP%], .t-dialog.ng-animating[_ngcontent-%COMP%]{overflow:clip}.t-overlay[_ngcontent-%COMP%]::-webkit-scrollbar, .t-dialog[_ngcontent-%COMP%]::-webkit-scrollbar, .t-overlay[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .t-dialog[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:transparent;width:0;height:0}.t-dialog[_ngcontent-%COMP%]{bottom:auto;height:100%}.t-overlay[_ngcontent-%COMP%]{height:100%;pointer-events:none;touch-action:none;opacity:0;letter-spacing:normal;transition:opacity var(--tui-duration, .3s),letter-spacing .01s;background:rgba(0,0,0,.75);-webkit-backdrop-filter:var(--tui-backdrop, none);backdrop-filter:var(--tui-backdrop, none)}.t-overlay_visible[_ngcontent-%COMP%]{opacity:1;letter-spacing:1px}.t-dialog[_ngcontent-%COMP%]:last-of-type{z-index:1}.t-scrollbars[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;margin:0;color:#747474}"],data:{animation:[Nr("host",[ni(":enter",[dt({overflow:"clip"}),xo(":scope > *",[__()],{optional:!0})]),ni(":leave",[dt({overflow:"clip"}),xo(":scope > *",[__()],{optional:!0})])])]}}),i})(),S4=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,sa,E4,v4,yc,im]]}),i})();var rm=function(i){return i[i.Sunday=0]="Sunday",i[i.Monday=1]="Monday",i[i.Tuesday=2]="Tuesday",i[i.Wednesday=3]="Wednesday",i[i.Thursday=4]="Thursday",i[i.Friday=5]="Friday",i[i.Saturday=6]="Saturday",i}(rm||{}),Fl=function(i){return i[i.January=0]="January",i[i.February=1]="February",i[i.March=2]="March",i[i.April=3]="April",i[i.May=4]="May",i[i.June=5]="June",i[i.July=6]="July",i[i.August=7]="August",i[i.September=8]="September",i[i.October=9]="October",i[i.November=10]="November",i[i.December=11]="December",i}(Fl||{});var M1=7;var om=12,T1=1,MD=0,ID=11,CD=0,SD=9999,E1=`${I_}${DU}${I_}`,toe=1e3,noe=60,ioe=60,roe=24,ooe=toe*noe,soe=ooe*ioe,J1e=soe*roe,DD=10,aoe=2*DD+E1.length,Q1e=ki("DMY"),ewe=ki(".");var bs=class i{constructor(r){this.year=r}static isValidYear(r){return Number.isInteger(r)&&of(r,CD,SD+1)}static isLeapYear(r){return r%400===0||r%4===0&&r%100!==0}static getAbsoluteLeapYears(r){return Math.ceil(r/400)+(Math.ceil(r/4)-Math.ceil(r/100))}static lengthBetween(r,a){return a.year-r.year}static normalizeYearPart(r){return Kb(r,CD,SD)}get formattedYear(){return String(this.year).padStart(4,"0")}get isLeapYear(){return i.isLeapYear(this.year)}get absoluteLeapYears(){return i.getAbsoluteLeapYears(this.year)}yearBefore({year:r}){return this.year<r}yearSameOrBefore({year:r}){return this.year<=r}yearSame({year:r}){return this.year===r}yearSameOrAfter({year:r}){return this.year>=r}yearAfter({year:r}){return this.year>r}append({year:r=0}){let a=this.year+r;return new i(a)}toString(){return this.formattedYear}valueOf(){return this.year}[Symbol.toPrimitive](r){return Date.prototype[Symbol.toPrimitive].call(this,r)}toJSON(){return this.formattedYear}},ho=class i extends bs{constructor(r,a){super(r),this.month=a}static isValidMonth(r,a){return bs.isValidYear(r)&&i.isValidMonthPart(a)}static getMonthDaysCount(r,a){switch(r){case Fl.February:return a?29:28;case Fl.April:case Fl.June:case Fl.September:case Fl.November:return 30;default:return 31}}static currentLocal(){let r=new Date;return new i(r.getFullYear(),r.getMonth())}static currentUtc(){let r=new Date;return new i(r.getUTCFullYear(),r.getUTCMonth())}static lengthBetween(r,a){let c=r.month+r.year*12;return a.month+a.year*12-c}static normalizeMonthPart(r){return Kb(r,MD,ID)}static isValidMonthPart(r){return Number.isInteger(r)&&of(r,MD,ID+1)}get formattedMonthPart(){return String(this.month+1).padStart(2,"0")}get daysCount(){return i.getMonthDaysCount(this.month,this.isLeapYear)}monthBefore(r){return this.yearBefore(r)||this.yearSame(r)&&this.month<r.month}monthSameOrBefore(r){return this.yearBefore(r)||this.yearSame(r)&&this.month<=r.month}monthSame(r){return this.yearSame(r)&&this.month===r.month}monthSameOrAfter(r){return this.yearAfter(r)||this.yearSame(r)&&this.month>=r.month}monthAfter(r){return this.yearAfter(r)||this.yearSame(r)&&this.month>r.month}append({year:r=0,month:a=0}){let c=(this.year+r)*om+this.month+a;return new i(Math.floor(c/om),c%om)}toString(){return`${this.formattedMonthPart}.${this.formattedYear}`}valueOf(){return this.toLocalNativeDate().valueOf()}toJSON(){return`${super.toJSON()}-${this.formattedMonthPart}`}toLocalNativeDate(){return new Date(this.year,this.month)}toUtcNativeDate(){return new Date(Date.UTC(this.year,this.month))}},Sa=class i extends ho{constructor(r,a,c){super(r,a),this.day=c}static fromLocalNativeDate(r){return new i(r.getFullYear(),r.getMonth(),r.getDate())}static fromUtcNativeDate(r){return new i(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())}static isValidDay(r,a,c){return ho.isValidMonth(r,a)&&Number.isInteger(c)&&of(c,T1,ho.getMonthDaysCount(a,bs.isLeapYear(r))+1)}static currentLocal(){let r=new Date,a=r.getFullYear(),c=r.getMonth(),h=r.getDate();return new i(a,c,h)}static currentUtc(){let r=new Date,a=r.getUTCFullYear(),c=r.getUTCMonth(),h=r.getUTCDate();return new i(a,c,h)}static normalizeOf(r,a,c){let h=bs.normalizeYearPart(r),m=ho.normalizeMonthPart(a),y=i.normalizeDayPart(c,m,h);return new i(h,m,y)}static lengthBetween(r,a){return Math.round((a.toLocalNativeDate().getTime()-r.toLocalNativeDate().getTime())/(1e3*60*60*24))}static parseRawDateString(r,a="DMY"){switch(a){case"YMD":return{day:parseInt(r.slice(8,10),10),month:parseInt(r.slice(5,7),10)-1,year:parseInt(r.slice(0,4),10)};case"MDY":return{day:parseInt(r.slice(3,5),10),month:parseInt(r.slice(0,2),10)-1,year:parseInt(r.slice(6,10),10)};case"DMY":default:return{day:parseInt(r.slice(0,2),10),month:parseInt(r.slice(3,5),10)-1,year:parseInt(r.slice(6,10),10)}}}static normalizeParse(r,a="DMY"){let{day:c,month:h,year:m}=this.parseRawDateString(r,a);return i.normalizeOf(m,h,c)}static jsonParse(r){let{day:a,month:c,year:h}=this.parseRawDateString(r,"YMD");if(!bs.isValidYear(h))throw new s1(h);if(!ho.isValidMonth(h,c))throw new o1(c);if(!Number.isInteger(a)||!of(a,T1,ho.getMonthDaysCount(c,bs.isLeapYear(h))+1))throw new r1(a);return new i(h,c,a)}static normalizeDayPart(r,a,c){let h=ho.getMonthDaysCount(a,bs.isLeapYear(c));return Kb(r,1,h)}get formattedDayPart(){return String(this.day).padStart(2,"0")}get isWeekend(){let r=this.dayOfWeek(!1);return r===rm.Saturday||r===rm.Sunday}dayOfWeek(r=!0){let a=r?this.toLocalNativeDate().getDay()-1:this.toLocalNativeDate().getDay();return a<0?6:a}dayBefore(r){return this.monthBefore(r)||this.monthSame(r)&&this.day<r.day}daySameOrBefore(r){return this.monthBefore(r)||this.monthSame(r)&&this.day<=r.day}daySame(r){return this.monthSame(r)&&this.day===r.day}daySameOrAfter(r){return this.monthAfter(r)||this.monthSame(r)&&this.day>=r.day}dayAfter(r){return this.monthAfter(r)||this.monthSame(r)&&this.day>r.day}dayLimit(r,a){return r!==null&&this.dayBefore(r)?r:a!==null&&this.dayAfter(a)?a:this}append({year:r=0,month:a=0,day:c=0}){let h=(this.year+r)*om+this.month+a,m=Math.floor(h/om),y=h%om,w=Math.min(this.day,ho.getMonthDaysCount(y,bs.isLeapYear(m)))+c;for(;w>ho.getMonthDaysCount(y,bs.isLeapYear(m));)w-=ho.getMonthDaysCount(y,bs.isLeapYear(m)),y===Fl.December?(m++,y=Fl.January):y++;for(;w<T1;)y===Fl.January?(m--,y=Fl.December):y--,w+=ho.getMonthDaysCount(y,bs.isLeapYear(m));return new i(m,y,w)}getFormattedDay(r,a){let c=this.formattedDayPart,h=this.formattedMonthPart,m=this.formattedYear;switch(r){case"YMD":return`${m}${a}${h}${a}${c}`;case"MDY":return`${h}${a}${c}${a}${m}`;case"DMY":default:return`${c}${a}${h}${a}${m}`}}toString(r="DMY",a="."){return this.getFormattedDay(r,a)}toJSON(){return`${super.toJSON()}-${this.formattedDayPart}`}toLocalNativeDate(){return new Date(this.year,this.month,this.day)}toUtcNativeDate(){return new Date(Date.UTC(this.year,this.month,this.day))}},sm=class i{constructor(r,a){this.from=r,this.to=a}static sort(r,a){return r.monthSameOrBefore(a)?new i(r,a):new i(a,r)}get isSingleMonth(){return this.from.monthSame(this.to)}monthSame(r){return this.from.monthSame(r.from)&&this.to.monthSame(r.to)}toString(){return`${this.from}${E1}${this.to}`}},hf=class i extends sm{constructor(r,a){super(r,a),this.from=r,this.to=a}static sort(r,a){return r.daySameOrBefore(a)?new i(r,a):new i(a,r)}static normalizeParse(r,a="DMY"){let c=Sa.normalizeParse(r.slice(0,DD),a);return r.length<aoe?new i(c,c):i.sort(c,Sa.normalizeParse(r.slice(DD+E1.length),a))}get isSingleDay(){return this.from.daySame(this.to)}daySame(r){return this.from.daySame(r.from)&&this.to.daySame(r.to)}dayLimit(r,a){return new i(this.from.dayLimit(r,a),this.to.dayLimit(r,a))}getFormattedDayRange(r,a){let c=this.from.getFormattedDay(r,a),h=this.to.getFormattedDay(r,a);return`${c}${E1}${h}`}toString(r="DMY",a="."){return this.getFormattedDayRange(r,a)}},kl=new Sa(CD,MD,T1),Nl=new Sa(SD,ID,31);var Gn="{{duration}}ms ease-in-out",$i={params:{duration:300}},ws=300,D4=Nr("tuiHeightCollapse",[ni(":enter",[dt({height:0}),Vn(Gn,dt({height:"*"}))],$i),ni(":leave",[dt({height:"*"}),Vn(Gn,dt({height:0}))],$i)]),iwe=Nr("tuiHeightCollapseList",[ni("* => *",[xo(":enter",[dt({height:0}),ls(ws,[Vn(Gn,dt({height:"*"}))])],{optional:!0}),xo(":leave",[dt({height:"*"}),ls(ws,[Vn(Gn,dt({height:0}))])],{optional:!0})],$i)]),rwe=Nr("tuiWidthCollapse",[ni(":enter",[dt({width:0}),Vn(Gn,dt({width:"*"}))],$i),ni(":leave",[dt({width:"*"}),Vn(Gn,dt({width:0}))],$i)]),owe=Nr("tuiWidthCollapseList",[ni("* => *",[xo(":enter",[dt({width:0}),ls(ws,[Vn(Gn,dt({width:"*"}))])],{optional:!0}),xo(":leave",[dt({width:"*"}),ls(ws,[Vn(Gn,dt({width:0}))])],{optional:!0})],$i)]),I1=Nr("tuiFadeIn",[ni(":enter",[dt({opacity:0}),Vn(Gn,dt({opacity:1}))],$i),ni(":leave",[dt({opacity:1}),Vn(Gn,dt({opacity:0}))],$i)]),swe=Nr("tuiFadeInList",[ni("* => *",[xo(":enter",[dt({opacity:0}),ls(ws,[Vn(Gn,dt({opacity:1}))])],{optional:!0}),xo(":leave",[dt({opacity:1}),ls(ws,[Vn(Gn,dt({opacity:0}))])],{optional:!0})],$i)]),awe=Nr("tuiFadeInTop",[ni(":enter",[dt({transform:"translateY(-10px)",opacity:0}),Vn(Gn,dt({transform:"translateY(0)",opacity:1}))],$i),ni(":leave",[dt({transform:"translateY(0)",opacity:1}),Vn(Gn,dt({transform:"translateY(-10px)",opacity:0}))],$i)]),lwe=Nr("tuiFadeInBottom",[ni(":enter",[dt({transform:"translateY(10px)",opacity:0}),Vn(Gn,dt({transform:"translateY(0)",opacity:1}))],$i),ni(":leave",[dt({transform:"translateY(0)",opacity:1}),Vn(Gn,dt({transform:"translateY(10px)",opacity:0}))],$i)]),cwe=Nr("tuiDropdownAnimation",[ni(":enter",[dt({transform:"translateY(-10px)",opacity:0}),Vn(Gn,dt({transform:"translateY(0)",opacity:1}))],$i),ni(":leave",[dt({transform:"translateY(0)",opacity:1}),Vn(Gn,dt({transform:"translateY(-10px)",opacity:0}))],$i)]),uwe=Nr("tuiScaleIn",[ni(":enter",[dt({transform:"scale(0)"}),Vn(Gn,dt({transform:"scale(1)"}))],$i),ni(":leave",[dt({transform:"scale(1)"}),Vn(Gn,dt({transform:"scale(0)"}))],$i)]),dwe=Nr("tuiPop",[ni(":enter",[dt({transform:"scale(0)"}),Vn(Gn,dt({transform:"scale(1.1)"})),Vn(Gn,dt({transform:"scale(1)"}))],$i),ni(":leave",[dt({transform:"scale(1)"}),Vn(Gn,dt({transform:"scale(1.1)"})),Vn(Gn,dt({transform:"scale(0)"}))],$i)]),hwe=Nr("tuiScaleInList",[ni("* => *",[xo(":enter",[dt({transform:"scale(0)"}),ls(ws,[Vn(Gn,dt({transform:"scale(1)"}))])],{optional:!0}),xo(":leave",[dt({transform:"scale(1)"}),ls(ws,[Vn(Gn,dt({transform:"scale(0)"}))])],{optional:!0})],$i)]),A4=Nr("tuiSlideIn",[ni("* => left",[dt({transform:"translateX(-100%)"}),Vn(Gn,dt({transform:"translateX(0)"}))],$i),ni("left => *",[dt({transform:"translateX(0)"}),Vn(Gn,dt({transform:"translateX(-100%)"}))],$i),ni("* => right",[dt({transform:"translateX(100%)"}),Vn(Gn,dt({transform:"translateX(0)"}))],$i),ni("right => *",[dt({transform:"translateX(0)"}),Vn(Gn,dt({transform:"translateX(100%)"}))],$i)]),fwe=Nr("tuiSlideInLeft",[ni(":enter",[dt({transform:"translateX(-100%)"}),Vn(Gn,dt({transform:"translateX(0)"}))],$i),ni(":leave",[dt({transform:"translateX(0)"}),Vn(Gn,dt({transform:"translateX(-100%)"}))],$i)]),pwe=Nr("tuiSlideInLeftList",[ni("* => *",[xo(":enter",[dt({transform:"translateX(-100%)"}),ls(ws,[Vn(Gn,dt({transform:"translateX(0)"}))])],{optional:!0}),xo(":leave",[dt({transform:"translateX(0)"}),ls(ws,[Vn(Gn,dt({transform:"translateX(-100%)"}))])],{optional:!0})],$i)]),mwe=Nr("tuiSlideInRight",[ni(":enter",[dt({transform:"translateX(100%)"}),Vn(Gn,dt({transform:"translateX(0)"}))],$i),ni(":leave",[dt({transform:"translateX(0)"}),Vn(Gn,dt({transform:"translateX(100%)"}))],$i)]),gwe=Nr("tuiSlideInRightList",[ni("* => *",[xo(":enter",[dt({transform:"translateX(100%)"}),ls(ws,[Vn(Gn,dt({transform:"translateX(0)"}))])],{optional:!0}),xo(":leave",[dt({transform:"translateX(0)"}),ls(ws,[Vn(Gn,dt({transform:"translateX(100%)"}))])],{optional:!0})],$i)]),P4=Nr("tuiSlideInTop",[ni(":enter",[dt({transform:"translate3d(0,{{start}},0)"}),Vn(Gn,dt({transform:"translate3d(0,{{end}},0)"}))],{params:{end:0,start:"100%",duration:300}}),ni(":leave",[dt({transform:"translate3d(0,{{end}},0)"}),Vn(Gn,dt({transform:"translate3d(0,{{start}},0)"}))],{params:{end:0,start:"100%",duration:300}})]),_we=Nr("tuiSlideInTopList",[ni("* => *",[xo(":enter",[dt({transform:"translateY(100%)"}),ls(ws,[Vn(Gn,dt({transform:"translateY(0)"}))])],{optional:!0}),xo(":leave",[dt({transform:"translateY(0)"}),ls(ws,[Vn(Gn,dt({transform:"translateY(100%)"}))])],{optional:!0})],$i)]),ywe=Nr("tuiSlideInBottom",[ni(":enter",[dt({transform:"translateY(-100%)"}),Vn(Gn,dt({transform:"translateY(0)"}))],$i),ni(":leave",[dt({transform:"translateY(0)"}),Vn(Gn,dt({transform:"translateY(-100%)"}))],$i)]),vwe=Nr("tuiSlideInBottomList",[ni("* => *",[xo(":enter",[dt({transform:"translateY(-100%)"}),ls(ws,[Vn(Gn,dt({transform:"translateY(0)"}))])],{optional:!0}),xo(":leave",[dt({transform:"translateY(0)"}),ls(ws,[Vn(Gn,dt({transform:"translateY(-100%)"}))])],{optional:!0})],$i)]);var ce=function(i){return i.AD="AD",i.AE="AE",i.AF="AF",i.AG="AG",i.AI="AI",i.AL="AL",i.AM="AM",i.AO="AO",i.AR="AR",i.AT="AT",i.AU="AU",i.AW="AW",i.AZ="AZ",i.BA="BA",i.BB="BB",i.BD="BD",i.BE="BE",i.BF="BF",i.BG="BG",i.BH="BH",i.BI="BI",i.BJ="BJ",i.BL="BL",i.BM="BM",i.BN="BN",i.BO="BO",i.BQ="BQ",i.BR="BR",i.BS="BS",i.BT="BT",i.BW="BW",i.BY="BY",i.BZ="BZ",i.CA="CA",i.CD="CD",i.CF="CF",i.CG="CG",i.CH="CH",i.CI="CI",i.CL="CL",i.CM="CM",i.CN="CN",i.CO="CO",i.CR="CR",i.CU="CU",i.CV="CV",i.CW="CW",i.CY="CY",i.CZ="CZ",i.DE="DE",i.DJ="DJ",i.DK="DK",i.DM="DM",i.DO="DO",i.DZ="DZ",i.EC="EC",i.EE="EE",i.EG="EG",i.ER="ER",i.ES="ES",i.ET="ET",i.FI="FI",i.FJ="FJ",i.FK="FK",i.FM="FM",i.FR="FR",i.GA="GA",i.GB="GB",i.GD="GD",i.GE="GE",i.GF="GF",i.GH="GH",i.GI="GI",i.GL="GL",i.GM="GM",i.GN="GN",i.GP="GP",i.GQ="GQ",i.GR="GR",i.GT="GT",i.GW="GW",i.GY="GY",i.HK="HK",i.HN="HN",i.HR="HR",i.HT="HT",i.HU="HU",i.ID="ID",i.IE="IE",i.IL="IL",i.IN="IN",i.IQ="IQ",i.IR="IR",i.IS="IS",i.IT="IT",i.JM="JM",i.JO="JO",i.JP="JP",i.KE="KE",i.KG="KG",i.KH="KH",i.KM="KM",i.KN="KN",i.KP="KP",i.KR="KR",i.KW="KW",i.KY="KY",i.KZ="KZ",i.LA="LA",i.LB="LB",i.LC="LC",i.LI="LI",i.LK="LK",i.LR="LR",i.LS="LS",i.LT="LT",i.LU="LU",i.LV="LV",i.LY="LY",i.MA="MA",i.MC="MC",i.MD="MD",i.ME="ME",i.MF="MF",i.MG="MG",i.MK="MK",i.ML="ML",i.MM="MM",i.MN="MN",i.MO="MO",i.MQ="MQ",i.MR="MR",i.MS="MS",i.MT="MT",i.MU="MU",i.MV="MV",i.MW="MW",i.MX="MX",i.MY="MY",i.MZ="MZ",i.NA="NA",i.NC="NC",i.NE="NE",i.NG="NG",i.NI="NI",i.NL="NL",i.NO="NO",i.NP="NP",i.NZ="NZ",i.OM="OM",i.PA="PA",i.PE="PE",i.PF="PF",i.PG="PG",i.PH="PH",i.PK="PK",i.PL="PL",i.PT="PT",i.PW="PW",i.PY="PY",i.QA="QA",i.RE="RE",i.RO="RO",i.RS="RS",i.RU="RU",i.RW="RW",i.SA="SA",i.SB="SB",i.SC="SC",i.SD="SD",i.SE="SE",i.SG="SG",i.SH="SH",i.SI="SI",i.SK="SK",i.SL="SL",i.SM="SM",i.SN="SN",i.SO="SO",i.SR="SR",i.ST="ST",i.SV="SV",i.SX="SX",i.SY="SY",i.SZ="SZ",i.TC="TC",i.TD="TD",i.TG="TG",i.TH="TH",i.TJ="TJ",i.TL="TL",i.TM="TM",i.TN="TN",i.TO="TO",i.TR="TR",i.TT="TT",i.TW="TW",i.TZ="TZ",i.UA="UA",i.UG="UG",i.US="US",i.UY="UY",i.UZ="UZ",i.VC="VC",i.VE="VE",i.VG="VG",i.VN="VN",i.VU="VU",i.WS="WS",i.XK="XK",i.YE="YE",i.YT="YT",i.ZA="ZA",i.ZM="ZM",i.ZW="ZW",i}(ce||{});var loe={cardNumber:["Number","Card number"],cardExpiry:["Expires","Valid through"]},coe={colorSelectorModeNames:["Solid color","Gradient"],toolbarTools:{undo:"Undo",redo:"Redo",font:"Font",fontStyle:"Font style",fontSize:"Font size",bold:"Bold",italic:"Italic",underline:"Underline",strikeThrough:"Strike through",justify:"Justify",justifyLeft:"Justify left",justifyCenter:"Justify center",justifyRight:"Justify right",justifyFull:"Justify full",list:"List",indent:"Indent",outdent:"Outdent",unorderedList:"Unordered list",orderedList:"Ordered list",quote:"Quote",foreColor:"Color",backColor:"Background color",hiliteColor:"Highlight color",clear:"Clear",link:"Link",attach:"Attach file",tex:"Insert TeX",code:"Code",image:"Insert image",insertHorizontalRule:"Insert horizontal rule",superscript:"Superscript",subscript:"Subscript",insertTable:"Insert table",insertGroup:"Insert group",hiliteGroup:"Hilite group",removeGroup:"Remove group",insertAnchor:"Insert anchor",mergeCells:"Merge cells",splitCells:"Split cells",rowsColumnsManaging:"Managing rows and columns",cellColor:"Cell color",setDetails:"Details",removeDetails:"Remove details"},editorEditLink:{urlExample:"example.com",anchorExample:"anchor"},editorTableCommands:[["Insert column before","Insert column after"],["Insert row before","Insert row after"],["Delete column","Delete row"]],editorCodeOptions:["Code in the text","Code in block"],editorFontOptions:{small:"Small",large:"Large",normal:"Normal",title:"Title",subtitle:"Subtitle"}},uoe={previewTexts:{rotate:"Rotate"},zoomTexts:{zoomOut:"Zoom out",zoomIn:"Zoom in",reset:"Reset"}},doe={showHideText:"Show/Hide",paginationTexts:{pages:"Pages",linesPerPage:"Lines per page",of:"of"}},hoe={[ce.AD]:"Andorra",[ce.AE]:"United Arab Emirates",[ce.AF]:"Afghanistan",[ce.AG]:"Antigua and Barbuda",[ce.BL]:"Saint Barth\xE9lemy",[ce.AI]:"Anguilla",[ce.AL]:"Albania",[ce.AM]:"Armenia",[ce.AO]:"Angola",[ce.AR]:"Argentina",[ce.AT]:"Austria",[ce.AU]:"Australia",[ce.AW]:"Aruba",[ce.AZ]:"Azerbaijan",[ce.BA]:"Bosnia and Herzegovina",[ce.BB]:"Barbados",[ce.BD]:"Bangladesh",[ce.BE]:"Belgium",[ce.BF]:"Burkina Faso",[ce.BG]:"Bulgaria",[ce.BH]:"Bahrain",[ce.BI]:"Burundi",[ce.BJ]:"Benin",[ce.GF]:"Guyana",[ce.BM]:"Bermuda",[ce.BN]:"Brunei Darussalam",[ce.BO]:"Bolivia",[ce.BQ]:"Bonaire, Sint Eustatius and Saba",[ce.BR]:"Brazil",[ce.BS]:"Bahamas",[ce.BT]:"Bhutan",[ce.BW]:"Botswana",[ce.BY]:"Belarus",[ce.BZ]:"Belize",[ce.CA]:"Canada",[ce.CD]:"Dem. Rep. Congo (Kinshasa)",[ce.CF]:"Central African Republic",[ce.CG]:"Congo (Brazzaville)",[ce.CH]:"Switzerland",[ce.CI]:"Ivory Coast",[ce.CL]:"Chile",[ce.CM]:"Cameroon",[ce.CN]:"China",[ce.CO]:"Colombia",[ce.CR]:"Costa Rica",[ce.CU]:"Cuba",[ce.CV]:"Cape Verde",[ce.CW]:"Cura\xE7ao",[ce.CY]:"Cyprus",[ce.CZ]:"Czech Republic",[ce.DE]:"Germany",[ce.DJ]:"Djibouti",[ce.DK]:"Denmark",[ce.DM]:"Dominica",[ce.DO]:"Dominican Republic",[ce.DZ]:"Algeria",[ce.EC]:"Ecuador",[ce.EE]:"Estonia",[ce.EG]:"Egypt",[ce.ER]:"Eritrea",[ce.ES]:"Spain",[ce.ET]:"Ethiopia",[ce.FI]:"Finland",[ce.FJ]:"Fiji",[ce.FK]:"Falkland Islands",[ce.FM]:"F.S. of Micronesia",[ce.FR]:"France",[ce.GA]:"Gabon",[ce.GB]:"United Kingdom",[ce.GD]:"Grenada",[ce.GE]:"Georgia",[ce.GP]:"Guadeloupe",[ce.GH]:"Ghana",[ce.GI]:"Gibraltar",[ce.GL]:"Greenland",[ce.GM]:"Gambia",[ce.GN]:"Guinea",[ce.MF]:"Saint-Martin",[ce.GQ]:"Equatorial Guinea",[ce.GR]:"Greece",[ce.GT]:"Guatemala",[ce.GW]:"Guinea-Bissau",[ce.GY]:"Guyana",[ce.HK]:"Hong Kong",[ce.HN]:"Honduras",[ce.HR]:"Croatia",[ce.HT]:"Haiti",[ce.HU]:"Hungary",[ce.ID]:"Indonesia",[ce.IE]:"Ireland",[ce.IL]:"Israel",[ce.IN]:"India",[ce.IQ]:"Iraq",[ce.IR]:"Iran",[ce.IS]:"Iceland",[ce.IT]:"Italy",[ce.JM]:"Jamaica",[ce.JO]:"Jordan",[ce.JP]:"Japan",[ce.KE]:"Kenya",[ce.KG]:"Kyrgyzstan",[ce.KH]:"Cambodia",[ce.KM]:"Comoros",[ce.KN]:"Saint Kitts and Nevis",[ce.KP]:"Korean PDR",[ce.KR]:"Rep. Korea",[ce.KW]:"Kuwait",[ce.KY]:"Cayman Islands",[ce.KZ]:"Kazakhstan",[ce.LA]:"Laos",[ce.LB]:"Lebanon",[ce.LC]:"Saint Lucia",[ce.LI]:"Liechtenstein",[ce.LK]:"Sri Lanka",[ce.LR]:"Liberia",[ce.LS]:"Lesotho",[ce.LT]:"Lithuania",[ce.LU]:"Luxembourg",[ce.LV]:"Latvia",[ce.LY]:"Libya",[ce.MA]:"Morocco",[ce.MC]:"Monaco",[ce.MD]:"Moldova",[ce.ME]:"Montenegro",[ce.MQ]:"Martinique",[ce.MG]:"Madagascar",[ce.MK]:"Rep. of North Macedonia",[ce.ML]:"Mali",[ce.MM]:"Burma (Myanmar)",[ce.MN]:"Mongolia",[ce.MO]:"Macau",[ce.RE]:"R\xE9union",[ce.MR]:"Mauritania",[ce.MS]:"Montserrat",[ce.MT]:"Malta",[ce.MU]:"Mauritius",[ce.MV]:"Maldives",[ce.MW]:"Malawi",[ce.MX]:"Mexico",[ce.MY]:"Malaysia",[ce.MZ]:"Mozambique",[ce.NA]:"Namibia",[ce.NC]:"New Caledonia",[ce.NE]:"Niger",[ce.NG]:"Nigeria",[ce.NI]:"Nicaragua",[ce.NL]:"Netherlands",[ce.NO]:"Norway",[ce.NP]:"Nepal",[ce.NZ]:"New Zealand",[ce.OM]:"Oman",[ce.PA]:"Panama",[ce.PE]:"Peru",[ce.PF]:"French Polynesia (Tahiti)",[ce.PG]:"Papua New Guinea",[ce.PH]:"Philippines",[ce.PK]:"Pakistan",[ce.PL]:"Poland",[ce.PT]:"Portugal",[ce.PW]:"Palau",[ce.PY]:"Paraguay",[ce.QA]:"Qatar",[ce.YT]:"Mayotte",[ce.RO]:"Romania",[ce.RS]:"Serbia",[ce.RU]:"Russia",[ce.RW]:"Rwanda",[ce.SA]:"Saudi Arabia",[ce.SB]:"Solomon Islands",[ce.SC]:"Seychelles",[ce.SD]:"Sudan",[ce.SE]:"Sweden",[ce.SG]:"Singapore",[ce.SH]:"Saint Helena",[ce.SI]:"Slovenia",[ce.SK]:"Slovakia",[ce.SL]:"Sierra Leone",[ce.SM]:"San Marino",[ce.SN]:"Senegal",[ce.SO]:"Somalia",[ce.SR]:"Suriname",[ce.ST]:"Sao Tome and Principe",[ce.SV]:"El Salvador",[ce.SX]:"Sint Maarten",[ce.SY]:"Syrian Arab Republic",[ce.SZ]:"Swaziland",[ce.TC]:"Turks and Caicos",[ce.TD]:"Chad",[ce.TG]:"Togo",[ce.TH]:"Thailand",[ce.TJ]:"Tajikistan",[ce.TL]:"East Timor",[ce.TM]:"Turkmenistan",[ce.TN]:"Tunisia",[ce.TO]:"Tonga",[ce.TR]:"Turkey",[ce.TT]:"Trinidad and Tobago",[ce.TW]:"Taiwan",[ce.TZ]:"Tanzania",[ce.UA]:"Ukraine",[ce.UG]:"Uganda",[ce.US]:"USA",[ce.UY]:"Uruguay",[ce.UZ]:"Uzbekistan",[ce.VC]:"Saint Vincent and the Grenadines",[ce.VE]:"Venezuela",[ce.VG]:"British Virgin Islands",[ce.VN]:"Vietnam",[ce.VU]:"Vanuatu",[ce.WS]:"Samoa",[ce.XK]:"Kosovo",[ce.YE]:"Yemen",[ce.ZA]:"South Africa",[ce.ZM]:"Zambia",[ce.ZW]:"Zimbabwe"},foe={months:["January","February","March","April","May","June","July","August","September","October","November","December"],close:"Close",nothingFoundMessage:"Nothing found",defaultErrorMessage:"Value is invalid",spinTexts:["Previous","Next"],shortWeekDays:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],countries:hoe},poe={cancel:"Cancel",done:"Done",more:"More",otherDate:"Other date...",showAll:"Show all",hide:"Hide",mobileCalendarTexts:["Choose day","Choose range","Choose days"],range:["from","to"],countTexts:["Plus","Minus"],time:{"HH:MM":"HH:MM","HH:MM:SS":"HH:MM:SS","HH:MM:SS.MSS":"HH:MM:SS.MSS"},dateTexts:{DMY:"dd.mm.yyyy",MDY:"mm.dd.yyyy",YMD:"yyyy.mm.dd"},digitalInformationUnits:["B","KiB","MiB"],passwordTexts:["Show password","Hide password"],copyTexts:["Copy","Copied"],shortCalendarMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pagination:["Previous page","Next page"],fileTexts:{loadingError:"Upload failed",preview:"Preview",remove:"Remove"},inputFileTexts:{defaultLabelSingle:"or drop\xA0it\xA0here",defaultLabelMultiple:"or drop\xA0them\xA0here",defaultLinkSingle:"Choose a file",defaultLinkMultiple:"Choose files",maxSizeRejectionReason:"File is too large ",formatRejectionReason:"Wrong file type",drop:"Drop file here",dropMultiple:"Drop files here"},multiSelectTexts:{all:"Select all",none:"Select none"},prompt:{yes:"Yes",no:"No"}},O4=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:"english"},foe),poe),doe),loe),coe),uoe);var moe=new ot("[TUI_DEFAULT_LANGUAGE]",{factory:()=>O4}),R4=new ot("[TUI_LANGUAGE]",{factory:()=>Nt(Ee(moe))}),Cwe=new ot("[TUI_LANGUAGE_LOADER]"),Swe=new ot("[TUI_LANGUAGE_STORAGE_KEY]",{factory:()=>"tuiLanguage"});function ff(i){return()=>Ee(R4).pipe(Fi(r=>xh(r)?r:Nt(r)),st(r=>r[i]))}function C1({document:i,innerWidth:r}){return Math.max(i.documentElement.clientWidth||0,r||0)}var AD='width="',PD='height="',OD="<svg";function L4(i,r){if(i.includes(`id="${r}"`))return i;let a=i.slice(Math.max(0,i.indexOf(OD))),c=a.slice(0,Math.max(0,a.indexOf(">")));if(!c?.includes(AD)||!c.includes(PD))return`${a.replace(OD,`<svg xmlns="http://www.w3.org/2000/svg"><g id="${r}" xmlns="http://www.w3.org/2000/svg"><svg`)}</g></svg>`;let h=c.indexOf(AD),m=c.indexOf(PD),y=h+AD.length,w=m+PD.length,C=c.slice(y,c.indexOf('"',y)),D=c.slice(w,c.indexOf('"',w));if(!D||!C||C.includes("%")||D.includes("%")||C.includes("em")||D.includes("em"))return a.replace(OD,`<svg id="${r}"`);let z=parseInt(C,10),j=parseInt(D,10);return`<g id="${r}" xmlns="http://www.w3.org/2000/svg"><svg  x="50%" y="50%" width="${z/16}em" height="${j/16}em" overflow="visible" viewBox="0 0 ${z} ${j}"><svg x="${-z/2}" y="${-j/2}">${a}</svg></svg></g>`}var F_=`?v=${AU}`;var F4=i=>i.includes(".svg#")?i:`#${i}`,S1=()=>CU,RD={decimalLimit:1/0,decimalSeparator:",",thousandSeparator:I_,zeroPadding:!0,rounding:"truncate",decimal:"not-zero"};var k4="tui-scroll-into-view";var N4="tui-icon-error";function D1(i){let r=i.endsWith("/")?i:`${i}/`;return a=>a.startsWith("tuiIcon")?`${r}${a}.svg${F_}#${a}`:F4(a)}function B4(i){let r=i.trim();return r.startsWith("<")&&r.endsWith(">")}var z4={xxs:0,xs:1,s:2,m:3,l:4,xl:5,xxl:6};function j4(i,r="s"){return z4[i]>z4[r]}function V4(i,{mobile:r}){return C1(i)<r}var k_=function(i){return i.Accent="accent",i.Flat="flat",i.Icon="icon",i.Outline="outline",i.Primary="primary",i.Secondary="secondary",i.SecondaryDestructive="secondary-destructive",i.Table="table",i.Textfield="textfield",i.Whiteblock="whiteblock",i.WhiteblockActive="whiteblock-active",i}(k_||{});var aa=function(i){return i.Active="active",i.Disabled="disabled",i.Hover="hover",i.Readonly="readonly",i}(aa||{});var Da=function(i){return i.End="end",i.Single="single",i.Start="start",i}(Da||{});var LD=ii(()=>{var i,r,a;return(a=(r=(i=Ee(jn).defaultView)===null||i===void 0?void 0:i.matchMedia)===null||r===void 0?void 0:r.call(i,"(prefers-reduced-motion: reduce)").matches)!==null&&a!==void 0?a:!1}),goe=300,N_=ii(()=>Ee(LD)?0:goe),U4=ii(()=>({value:"",params:{duration:Ee(N_)}})),eTe=ii(()=>xj()),_oe={check:"tuiIconCheck",close:"tuiIconClose",error:"tuiIconAlertCircle",more:"tuiIconChevronRight"},A1=ki(_oe);var tTe=new ot("[TUI_DATA_LIST_ACCESSOR]");var nTe=new ot("[TUI_DATA_LIST_HOST]");var $4=ki(i=>i.isWeekend?"weekend":"weekday"),iTe=new ot("[TUI_DOCUMENT_OR_SHADOW_ROOT]"),rTe=new ot("[TUI_ELEMENT_REF]"),z_=ki(rm.Monday),H4=ii(ff("months")),P1=ii(ff("close")),oTe=ii(ff("nothingFoundMessage")),sTe=ii(ff("defaultErrorMessage")),G4=ii(ff("spinTexts")),FD=ii(ff("shortWeekDays")),O1="assets/taiga-ui/icons",kD=ki(O1),W4=ki({}),q4=ii(()=>D1(Ee(kD))),ND=ki({mobile:768,desktopSmall:1024,desktopLarge:1280}),zD=ii(()=>{let i=Ee(Ui),r=Ee(ND);return Un(i,"resize").pipe(ya(),xr(null),st(()=>V4(i,r)),Ro(),Ll(Ee(oi)))}),aTe=new ot("[TUI_LEGACY_MASK]"),am=new ot("[TUI_MODE]"),yoe={info:"tuiIconInfo",success:"tuiIconCheckCircle",error:"tuiIconXCircle",warning:"tuiIconAlertCircle",neutral:"tuiIconInfo"},voe={autoClose:3e3,label:"",status:"info",hasCloseButton:!0,icon:({$implicit:i})=>yoe[i],size:"m",hasIcon:!0,defaultAutoCloseTime:3e3},R1=ki(voe);var lTe=ki(RD);var cTe=ki(Nt(Object.assign(Object.assign({},RD),{decimalLimit:NaN}))),uTe=new ot("[TUI_OPTION_CONTENT]");var xoe=i=>{let r=i.length-1;return[i[r],...i.slice(0,r)]},dTe=ii(()=>{let i=Ee(z_);return Ee(FD).pipe(st(xoe),st(r=>[...r.slice(i),...r.slice(0,i)]))}),lm=new ot("[TUI_SANITIZER]");var hTe=ii(()=>{let i=Ee(jn);return go(Un(i,"selectionchange"),Un(i,"mouseup"),Un(i,"mousedown").pipe(Fi(()=>Un(i,"mousemove").pipe(Ii(Un(i,"mouseup"))))),Un(i,"keydown"),Un(i,"keyup")).pipe(ya())}),Z4=ki({decrement:"tuiIconChevronLeft",increment:"tuiIconChevronRight"}),Y4=ki(i1),X4=ki(mo),fTe=ki(k_.Textfield),pTe=new ot("[TUI_TEXTFIELD_HOST]");var K4=ki("Taiga"),mTe=new ot("[TUI_VALUE_ACCESSOR]"),gTe=ii(()=>{let i=Ee(Ui);return{type:"viewport",getClientRect(){return{top:0,left:0,right:i.innerWidth,bottom:i.innerHeight,width:i.innerWidth,height:i.innerHeight}}}});var fi="primary",Q_=Symbol("RouteTitle"),$D=class{constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){let a=this.params[r];return Array.isArray(a)?a[0]:a}return null}getAll(r){if(this.has(r)){let a=this.params[r];return Array.isArray(a)?a:[a]}return[]}get keys(){return Object.keys(this.params)}};function fm(i){return new $D(i)}function boe(i,r,a){let c=a.path.split("/");if(c.length>i.length||a.pathMatch==="full"&&(r.hasChildren()||c.length<i.length))return null;let h={};for(let m=0;m<c.length;m++){let y=c[m],w=i[m];if(y.startsWith(":"))h[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:i.slice(0,c.length),posParams:h}}function woe(i,r){if(i.length!==r.length)return!1;for(let a=0;a<i.length;++a)if(!vc(i[a],r[a]))return!1;return!0}function vc(i,r){let a=i?HD(i):void 0,c=r?HD(r):void 0;if(!a||!c||a.length!=c.length)return!1;let h;for(let m=0;m<a.length;m++)if(h=a[m],!i5(i[h],r[h]))return!1;return!0}function HD(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function i5(i,r){if(Array.isArray(i)&&Array.isArray(r)){if(i.length!==r.length)return!1;let a=[...i].sort(),c=[...r].sort();return a.every((h,m)=>c[m]===h)}else return i===r}function r5(i){return i.length>0?i[i.length-1]:null}function Pd(i){return xh(i)?i:fd(i)?vr(Promise.resolve(i)):Nt(i)}var Toe={exact:s5,subset:a5},o5={exact:Eoe,subset:Moe,ignored:()=>!0};function J4(i,r,a){return Toe[a.paths](i.root,r.root,a.matrixParams)&&o5[a.queryParams](i.queryParams,r.queryParams)&&!(a.fragment==="exact"&&i.fragment!==r.fragment)}function Eoe(i,r){return vc(i,r)}function s5(i,r,a){if(!mf(i.segments,r.segments)||!k1(i.segments,r.segments,a)||i.numberOfChildren!==r.numberOfChildren)return!1;for(let c in r.children)if(!i.children[c]||!s5(i.children[c],r.children[c],a))return!1;return!0}function Moe(i,r){return Object.keys(r).length<=Object.keys(i).length&&Object.keys(r).every(a=>i5(i[a],r[a]))}function a5(i,r,a){return l5(i,r,r.segments,a)}function l5(i,r,a,c){if(i.segments.length>a.length){let h=i.segments.slice(0,a.length);return!(!mf(h,a)||r.hasChildren()||!k1(h,a,c))}else if(i.segments.length===a.length){if(!mf(i.segments,a)||!k1(i.segments,a,c))return!1;for(let h in r.children)if(!i.children[h]||!a5(i.children[h],r.children[h],c))return!1;return!0}else{let h=a.slice(0,i.segments.length),m=a.slice(i.segments.length);return!mf(i.segments,h)||!k1(i.segments,h,c)||!i.children[fi]?!1:l5(i.children[fi],r,m,c)}}function k1(i,r,a){return r.every((c,h)=>o5[a](i[h].parameters,c.parameters))}var Sd=class{constructor(r=new mr([],{}),a={},c=null){this.root=r,this.queryParams=a,this.fragment=c}get queryParamMap(){return this._queryParamMap??=fm(this.queryParams),this._queryParamMap}toString(){return Soe.serialize(this)}},mr=class{constructor(r,a){this.segments=r,this.children=a,this.parent=null,Object.values(a).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return N1(this)}},pf=class{constructor(r,a){this.path=r,this.parameters=a}get parameterMap(){return this._parameterMap??=fm(this.parameters),this._parameterMap}toString(){return u5(this)}};function Ioe(i,r){return mf(i,r)&&i.every((a,c)=>vc(a.parameters,r[c].parameters))}function mf(i,r){return i.length!==r.length?!1:i.every((a,c)=>a.path===r[c].path)}function Coe(i,r){let a=[];return Object.entries(i.children).forEach(([c,h])=>{c===fi&&(a=a.concat(r(h,c)))}),Object.entries(i.children).forEach(([c,h])=>{c!==fi&&(a=a.concat(r(h,c)))}),a}var gA=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:()=>new B1,providedIn:"root"});let i=r;return i})(),B1=class{parse(r){let a=new WD(r);return new Sd(a.parseRootSegment(),a.parseQueryParams(),a.parseFragment())}serialize(r){let a=`/${B_(r.root,!0)}`,c=Poe(r.queryParams),h=typeof r.fragment=="string"?`#${Doe(r.fragment)}`:"";return`${a}${c}${h}`}},Soe=new B1;function N1(i){return i.segments.map(r=>u5(r)).join("/")}function B_(i,r){if(!i.hasChildren())return N1(i);if(r){let a=i.children[fi]?B_(i.children[fi],!1):"",c=[];return Object.entries(i.children).forEach(([h,m])=>{h!==fi&&c.push(`${h}:${B_(m,!1)}`)}),c.length>0?`${a}(${c.join("//")})`:a}else{let a=Coe(i,(c,h)=>h===fi?[B_(i.children[fi],!1)]:[`${h}:${B_(c,!1)}`]);return Object.keys(i.children).length===1&&i.children[fi]!=null?`${N1(i)}/${a[0]}`:`${N1(i)}/(${a.join("//")})`}}function c5(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function L1(i){return c5(i).replace(/%3B/gi,";")}function Doe(i){return encodeURI(i)}function GD(i){return c5(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function z1(i){return decodeURIComponent(i)}function Q4(i){return z1(i.replace(/\+/g,"%20"))}function u5(i){return`${GD(i.path)}${Aoe(i.parameters)}`}function Aoe(i){return Object.entries(i).map(([r,a])=>`;${GD(r)}=${GD(a)}`).join("")}function Poe(i){let r=Object.entries(i).map(([a,c])=>Array.isArray(c)?c.map(h=>`${L1(a)}=${L1(h)}`).join("&"):`${L1(a)}=${L1(c)}`).filter(a=>a);return r.length?`?${r.join("&")}`:""}var Ooe=/^[^\/()?;#]+/;function BD(i){let r=i.match(Ooe);return r?r[0]:""}var Roe=/^[^\/()?;=#]+/;function Loe(i){let r=i.match(Roe);return r?r[0]:""}var Foe=/^[^=?&#]+/;function koe(i){let r=i.match(Foe);return r?r[0]:""}var Noe=/^[^&#]+/;function zoe(i){let r=i.match(Noe);return r?r[0]:""}var WD=class{constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new mr([],{}):new mr([],this.parseChildren())}parseQueryParams(){let r={};if(this.consumeOptional("?"))do this.parseQueryParam(r);while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let a={};this.peekStartsWith("/(")&&(this.capture("/"),a=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(r.length>0||Object.keys(a).length>0)&&(c[fi]=new mr(r,a)),c}parseSegment(){let r=BD(this.remaining);if(r===""&&this.peekStartsWith(";"))throw new mt(4009,!1);return this.capture(r),new pf(z1(r),this.parseMatrixParams())}parseMatrixParams(){let r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){let a=Loe(this.remaining);if(!a)return;this.capture(a);let c="";if(this.consumeOptional("=")){let h=BD(this.remaining);h&&(c=h,this.capture(c))}r[z1(a)]=z1(c)}parseQueryParam(r){let a=koe(this.remaining);if(!a)return;this.capture(a);let c="";if(this.consumeOptional("=")){let y=zoe(this.remaining);y&&(c=y,this.capture(c))}let h=Q4(a),m=Q4(c);if(r.hasOwnProperty(h)){let y=r[h];Array.isArray(y)||(y=[y],r[h]=y),y.push(m)}else r[h]=m}parseParens(r){let a={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let c=BD(this.remaining),h=this.remaining[c.length];if(h!=="/"&&h!==")"&&h!==";")throw new mt(4010,!1);let m;c.indexOf(":")>-1?(m=c.slice(0,c.indexOf(":")),this.capture(m),this.capture(":")):r&&(m=fi);let y=this.parseChildren();a[m]=Object.keys(y).length===1?y[fi]:new mr([],y),this.consumeOptional("//")}return a}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return this.peekStartsWith(r)?(this.remaining=this.remaining.substring(r.length),!0):!1}capture(r){if(!this.consumeOptional(r))throw new mt(4011,!1)}};function d5(i){return i.segments.length>0?new mr([],{[fi]:i}):i}function h5(i){let r={};for(let[c,h]of Object.entries(i.children)){let m=h5(h);if(c===fi&&m.segments.length===0&&m.hasChildren())for(let[y,w]of Object.entries(m.children))r[y]=w;else(m.segments.length>0||m.hasChildren())&&(r[c]=m)}let a=new mr(i.segments,r);return Boe(a)}function Boe(i){if(i.numberOfChildren===1&&i.children[fi]){let r=i.children[fi];return new mr(i.segments.concat(r.segments),r.children)}return i}function pm(i){return i instanceof Sd}function joe(i,r,a=null,c=null){let h=f5(i);return p5(h,r,a,c)}function f5(i){let r;function a(m){let y={};for(let C of m.children){let D=a(C);y[C.outlet]=D}let w=new mr(m.url,y);return m===i&&(r=w),w}let c=a(i.root),h=d5(c);return r??h}function p5(i,r,a,c){let h=i;for(;h.parent;)h=h.parent;if(r.length===0)return jD(h,h,h,a,c);let m=Voe(r);if(m.toRoot())return jD(h,h,new mr([],{}),a,c);let y=Uoe(m,h,i),w=y.processChildren?U_(y.segmentGroup,y.index,m.commands):g5(y.segmentGroup,y.index,m.commands);return jD(h,y.segmentGroup,w,a,c)}function j1(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function G_(i){return typeof i=="object"&&i!=null&&i.outlets}function jD(i,r,a,c,h){let m={};c&&Object.entries(c).forEach(([C,D])=>{m[C]=Array.isArray(D)?D.map(z=>`${z}`):`${D}`});let y;i===r?y=a:y=m5(i,r,a);let w=d5(h5(y));return new Sd(w,m,h)}function m5(i,r,a){let c={};return Object.entries(i.children).forEach(([h,m])=>{m===r?c[h]=a:c[h]=m5(m,r,a)}),new mr(i.segments,c)}var V1=class{constructor(r,a,c){if(this.isAbsolute=r,this.numberOfDoubleDots=a,this.commands=c,r&&c.length>0&&j1(c[0]))throw new mt(4003,!1);let h=c.find(G_);if(h&&h!==r5(c))throw new mt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Voe(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new V1(!0,0,i);let r=0,a=!1,c=i.reduce((h,m,y)=>{if(typeof m=="object"&&m!=null){if(m.outlets){let w={};return Object.entries(m.outlets).forEach(([C,D])=>{w[C]=typeof D=="string"?D.split("/"):D}),[...h,{outlets:w}]}if(m.segmentPath)return[...h,m.segmentPath]}return typeof m!="string"?[...h,m]:y===0?(m.split("/").forEach((w,C)=>{C==0&&w==="."||(C==0&&w===""?a=!0:w===".."?r++:w!=""&&h.push(w))}),h):[...h,m]},[]);return new V1(a,r,c)}var dm=class{constructor(r,a,c){this.segmentGroup=r,this.processChildren=a,this.index=c}};function Uoe(i,r,a){if(i.isAbsolute)return new dm(r,!0,0);if(!a)return new dm(r,!1,NaN);if(a.parent===null)return new dm(a,!0,0);let c=j1(i.commands[0])?0:1,h=a.segments.length-1+c;return $oe(a,h,i.numberOfDoubleDots)}function $oe(i,r,a){let c=i,h=r,m=a;for(;m>h;){if(m-=h,c=c.parent,!c)throw new mt(4005,!1);h=c.segments.length}return new dm(c,!1,h-m)}function Hoe(i){return G_(i[0])?i[0].outlets:{[fi]:i}}function g5(i,r,a){if(i??=new mr([],{}),i.segments.length===0&&i.hasChildren())return U_(i,r,a);let c=Goe(i,r,a),h=a.slice(c.commandIndex);if(c.match&&c.pathIndex<i.segments.length){let m=new mr(i.segments.slice(0,c.pathIndex),{});return m.children[fi]=new mr(i.segments.slice(c.pathIndex),i.children),U_(m,0,h)}else return c.match&&h.length===0?new mr(i.segments,{}):c.match&&!i.hasChildren()?qD(i,r,a):c.match?U_(i,0,h):qD(i,r,a)}function U_(i,r,a){if(a.length===0)return new mr(i.segments,{});{let c=Hoe(a),h={};if(Object.keys(c).some(m=>m!==fi)&&i.children[fi]&&i.numberOfChildren===1&&i.children[fi].segments.length===0){let m=U_(i.children[fi],r,a);return new mr(i.segments,m.children)}return Object.entries(c).forEach(([m,y])=>{typeof y=="string"&&(y=[y]),y!==null&&(h[m]=g5(i.children[m],r,y))}),Object.entries(i.children).forEach(([m,y])=>{c[m]===void 0&&(h[m]=y)}),new mr(i.segments,h)}}function Goe(i,r,a){let c=0,h=r,m={match:!1,pathIndex:0,commandIndex:0};for(;h<i.segments.length;){if(c>=a.length)return m;let y=i.segments[h],w=a[c];if(G_(w))break;let C=`${w}`,D=c<a.length-1?a[c+1]:null;if(h>0&&C===void 0)break;if(C&&D&&typeof D=="object"&&D.outlets===void 0){if(!t5(C,D,y))return m;c+=2}else{if(!t5(C,{},y))return m;c++}h++}return{match:!0,pathIndex:h,commandIndex:c}}function qD(i,r,a){let c=i.segments.slice(0,r),h=0;for(;h<a.length;){let m=a[h];if(G_(m)){let C=Woe(m.outlets);return new mr(c,C)}if(h===0&&j1(a[0])){let C=i.segments[r];c.push(new pf(C.path,e5(a[0]))),h++;continue}let y=G_(m)?m.outlets[fi]:`${m}`,w=h<a.length-1?a[h+1]:null;y&&w&&j1(w)?(c.push(new pf(y,e5(w))),h+=2):(c.push(new pf(y,{})),h++)}return new mr(c,{})}function Woe(i){let r={};return Object.entries(i).forEach(([a,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(r[a]=qD(new mr([],{}),0,c))}),r}function e5(i){let r={};return Object.entries(i).forEach(([a,c])=>r[a]=`${c}`),r}function t5(i,r,a){return i==a.path&&vc(r,a.parameters)}var $_="imperative",cs=function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i}(cs||{}),tl=class{constructor(r,a){this.id=r,this.url=a}},W_=class extends tl{constructor(r,a,c="imperative",h=null){super(r,a),this.type=cs.NavigationStart,this.navigationTrigger=c,this.restoredState=h}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Dd=class extends tl{constructor(r,a,c){super(r,a),this.urlAfterRedirects=c,this.type=cs.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},el=function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i}(el||{}),ZD=function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i}(ZD||{}),Ad=class extends tl{constructor(r,a,c,h){super(r,a),this.reason=c,this.code=h,this.type=cs.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},gf=class extends tl{constructor(r,a,c,h){super(r,a),this.reason=c,this.code=h,this.type=cs.NavigationSkipped}},q_=class extends tl{constructor(r,a,c,h){super(r,a),this.error=c,this.target=h,this.type=cs.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},U1=class extends tl{constructor(r,a,c,h){super(r,a),this.urlAfterRedirects=c,this.state=h,this.type=cs.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},YD=class extends tl{constructor(r,a,c,h){super(r,a),this.urlAfterRedirects=c,this.state=h,this.type=cs.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},XD=class extends tl{constructor(r,a,c,h,m){super(r,a),this.urlAfterRedirects=c,this.state=h,this.shouldActivate=m,this.type=cs.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},KD=class extends tl{constructor(r,a,c,h){super(r,a),this.urlAfterRedirects=c,this.state=h,this.type=cs.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},JD=class extends tl{constructor(r,a,c,h){super(r,a),this.urlAfterRedirects=c,this.state=h,this.type=cs.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},QD=class{constructor(r){this.route=r,this.type=cs.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},eA=class{constructor(r){this.route=r,this.type=cs.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},tA=class{constructor(r){this.snapshot=r,this.type=cs.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},nA=class{constructor(r){this.snapshot=r,this.type=cs.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},iA=class{constructor(r){this.snapshot=r,this.type=cs.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},rA=class{constructor(r){this.snapshot=r,this.type=cs.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Z_=class{},Y_=class{constructor(r){this.url=r}};var oA=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Z1,this.attachRef=null}},Z1=(()=>{let r=class r{constructor(){this.contexts=new Map}onChildOutletCreated(c,h){let m=this.getOrCreateContext(c);m.outlet=h,this.contexts.set(c,m)}onChildOutletDestroyed(c){let h=this.getContext(c);h&&(h.outlet=null,h.attachRef=null)}onOutletDeactivated(){let c=this.contexts;return this.contexts=new Map,c}onOutletReAttached(c){this.contexts=c}getOrCreateContext(c){let h=this.getContext(c);return h||(h=new oA,this.contexts.set(c,h)),h}getContext(c){return this.contexts.get(c)||null}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})(),$1=class{constructor(r){this._root=r}get root(){return this._root.value}parent(r){let a=this.pathFromRoot(r);return a.length>1?a[a.length-2]:null}children(r){let a=sA(r,this._root);return a?a.children.map(c=>c.value):[]}firstChild(r){let a=sA(r,this._root);return a&&a.children.length>0?a.children[0].value:null}siblings(r){let a=aA(r,this._root);return a.length<2?[]:a[a.length-2].children.map(h=>h.value).filter(h=>h!==r)}pathFromRoot(r){return aA(r,this._root).map(a=>a.value)}};function sA(i,r){if(i===r.value)return r;for(let a of r.children){let c=sA(i,a);if(c)return c}return null}function aA(i,r){if(i===r.value)return[r];for(let a of r.children){let c=aA(i,a);if(c.length)return c.unshift(r),c}return[]}var Aa=class{constructor(r,a){this.value=r,this.children=a}toString(){return`TreeNode(${this.value})`}};function um(i){let r={};return i&&i.children.forEach(a=>r[a.value.outlet]=a),r}var H1=class extends $1{constructor(r,a){super(r),this.snapshot=a,yA(this,r)}toString(){return this.snapshot.toString()}};function _5(i){let r=qoe(i),a=new pr([new pf("",{})]),c=new pr({}),h=new pr({}),m=new pr({}),y=new pr(""),w=new _f(a,c,m,y,h,fi,i,r.root);return w.snapshot=r.root,new H1(new Aa(w,[]),r)}function qoe(i){let r={},a={},c={},h="",m=new X_([],r,c,h,a,fi,i,null,{});return new G1("",new Aa(m,[]))}var _f=class{constructor(r,a,c,h,m,y,w,C){this.urlSubject=r,this.paramsSubject=a,this.queryParamsSubject=c,this.fragmentSubject=h,this.dataSubject=m,this.outlet=y,this.component=w,this._futureSnapshot=C,this.title=this.dataSubject?.pipe(st(D=>D[Q_]))??Nt(void 0),this.url=r,this.params=a,this.queryParams=c,this.fragment=h,this.data=m}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(st(r=>fm(r))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(st(r=>fm(r))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function _A(i,r,a="emptyOnly"){let c,{routeConfig:h}=i;return r!==null&&(a==="always"||h?.path===""||!r.component&&!r.routeConfig?.loadComponent)?c={params:Lt(Lt({},r.params),i.params),data:Lt(Lt({},r.data),i.data),resolve:Lt(Lt(Lt(Lt({},i.data),r.data),h?.data),i._resolvedData)}:c={params:Lt({},i.params),data:Lt({},i.data),resolve:Lt(Lt({},i.data),i._resolvedData??{})},h&&v5(h)&&(c.resolve[Q_]=h.title),c}var X_=class{get title(){return this.data?.[Q_]}constructor(r,a,c,h,m,y,w,C,D){this.url=r,this.params=a,this.queryParams=c,this.fragment=h,this.data=m,this.outlet=y,this.component=w,this.routeConfig=C,this._resolve=D}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=fm(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=fm(this.queryParams),this._queryParamMap}toString(){let r=this.url.map(c=>c.toString()).join("/"),a=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${r}', path:'${a}')`}},G1=class extends $1{constructor(r,a){super(a),this.url=r,yA(this,a)}toString(){return y5(this._root)}};function yA(i,r){r.value._routerState=i,r.children.forEach(a=>yA(i,a))}function y5(i){let r=i.children.length>0?` { ${i.children.map(y5).join(", ")} } `:"";return`${i.value}${r}`}function VD(i){if(i.snapshot){let r=i.snapshot,a=i._futureSnapshot;i.snapshot=a,vc(r.queryParams,a.queryParams)||i.queryParamsSubject.next(a.queryParams),r.fragment!==a.fragment&&i.fragmentSubject.next(a.fragment),vc(r.params,a.params)||i.paramsSubject.next(a.params),woe(r.url,a.url)||i.urlSubject.next(a.url),vc(r.data,a.data)||i.dataSubject.next(a.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function lA(i,r){let a=vc(i.params,r.params)&&Ioe(i.url,r.url),c=!i.parent!=!r.parent;return a&&!c&&(!i.parent||lA(i.parent,r.parent))}function v5(i){return typeof i.title=="string"||i.title===null}var vA=(()=>{let r=class r{constructor(){this.activated=null,this._activatedRoute=null,this.name=fi,this.activateEvents=new Zn,this.deactivateEvents=new Zn,this.attachEvents=new Zn,this.detachEvents=new Zn,this.parentContexts=Ee(Z1),this.location=Ee(as),this.changeDetector=Ee(co),this.environmentInjector=Ee(ta),this.inputBinder=Ee(xA,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(c){if(c.name){let{firstChange:h,previousValue:m}=c.name;if(h)return;this.isTrackedInParentContexts(m)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(m)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(c){return this.parentContexts.getContext(c)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let c=this.parentContexts.getContext(this.name);c?.route&&(c.attachRef?this.attach(c.attachRef,c.route):this.activateWith(c.route,c.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new mt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new mt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new mt(4012,!1);this.location.detach();let c=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(c.instance),c}attach(c,h){this.activated=c,this._activatedRoute=h,this.location.insert(c.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(c.instance)}deactivate(){if(this.activated){let c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(c,h){if(this.isActivated)throw new mt(4013,!1);this._activatedRoute=c;let m=this.location,w=c.snapshot.component,C=this.parentContexts.getOrCreateContext(this.name).children,D=new cA(c,C,m.injector);this.activated=m.createComponent(w,{index:m.length,injector:D,environmentInjector:h??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};r.\u0275fac=function(h){return new(h||r)},r.\u0275dir=pn({type:r,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[na]});let i=r;return i})(),cA=class{constructor(r,a,c){this.route=r,this.childContexts=a,this.parent=c}get(r,a){return r===_f?this.route:r===Z1?this.childContexts:this.parent.get(r,a)}},xA=new ot("");function Zoe(i,r,a){let c=K_(i,r._root,a?a._root:void 0);return new H1(c,r)}function K_(i,r,a){if(a&&i.shouldReuseRoute(r.value,a.value.snapshot)){let c=a.value;c._futureSnapshot=r.value;let h=Yoe(i,r,a);return new Aa(c,h)}else{if(i.shouldAttach(r.value)){let m=i.retrieve(r.value);if(m!==null){let y=m.route;return y.value._futureSnapshot=r.value,y.children=r.children.map(w=>K_(i,w)),y}}let c=Xoe(r.value),h=r.children.map(m=>K_(i,m));return new Aa(c,h)}}function Yoe(i,r,a){return r.children.map(c=>{for(let h of a.children)if(i.shouldReuseRoute(c.value,h.value.snapshot))return K_(i,c,h);return K_(i,c)})}function Xoe(i){return new _f(new pr(i.url),new pr(i.params),new pr(i.queryParams),new pr(i.fragment),new pr(i.data),i.outlet,i.component,i)}var x5="ngNavigationCancelingError";function b5(i,r){let{redirectTo:a,navigationBehaviorOptions:c}=pm(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,h=w5(!1,el.Redirect);return h.url=a,h.navigationBehaviorOptions=c,h}function w5(i,r){let a=new Error(`NavigationCancelingError: ${i||""}`);return a[x5]=!0,a.cancellationCode=r,a}function Koe(i){return T5(i)&&pm(i.url)}function T5(i){return!!i&&i[x5]}var Joe=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275cmp=Cn({type:r,selectors:[["ng-component"]],standalone:!0,features:[ra],decls:1,vars:0,template:function(h,m){h&1&&wn(0,"router-outlet")},dependencies:[vA],encapsulation:2});let i=r;return i})();function Qoe(i,r){return i.providers&&!i._injector&&(i._injector=XC(i.providers,r,`Route: ${i.path}`)),i._injector??r}function bA(i){let r=i.children&&i.children.map(bA),a=r?Er(Lt({},i),{children:r}):Lt({},i);return!a.component&&!a.loadComponent&&(r||a.loadChildren)&&a.outlet&&a.outlet!==fi&&(a.component=Joe),a}function xc(i){return i.outlet||fi}function ese(i,r){let a=i.filter(c=>xc(c)===r);return a.push(...i.filter(c=>xc(c)!==r)),a}function ey(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let r=i.parent;r;r=r.parent){let a=r.routeConfig;if(a?._loadedInjector)return a._loadedInjector;if(a?._injector)return a._injector}return null}var tse=(i,r,a,c)=>st(h=>(new uA(r,h.targetRouterState,h.currentRouterState,a,c).activate(i),h)),uA=class{constructor(r,a,c,h,m){this.routeReuseStrategy=r,this.futureState=a,this.currState=c,this.forwardEvent=h,this.inputBindingEnabled=m}activate(r){let a=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(a,c,r),VD(this.futureState.root),this.activateChildRoutes(a,c,r)}deactivateChildRoutes(r,a,c){let h=um(a);r.children.forEach(m=>{let y=m.value.outlet;this.deactivateRoutes(m,h[y],c),delete h[y]}),Object.values(h).forEach(m=>{this.deactivateRouteAndItsChildren(m,c)})}deactivateRoutes(r,a,c){let h=r.value,m=a?a.value:null;if(h===m)if(h.component){let y=c.getContext(h.outlet);y&&this.deactivateChildRoutes(r,a,y.children)}else this.deactivateChildRoutes(r,a,c);else m&&this.deactivateRouteAndItsChildren(a,c)}deactivateRouteAndItsChildren(r,a){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,a):this.deactivateRouteAndOutlet(r,a)}detachAndStoreRouteSubtree(r,a){let c=a.getContext(r.value.outlet),h=c&&r.value.component?c.children:a,m=um(r);for(let y of Object.values(m))this.deactivateRouteAndItsChildren(y,h);if(c&&c.outlet){let y=c.outlet.detach(),w=c.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:y,route:r,contexts:w})}}deactivateRouteAndOutlet(r,a){let c=a.getContext(r.value.outlet),h=c&&r.value.component?c.children:a,m=um(r);for(let y of Object.values(m))this.deactivateRouteAndItsChildren(y,h);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(r,a,c){let h=um(a);r.children.forEach(m=>{this.activateRoutes(m,h[m.value.outlet],c),this.forwardEvent(new rA(m.value.snapshot))}),r.children.length&&this.forwardEvent(new nA(r.value.snapshot))}activateRoutes(r,a,c){let h=r.value,m=a?a.value:null;if(VD(h),h===m)if(h.component){let y=c.getOrCreateContext(h.outlet);this.activateChildRoutes(r,a,y.children)}else this.activateChildRoutes(r,a,c);else if(h.component){let y=c.getOrCreateContext(h.outlet);if(this.routeReuseStrategy.shouldAttach(h.snapshot)){let w=this.routeReuseStrategy.retrieve(h.snapshot);this.routeReuseStrategy.store(h.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),VD(w.route.value),this.activateChildRoutes(r,null,y.children)}else{let w=ey(h.snapshot);y.attachRef=null,y.route=h,y.injector=w,y.outlet&&y.outlet.activateWith(h,y.injector),this.activateChildRoutes(r,null,y.children)}}else this.activateChildRoutes(r,null,c)}},W1=class{constructor(r){this.path=r,this.route=this.path[this.path.length-1]}},hm=class{constructor(r,a){this.component=r,this.route=a}};function nse(i,r,a){let c=i._root,h=r?r._root:null;return j_(c,h,a,[c.value])}function ise(i){let r=i.routeConfig?i.routeConfig.canActivateChild:null;return!r||r.length===0?null:{node:i,guards:r}}function gm(i,r){let a=Symbol(),c=r.get(i,a);return c===a?typeof i=="function"&&!L3(i)?i:r.get(i):c}function j_(i,r,a,c,h={canDeactivateChecks:[],canActivateChecks:[]}){let m=um(r);return i.children.forEach(y=>{rse(y,m[y.value.outlet],a,c.concat([y.value]),h),delete m[y.value.outlet]}),Object.entries(m).forEach(([y,w])=>H_(w,a.getContext(y),h)),h}function rse(i,r,a,c,h={canDeactivateChecks:[],canActivateChecks:[]}){let m=i.value,y=r?r.value:null,w=a?a.getContext(i.value.outlet):null;if(y&&m.routeConfig===y.routeConfig){let C=ose(y,m,m.routeConfig.runGuardsAndResolvers);C?h.canActivateChecks.push(new W1(c)):(m.data=y.data,m._resolvedData=y._resolvedData),m.component?j_(i,r,w?w.children:null,c,h):j_(i,r,a,c,h),C&&w&&w.outlet&&w.outlet.isActivated&&h.canDeactivateChecks.push(new hm(w.outlet.component,y))}else y&&H_(r,w,h),h.canActivateChecks.push(new W1(c)),m.component?j_(i,null,w?w.children:null,c,h):j_(i,null,a,c,h);return h}function ose(i,r,a){if(typeof a=="function")return a(i,r);switch(a){case"pathParamsChange":return!mf(i.url,r.url);case"pathParamsOrQueryParamsChange":return!mf(i.url,r.url)||!vc(i.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!lA(i,r)||!vc(i.queryParams,r.queryParams);case"paramsChange":default:return!lA(i,r)}}function H_(i,r,a){let c=um(i),h=i.value;Object.entries(c).forEach(([m,y])=>{h.component?r?H_(y,r.children.getContext(m),a):H_(y,null,a):H_(y,r,a)}),h.component?r&&r.outlet&&r.outlet.isActivated?a.canDeactivateChecks.push(new hm(r.outlet.component,h)):a.canDeactivateChecks.push(new hm(null,h)):a.canDeactivateChecks.push(new hm(null,h))}function ty(i){return typeof i=="function"}function sse(i){return typeof i=="boolean"}function ase(i){return i&&ty(i.canLoad)}function lse(i){return i&&ty(i.canActivate)}function cse(i){return i&&ty(i.canActivateChild)}function use(i){return i&&ty(i.canDeactivate)}function dse(i){return i&&ty(i.canMatch)}function E5(i){return i instanceof Jc||i?.name==="EmptyError"}var F1=Symbol("INITIAL_VALUE");function mm(){return Fi(i=>lc(i.map(r=>r.pipe(Bo(1),xr(F1)))).pipe(st(r=>{for(let a of r)if(a!==!0){if(a===F1)return F1;if(a===!1||a instanceof Sd)return a}return!0}),zi(r=>r!==F1),Bo(1)))}function hse(i,r){return Oo(a=>{let{targetSnapshot:c,currentSnapshot:h,guards:{canActivateChecks:m,canDeactivateChecks:y}}=a;return y.length===0&&m.length===0?Nt(Er(Lt({},a),{guardsResult:!0})):fse(y,c,h,i).pipe(Oo(w=>w&&sse(w)?pse(c,m,i,r):Nt(w)),st(w=>Er(Lt({},a),{guardsResult:w})))})}function fse(i,r,a,c){return vr(i).pipe(Oo(h=>vse(h.component,h.route,a,r,c)),Tl(h=>h!==!0,!0))}function pse(i,r,a,c){return vr(r).pipe(od(h=>cc(gse(h.route.parent,c),mse(h.route,c),yse(i,h.path,a),_se(i,h.route,a))),Tl(h=>h!==!0,!0))}function mse(i,r){return i!==null&&r&&r(new iA(i)),Nt(!0)}function gse(i,r){return i!==null&&r&&r(new tA(i)),Nt(!0)}function _se(i,r,a){let c=r.routeConfig?r.routeConfig.canActivate:null;if(!c||c.length===0)return Nt(!0);let h=c.map(m=>rd(()=>{let y=ey(r)??a,w=gm(m,y),C=lse(w)?w.canActivate(r,i):uu(y,()=>w(r,i));return Pd(C).pipe(Tl())}));return Nt(h).pipe(mm())}function yse(i,r,a){let c=r[r.length-1],m=r.slice(0,r.length-1).reverse().map(y=>ise(y)).filter(y=>y!==null).map(y=>rd(()=>{let w=y.guards.map(C=>{let D=ey(y.node)??a,z=gm(C,D),j=cse(z)?z.canActivateChild(c,i):uu(D,()=>z(c,i));return Pd(j).pipe(Tl())});return Nt(w).pipe(mm())}));return Nt(m).pipe(mm())}function vse(i,r,a,c,h){let m=r&&r.routeConfig?r.routeConfig.canDeactivate:null;if(!m||m.length===0)return Nt(!0);let y=m.map(w=>{let C=ey(r)??h,D=gm(w,C),z=use(D)?D.canDeactivate(i,r,a,c):uu(C,()=>D(i,r,a,c));return Pd(z).pipe(Tl())});return Nt(y).pipe(mm())}function xse(i,r,a,c){let h=r.canLoad;if(h===void 0||h.length===0)return Nt(!0);let m=h.map(y=>{let w=gm(y,i),C=ase(w)?w.canLoad(r,a):uu(i,()=>w(r,a));return Pd(C)});return Nt(m).pipe(mm(),M5(c))}function M5(i){return _p(Vr(r=>{if(pm(r))throw b5(i,r)}),st(r=>r===!0))}function bse(i,r,a,c){let h=r.canMatch;if(!h||h.length===0)return Nt(!0);let m=h.map(y=>{let w=gm(y,i),C=dse(w)?w.canMatch(r,a):uu(i,()=>w(r,a));return Pd(C)});return Nt(m).pipe(mm(),M5(c))}var J_=class{constructor(r){this.segmentGroup=r||null}},q1=class extends Error{constructor(r){super(),this.urlTree=r}};function cm(i){return Tp(new J_(i))}function wse(i){return Tp(new mt(4e3,!1))}function Tse(i){return Tp(w5(!1,el.GuardRejected))}var dA=class{constructor(r,a){this.urlSerializer=r,this.urlTree=a}lineralizeSegments(r,a){let c=[],h=a.root;for(;;){if(c=c.concat(h.segments),h.numberOfChildren===0)return Nt(c);if(h.numberOfChildren>1||!h.children[fi])return wse(r.redirectTo);h=h.children[fi]}}applyRedirectCommands(r,a,c){let h=this.applyRedirectCreateUrlTree(a,this.urlSerializer.parse(a),r,c);if(a.startsWith("/"))throw new q1(h);return h}applyRedirectCreateUrlTree(r,a,c,h){let m=this.createSegmentGroup(r,a.root,c,h);return new Sd(m,this.createQueryParams(a.queryParams,this.urlTree.queryParams),a.fragment)}createQueryParams(r,a){let c={};return Object.entries(r).forEach(([h,m])=>{if(typeof m=="string"&&m.startsWith(":")){let w=m.substring(1);c[h]=a[w]}else c[h]=m}),c}createSegmentGroup(r,a,c,h){let m=this.createSegments(r,a.segments,c,h),y={};return Object.entries(a.children).forEach(([w,C])=>{y[w]=this.createSegmentGroup(r,C,c,h)}),new mr(m,y)}createSegments(r,a,c,h){return a.map(m=>m.path.startsWith(":")?this.findPosParam(r,m,h):this.findOrReturn(m,c))}findPosParam(r,a,c){let h=c[a.path.substring(1)];if(!h)throw new mt(4001,!1);return h}findOrReturn(r,a){let c=0;for(let h of a){if(h.path===r.path)return a.splice(c),h;c++}return r}},hA={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Ese(i,r,a,c,h){let m=wA(i,r,a);return m.matched?(c=Qoe(r,c),bse(c,r,a,h).pipe(st(y=>y===!0?m:Lt({},hA)))):Nt(m)}function wA(i,r,a){if(r.path==="**")return Mse(a);if(r.path==="")return r.pathMatch==="full"&&(i.hasChildren()||a.length>0)?Lt({},hA):{matched:!0,consumedSegments:[],remainingSegments:a,parameters:{},positionalParamSegments:{}};let h=(r.matcher||boe)(a,i,r);if(!h)return Lt({},hA);let m={};Object.entries(h.posParams??{}).forEach(([w,C])=>{m[w]=C.path});let y=h.consumed.length>0?Lt(Lt({},m),h.consumed[h.consumed.length-1].parameters):m;return{matched:!0,consumedSegments:h.consumed,remainingSegments:a.slice(h.consumed.length),parameters:y,positionalParamSegments:h.posParams??{}}}function Mse(i){return{matched:!0,parameters:i.length>0?r5(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function n5(i,r,a,c){return a.length>0&&Sse(i,a,c)?{segmentGroup:new mr(r,Cse(c,new mr(a,i.children))),slicedSegments:[]}:a.length===0&&Dse(i,a,c)?{segmentGroup:new mr(i.segments,Ise(i,a,c,i.children)),slicedSegments:a}:{segmentGroup:new mr(i.segments,i.children),slicedSegments:a}}function Ise(i,r,a,c){let h={};for(let m of a)if(Y1(i,r,m)&&!c[xc(m)]){let y=new mr([],{});h[xc(m)]=y}return Lt(Lt({},c),h)}function Cse(i,r){let a={};a[fi]=r;for(let c of i)if(c.path===""&&xc(c)!==fi){let h=new mr([],{});a[xc(c)]=h}return a}function Sse(i,r,a){return a.some(c=>Y1(i,r,c)&&xc(c)!==fi)}function Dse(i,r,a){return a.some(c=>Y1(i,r,c))}function Y1(i,r,a){return(i.hasChildren()||r.length>0)&&a.pathMatch==="full"?!1:a.path===""}function Ase(i,r,a,c){return xc(i)!==c&&(c===fi||!Y1(r,a,i))?!1:wA(r,i,a).matched}function Pse(i,r,a){return r.length===0&&!i.children[a]}var fA=class{};function Ose(i,r,a,c,h,m,y="emptyOnly"){return new pA(i,r,a,c,h,y,m).recognize()}var Rse=31,pA=class{constructor(r,a,c,h,m,y,w){this.injector=r,this.configLoader=a,this.rootComponentType=c,this.config=h,this.urlTree=m,this.paramsInheritanceStrategy=y,this.urlSerializer=w,this.applyRedirects=new dA(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(r){return new mt(4002,`'${r.segmentGroup}'`)}recognize(){let r=n5(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(r).pipe(st(a=>{let c=new X_([],Object.freeze({}),Object.freeze(Lt({},this.urlTree.queryParams)),this.urlTree.fragment,{},fi,this.rootComponentType,null,{}),h=new Aa(c,a),m=new G1("",h),y=joe(c,[],this.urlTree.queryParams,this.urlTree.fragment);return y.queryParams=this.urlTree.queryParams,m.url=this.urlSerializer.serialize(y),this.inheritParamsAndData(m._root,null),{state:m,tree:y}}))}match(r){return this.processSegmentGroup(this.injector,this.config,r,fi).pipe(wl(c=>{if(c instanceof q1)return this.urlTree=c.urlTree,this.match(c.urlTree.root);throw c instanceof J_?this.noMatchError(c):c}))}inheritParamsAndData(r,a){let c=r.value,h=_A(c,a,this.paramsInheritanceStrategy);c.params=Object.freeze(h.params),c.data=Object.freeze(h.data),r.children.forEach(m=>this.inheritParamsAndData(m,c))}processSegmentGroup(r,a,c,h){return c.segments.length===0&&c.hasChildren()?this.processChildren(r,a,c):this.processSegment(r,a,c,c.segments,h,!0).pipe(st(m=>m instanceof Aa?[m]:[]))}processChildren(r,a,c){let h=[];for(let m of Object.keys(c.children))m==="primary"?h.unshift(m):h.push(m);return vr(h).pipe(od(m=>{let y=c.children[m],w=ese(a,m);return this.processSegmentGroup(r,w,y,m)}),F0((m,y)=>(m.push(...y),m)),sd(null),PM(),Oo(m=>{if(m===null)return cm(c);let y=I5(m);return Lse(y),Nt(y)}))}processSegment(r,a,c,h,m,y){return vr(a).pipe(od(w=>this.processSegmentAgainstRoute(w._injector??r,a,w,c,h,m,y).pipe(wl(C=>{if(C instanceof J_)return Nt(null);throw C}))),Tl(w=>!!w),wl(w=>{if(E5(w))return Pse(c,h,m)?Nt(new fA):cm(c);throw w}))}processSegmentAgainstRoute(r,a,c,h,m,y,w){return Ase(c,h,m,y)?c.redirectTo===void 0?this.matchSegmentAgainstRoute(r,h,c,m,y):this.allowRedirects&&w?this.expandSegmentAgainstRouteUsingRedirect(r,h,a,c,m,y):cm(h):cm(h)}expandSegmentAgainstRouteUsingRedirect(r,a,c,h,m,y){let{matched:w,consumedSegments:C,positionalParamSegments:D,remainingSegments:z}=wA(a,h,m);if(!w)return cm(a);h.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Rse&&(this.allowRedirects=!1));let j=this.applyRedirects.applyRedirectCommands(C,h.redirectTo,D);return this.applyRedirects.lineralizeSegments(h,j).pipe(Oo(ie=>this.processSegment(r,c,a,ie.concat(z),y,!1)))}matchSegmentAgainstRoute(r,a,c,h,m){let y=Ese(a,c,h,r,this.urlSerializer);return c.path==="**"&&(a.children={}),y.pipe(Fi(w=>w.matched?(r=c._injector??r,this.getChildConfig(r,c,h).pipe(Fi(({routes:C})=>{let D=c._loadedInjector??r,{consumedSegments:z,remainingSegments:j,parameters:ie}=w,oe=new X_(z,ie,Object.freeze(Lt({},this.urlTree.queryParams)),this.urlTree.fragment,kse(c),xc(c),c.component??c._loadedComponent??null,c,Nse(c)),{segmentGroup:he,slicedSegments:ke}=n5(a,z,j,C);if(ke.length===0&&he.hasChildren())return this.processChildren(D,C,he).pipe(st(Ve=>Ve===null?null:new Aa(oe,Ve)));if(C.length===0&&ke.length===0)return Nt(new Aa(oe,[]));let rt=xc(c)===m;return this.processSegment(D,C,he,ke,rt?fi:m,!0).pipe(st(Ve=>new Aa(oe,Ve instanceof Aa?[Ve]:[])))}))):cm(a)))}getChildConfig(r,a,c){return a.children?Nt({routes:a.children,injector:r}):a.loadChildren?a._loadedRoutes!==void 0?Nt({routes:a._loadedRoutes,injector:a._loadedInjector}):xse(r,a,c,this.urlSerializer).pipe(Oo(h=>h?this.configLoader.loadChildren(r,a).pipe(Vr(m=>{a._loadedRoutes=m.routes,a._loadedInjector=m.injector})):Tse(a))):Nt({routes:[],injector:r})}};function Lse(i){i.sort((r,a)=>r.value.outlet===fi?-1:a.value.outlet===fi?1:r.value.outlet.localeCompare(a.value.outlet))}function Fse(i){let r=i.value.routeConfig;return r&&r.path===""}function I5(i){let r=[],a=new Set;for(let c of i){if(!Fse(c)){r.push(c);continue}let h=r.find(m=>c.value.routeConfig===m.value.routeConfig);h!==void 0?(h.children.push(...c.children),a.add(h)):r.push(c)}for(let c of a){let h=I5(c.children);r.push(new Aa(c.value,h))}return r.filter(c=>!a.has(c))}function kse(i){return i.data||{}}function Nse(i){return i.resolve||{}}function zse(i,r,a,c,h,m){return Oo(y=>Ose(i,r,a,c,y.extractedUrl,h,m).pipe(st(({state:w,tree:C})=>Er(Lt({},y),{targetSnapshot:w,urlAfterRedirects:C}))))}function Bse(i,r){return Oo(a=>{let{targetSnapshot:c,guards:{canActivateChecks:h}}=a;if(!h.length)return Nt(a);let m=new Set(h.map(C=>C.route)),y=new Set;for(let C of m)if(!y.has(C))for(let D of C5(C))y.add(D);let w=0;return vr(y).pipe(od(C=>m.has(C)?jse(C,c,i,r):(C.data=_A(C,C.parent,i).resolve,Nt(void 0))),Vr(()=>w++),Mp(1),Oo(C=>w===y.size?Nt(a):Lr))})}function C5(i){let r=i.children.map(a=>C5(a)).flat();return[i,...r]}function jse(i,r,a,c){let h=i.routeConfig,m=i._resolve;return h?.title!==void 0&&!v5(h)&&(m[Q_]=h.title),Vse(m,i,r,c).pipe(st(y=>(i._resolvedData=y,i.data=_A(i,i.parent,a).resolve,null)))}function Vse(i,r,a,c){let h=HD(i);if(h.length===0)return Nt({});let m={};return vr(h).pipe(Oo(y=>Use(i[y],r,a,c).pipe(Tl(),Vr(w=>{m[y]=w}))),Mp(1),AM(m),wl(y=>E5(y)?Lr:Tp(y)))}function Use(i,r,a,c){let h=ey(r)??c,m=gm(i,h),y=m.resolve?m.resolve(r,a):uu(h,()=>m(r,a));return Pd(y)}function UD(i){return Fi(r=>{let a=i(r);return a?vr(a).pipe(st(()=>r)):Nt(r)})}var S5=(()=>{let r=class r{buildTitle(c){let h,m=c.root;for(;m!==void 0;)h=this.getResolvedTitleForRoute(m)??h,m=m.children.find(y=>y.outlet===fi);return h}getResolvedTitleForRoute(c){return c.data[Q_]}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:()=>Ee($se),providedIn:"root"});let i=r;return i})(),$se=(()=>{let r=class r extends S5{constructor(c){super(),this.title=c}updateTitle(c){let h=this.buildTitle(c);h!==void 0&&this.title.setTitle(h)}};r.\u0275fac=function(h){return new(h||r)(Ct(vb))},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})(),TA=new ot("",{providedIn:"root",factory:()=>({})}),EA=new ot(""),Hse=(()=>{let r=class r{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Ee(eS)}loadComponent(c){if(this.componentLoaders.get(c))return this.componentLoaders.get(c);if(c._loadedComponent)return Nt(c._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(c);let h=Pd(c.loadComponent()).pipe(st(D5),Vr(y=>{this.onLoadEndListener&&this.onLoadEndListener(c),c._loadedComponent=y}),Qc(()=>{this.componentLoaders.delete(c)})),m=new vp(h,()=>new Qr).pipe(yp());return this.componentLoaders.set(c,m),m}loadChildren(c,h){if(this.childrenLoaders.get(h))return this.childrenLoaders.get(h);if(h._loadedRoutes)return Nt({routes:h._loadedRoutes,injector:h._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(h);let y=Gse(h,this.compiler,c,this.onLoadEndListener).pipe(Qc(()=>{this.childrenLoaders.delete(h)})),w=new vp(y,()=>new Qr).pipe(yp());return this.childrenLoaders.set(h,w),w}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function Gse(i,r,a,c){return Pd(i.loadChildren()).pipe(st(D5),Oo(h=>h instanceof qg||Array.isArray(h)?Nt(h):vr(r.compileModuleAsync(h))),st(h=>{c&&c(i);let m,y,w=!1;return Array.isArray(h)?(y=h,w=!0):(m=h.create(a).injector,y=m.get(EA,[],{optional:!0,self:!0}).flat()),{routes:y.map(bA),injector:m}}))}function Wse(i){return i&&typeof i=="object"&&"default"in i}function D5(i){return Wse(i)?i.default:i}var MA=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:()=>Ee(qse),providedIn:"root"});let i=r;return i})(),qse=(()=>{let r=class r{shouldProcessUrl(c){return!0}extract(c){return c}merge(c,h){return c}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})(),Zse=new ot("");var Yse=(()=>{let r=class r{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Qr,this.transitionAbortSubject=new Qr,this.configLoader=Ee(Hse),this.environmentInjector=Ee(ta),this.urlSerializer=Ee(gA),this.rootContexts=Ee(Z1),this.location=Ee(s_),this.inputBindingEnabled=Ee(xA,{optional:!0})!==null,this.titleStrategy=Ee(S5),this.options=Ee(TA,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Ee(MA),this.createViewTransition=Ee(Zse,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Nt(void 0),this.rootComponentType=null;let c=m=>this.events.next(new QD(m)),h=m=>this.events.next(new eA(m));this.configLoader.onLoadEndListener=h,this.configLoader.onLoadStartListener=c}complete(){this.transitions?.complete()}handleNavigationRequest(c){let h=++this.navigationId;this.transitions?.next(Er(Lt(Lt({},this.transitions.value),c),{id:h}))}setupNavigations(c,h,m){return this.transitions=new pr({id:0,currentUrlTree:h,currentRawUrl:h,extractedUrl:this.urlHandlingStrategy.extract(h),urlAfterRedirects:this.urlHandlingStrategy.extract(h),rawUrl:h,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:$_,restoredState:null,currentSnapshot:m.snapshot,targetSnapshot:null,currentRouterState:m,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(zi(y=>y.id!==0),st(y=>Er(Lt({},y),{extractedUrl:this.urlHandlingStrategy.extract(y.rawUrl)})),Fi(y=>{this.currentTransition=y;let w=!1,C=!1;return Nt(y).pipe(Vr(D=>{this.currentNavigation={id:D.id,initialUrl:D.rawUrl,extractedUrl:D.extractedUrl,trigger:D.source,extras:D.extras,previousNavigation:this.lastSuccessfulNavigation?Er(Lt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Fi(D=>{let z=!c.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),j=D.extras.onSameUrlNavigation??c.onSameUrlNavigation;if(!z&&j!=="reload"){let ie="";return this.events.next(new gf(D.id,this.urlSerializer.serialize(D.rawUrl),ie,ZD.IgnoredSameUrlNavigation)),D.resolve(null),Lr}if(this.urlHandlingStrategy.shouldProcessUrl(D.rawUrl))return Nt(D).pipe(Fi(ie=>{let oe=this.transitions?.getValue();return this.events.next(new W_(ie.id,this.urlSerializer.serialize(ie.extractedUrl),ie.source,ie.restoredState)),oe!==this.transitions?.getValue()?Lr:Promise.resolve(ie)}),zse(this.environmentInjector,this.configLoader,this.rootComponentType,c.config,this.urlSerializer,this.paramsInheritanceStrategy),Vr(ie=>{y.targetSnapshot=ie.targetSnapshot,y.urlAfterRedirects=ie.urlAfterRedirects,this.currentNavigation=Er(Lt({},this.currentNavigation),{finalUrl:ie.urlAfterRedirects});let oe=new U1(ie.id,this.urlSerializer.serialize(ie.extractedUrl),this.urlSerializer.serialize(ie.urlAfterRedirects),ie.targetSnapshot);this.events.next(oe)}));if(z&&this.urlHandlingStrategy.shouldProcessUrl(D.currentRawUrl)){let{id:ie,extractedUrl:oe,source:he,restoredState:ke,extras:rt}=D,Ve=new W_(ie,this.urlSerializer.serialize(oe),he,ke);this.events.next(Ve);let Ot=_5(this.rootComponentType).snapshot;return this.currentTransition=y=Er(Lt({},D),{targetSnapshot:Ot,urlAfterRedirects:oe,extras:Er(Lt({},rt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=oe,Nt(y)}else{let ie="";return this.events.next(new gf(D.id,this.urlSerializer.serialize(D.extractedUrl),ie,ZD.IgnoredByUrlHandlingStrategy)),D.resolve(null),Lr}}),Vr(D=>{let z=new YD(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(z)}),st(D=>(this.currentTransition=y=Er(Lt({},D),{guards:nse(D.targetSnapshot,D.currentSnapshot,this.rootContexts)}),y)),hse(this.environmentInjector,D=>this.events.next(D)),Vr(D=>{if(y.guardsResult=D.guardsResult,pm(D.guardsResult))throw b5(this.urlSerializer,D.guardsResult);let z=new XD(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot,!!D.guardsResult);this.events.next(z)}),zi(D=>D.guardsResult?!0:(this.cancelNavigationTransition(D,"",el.GuardRejected),!1)),UD(D=>{if(D.guards.canActivateChecks.length)return Nt(D).pipe(Vr(z=>{let j=new KD(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects),z.targetSnapshot);this.events.next(j)}),Fi(z=>{let j=!1;return Nt(z).pipe(Bse(this.paramsInheritanceStrategy,this.environmentInjector),Vr({next:()=>j=!0,complete:()=>{j||this.cancelNavigationTransition(z,"",el.NoDataFromResolver)}}))}),Vr(z=>{let j=new JD(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects),z.targetSnapshot);this.events.next(j)}))}),UD(D=>{let z=j=>{let ie=[];j.routeConfig?.loadComponent&&!j.routeConfig._loadedComponent&&ie.push(this.configLoader.loadComponent(j.routeConfig).pipe(Vr(oe=>{j.component=oe}),st(()=>{})));for(let oe of j.children)ie.push(...z(oe));return ie};return lc(z(D.targetSnapshot.root)).pipe(sd(null),Bo(1))}),UD(()=>this.afterPreactivation()),Fi(()=>{let{currentSnapshot:D,targetSnapshot:z}=y,j=this.createViewTransition?.(this.environmentInjector,D.root,z.root);return j?vr(j).pipe(st(()=>y)):Nt(y)}),st(D=>{let z=Zoe(c.routeReuseStrategy,D.targetSnapshot,D.currentRouterState);return this.currentTransition=y=Er(Lt({},D),{targetRouterState:z}),this.currentNavigation.targetRouterState=z,y}),Vr(()=>{this.events.next(new Z_)}),tse(this.rootContexts,c.routeReuseStrategy,D=>this.events.next(D),this.inputBindingEnabled),Bo(1),Vr({next:D=>{w=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Dd(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects))),this.titleStrategy?.updateTitle(D.targetRouterState.snapshot),D.resolve(!0)},complete:()=>{w=!0}}),Ii(this.transitionAbortSubject.pipe(Vr(D=>{throw D}))),Qc(()=>{!w&&!C&&this.cancelNavigationTransition(y,"",el.SupersededByNewNavigation),this.currentNavigation?.id===y.id&&(this.currentNavigation=null)}),wl(D=>{if(C=!0,T5(D))this.events.next(new Ad(y.id,this.urlSerializer.serialize(y.extractedUrl),D.message,D.cancellationCode)),Koe(D)?this.events.next(new Y_(D.url)):y.resolve(!1);else{this.events.next(new q_(y.id,this.urlSerializer.serialize(y.extractedUrl),D,y.targetSnapshot??void 0));try{y.resolve(c.errorHandler(D))}catch(z){this.options.resolveNavigationPromiseOnError?y.resolve(!1):y.reject(z)}}return Lr}))}))}cancelNavigationTransition(c,h,m){let y=new Ad(c.id,this.urlSerializer.serialize(c.extractedUrl),h,m);this.events.next(y),c.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function Xse(i){return i!==$_}var Kse=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:()=>Ee(Jse),providedIn:"root"});let i=r;return i})(),mA=class{shouldDetach(r){return!1}store(r,a){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,a){return r.routeConfig===a.routeConfig}},Jse=(()=>{let r=class r extends mA{};r.\u0275fac=(()=>{let c;return function(m){return(c||(c=_o(r)))(m||r)}})(),r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})(),A5=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:()=>Ee(Qse),providedIn:"root"});let i=r;return i})(),Qse=(()=>{let r=class r extends A5{constructor(){super(...arguments),this.location=Ee(s_),this.urlSerializer=Ee(gA),this.options=Ee(TA,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Ee(MA),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Sd,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=_5(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(c){return this.location.subscribe(h=>{h.type==="popstate"&&c(h.url,h.state)})}handleRouterEvent(c,h){if(c instanceof W_)this.stateMemento=this.createStateMemento();else if(c instanceof gf)this.rawUrlTree=h.initialUrl;else if(c instanceof U1){if(this.urlUpdateStrategy==="eager"&&!h.extras.skipLocationChange){let m=this.urlHandlingStrategy.merge(h.finalUrl,h.initialUrl);this.setBrowserUrl(m,h)}}else c instanceof Z_?(this.currentUrlTree=h.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(h.finalUrl,h.initialUrl),this.routerState=h.targetRouterState,this.urlUpdateStrategy==="deferred"&&(h.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,h))):c instanceof Ad&&(c.code===el.GuardRejected||c.code===el.NoDataFromResolver)?this.restoreHistory(h):c instanceof q_?this.restoreHistory(h,!0):c instanceof Dd&&(this.lastSuccessfulId=c.id,this.currentPageId=this.browserPageId)}setBrowserUrl(c,h){let m=this.urlSerializer.serialize(c);if(this.location.isCurrentPathEqualTo(m)||h.extras.replaceUrl){let y=this.browserPageId,w=Lt(Lt({},h.extras.state),this.generateNgRouterState(h.id,y));this.location.replaceState(m,"",w)}else{let y=Lt(Lt({},h.extras.state),this.generateNgRouterState(h.id,this.browserPageId+1));this.location.go(m,"",y)}}restoreHistory(c,h=!1){if(this.canceledNavigationResolution==="computed"){let m=this.browserPageId,y=this.currentPageId-m;y!==0?this.location.historyGo(y):this.currentUrlTree===c.finalUrl&&y===0&&(this.resetState(c),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(h&&this.resetState(c),this.resetUrlToCurrentUrlTree())}resetState(c){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,c.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(c,h){return this.canceledNavigationResolution==="computed"?{navigationId:c,\u0275routerPageId:h}:{navigationId:c}}};r.\u0275fac=(()=>{let c;return function(m){return(c||(c=_o(r)))(m||r)}})(),r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})(),V_=function(i){return i[i.COMPLETE=0]="COMPLETE",i[i.FAILED=1]="FAILED",i[i.REDIRECTING=2]="REDIRECTING",i}(V_||{});function eae(i,r){i.events.pipe(zi(a=>a instanceof Dd||a instanceof Ad||a instanceof q_||a instanceof gf),st(a=>a instanceof Dd||a instanceof gf?V_.COMPLETE:(a instanceof Ad?a.code===el.Redirect||a.code===el.SupersededByNewNavigation:!1)?V_.REDIRECTING:V_.FAILED),zi(a=>a!==V_.REDIRECTING),Bo(1)).subscribe(()=>{r()})}function tae(i){throw i}var nae={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},iae={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},IA=(()=>{let r=class r{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Ee(Jx),this.stateManager=Ee(A5),this.options=Ee(TA,{optional:!0})||{},this.pendingTasks=Ee(jh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Ee(Yse),this.urlSerializer=Ee(gA),this.location=Ee(s_),this.urlHandlingStrategy=Ee(MA),this._events=new Qr,this.errorHandler=this.options.errorHandler||tae,this.navigated=!1,this.routeReuseStrategy=Ee(Kse),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Ee(EA,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Ee(xA,{optional:!0}),this.eventsSubscription=new Po,this.isNgZoneEnabled=Ee(oi)instanceof oi&&oi.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:c=>{this.console.warn(c)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let c=this.navigationTransitions.events.subscribe(h=>{try{let m=this.navigationTransitions.currentTransition,y=this.navigationTransitions.currentNavigation;if(m!==null&&y!==null){if(this.stateManager.handleRouterEvent(h,y),h instanceof Ad&&h.code!==el.Redirect&&h.code!==el.SupersededByNewNavigation)this.navigated=!0;else if(h instanceof Dd)this.navigated=!0;else if(h instanceof Y_){let w=this.urlHandlingStrategy.merge(h.url,m.currentRawUrl),C={info:m.extras.info,skipLocationChange:m.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||Xse(m.source)};this.scheduleNavigation(w,$_,null,C,{resolve:m.resolve,reject:m.reject,promise:m.promise})}}oae(h)&&this._events.next(h)}catch(m){this.navigationTransitions.transitionAbortSubject.next(m)}});this.eventsSubscription.add(c)}resetRootComponentType(c){this.routerState.root.component=c,this.navigationTransitions.rootComponentType=c}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),$_,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((c,h)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(c,"popstate",h)},0)})}navigateToSyncWithBrowser(c,h,m){let y={replaceUrl:!0},w=m?.navigationId?m:null;if(m){let D=Lt({},m);delete D.navigationId,delete D.\u0275routerPageId,Object.keys(D).length!==0&&(y.state=D)}let C=this.parseUrl(c);this.scheduleNavigation(C,h,w,y)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(c){this.config=c.map(bA),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(c,h={}){let{relativeTo:m,queryParams:y,fragment:w,queryParamsHandling:C,preserveFragment:D}=h,z=D?this.currentUrlTree.fragment:w,j=null;switch(C){case"merge":j=Lt(Lt({},this.currentUrlTree.queryParams),y);break;case"preserve":j=this.currentUrlTree.queryParams;break;default:j=y||null}j!==null&&(j=this.removeEmptyProps(j));let ie;try{let oe=m?m.snapshot:this.routerState.snapshot.root;ie=f5(oe)}catch{(typeof c[0]!="string"||!c[0].startsWith("/"))&&(c=[]),ie=this.currentUrlTree.root}return p5(ie,c,j,z??null)}navigateByUrl(c,h={skipLocationChange:!1}){let m=pm(c)?c:this.parseUrl(c),y=this.urlHandlingStrategy.merge(m,this.rawUrlTree);return this.scheduleNavigation(y,$_,null,h)}navigate(c,h={skipLocationChange:!1}){return rae(c),this.navigateByUrl(this.createUrlTree(c,h),h)}serializeUrl(c){return this.urlSerializer.serialize(c)}parseUrl(c){try{return this.urlSerializer.parse(c)}catch{return this.urlSerializer.parse("/")}}isActive(c,h){let m;if(h===!0?m=Lt({},nae):h===!1?m=Lt({},iae):m=h,pm(c))return J4(this.currentUrlTree,c,m);let y=this.parseUrl(c);return J4(this.currentUrlTree,y,m)}removeEmptyProps(c){return Object.entries(c).reduce((h,[m,y])=>(y!=null&&(h[m]=y),h),{})}scheduleNavigation(c,h,m,y,w){if(this.disposed)return Promise.resolve(!1);let C,D,z;w?(C=w.resolve,D=w.reject,z=w.promise):z=new Promise((ie,oe)=>{C=ie,D=oe});let j=this.pendingTasks.add();return eae(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(j))}),this.navigationTransitions.handleNavigationRequest({source:h,restoredState:m,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:c,extras:y,resolve:C,reject:D,promise:z,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),z.catch(ie=>Promise.reject(ie))}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function rae(i){for(let r=0;r<i.length;r++)if(i[r]==null)throw new mt(4008,!1)}function oae(i){return!(i instanceof Z_)&&!(i instanceof Y_)}var P5=(()=>{let r=class r{constructor(c,h,m,y,w,C){this.router=c,this.route=h,this.tabIndexAttribute=m,this.renderer=y,this.el=w,this.locationStrategy=C,this.href=null,this.commands=null,this.onChanges=new Qr,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let D=w.nativeElement.tagName?.toLowerCase();this.isAnchorElement=D==="a"||D==="area",this.isAnchorElement?this.subscription=c.events.subscribe(z=>{z instanceof Dd&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(c){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",c)}ngOnChanges(c){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(c){c!=null?(this.commands=Array.isArray(c)?c:[c],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(c,h,m,y,w){let C=this.urlTree;if(C===null||this.isAnchorElement&&(c!==0||h||m||y||w||typeof this.target=="string"&&this.target!="_self"))return!0;let D={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(C,D),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let c=this.urlTree;this.href=c!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(c)):null;let h=this.href===null?null:uB(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",h)}applyAttributeValue(c,h){let m=this.renderer,y=this.el.nativeElement;h!==null?m.setAttribute(y,c,h):m.removeAttribute(y,c)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};r.\u0275fac=function(h){return new(h||r)(me(IA),me(_f),_C("tabindex"),me(Za),me(mn),me(Gp))},r.\u0275dir=pn({type:r,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(h,m){h&1&&Kt("click",function(w){return m.onClick(w.button,w.ctrlKey,w.shiftKey,w.altKey,w.metaKey)}),h&2&&Mr("target",m.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Bi.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Gh],skipLocationChange:[Bi.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Gh],replaceUrl:[Bi.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Gh],routerLink:"routerLink"},standalone:!0,features:[ZC,na]});let i=r;return i})();var sae=new ot("");function O5(i,...r){return hd([{provide:EA,multi:!0,useValue:i},[],{provide:_f,useFactory:aae,deps:[IA]},{provide:$p,multi:!0,useFactory:lae},r.map(a=>a.\u0275providers)])}function aae(i){return i.routerState.root}function lae(){let i=Ee(ys);return r=>{let a=i.get(gd);if(r!==a.components[0])return;let c=i.get(IA),h=i.get(cae);i.get(uae)===1&&c.initialNavigation(),i.get(dae,null,vi.Optional)?.setUpPreloading(),i.get(sae,null,vi.Optional)?.init(),c.resetRootComponentType(a.componentTypes[0]),h.closed||(h.next(),h.complete(),h.unsubscribe())}}var cae=new ot("",{factory:()=>new Qr}),uae=new ot("",{providedIn:"root",factory:()=>1});var dae=new ot("");var R5=(()=>{class i extends un{constructor(a,c,h){super(m=>this.stream$.subscribe(m)),this.media=a,this.ngZone=c,this.size$=h,this.sorted=Object.values(this.media).sort((m,y)=>m-y),this.invert=Object.keys(this.media).reduce((m,y)=>Object.assign(Object.assign({},m),{[this.media[y]]:y}),{}),this.stream$=this.size$.pipe(st(({width:m})=>this.sorted.find(y=>y>m)),st(m=>this.invert[m||this.sorted[this.sorted.length-1]]),Ro(),Ll(this.ngZone),va({bufferSize:1,refCount:!0}))}}return i.\u0275fac=function(a){return new(a||i)(Ct(ND),Ct(oi),Ct(vD))},i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var L5=(()=>{class i extends pr{constructor(){super([])}add(a){this.next(this.value.concat(a))}remove(a){this.value.includes(a)&&this.next(this.value.filter(c=>c!==a))}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var X1=(()=>{class i{constructor(a,c,h){this.tuiSanitizer=a,this.sanitizer=c,this.originals={},this.items$=new pr(new Map),this.define(h)}define(a){let{value:c}=this.items$;Object.keys(a).forEach(h=>{this.defineIcon(h,a[h],c)}),this.items$.next(c)}getOriginal(a){return this.originals[a]||null}defineIcon(a,c,h){if(h.has(a))return;let m=this.parseSrc(a,c);m&&(h.set(a,m),this.originals=Object.assign(Object.assign({},this.originals),{[a]:c}))}parseSrc(a,c){return this.sanitize(L4(c,a))}sanitize(a){return this.sanitizer.bypassSecurityTrustHtml((this.tuiSanitizer?this.tuiSanitizer.sanitize(Xo.HTML,a):this.sanitizer.sanitize(Xo.HTML,a))||"")}}return i.\u0275fac=function(a){return new(a||i)(Ct(lm,8),Ct(m_),Ct(W4))},i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function hae(i,r){if(i&1&&wn(0,"div",3),i&2){let a=yt().tuiLet;Xe("innerHTML",a,fu)}}function fae(i,r){if(i&1){let a=Zr();Sl(),He(0,"svg",4),Kt("error",function(){ji(a);let h=yt(2);return Vi(h.onError())}),wn(1,"use"),We()}if(i&2){let a=yt(2);qe(),Mr("href",a.use,null,"xlink")}}function pae(i,r){if(i&1&&(Ur(0),It(1,hae,1,1,"div",1)(2,fae,2,1,"ng-template",null,2,md),$r()),i&2){let a=pd(3),c=yt();qe(),Xe("ngIf",c.isInnerHTML)("ngIfElse",a)}}var mae={tuiIconAttach:"tuiIconPaperclip",tuiIconAttention:"tuiIconAlertCircle",tuiIconBackCircle:"tuiIconArrowLeftCircle",tuiIconCall:"tuiIconPhone",tuiIconCallIn:"tuiIconPhoneIncoming",tuiIconCallOut:"tuiIconPhoneOutgoing",tuiIconCallTransfer:"tuiIconPhoneForwarded",tuiIconCancel:"tuiIconXCircle",tuiIconCancelCircle:"tuiIconSlash",tuiIconCard:"tuiIconCreditCard",tuiIconCards:"tuiIconCreditCard",tuiIconChartBar:"tuiIconBarChart",tuiIconChart:"tuiIconBarChart",tuiIconCheckList:"tuiIconClipboard",tuiIconCloseCircle:"tuiIconXCircle",tuiIconCollapse:"tuiIconMinimize",tuiIconComment:"tuiIconMessageSquare",tuiIconCommentFw:"tuiIconMessageForward",tuiIconCompany:"tuiIconBriefcase",tuiIconDefaultDoc:"tuiIconFile",tuiIconDesktop:"tuiIconMonitor",tuiIconDesktopOff:"tuiIconMonitorOff",tuiIconDislike:"tuiIconThumbsDown",tuiIconDone:"tuiIconCheckCircle",tuiIconDraft:"tuiIconEdit2",tuiIconEyeOpen:"tuiIconEye",tuiIconEyeClosed:"tuiIconEyeOff",tuiIconExpand:"tuiIconMaximize",tuiIconExternal:"tuiIconExternalLink",tuiIconFrame:"tuiIconLayout",tuiIconGeo:"tuiIconMapPin",tuiIconHeartFilled:"tuiIconHeart",tuiIconHide:"tuiIconEyeOff",tuiIconImg:"tuiIconImage",tuiIconInfoCircle:"tuiIconInfo",tuiIconLike:"tuiIconThumbsUp",tuiIconLockOpen:"tuiIconUnlock",tuiIconMobile:"tuiIconSmartphone",tuiIconMoreHor:"tuiIconMoreHorizontal",tuiIconMoreVer:"tuiIconMoreVertical",tuiIconMoreVert:"tuiIconMoreVertical",tuiIconPicture:"tuiIconImage",tuiIconPin:"tuiIconMapPin",tuiIconPrint:"tuiIconPrinter",tuiIconRefresh:"tuiIconRefreshCw",tuiIconRemove:"tuiIconX",tuiIconShow:"tuiIconEye",tuiIconSound:"tuiIconVolume",tuiIconSoundOff:"tuiIconVolumeX",tuiIconStarFilled:"tuiIconStar",tuiIconStop:"tuiIconSquare",tuiIconStructure:"tuiIconGrid",tuiIconTime:"tuiIconClock",tuiIconTooltip:"tuiIconHelpCircle",tuiIconViewList:"tuiIconList",tuiIconWifiOn:"tuiIconWifi"},gae={iconsPlace:O1,path:D1(O1),srcProcessor:mo,contentProcessor:i1,deprecated:i=>{let r=i.replace("Large","").replace("Outline",""),a=mae[r];return a?`${r}/(Large|Outline) is deprecated, use ${a}/(Large|Outline) instead`:""}},_ae=ii(()=>({iconsPlace:Ee(kD),path:Ee(q4),deprecated:gae.deprecated,srcProcessor:Ee(X4),contentProcessor:Ee(Y4)})),yae=new ot("[TUI_SVG_SRC_INTERCEPTORS]");var vae="Attempted to use undefined named icon",xae="External icon is missing on the given URL",bae="Failed to load external SVG",_m=(()=>{class i{constructor(a,c,h,m,y,w,C,D,z,j){this.doc=a,this.win=c,this.options=h,this.srcInterceptors=m,this.tuiSanitizer=y,this.svgService=w,this.staticRequestService=C,this.sanitizer=D,this.el=z,this.baseHref=j,this.src$=new Kc(1),this.icon="",this.innerHTML$=this.src$.pipe(Fi(()=>bu(this.icon)?this.isExternal?this.getExternalIcon(this.icon):Nt(this.getSafeHtml(this.icon)):Nt(this.icon)),xr(""))}set src(a){var c;let h=this.options.deprecated(String(a));this.icon=((c=this.srcInterceptors)!==null&&c!==void 0?c:[]).reduce((m,y)=>y(m,this.options),this.options.srcProcessor(a||"")),this.src$.next()}get src(){return this.icon}get use(){return bu(this.icon)?this.icon.includes(".svg#")?this.icon:this.resolveName(this.icon,this.options.path):""}get isInnerHTML(){return!bu(this.icon)||this.isSrc||this.isExternal||this.isName&&this.isShadowDOM}get isShadowDOM(){return S_(this.el.nativeElement)!==this.doc}get isUse(){return this.use.replace(F_,"").includes(".svg#")}get isExternal(){return this.isUrl||this.isCrossDomain}get isUrl(){return bu(this.icon)&&this.icon.replace(F_,"").endsWith(".svg")}get isSrc(){return bu(this.icon)&&B4(this.icon)}get isName(){return!this.isUrl&&!this.isUse&&!this.isSrc}get isCrossDomain(){let{use:a,isUse:c,win:h}=this;return c&&a.startsWith("http")&&!!h.origin&&!a.startsWith(h.origin)}onError(a=xae){let{icon:c}=this,h=new CustomEvent(N4,{bubbles:!0,detail:{message:a,icon:c}});this.el.nativeElement.dispatchEvent(h)}resolveName(a,c){return c(a,this.baseHref)}getSafeHtml(a){return this.isSrc?this.sanitize(a):this.process(a)}process(a){let c=this.svgService.getOriginal(a);return this.isName&&!c&&a&&this.onError(vae),!this.isShadowDOM||!this.isName?"":this.sanitize(c||"")}sanitize(a){return a=this.options.contentProcessor(a),this.tuiSanitizer&&bu(a)?this.sanitizer.bypassSecurityTrustHtml(this.tuiSanitizer.sanitize(Xo.HTML,a)||""):a}getExternalIcon(a){let c=a.includes(".svg")?a:this.use;return this.staticRequestService.request(c).pipe(wl(()=>(this.onError(bae),Nt(""))),st(h=>this.sanitize(h.replace("<svg",'<svg focusable="false"'))))}}return i.\u0275fac=function(a){return new(a||i)(me(jn),me(Ui),me(_ae),me(yae,8),me(lm,8),me(X1),me(o4),me(m_),me(mn),me(t4))},i.\u0275cmp=Cn({type:i,selectors:[["tui-svg"]],inputs:{src:"src"},decls:2,vars:3,consts:[[4,"tuiLet"],["class","t-src",3,"innerHTML",4,"ngIf","ngIfElse"],["useTemplate",""],[1,"t-src",3,"innerHTML"],["focusable","false","height","100%","version","1.1","width","100%",0,"xmlns","xlink","http://www.w3.org/1999/xlink","xmlns","http://www.w3.org/2000/svg",1,"t-svg",3,"error"]],template:function(a,c){a&1&&(It(0,pae,4,2,"ng-container",0),ai(1,"async")),a&2&&Xe("tuiLet",br(1,1,c.innerHTML$))},dependencies:[Cd,Ki,yo],styles:["[_nghost-%COMP%]{display:inline-flex;vertical-align:middle;flex-shrink:0;align-items:center;justify-content:center;line-height:0;height:1.5rem;width:1.5rem;fill:transparent;stroke:transparent;font-size:1rem}.t-src[_ngcontent-%COMP%]{display:flex;width:100%;height:100%;align-items:center;justify-content:center}.t-svg[_ngcontent-%COMP%]{overflow:visible}"],changeDetection:0}),_0([m1],i.prototype,"resolveName",null),i})(),ym=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,yc]]}),i})();var K1=(()=>{class i extends s4{constructor(){super(...arguments),this.mode=null}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275dir=pn({type:i,selectors:[["","tuiMode",""]],inputs:{mode:[Bi.None,"tuiMode","mode"]},features:[uo]}),i})();var CEe={provide:zD,deps:[[new Bp,zD],mn],useFactory:(i,{nativeElement:r})=>(r["$.class._mobile"]=i,i)},J1={provide:am,deps:[[new cu,K1],mn],useFactory:(i,{nativeElement:r})=>{let a=i?i.change$.pipe(xr(null),st(()=>i.mode)):Nt(null);return r["$.data-mode.attr"]=a,a}};function wae(i,r){i&1&&wn(0,"tui-scroll-controls",2)}var Tae=["*"];var F5=(()=>{class i{constructor(a,c,h,m){this.cssRef=a,this.el=c,this.userAgent=h,this.isIos=m,this.delegated=!1,this.isLegacy=!this.cssRef.supports("position","sticky")||PU(this.userAgent)&&!this.cssRef.supports("scrollbar-width","none"),this.hidden=!1,this.browserScrollRef=new mn(this.el.nativeElement)}get showScrollbars(){return!this.hidden&&!this.isIos&&(!this.isLegacy||this.delegated)}get showNative(){return this.isLegacy&&!this.hidden&&!this.delegated}onScrollable(a){this.delegated=!0,this.browserScrollRef.nativeElement=a}scrollIntoView(a){var c;if(this.delegated)return;let{nativeElement:h}=this.browserScrollRef,{offsetTop:m,offsetLeft:y}=zU(h,a),{clientHeight:w,clientWidth:C}=h,{offsetHeight:D,offsetWidth:z}=a,j=m+D/2-w/2,ie=y+z/2-C/2;(c=h.scrollTo)===null||c===void 0||c.call(h,ie,j)}}return i.\u0275fac=function(a){return new(a||i)(me(XU),me(mn),me(O_),me(Tu))},i.\u0275cmp=Cn({type:i,selectors:[["tui-scrollbar"]],hostVars:2,hostBindings:function(a,c){a&1&&Kt("tui-scrollable.stop",function(m){return c.onScrollable(m.detail)})("tui-scroll-into-view.stop",function(m){return c.scrollIntoView(m.detail)}),a&2&&ti("_legacy",c.showNative)},inputs:{hidden:"hidden"},features:[si([{provide:df,deps:[i],useFactory:({browserScrollRef:r})=>r}])],ngContentSelectors:Tae,decls:3,vars:1,consts:[["class","t-bars",4,"ngIf"],[1,"t-content"],[1,"t-bars"]],template:function(a,c){a&1&&(xs(),It(0,wae,1,0,"tui-scroll-controls",0),He(1,"div",1),Fo(2),We()),a&2&&Xe("ngIf",c.showScrollbars)},dependencies:[nm,Ki],styles:["[_nghost-%COMP%]{position:relative;display:flex;isolation:isolate;overflow:auto}[_nghost-%COMP%]:not(._legacy){scrollbar-width:none;-ms-overflow-style:none}[_nghost-%COMP%]:not(._legacy)::-webkit-scrollbar, [_nghost-%COMP%]:not(._legacy)::-webkit-scrollbar-thumb{background:transparent;width:0;height:0}._legacy[_nghost-%COMP%]{overflow:overlay}@media all and (-webkit-min-device-pixel-ratio: 0) and (min-resolution: .001dpcm){._legacy[_nghost-%COMP%]::-webkit-scrollbar, ._legacy[_nghost-%COMP%]::-webkit-scrollbar-thumb{width:1rem;height:1rem;border-radius:6.25rem;background-clip:padding-box;border:.375rem solid transparent}._legacy[_nghost-%COMP%]::-webkit-scrollbar{background-color:transparent}._legacy[_nghost-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--tui-clear-hover)}._legacy[_nghost-%COMP%]::-webkit-scrollbar-thumb:hover{background-color:var(--tui-clear-active)}._legacy[_nghost-%COMP%]::-webkit-scrollbar-thumb:active{background-color:var(--tui-text-03)}}.t-content[_ngcontent-%COMP%]{isolation:isolate;flex:1;flex-basis:auto;width:100%;height:-webkit-max-content;height:max-content}.t-bars[_ngcontent-%COMP%]{color:var(--tui-text-01)}"],changeDetection:0}),i})(),k5=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,im]]}),i})();function Mae(i){return i.replace(/[a-z][A-Z]/g,r=>`${r[0]}-${r[1].toLowerCase()}`)}var Mu=class{supports(r){return r.includes(this.modifier)}addGlobalEventListener(){return()=>{}}unwrap(r){return r.split(".").filter(a=>!this.modifier.includes(a)).join(".")}},Iae=(()=>{class i extends Mu{constructor(){super(...arguments),this.modifier="$"}addEventListener(a,c){a[c]=a[c]||Lr;let h=this.getMethod(a,c),m=this.manager.getZone().onStable,y=cc(m.pipe(k0(()=>a[c]===Lr)),rd(()=>a[c])).subscribe(h);return()=>y.unsubscribe()}getMethod(a,c){let[,h,m,y=""]=c.split(".");return c.endsWith(".attr")?w=>w===null?a.removeAttribute(h):a.setAttribute(h,String(w)):h==="class"?w=>a.classList.toggle(m,!!w):h==="style"?w=>a.style.setProperty(Mae(m),`${w}${y}`):w=>a[h]=w}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),Cae=(()=>{class i extends Mu{constructor(){super(...arguments),this.modifier="capture.once.passive"}supports(a){return a.includes(".")&&!this.unwrap(a).includes(".")}addEventListener(a,c,h){return a.addEventListener(this.unwrap(c),h,{once:c.includes(".once"),passive:c.includes(".passive"),capture:c.includes(".capture")}),()=>a.removeEventListener(this.unwrap(c),h)}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),Sae=(()=>{class i extends Mu{constructor(){super(...arguments),this.modifier=".prevent"}addEventListener(a,c,h){let m=y=>{y.preventDefault(),h(y)};return this.manager.addEventListener(a,this.unwrap(c),m)}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),Dae=(()=>{class i extends Mu{constructor(){super(...arguments),this.modifier=".self"}addEventListener(a,c,h){let m=y=>{y.target===y.currentTarget&&h(y)};return this.manager.addEventListener(a,this.unwrap(c),m)}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),N5=(()=>{class i extends Mu{constructor(){super(...arguments),this.modifier=".silent"}addEventListener(a,c,h){return i.ngZone=this.manager.getZone(),i.ngZone.runOutsideAngular(()=>this.manager.addEventListener(a,this.unwrap(c),h))}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),Aae=(()=>{class i extends Mu{constructor(){super(...arguments),this.modifier=".stop"}addEventListener(a,c,h){let m=y=>{y.stopPropagation(),h(y)};return this.manager.addEventListener(a,this.unwrap(c),m)}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),Pae=(()=>{class i extends Mu{constructor(){super(...arguments),this.modifier=".init"}addEventListener(){return console.warn(".init plugin is no longer necessary as of v3.1.0"),()=>{}}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),Oae=[N5,Iae,Cae,Sae,Dae,Aae,Pae],Rae=Oae.map(i=>({provide:Wp,multi:!0,useClass:i}));var z5=(()=>{class i{constructor([a]){console.assert(!(a instanceof N5)||i.initialized,"EventPluginsModule must come after BrowserModule in imports"),i.initialized=!0}}return i.initialized=!1,i.\u0275fac=function(a){return new(a||i)(Ct(Wp))},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({providers:Rae}),i})();var B5=(()=>{class i{constructor(a,c){this.el=a,this.destroy$=c}set tuiScrollIntoView(a){a&&Zo(0).pipe(Ii(this.destroy$)).subscribe(()=>{this.el.nativeElement.dispatchEvent(new CustomEvent(k4,{bubbles:!0,detail:this.el.nativeElement}))})}}return i.\u0275fac=function(a){return new(a||i)(me(mn),me(Ci,2))},i.\u0275dir=pn({type:i,selectors:[["","tuiScrollIntoView",""]],inputs:{tuiScrollIntoView:"tuiScrollIntoView"},features:[si([Ci])]}),i})(),j5=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var V5=(()=>{class i{constructor(a){this.mode$=a,this.disabled=!1,this.readOnly=!1,this.hover=null,this.active=null,this.focus=!1,this.invalid=!1,this.appearance=""}get computedInvalid(){return!this.disabled&&!this.readOnly&&this.invalid}get computedFocused(){return this.focus&&!this.disabled}get interactiveState(){return this.disabled?aa.Disabled:this.readOnly?aa.Readonly:this.active?aa.Active:this.hover?aa.Hover:null}get noHover(){return this.readOnly||this.hover===!1}get noActive(){return this.readOnly||this.active===!1}}return i.\u0275fac=function(a){return new(a||i)(me(am))},i.\u0275dir=pn({type:i,selectors:[["","tuiWrapper",""]],hostVars:10,hostBindings:function(a,c){a&1&&Kt("$.data-mode.attr",function(){return c.mode$}),a&2&&(Mr("data-appearance",c.appearance)("data-state",c.interactiveState),ti("_invalid",c.computedInvalid)("_focused",c.computedFocused)("_no-hover",c.noHover)("_no-active",c.noActive))},inputs:{disabled:"disabled",readOnly:"readOnly",hover:"hover",active:"active",focus:"focus",invalid:"invalid",appearance:"appearance"},features:[si([J1])]}),i})(),U5=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();function kae(i,r){if(i&1&&(Ur(0),On(1),$r()),i&2){let a=r.polymorpheusOutlet;qe(),jo(" ",a," ")}}function Nae(i,r){if(i&1&&(Sl(),mz(),He(0,"div",6),It(1,kae,2,1,"ng-container",7),We()),i&2){let a=yt(2);ti("t-text_horizontal",a.isHorizontal),qe(),Xe("polymorpheusOutlet",a.textContent)}}function zae(i,r){if(i&1&&(He(0,"div",2),Sl(),He(1,"svg",3),wn(2,"circle",4),We(),It(3,Nae,2,3,"div",5),We()),i&2){let a=yt();ti("t-loader_horizontal",a.isHorizontal)("t-loader_inherit-color",a.inheritColor),Mr("data-size",a.size),qe(3),Xe("ngIf",a.hasText)}}var Bae=["*"],jae={size:"m",inheritColor:!1,overlay:!1},Vae=ki(jae);var $5=(()=>{class i{constructor(a,c,h,m){this.doc=a,this.el=c,this.isIos=h,this.options=m,this.size=this.options.size,this.inheritColor=this.options.inheritColor,this.overlay=this.options.overlay,this.loading=!0,this.isApple=OU(this.el.nativeElement)||this.isIos}set showLoader(a){a&&this.focused&&t1(this.doc),this.loading=a}get hasOverlay(){return this.overlay&&this.loading}get hasText(){return!!this.textContent}get isHorizontal(){return!j4(this.size)}get focused(){return n1(this.el.nativeElement)}}return i.\u0275fac=function(a){return new(a||i)(me(jn),me(mn),me(Tu),me(Vae))},i.\u0275cmp=Cn({type:i,selectors:[["tui-loader"]],hostVars:2,hostBindings:function(a,c){a&2&&ti("_loading",c.loading)},inputs:{size:"size",inheritColor:"inheritColor",overlay:"overlay",textContent:"textContent",showLoader:"showLoader"},ngContentSelectors:Bae,decls:3,vars:7,consts:[[1,"t-content",3,"disabled"],["class","t-loader",3,"t-loader_horizontal","t-loader_inherit-color",4,"ngIf"],[1,"t-loader"],["automation-id","tui-loader__loader","focusable","false","viewBox","0 0 100 100","xmlns","http://www.w3.org/2000/svg",1,"t-icon"],["cx","50","cy","50","r","50","stroke-dasharray","314",1,"t-circle"],["automation-id","tui-loader__text","class","t-text",3,"t-text_horizontal",4,"ngIf"],["automation-id","tui-loader__text",1,"t-text"],[4,"polymorpheusOutlet"]],template:function(a,c){a&1&&(xs(),He(0,"fieldset",0),Fo(1),We(),It(2,zae,4,6,"div",1)),a&2&&(ti("t-content_has-overlay",c.hasOverlay)("t-content_loading",c.loading),Xe("disabled",c.loading&&!c.isApple),Mr("inert",c.loading||null),qe(2),Xe("ngIf",c.loading))},dependencies:[Ki,oa],styles:["@keyframes _ngcontent-%COMP%_tuiLoaderDashOffset{0%{stroke-dashoffset:-66}50%{stroke-dashoffset:-314}to{stroke-dashoffset:-66}}@keyframes _ngcontent-%COMP%_tuiLoaderRotate{0%{transform:rotate(0)}50%{transform:rotate(1turn)}to{transform:rotate(3turn)}}[_nghost-%COMP%]{position:relative;display:flex;min-width:1.5rem}._loading[_nghost-%COMP%]{overflow:hidden}.t-content[_ngcontent-%COMP%]{z-index:0;min-width:100%;height:100%;padding:0;margin:0;border:none}.t-content_has-overlay[_ngcontent-%COMP%]{opacity:.3}.t-content_loading[_ngcontent-%COMP%]{pointer-events:none}.t-loader[_ngcontent-%COMP%]{position:relative;left:-100%;display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:100%;flex-shrink:0;align-self:center;color:var(--tui-text-01);stroke:var(--tui-primary);animation:tuiFadeIn var(--tui-duration)}.t-loader.t-loader_horizontal[_ngcontent-%COMP%]{flex-direction:row}.t-loader.t-loader_inherit-color[_ngcontent-%COMP%]{color:inherit;stroke:currentColor}.t-loader[data-size=xs][_ngcontent-%COMP%]{font-size:.75rem;stroke-width:38}.t-loader[data-size=s][_ngcontent-%COMP%]{font-size:1rem;stroke-width:25}.t-loader[data-size=m][_ngcontent-%COMP%]{font-size:1.5rem;stroke-width:17}.t-loader[data-size=l][_ngcontent-%COMP%]{font-size:2.5rem;stroke-width:15}.t-loader[data-size=xl][_ngcontent-%COMP%]{font-size:3.5rem;stroke-width:14}.t-loader[data-size=xxl][_ngcontent-%COMP%]{font-size:5rem;stroke-width:10}.t-text[_ngcontent-%COMP%]{font:var(--tui-font-text-s);color:var(--tui-text-01);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1rem;color:inherit;max-width:100%;text-align:center;stroke-width:0}.t-text_horizontal[_ngcontent-%COMP%]{margin:0 0 0 1rem}.t-icon[_ngcontent-%COMP%]{display:block;min-width:1em;max-width:1em;min-height:1em;max-height:1em;margin:.25rem -.5em;border-radius:100%;overflow:hidden;transform:scaleY(-1);animation:_ngcontent-%COMP%_tuiLoaderRotate 3s linear infinite}@supports (-webkit-hyphens: none){.t-icon[_ngcontent-%COMP%]{overflow:visible}}.t-circle[_ngcontent-%COMP%]{fill:none;stroke:inherit;stroke-width:inherit;animation:_ngcontent-%COMP%_tuiLoaderDashOffset 3s linear infinite}"],changeDetection:0}),i})(),H5=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,sa]]}),i})();var $ae=["tuiButton",""];function Hae(i,r){i&1&&Pl(0)}function Gae(i,r){if(i&1&&wn(0,"tui-svg",8),i&2){let a=r.polymorpheusOutlet;Xe("src",a)}}function Wae(i,r){if(i&1&&(He(0,"span",6),It(1,Gae,1,1,"tui-svg",7),We()),i&2){let a=yt();qe(),Xe("polymorpheusOutlet",a.icon)}}function qae(i,r){if(i&1&&wn(0,"tui-svg",8),i&2){let a=r.polymorpheusOutlet;Xe("src",a)}}function Zae(i,r){if(i&1&&(He(0,"span",9),It(1,qae,1,1,"tui-svg",7),We()),i&2){let a=yt();qe(),Xe("polymorpheusOutlet",a.iconRight)}}function Yae(i,r){if(i&1&&wn(0,"tui-loader",10),i&2){let a=yt();Xe("inheritColor",!0)("size",a.loaderSize)}}var Xae=["*"],Kae={size:"l",shape:null,appearance:k_.Primary},Jae=ki(Kae);var vm=(()=>{class i extends d1{constructor(a,c,h){var m;super(),this.mode=a,this.el=c,this.options=h,this.mode$=((m=this.mode)===null||m===void 0?void 0:m.change$)||Lr,this.appearance=null,this.disabled=!1,this.shape=this.options.shape,this.showLoader=!1,this.size=this.options.size,this.appearance$=this.mode$.pipe(xr(null),st(()=>this.computedAppearance),Ro())}get nativeFocusableElement(){return this.nativeDisabled?null:this.el.nativeElement}get focused(){return!this.showLoader&&Kp(this.el.nativeElement)}get loaderSize(){return this.size==="l"||this.size==="xl"?"m":"s"}get computedAppearance(){var a;return(a=this.appearance)!==null&&a!==void 0?a:this.options.appearance||""}get nativeDisabled(){return this.computedDisabled||this.showLoader?"":null}get tabIndex(){return this.focusable?0:-1}onFocused(a){this.updateFocused(a)}}return i.\u0275fac=function(a){return new(a||i)(me(K1,8),me(mn),me(Jae))},i.\u0275cmp=Cn({type:i,selectors:[["button","tuiButton",""],["button","tuiIconButton",""],["a","tuiButton",""],["a","tuiIconButton",""]],hostVars:7,hostBindings:function(a,c){a&1&&Kt("focusin",function(){return c.onFocused(!0)})("focusout",function(){return c.onFocused(!1)}),a&2&&(Hh("tabIndex",c.tabIndex),Mr("data-shape",c.shape)("data-size",c.size)("data-appearance",c.computedAppearance)("disabled",c.nativeDisabled),ti("_loading",c.showLoader))},inputs:{appearance:"appearance",disabled:"disabled",icon:"icon",iconRight:"iconRight",shape:"shape",showLoader:"showLoader",size:"size"},features:[si([c1(i),Ci]),uo],attrs:$ae,ngContentSelectors:Xae,decls:8,vars:10,consts:[[4,"ngIf"],["tuiWrapper","",1,"t-wrapper",3,"active","appearance","disabled","hover"],[1,"t-content"],["class","t-left",4,"ngIf"],["class","t-right",4,"ngIf"],["class","t-loader",3,"inheritColor","size",4,"ngIf"],[1,"t-left"],["class","t-icon",3,"src",4,"polymorpheusOutlet"],[1,"t-icon",3,"src"],[1,"t-right"],[1,"t-loader",3,"inheritColor","size"]],template:function(a,c){a&1&&(xs(),It(0,Hae,1,0,"ng-container",0),ai(1,"async"),He(2,"div",1)(3,"span",2),It(4,Wae,2,1,"span",3),Fo(5),It(6,Zae,2,1,"span",4),We(),It(7,Yae,1,2,"tui-loader",5),We()),a&2&&(Xe("ngIf",br(1,8,c.appearance$)),qe(2),Xe("active",c.pseudoActive)("appearance",c.computedAppearance)("disabled",c.computedDisabled)("hover",c.pseudoHover),qe(2),Xe("ngIf",c.icon),qe(2),Xe("ngIf",c.iconRight),qe(),Xe("ngIf",c.showLoader))},dependencies:[_m,$5,Ki,V5,oa,yo],styles:["[_nghost-%COMP%]{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:0;border:0;background:none;font-size:inherit;line-height:inherit;text-decoration:none;font:var(--tui-font-text-s);color:var(--tui-text-01);position:relative;display:inline-block;flex-shrink:0;vertical-align:top;border-radius:var(--tui-radius-m);-webkit-user-select:none;-moz-user-select:none;user-select:none;outline:none;color:inherit}[data-shape=rounded][_nghost-%COMP%]{border-radius:6.25rem}[data-size=xs][_nghost-%COMP%]{height:var(--tui-height-xs);font-weight:normal}[data-size=xs][data-shape=square][_nghost-%COMP%], [data-size=xs][tuiIconButton][_nghost-%COMP%]{width:var(--tui-height-xs)}[data-size=s][_nghost-%COMP%]{height:var(--tui-height-s);font-weight:normal}[data-size=s][data-shape=square][_nghost-%COMP%], [data-size=s][tuiIconButton][_nghost-%COMP%]{width:var(--tui-height-s)}[data-size=m][_nghost-%COMP%]{height:var(--tui-height-m);font:var(--tui-font-text-m);font-weight:bold}[data-size=m][data-shape=square][_nghost-%COMP%], [data-size=m][tuiIconButton][_nghost-%COMP%]{width:var(--tui-height-m)}[data-size=l][_nghost-%COMP%]{height:var(--tui-height-l);font:var(--tui-font-text-m);font-weight:bold}[data-size=l][data-shape=square][_nghost-%COMP%], [data-size=l][tuiIconButton][_nghost-%COMP%]{width:var(--tui-height-l)}[data-size=xl][_nghost-%COMP%]{height:3.75rem;font:var(--tui-font-text-m);font-weight:bold}[data-size=xl][data-shape=square][_nghost-%COMP%], [data-size=xl][tuiIconButton][_nghost-%COMP%]{width:3.75rem}[tuiIconButton][_nghost-%COMP%]{font-size:0!important}[tuiIconButton][_nghost-%COMP%]   .t-left[_ngcontent-%COMP%], [tuiIconButton][_nghost-%COMP%]   .t-right[_ngcontent-%COMP%]{margin:0!important}.t-loader[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;cursor:default}.t-left[_ngcontent-%COMP%]{margin-right:.5rem}[data-size=s][_nghost-%COMP%]   .t-left[_ngcontent-%COMP%]{margin-right:.375rem}[data-size=xs][_nghost-%COMP%]   .t-left[_ngcontent-%COMP%]{margin-right:.25rem}.t-right[_ngcontent-%COMP%]{margin:0 -.25rem 0 .25rem}[data-size=s][_nghost-%COMP%]   .t-right[_ngcontent-%COMP%]{margin:0 -.25rem 0 .375rem}[data-size=xs][_nghost-%COMP%]   .t-right[_ngcontent-%COMP%]{margin:0 -.125rem 0 .25rem}.t-icon[_ngcontent-%COMP%]{display:flex;max-width:100%;max-height:100%;align-items:center;justify-content:center}.t-left[_ngcontent-%COMP%], .t-right[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:1.5rem;height:1.5rem}[data-size=s][_nghost-%COMP%]   .t-left[_ngcontent-%COMP%], [data-size=s][_nghost-%COMP%]   .t-right[_ngcontent-%COMP%], [data-size=xs][_nghost-%COMP%]   .t-left[_ngcontent-%COMP%], [data-size=xs][_nghost-%COMP%]   .t-right[_ngcontent-%COMP%]{width:1rem;height:1rem}[tuiIconButton][data-appearance=icon][data-size=s][_nghost-%COMP%]   .t-left[_ngcontent-%COMP%], [tuiIconButton][data-appearance=icon][data-size=s][_nghost-%COMP%]   .t-right[_ngcontent-%COMP%], [tuiIconButton][data-appearance=link][data-size=s][_nghost-%COMP%]   .t-left[_ngcontent-%COMP%], [tuiIconButton][data-appearance=link][data-size=s][_nghost-%COMP%]   .t-right[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem}.t-wrapper[_ngcontent-%COMP%]{box-sizing:border-box;cursor:pointer;isolation:isolate}[data-size=xs][_nghost-%COMP%]   .t-wrapper[_ngcontent-%COMP%]{padding:0 var(--tui-padding, .375rem)}[data-size=xs][_nghost-%COMP%]   .t-wrapper[_ngcontent-%COMP%]:after{border-width:1px}[data-size=s][_nghost-%COMP%]   .t-wrapper[_ngcontent-%COMP%]{padding:0 var(--tui-padding, .75rem)}[data-size=m][_nghost-%COMP%]   .t-wrapper[_ngcontent-%COMP%]{padding:0 var(--tui-padding, 1.5rem)}[data-size=l][_nghost-%COMP%]   .t-wrapper[_ngcontent-%COMP%]{padding:0 var(--tui-padding, 2.25rem)}[data-size=xl][_nghost-%COMP%]   .t-wrapper[_ngcontent-%COMP%]{padding:0 var(--tui-padding, 2.5rem)}[data-shape=square][_nghost-%COMP%]   .t-wrapper[_ngcontent-%COMP%], [tuiIconButton][_nghost-%COMP%]   .t-wrapper[_ngcontent-%COMP%]{padding:0}.t-content[_ngcontent-%COMP%]{display:flex;height:100%;align-items:center;justify-content:center;text-align:center}._loading[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{opacity:0}"],changeDetection:0}),i})(),xm=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,sa,U5,ym,H5]]}),i})();function Qae(i,r){if(i&1&&wn(0,"tui-svg",4),i&2){let a=r.polymorpheusOutlet;Xe("src",a)}}var ele=i=>({$implicit:i});function tle(i,r){if(i&1&&(Ur(0),It(1,Qae,1,1,"tui-svg",3),$r()),i&2){let a=yt();qe(),Xe("polymorpheusOutlet",a.icon)("polymorpheusOutletContext",Yx(2,ele,a.status))}}function nle(i,r){if(i&1){let a=Zr();He(0,"button",5),Kt("click",function(){ji(a);let h=yt();return Vi(h.close.emit())}),ai(1,"async"),We()}if(i&2){let a=yt();Xe("icon",a.icons.close)("title",br(1,2,a.closeWord$))}}var ile=["*"],G5=(()=>{class i{constructor(a,c,h){this.closeWord$=a,this.icons=c,this.options=h,this.hasIcon=this.options.hasIcon,this.icon=this.options.icon,this.status=this.options.status,this.size=this.options.size,this.hideClose=!1,this.close=new Zn}get hasClose(){return!this.hideClose&&HU(this.close)}}return i.\u0275fac=function(a){return new(a||i)(me(P1),me(A1),me(R1))},i.\u0275cmp=Cn({type:i,selectors:[["tui-notification"]],hostVars:2,hostBindings:function(a,c){a&2&&Mr("data-status",c.status)("data-size",c.size)},inputs:{hasIcon:"hasIcon",icon:"icon",status:"status",size:"size",hideClose:"hideClose"},outputs:{close:"close"},ngContentSelectors:ile,decls:4,vars:2,consts:[[4,"ngIf"],[1,"t-content"],["appearance","icon","automation-id","tui-notification__close","size","xs","tuiIconButton","","type","button","class","t-close",3,"icon","title","click",4,"ngIf"],["automation-id","tui-notification__icon","class","t-icon",3,"src",4,"polymorpheusOutlet","polymorpheusOutletContext"],["automation-id","tui-notification__icon",1,"t-icon",3,"src"],["appearance","icon","automation-id","tui-notification__close","size","xs","tuiIconButton","","type","button",1,"t-close",3,"icon","title","click"]],template:function(a,c){a&1&&(xs(),It(0,tle,2,4,"ng-container",0),He(1,"div",1),Fo(2),We(),It(3,nle,2,4,"button",2)),a&2&&(Xe("ngIf",c.icon&&c.hasIcon),qe(3),Xe("ngIf",c.hasClose))},dependencies:[_m,vm,Ki,oa,yo],styles:["[_nghost-%COMP%]{font:var(--tui-font-text-s);color:var(--tui-text-01);position:relative;display:flex;padding:.75rem 1rem;border-radius:var(--tui-radius-m);background:#fff;background:var(--tui-base-01);box-sizing:border-box;overflow:hidden}[data-size=s][_nghost-%COMP%]{padding:.375rem .625rem}[data-size=s][_nghost-%COMP%]   .t-icon[_ngcontent-%COMP%]{width:1rem;height:1.25rem;margin:0 .375rem 0 -.125rem}[data-size=s][_nghost-%COMP%]   .t-close[_ngcontent-%COMP%]{margin:-.125rem -.375rem -.125rem .75rem}[data-size=m][_nghost-%COMP%]{padding:.75rem}[data-size=m][_nghost-%COMP%]   .t-icon[_ngcontent-%COMP%]{width:1.25rem;height:1.25rem;margin-right:.5rem}[data-size=m][_nghost-%COMP%]   .t-close[_ngcontent-%COMP%]{margin:-.125rem -.125rem -.125rem 1rem}[data-size=l][_nghost-%COMP%]{padding:1rem;font:var(--tui-font-text-m);border-radius:var(--tui-radius-l)}[data-size=l][_nghost-%COMP%]   .t-icon[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;margin-right:.5rem}[data-status=info][_nghost-%COMP%]{color:var(--tui-info-fill);background:linear-gradient(var(--tui-info-bg),var(--tui-info-bg)),var(--tui-base-01)}[data-status=success][_nghost-%COMP%]{color:var(--tui-success-fill);background:linear-gradient(var(--tui-success-bg),var(--tui-success-bg)),var(--tui-base-01)}[data-status=error][_nghost-%COMP%]{color:var(--tui-error-fill);background:linear-gradient(var(--tui-error-bg),var(--tui-error-bg)),var(--tui-base-01)}[data-status=warning][_nghost-%COMP%]{color:var(--tui-warning-fill);background:linear-gradient(var(--tui-warning-bg),var(--tui-warning-bg)),var(--tui-base-01)}[data-status=neutral][_nghost-%COMP%]{color:var(--tui-neutral-fill);background:linear-gradient(var(--tui-neutral-bg),var(--tui-neutral-bg)),var(--tui-base-01)}.t-content[_ngcontent-%COMP%]{flex:1;word-break:break-word;color:var(--tui-text-01)}"],changeDetection:0}),i})(),W5=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,ym,xm,sa]]}),i})();function sle(i,r){if(i&1&&(Ur(0),On(1),$r()),i&2){let a=r.polymorpheusOutlet;qe(),jo(" ",a," ")}}function ale(i,r){if(i&1&&(He(0,"label",4),It(1,sle,2,1,"ng-container",5),We()),i&2){let a=yt();qe(),Xe("polymorpheusOutlet",a.item.label)("polymorpheusOutletContext",a.item)}}function lle(i,r){if(i&1&&wn(0,"div",6),i&2){let a=r.polymorpheusOutlet;Xe("innerHTML",a,fu)}}var cle=ii(()=>Ee(Eu)?"1rem 1rem 0 auto":"2rem 3rem 0 auto"),ule=(()=>{class i{constructor(a,c,h,m,y){this.el=a,this.destroy$=c,this.position=h,this.options=m,this.item=y,this.autoClose=typeof this.item.autoClose=="function"?this.item.autoClose(this.item.status):this.item.autoClose,this.animation=this.position.endsWith("auto")?Object.assign(Object.assign({},this.options),{value:"right"}):Object.assign(Object.assign({},this.options),{value:"left"})}ngOnInit(){this.initAutoClose()}close(){this.item.$implicit.complete()}initAutoClose(){this.autoClose&&Zo(kU(this.autoClose)?this.autoClose:3e3).pipe(Ii(Wa(this.el.nativeElement,"mouseenter")),Dg(()=>Wa(this.el.nativeElement,"mouseleave")),Ii(this.destroy$)).subscribe(()=>this.close())}}return i.\u0275fac=function(a){return new(a||i)(me(mn),me(Ci,2),me(cle),me(U4),me(lf))},i.\u0275cmp=Cn({type:i,selectors:[["tui-alert"]],hostAttrs:["role","alert"],hostVars:5,hostBindings:function(a,c){a&2&&(r_("@tuiFadeIn",c.options)("@tuiSlideIn",c.animation)("@tuiHeightCollapse",c.animation),Al("margin",c.position))},features:[si([Ci])],decls:4,vars:7,consts:[[3,"hasIcon","hideClose","icon","status","close"],["automation-id","tui-notification-alert__heading","class","t-heading",4,"ngIf"],["automation-id","tui-notification-alert__content",1,"t-content"],[3,"innerHTML",4,"polymorpheusOutlet","polymorpheusOutletContext"],["automation-id","tui-notification-alert__heading",1,"t-heading"],[4,"polymorpheusOutlet","polymorpheusOutletContext"],[3,"innerHTML"]],template:function(a,c){a&1&&(He(0,"tui-notification",0),Kt("close",function(){return c.close()}),It(1,ale,2,2,"label",1),He(2,"div",2),It(3,lle,1,1,"div",3),We()()),a&2&&(Xe("hasIcon",c.item.hasIcon)("hideClose",!c.item.hasCloseButton)("icon",c.item.icon)("status",c.item.status),qe(),Xe("ngIf",c.item.label),qe(2),Xe("polymorpheusOutlet",c.item.content)("polymorpheusOutletContext",c.item))},dependencies:[G5,Ki,oa],styles:["[_nghost-%COMP%]{display:block;box-shadow:var(--tui-shadow-dropdown);border-radius:var(--tui-radius-l);width:18rem}[_nghost-%COMP%]:not(:first-child){margin-top:.75rem!important}[_nghost-%COMP%]:not(:last-child){margin-bottom:0!important}.t-heading[_ngcontent-%COMP%]{margin:0}[data-size=s][_ngcontent-%COMP%]   .t-heading[_ngcontent-%COMP%]{font:var(--tui-font-text-s);font-weight:bold}[data-size=m][_ngcontent-%COMP%]   .t-heading[_ngcontent-%COMP%]{font:var(--tui-font-text-m);line-height:1.25rem;font-weight:bold}[data-size=l][_ngcontent-%COMP%]   .t-heading[_ngcontent-%COMP%]{font:var(--tui-font-text-l);line-height:1.5rem;font-weight:bold}.t-content[_ngcontent-%COMP%]{color:var(--tui-text-01);word-wrap:break-word;word-break:break-word}.t-content[_ngcontent-%COMP%]:empty{display:none}"],data:{animation:[I1,A4,D4]},changeDetection:0}),i})(),dle=(()=>{class i extends h1{constructor(a,c){super(c),this.defaultOptions=a,this.component=new af(ule)}}return i.\u0275fac=function(a){return new(a||i)(Ct(R1),Ct(u1))},i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var q5=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({providers:[e4(dle)],imports:[[Xn,sa,W5]]}),i})();function hle(i,r){if(i&1){let a=Zr();He(0,"div",4),Kt("click",function(){let m=ji(a).tuiLet,y=yt(3);return Vi(y.onItemClick(m))})("tuiHoveredChange",function(h){let y=ji(a).tuiLet,w=yt(3);return Vi(w.onItemHovered(h,y))})("tuiPressedChange",function(h){let y=ji(a).tuiLet,w=yt(3);return Vi(w.onItemPressed(h,y))}),He(1,"div",5),On(2),We()()}if(i&2){let a=r.tuiLet,c=yt(3);ti("t-cell_interval",c.itemIsInterval(a))("t-cell_today",c.itemIsToday(a)),Xe("tuiScrollIntoView",c.scrollItemIntoView(a)),Mr("data-range",c.getItemRange(a))("data-state",c.getItemState(a)),qe(2),no(a)}}function fle(i,r){if(i&1&&(Ur(0),It(1,hle,3,8,"div",3),$r()),i&2){let a=r.$implicit,c=yt().$implicit,h=yt();qe(),Xe("tuiLet",h.getItem(c,a))}}function ple(i,r){i&1&&(He(0,"div",1),It(1,fle,2,1,"ng-container",2),We()),i&2&&(qe(),Xe("tuiRepeatTimesOf",4))}var Z5=100,Y5=4,X5=(()=>{class i{constructor(){this.hoveredItem=null,this.pressedItem=null,this.currentYear=ho.currentLocal().year,this.value=null,this.initialItem=ho.currentLocal(),this.min=kl,this.max=Nl,this.disabledItemHandler=ts,this.yearClick=new Zn}get computedMin(){var a;return(a=this.min)!==null&&a!==void 0?a:kl}get computedMax(){var a;return(a=this.max)!==null&&a!==void 0?a:Nl}get isSingle(){return this.isRange(this.value)&&this.value.from.yearSame(this.value.to)}get rows(){return Math.ceil((this.calculatedMax-this.calculatedMin)/Y5)}get calculatedMin(){let a=this.initialItem.year-Z5,c=this.computedMin;return c.year>a?c.year:a}get calculatedMax(){let a=this.initialItem.year+Z5,c=this.computedMax;return c.year<a?c.year+1:a}isRange(a){return a instanceof sm}scrollItemIntoView(a){return this.initialItem.year===a}getItem(a,c){return a*Y5+c+this.calculatedMin}getItemState(a){let{disabledItemHandler:c,pressedItem:h,hoveredItem:m}=this;return this.computedMax.year<a||c!==ts&&c(a)?aa.Disabled:h===a?aa.Active:m===a?aa.Hover:null}getItemRange(a){let{value:c,hoveredItem:h}=this;return c===null?null:c instanceof bs?c.year===a?Da.Single:null:c instanceof sm?c.from.year===a&&!c.from.yearSame(c.to)||h!==null&&h>c.from.year&&c.from.year===a&&c.from.yearSame(c.to)||h!==null&&h===a&&h<c.from.year&&c.from.yearSame(c.to)?Da.Start:c.to.year===a&&!c.from.yearSame(c.to)||h!==null&&h<c.from.year&&c.from.year===a&&c.from.yearSame(c.to)||h!==null&&h===a&&h>c.from.year&&c.from.yearSame(c.to)?Da.End:c.from.yearSame(c.to)&&c.from.year===a?Da.Single:null:c.find(m=>m.year===a)?Da.Single:null}itemIsToday(a){return this.currentYear===a}itemIsInterval(a){let{value:c,hoveredItem:h}=this;return c===null||!this.isRange(c)?!1:c.from.yearSame(c.to)?h===null||c.from.year===h?!1:of(a,Math.min(c.from.year,h),Math.max(c.from.year,h)):c.from.year<=a&&c.to.year>a}onItemHovered(a,c){this.updateHoveredItem(a,c)}onItemPressed(a,c){this.updatePressedItem(a,c)}onItemClick(a){this.yearClick.emit(new bs(a))}updateHoveredItem(a,c){this.hoveredItem=a?c:null}updatePressedItem(a,c){this.pressedItem=a?c:null}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=Cn({type:i,selectors:[["tui-primitive-year-picker"]],hostVars:2,hostBindings:function(a,c){a&2&&ti("_single",c.isSingle)},inputs:{value:"value",initialItem:"initialItem",min:"min",max:"max",disabledItemHandler:"disabledItemHandler"},outputs:{yearClick:"yearClick"},decls:1,vars:1,consts:[["automation-id","tui-primitive-year-picker__row","class","t-row",4,"tuiRepeatTimes","tuiRepeatTimesOf"],["automation-id","tui-primitive-year-picker__row",1,"t-row"],[4,"tuiRepeatTimes","tuiRepeatTimesOf"],["automation-id","tui-primitive-year-picker__cell","class","t-cell",3,"t-cell_interval","t-cell_today","tuiScrollIntoView","click","tuiHoveredChange","tuiPressedChange",4,"tuiLet"],["automation-id","tui-primitive-year-picker__cell",1,"t-cell",3,"tuiScrollIntoView","click","tuiHoveredChange","tuiPressedChange"],[1,"t-item"]],template:function(a,c){a&1&&It(0,ple,2,1,"div",0),a&2&&Xe("tuiRepeatTimesOf",c.rows)},dependencies:[b1,Cd,B5,_1,v1],styles:['[_nghost-%COMP%]{display:block;font:var(--tui-font-text-m)}.t-row[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:space-between;height:2.25rem;isolation:isolate}.t-item[_ngcontent-%COMP%]{position:relative;flex:1;line-height:2rem;border-radius:var(--tui-radius-m)}.t-item[_ngcontent-%COMP%]:before, .t-item[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;border-radius:var(--tui-radius-m)}.t-item[_ngcontent-%COMP%]:after{border-radius:.5rem}.t-cell[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;width:3.9375rem;text-align:center;outline:none;cursor:pointer;background-clip:content-box;box-sizing:border-box;border:.125rem solid transparent}.t-cell[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;border-radius:var(--tui-radius-m)}.t-cell_today[_ngcontent-%COMP%]:after{position:absolute;left:50%;transform:translate(-50%);content:"";bottom:.3125rem;height:.125rem;width:.75rem;border-radius:.375rem;background-color:var(--tui-text-01)}.t-cell_interval[_ngcontent-%COMP%]:before{background:var(--tui-base-02)}._single[_nghost-%COMP%]   .t-cell_interval[_ngcontent-%COMP%]:before{background:var(--tui-secondary-hover)}.t-cell_interval[_ngcontent-%COMP%]:not(:last-child):before{right:-.25rem;border-top-right-radius:0;border-bottom-right-radius:0}.t-cell_interval[_ngcontent-%COMP%]:not([data-range="start"]):not(:first-child):before{border-top-left-radius:0;border-bottom-left-radius:0}.t-cell_interval[_ngcontent-%COMP%]:last-child:first-child:before{right:0}.t-cell_interval[_ngcontent-%COMP%]:first-child > .t-item[_ngcontent-%COMP%]{border-top-left-radius:var(--tui-radius-m);border-bottom-left-radius:var(--tui-radius-m)}.t-cell_interval[_ngcontent-%COMP%]:last-child > .t-item[_ngcontent-%COMP%]{border-top-right-radius:var(--tui-radius-m);border-bottom-right-radius:var(--tui-radius-m)}.t-cell_interval[_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]{border-radius:0}.t-cell[data-range][_ngcontent-%COMP%]:after{background-color:var(--tui-primary-text)}.t-cell[data-range][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]{color:var(--tui-primary-text)}.t-cell[data-range][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before, .t-cell[data-range][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{background-color:var(--tui-primary)}.t-cell[data-range][data-state=hover][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before, .t-cell[data-range][data-state=hover][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{background-color:var(--tui-primary-hover)}.t-cell[data-range][data-state=active][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before, .t-cell[data-range][data-state=active][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{background-color:var(--tui-primary-active)}.t-cell[data-range=end][_ngcontent-%COMP%]:before{background:var(--tui-base-02)}._single[_nghost-%COMP%]   .t-cell[data-range=end][_ngcontent-%COMP%]:before{background:var(--tui-secondary-hover)}.t-cell[data-range=end][_ngcontent-%COMP%]:not(:first-child):before{border-top-left-radius:0;border-bottom-left-radius:0}.t-cell[data-range=end][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before{left:.625rem;border-top-left-radius:0;border-bottom-left-radius:0}.t-cell[data-range=end][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{left:-2rem;right:100%;transform:translate(1.6rem) scaleY(.83) scaleX(.5) rotate(45deg)}.t-cell[data-range=start][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before{right:.625rem;border-top-right-radius:0;border-bottom-right-radius:0}.t-cell[data-range=start][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{left:100%;right:-2rem;transform:translate(-1.6rem) scaleY(.83) scaleX(.5) rotate(45deg)}.t-cell[data-range=single][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{display:none}.t-cell[data-state=disabled][_ngcontent-%COMP%]{pointer-events:none}.t-cell[data-state=disabled][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]{opacity:.36}.t-cell[data-state=hover][_ngcontent-%COMP%]:hover:not([data-range]) > .t-item[_ngcontent-%COMP%]{background-color:var(--tui-secondary-hover)}.t-cell[data-state=active][_ngcontent-%COMP%]:hover:not([data-range]) > .t-item[_ngcontent-%COMP%]{background-color:var(--tui-secondary-active)}[_nghost-%COMP%]{width:15.75rem}.t-row[_ngcontent-%COMP%]{margin:.875rem 0}.t-row[_ngcontent-%COMP%]:first-child{margin-top:0}.t-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}'],changeDetection:0}),i})(),K5=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[y1,x1,w1,yc,j5]]}),i})();function gle(i,r){if(i&1){let a=Zr();Ur(0),He(1,"button",1),Kt("click",function(){ji(a);let h=yt();return Vi(h.onLeftClick())}),We(),He(2,"span",2),Fo(3),We(),He(4,"button",3),Kt("click",function(){ji(a);let h=yt();return Vi(h.onRightClick())}),We(),$r()}if(i&2){let a=r.ngIf,c=yt();qe(),ti("t-hidden",c.leftComputedDisabled),Xe("focusable",c.computedFocusable)("icon",c.icons.decrement)("title",a[0]),qe(3),ti("t-hidden",c.rightComputedDisabled),Xe("focusable",c.computedFocusable)("icon",c.icons.increment)("title",a[1])}}var _le=["*"],J5=(()=>{class i extends d1{constructor(a,c,h){super(),this.el=a,this.icons=c,this.spinTexts$=h,this.disabled=!1,this.leftDisabled=!1,this.rightDisabled=!1,this.leftClick=new Zn,this.rightClick=new Zn}get focused(){return n1(this.el.nativeElement)}get leftComputedDisabled(){return this.computedDisabled||this.leftDisabled}get rightComputedDisabled(){return this.computedDisabled||this.rightDisabled}onLeftClick(){this.leftComputedDisabled||this.leftClick.emit()}onRightClick(){this.rightComputedDisabled||this.rightClick.emit()}onFocused(a){this.updateFocused(a)}onFocusVisible(a){this.updateFocusVisible(a)}}return i.\u0275fac=function(a){return new(a||i)(me(mn),me(Z4),me(G4))},i.\u0275cmp=Cn({type:i,selectors:[["tui-primitive-spin-button"]],hostBindings:function(a,c){a&1&&Kt("mousedown.silent.prevent",function(){return 0})("keydown.arrowLeft.prevent",function(){return c.onLeftClick()})("keydown.arrowRight.prevent",function(){return c.onRightClick()})("focusin",function(){return c.onFocused(!0)})("focusout",function(){return c.onFocused(!1)})},inputs:{disabled:"disabled",leftDisabled:"leftDisabled",rightDisabled:"rightDisabled"},outputs:{leftClick:"leftClick",rightClick:"rightClick"},features:[uo],ngContentSelectors:_le,decls:2,vars:3,consts:[[4,"ngIf"],["appearance","flat","automation-id","tui-primitive-spin-button__left","size","xs","tuiIconButton","","type","button",3,"focusable","icon","title","click"],[1,"t-content","t-calendar-title"],["appearance","flat","automation-id","tui-primitive-spin-button__right","size","xs","tuiIconButton","","type","button",3,"focusable","icon","title","click"]],template:function(a,c){a&1&&(xs(),It(0,gle,5,10,"ng-container",0),ai(1,"async")),a&2&&Xe("ngIf",br(1,1,c.spinTexts$))},dependencies:[vm,Ki,yo],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;font:var(--tui-font-text-l);text-align:center;font-weight:bold}.t-hidden[_ngcontent-%COMP%]{visibility:hidden}.t-content[_ngcontent-%COMP%]{padding:0 .5rem}"],changeDetection:0}),i})(),Q5=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,xm]]}),i})();var vle=["tuiLink",""];function xle(i,r){if(i&1&&wn(0,"tui-svg",3),i&2){let a=yt();Xe("src",a.icon||"")}}function ble(i,r){if(i&1&&wn(0,"tui-svg",4),i&2){let a=yt();Xe("src",a.icon||"")}}var wle=["*"],e$=(()=>{class i{constructor(a,c,h){this.el=a,this.mode$=c,this.pseudo=!1,this.icon="",this.iconAlign="right",this.iconRotated=!1,this.mode=null,this.focusVisible=!1,this.focusedChange=go(Un(this.el.nativeElement,"focusin").pipe(st(Ed)),Un(this.el.nativeElement,"focusout").pipe(st(ts))),h.subscribe(m=>{this.focusVisible=m})}get nativeFocusableElement(){return this.el.nativeElement}get focused(){return Kp(this.nativeFocusableElement)}get hasIcon(){return!!this.icon}get iconAlignLeft(){return this.hasIcon&&this.iconAlign==="left"}get iconAlignRight(){return this.hasIcon&&this.iconAlign==="right"}}return i.\u0275fac=function(a){return new(a||i)(me(mn),me(am),me(xD))},i.\u0275cmp=Cn({type:i,selectors:[["a","tuiLink",""],["button","tuiLink",""]],hostVars:7,hostBindings:function(a,c){a&1&&Kt("$.data-mode.attr",function(){return c.mode$}),a&2&&(Mr("data-host-mode",c.mode),ti("_pseudo",c.pseudo)("_icon-rotated",c.iconRotated)("_focus-visible",c.focusVisible))},inputs:{pseudo:"pseudo",icon:"icon",iconAlign:"iconAlign",iconRotated:"iconRotated",mode:"mode"},exportAs:["tuiLink"],features:[si([c1(i),xD,Ci,J1])],attrs:vle,ngContentSelectors:wle,decls:4,vars:2,consts:[["class","t-icon t-icon_left",3,"src",4,"ngIf"],[1,"t-content"],["class","t-icon t-icon_right",3,"src",4,"ngIf"],[1,"t-icon","t-icon_left",3,"src"],[1,"t-icon","t-icon_right",3,"src"]],template:function(a,c){a&1&&(xs(),It(0,xle,1,1,"tui-svg",0),He(1,"span",1),Fo(2),We(),It(3,ble,1,1,"tui-svg",2)),a&2&&(Xe("ngIf",c.iconAlignLeft),qe(3),Xe("ngIf",c.iconAlignRight))},dependencies:[_m,Ki],styles:["[_nghost-%COMP%]{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:0;border:0;background:none;font-size:inherit;line-height:inherit;text-decoration:none;transition-property:color;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;color:var(--tui-link);text-align:left;text-transform:inherit;font-weight:inherit;cursor:pointer;outline:none}[_nghost-%COMP%]:hover{color:var(--tui-link-hover)}[_nghost-%COMP%]:disabled{opacity:var(--tui-disabled-opacity);cursor:default}[data-mode=onLight][_nghost-%COMP%]{color:var(--tui-text-02)}[data-mode=onLight][_nghost-%COMP%]:hover, [data-mode=onLight]._active[_nghost-%COMP%]{color:var(--tui-text-01)}[data-mode=onLight]._pseudo[_nghost-%COMP%]{color:var(--tui-text-01)}[data-mode=onLight]._pseudo[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{-webkit-text-decoration-color:rgba(0,0,0,.48);text-decoration-color:#0000007a}[data-mode=onLight]._pseudo[_nghost-%COMP%]:hover, [data-mode=onLight]._pseudo._active[_nghost-%COMP%]{color:var(--tui-text-03)}[data-mode=onLight][data-host-mode=negative][_nghost-%COMP%]{color:var(--tui-negative-night)}[data-mode=onLight][data-host-mode=negative][_nghost-%COMP%]:hover, [data-mode=onLight][data-host-mode=negative][_nghost-%COMP%]:active, [data-mode=onLight][data-host-mode=negative]._active[_nghost-%COMP%]{color:var(--tui-negative-night-hover)}[data-mode=onDark][_nghost-%COMP%]{color:var(--tui-text-03-night)}[data-mode=onDark][_nghost-%COMP%]:hover, [data-mode=onDark][_nghost-%COMP%]:active, [data-mode=onDark]._active[_nghost-%COMP%]{color:var(--tui-text-01-night)}[data-mode=onDark]._pseudo[_nghost-%COMP%]{color:var(--tui-text-01-night)}[data-mode=onDark]._pseudo[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{-webkit-text-decoration-color:rgba(255,255,255,.48);text-decoration-color:#ffffff7a}[data-mode=onDark]._pseudo[_nghost-%COMP%]:hover, [data-mode=onDark]._pseudo[_nghost-%COMP%]:active, [data-mode=onDark]._pseudo._active[_nghost-%COMP%]{color:var(--tui-text-03-night)}[data-mode=onDark][data-host-mode=positive][_nghost-%COMP%]{color:var(--tui-positive-night)}[data-mode=onDark][data-host-mode=positive][_nghost-%COMP%]:hover, [data-mode=onDark][data-host-mode=positive][_nghost-%COMP%]:active, [data-mode=onDark][data-host-mode=positive]._active[_nghost-%COMP%]{color:var(--tui-positive-night-hover)}[data-host-mode=negative][_nghost-%COMP%]{color:var(--tui-negative)}[data-host-mode=negative][_nghost-%COMP%]:hover{color:var(--tui-negative-hover)}[data-host-mode=negative]._pseudo[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{-webkit-text-decoration-color:rgba(222,76,30,.48);text-decoration-color:#de4c1e7a}[data-host-mode=positive][_nghost-%COMP%]{color:var(--tui-positive)}[data-host-mode=positive][_nghost-%COMP%]:hover{color:var(--tui-positive-hover)}[data-host-mode=positive]._pseudo[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{-webkit-text-decoration-color:rgba(58,169,129,.48);text-decoration-color:#3aa9817a}._focus-visible[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{background:var(--tui-selection)}[data-mode=onLight]._focus-visible[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{background:var(--tui-clear);color:var(--tui-text-01)}[data-mode=onDark]._focus-visible[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{background:var(--tui-clear-inverse);color:var(--tui-text-01-night)}[data-host-mode=positive]._focus-visible[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{background:var(--tui-success-bg)}[data-host-mode=negative]._focus-visible[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{background:var(--tui-error-bg)}._pseudo[_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{padding-bottom:.15em;-webkit-text-decoration:underline dashed rgba(51,111,238,.48);text-decoration:underline dashed rgba(51,111,238,.48);text-underline-offset:.2em;text-decoration-thickness:.7px}.t-icon[_ngcontent-%COMP%]{transition-property:transform;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;width:var(--tui-link-icon-size, 1.5rem);height:var(--tui-link-icon-size, 1.5rem);margin-top:-.125rem}.t-icon_left[_ngcontent-%COMP%]{margin-right:.25rem}.t-icon_right[_ngcontent-%COMP%]{margin-left:.25rem}._icon-rotated[_nghost-%COMP%]   .t-icon[_ngcontent-%COMP%]{transform:rotate(180deg)}"],changeDetection:0}),i})(),t$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,ym]]}),i})();var Ele=(i,r)=>{let a=new Date(i.year,i.month,1).getDay();return a>=r?a-r:M1-(r-a)},Mle=({month:i,rowIndex:r,colIndex:a,firstDayOfWeek:c})=>{let h=r*M1+a-Ele(i,c)+1;return h>i.daysCount&&(h-=i.daysCount,i=i.append({month:1})),h<=0&&(i=i.append({month:-1}),h=i.daysCount+h),new Sa(i.year,i.month,h)},Ile=6,n$=(()=>{class i{constructor(a){this.firstDayOfWeek=a,this.currentMonth=null,this.currentSheet=[]}transform(a,c=!1){var h;if(!((h=this.currentMonth)===null||h===void 0)&&h.monthSame(a))return this.currentSheet;let m=[];for(let y=0;y<Ile;y++){let w=[];for(let C=0;C<M1;C++){let D=Mle({month:a,rowIndex:y,colIndex:C,firstDayOfWeek:this.firstDayOfWeek}),z=(ie,oe=a)=>ie.year<oe.year||ie.month<oe.month,j=(ie,oe=a)=>ie.year>oe.year||ie.month>oe.month;if(!(z(D)&&!c)){if(j(D)&&!c)break;w.push(D)}}m.push(w)}return this.currentSheet=m.filter(y=>y.length),this.currentMonth=a,this.currentSheet}}return i.\u0275fac=function(a){return new(a||i)(me(z_,16))},i.\u0275pipe=qa({name:"tuiCalendarSheet",type:i,pure:!0}),i})(),i$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();var r$=(()=>{class i{constructor(a){this.months$=a}transform({month:a}){return this.months$.pipe(st(c=>c[a]))}}return i.\u0275fac=function(a){return new(a||i)(me(H4,16))},i.\u0275pipe=qa({name:"tuiMonth",type:i,pure:!0}),i})(),o$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();function Cle(i){let r=i.length-1;return[i[r],...i.slice(0,r)]}var s$=(()=>{class i{constructor(a){this.firstDayOfWeekIndex=a}transform(a){return a.pipe(st(Cle),st(c=>[...c.slice(this.firstDayOfWeekIndex),...c.slice(0,this.firstDayOfWeekIndex)]))}}return i.\u0275fac=function(a){return new(a||i)(me(z_,16))},i.\u0275pipe=qa({name:"tuiOrderWeekDays",type:i,pure:!0}),i})(),a$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({}),i})();function Dle(i,r){if(i&1&&(Ur(0),On(1),$r()),i&2){let a=yt();qe(),jo(" ",a.value.formattedYear," ")}}function Ale(i,r){if(i&1){let a=Zr();He(0,"button",3),Kt("click",function(){ji(a);let h=yt();return Vi(h.onYearClick())}),On(1),We()}if(i&2){let a=yt();Xe("tuiFocusable",!1),qe(),jo(" ",a.value.formattedYear," ")}}var l$=(()=>{class i{constructor(){this.value=ho.currentLocal(),this.min=kl,this.max=Nl,this.valueChange=new Zn,this.yearClick=new Zn}get computedMin(){var a;return(a=this.min)!==null&&a!==void 0?a:kl}get computedMax(){var a;return(a=this.max)!==null&&a!==void 0?a:Nl}get prevMonthDisabled(){return this.value.monthSameOrBefore(this.computedMin)}get nextMonthDisabled(){return this.value.monthSameOrAfter(this.computedMax)}get oneYear(){let{computedMin:a,computedMax:c}=this;return a.year===c.year}onYearClick(){this.yearClick.next(this.value)}onPrevMonthClick(){this.appendValueWithLimit({month:-1})}onNextMonthClick(){this.appendValueWithLimit({month:1})}appendValueWithLimit(a){let c=this.value.append(a),{computedMin:h,computedMax:m}=this;if(h.monthSameOrAfter(c)){this.updateValue(h);return}this.updateValue(m.monthSameOrBefore(c)?m:c)}updateValue(a){this.value.monthSame(a)||(this.value=a,this.valueChange.emit(a))}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=Cn({type:i,selectors:[["tui-primitive-year-month-pagination"]],inputs:{value:"value",min:"min",max:"max"},outputs:{valueChange:"valueChange",yearClick:"yearClick"},decls:7,vars:10,consts:[[3,"focusable","leftDisabled","rightDisabled","leftClick","rightClick"],[4,"ngIf","ngIfElse"],["button",""],["id","year-btn","automation-id","tui-primitive-year-month-pagination__year-button","tuiLink","","type","button",3,"tuiFocusable","click"]],template:function(a,c){if(a&1&&(He(0,"tui-primitive-spin-button",0),Kt("leftClick",function(){return c.onPrevMonthClick()})("rightClick",function(){return c.onNextMonthClick()}),On(1),ai(2,"async"),ai(3,"tuiMonth"),It(4,Dle,2,1,"ng-container",1)(5,Ale,2,2,"ng-template",null,2,md),We()),a&2){let h=pd(6);Xe("focusable",!1)("leftDisabled",c.prevMonthDisabled)("rightDisabled",c.nextMonthDisabled),qe(),jo(" ",br(2,6,br(3,8,c.value))," "),qe(3),Xe("ngIf",c.oneYear)("ngIfElse",h)}},dependencies:[J5,e$,Ki,x4,yo,r$],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),i})(),c$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,b4,Q5,t$,o$]]}),i})();function Ole(i,r){if(i&1&&wn(0,"div",3),i&2){let a=r.$implicit;Xe("textContent",a)}}function Rle(i,r){if(i&1&&wn(0,"div",14),i&2){let a=yt().ngIf;Al("background-color",(a==null?null:a[1])||"")}}function Lle(i,r){if(i&1&&(He(0,"div",13),wn(1,"div",14),It(2,Rle,1,2,"div",15),We()),i&2){let a=r.ngIf;qe(),Al("background-color",a==null?null:a[0]),qe(),Xe("ngIf",a.length>1)}}var Fle=(i,r,a,c,h)=>[i,r,a,c,h];function kle(i,r){if(i&1){let a=Zr();He(0,"div",10),Kt("click",function(){ji(a);let h=yt().tuiLet,m=yt(4);return Vi(m.onItemClick(h))})("tuiHoveredChange",function(h){ji(a);let m=yt().tuiLet,y=yt(4);return Vi(y.onItemHovered(h&&m))})("tuiPressedChange",function(h){ji(a);let m=yt().tuiLet,y=yt(4);return Vi(y.onItemPressed(h&&m))}),He(1,"div",11),ai(2,"tuiMapper"),On(3),It(4,Lle,3,3,"div",12),ai(5,"tuiMapper"),We()()}if(i&2){let a=yt().tuiLet,c=yt(4);ti("t-cell_interval",c.itemIsInterval(a))("t-cell_today",c.itemIsToday(a))("t-cell_unavailable",c.itemIsUnavailable(a)),Mr("data-range",c.getItemRange(a))("data-state",c.getItemState(a)),qe(),ti("t-item_unavailable",c.itemIsUnavailable(a)),Mr("data-type",Xa(2,13,a,c.dayTypeHandler)),qe(2),jo(" ",a.day," "),qe(),Xe("ngIf",mj(5,16,hj(22,Fle,a,c.toMarkers,c.itemIsToday(a),!!c.getItemRange(a),c.markerHandler)))}}function Nle(i,r){if(i&1&&(Ur(0),It(1,kle,6,28,"div",9),$r()),i&2){let a=r.tuiLet,c=yt(4);qe(),Xe("ngIf",!c.itemIsUnavailable(a)||c.showAdjacent)}}function zle(i,r){if(i&1&&(Ur(0),It(1,Nle,2,1,"ng-container",8),$r()),i&2){let a=r.$implicit,c=yt().$implicit,h=yt().tuiLet;qe(),Xe("tuiLet",h[c][a])}}function Ble(i,r){if(i&1&&(He(0,"div",6),It(1,zle,2,1,"ng-container",7),We()),i&2){let a=r.$implicit,c=yt().tuiLet;qe(),Xe("tuiRepeatTimesOf",c[a].length)}}function jle(i,r){if(i&1&&(He(0,"div",4),It(1,Ble,2,1,"div",5),We()),i&2){let a=r.tuiLet;qe(),Xe("tuiRepeatTimesOf",a.length)}}var u$=(()=>{class i{constructor(a,c){this.unorderedWeekDays$=a,this.dayTypeHandler=c,this.pressedItem=null,this.today=Sa.currentLocal(),this.month=ho.currentLocal(),this.disabledItemHandler=ts,this.markerHandler=S1,this.value=null,this.hoveredItem=null,this.showAdjacent=!0,this.hoveredItemChange=new Zn,this.dayClick=new Zn,this.toMarkers=(h,m,y,w)=>{if(m||y)return null;let C=w(h);return C.length===0?null:C}}get isSingleDayRange(){return this.value instanceof hf&&this.value.isSingleDay}get isSingle(){return this.isSingleDayRange}getItemState(a){let{disabledItemHandler:c,pressedItem:h,hoveredItem:m}=this;return c(a)?aa.Disabled:h?.daySame(a)?aa.Active:m?.daySame(a)?aa.Hover:null}getItemRange(a){let{value:c,hoveredItem:h}=this;return c?c instanceof Sa?c.daySame(a)?Da.Single:null:c instanceof hf?c.from.daySame(a)&&!c.isSingleDay||h?.dayAfter(c.from)&&c.from.daySame(a)&&c.isSingleDay||h?.daySame(a)&&h.dayBefore(c.from)&&c.isSingleDay?Da.Start:c.to.daySame(a)&&!c.isSingleDay||h?.dayBefore(c.from)&&c.from.daySame(a)&&c.isSingleDay||h?.daySame(a)&&h.dayAfter(c.from)&&c.isSingleDay?Da.End:c.isSingleDay&&c.from.daySame(a)?Da.Single:null:c.find(m=>m.daySame(a))?Da.Single:null:null}itemIsToday(a){return this.today.daySame(a)}itemIsUnavailable(a){return!this.month.monthSame(a)}itemIsInterval(a){let{value:c,hoveredItem:h}=this;if(!(c instanceof hf))return!1;if(!c.isSingleDay)return c.from.daySameOrBefore(a)&&c.to.dayAfter(a);if(h===null)return!1;let m=hf.sort(c.from,h);return m.from.daySameOrBefore(a)&&m.to.dayAfter(a)}onItemHovered(a){this.updateHoveredItem(a||null)}onItemPressed(a){this.pressedItem=a||null}onItemClick(a){this.dayClick.emit(a)}updateHoveredItem(a){Jb(this.hoveredItem,a,(c,h)=>c.daySame(h))||(this.hoveredItem=a,this.hoveredItemChange.emit(a))}}return i.\u0275fac=function(a){return new(a||i)(me(FD),me($4))},i.\u0275cmp=Cn({type:i,selectors:[["tui-primitive-calendar"]],hostVars:2,hostBindings:function(a,c){a&2&&ti("_single",c.isSingleDayRange)},inputs:{month:"month",disabledItemHandler:"disabledItemHandler",markerHandler:"markerHandler",value:"value",hoveredItem:"hoveredItem",showAdjacent:"showAdjacent"},outputs:{hoveredItemChange:"hoveredItemChange",dayClick:"dayClick"},decls:6,vars:9,consts:[[1,"t-row","t-row_weekday"],["class","t-cell",3,"textContent",4,"ngFor","ngForOf"],["id","date-rows",4,"tuiLet"],[1,"t-cell",3,"textContent"],["id","date-rows"],["automation-id","tui-primitive-calendar__row","class","t-row",4,"tuiRepeatTimes","tuiRepeatTimesOf"],["automation-id","tui-primitive-calendar__row",1,"t-row"],[4,"tuiRepeatTimes","tuiRepeatTimesOf"],[4,"tuiLet"],["automation-id","tui-primitive-calendar__cell","class","t-cell",3,"t-cell_interval","t-cell_today","t-cell_unavailable","click","tuiHoveredChange","tuiPressedChange",4,"ngIf"],["automation-id","tui-primitive-calendar__cell",1,"t-cell",3,"click","tuiHoveredChange","tuiPressedChange"],["automation-id","tui-primitive-calendar__item",1,"t-item"],["class","t-dots",4,"ngIf"],[1,"t-dots"],[1,"t-dot"],["class","t-dot",3,"backgroundColor",4,"ngIf"]],template:function(a,c){a&1&&(He(0,"div",0),It(1,Ole,1,1,"div",1),ai(2,"async"),ai(3,"tuiOrderWeekDays"),We(),It(4,jle,2,1,"div",2),ai(5,"tuiCalendarSheet")),a&2&&(qe(),Xe("ngForOf",br(2,2,br(3,4,c.unorderedWeekDays$))),qe(3),Xe("tuiLet",Xa(5,6,c.month,!0)))},dependencies:[Ja,Cd,b1,Ki,_1,v1,yo,s$,n$,em],styles:['[_nghost-%COMP%]{display:block;font:var(--tui-font-text-m)}.t-row[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:space-between;height:2.25rem;isolation:isolate}.t-item[_ngcontent-%COMP%]{position:relative;flex:1;line-height:2rem;border-radius:var(--tui-radius-m)}.t-item[_ngcontent-%COMP%]:before, .t-item[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;border-radius:var(--tui-radius-m)}.t-item[_ngcontent-%COMP%]:after{border-radius:.5rem}.t-cell[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;width:2.25rem;text-align:center;outline:none;cursor:pointer;background-clip:content-box;box-sizing:border-box;border:.125rem solid transparent}.t-cell[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;border-radius:var(--tui-radius-m)}.t-cell_today[_ngcontent-%COMP%]:after{position:absolute;left:50%;transform:translate(-50%);content:"";bottom:.3125rem;height:.125rem;width:.75rem;border-radius:.375rem;background-color:var(--tui-text-01)}.t-cell_interval[_ngcontent-%COMP%]:before{background:var(--tui-base-02)}._single[_nghost-%COMP%]   .t-cell_interval[_ngcontent-%COMP%]:before{background:var(--tui-secondary-hover)}.t-cell_interval[_ngcontent-%COMP%]:not(:last-child):before{right:-.25rem;border-top-right-radius:0;border-bottom-right-radius:0}.t-cell_interval[_ngcontent-%COMP%]:not([data-range="start"]):not(:first-child):before{border-top-left-radius:0;border-bottom-left-radius:0}.t-cell_interval[_ngcontent-%COMP%]:last-child:first-child:before{right:0}.t-cell_interval[_ngcontent-%COMP%]:first-child > .t-item[_ngcontent-%COMP%]{border-top-left-radius:var(--tui-radius-m);border-bottom-left-radius:var(--tui-radius-m)}.t-cell_interval[_ngcontent-%COMP%]:last-child > .t-item[_ngcontent-%COMP%]{border-top-right-radius:var(--tui-radius-m);border-bottom-right-radius:var(--tui-radius-m)}.t-cell_interval[_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]{border-radius:0}.t-cell[data-range][_ngcontent-%COMP%]:after{background-color:var(--tui-primary-text)}.t-cell[data-range][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]{color:var(--tui-primary-text)}.t-cell[data-range][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before, .t-cell[data-range][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{background-color:var(--tui-primary)}.t-cell[data-range][data-state=hover][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before, .t-cell[data-range][data-state=hover][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{background-color:var(--tui-primary-hover)}.t-cell[data-range][data-state=active][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before, .t-cell[data-range][data-state=active][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{background-color:var(--tui-primary-active)}.t-cell[data-range=end][_ngcontent-%COMP%]:before{background:var(--tui-base-02)}._single[_nghost-%COMP%]   .t-cell[data-range=end][_ngcontent-%COMP%]:before{background:var(--tui-secondary-hover)}.t-cell[data-range=end][_ngcontent-%COMP%]:not(:first-child):before{border-top-left-radius:0;border-bottom-left-radius:0}.t-cell[data-range=end][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before{left:.625rem;border-top-left-radius:0;border-bottom-left-radius:0}.t-cell[data-range=end][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{left:-2rem;right:100%;transform:translate(1.6rem) scaleY(.83) scaleX(.5) rotate(45deg)}.t-cell[data-range=start][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:before{right:.625rem;border-top-right-radius:0;border-bottom-right-radius:0}.t-cell[data-range=start][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{left:100%;right:-2rem;transform:translate(-1.6rem) scaleY(.83) scaleX(.5) rotate(45deg)}.t-cell[data-range=single][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]:after{display:none}.t-cell[data-state=disabled][_ngcontent-%COMP%]{pointer-events:none}.t-cell[data-state=disabled][_ngcontent-%COMP%] > .t-item[_ngcontent-%COMP%]{opacity:.36}.t-cell[data-state=hover][_ngcontent-%COMP%]:hover:not([data-range]) > .t-item[_ngcontent-%COMP%]{background-color:var(--tui-secondary-hover)}.t-cell[data-state=active][_ngcontent-%COMP%]:hover:not([data-range]) > .t-item[_ngcontent-%COMP%]{background-color:var(--tui-secondary-active)}[_nghost-%COMP%]{width:15.75rem}.t-row[_ngcontent-%COMP%]{justify-content:flex-start}.t-row[_ngcontent-%COMP%]:first-child{justify-content:flex-end}.t-row_weekday[_ngcontent-%COMP%]{font:var(--tui-font-text-s);color:var(--tui-text-02);pointer-events:none}.t-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}.t-item_unavailable[_ngcontent-%COMP%]{opacity:var(--tui-disabled-opacity)}.t-dots[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:-.5rem;padding-bottom:.25rem}.t-dot[_ngcontent-%COMP%]{display:inline-block;width:.25rem;height:.25rem;border-radius:100%;margin:0 .0625rem}'],changeDetection:0}),i})(),d$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,yc,tm,w1,y1,x1,i$,a$]]}),i})();function Ule(i,r){if(i&1){let a=Zr();He(0,"tui-scrollbar",2)(1,"tui-primitive-year-picker",3),Kt("yearClick",function(h){ji(a);let m=yt();return Vi(m.onPickerYearClick(h))}),We()()}if(i&2){let a=yt();qe(),Xe("initialItem",a.month)("max",a.computedMax)("min",a.computedMin)("value",a.value)}}function $le(i,r){if(i&1){let a=Zr();He(0,"tui-primitive-year-month-pagination",4),Kt("valueChange",function(h){ji(a);let m=yt();return Vi(m.onPaginationValueChange(h))})("yearClick",function(){ji(a);let h=yt();return Vi(h.onPaginationYearClick())}),We(),He(1,"tui-primitive-calendar",5),Kt("dayClick",function(h){ji(a);let m=yt();return Vi(m.onDayClick(h))})("hoveredItemChange",function(h){ji(a);let m=yt();return Vi(m.onHoveredItemChange(h))}),ai(2,"tuiMapper"),We()}if(i&2){let a=yt();Xe("max",a.computedMaxViewedMonth)("min",a.computedMinViewedMonth)("value",a.month),qe(),Xe("disabledItemHandler",pj(2,9,a.disabledItemHandler,a.disabledItemHandlerMapper,a.computedMin,a.computedMax))("hoveredItem",a.hoveredItem)("markerHandler",a.markerHandler)("month",a.month)("showAdjacent",a.showAdjacent)("value",a.value)}}var h$=(()=>{class i{constructor(){this.day=null,this.view="month",this.month=ho.currentLocal(),this.disabledItemHandler=ts,this.min=kl,this.max=Nl,this.minViewedMonth=kl,this.maxViewedMonth=Nl,this.hoveredItem=null,this.showAdjacent=!0,this.markerHandler=S1,this.dayClick=new Zn,this.monthChange=new Zn,this.hoveredItemChange=new Zn,this.disabledItemHandlerMapper=(a,c,h)=>m=>m.dayBefore(c)||m.dayAfter(h)||a(m)}set initialView(a){this.view=a}set value(a){this.day=a,this.showAdjacent&&a instanceof Sa&&(this.month=a)}get value(){return this.day}get isInYearView(){return this.view==="year"}get computedMin(){var a;return(a=this.min)!==null&&a!==void 0?a:kl}get computedMax(){var a;return(a=this.max)!==null&&a!==void 0?a:Nl}get computedMinViewedMonth(){var a;let c=this.computedMin,h=(a=this.minViewedMonth)!==null&&a!==void 0?a:kl;return h.monthSameOrAfter(c)?h:c}get computedMaxViewedMonth(){var a;let c=this.computedMax,h=(a=this.maxViewedMonth)!==null&&a!==void 0?a:Nl;return h.monthSameOrBefore(c)?h:c}onPaginationYearClick(){this.view="year"}onPickerYearClick({year:a}){this.view="month",this.updateViewedMonth(new ho(a,this.month.month))}onPaginationValueChange(a){this.updateViewedMonth(a)}onDayClick(a){this.dayClick.emit(a)}onHoveredItemChange(a){this.updateHoveredDay(a)}updateViewedMonth(a){this.month.monthSame(a)||(this.month=a,this.monthChange.emit(a))}updateHoveredDay(a){Jb(this.hoveredItem,a,(c,h)=>c.daySame(h))||(this.hoveredItem=a,this.hoveredItemChange.emit(a))}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=Cn({type:i,selectors:[["tui-calendar"]],inputs:{initialView:"initialView",month:"month",disabledItemHandler:"disabledItemHandler",min:"min",max:"max",minViewedMonth:"minViewedMonth",maxViewedMonth:"maxViewedMonth",hoveredItem:"hoveredItem",showAdjacent:"showAdjacent",markerHandler:"markerHandler",value:"value"},outputs:{dayClick:"dayClick",monthChange:"monthChange",hoveredItemChange:"hoveredItemChange"},decls:3,vars:2,consts:[["automation-id","tui-calendar__scrollbar","class","t-scrollbar",4,"ngIf","ngIfElse"],["calendar",""],["automation-id","tui-calendar__scrollbar",1,"t-scrollbar"],["automation-id","tui-calendar__year",3,"initialItem","max","min","value","yearClick"],["automation-id","tui-calendar__pagination",1,"t-pagination",3,"max","min","value","valueChange","yearClick"],["automation-id","tui-calendar__calendar",3,"disabledItemHandler","hoveredItem","markerHandler","month","showAdjacent","value","dayClick","hoveredItemChange"]],template:function(a,c){if(a&1&&It(0,Ule,2,4,"tui-scrollbar",0)(1,$le,3,14,"ng-template",null,1,md),a&2){let h=pd(2);Xe("ngIf",c.isInYearView)("ngIfElse",h)}},dependencies:[F5,X5,l$,u$,Ki,em],styles:["[_nghost-%COMP%]{display:block;height:18.25rem;width:15.75rem;padding:1rem 1.125rem;box-sizing:content-box}.t-scrollbar[_ngcontent-%COMP%]{height:18.25rem;width:16.875rem}.t-pagination[_ngcontent-%COMP%]{margin-bottom:1rem}"],changeDetection:0}),i})(),f$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,c$,d$,K5,k5,tm]]}),i})();function Hle(i,r){if(i&1&&(Ur(0),On(1),$r()),i&2){let a=r.polymorpheusOutlet;qe(),jo(" ",a," ")}}function Gle(i,r){if(i&1&&(He(0,"header",6),It(1,Hle,2,1,"ng-container",3),We()),i&2){let a=yt();qe(),Xe("polymorpheusOutlet",a.header)("polymorpheusOutletContext",a.context)}}function Wle(i,r){if(i&1){let a=Zr();Ur(0),wn(1,"div",7),He(2,"div",8)(3,"button",9),Kt("click",function(){ji(a);let h=yt();return Vi(h.context.$implicit.complete())}),On(4),We()(),$r()}if(i&2){let a=r.polymorpheusOutlet,c=yt(),h;qe(),Xe("innerHTML",a,fu),qe(3),jo(" ",((h=c.context.data)==null?null:h.button)||"OK"," ")}}function qle(i,r){if(i&1){let a=Zr();He(0,"div",10)(1,"button",11),Kt("click",function(){ji(a);let h=yt();return Vi(h.close$.next())})("mousedown.prevent.silent",function(){return 0}),ai(2,"async"),We()()}if(i&2){let a=yt();qe(),Xe("appearance",a.fullscreen?"secondary":"")("icon",a.icons.close)("title",br(2,3,a.closeWord$))}}var Zle={size:"m",required:!1,closeable:!0,dismissible:!0,label:"",header:""},Yle=ki(Lr),Xle=ki(Zle);var Kle=17,p$=(()=>{class i extends un{constructor(a,c,h){super(m=>go(this.esc$,this.mousedown$).subscribe(m)),this.win=a,this.doc=c,this.el=h,this.esc$=Un(this.doc,"keydown").pipe(zi(m=>{let y=Id(m);return m.key==="Escape"&&!m.defaultPrevented&&(this.element.contains(y)||this.isOutside(y))})),this.mousedown$=Un(this.doc,"mousedown").pipe(zi(m=>C1(this.win)-m.clientX>Kle&&this.isOutside(Id(m))),Fi(()=>Un(this.doc,"mouseup").pipe(Bo(1),st(Id),zi(m=>this.isOutside(m)))))}get element(){return this.el.nativeElement}isOutside(a){return sf(a)&&(!Qb(this.element,a)||a===this.element)}}return i.\u0275fac=function(a){return new(a||i)(Ct(Ui),Ct(jn),Ct(mn))},i.\u0275prov=gt({token:i,factory:i.\u0275fac}),i})(),Jle=new Error("Required dialog was dismissed");function m$(i){return xh(i)?i:Nt(i)}var Qle=(()=>{class i{constructor(a,c,h,m,y,w,C,D){this.duration=a,this.isMobile=c,this.context=h,this.closeWord$=C,this.icons=D,this.animation={value:"",params:{start:"40px",duration:this.duration}},this.fullscreenAnimation={value:"",params:{start:"100vh",duration:this.duration}},this.close$=new Qr,go(this.close$.pipe(Fi(()=>m$(h.closeable))),y.pipe(Fi(()=>m$(h.dismissible))),w.pipe(st(Ed))).pipe(zi(Boolean),Ii(m)).subscribe(()=>{this.close()})}get size(){return this.context.size}get header(){return this.context.header}get slideInTop(){return this.fullscreen||this.isMobile?this.fullscreenAnimation:this.animation}get fullscreen(){return!this.isMobile&&(this.size==="fullscreen"||this.size==="page")}close(){this.context.required?this.context.$implicit.error(Jle):this.context.$implicit.complete()}}return i.\u0275fac=function(a){return new(a||i)(me(N_),me(Eu),me(lf),me(Ci,2),me(p$),me(Yle),me(P1),me(A1))},i.\u0275cmp=Cn({type:i,selectors:[["tui-dialog"]],hostVars:6,hostBindings:function(a,c){a&2&&(Mr("data-appearance",c.context.appearance)("data-size",c.size),r_("@tuiSlideInTop",c.slideInTop)("@tuiFadeIn",c.slideInTop),ti("_centered",c.header))},features:[si([Ci,p$])],decls:7,vars:6,consts:[["class","t-header",4,"ngIf"],[1,"t-content"],[1,"t-heading",3,"id","textContent"],[4,"polymorpheusOutlet","polymorpheusOutletContext"],[1,"t-filler"],["class","t-wrapper",4,"ngIf"],[1,"t-header"],[3,"innerHTML"],[1,"t-buttons"],["size","m","tuiAutoFocus","","tuiButton","","type","button",3,"click"],[1,"t-wrapper"],["automation-id","tui-dialog__close","shape","rounded","size","s","tuiIconButton","","type","button",1,"t-close",3,"appearance","icon","title","click","mousedown.prevent.silent"]],template:function(a,c){a&1&&(It(0,Gle,2,2,"header",0),He(1,"div",1),wn(2,"h2",2),He(3,"section"),It(4,Wle,5,2,"ng-container",3),We()(),wn(5,"div",4),It(6,qle,3,5,"div",5)),a&2&&(Xe("ngIf",c.header),qe(2),Xe("id",c.context.id)("textContent",c.context.label),qe(2),Xe("polymorpheusOutlet",c.context.content)("polymorpheusOutletContext",c.context),qe(2),Xe("ngIf",c.context.closeable))},dependencies:[vm,Ki,oa,g4,yo],styles:['[_nghost-%COMP%]{position:relative;display:flex;font:var(--tui-font-text-m);flex-direction:column;box-sizing:border-box;margin:auto;border-radius:1rem;border:2.5rem solid transparent}[_nghost-%COMP%]:after{position:absolute;top:0;left:0;width:100%;height:100%;content:"";border-radius:inherit;pointer-events:none;box-shadow:var(--tui-shadow-modal)}[data-size=auto][_nghost-%COMP%]{width:auto}[data-size=s][_nghost-%COMP%]{width:30rem}[data-size=s][_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{padding:1.5rem}[data-size=s][_nghost-%COMP%]   .t-heading[_ngcontent-%COMP%]{margin-bottom:.5rem;font:var(--tui-font-heading-5)}[data-size=m][_nghost-%COMP%]{width:42.5rem}[data-size=m][_nghost-%COMP%]   .t-heading[_ngcontent-%COMP%]{margin-bottom:.75rem;font:var(--tui-font-heading-4)}[data-size=l][_nghost-%COMP%]{width:55rem}[data-size=l][_nghost-%COMP%]   .t-heading[_ngcontent-%COMP%]{margin-bottom:1rem}[data-size=fullscreen][_nghost-%COMP%], [data-size=page][_nghost-%COMP%]{min-width:100vw;min-height:100%;border-radius:0;border:none;background:var(--tui-elevation-01);box-shadow:0 4rem var(--tui-elevation-01)}[data-size=fullscreen][_nghost-%COMP%]   .t-content[_ngcontent-%COMP%], [data-size=page][_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{padding:3rem calc(50vw - (45rem / 2))}[data-size=fullscreen][_nghost-%COMP%]   .t-heading[_ngcontent-%COMP%], [data-size=page][_nghost-%COMP%]   .t-heading[_ngcontent-%COMP%]{margin-bottom:1rem}[data-size=page][_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{padding:0}._centered[_nghost-%COMP%]{text-align:center}[_nghost-%COMP%]   tui-root._mobile[data-size][_nghost-%COMP%], tui-root._mobile   [data-size][_nghost-%COMP%]{min-width:100%;width:100%;max-width:100%;border-radius:0;border:none;margin:auto 0 0}[_nghost-%COMP%]   tui-root._mobile[data-size][_nghost-%COMP%]   .t-content[_ngcontent-%COMP%], tui-root._mobile   [data-size][_nghost-%COMP%]   .t-content[_ngcontent-%COMP%]{padding:1.5rem}[_nghost-%COMP%]   tui-root._mobile[data-size][_nghost-%COMP%]   .t-heading[_ngcontent-%COMP%], tui-root._mobile   [data-size][_nghost-%COMP%]   .t-heading[_ngcontent-%COMP%]{margin-bottom:.5rem;font:var(--tui-font-heading-5)}.t-heading[_ngcontent-%COMP%]{margin:0;word-wrap:break-word;font:var(--tui-font-heading-3)}.t-heading[_ngcontent-%COMP%]:empty{display:none}.t-header[_ngcontent-%COMP%]{display:flex;border-top-left-radius:inherit;border-top-right-radius:inherit;overflow:hidden}[data-size=fullscreen][_nghost-%COMP%]   tui-root._mobile[_nghost-%COMP%]   .t-header[_ngcontent-%COMP%], tui-root._mobile   [_nghost-%COMP%]   .t-header[_ngcontent-%COMP%]{flex:1}.t-content[_ngcontent-%COMP%]{border-radius:inherit;padding:2rem;background:var(--tui-elevation-01)}.t-content[_ngcontent-%COMP%]:not(:first-child){border-top-left-radius:0;border-top-right-radius:0}.t-wrapper[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:0;z-index:1;order:-1}.t-filler[_ngcontent-%COMP%]{flex-grow:1}.t-close[_ngcontent-%COMP%]{transition-property:background;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;position:fixed;top:1.5rem;right:1.5rem;display:none;color:var(--tui-base-01)}.t-dialog:last-of-type[_nghost-%COMP%]   .t-close[_ngcontent-%COMP%], .t-dialog:last-of-type   [_nghost-%COMP%]   .t-close[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]:not([data-size="fullscreen"]):not([data-size="page"])   .t-close[_ngcontent-%COMP%]{animation:tuiFadeIn var(--tui-duration);background:rgba(104,104,104,.96)}[_nghost-%COMP%]:not([data-size="fullscreen"]):not([data-size="page"])   .t-close[_ngcontent-%COMP%]:hover{background:rgba(159,159,159,.86)}[_nghost-%COMP%]:not([data-size="fullscreen"]).ng-animating   .t-close[_ngcontent-%COMP%]{display:none}tui-root._mobile[_nghost-%COMP%]   .t-close[_ngcontent-%COMP%], tui-root._mobile   [_nghost-%COMP%]   .t-close[_ngcontent-%COMP%]{position:absolute;top:0;right:0;background:transparent!important;color:var(--tui-text-01);opacity:.5}.t-buttons[_ngcontent-%COMP%]{margin-top:1.25rem;text-align:right}'],data:{animation:[P4,I1]}}),i})(),ece=new af(Qle),tce=(()=>{class i extends h1{constructor(){super(...arguments),this.component=ece,this.defaultOptions=Object.assign(Object.assign({},Ee(Xle)),{data:void 0})}}return i.\u0275fac=(()=>{let r;return function(c){return(r||(r=_o(i)))(c||i)}})(),i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var g$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({providers:[n4(tce)],imports:[[sa,xm,Xn,_4]]}),i})();function nce(i,r){i&1&&Pl(0)}var ice=i=>({$implicit:i});function rce(i,r){if(i&1&&(He(0,"div",1),It(1,nce,1,0,"ng-container",2),We()),i&2){let a=r.$implicit;Xe("@tuiParentAnimation",void 0)("tuiActiveZoneParent",a.activeZone||null),qe(),Xe("polymorpheusOutlet",a.component)("polymorpheusOutletContext",Yx(4,ice,a))}}var _$=(()=>{class i{constructor(a,c,h){this.hints$=a,this.destroy$=c,this.cdr=h,this.hints=[]}ngOnInit(){this.hints$.pipe(Ii(this.destroy$)).subscribe(a=>{this.hints=a,this.cdr.detectChanges()})}}return i.\u0275fac=function(a){return new(a||i)(me(L5),me(Ci,2),me(co))},i.\u0275cmp=Cn({type:i,selectors:[["tui-hints-host"]],hostAttrs:["aria-live","polite"],features:[si([Ci])],decls:1,vars:1,consts:[["role","tooltip",3,"tuiActiveZoneParent",4,"ngFor","ngForOf"],["role","tooltip",3,"tuiActiveZoneParent"],[4,"polymorpheusOutlet","polymorpheusOutletContext"]],template:function(a,c){a&1&&It(0,rce,2,6,"div",0),a&2&&Xe("ngForOf",c.hints)},dependencies:[Ja,h4,oa],styles:["[_nghost-%COMP%]{position:fixed;top:0;left:0;width:100%;height:0}"],data:{animation:[Yb]}}),i})(),y$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,sa,f4]]}),i})();function sce(i,r){if(i&1&&(Sl(),wn(0,"defs",4)),i&2){let a=r.$implicit;Xe("innerHTML",a,fu)}}function ace(i,r){if(i&1&&(Sl(),Ur(0),It(1,sce,1,1,"defs",3),$r()),i&2){let a=yt();qe(),Xe("ngForOf",a.items)}}function lce(i,r){if(i&1&&(Sl(),He(0,"defs"),wn(1,"svg",6),We()),i&2){let a=r.$implicit;qe(),Xe("outerHTML",a,fu)}}function cce(i,r){if(i&1&&(Sl(),It(0,lce,2,1,"defs",5)),i&2){let a=yt();Xe("ngForOf",a.items)}}var v$=(()=>{class i{constructor(a,c,h,m){this.svgService=a,this.cdr=c,this.destroy$=h,this.isBrowser=!0,this.isBrowser=!qh(m)}ngOnInit(){this.svgService.items$.pipe(Ii(this.destroy$)).subscribe(a=>{this.items=a.values(),this.cdr.detectChanges()})}}return i.\u0275fac=function(a){return new(a||i)(me(X1),me(co),me(Ci,2),me(vs))},i.\u0275cmp=Cn({type:i,selectors:[["tui-svg-defs-host"]],features:[si([Ci])],decls:4,vars:2,consts:[["version","1.1",0,"xmlns","xlink","http://www.w3.org/1999/xlink","xmlns","http://www.w3.org/2000/svg"],[4,"ngIf","ngIfElse"],["server",""],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],[4,"ngFor","ngForOf"],[3,"outerHTML"]],template:function(a,c){if(a&1&&(Sl(),He(0,"svg",0),It(1,ace,2,1,"ng-container",1)(2,cce,1,1,"ng-template",null,2,md),We()),a&2){let h=pd(3);qe(),Xe("ngIf",c.isBrowser)("ngIfElse",h)}},dependencies:[Ki,Ja],styles:["[_nghost-%COMP%]{display:none}"],changeDetection:0}),i})(),x$=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,yc]]}),i})();function dce(i,r){i&1&&wn(0,"tui-scroll-controls",2)}var hce=["*",[["tuiOverContent"]],[["tuiOverDialogs"]],[["tuiOverAlerts"]],[["tuiOverPortals"]],[["tuiOverHints"]]],fce=["*","tuiOverContent","tuiOverDialogs","tuiOverAlerts","tuiOverPortals","tuiOverHints"],b$=(()=>{class i{constructor(a,c,h,m,y,w,C,D,z){var j;this.reducedMotion=a,this.duration=c,this.dialogs=h,this.isMobile=m,this.breakpoint=y,this.isIOS=w,this.isAndroid=C,this.isMobileRes$=this.breakpoint.pipe(st(ie=>ie==="mobile")),this.scrollbars$=this.dialogs.length&&!this.isMobile?lc([...this.dialogs]).pipe(st(ie=>!ie.some(({length:oe})=>oe)),O0(0)):Nt(!this.isMobile),(j=D.defaultView)===null||j===void 0||j.document.body.setAttribute("data-tui-theme",z.toLowerCase())}}return i.\u0275fac=function(a){return new(a||i)(me(LD),me(N_),me(R_),me(Eu),me(R5),me(Tu),me(i4),me(jn),me(K4))},i.\u0275cmp=Cn({type:i,selectors:[["tui-root"]],hostAttrs:["data-tui-version","3.65.0"],hostVars:9,hostBindings:function(a,c){a&1&&Kt("$.class._mobile",function(){return c.isMobileRes$}),a&2&&(Hh("$.class._mobile",c.isMobileRes$),Al("--tui-duration",c.duration,"ms"),ti("_ios",c.isIOS)("_android",c.isAndroid)("_reduced-motion",c.reducedMotion))},ngContentSelectors:fce,decls:14,vars:3,consts:[["class","t-root-scrollbar",4,"ngIf"],[1,"t-root-content"],[1,"t-root-scrollbar"]],template:function(a,c){a&1&&(xs(hce),It(0,dce,1,0,"tui-scroll-controls",0),ai(1,"async"),wn(2,"tui-svg-defs-host"),He(3,"tui-dropdown-host")(4,"div",1),Fo(5),We(),Fo(6,1),wn(7,"tui-dialog-host"),Fo(8,2),wn(9,"tui-alert-host"),Fo(10,3),We(),Fo(11,4),wn(12,"tui-hints-host"),Fo(13,5)),a&2&&Xe("ngIf",br(1,1,c.scrollbars$))},dependencies:[nm,v$,M4,C4,l4,_$,Ki,yo],styles:[`@keyframes tuiPresent{to{content:"1"}}@keyframes tuiSkeletonVibe{to{opacity:.5}}html,.tui-zero-scrollbar{scrollbar-width:none;-ms-overflow-style:none}html::-webkit-scrollbar,.tui-zero-scrollbar::-webkit-scrollbar,html::-webkit-scrollbar-thumb,.tui-zero-scrollbar::-webkit-scrollbar-thumb{display:none}body[data-tui-theme]{font:var(--tui-font-text-s);color:var(--tui-text-01);background:var(--tui-base-01);margin:0}tui-root{position:relative;display:block;flex:1;-webkit-tap-highlight-color:transparent}tui-root>.t-root-scrollbar{position:fixed;top:0;left:0;bottom:0;right:0;display:none;margin:0}[data-tui-theme] tui-root>.t-root-scrollbar{display:block}.t-root-content{height:100%;isolation:isolate}.t-overscroll-none{overscroll-behavior:none}
`],encapsulation:2}),i})(),Q1=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=wt({type:i}),i.\u0275inj=bt({imports:[[Xn,z5,I4,x$,y$,S4,c4,im]]}),i})();var w$=(()=>{let r=class r{drawPolygon(c){c.changeMode("draw_polygon")}deletePolygon(c){c.delete(c.getSelectedIds())}choosePolygon(c){c.changeMode("simple_select")}editPolygon(c){let h=c.getSelectedIds();c.changeMode("direct_select",{featureId:h[h.length-1]})}deleteAllPolygon(c){c.deleteAll()}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var RA=fM(E$());var M$=(()=>{let r=class r{constructor(){this.height=0,this.drawPolygon=new Zn,this.deletePolygon=new Zn,this.choosePolygon=new Zn,this.editPolygon=new Zn,this.deleteAllPolygon=new Zn,this.heightCount=new Zn}onDrawPolygon(){this.drawPolygon.emit()}onDeletePolygon(){this.deletePolygon.emit()}onChoosePolygon(){this.choosePolygon.emit()}onEditPolygon(){this.editPolygon.emit()}onDeleteAllPolygon(){this.deleteAllPolygon.emit()}onHeightCount(c){this.heightCount.emit(c)}};r.\u0275fac=function(h){return new(h||r)},r.\u0275cmp=Cn({type:r,selectors:[["lib-toolbar"]],outputs:{drawPolygon:"drawPolygon",deletePolygon:"deletePolygon",choosePolygon:"choosePolygon",editPolygon:"editPolygon",deleteAllPolygon:"deleteAllPolygon",heightCount:"heightCount"},standalone:!0,features:[ra],decls:15,vars:1,consts:[[1,"tools"],[3,"click"],[1,"input"],["for","input"],["id","input","placeholder","\u0412\u044B\u0441\u043E\u0442\u0430 \u043F\u043E\u043B\u0438\u0433\u043E\u043D\u0430",3,"ngModel","ngModelChange"]],template:function(h,m){h&1&&(He(0,"div",0)(1,"button",1),Kt("click",function(){return m.onDrawPolygon()}),On(2,"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043F\u043E\u043B\u0438\u0433\u043E\u043D"),We(),He(3,"button",1),Kt("click",function(){return m.onDeletePolygon()}),On(4,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043E\u043B\u0438\u0433\u043E\u043D"),We(),He(5,"button",1),Kt("click",function(){return m.onDeleteAllPolygon()}),On(6,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u043F\u043E\u043B\u0438\u0433\u043E\u043D\u044B"),We(),He(7,"button",1),Kt("click",function(){return m.onChoosePolygon()}),On(8,"\u0412\u044B\u0434\u0435\u043B\u0438\u0442\u044C \u043F\u043E\u043B\u0438\u0433\u043E\u043D"),We(),He(9,"button",1),Kt("click",function(){return m.onEditPolygon()}),On(10,"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u043B\u0438\u0433\u043E\u043D"),We(),He(11,"div",2)(12,"label",3),On(13,"\u0412\u044B\u0441\u043E\u0442\u0430 \u043F\u043E\u043B\u0438\u0433\u043E\u043D\u0430"),We(),He(14,"input",4),Kt("ngModelChange",function(w){return m.height=w})("ngModelChange",function(w){return m.onHeightCount(w)}),We()()()),h&2&&(qe(14),Xe("ngModel",m.height))},dependencies:[TU,Xp,Gb,uD],styles:["[_nghost-%COMP%]{height:100%}.tools[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-evenly;height:100%;padding:0 2rem}.tools[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:1rem;padding:.4rem 1rem;background-color:#526ed3;color:#fff;cursor:pointer;transition:.3s ease-out;border:none}.tools[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#526ed3cb}.tools[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:1px solid #526ed3cb;padding:.5rem;border-radius:1rem;font-size:16px;text-align:center;position:relative}.tools[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]{text-align:center}"],changeDetection:0});let i=r;return i})();var C$=fM(I$());var S$=(()=>{let r=class r{constructor(){this.mapService=Ee(w$),this.draw=new C$.default({displayControlsDefault:!0,defaultMode:"simple_select"}),this.height=0}ngOnInit(){RA.default.accessToken="pk.eyJ1IjoibWFyb29uZWRpb25lIiwiYSI6ImNqdmp0MzB1azBpcDAzem1naHZwMjNndGIifQ.65nvvRg9QeFUV2c6b9W4Vw";let c=new RA.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[37.5647499,55.7688429],zoom:17,pitch:40,bearing:20,antialias:!0});c.on("load",()=>{c.addControl(this.draw)}),c.on("draw.create",h=>this.createLayer(c,h.features[0])),c.on("draw.delete",h=>this.deleteLayer(c,h.features[0])),c.on("draw.update",h=>this.updateLayer(c,h.features[0])),this.map=c}drawPolygon(){this.mapService.drawPolygon(this.draw)}deleteAllPolygon(){let c=this.draw.getAll().features.map(h=>h.id);this.mapService.deleteAllPolygon(this.draw),c.forEach(h=>this.deleteLayer(this.map,h))}deletePolygon(){let c=this.draw.getSelectedIds();this.mapService.deletePolygon(this.draw),c.forEach(h=>this.deleteLayer(this.map,h))}choosePolygon(){this.mapService.choosePolygon(this.draw)}editPolygon(){this.mapService.editPolygon(this.draw)}updateLayer(c,h){this.height&&(this.deleteLayer(c,h),this.createLayer(c,h))}deleteLayer(c,h){!c.getLayer(`layer${h.id||h}`)||!c.getSource(`source${h.id||h}`)||(c.removeLayer(`layer${h.id||h}`),c.removeSource(`source${h.id||h}`))}createLayer(c,h){this.height&&(c.addSource(`source${h.id}`,{type:"geojson",data:h}),c.addLayer({id:`layer${h.id}`,source:`source${h.id}`,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-height":this.height,"fill-extrusion-base":["get","base_height"],"fill-extrusion-opacity":.5}}))}setHeight(c){this.height=+c}};r.\u0275fac=function(h){return new(h||r)},r.\u0275cmp=Cn({type:r,selectors:[["lib-map"]],standalone:!0,features:[ra],decls:2,vars:0,consts:[[3,"drawPolygon","deletePolygon","choosePolygon","editPolygon","deleteAllPolygon","heightCount"],["id","map"]],template:function(h,m){h&1&&(He(0,"lib-toolbar",0),Kt("drawPolygon",function(){return m.drawPolygon()})("deletePolygon",function(){return m.deletePolygon()})("choosePolygon",function(){return m.choosePolygon()})("editPolygon",function(){return m.editPolygon()})("deleteAllPolygon",function(){return m.deleteAllPolygon()})("heightCount",function(w){return m.setHeight(w)}),We(),wn(1,"div",1))},dependencies:[Xn,M$],styles:["#map[_ngcontent-%COMP%]{height:calc(100vh - 3rem);width:100%}[_nghost-%COMP%]{display:flex;height:100%}"],changeDetection:0});let i=r;return i})();var D$="4697956c-969d-4a6e-9559-010900c8863a";var A$="http://localhost:4200/api/v3.0/";var LA=(i,r)=>`${A$}/${i}/?apikey=${D$}&format=json&lang=ru_RU&${r}`;var P$=(()=>{let r=class r{constructor(){this.http=Ee(_S),this.settlementsAll=[],this.map=new Map}getStationsCodes(c,h,m,y){let w=this.findCodes(c,h,this.map);return this.http.get(LA("search",`from=${w.start}&to=${w.end}&transport_types=${m}&date=${y}&transfers=true`)).pipe(st(C=>C))}getAllStations(){return this.cacheAllStations?Nt({stations:this.cacheAllStations,names:[...new Set(this.settlementsAll)]}):this.http.get(LA("stations_list"," ")).pipe(st(c=>(this.cacheAllStations=c,this.createStationMap(c),console.log(this.settlementsAll),{stations:this.cacheAllStations,names:[...new Set(this.settlementsAll)]})))}createStationMap(c){let h=c.countries;for(let m of h){let y=m.title,w=m.codes,C={title:y,codes:w};this.map.set(y,C);let D=m.regions;for(let z of D){let j=z.title,ie=z.codes,oe={title:j,codes:ie};this.map.set(j,oe);let he=z.settlements;for(let ke of he){let rt=ke.title,Ve=ke.codes;rt!==""&&this.settlementsAll.push(ke.title);let Ot={title:rt,codes:Ve};this.map.set(rt,Ot)}}}}findCodes(c,h,m){let y=m.get(c)?.codes.yandex_code,w=m.get(h)?.codes.yandex_code;return{start:y,end:w}}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var O$=(()=>{let r=class r{constructor(){this.scheduleApiService=Ee(P$)}getStationsCodes(c,h,m,y){return this.scheduleApiService.getStationsCodes(c,h,m,y)}getAllStations(){return this.scheduleApiService.getAllStations()}};r.\u0275fac=function(h){return new(h||r)},r.\u0275prov=gt({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var R$=[{value:" "},{path:"assets/svg/plane.svg",value:"plane"},{path:"assets/svg/suburban.svg",value:"suburban"},{path:"assets/svg/train.svg",value:"train"},{path:"assets/svg/bus.svg",value:"bus"}];function pce(i,r){if(i&1&&(He(0,"div",1),wn(1,"img",2),He(2,"div",3)(3,"span"),On(4),We(),He(5,"span",4),On(6),We(),He(7,"span",4),On(8),We()()(),He(9,"div",5)(10,"div",6)(11,"span",4),On(12),ai(13,"date"),We(),He(14,"span",7),On(15),We(),He(16,"span",8),On(17),We()(),He(18,"span",8),On(19),We(),He(20,"div",9)(21,"span",4),On(22),ai(23,"date"),We(),He(24,"span",7),On(25),We(),He(26,"span",8),On(27),We()()()),i&2){let a=yt();qe(),Xe("src","assets/svg/"+(a.segment.thread==null?null:a.segment.thread.transport_type)+".svg",jp),qe(3),Zx(" ",a.search==null||a.search.from==null?null:a.search.from.title," - ",a.search==null||a.search.to==null?null:a.search.to.title," "),qe(2),no(a.segment.thread==null||a.segment.thread.carrier==null?null:a.segment.thread.carrier.title),qe(2),no((a.segment.thread==null?null:a.segment.thread.vehicle)||(a.segment.thread==null?null:a.segment.thread.number)),qe(4),no(Xa(13,12,a.segment.departure.split("T")[0],"MMM d")),qe(3),no(a.localeTime(a.segment.departure)),qe(2),no(a.segment.from==null?null:a.segment.from.title),qe(2),no(a.calculateDuration(a.segment.departure,a.segment.arrival)),qe(3),no(Xa(23,15,a.segment.arrival.split("T")[0],"MMM d")),qe(3),no(a.localeTime(a.segment.arrival)),qe(2),no(a.segment.to==null?null:a.segment.to.title)}}function mce(i,r){if(i&1&&wn(0,"img",2),i&2){let a=r.$implicit;Xe("src","assets/svg/"+a+".svg",jp)}}function gce(i,r){if(i&1&&(He(0,"div",1)(1,"div",10),Uh(2,mce,1,1,"img",2,Wx),We(),He(4,"div",3)(5,"span"),On(6),We(),He(7,"span"),On(8),We()()(),He(9,"div",5)(10,"div",6)(11,"span",4),On(12),ai(13,"date"),We(),He(14,"span",7),On(15),We(),He(16,"span",8),On(17),We()(),He(18,"span",8),On(19),We(),He(20,"div",9)(21,"span",4),On(22),ai(23,"date"),We(),He(24,"span",7),On(25),We(),He(26,"span",8),On(27),We()()()),i&2){let a=yt();qe(2),$h(a.segment.transport_types),qe(4),Zx(" ",a.search==null||a.search.from==null?null:a.search.from.title," - ",a.search==null||a.search.to==null?null:a.search.to.title," "),qe(2),jo("\u0421 \u043F\u0435\u0440\u0435\u0441\u0430\u0434\u043A\u043E\u0439 \u0432 ",a.segment.transfers&&a.segment.transfers[0].title,""),qe(4),no(Xa(13,10,a.segment.departure.split("T")[0],"MMM d")),qe(3),no(a.localeTime(a.segment.departure)),qe(2),no(a.segment.departure_from.title),qe(2),no(a.calculateDuration(a.segment.departure,a.segment.arrival)),qe(3),no(Xa(23,13,a.segment.arrival.split("T")[0],"MMM d")),qe(3),no(a.localeTime(a.segment.arrival)),qe(2),no(a.segment.arrival_to.title)}}var L$=(()=>{let r=class r{calculateDuration(c,h){let m=new Date(c),w=new Date(h).getTime()-m.getTime(),C=Math.floor(w/(1e3*60*60)),D=Math.floor(w%(1e3*60*60)/(1e3*60));return`${C} \u0447 ${D} \u043C\u0438\u043D`}localeTime(c){let h=c.split("T")[1].split("+")[0].split(":");return`${h[0]}:${h[1]}`}};r.\u0275fac=function(h){return new(h||r)},r.\u0275cmp=Cn({type:r,selectors:[["lib-route"]],inputs:{segment:"segment",search:"search"},standalone:!0,features:[ra],decls:3,vars:1,consts:[[1,"segment"],[1,"main-info"],[3,"src"],[1,"route-info"],[1,"secondary-color","secondary-fz"],[1,"sub-info"],[1,"from","route"],[1,"big-font","strong-font"],[1,"secondary-color"],[1,"to","route"],[1,"images"]],template:function(h,m){h&1&&(He(0,"div",0),It(1,pce,28,18)(2,gce,28,16),We()),h&2&&(qe(),Vh(1,m.segment.has_transfers?2:1))},dependencies:[Xn,db],styles:[".segment[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:space-between}.segment[_ngcontent-%COMP%]   .main-info[_ngcontent-%COMP%]{display:flex;align-items:center}.segment[_ngcontent-%COMP%]   .main-info[_ngcontent-%COMP%]   .images[_ngcontent-%COMP%]{display:flex;flex-direction:column}.segment[_ngcontent-%COMP%]   .main-info[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.segment[_ngcontent-%COMP%]   .main-info[_ngcontent-%COMP%]   .route-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:120px}.segment[_ngcontent-%COMP%]   .sub-info[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.segment[_ngcontent-%COMP%]   .sub-info[_ngcontent-%COMP%]   .route[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100px}.segment[_ngcontent-%COMP%]   .sub-info[_ngcontent-%COMP%]   .route.to[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-align:end}.secondary-color[_ngcontent-%COMP%]{color:#969696}.secondary-fz[_ngcontent-%COMP%]{font-size:10px}.strong-font[_ngcontent-%COMP%]{font-weight:700}.big-font[_ngcontent-%COMP%]{font-size:16px}"],changeDetection:0});let i=r;return i})();var yce=(i,r)=>r.path;function vce(i,r){if(i&1){let a=Zr();He(0,"span",19),Kt("click",function(){let m=ji(a).$implicit,y=yt(2);return Vi(y.onChooseName(y.form.get("from"),"from",m))}),On(1),We()}if(i&2){let a=r.$implicit;qe(),no(a)}}function xce(i,r){if(i&1&&(He(0,"div",17),It(1,vce,2,1,"span",18),ai(2,"async"),We()),i&2){let a=yt();qe(),Xe("ngForOf",br(2,1,a.completeNamesFrom$))}}function bce(i,r){if(i&1){let a=Zr();He(0,"span",19),Kt("click",function(){let m=ji(a).$implicit,y=yt(2);return Vi(y.onChooseName(y.form.get("to"),"to",m))}),On(1),We()}if(i&2){let a=r.$implicit;qe(),jo(" ",a,"")}}function wce(i,r){if(i&1&&(He(0,"div",17),It(1,bce,2,1,"span",18),ai(2,"async"),We()),i&2){let a=yt();qe(),Xe("ngForOf",br(2,1,a.completeNamesTo$))}}function Tce(i,r){if(i&1){let a=Zr();He(0,"tui-calendar",20),Kt("dayClick",function(h){ji(a);let m=yt();return Vi(m.setDate(h))}),We()}}function Ece(i,r){if(i&1&&wn(0,"img",22),i&2){let a=yt().$implicit;Xe("src",a.path,jp)}}function Mce(i,r){i&1&&On(0," \u041B\u044E\u0431\u043E\u0439 ")}function Ice(i,r){if(i&1){let a=Zr();He(0,"div",21),Kt("click",function(){let m=ji(a).$implicit,y=yt();return Vi(y.chooseType(m.value))}),It(1,Ece,1,1,"img",22)(2,Mce,1,0),We()}if(i&2){let a=r.$implicit,c=yt();ti("active",c.transport===a.value),qe(),Vh(1,a.path?1:2)}}function Cce(i,r){if(i&1&&(wn(0,"lib-route",23),ai(1,"async")),i&2){let a=r.$implicit,c=yt();Xe("segment",a)("search",br(1,2,c.search$))}}var F$=(()=>{let r=class r{constructor(){this.segments$=new pr([]),this.search$=new pr(null),this.names$=new pr([]),this.completeNamesFrom$=new pr([]),this.completeNamesTo$=new pr([]),this.scheduleService=Ee(O$),this.destroy=Ee(Ci),this.svg=R$,this.showDate=!1,this.dateSelected=!1,this.fromSelected=!1,this.toSelected=!1,this.selectedDate="today",this.transport=" ",this.form=new Ub({from:new rf("",ef.required),to:new rf("",ef.required),date:new rf(this.getDate(new Date),ef.required),transport:new rf(this.transport,ef.required)})}ngOnInit(){this.scheduleService.getAllStations().pipe(Ii(this.destroy)).subscribe(c=>this.names$.next(c.names))}chooseType(c){this.form.get("transport")?.setValue(c),this.transport=c,this.toSearch()}toSearch(){this.scheduleService.getStationsCodes(this.form.value.from,this.form.value.to,this.form.value.transport,this.form.value.date).subscribe(c=>{this.segments$.next(c.segments),this.search$.next(c.search)})}toSwitch(){let c=this.form.get("from"),h=this.form.get("to");if(c&&h){let m=c.value;c.setValue(h.value),h.setValue(m)}}chooseDate(c){this.dateSelected=!1;let h=this.form.get("date");if(c==="today"&&h)this.selectedDate="today",h.setValue(this.getDate(new Date));else if(c==="tomorrow"&&h){this.selectedDate="tomorrow";let m=new Date;m.setDate(m.getDate()+1),h.setValue(this.getDate(m))}else this.selectedDate="date",this.showDate=!this.showDate;this.toSearch()}getDate(c){return c.toISOString().slice(0,10)}setDate(c){this.showDate=!1,this.dateSelected=!0;let h=this.form.get("date"),m=new Date(c.year,c.month,c.day+1);h&&h.setValue(this.getDate(m)),this.toSearch()}autoComplete(c,h,m){if(!(c.length<3)){let y=h.filter(w=>w.toLowerCase().includes(c.toLowerCase()));m==="from"?(this.fromSelected=!1,this.completeNamesFrom$.next(y)):m==="to"&&(this.toSelected=!1,this.completeNamesTo$.next(y))}}onChooseName(c,h,m){c&&c.setValue(m),h==="from"?this.fromSelected=!0:h==="to"&&(this.toSelected=!0)}};r.\u0275fac=function(h){return new(h||r)},r.\u0275cmp=Cn({type:r,selectors:[["lib-schedule"]],standalone:!0,features:[si([Ci]),ra],decls:32,vars:20,consts:[[1,"container"],[3,"formGroup","ngSubmit"],[1,"search"],[1,"inputs"],[1,"autoComplete"],["type","text","placeholder","\u041E\u0442\u043A\u0443\u0434\u0430","formControlName","from",3,"input"],["class","names"],[1,"line"],["type","text","placeholder","\u041A\u0443\u0434\u0430","formControlName","to",3,"input"],["src","assets/svg/arrows.svg",3,"click"],[1,"date"],["type","button",1,"date__item--left","date__item","active",3,"click"],["type","button",1,"date__item","date__item--middle",3,"click"],["type","button",1,"date__item","date__item--right",3,"click"],[1,"transport"],["type","submit",1,"submit"],[1,"segments"],[1,"names"],["class","name",3,"click",4,"ngFor","ngForOf"],[1,"name",3,"click"],[3,"dayClick"],[1,"transport__item",3,"click"],[3,"src"],[3,"segment","search"],["class","transport__item",3,"active"]],template:function(h,m){if(h&1&&(He(0,"div",0)(1,"form",1),Kt("ngSubmit",function(){return m.toSearch()}),He(2,"div",2)(3,"div",3)(4,"div",4)(5,"input",5),Kt("input",function(){let w;return m.autoComplete((w=m.form.get("from"))==null?null:w.value,m.names$.value,"from")}),We(),It(6,xce,3,3,"div",6),ai(7,"async"),We(),wn(8,"span",7),He(9,"div",4)(10,"input",8),Kt("input",function(){let w;return m.autoComplete((w=m.form.get("to"))==null?null:w.value,m.names$.value,"to")}),We(),It(11,wce,3,3,"div",6),ai(12,"async"),We()(),He(13,"img",9),Kt("click",function(){return m.toSwitch()}),We()(),He(14,"div",10)(15,"button",11),Kt("click",function(){return m.chooseDate("today")}),On(16,"\u0421\u0435\u0433\u043E\u0434\u043D\u044F"),We(),He(17,"button",12),Kt("click",function(){return m.chooseDate("tomorrow")}),On(18,"\u0417\u0430\u0432\u0442\u0440\u0430"),We(),He(19,"button",13),Kt("click",function(){return m.showDate})("click",function(){return m.chooseDate("calendar")}),On(20),ai(21,"date"),We(),It(22,Tce,1,0,"tui-calendar"),We(),He(23,"div",14),Uh(24,Ice,3,3,"div",24,yce),We(),He(26,"button",15),On(27,"\u041D\u0430\u0439\u0442\u0438"),We()()(),He(28,"div",16),Uh(29,Cce,2,4,"lib-route",23,Wx),ai(31,"async"),We()),h&2){let y,w;qe(),Xe("formGroup",m.form),qe(5),Vh(6,(!m.fromSelected||!((y=br(7,11,m.completeNamesFrom$))!=null&&y.length))&&((y=m.form.get("from"))==null?null:y.value.length)>3?6:-1),qe(5),Vh(11,(!m.toSelected||!((w=br(12,13,m.completeNamesTo$))!=null&&w.length))&&((w=m.form.get("to"))==null?null:w.value.length)>3?11:-1),qe(4),ti("active",m.selectedDate==="today"),qe(2),ti("active",m.selectedDate==="tomorrow"),qe(2),ti("active",m.selectedDate==="date"),qe(),jo(" ",m.dateSelected?Xa(21,15,m.form.value.date,"MMM d"):"\u0414\u0430\u0442\u0430"," "),qe(2),Vh(22,m.showDate?22:-1),qe(2),$h(m.svg),qe(5),$h(br(31,18,m.segments$))}},dependencies:[Xn,Ja,yo,db,EU,xU,Xp,Gb,fU,dD,hD,f$,h$,L$],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;margin-bottom:3rem}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{display:flex;position:relative}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   tui-calendar[_ngcontent-%COMP%]{background-color:#fff;position:absolute;right:-100%;top:0}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   .date__item[_ngcontent-%COMP%]{flex:1;padding:.5rem;background-color:#e9ecef}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   .date__item.active[_ngcontent-%COMP%]{background-color:#555;color:#fff}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   .date__item--left[_ngcontent-%COMP%]{border-radius:4px 0 0 4px;border-right:1px solid #dbdbdb}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   .date__item--right[_ngcontent-%COMP%]{border-left:1px solid #dbdbdb;border-radius:0 4px 4px 0}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .transport[_ngcontent-%COMP%]{display:flex;gap:.5rem}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .transport[_ngcontent-%COMP%]   .transport__item[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1;padding:.5rem;background-color:#e9ecef;border-radius:4px;cursor:pointer}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .transport[_ngcontent-%COMP%]   .transport__item.active[_ngcontent-%COMP%]{background-color:#555;color:#fff}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{display:flex;border:1px solid #dbdbdb;padding:.3rem 1rem;border-radius:.2rem}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-right:.5rem;flex:1}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]   .autoComplete[_ngcontent-%COMP%]{position:relative}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]   .autoComplete[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:absolute;max-width:200px;max-height:400px;overflow-y:auto;top:100%;left:0;background-color:#dbdbdb;padding:.5rem;z-index:100;border-radius:4px;gap:.5rem}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]   .autoComplete[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{cursor:pointer}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{border-bottom:1px solid #dbdbdb}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;font-size:16px}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus-visible{outline:none}.container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]{flex:1;background-color:#ffe356;padding:.5rem;border-radius:4px}button[_ngcontent-%COMP%]{background-color:#fff;border:none;cursor:pointer}.segments[_ngcontent-%COMP%]{margin:0 auto;display:flex;flex-direction:column;gap:1rem;width:max-content}"],changeDetection:0});let i=r;return i})();var k$=[{path:"map",title:"\u041A\u0430\u0440\u0442\u0430",component:S$},{path:"schedule",title:"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435",component:F$},{path:"",redirectTo:"map",pathMatch:"full"}];var N$={providers:[GV(),O5(k$),mV(),xS(oV()),xC(Q1)]};var B$=fM(z$());var Sce=new ot("Config for DOMPurify",{factory:()=>({}),providedIn:"root"}),Dce=new ot("Hooks for DOMPurify",{factory:()=>[],providedIn:"root"}),Ace=new ot("A function that sanitizes value for a CSS rule",{factory:()=>i=>i,providedIn:"root"}),Pce=B$.default,j$=(()=>{class i{constructor(a,c,{defaultView:h},m){this.config=a,this.sanitizeStyle=c,this.domPurify=Pce(h),m.forEach(({name:y,hook:w})=>{this.domPurify.addHook(y,w)})}sanitize(a,c,h=this.config){if(a===Xo.SCRIPT)throw new Error("DOMPurify does not support SCRIPT context");return a===Xo.STYLE?this.sanitizeStyle(String(c)):this.domPurify.sanitize(String(c||""),h)}}return i.\u0275fac=function(a){return new(a||i)(Ct(Sce),Ct(Ace),Ct(jn),Ct(Dce))},i.\u0275prov=gt({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var V$=[{title:"\u041A\u0430\u0440\u0442\u0430",path:"/map"},{title:"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435",path:"/schedule"}];var Oce=(i,r)=>r.path;function Rce(i,r){if(i&1&&(He(0,"div",0),On(1),We()),i&2){let a=r.$implicit;Xe("routerLink",a.path),qe(),no(a.title)}}var U$=(()=>{let r=class r{constructor(){this.headerItems=V$}};r.\u0275fac=function(h){return new(h||r)},r.\u0275cmp=Cn({type:r,selectors:[["lib-header"]],standalone:!0,features:[ra],decls:3,vars:0,consts:[[1,"header-item",3,"routerLink"],["class","header-item",3,"routerLink"]],template:function(h,m){h&1&&(He(0,"nav"),Uh(1,Rce,2,2,"div",1,Oce),We()),h&2&&(qe(),$h(m.headerItems))},dependencies:[Xn,P5],styles:["nav[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;align-items:center;height:3rem;background-color:#fff}nav[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]{border-radius:1rem;padding:.4rem 1rem;background-color:#526ed3;color:#fff;cursor:pointer;transition:.3s ease-out}nav[_ngcontent-%COMP%]   .header-item[_ngcontent-%COMP%]:hover{background-color:#526ed3cb}"],changeDetection:0});let i=r;return i})();var $$=(()=>{let r=class r{};r.\u0275fac=function(h){return new(h||r)},r.\u0275cmp=Cn({type:r,selectors:[["app-root"]],standalone:!0,features:[si([{provide:lm,useClass:j$}]),ra],decls:4,vars:0,consts:[[1,"page-container"]],template:function(h,m){h&1&&(He(0,"tui-root"),wn(1,"lib-header"),He(2,"div",0),wn(3,"router-outlet"),We()())},dependencies:[sV,vA,U$,Q1,b$,g$,q5],styles:[".page-container[_ngcontent-%COMP%]{height:calc(100vh - 3rem)}"],changeDetection:0});let i=r;return i})();pV($$,N$).catch(i=>console.error(i));
